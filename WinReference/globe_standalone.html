<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Interactive Globe</title>

  <script type="importmap">
{"imports": {"three": "data:text/javascript;base64,LyoqCiAqIEBsaWNlbnNlCiAqIENvcHlyaWdodCAyMDEwLTIwMjMgVGhyZWUuanMgQXV0aG9ycwogKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCiAqLwpjb25zdCBSRVZJU0lPTiA9ICcxNjAnOwoKY29uc3QgTU9VU0UgPSB7IExFRlQ6IDAsIE1JRERMRTogMSwgUklHSFQ6IDIsIFJPVEFURTogMCwgRE9MTFk6IDEsIFBBTjogMiB9Owpjb25zdCBUT1VDSCA9IHsgUk9UQVRFOiAwLCBQQU46IDEsIERPTExZX1BBTjogMiwgRE9MTFlfUk9UQVRFOiAzIH07CmNvbnN0IEN1bGxGYWNlTm9uZSA9IDA7CmNvbnN0IEN1bGxGYWNlQmFjayA9IDE7CmNvbnN0IEN1bGxGYWNlRnJvbnQgPSAyOwpjb25zdCBDdWxsRmFjZUZyb250QmFjayA9IDM7CmNvbnN0IEJhc2ljU2hhZG93TWFwID0gMDsKY29uc3QgUENGU2hhZG93TWFwID0gMTsKY29uc3QgUENGU29mdFNoYWRvd01hcCA9IDI7CmNvbnN0IFZTTVNoYWRvd01hcCA9IDM7CmNvbnN0IEZyb250U2lkZSA9IDA7CmNvbnN0IEJhY2tTaWRlID0gMTsKY29uc3QgRG91YmxlU2lkZSA9IDI7CmNvbnN0IFR3b1Bhc3NEb3VibGVTaWRlID0gMjsgLy8gcjE0OQpjb25zdCBOb0JsZW5kaW5nID0gMDsKY29uc3QgTm9ybWFsQmxlbmRpbmcgPSAxOwpjb25zdCBBZGRpdGl2ZUJsZW5kaW5nID0gMjsKY29uc3QgU3VidHJhY3RpdmVCbGVuZGluZyA9IDM7CmNvbnN0IE11bHRpcGx5QmxlbmRpbmcgPSA0Owpjb25zdCBDdXN0b21CbGVuZGluZyA9IDU7CmNvbnN0IEFkZEVxdWF0aW9uID0gMTAwOwpjb25zdCBTdWJ0cmFjdEVxdWF0aW9uID0gMTAxOwpjb25zdCBSZXZlcnNlU3VidHJhY3RFcXVhdGlvbiA9IDEwMjsKY29uc3QgTWluRXF1YXRpb24gPSAxMDM7CmNvbnN0IE1heEVxdWF0aW9uID0gMTA0Owpjb25zdCBaZXJvRmFjdG9yID0gMjAwOwpjb25zdCBPbmVGYWN0b3IgPSAyMDE7CmNvbnN0IFNyY0NvbG9yRmFjdG9yID0gMjAyOwpjb25zdCBPbmVNaW51c1NyY0NvbG9yRmFjdG9yID0gMjAzOwpjb25zdCBTcmNBbHBoYUZhY3RvciA9IDIwNDsKY29uc3QgT25lTWludXNTcmNBbHBoYUZhY3RvciA9IDIwNTsKY29uc3QgRHN0QWxwaGFGYWN0b3IgPSAyMDY7CmNvbnN0IE9uZU1pbnVzRHN0QWxwaGFGYWN0b3IgPSAyMDc7CmNvbnN0IERzdENvbG9yRmFjdG9yID0gMjA4Owpjb25zdCBPbmVNaW51c0RzdENvbG9yRmFjdG9yID0gMjA5Owpjb25zdCBTcmNBbHBoYVNhdHVyYXRlRmFjdG9yID0gMjEwOwpjb25zdCBDb25zdGFudENvbG9yRmFjdG9yID0gMjExOwpjb25zdCBPbmVNaW51c0NvbnN0YW50Q29sb3JGYWN0b3IgPSAyMTI7CmNvbnN0IENvbnN0YW50QWxwaGFGYWN0b3IgPSAyMTM7CmNvbnN0IE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3RvciA9IDIxNDsKY29uc3QgTmV2ZXJEZXB0aCA9IDA7CmNvbnN0IEFsd2F5c0RlcHRoID0gMTsKY29uc3QgTGVzc0RlcHRoID0gMjsKY29uc3QgTGVzc0VxdWFsRGVwdGggPSAzOwpjb25zdCBFcXVhbERlcHRoID0gNDsKY29uc3QgR3JlYXRlckVxdWFsRGVwdGggPSA1Owpjb25zdCBHcmVhdGVyRGVwdGggPSA2Owpjb25zdCBOb3RFcXVhbERlcHRoID0gNzsKY29uc3QgTXVsdGlwbHlPcGVyYXRpb24gPSAwOwpjb25zdCBNaXhPcGVyYXRpb24gPSAxOwpjb25zdCBBZGRPcGVyYXRpb24gPSAyOwpjb25zdCBOb1RvbmVNYXBwaW5nID0gMDsKY29uc3QgTGluZWFyVG9uZU1hcHBpbmcgPSAxOwpjb25zdCBSZWluaGFyZFRvbmVNYXBwaW5nID0gMjsKY29uc3QgQ2luZW9uVG9uZU1hcHBpbmcgPSAzOwpjb25zdCBBQ0VTRmlsbWljVG9uZU1hcHBpbmcgPSA0Owpjb25zdCBDdXN0b21Ub25lTWFwcGluZyA9IDU7CmNvbnN0IEFnWFRvbmVNYXBwaW5nID0gNjsKY29uc3QgQXR0YWNoZWRCaW5kTW9kZSA9ICdhdHRhY2hlZCc7CmNvbnN0IERldGFjaGVkQmluZE1vZGUgPSAnZGV0YWNoZWQnOwoKY29uc3QgVVZNYXBwaW5nID0gMzAwOwpjb25zdCBDdWJlUmVmbGVjdGlvbk1hcHBpbmcgPSAzMDE7CmNvbnN0IEN1YmVSZWZyYWN0aW9uTWFwcGluZyA9IDMwMjsKY29uc3QgRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgPSAzMDM7CmNvbnN0IEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nID0gMzA0Owpjb25zdCBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZyA9IDMwNjsKY29uc3QgUmVwZWF0V3JhcHBpbmcgPSAxMDAwOwpjb25zdCBDbGFtcFRvRWRnZVdyYXBwaW5nID0gMTAwMTsKY29uc3QgTWlycm9yZWRSZXBlYXRXcmFwcGluZyA9IDEwMDI7CmNvbnN0IE5lYXJlc3RGaWx0ZXIgPSAxMDAzOwpjb25zdCBOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlciA9IDEwMDQ7CmNvbnN0IE5lYXJlc3RNaXBNYXBOZWFyZXN0RmlsdGVyID0gMTAwNDsKY29uc3QgTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciA9IDEwMDU7CmNvbnN0IE5lYXJlc3RNaXBNYXBMaW5lYXJGaWx0ZXIgPSAxMDA1Owpjb25zdCBMaW5lYXJGaWx0ZXIgPSAxMDA2Owpjb25zdCBMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyID0gMTAwNzsKY29uc3QgTGluZWFyTWlwTWFwTmVhcmVzdEZpbHRlciA9IDEwMDc7CmNvbnN0IExpbmVhck1pcG1hcExpbmVhckZpbHRlciA9IDEwMDg7CmNvbnN0IExpbmVhck1pcE1hcExpbmVhckZpbHRlciA9IDEwMDg7CmNvbnN0IFVuc2lnbmVkQnl0ZVR5cGUgPSAxMDA5Owpjb25zdCBCeXRlVHlwZSA9IDEwMTA7CmNvbnN0IFNob3J0VHlwZSA9IDEwMTE7CmNvbnN0IFVuc2lnbmVkU2hvcnRUeXBlID0gMTAxMjsKY29uc3QgSW50VHlwZSA9IDEwMTM7CmNvbnN0IFVuc2lnbmVkSW50VHlwZSA9IDEwMTQ7CmNvbnN0IEZsb2F0VHlwZSA9IDEwMTU7CmNvbnN0IEhhbGZGbG9hdFR5cGUgPSAxMDE2Owpjb25zdCBVbnNpZ25lZFNob3J0NDQ0NFR5cGUgPSAxMDE3Owpjb25zdCBVbnNpZ25lZFNob3J0NTU1MVR5cGUgPSAxMDE4Owpjb25zdCBVbnNpZ25lZEludDI0OFR5cGUgPSAxMDIwOwpjb25zdCBBbHBoYUZvcm1hdCA9IDEwMjE7CmNvbnN0IFJHQkFGb3JtYXQgPSAxMDIzOwpjb25zdCBMdW1pbmFuY2VGb3JtYXQgPSAxMDI0Owpjb25zdCBMdW1pbmFuY2VBbHBoYUZvcm1hdCA9IDEwMjU7CmNvbnN0IERlcHRoRm9ybWF0ID0gMTAyNjsKY29uc3QgRGVwdGhTdGVuY2lsRm9ybWF0ID0gMTAyNzsKY29uc3QgUmVkRm9ybWF0ID0gMTAyODsKY29uc3QgUmVkSW50ZWdlckZvcm1hdCA9IDEwMjk7CmNvbnN0IFJHRm9ybWF0ID0gMTAzMDsKY29uc3QgUkdJbnRlZ2VyRm9ybWF0ID0gMTAzMTsKY29uc3QgUkdCQUludGVnZXJGb3JtYXQgPSAxMDMzOwoKY29uc3QgUkdCX1MzVENfRFhUMV9Gb3JtYXQgPSAzMzc3NjsKY29uc3QgUkdCQV9TM1RDX0RYVDFfRm9ybWF0ID0gMzM3Nzc7CmNvbnN0IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCA9IDMzNzc4Owpjb25zdCBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgPSAzMzc3OTsKY29uc3QgUkdCX1BWUlRDXzRCUFBWMV9Gb3JtYXQgPSAzNTg0MDsKY29uc3QgUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgPSAzNTg0MTsKY29uc3QgUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDI7CmNvbnN0IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCA9IDM1ODQzOwpjb25zdCBSR0JfRVRDMV9Gb3JtYXQgPSAzNjE5NjsKY29uc3QgUkdCX0VUQzJfRm9ybWF0ID0gMzc0OTI7CmNvbnN0IFJHQkFfRVRDMl9FQUNfRm9ybWF0ID0gMzc0OTY7CmNvbnN0IFJHQkFfQVNUQ180eDRfRm9ybWF0ID0gMzc4MDg7CmNvbnN0IFJHQkFfQVNUQ181eDRfRm9ybWF0ID0gMzc4MDk7CmNvbnN0IFJHQkFfQVNUQ181eDVfRm9ybWF0ID0gMzc4MTA7CmNvbnN0IFJHQkFfQVNUQ182eDVfRm9ybWF0ID0gMzc4MTE7CmNvbnN0IFJHQkFfQVNUQ182eDZfRm9ybWF0ID0gMzc4MTI7CmNvbnN0IFJHQkFfQVNUQ184eDVfRm9ybWF0ID0gMzc4MTM7CmNvbnN0IFJHQkFfQVNUQ184eDZfRm9ybWF0ID0gMzc4MTQ7CmNvbnN0IFJHQkFfQVNUQ184eDhfRm9ybWF0ID0gMzc4MTU7CmNvbnN0IFJHQkFfQVNUQ18xMHg1X0Zvcm1hdCA9IDM3ODE2Owpjb25zdCBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQgPSAzNzgxNzsKY29uc3QgUkdCQV9BU1RDXzEweDhfRm9ybWF0ID0gMzc4MTg7CmNvbnN0IFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgPSAzNzgxOTsKY29uc3QgUkdCQV9BU1RDXzEyeDEwX0Zvcm1hdCA9IDM3ODIwOwpjb25zdCBSR0JBX0FTVENfMTJ4MTJfRm9ybWF0ID0gMzc4MjE7CmNvbnN0IFJHQkFfQlBUQ19Gb3JtYXQgPSAzNjQ5MjsKY29uc3QgUkdCX0JQVENfU0lHTkVEX0Zvcm1hdCA9IDM2NDk0Owpjb25zdCBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgPSAzNjQ5NTsKY29uc3QgUkVEX1JHVEMxX0Zvcm1hdCA9IDM2MjgzOwpjb25zdCBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCA9IDM2Mjg0Owpjb25zdCBSRURfR1JFRU5fUkdUQzJfRm9ybWF0ID0gMzYyODU7CmNvbnN0IFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0ID0gMzYyODY7CmNvbnN0IExvb3BPbmNlID0gMjIwMDsKY29uc3QgTG9vcFJlcGVhdCA9IDIyMDE7CmNvbnN0IExvb3BQaW5nUG9uZyA9IDIyMDI7CmNvbnN0IEludGVycG9sYXRlRGlzY3JldGUgPSAyMzAwOwpjb25zdCBJbnRlcnBvbGF0ZUxpbmVhciA9IDIzMDE7CmNvbnN0IEludGVycG9sYXRlU21vb3RoID0gMjMwMjsKY29uc3QgWmVyb0N1cnZhdHVyZUVuZGluZyA9IDI0MDA7CmNvbnN0IFplcm9TbG9wZUVuZGluZyA9IDI0MDE7CmNvbnN0IFdyYXBBcm91bmRFbmRpbmcgPSAyNDAyOwpjb25zdCBOb3JtYWxBbmltYXRpb25CbGVuZE1vZGUgPSAyNTAwOwpjb25zdCBBZGRpdGl2ZUFuaW1hdGlvbkJsZW5kTW9kZSA9IDI1MDE7CmNvbnN0IFRyaWFuZ2xlc0RyYXdNb2RlID0gMDsKY29uc3QgVHJpYW5nbGVTdHJpcERyYXdNb2RlID0gMTsKY29uc3QgVHJpYW5nbGVGYW5EcmF3TW9kZSA9IDI7Ci8qKiBAZGVwcmVjYXRlZCBVc2UgTGluZWFyU1JHQkNvbG9yU3BhY2Ugb3IgTm9Db2xvclNwYWNlIGluIHRocmVlLmpzIHIxNTIrLiAqLwpjb25zdCBMaW5lYXJFbmNvZGluZyA9IDMwMDA7Ci8qKiBAZGVwcmVjYXRlZCBVc2UgU1JHQkNvbG9yU3BhY2UgaW4gdGhyZWUuanMgcjE1MisuICovCmNvbnN0IHNSR0JFbmNvZGluZyA9IDMwMDE7CmNvbnN0IEJhc2ljRGVwdGhQYWNraW5nID0gMzIwMDsKY29uc3QgUkdCQURlcHRoUGFja2luZyA9IDMyMDE7CmNvbnN0IFRhbmdlbnRTcGFjZU5vcm1hbE1hcCA9IDA7CmNvbnN0IE9iamVjdFNwYWNlTm9ybWFsTWFwID0gMTsKCi8vIENvbG9yIHNwYWNlIHN0cmluZyBpZGVudGlmaWVycywgbWF0Y2hpbmcgQ1NTIENvbG9yIE1vZHVsZSBMZXZlbCA0IGFuZCBXZWJHUFUgbmFtZXMgd2hlcmUgYXZhaWxhYmxlLgpjb25zdCBOb0NvbG9yU3BhY2UgPSAnJzsKY29uc3QgU1JHQkNvbG9yU3BhY2UgPSAnc3JnYic7CmNvbnN0IExpbmVhclNSR0JDb2xvclNwYWNlID0gJ3NyZ2ItbGluZWFyJzsKY29uc3QgRGlzcGxheVAzQ29sb3JTcGFjZSA9ICdkaXNwbGF5LXAzJzsKY29uc3QgTGluZWFyRGlzcGxheVAzQ29sb3JTcGFjZSA9ICdkaXNwbGF5LXAzLWxpbmVhcic7Cgpjb25zdCBMaW5lYXJUcmFuc2ZlciA9ICdsaW5lYXInOwpjb25zdCBTUkdCVHJhbnNmZXIgPSAnc3JnYic7Cgpjb25zdCBSZWM3MDlQcmltYXJpZXMgPSAncmVjNzA5JzsKY29uc3QgUDNQcmltYXJpZXMgPSAncDMnOwoKY29uc3QgWmVyb1N0ZW5jaWxPcCA9IDA7CmNvbnN0IEtlZXBTdGVuY2lsT3AgPSA3NjgwOwpjb25zdCBSZXBsYWNlU3RlbmNpbE9wID0gNzY4MTsKY29uc3QgSW5jcmVtZW50U3RlbmNpbE9wID0gNzY4MjsKY29uc3QgRGVjcmVtZW50U3RlbmNpbE9wID0gNzY4MzsKY29uc3QgSW5jcmVtZW50V3JhcFN0ZW5jaWxPcCA9IDM0MDU1Owpjb25zdCBEZWNyZW1lbnRXcmFwU3RlbmNpbE9wID0gMzQwNTY7CmNvbnN0IEludmVydFN0ZW5jaWxPcCA9IDUzODY7Cgpjb25zdCBOZXZlclN0ZW5jaWxGdW5jID0gNTEyOwpjb25zdCBMZXNzU3RlbmNpbEZ1bmMgPSA1MTM7CmNvbnN0IEVxdWFsU3RlbmNpbEZ1bmMgPSA1MTQ7CmNvbnN0IExlc3NFcXVhbFN0ZW5jaWxGdW5jID0gNTE1Owpjb25zdCBHcmVhdGVyU3RlbmNpbEZ1bmMgPSA1MTY7CmNvbnN0IE5vdEVxdWFsU3RlbmNpbEZ1bmMgPSA1MTc7CmNvbnN0IEdyZWF0ZXJFcXVhbFN0ZW5jaWxGdW5jID0gNTE4Owpjb25zdCBBbHdheXNTdGVuY2lsRnVuYyA9IDUxOTsKCmNvbnN0IE5ldmVyQ29tcGFyZSA9IDUxMjsKY29uc3QgTGVzc0NvbXBhcmUgPSA1MTM7CmNvbnN0IEVxdWFsQ29tcGFyZSA9IDUxNDsKY29uc3QgTGVzc0VxdWFsQ29tcGFyZSA9IDUxNTsKY29uc3QgR3JlYXRlckNvbXBhcmUgPSA1MTY7CmNvbnN0IE5vdEVxdWFsQ29tcGFyZSA9IDUxNzsKY29uc3QgR3JlYXRlckVxdWFsQ29tcGFyZSA9IDUxODsKY29uc3QgQWx3YXlzQ29tcGFyZSA9IDUxOTsKCmNvbnN0IFN0YXRpY0RyYXdVc2FnZSA9IDM1MDQ0Owpjb25zdCBEeW5hbWljRHJhd1VzYWdlID0gMzUwNDg7CmNvbnN0IFN0cmVhbURyYXdVc2FnZSA9IDM1MDQwOwpjb25zdCBTdGF0aWNSZWFkVXNhZ2UgPSAzNTA0NTsKY29uc3QgRHluYW1pY1JlYWRVc2FnZSA9IDM1MDQ5Owpjb25zdCBTdHJlYW1SZWFkVXNhZ2UgPSAzNTA0MTsKY29uc3QgU3RhdGljQ29weVVzYWdlID0gMzUwNDY7CmNvbnN0IER5bmFtaWNDb3B5VXNhZ2UgPSAzNTA1MDsKY29uc3QgU3RyZWFtQ29weVVzYWdlID0gMzUwNDI7Cgpjb25zdCBHTFNMMSA9ICcxMDAnOwpjb25zdCBHTFNMMyA9ICczMDAgZXMnOwoKY29uc3QgX1NSR0JBRm9ybWF0ID0gMTAzNTsgLy8gZmFsbGJhY2sgZm9yIFdlYkdMIDEKCmNvbnN0IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSA9IDIwMDA7CmNvbnN0IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gPSAyMDAxOwoKLyoqCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvZXZlbnRkaXNwYXRjaGVyLmpzLwogKi8KCmNsYXNzIEV2ZW50RGlzcGF0Y2hlciB7CgoJYWRkRXZlbnRMaXN0ZW5lciggdHlwZSwgbGlzdGVuZXIgKSB7CgoJCWlmICggdGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQgKSB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKCgkJY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKCQlpZiAoIGxpc3RlbmVyc1sgdHlwZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQlsaXN0ZW5lcnNbIHR5cGUgXSA9IFtdOwoKCQl9CgoJCWlmICggbGlzdGVuZXJzWyB0eXBlIF0uaW5kZXhPZiggbGlzdGVuZXIgKSA9PT0gLSAxICkgewoKCQkJbGlzdGVuZXJzWyB0eXBlIF0ucHVzaCggbGlzdGVuZXIgKTsKCgkJfQoKCX0KCgloYXNFdmVudExpc3RlbmVyKCB0eXBlLCBsaXN0ZW5lciApIHsKCgkJaWYgKCB0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHJldHVybiBmYWxzZTsKCgkJY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKCQlyZXR1cm4gbGlzdGVuZXJzWyB0eXBlIF0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbIHR5cGUgXS5pbmRleE9mKCBsaXN0ZW5lciApICE9PSAtIDE7CgoJfQoKCXJlbW92ZUV2ZW50TGlzdGVuZXIoIHR5cGUsIGxpc3RlbmVyICkgewoKCQlpZiAoIHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQljb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgkJY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgdHlwZSBdOwoKCQlpZiAoIGxpc3RlbmVyQXJyYXkgIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IGluZGV4ID0gbGlzdGVuZXJBcnJheS5pbmRleE9mKCBsaXN0ZW5lciApOwoKCQkJaWYgKCBpbmRleCAhPT0gLSAxICkgewoKCQkJCWxpc3RlbmVyQXJyYXkuc3BsaWNlKCBpbmRleCwgMSApOwoKCQkJfQoKCQl9CgoJfQoKCWRpc3BhdGNoRXZlbnQoIGV2ZW50ICkgewoKCQlpZiAoIHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQljb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgkJY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgZXZlbnQudHlwZSBdOwoKCQlpZiAoIGxpc3RlbmVyQXJyYXkgIT09IHVuZGVmaW5lZCApIHsKCgkJCWV2ZW50LnRhcmdldCA9IHRoaXM7CgoJCQkvLyBNYWtlIGEgY29weSwgaW4gY2FzZSBsaXN0ZW5lcnMgYXJlIHJlbW92ZWQgd2hpbGUgaXRlcmF0aW5nLgoJCQljb25zdCBhcnJheSA9IGxpc3RlbmVyQXJyYXkuc2xpY2UoIDAgKTsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJYXJyYXlbIGkgXS5jYWxsKCB0aGlzLCBldmVudCApOwoKCQkJfQoKCQkJZXZlbnQudGFyZ2V0ID0gbnVsbDsKCgkJfQoKCX0KCn0KCmNvbnN0IF9sdXQgPSBbICcwMCcsICcwMScsICcwMicsICcwMycsICcwNCcsICcwNScsICcwNicsICcwNycsICcwOCcsICcwOScsICcwYScsICcwYicsICcwYycsICcwZCcsICcwZScsICcwZicsICcxMCcsICcxMScsICcxMicsICcxMycsICcxNCcsICcxNScsICcxNicsICcxNycsICcxOCcsICcxOScsICcxYScsICcxYicsICcxYycsICcxZCcsICcxZScsICcxZicsICcyMCcsICcyMScsICcyMicsICcyMycsICcyNCcsICcyNScsICcyNicsICcyNycsICcyOCcsICcyOScsICcyYScsICcyYicsICcyYycsICcyZCcsICcyZScsICcyZicsICczMCcsICczMScsICczMicsICczMycsICczNCcsICczNScsICczNicsICczNycsICczOCcsICczOScsICczYScsICczYicsICczYycsICczZCcsICczZScsICczZicsICc0MCcsICc0MScsICc0MicsICc0MycsICc0NCcsICc0NScsICc0NicsICc0NycsICc0OCcsICc0OScsICc0YScsICc0YicsICc0YycsICc0ZCcsICc0ZScsICc0ZicsICc1MCcsICc1MScsICc1MicsICc1MycsICc1NCcsICc1NScsICc1NicsICc1NycsICc1OCcsICc1OScsICc1YScsICc1YicsICc1YycsICc1ZCcsICc1ZScsICc1ZicsICc2MCcsICc2MScsICc2MicsICc2MycsICc2NCcsICc2NScsICc2NicsICc2NycsICc2OCcsICc2OScsICc2YScsICc2YicsICc2YycsICc2ZCcsICc2ZScsICc2ZicsICc3MCcsICc3MScsICc3MicsICc3MycsICc3NCcsICc3NScsICc3NicsICc3NycsICc3OCcsICc3OScsICc3YScsICc3YicsICc3YycsICc3ZCcsICc3ZScsICc3ZicsICc4MCcsICc4MScsICc4MicsICc4MycsICc4NCcsICc4NScsICc4NicsICc4NycsICc4OCcsICc4OScsICc4YScsICc4YicsICc4YycsICc4ZCcsICc4ZScsICc4ZicsICc5MCcsICc5MScsICc5MicsICc5MycsICc5NCcsICc5NScsICc5NicsICc5NycsICc5OCcsICc5OScsICc5YScsICc5YicsICc5YycsICc5ZCcsICc5ZScsICc5ZicsICdhMCcsICdhMScsICdhMicsICdhMycsICdhNCcsICdhNScsICdhNicsICdhNycsICdhOCcsICdhOScsICdhYScsICdhYicsICdhYycsICdhZCcsICdhZScsICdhZicsICdiMCcsICdiMScsICdiMicsICdiMycsICdiNCcsICdiNScsICdiNicsICdiNycsICdiOCcsICdiOScsICdiYScsICdiYicsICdiYycsICdiZCcsICdiZScsICdiZicsICdjMCcsICdjMScsICdjMicsICdjMycsICdjNCcsICdjNScsICdjNicsICdjNycsICdjOCcsICdjOScsICdjYScsICdjYicsICdjYycsICdjZCcsICdjZScsICdjZicsICdkMCcsICdkMScsICdkMicsICdkMycsICdkNCcsICdkNScsICdkNicsICdkNycsICdkOCcsICdkOScsICdkYScsICdkYicsICdkYycsICdkZCcsICdkZScsICdkZicsICdlMCcsICdlMScsICdlMicsICdlMycsICdlNCcsICdlNScsICdlNicsICdlNycsICdlOCcsICdlOScsICdlYScsICdlYicsICdlYycsICdlZCcsICdlZScsICdlZicsICdmMCcsICdmMScsICdmMicsICdmMycsICdmNCcsICdmNScsICdmNicsICdmNycsICdmOCcsICdmOScsICdmYScsICdmYicsICdmYycsICdmZCcsICdmZScsICdmZicgXTsKCmxldCBfc2VlZCA9IDEyMzQ1Njc7CgoKY29uc3QgREVHMlJBRCA9IE1hdGguUEkgLyAxODA7CmNvbnN0IFJBRDJERUcgPSAxODAgLyBNYXRoLlBJOwoKLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMDUwMzQvaG93LXRvLWNyZWF0ZS1hLWd1aWQtdXVpZC1pbi1qYXZhc2NyaXB0LzIxOTYzMTM2IzIxOTYzMTM2CmZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpIHsKCgljb25zdCBkMCA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCWNvbnN0IGQxID0gTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYgfCAwOwoJY29uc3QgZDIgPSBNYXRoLnJhbmRvbSgpICogMHhmZmZmZmZmZiB8IDA7Cgljb25zdCBkMyA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCWNvbnN0IHV1aWQgPSBfbHV0WyBkMCAmIDB4ZmYgXSArIF9sdXRbIGQwID4+IDggJiAweGZmIF0gKyBfbHV0WyBkMCA+PiAxNiAmIDB4ZmYgXSArIF9sdXRbIGQwID4+IDI0ICYgMHhmZiBdICsgJy0nICsKCQkJX2x1dFsgZDEgJiAweGZmIF0gKyBfbHV0WyBkMSA+PiA4ICYgMHhmZiBdICsgJy0nICsgX2x1dFsgZDEgPj4gMTYgJiAweDBmIHwgMHg0MCBdICsgX2x1dFsgZDEgPj4gMjQgJiAweGZmIF0gKyAnLScgKwoJCQlfbHV0WyBkMiAmIDB4M2YgfCAweDgwIF0gKyBfbHV0WyBkMiA+PiA4ICYgMHhmZiBdICsgJy0nICsgX2x1dFsgZDIgPj4gMTYgJiAweGZmIF0gKyBfbHV0WyBkMiA+PiAyNCAmIDB4ZmYgXSArCgkJCV9sdXRbIGQzICYgMHhmZiBdICsgX2x1dFsgZDMgPj4gOCAmIDB4ZmYgXSArIF9sdXRbIGQzID4+IDE2ICYgMHhmZiBdICsgX2x1dFsgZDMgPj4gMjQgJiAweGZmIF07CgoJLy8gLnRvTG93ZXJDYXNlKCkgaGVyZSBmbGF0dGVucyBjb25jYXRlbmF0ZWQgc3RyaW5ncyB0byBzYXZlIGhlYXAgbWVtb3J5IHNwYWNlLgoJcmV0dXJuIHV1aWQudG9Mb3dlckNhc2UoKTsKCn0KCmZ1bmN0aW9uIGNsYW1wKCB2YWx1ZSwgbWluLCBtYXggKSB7CgoJcmV0dXJuIE1hdGgubWF4KCBtaW4sIE1hdGgubWluKCBtYXgsIHZhbHVlICkgKTsKCn0KCi8vIGNvbXB1dGUgZXVjbGlkZWFuIG1vZHVsbyBvZiBtICUgbgovLyBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Nb2R1bG9fb3BlcmF0aW9uCmZ1bmN0aW9uIGV1Y2xpZGVhbk1vZHVsbyggbiwgbSApIHsKCglyZXR1cm4gKCAoIG4gJSBtICkgKyBtICkgJSBtOwoKfQoKLy8gTGluZWFyIG1hcHBpbmcgZnJvbSByYW5nZSA8YTEsIGEyPiB0byByYW5nZSA8YjEsIGIyPgpmdW5jdGlvbiBtYXBMaW5lYXIoIHgsIGExLCBhMiwgYjEsIGIyICkgewoKCXJldHVybiBiMSArICggeCAtIGExICkgKiAoIGIyIC0gYjEgKSAvICggYTIgLSBhMSApOwoKfQoKLy8gaHR0cHM6Ly93d3cuZ2FtZWRldi5uZXQvdHV0b3JpYWxzL3Byb2dyYW1taW5nL2dlbmVyYWwtYW5kLWdhbWVwbGF5LXByb2dyYW1taW5nL2ludmVyc2UtbGVycC1hLXN1cGVyLXVzZWZ1bC15ZXQtb2Z0ZW4tb3Zlcmxvb2tlZC1mdW5jdGlvbi1yNTIzMC8KZnVuY3Rpb24gaW52ZXJzZUxlcnAoIHgsIHksIHZhbHVlICkgewoKCWlmICggeCAhPT0geSApIHsKCgkJcmV0dXJuICggdmFsdWUgLSB4ICkgLyAoIHkgLSB4ICk7CgoJfSBlbHNlIHsKCgkJcmV0dXJuIDA7CgoJfQoKfQoKLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTGluZWFyX2ludGVycG9sYXRpb24KZnVuY3Rpb24gbGVycCggeCwgeSwgdCApIHsKCglyZXR1cm4gKCAxIC0gdCApICogeCArIHQgKiB5OwoKfQoKLy8gaHR0cDovL3d3dy5yb3J5ZHJpc2NvbGwuY29tLzIwMTYvMDMvMDcvZnJhbWUtcmF0ZS1pbmRlcGVuZGVudC1kYW1waW5nLXVzaW5nLWxlcnAvCmZ1bmN0aW9uIGRhbXAoIHgsIHksIGxhbWJkYSwgZHQgKSB7CgoJcmV0dXJuIGxlcnAoIHgsIHksIDEgLSBNYXRoLmV4cCggLSBsYW1iZGEgKiBkdCApICk7Cgp9CgovLyBodHRwczovL3d3dy5kZXNtb3MuY29tL2NhbGN1bGF0b3IvdmNzam55ejd4NApmdW5jdGlvbiBwaW5ncG9uZyggeCwgbGVuZ3RoID0gMSApIHsKCglyZXR1cm4gbGVuZ3RoIC0gTWF0aC5hYnMoIGV1Y2xpZGVhbk1vZHVsbyggeCwgbGVuZ3RoICogMiApIC0gbGVuZ3RoICk7Cgp9CgovLyBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1Ntb290aHN0ZXAKZnVuY3Rpb24gc21vb3Roc3RlcCggeCwgbWluLCBtYXggKSB7CgoJaWYgKCB4IDw9IG1pbiApIHJldHVybiAwOwoJaWYgKCB4ID49IG1heCApIHJldHVybiAxOwoKCXggPSAoIHggLSBtaW4gKSAvICggbWF4IC0gbWluICk7CgoJcmV0dXJuIHggKiB4ICogKCAzIC0gMiAqIHggKTsKCn0KCmZ1bmN0aW9uIHNtb290aGVyc3RlcCggeCwgbWluLCBtYXggKSB7CgoJaWYgKCB4IDw9IG1pbiApIHJldHVybiAwOwoJaWYgKCB4ID49IG1heCApIHJldHVybiAxOwoKCXggPSAoIHggLSBtaW4gKSAvICggbWF4IC0gbWluICk7CgoJcmV0dXJuIHggKiB4ICogeCAqICggeCAqICggeCAqIDYgLSAxNSApICsgMTAgKTsKCn0KCi8vIFJhbmRvbSBpbnRlZ2VyIGZyb20gPGxvdywgaGlnaD4gaW50ZXJ2YWwKZnVuY3Rpb24gcmFuZEludCggbG93LCBoaWdoICkgewoKCXJldHVybiBsb3cgKyBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSgpICogKCBoaWdoIC0gbG93ICsgMSApICk7Cgp9CgovLyBSYW5kb20gZmxvYXQgZnJvbSA8bG93LCBoaWdoPiBpbnRlcnZhbApmdW5jdGlvbiByYW5kRmxvYXQoIGxvdywgaGlnaCApIHsKCglyZXR1cm4gbG93ICsgTWF0aC5yYW5kb20oKSAqICggaGlnaCAtIGxvdyApOwoKfQoKLy8gUmFuZG9tIGZsb2F0IGZyb20gPC1yYW5nZS8yLCByYW5nZS8yPiBpbnRlcnZhbApmdW5jdGlvbiByYW5kRmxvYXRTcHJlYWQoIHJhbmdlICkgewoKCXJldHVybiByYW5nZSAqICggMC41IC0gTWF0aC5yYW5kb20oKSApOwoKfQoKLy8gRGV0ZXJtaW5pc3RpYyBwc2V1ZG8tcmFuZG9tIGZsb2F0IGluIHRoZSBpbnRlcnZhbCBbIDAsIDEgXQpmdW5jdGlvbiBzZWVkZWRSYW5kb20oIHMgKSB7CgoJaWYgKCBzICE9PSB1bmRlZmluZWQgKSBfc2VlZCA9IHM7CgoJLy8gTXVsYmVycnkzMiBnZW5lcmF0b3IKCglsZXQgdCA9IF9zZWVkICs9IDB4NkQyQjc5RjU7CgoJdCA9IE1hdGguaW11bCggdCBeIHQgPj4+IDE1LCB0IHwgMSApOwoKCXQgXj0gdCArIE1hdGguaW11bCggdCBeIHQgPj4+IDcsIHQgfCA2MSApOwoKCXJldHVybiAoICggdCBeIHQgPj4+IDE0ICkgPj4+IDAgKSAvIDQyOTQ5NjcyOTY7Cgp9CgpmdW5jdGlvbiBkZWdUb1JhZCggZGVncmVlcyApIHsKCglyZXR1cm4gZGVncmVlcyAqIERFRzJSQUQ7Cgp9CgpmdW5jdGlvbiByYWRUb0RlZyggcmFkaWFucyApIHsKCglyZXR1cm4gcmFkaWFucyAqIFJBRDJERUc7Cgp9CgpmdW5jdGlvbiBpc1Bvd2VyT2ZUd28oIHZhbHVlICkgewoKCXJldHVybiAoIHZhbHVlICYgKCB2YWx1ZSAtIDEgKSApID09PSAwICYmIHZhbHVlICE9PSAwOwoKfQoKZnVuY3Rpb24gY2VpbFBvd2VyT2ZUd28oIHZhbHVlICkgewoKCXJldHVybiBNYXRoLnBvdyggMiwgTWF0aC5jZWlsKCBNYXRoLmxvZyggdmFsdWUgKSAvIE1hdGguTE4yICkgKTsKCn0KCmZ1bmN0aW9uIGZsb29yUG93ZXJPZlR3byggdmFsdWUgKSB7CgoJcmV0dXJuIE1hdGgucG93KCAyLCBNYXRoLmZsb29yKCBNYXRoLmxvZyggdmFsdWUgKSAvIE1hdGguTE4yICkgKTsKCn0KCmZ1bmN0aW9uIHNldFF1YXRlcm5pb25Gcm9tUHJvcGVyRXVsZXIoIHEsIGEsIGIsIGMsIG9yZGVyICkgewoKCS8vIEludHJpbnNpYyBQcm9wZXIgRXVsZXIgQW5nbGVzIC0gc2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0V1bGVyX2FuZ2xlcwoKCS8vIHJvdGF0aW9ucyBhcmUgYXBwbGllZCB0byB0aGUgYXhlcyBpbiB0aGUgb3JkZXIgc3BlY2lmaWVkIGJ5ICdvcmRlcicKCS8vIHJvdGF0aW9uIGJ5IGFuZ2xlICdhJyBpcyBhcHBsaWVkIGZpcnN0LCB0aGVuIGJ5IGFuZ2xlICdiJywgdGhlbiBieSBhbmdsZSAnYycKCS8vIGFuZ2xlcyBhcmUgaW4gcmFkaWFucwoKCWNvbnN0IGNvcyA9IE1hdGguY29zOwoJY29uc3Qgc2luID0gTWF0aC5zaW47CgoJY29uc3QgYzIgPSBjb3MoIGIgLyAyICk7Cgljb25zdCBzMiA9IHNpbiggYiAvIDIgKTsKCgljb25zdCBjMTMgPSBjb3MoICggYSArIGMgKSAvIDIgKTsKCWNvbnN0IHMxMyA9IHNpbiggKCBhICsgYyApIC8gMiApOwoKCWNvbnN0IGMxXzMgPSBjb3MoICggYSAtIGMgKSAvIDIgKTsKCWNvbnN0IHMxXzMgPSBzaW4oICggYSAtIGMgKSAvIDIgKTsKCgljb25zdCBjM18xID0gY29zKCAoIGMgLSBhICkgLyAyICk7Cgljb25zdCBzM18xID0gc2luKCAoIGMgLSBhICkgLyAyICk7CgoJc3dpdGNoICggb3JkZXIgKSB7CgoJCWNhc2UgJ1hZWCc6CgkJCXEuc2V0KCBjMiAqIHMxMywgczIgKiBjMV8zLCBzMiAqIHMxXzMsIGMyICogYzEzICk7CgkJCWJyZWFrOwoKCQljYXNlICdZWlknOgoJCQlxLnNldCggczIgKiBzMV8zLCBjMiAqIHMxMywgczIgKiBjMV8zLCBjMiAqIGMxMyApOwoJCQlicmVhazsKCgkJY2FzZSAnWlhaJzoKCQkJcS5zZXQoIHMyICogYzFfMywgczIgKiBzMV8zLCBjMiAqIHMxMywgYzIgKiBjMTMgKTsKCQkJYnJlYWs7CgoJCWNhc2UgJ1haWCc6CgkJCXEuc2V0KCBjMiAqIHMxMywgczIgKiBzM18xLCBzMiAqIGMzXzEsIGMyICogYzEzICk7CgkJCWJyZWFrOwoKCQljYXNlICdZWFknOgoJCQlxLnNldCggczIgKiBjM18xLCBjMiAqIHMxMywgczIgKiBzM18xLCBjMiAqIGMxMyApOwoJCQlicmVhazsKCgkJY2FzZSAnWllaJzoKCQkJcS5zZXQoIHMyICogczNfMSwgczIgKiBjM18xLCBjMiAqIHMxMywgYzIgKiBjMTMgKTsKCQkJYnJlYWs7CgoJCWRlZmF1bHQ6CgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk1hdGhVdGlsczogLnNldFF1YXRlcm5pb25Gcm9tUHJvcGVyRXVsZXIoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAnICsgb3JkZXIgKTsKCgl9Cgp9CgpmdW5jdGlvbiBkZW5vcm1hbGl6ZSggdmFsdWUsIGFycmF5ICkgewoKCXN3aXRjaCAoIGFycmF5LmNvbnN0cnVjdG9yICkgewoKCQljYXNlIEZsb2F0MzJBcnJheToKCgkJCXJldHVybiB2YWx1ZTsKCgkJY2FzZSBVaW50MzJBcnJheToKCgkJCXJldHVybiB2YWx1ZSAvIDQyOTQ5NjcyOTUuMDsKCgkJY2FzZSBVaW50MTZBcnJheToKCgkJCXJldHVybiB2YWx1ZSAvIDY1NTM1LjA7CgoJCWNhc2UgVWludDhBcnJheToKCgkJCXJldHVybiB2YWx1ZSAvIDI1NS4wOwoKCQljYXNlIEludDMyQXJyYXk6CgoJCQlyZXR1cm4gTWF0aC5tYXgoIHZhbHVlIC8gMjE0NzQ4MzY0Ny4wLCAtIDEuMCApOwoKCQljYXNlIEludDE2QXJyYXk6CgoJCQlyZXR1cm4gTWF0aC5tYXgoIHZhbHVlIC8gMzI3NjcuMCwgLSAxLjAgKTsKCgkJY2FzZSBJbnQ4QXJyYXk6CgoJCQlyZXR1cm4gTWF0aC5tYXgoIHZhbHVlIC8gMTI3LjAsIC0gMS4wICk7CgoJCWRlZmF1bHQ6CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdJbnZhbGlkIGNvbXBvbmVudCB0eXBlLicgKTsKCgl9Cgp9CgpmdW5jdGlvbiBub3JtYWxpemUoIHZhbHVlLCBhcnJheSApIHsKCglzd2l0Y2ggKCBhcnJheS5jb25zdHJ1Y3RvciApIHsKCgkJY2FzZSBGbG9hdDMyQXJyYXk6CgoJCQlyZXR1cm4gdmFsdWU7CgoJCWNhc2UgVWludDMyQXJyYXk6CgoJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiA0Mjk0OTY3Mjk1LjAgKTsKCgkJY2FzZSBVaW50MTZBcnJheToKCgkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDY1NTM1LjAgKTsKCgkJY2FzZSBVaW50OEFycmF5OgoKCQkJcmV0dXJuIE1hdGgucm91bmQoIHZhbHVlICogMjU1LjAgKTsKCgkJY2FzZSBJbnQzMkFycmF5OgoKCQkJcmV0dXJuIE1hdGgucm91bmQoIHZhbHVlICogMjE0NzQ4MzY0Ny4wICk7CgoJCWNhc2UgSW50MTZBcnJheToKCgkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDMyNzY3LjAgKTsKCgkJY2FzZSBJbnQ4QXJyYXk6CgoJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAxMjcuMCApOwoKCQlkZWZhdWx0OgoKCQkJdGhyb3cgbmV3IEVycm9yKCAnSW52YWxpZCBjb21wb25lbnQgdHlwZS4nICk7CgoJfQoKfQoKY29uc3QgTWF0aFV0aWxzID0gewoJREVHMlJBRDogREVHMlJBRCwKCVJBRDJERUc6IFJBRDJERUcsCglnZW5lcmF0ZVVVSUQ6IGdlbmVyYXRlVVVJRCwKCWNsYW1wOiBjbGFtcCwKCWV1Y2xpZGVhbk1vZHVsbzogZXVjbGlkZWFuTW9kdWxvLAoJbWFwTGluZWFyOiBtYXBMaW5lYXIsCglpbnZlcnNlTGVycDogaW52ZXJzZUxlcnAsCglsZXJwOiBsZXJwLAoJZGFtcDogZGFtcCwKCXBpbmdwb25nOiBwaW5ncG9uZywKCXNtb290aHN0ZXA6IHNtb290aHN0ZXAsCglzbW9vdGhlcnN0ZXA6IHNtb290aGVyc3RlcCwKCXJhbmRJbnQ6IHJhbmRJbnQsCglyYW5kRmxvYXQ6IHJhbmRGbG9hdCwKCXJhbmRGbG9hdFNwcmVhZDogcmFuZEZsb2F0U3ByZWFkLAoJc2VlZGVkUmFuZG9tOiBzZWVkZWRSYW5kb20sCglkZWdUb1JhZDogZGVnVG9SYWQsCglyYWRUb0RlZzogcmFkVG9EZWcsCglpc1Bvd2VyT2ZUd286IGlzUG93ZXJPZlR3bywKCWNlaWxQb3dlck9mVHdvOiBjZWlsUG93ZXJPZlR3bywKCWZsb29yUG93ZXJPZlR3bzogZmxvb3JQb3dlck9mVHdvLAoJc2V0UXVhdGVybmlvbkZyb21Qcm9wZXJFdWxlcjogc2V0UXVhdGVybmlvbkZyb21Qcm9wZXJFdWxlciwKCW5vcm1hbGl6ZTogbm9ybWFsaXplLAoJZGVub3JtYWxpemU6IGRlbm9ybWFsaXplCn07CgpjbGFzcyBWZWN0b3IyIHsKCgljb25zdHJ1Y3RvciggeCA9IDAsIHkgPSAwICkgewoKCQlWZWN0b3IyLnByb3RvdHlwZS5pc1ZlY3RvcjIgPSB0cnVlOwoKCQl0aGlzLnggPSB4OwoJCXRoaXMueSA9IHk7CgoJfQoKCWdldCB3aWR0aCgpIHsKCgkJcmV0dXJuIHRoaXMueDsKCgl9CgoJc2V0IHdpZHRoKCB2YWx1ZSApIHsKCgkJdGhpcy54ID0gdmFsdWU7CgoJfQoKCWdldCBoZWlnaHQoKSB7CgoJCXJldHVybiB0aGlzLnk7CgoJfQoKCXNldCBoZWlnaHQoIHZhbHVlICkgewoKCQl0aGlzLnkgPSB2YWx1ZTsKCgl9CgoJc2V0KCB4LCB5ICkgewoKCQl0aGlzLnggPSB4OwoJCXRoaXMueSA9IHk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRTY2FsYXIoIHNjYWxhciApIHsKCgkJdGhpcy54ID0gc2NhbGFyOwoJCXRoaXMueSA9IHNjYWxhcjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFgoIHggKSB7CgoJCXRoaXMueCA9IHg7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRZKCB5ICkgewoKCQl0aGlzLnkgPSB5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgoJCXN3aXRjaCAoIGluZGV4ICkgewoKCQkJY2FzZSAwOiB0aGlzLnggPSB2YWx1ZTsgYnJlYWs7CgkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwoJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRDb21wb25lbnQoIGluZGV4ICkgewoKCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCWNhc2UgMDogcmV0dXJuIHRoaXMueDsKCQkJY2FzZSAxOiByZXR1cm4gdGhpcy55OwoJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQl9CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMueCwgdGhpcy55ICk7CgoJfQoKCWNvcHkoIHYgKSB7CgoJCXRoaXMueCA9IHYueDsKCQl0aGlzLnkgPSB2Lnk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGQoIHYgKSB7CgoJCXRoaXMueCArPSB2Lng7CgkJdGhpcy55ICs9IHYueTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZFNjYWxhciggcyApIHsKCgkJdGhpcy54ICs9IHM7CgkJdGhpcy55ICs9IHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRWZWN0b3JzKCBhLCBiICkgewoKCQl0aGlzLnggPSBhLnggKyBiLng7CgkJdGhpcy55ID0gYS55ICsgYi55OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkU2NhbGVkVmVjdG9yKCB2LCBzICkgewoKCQl0aGlzLnggKz0gdi54ICogczsKCQl0aGlzLnkgKz0gdi55ICogczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN1YiggdiApIHsKCgkJdGhpcy54IC09IHYueDsKCQl0aGlzLnkgLT0gdi55OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3ViU2NhbGFyKCBzICkgewoKCQl0aGlzLnggLT0gczsKCQl0aGlzLnkgLT0gczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN1YlZlY3RvcnMoIGEsIGIgKSB7CgoJCXRoaXMueCA9IGEueCAtIGIueDsKCQl0aGlzLnkgPSBhLnkgLSBiLnk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltdWx0aXBseSggdiApIHsKCgkJdGhpcy54ICo9IHYueDsKCQl0aGlzLnkgKj0gdi55OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbXVsdGlwbHlTY2FsYXIoIHNjYWxhciApIHsKCgkJdGhpcy54ICo9IHNjYWxhcjsKCQl0aGlzLnkgKj0gc2NhbGFyOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGl2aWRlKCB2ICkgewoKCQl0aGlzLnggLz0gdi54OwoJCXRoaXMueSAvPSB2Lnk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCgkJcmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIoIDEgLyBzY2FsYXIgKTsKCgl9CgoJYXBwbHlNYXRyaXgzKCBtICkgewoKCQljb25zdCB4ID0gdGhpcy54LCB5ID0gdGhpcy55OwoJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQl0aGlzLnggPSBlWyAwIF0gKiB4ICsgZVsgMyBdICogeSArIGVbIDYgXTsKCQl0aGlzLnkgPSBlWyAxIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDcgXTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW1pbiggdiApIHsKCgkJdGhpcy54ID0gTWF0aC5taW4oIHRoaXMueCwgdi54ICk7CgkJdGhpcy55ID0gTWF0aC5taW4oIHRoaXMueSwgdi55ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYXgoIHYgKSB7CgoJCXRoaXMueCA9IE1hdGgubWF4KCB0aGlzLngsIHYueCApOwoJCXRoaXMueSA9IE1hdGgubWF4KCB0aGlzLnksIHYueSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xhbXAoIG1pbiwgbWF4ICkgewoKCQkvLyBhc3N1bWVzIG1pbiA8IG1heCwgY29tcG9uZW50d2lzZQoKCQl0aGlzLnggPSBNYXRoLm1heCggbWluLngsIE1hdGgubWluKCBtYXgueCwgdGhpcy54ICkgKTsKCQl0aGlzLnkgPSBNYXRoLm1heCggbWluLnksIE1hdGgubWluKCBtYXgueSwgdGhpcy55ICkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsYW1wU2NhbGFyKCBtaW5WYWwsIG1heFZhbCApIHsKCgkJdGhpcy54ID0gTWF0aC5tYXgoIG1pblZhbCwgTWF0aC5taW4oIG1heFZhbCwgdGhpcy54ICkgKTsKCQl0aGlzLnkgPSBNYXRoLm1heCggbWluVmFsLCBNYXRoLm1pbiggbWF4VmFsLCB0aGlzLnkgKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xhbXBMZW5ndGgoIG1pbiwgbWF4ICkgewoKCQljb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aCgpOwoKCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIGxlbmd0aCB8fCAxICkubXVsdGlwbHlTY2FsYXIoIE1hdGgubWF4KCBtaW4sIE1hdGgubWluKCBtYXgsIGxlbmd0aCApICkgKTsKCgl9CgoJZmxvb3IoKSB7CgoJCXRoaXMueCA9IE1hdGguZmxvb3IoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGguZmxvb3IoIHRoaXMueSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2VpbCgpIHsKCgkJdGhpcy54ID0gTWF0aC5jZWlsKCB0aGlzLnggKTsKCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm91bmQoKSB7CgoJCXRoaXMueCA9IE1hdGgucm91bmQoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGgucm91bmQoIHRoaXMueSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm91bmRUb1plcm8oKSB7CgoJCXRoaXMueCA9IE1hdGgudHJ1bmMoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGgudHJ1bmMoIHRoaXMueSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbmVnYXRlKCkgewoKCQl0aGlzLnggPSAtIHRoaXMueDsKCQl0aGlzLnkgPSAtIHRoaXMueTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRvdCggdiApIHsKCgkJcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueTsKCgl9CgoJY3Jvc3MoIHYgKSB7CgoJCXJldHVybiB0aGlzLnggKiB2LnkgLSB0aGlzLnkgKiB2Lng7CgoJfQoKCWxlbmd0aFNxKCkgewoKCQlyZXR1cm4gdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55OwoKCX0KCglsZW5ndGgoKSB7CgoJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSApOwoKCX0KCgltYW5oYXR0YW5MZW5ndGgoKSB7CgoJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICk7CgoJfQoKCW5vcm1hbGl6ZSgpIHsKCgkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCgl9CgoJYW5nbGUoKSB7CgoJCS8vIGNvbXB1dGVzIHRoZSBhbmdsZSBpbiByYWRpYW5zIHdpdGggcmVzcGVjdCB0byB0aGUgcG9zaXRpdmUgeC1heGlzCgoJCWNvbnN0IGFuZ2xlID0gTWF0aC5hdGFuMiggLSB0aGlzLnksIC0gdGhpcy54ICkgKyBNYXRoLlBJOwoKCQlyZXR1cm4gYW5nbGU7CgoJfQoKCWFuZ2xlVG8oIHYgKSB7CgoJCWNvbnN0IGRlbm9taW5hdG9yID0gTWF0aC5zcXJ0KCB0aGlzLmxlbmd0aFNxKCkgKiB2Lmxlbmd0aFNxKCkgKTsKCgkJaWYgKCBkZW5vbWluYXRvciA9PT0gMCApIHJldHVybiBNYXRoLlBJIC8gMjsKCgkJY29uc3QgdGhldGEgPSB0aGlzLmRvdCggdiApIC8gZGVub21pbmF0b3I7CgoJCS8vIGNsYW1wLCB0byBoYW5kbGUgbnVtZXJpY2FsIHByb2JsZW1zCgoJCXJldHVybiBNYXRoLmFjb3MoIGNsYW1wKCB0aGV0YSwgLSAxLCAxICkgKTsKCgl9CgoJZGlzdGFuY2VUbyggdiApIHsKCgkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVRvU3F1YXJlZCggdiApICk7CgoJfQoKCWRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgewoKCQljb25zdCBkeCA9IHRoaXMueCAtIHYueCwgZHkgPSB0aGlzLnkgLSB2Lnk7CgkJcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5OwoKCX0KCgltYW5oYXR0YW5EaXN0YW5jZVRvKCB2ICkgewoKCQlyZXR1cm4gTWF0aC5hYnMoIHRoaXMueCAtIHYueCApICsgTWF0aC5hYnMoIHRoaXMueSAtIHYueSApOwoKCX0KCglzZXRMZW5ndGgoIGxlbmd0aCApIHsKCgkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIGxlbmd0aCApOwoKCX0KCglsZXJwKCB2LCBhbHBoYSApIHsKCgkJdGhpcy54ICs9ICggdi54IC0gdGhpcy54ICkgKiBhbHBoYTsKCQl0aGlzLnkgKz0gKCB2LnkgLSB0aGlzLnkgKSAqIGFscGhhOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbGVycFZlY3RvcnMoIHYxLCB2MiwgYWxwaGEgKSB7CgoJCXRoaXMueCA9IHYxLnggKyAoIHYyLnggLSB2MS54ICkgKiBhbHBoYTsKCQl0aGlzLnkgPSB2MS55ICsgKCB2Mi55IC0gdjEueSApICogYWxwaGE7CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIHYgKSB7CgoJCXJldHVybiAoICggdi54ID09PSB0aGlzLnggKSAmJiAoIHYueSA9PT0gdGhpcy55ICkgKTsKCgl9CgoJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJdGhpcy54ID0gYXJyYXlbIG9mZnNldCBdOwoJCXRoaXMueSA9IGFycmF5WyBvZmZzZXQgKyAxIF07CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CgkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMueTsKCgkJcmV0dXJuIGFycmF5OwoKCX0KCglmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKCQl0aGlzLnggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKCQl0aGlzLnkgPSBhdHRyaWJ1dGUuZ2V0WSggaW5kZXggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJvdGF0ZUFyb3VuZCggY2VudGVyLCBhbmdsZSApIHsKCgkJY29uc3QgYyA9IE1hdGguY29zKCBhbmdsZSApLCBzID0gTWF0aC5zaW4oIGFuZ2xlICk7CgoJCWNvbnN0IHggPSB0aGlzLnggLSBjZW50ZXIueDsKCQljb25zdCB5ID0gdGhpcy55IC0gY2VudGVyLnk7CgoJCXRoaXMueCA9IHggKiBjIC0geSAqIHMgKyBjZW50ZXIueDsKCQl0aGlzLnkgPSB4ICogcyArIHkgKiBjICsgY2VudGVyLnk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyYW5kb20oKSB7CgoJCXRoaXMueCA9IE1hdGgucmFuZG9tKCk7CgkJdGhpcy55ID0gTWF0aC5yYW5kb20oKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKCQl5aWVsZCB0aGlzLng7CgkJeWllbGQgdGhpcy55OwoKCX0KCn0KCmNsYXNzIE1hdHJpeDMgewoKCWNvbnN0cnVjdG9yKCBuMTEsIG4xMiwgbjEzLCBuMjEsIG4yMiwgbjIzLCBuMzEsIG4zMiwgbjMzICkgewoKCQlNYXRyaXgzLnByb3RvdHlwZS5pc01hdHJpeDMgPSB0cnVlOwoKCQl0aGlzLmVsZW1lbnRzID0gWwoKCQkJMSwgMCwgMCwKCQkJMCwgMSwgMCwKCQkJMCwgMCwgMQoKCQldOwoKCQlpZiAoIG4xMSAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5zZXQoIG4xMSwgbjEyLCBuMTMsIG4yMSwgbjIyLCBuMjMsIG4zMSwgbjMyLCBuMzMgKTsKCgkJfQoKCX0KCglzZXQoIG4xMSwgbjEyLCBuMTMsIG4yMSwgbjIyLCBuMjMsIG4zMSwgbjMyLCBuMzMgKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJdGVbIDAgXSA9IG4xMTsgdGVbIDEgXSA9IG4yMTsgdGVbIDIgXSA9IG4zMTsKCQl0ZVsgMyBdID0gbjEyOyB0ZVsgNCBdID0gbjIyOyB0ZVsgNSBdID0gbjMyOwoJCXRlWyA2IF0gPSBuMTM7IHRlWyA3IF0gPSBuMjM7IHRlWyA4IF0gPSBuMzM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglpZGVudGl0eSgpIHsKCgkJdGhpcy5zZXQoCgoJCQkxLCAwLCAwLAoJCQkwLCAxLCAwLAoJCQkwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb3B5KCBtICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJY29uc3QgbWUgPSBtLmVsZW1lbnRzOwoKCQl0ZVsgMCBdID0gbWVbIDAgXTsgdGVbIDEgXSA9IG1lWyAxIF07IHRlWyAyIF0gPSBtZVsgMiBdOwoJCXRlWyAzIF0gPSBtZVsgMyBdOyB0ZVsgNCBdID0gbWVbIDQgXTsgdGVbIDUgXSA9IG1lWyA1IF07CgkJdGVbIDYgXSA9IG1lWyA2IF07IHRlWyA3IF0gPSBtZVsgNyBdOyB0ZVsgOCBdID0gbWVbIDggXTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWV4dHJhY3RCYXNpcyggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCgkJeEF4aXMuc2V0RnJvbU1hdHJpeDNDb2x1bW4oIHRoaXMsIDAgKTsKCQl5QXhpcy5zZXRGcm9tTWF0cml4M0NvbHVtbiggdGhpcywgMSApOwoJCXpBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tTWF0cml4NCggbSApIHsKCgkJY29uc3QgbWUgPSBtLmVsZW1lbnRzOwoKCQl0aGlzLnNldCgKCgkJCW1lWyAwIF0sIG1lWyA0IF0sIG1lWyA4IF0sCgkJCW1lWyAxIF0sIG1lWyA1IF0sIG1lWyA5IF0sCgkJCW1lWyAyIF0sIG1lWyA2IF0sIG1lWyAxMCBdCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltdWx0aXBseSggbSApIHsKCgkJcmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyggdGhpcywgbSApOwoKCX0KCglwcmVtdWx0aXBseSggbSApIHsKCgkJcmV0dXJuIHRoaXMubXVsdGlwbHlNYXRyaWNlcyggbSwgdGhpcyApOwoKCX0KCgltdWx0aXBseU1hdHJpY2VzKCBhLCBiICkgewoKCQljb25zdCBhZSA9IGEuZWxlbWVudHM7CgkJY29uc3QgYmUgPSBiLmVsZW1lbnRzOwoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJY29uc3QgYTExID0gYWVbIDAgXSwgYTEyID0gYWVbIDMgXSwgYTEzID0gYWVbIDYgXTsKCQljb25zdCBhMjEgPSBhZVsgMSBdLCBhMjIgPSBhZVsgNCBdLCBhMjMgPSBhZVsgNyBdOwoJCWNvbnN0IGEzMSA9IGFlWyAyIF0sIGEzMiA9IGFlWyA1IF0sIGEzMyA9IGFlWyA4IF07CgoJCWNvbnN0IGIxMSA9IGJlWyAwIF0sIGIxMiA9IGJlWyAzIF0sIGIxMyA9IGJlWyA2IF07CgkJY29uc3QgYjIxID0gYmVbIDEgXSwgYjIyID0gYmVbIDQgXSwgYjIzID0gYmVbIDcgXTsKCQljb25zdCBiMzEgPSBiZVsgMiBdLCBiMzIgPSBiZVsgNSBdLCBiMzMgPSBiZVsgOCBdOwoKCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxOwoJCXRlWyAzIF0gPSBhMTEgKiBiMTIgKyBhMTIgKiBiMjIgKyBhMTMgKiBiMzI7CgkJdGVbIDYgXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKCgkJdGVbIDEgXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKCQl0ZVsgNCBdID0gYTIxICogYjEyICsgYTIyICogYjIyICsgYTIzICogYjMyOwoJCXRlWyA3IF0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzM7CgoJCXRlWyAyIF0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CgkJdGVbIDUgXSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKCQl0ZVsgOCBdID0gYTMxICogYjEzICsgYTMyICogYjIzICsgYTMzICogYjMzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJdGVbIDAgXSAqPSBzOyB0ZVsgMyBdICo9IHM7IHRlWyA2IF0gKj0gczsKCQl0ZVsgMSBdICo9IHM7IHRlWyA0IF0gKj0gczsgdGVbIDcgXSAqPSBzOwoJCXRlWyAyIF0gKj0gczsgdGVbIDUgXSAqPSBzOyB0ZVsgOCBdICo9IHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkZXRlcm1pbmFudCgpIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQljb25zdCBhID0gdGVbIDAgXSwgYiA9IHRlWyAxIF0sIGMgPSB0ZVsgMiBdLAoJCQlkID0gdGVbIDMgXSwgZSA9IHRlWyA0IF0sIGYgPSB0ZVsgNSBdLAoJCQlnID0gdGVbIDYgXSwgaCA9IHRlWyA3IF0sIGkgPSB0ZVsgOCBdOwoKCQlyZXR1cm4gYSAqIGUgKiBpIC0gYSAqIGYgKiBoIC0gYiAqIGQgKiBpICsgYiAqIGYgKiBnICsgYyAqIGQgKiBoIC0gYyAqIGUgKiBnOwoKCX0KCglpbnZlcnQoKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50cywKCgkJCW4xMSA9IHRlWyAwIF0sIG4yMSA9IHRlWyAxIF0sIG4zMSA9IHRlWyAyIF0sCgkJCW4xMiA9IHRlWyAzIF0sIG4yMiA9IHRlWyA0IF0sIG4zMiA9IHRlWyA1IF0sCgkJCW4xMyA9IHRlWyA2IF0sIG4yMyA9IHRlWyA3IF0sIG4zMyA9IHRlWyA4IF0sCgoJCQl0MTEgPSBuMzMgKiBuMjIgLSBuMzIgKiBuMjMsCgkJCXQxMiA9IG4zMiAqIG4xMyAtIG4zMyAqIG4xMiwKCQkJdDEzID0gbjIzICogbjEyIC0gbjIyICogbjEzLAoKCQkJZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzOwoKCQlpZiAoIGRldCA9PT0gMCApIHJldHVybiB0aGlzLnNldCggMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCApOwoKCQljb25zdCBkZXRJbnYgPSAxIC8gZGV0OwoKCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwoJCXRlWyAxIF0gPSAoIG4zMSAqIG4yMyAtIG4zMyAqIG4yMSApICogZGV0SW52OwoJCXRlWyAyIF0gPSAoIG4zMiAqIG4yMSAtIG4zMSAqIG4yMiApICogZGV0SW52OwoKCQl0ZVsgMyBdID0gdDEyICogZGV0SW52OwoJCXRlWyA0IF0gPSAoIG4zMyAqIG4xMSAtIG4zMSAqIG4xMyApICogZGV0SW52OwoJCXRlWyA1IF0gPSAoIG4zMSAqIG4xMiAtIG4zMiAqIG4xMSApICogZGV0SW52OwoKCQl0ZVsgNiBdID0gdDEzICogZGV0SW52OwoJCXRlWyA3IF0gPSAoIG4yMSAqIG4xMyAtIG4yMyAqIG4xMSApICogZGV0SW52OwoJCXRlWyA4IF0gPSAoIG4yMiAqIG4xMSAtIG4yMSAqIG4xMiApICogZGV0SW52OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdHJhbnNwb3NlKCkgewoKCQlsZXQgdG1wOwoJCWNvbnN0IG0gPSB0aGlzLmVsZW1lbnRzOwoKCQl0bXAgPSBtWyAxIF07IG1bIDEgXSA9IG1bIDMgXTsgbVsgMyBdID0gdG1wOwoJCXRtcCA9IG1bIDIgXTsgbVsgMiBdID0gbVsgNiBdOyBtWyA2IF0gPSB0bXA7CgkJdG1wID0gbVsgNSBdOyBtWyA1IF0gPSBtWyA3IF07IG1bIDcgXSA9IHRtcDsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldE5vcm1hbE1hdHJpeCggbWF0cml4NCApIHsKCgkJcmV0dXJuIHRoaXMuc2V0RnJvbU1hdHJpeDQoIG1hdHJpeDQgKS5pbnZlcnQoKS50cmFuc3Bvc2UoKTsKCgl9CgoJdHJhbnNwb3NlSW50b0FycmF5KCByICkgewoKCQljb25zdCBtID0gdGhpcy5lbGVtZW50czsKCgkJclsgMCBdID0gbVsgMCBdOwoJCXJbIDEgXSA9IG1bIDMgXTsKCQlyWyAyIF0gPSBtWyA2IF07CgkJclsgMyBdID0gbVsgMSBdOwoJCXJbIDQgXSA9IG1bIDQgXTsKCQlyWyA1IF0gPSBtWyA3IF07CgkJclsgNiBdID0gbVsgMiBdOwoJCXJbIDcgXSA9IG1bIDUgXTsKCQlyWyA4IF0gPSBtWyA4IF07CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRVdlRyYW5zZm9ybSggdHgsIHR5LCBzeCwgc3ksIHJvdGF0aW9uLCBjeCwgY3kgKSB7CgoJCWNvbnN0IGMgPSBNYXRoLmNvcyggcm90YXRpb24gKTsKCQljb25zdCBzID0gTWF0aC5zaW4oIHJvdGF0aW9uICk7CgoJCXRoaXMuc2V0KAoJCQlzeCAqIGMsIHN4ICogcywgLSBzeCAqICggYyAqIGN4ICsgcyAqIGN5ICkgKyBjeCArIHR4LAoJCQktIHN5ICogcywgc3kgKiBjLCAtIHN5ICogKCAtIHMgKiBjeCArIGMgKiBjeSApICsgY3kgKyB0eSwKCQkJMCwgMCwgMQoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgkvLwoKCXNjYWxlKCBzeCwgc3kgKSB7CgoJCXRoaXMucHJlbXVsdGlwbHkoIF9tMy5tYWtlU2NhbGUoIHN4LCBzeSApICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyb3RhdGUoIHRoZXRhICkgewoKCQl0aGlzLnByZW11bHRpcGx5KCBfbTMubWFrZVJvdGF0aW9uKCAtIHRoZXRhICkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyYW5zbGF0ZSggdHgsIHR5ICkgewoKCQl0aGlzLnByZW11bHRpcGx5KCBfbTMubWFrZVRyYW5zbGF0aW9uKCB0eCwgdHkgKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gZm9yIDJEIFRyYW5zZm9ybXMKCgltYWtlVHJhbnNsYXRpb24oIHgsIHkgKSB7CgoJCWlmICggeC5pc1ZlY3RvcjIgKSB7CgoJCQl0aGlzLnNldCgKCgkJCQkxLCAwLCB4LngsCgkJCQkwLCAxLCB4LnksCgkJCQkwLCAwLCAxCgoJCQkpOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5zZXQoCgoJCQkJMSwgMCwgeCwKCQkJCTAsIDEsIHksCgkJCQkwLCAwLCAxCgoJCQkpOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb24oIHRoZXRhICkgewoKCQkvLyBjb3VudGVyY2xvY2t3aXNlCgoJCWNvbnN0IGMgPSBNYXRoLmNvcyggdGhldGEgKTsKCQljb25zdCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCXRoaXMuc2V0KAoKCQkJYywgLSBzLCAwLAoJCQlzLCBjLCAwLAoJCQkwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlU2NhbGUoIHgsIHkgKSB7CgoJCXRoaXMuc2V0KAoKCQkJeCwgMCwgMCwKCQkJMCwgeSwgMCwKCQkJMCwgMCwgMQoKCQkpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8KCgllcXVhbHMoIG1hdHJpeCApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCWNvbnN0IG1lID0gbWF0cml4LmVsZW1lbnRzOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJaWYgKCB0ZVsgaSBdICE9PSBtZVsgaSBdICkgcmV0dXJuIGZhbHNlOwoKCQl9CgoJCXJldHVybiB0cnVlOwoKCX0KCglmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJdGhpcy5lbGVtZW50c1sgaSBdID0gYXJyYXlbIGkgKyBvZmZzZXQgXTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQlhcnJheVsgb2Zmc2V0IF0gPSB0ZVsgMCBdOwoJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0ZVsgMSBdOwoJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0ZVsgMiBdOwoKCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGVbIDMgXTsKCQlhcnJheVsgb2Zmc2V0ICsgNCBdID0gdGVbIDQgXTsKCQlhcnJheVsgb2Zmc2V0ICsgNSBdID0gdGVbIDUgXTsKCgkJYXJyYXlbIG9mZnNldCArIDYgXSA9IHRlWyA2IF07CgkJYXJyYXlbIG9mZnNldCArIDcgXSA9IHRlWyA3IF07CgkJYXJyYXlbIG9mZnNldCArIDggXSA9IHRlWyA4IF07CgoJCXJldHVybiBhcnJheTsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmZyb21BcnJheSggdGhpcy5lbGVtZW50cyApOwoKCX0KCn0KCmNvbnN0IF9tMyA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKTsKCmZ1bmN0aW9uIGFycmF5TmVlZHNVaW50MzIoIGFycmF5ICkgewoKCS8vIGFzc3VtZXMgbGFyZ2VyIHZhbHVlcyB1c3VhbGx5IG9uIGxhc3QKCglmb3IgKCBsZXQgaSA9IGFycmF5Lmxlbmd0aCAtIDE7IGkgPj0gMDsgLS0gaSApIHsKCgkJaWYgKCBhcnJheVsgaSBdID49IDY1NTM1ICkgcmV0dXJuIHRydWU7IC8vIGFjY291bnQgZm9yIFBSSU1JVElWRV9SRVNUQVJUX0ZJWEVEX0lOREVYLCAjMjQ1NjUKCgl9CgoJcmV0dXJuIGZhbHNlOwoKfQoKY29uc3QgVFlQRURfQVJSQVlTID0gewoJSW50OEFycmF5OiBJbnQ4QXJyYXksCglVaW50OEFycmF5OiBVaW50OEFycmF5LAoJVWludDhDbGFtcGVkQXJyYXk6IFVpbnQ4Q2xhbXBlZEFycmF5LAoJSW50MTZBcnJheTogSW50MTZBcnJheSwKCVVpbnQxNkFycmF5OiBVaW50MTZBcnJheSwKCUludDMyQXJyYXk6IEludDMyQXJyYXksCglVaW50MzJBcnJheTogVWludDMyQXJyYXksCglGbG9hdDMyQXJyYXk6IEZsb2F0MzJBcnJheSwKCUZsb2F0NjRBcnJheTogRmxvYXQ2NEFycmF5Cn07CgpmdW5jdGlvbiBnZXRUeXBlZEFycmF5KCB0eXBlLCBidWZmZXIgKSB7CgoJcmV0dXJuIG5ldyBUWVBFRF9BUlJBWVNbIHR5cGUgXSggYnVmZmVyICk7Cgp9CgpmdW5jdGlvbiBjcmVhdGVFbGVtZW50TlMoIG5hbWUgKSB7CgoJcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyggJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwnLCBuYW1lICk7Cgp9CgpmdW5jdGlvbiBjcmVhdGVDYW52YXNFbGVtZW50KCkgewoKCWNvbnN0IGNhbnZhcyA9IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCWNhbnZhcy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCXJldHVybiBjYW52YXM7Cgp9Cgpjb25zdCBfY2FjaGUgPSB7fTsKCmZ1bmN0aW9uIHdhcm5PbmNlKCBtZXNzYWdlICkgewoKCWlmICggbWVzc2FnZSBpbiBfY2FjaGUgKSByZXR1cm47CgoJX2NhY2hlWyBtZXNzYWdlIF0gPSB0cnVlOwoKCWNvbnNvbGUud2FybiggbWVzc2FnZSApOwoKfQoKLyoqCiAqIE1hdHJpY2VzIGNvbnZlcnRpbmcgUDMgPC0+IFJlYy4gNzA5IHByaW1hcmllcywgd2l0aG91dCBnYW11dCBtYXBwaW5nCiAqIG9yIGNsaXBwaW5nLiBCYXNlZCBvbiBXM0Mgc3BlY2lmaWNhdGlvbnMgZm9yIHNSR0IgYW5kIERpc3BsYXkgUDMsCiAqIGFuZCBJQ0Mgc3BlY2lmaWNhdGlvbnMgZm9yIHRoZSBENTAgY29ubmVjdGlvbiBzcGFjZS4gVmFsdWVzIGluL291dAogKiBhcmUgX2xpbmVhcl8gc1JHQiBhbmQgX2xpbmVhcl8gRGlzcGxheSBQMy4KICoKICogTm90ZSB0aGF0IGJvdGggc1JHQiBhbmQgRGlzcGxheSBQMyB1c2UgdGhlIHNSR0IgdHJhbnNmZXIgZnVuY3Rpb25zLgogKgogKiBSZWZlcmVuY2U6CiAqIC0gaHR0cDovL3d3dy5ydXNzZWxsY290dHJlbGwuY29tL3Bob3RvL21hdHJpeENhbGN1bGF0b3IuaHRtCiAqLwoKY29uc3QgTElORUFSX1NSR0JfVE9fTElORUFSX0RJU1BMQVlfUDMgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkuc2V0KAoJMC44MjI0NjIxLCAwLjE3NzUzOCwgMC4wLAoJMC4wMzMxOTQxLCAwLjk2NjgwNTgsIDAuMCwKCTAuMDE3MDgyNywgMC4wNzIzOTc0LCAwLjkxMDUxOTksCik7Cgpjb25zdCBMSU5FQVJfRElTUExBWV9QM19UT19MSU5FQVJfU1JHQiA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKS5zZXQoCgkxLjIyNDk0MDEsIC0gMC4yMjQ5NDA0LCAwLjAsCgktIDAuMDQyMDU2OSwgMS4wNDIwNTcxLCAwLjAsCgktIDAuMDE5NjM3NiwgLSAwLjA3ODYzNjEsIDEuMDk4MjczNQopOwoKLyoqCiAqIERlZmluZXMgc3VwcG9ydGVkIGNvbG9yIHNwYWNlcyBieSB0cmFuc2ZlciBmdW5jdGlvbiBhbmQgcHJpbWFyaWVzLAogKiBhbmQgcHJvdmlkZXMgY29udmVyc2lvbnMgdG8vZnJvbSB0aGUgTGluZWFyLXNSR0IgcmVmZXJlbmNlIHNwYWNlLgogKi8KY29uc3QgQ09MT1JfU1BBQ0VTID0gewoJWyBMaW5lYXJTUkdCQ29sb3JTcGFjZSBdOiB7CgkJdHJhbnNmZXI6IExpbmVhclRyYW5zZmVyLAoJCXByaW1hcmllczogUmVjNzA5UHJpbWFyaWVzLAoJCXRvUmVmZXJlbmNlOiAoIGNvbG9yICkgPT4gY29sb3IsCgkJZnJvbVJlZmVyZW5jZTogKCBjb2xvciApID0+IGNvbG9yLAoJfSwKCVsgU1JHQkNvbG9yU3BhY2UgXTogewoJCXRyYW5zZmVyOiBTUkdCVHJhbnNmZXIsCgkJcHJpbWFyaWVzOiBSZWM3MDlQcmltYXJpZXMsCgkJdG9SZWZlcmVuY2U6ICggY29sb3IgKSA9PiBjb2xvci5jb252ZXJ0U1JHQlRvTGluZWFyKCksCgkJZnJvbVJlZmVyZW5jZTogKCBjb2xvciApID0+IGNvbG9yLmNvbnZlcnRMaW5lYXJUb1NSR0IoKSwKCX0sCglbIExpbmVhckRpc3BsYXlQM0NvbG9yU3BhY2UgXTogewoJCXRyYW5zZmVyOiBMaW5lYXJUcmFuc2ZlciwKCQlwcmltYXJpZXM6IFAzUHJpbWFyaWVzLAoJCXRvUmVmZXJlbmNlOiAoIGNvbG9yICkgPT4gY29sb3IuYXBwbHlNYXRyaXgzKCBMSU5FQVJfRElTUExBWV9QM19UT19MSU5FQVJfU1JHQiApLAoJCWZyb21SZWZlcmVuY2U6ICggY29sb3IgKSA9PiBjb2xvci5hcHBseU1hdHJpeDMoIExJTkVBUl9TUkdCX1RPX0xJTkVBUl9ESVNQTEFZX1AzICksCgl9LAoJWyBEaXNwbGF5UDNDb2xvclNwYWNlIF06IHsKCQl0cmFuc2ZlcjogU1JHQlRyYW5zZmVyLAoJCXByaW1hcmllczogUDNQcmltYXJpZXMsCgkJdG9SZWZlcmVuY2U6ICggY29sb3IgKSA9PiBjb2xvci5jb252ZXJ0U1JHQlRvTGluZWFyKCkuYXBwbHlNYXRyaXgzKCBMSU5FQVJfRElTUExBWV9QM19UT19MSU5FQVJfU1JHQiApLAoJCWZyb21SZWZlcmVuY2U6ICggY29sb3IgKSA9PiBjb2xvci5hcHBseU1hdHJpeDMoIExJTkVBUl9TUkdCX1RPX0xJTkVBUl9ESVNQTEFZX1AzICkuY29udmVydExpbmVhclRvU1JHQigpLAoJfSwKfTsKCmNvbnN0IFNVUFBPUlRFRF9XT1JLSU5HX0NPTE9SX1NQQUNFUyA9IG5ldyBTZXQoIFsgTGluZWFyU1JHQkNvbG9yU3BhY2UsIExpbmVhckRpc3BsYXlQM0NvbG9yU3BhY2UgXSApOwoKY29uc3QgQ29sb3JNYW5hZ2VtZW50ID0gewoKCWVuYWJsZWQ6IHRydWUsCgoJX3dvcmtpbmdDb2xvclNwYWNlOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSwKCglnZXQgd29ya2luZ0NvbG9yU3BhY2UoKSB7CgoJCXJldHVybiB0aGlzLl93b3JraW5nQ29sb3JTcGFjZTsKCgl9LAoKCXNldCB3b3JraW5nQ29sb3JTcGFjZSggY29sb3JTcGFjZSApIHsKCgkJaWYgKCAhIFNVUFBPUlRFRF9XT1JLSU5HX0NPTE9SX1NQQUNFUy5oYXMoIGNvbG9yU3BhY2UgKSApIHsKCgkJCXRocm93IG5ldyBFcnJvciggYFVuc3VwcG9ydGVkIHdvcmtpbmcgY29sb3Igc3BhY2UsICIkeyBjb2xvclNwYWNlIH0iLmAgKTsKCgkJfQoKCQl0aGlzLl93b3JraW5nQ29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CgoJfSwKCgljb252ZXJ0OiBmdW5jdGlvbiAoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlLCB0YXJnZXRDb2xvclNwYWNlICkgewoKCQlpZiAoIHRoaXMuZW5hYmxlZCA9PT0gZmFsc2UgfHwgc291cmNlQ29sb3JTcGFjZSA9PT0gdGFyZ2V0Q29sb3JTcGFjZSB8fCAhIHNvdXJjZUNvbG9yU3BhY2UgfHwgISB0YXJnZXRDb2xvclNwYWNlICkgewoKCQkJcmV0dXJuIGNvbG9yOwoKCQl9CgoJCWNvbnN0IHNvdXJjZVRvUmVmZXJlbmNlID0gQ09MT1JfU1BBQ0VTWyBzb3VyY2VDb2xvclNwYWNlIF0udG9SZWZlcmVuY2U7CgkJY29uc3QgdGFyZ2V0RnJvbVJlZmVyZW5jZSA9IENPTE9SX1NQQUNFU1sgdGFyZ2V0Q29sb3JTcGFjZSBdLmZyb21SZWZlcmVuY2U7CgoJCXJldHVybiB0YXJnZXRGcm9tUmVmZXJlbmNlKCBzb3VyY2VUb1JlZmVyZW5jZSggY29sb3IgKSApOwoKCX0sCgoJZnJvbVdvcmtpbmdDb2xvclNwYWNlOiBmdW5jdGlvbiAoIGNvbG9yLCB0YXJnZXRDb2xvclNwYWNlICkgewoKCQlyZXR1cm4gdGhpcy5jb252ZXJ0KCBjb2xvciwgdGhpcy5fd29ya2luZ0NvbG9yU3BhY2UsIHRhcmdldENvbG9yU3BhY2UgKTsKCgl9LAoKCXRvV29ya2luZ0NvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3IsIHNvdXJjZUNvbG9yU3BhY2UgKSB7CgoJCXJldHVybiB0aGlzLmNvbnZlcnQoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlLCB0aGlzLl93b3JraW5nQ29sb3JTcGFjZSApOwoKCX0sCgoJZ2V0UHJpbWFyaWVzOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgKSB7CgoJCXJldHVybiBDT0xPUl9TUEFDRVNbIGNvbG9yU3BhY2UgXS5wcmltYXJpZXM7CgoJfSwKCglnZXRUcmFuc2ZlcjogZnVuY3Rpb24gKCBjb2xvclNwYWNlICkgewoKCQlpZiAoIGNvbG9yU3BhY2UgPT09IE5vQ29sb3JTcGFjZSApIHJldHVybiBMaW5lYXJUcmFuc2ZlcjsKCgkJcmV0dXJuIENPTE9SX1NQQUNFU1sgY29sb3JTcGFjZSBdLnRyYW5zZmVyOwoKCX0sCgp9OwoKCmZ1bmN0aW9uIFNSR0JUb0xpbmVhciggYyApIHsKCglyZXR1cm4gKCBjIDwgMC4wNDA0NSApID8gYyAqIDAuMDc3Mzk5MzgwOCA6IE1hdGgucG93KCBjICogMC45NDc4NjcyOTg2ICsgMC4wNTIxMzI3MDE0LCAyLjQgKTsKCn0KCmZ1bmN0aW9uIExpbmVhclRvU1JHQiggYyApIHsKCglyZXR1cm4gKCBjIDwgMC4wMDMxMzA4ICkgPyBjICogMTIuOTIgOiAxLjA1NSAqICggTWF0aC5wb3coIGMsIDAuNDE2NjYgKSApIC0gMC4wNTU7Cgp9CgpsZXQgX2NhbnZhczsKCmNsYXNzIEltYWdlVXRpbHMgewoKCXN0YXRpYyBnZXREYXRhVVJMKCBpbWFnZSApIHsKCgkJaWYgKCAvXmRhdGE6L2kudGVzdCggaW1hZ2Uuc3JjICkgKSB7CgoJCQlyZXR1cm4gaW1hZ2Uuc3JjOwoKCQl9CgoJCWlmICggdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ID09PSAndW5kZWZpbmVkJyApIHsKCgkJCXJldHVybiBpbWFnZS5zcmM7CgoJCX0KCgkJbGV0IGNhbnZhczsKCgkJaWYgKCBpbWFnZSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50ICkgewoKCQkJY2FudmFzID0gaW1hZ2U7CgoJCX0gZWxzZSB7CgoJCQlpZiAoIF9jYW52YXMgPT09IHVuZGVmaW5lZCApIF9jYW52YXMgPSBjcmVhdGVFbGVtZW50TlMoICdjYW52YXMnICk7CgoJCQlfY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CgkJCV9jYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKCQkJY29uc3QgY29udGV4dCA9IF9jYW52YXMuZ2V0Q29udGV4dCggJzJkJyApOwoKCQkJaWYgKCBpbWFnZSBpbnN0YW5jZW9mIEltYWdlRGF0YSApIHsKCgkJCQljb250ZXh0LnB1dEltYWdlRGF0YSggaW1hZ2UsIDAsIDAgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQl9CgoJCQljYW52YXMgPSBfY2FudmFzOwoKCQl9CgoJCWlmICggY2FudmFzLndpZHRoID4gMjA0OCB8fCBjYW52YXMuaGVpZ2h0ID4gMjA0OCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkltYWdlVXRpbHMuZ2V0RGF0YVVSTDogSW1hZ2UgY29udmVydGVkIHRvIGpwZyBmb3IgcGVyZm9ybWFuY2UgcmVhc29ucycsIGltYWdlICk7CgoJCQlyZXR1cm4gY2FudmFzLnRvRGF0YVVSTCggJ2ltYWdlL2pwZWcnLCAwLjYgKTsKCgkJfSBlbHNlIHsKCgkJCXJldHVybiBjYW52YXMudG9EYXRhVVJMKCAnaW1hZ2UvcG5nJyApOwoKCQl9CgoJfQoKCXN0YXRpYyBzUkdCVG9MaW5lYXIoIGltYWdlICkgewoKCQlpZiAoICggdHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHx8CgkJCSggdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50ICkgfHwKCQkJKCB0eXBlb2YgSW1hZ2VCaXRtYXAgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXAgKSApIHsKCgkJCWNvbnN0IGNhbnZhcyA9IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCgkJCWNhbnZhcy53aWR0aCA9IGltYWdlLndpZHRoOwoJCQljYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKCQkJY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7CgkJCWNvbnRleHQuZHJhd0ltYWdlKCBpbWFnZSwgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKCQkJY29uc3QgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCQkJY29uc3QgZGF0YSA9IGltYWdlRGF0YS5kYXRhOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKysgKSB7CgoJCQkJZGF0YVsgaSBdID0gU1JHQlRvTGluZWFyKCBkYXRhWyBpIF0gLyAyNTUgKSAqIDI1NTsKCgkJCX0KCgkJCWNvbnRleHQucHV0SW1hZ2VEYXRhKCBpbWFnZURhdGEsIDAsIDAgKTsKCgkJCXJldHVybiBjYW52YXM7CgoJCX0gZWxzZSBpZiAoIGltYWdlLmRhdGEgKSB7CgoJCQljb25zdCBkYXRhID0gaW1hZ2UuZGF0YS5zbGljZSggMCApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKysgKSB7CgoJCQkJaWYgKCBkYXRhIGluc3RhbmNlb2YgVWludDhBcnJheSB8fCBkYXRhIGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXkgKSB7CgoJCQkJCWRhdGFbIGkgXSA9IE1hdGguZmxvb3IoIFNSR0JUb0xpbmVhciggZGF0YVsgaSBdIC8gMjU1ICkgKiAyNTUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBhc3N1bWluZyBmbG9hdAoKCQkJCQlkYXRhWyBpIF0gPSBTUkdCVG9MaW5lYXIoIGRhdGFbIGkgXSApOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiB7CgkJCQlkYXRhOiBkYXRhLAoJCQkJd2lkdGg6IGltYWdlLndpZHRoLAoJCQkJaGVpZ2h0OiBpbWFnZS5oZWlnaHQKCQkJfTsKCgkJfSBlbHNlIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkltYWdlVXRpbHMuc1JHQlRvTGluZWFyKCk6IFVuc3VwcG9ydGVkIGltYWdlIHR5cGUuIE5vIGNvbG9yIHNwYWNlIGNvbnZlcnNpb24gYXBwbGllZC4nICk7CgkJCXJldHVybiBpbWFnZTsKCgkJfQoKCX0KCn0KCmxldCBfc291cmNlSWQgPSAwOwoKY2xhc3MgU291cmNlIHsKCgljb25zdHJ1Y3RvciggZGF0YSA9IG51bGwgKSB7CgoJCXRoaXMuaXNTb3VyY2UgPSB0cnVlOwoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9zb3VyY2VJZCArKyB9ICk7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQl0aGlzLmRhdGEgPSBkYXRhOwoKCQl0aGlzLnZlcnNpb24gPSAwOwoKCX0KCglzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKCQlpZiAoIHZhbHVlID09PSB0cnVlICkgdGhpcy52ZXJzaW9uICsrOwoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCWNvbnN0IGlzUm9vdE9iamVjdCA9ICggbWV0YSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBtZXRhID09PSAnc3RyaW5nJyApOwoKCQlpZiAoICEgaXNSb290T2JqZWN0ICYmIG1ldGEuaW1hZ2VzWyB0aGlzLnV1aWQgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJcmV0dXJuIG1ldGEuaW1hZ2VzWyB0aGlzLnV1aWQgXTsKCgkJfQoKCQljb25zdCBvdXRwdXQgPSB7CgkJCXV1aWQ6IHRoaXMudXVpZCwKCQkJdXJsOiAnJwoJCX07CgoJCWNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CgoJCWlmICggZGF0YSAhPT0gbnVsbCApIHsKCgkJCWxldCB1cmw7CgoJCQlpZiAoIEFycmF5LmlzQXJyYXkoIGRhdGEgKSApIHsKCgkJCQkvLyBjdWJlIHRleHR1cmUKCgkJCQl1cmwgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBkYXRhLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWlmICggZGF0YVsgaSBdLmlzRGF0YVRleHR1cmUgKSB7CgoJCQkJCQl1cmwucHVzaCggc2VyaWFsaXplSW1hZ2UoIGRhdGFbIGkgXS5pbWFnZSApICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl1cmwucHVzaCggc2VyaWFsaXplSW1hZ2UoIGRhdGFbIGkgXSApICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCS8vIHRleHR1cmUKCgkJCQl1cmwgPSBzZXJpYWxpemVJbWFnZSggZGF0YSApOwoKCQkJfQoKCQkJb3V0cHV0LnVybCA9IHVybDsKCgkJfQoKCQlpZiAoICEgaXNSb290T2JqZWN0ICkgewoKCQkJbWV0YS5pbWFnZXNbIHRoaXMudXVpZCBdID0gb3V0cHV0OwoKCQl9CgoJCXJldHVybiBvdXRwdXQ7CgoJfQoKfQoKZnVuY3Rpb24gc2VyaWFsaXplSW1hZ2UoIGltYWdlICkgewoKCWlmICggKCB0eXBlb2YgSFRNTEltYWdlRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50ICkgfHwKCQkoIHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCApIHx8CgkJKCB0eXBlb2YgSW1hZ2VCaXRtYXAgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXAgKSApIHsKCgkJLy8gZGVmYXVsdCBpbWFnZXMKCgkJcmV0dXJuIEltYWdlVXRpbHMuZ2V0RGF0YVVSTCggaW1hZ2UgKTsKCgl9IGVsc2UgewoKCQlpZiAoIGltYWdlLmRhdGEgKSB7CgoJCQkvLyBpbWFnZXMgb2YgRGF0YVRleHR1cmUKCgkJCXJldHVybiB7CgkJCQlkYXRhOiBBcnJheS5mcm9tKCBpbWFnZS5kYXRhICksCgkJCQl3aWR0aDogaW1hZ2Uud2lkdGgsCgkJCQloZWlnaHQ6IGltYWdlLmhlaWdodCwKCQkJCXR5cGU6IGltYWdlLmRhdGEuY29uc3RydWN0b3IubmFtZQoJCQl9OwoKCQl9IGVsc2UgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVGV4dHVyZTogVW5hYmxlIHRvIHNlcmlhbGl6ZSBUZXh0dXJlLicgKTsKCQkJcmV0dXJuIHt9OwoKCQl9CgoJfQoKfQoKbGV0IF90ZXh0dXJlSWQgPSAwOwoKY2xhc3MgVGV4dHVyZSBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgoJY29uc3RydWN0b3IoIGltYWdlID0gVGV4dHVyZS5ERUZBVUxUX0lNQUdFLCBtYXBwaW5nID0gVGV4dHVyZS5ERUZBVUxUX01BUFBJTkcsIHdyYXBTID0gQ2xhbXBUb0VkZ2VXcmFwcGluZywgd3JhcFQgPSBDbGFtcFRvRWRnZVdyYXBwaW5nLCBtYWdGaWx0ZXIgPSBMaW5lYXJGaWx0ZXIsIG1pbkZpbHRlciA9IExpbmVhck1pcG1hcExpbmVhckZpbHRlciwgZm9ybWF0ID0gUkdCQUZvcm1hdCwgdHlwZSA9IFVuc2lnbmVkQnl0ZVR5cGUsIGFuaXNvdHJvcHkgPSBUZXh0dXJlLkRFRkFVTFRfQU5JU09UUk9QWSwgY29sb3JTcGFjZSA9IE5vQ29sb3JTcGFjZSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1RleHR1cmUgPSB0cnVlOwoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF90ZXh0dXJlSWQgKysgfSApOwoKCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJdGhpcy5uYW1lID0gJyc7CgoJCXRoaXMuc291cmNlID0gbmV3IFNvdXJjZSggaW1hZ2UgKTsKCQl0aGlzLm1pcG1hcHMgPSBbXTsKCgkJdGhpcy5tYXBwaW5nID0gbWFwcGluZzsKCQl0aGlzLmNoYW5uZWwgPSAwOwoKCQl0aGlzLndyYXBTID0gd3JhcFM7CgkJdGhpcy53cmFwVCA9IHdyYXBUOwoKCQl0aGlzLm1hZ0ZpbHRlciA9IG1hZ0ZpbHRlcjsKCQl0aGlzLm1pbkZpbHRlciA9IG1pbkZpbHRlcjsKCgkJdGhpcy5hbmlzb3Ryb3B5ID0gYW5pc290cm9weTsKCgkJdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CgkJdGhpcy5pbnRlcm5hbEZvcm1hdCA9IG51bGw7CgkJdGhpcy50eXBlID0gdHlwZTsKCgkJdGhpcy5vZmZzZXQgPSBuZXcgVmVjdG9yMiggMCwgMCApOwoJCXRoaXMucmVwZWF0ID0gbmV3IFZlY3RvcjIoIDEsIDEgKTsKCQl0aGlzLmNlbnRlciA9IG5ldyBWZWN0b3IyKCAwLCAwICk7CgkJdGhpcy5yb3RhdGlvbiA9IDA7CgoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHRydWU7CgkJdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4MygpOwoKCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IHRydWU7CgkJdGhpcy5wcmVtdWx0aXBseUFscGhhID0gZmFsc2U7CgkJdGhpcy5mbGlwWSA9IHRydWU7CgkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSA0OwkvLyB2YWxpZCB2YWx1ZXM6IDEsIDIsIDQsIDggKHNlZSBodHRwOi8vd3d3Lmtocm9ub3Mub3JnL29wZW5nbGVzL3Nkay9kb2NzL21hbi94aHRtbC9nbFBpeGVsU3RvcmVpLnhtbCkKCgkJaWYgKCB0eXBlb2YgY29sb3JTcGFjZSA9PT0gJ3N0cmluZycgKSB7CgoJCQl0aGlzLmNvbG9yU3BhY2UgPSBjb2xvclNwYWNlOwoKCQl9IGVsc2UgeyAvLyBAZGVwcmVjYXRlZCwgcjE1MgoKCQkJd2Fybk9uY2UoICdUSFJFRS5UZXh0dXJlOiBQcm9wZXJ0eSAuZW5jb2RpbmcgaGFzIGJlZW4gcmVwbGFjZWQgYnkgLmNvbG9yU3BhY2UuJyApOwoJCQl0aGlzLmNvbG9yU3BhY2UgPSBjb2xvclNwYWNlID09PSBzUkdCRW5jb2RpbmcgPyBTUkdCQ29sb3JTcGFjZSA6IE5vQ29sb3JTcGFjZTsKCgkJfQoKCgkJdGhpcy51c2VyRGF0YSA9IHt9OwoKCQl0aGlzLnZlcnNpb24gPSAwOwoJCXRoaXMub25VcGRhdGUgPSBudWxsOwoKCQl0aGlzLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9IGZhbHNlOyAvLyBpbmRpY2F0ZXMgd2hldGhlciBhIHRleHR1cmUgYmVsb25ncyB0byBhIHJlbmRlciB0YXJnZXQgb3Igbm90CgkJdGhpcy5uZWVkc1BNUkVNVXBkYXRlID0gZmFsc2U7IC8vIGluZGljYXRlcyB3aGV0aGVyIHRoaXMgdGV4dHVyZSBzaG91bGQgYmUgcHJvY2Vzc2VkIGJ5IFBNUkVNR2VuZXJhdG9yIG9yIG5vdCAob25seSByZWxldmFudCBmb3IgcmVuZGVyIHRhcmdldCB0ZXh0dXJlcykKCgl9CgoJZ2V0IGltYWdlKCkgewoKCQlyZXR1cm4gdGhpcy5zb3VyY2UuZGF0YTsKCgl9CgoJc2V0IGltYWdlKCB2YWx1ZSA9IG51bGwgKSB7CgoJCXRoaXMuc291cmNlLmRhdGEgPSB2YWx1ZTsKCgl9CgoJdXBkYXRlTWF0cml4KCkgewoKCQl0aGlzLm1hdHJpeC5zZXRVdlRyYW5zZm9ybSggdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueSwgdGhpcy5yZXBlYXQueCwgdGhpcy5yZXBlYXQueSwgdGhpcy5yb3RhdGlvbiwgdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSApOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwoKCQl0aGlzLnNvdXJjZSA9IHNvdXJjZS5zb3VyY2U7CgkJdGhpcy5taXBtYXBzID0gc291cmNlLm1pcG1hcHMuc2xpY2UoIDAgKTsKCgkJdGhpcy5tYXBwaW5nID0gc291cmNlLm1hcHBpbmc7CgkJdGhpcy5jaGFubmVsID0gc291cmNlLmNoYW5uZWw7CgoJCXRoaXMud3JhcFMgPSBzb3VyY2Uud3JhcFM7CgkJdGhpcy53cmFwVCA9IHNvdXJjZS53cmFwVDsKCgkJdGhpcy5tYWdGaWx0ZXIgPSBzb3VyY2UubWFnRmlsdGVyOwoJCXRoaXMubWluRmlsdGVyID0gc291cmNlLm1pbkZpbHRlcjsKCgkJdGhpcy5hbmlzb3Ryb3B5ID0gc291cmNlLmFuaXNvdHJvcHk7CgoJCXRoaXMuZm9ybWF0ID0gc291cmNlLmZvcm1hdDsKCQl0aGlzLmludGVybmFsRm9ybWF0ID0gc291cmNlLmludGVybmFsRm9ybWF0OwoJCXRoaXMudHlwZSA9IHNvdXJjZS50eXBlOwoKCQl0aGlzLm9mZnNldC5jb3B5KCBzb3VyY2Uub2Zmc2V0ICk7CgkJdGhpcy5yZXBlYXQuY29weSggc291cmNlLnJlcGVhdCApOwoJCXRoaXMuY2VudGVyLmNvcHkoIHNvdXJjZS5jZW50ZXIgKTsKCQl0aGlzLnJvdGF0aW9uID0gc291cmNlLnJvdGF0aW9uOwoKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCQl0aGlzLm1hdHJpeC5jb3B5KCBzb3VyY2UubWF0cml4ICk7CgoJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gc291cmNlLmdlbmVyYXRlTWlwbWFwczsKCQl0aGlzLnByZW11bHRpcGx5QWxwaGEgPSBzb3VyY2UucHJlbXVsdGlwbHlBbHBoYTsKCQl0aGlzLmZsaXBZID0gc291cmNlLmZsaXBZOwoJCXRoaXMudW5wYWNrQWxpZ25tZW50ID0gc291cmNlLnVucGFja0FsaWdubWVudDsKCQl0aGlzLmNvbG9yU3BhY2UgPSBzb3VyY2UuY29sb3JTcGFjZTsKCgkJdGhpcy51c2VyRGF0YSA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBzb3VyY2UudXNlckRhdGEgKSApOwoKCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJY29uc3QgaXNSb290T2JqZWN0ID0gKCBtZXRhID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG1ldGEgPT09ICdzdHJpbmcnICk7CgoJCWlmICggISBpc1Jvb3RPYmplY3QgJiYgbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF0gIT09IHVuZGVmaW5lZCApIHsKCgkJCXJldHVybiBtZXRhLnRleHR1cmVzWyB0aGlzLnV1aWQgXTsKCgkJfQoKCQljb25zdCBvdXRwdXQgPSB7CgoJCQltZXRhZGF0YTogewoJCQkJdmVyc2lvbjogNC42LAoJCQkJdHlwZTogJ1RleHR1cmUnLAoJCQkJZ2VuZXJhdG9yOiAnVGV4dHVyZS50b0pTT04nCgkJCX0sCgoJCQl1dWlkOiB0aGlzLnV1aWQsCgkJCW5hbWU6IHRoaXMubmFtZSwKCgkJCWltYWdlOiB0aGlzLnNvdXJjZS50b0pTT04oIG1ldGEgKS51dWlkLAoKCQkJbWFwcGluZzogdGhpcy5tYXBwaW5nLAoJCQljaGFubmVsOiB0aGlzLmNoYW5uZWwsCgoJCQlyZXBlYXQ6IFsgdGhpcy5yZXBlYXQueCwgdGhpcy5yZXBlYXQueSBdLAoJCQlvZmZzZXQ6IFsgdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueSBdLAoJCQljZW50ZXI6IFsgdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSBdLAoJCQlyb3RhdGlvbjogdGhpcy5yb3RhdGlvbiwKCgkJCXdyYXA6IFsgdGhpcy53cmFwUywgdGhpcy53cmFwVCBdLAoKCQkJZm9ybWF0OiB0aGlzLmZvcm1hdCwKCQkJaW50ZXJuYWxGb3JtYXQ6IHRoaXMuaW50ZXJuYWxGb3JtYXQsCgkJCXR5cGU6IHRoaXMudHlwZSwKCQkJY29sb3JTcGFjZTogdGhpcy5jb2xvclNwYWNlLAoKCQkJbWluRmlsdGVyOiB0aGlzLm1pbkZpbHRlciwKCQkJbWFnRmlsdGVyOiB0aGlzLm1hZ0ZpbHRlciwKCQkJYW5pc290cm9weTogdGhpcy5hbmlzb3Ryb3B5LAoKCQkJZmxpcFk6IHRoaXMuZmxpcFksCgoJCQlnZW5lcmF0ZU1pcG1hcHM6IHRoaXMuZ2VuZXJhdGVNaXBtYXBzLAoJCQlwcmVtdWx0aXBseUFscGhhOiB0aGlzLnByZW11bHRpcGx5QWxwaGEsCgkJCXVucGFja0FsaWdubWVudDogdGhpcy51bnBhY2tBbGlnbm1lbnQKCgkJfTsKCgkJaWYgKCBPYmplY3Qua2V5cyggdGhpcy51c2VyRGF0YSApLmxlbmd0aCA+IDAgKSBvdXRwdXQudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKCQlpZiAoICEgaXNSb290T2JqZWN0ICkgewoKCQkJbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF0gPSBvdXRwdXQ7CgoJCX0KCgkJcmV0dXJuIG91dHB1dDsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgoJfQoKCXRyYW5zZm9ybVV2KCB1diApIHsKCgkJaWYgKCB0aGlzLm1hcHBpbmcgIT09IFVWTWFwcGluZyApIHJldHVybiB1djsKCgkJdXYuYXBwbHlNYXRyaXgzKCB0aGlzLm1hdHJpeCApOwoKCQlpZiAoIHV2LnggPCAwIHx8IHV2LnggPiAxICkgewoKCQkJc3dpdGNoICggdGhpcy53cmFwUyApIHsKCgkJCQljYXNlIFJlcGVhdFdyYXBwaW5nOgoKCQkJCQl1di54ID0gdXYueCAtIE1hdGguZmxvb3IoIHV2LnggKTsKCQkJCQlicmVhazsKCgkJCQljYXNlIENsYW1wVG9FZGdlV3JhcHBpbmc6CgoJCQkJCXV2LnggPSB1di54IDwgMCA/IDAgOiAxOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgTWlycm9yZWRSZXBlYXRXcmFwcGluZzoKCgkJCQkJaWYgKCBNYXRoLmFicyggTWF0aC5mbG9vciggdXYueCApICUgMiApID09PSAxICkgewoKCQkJCQkJdXYueCA9IE1hdGguY2VpbCggdXYueCApIC0gdXYueDsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXV2LnggPSB1di54IC0gTWF0aC5mbG9vciggdXYueCApOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCWlmICggdXYueSA8IDAgfHwgdXYueSA+IDEgKSB7CgoJCQlzd2l0Y2ggKCB0aGlzLndyYXBUICkgewoKCQkJCWNhc2UgUmVwZWF0V3JhcHBpbmc6CgoJCQkJCXV2LnkgPSB1di55IC0gTWF0aC5mbG9vciggdXYueSApOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgQ2xhbXBUb0VkZ2VXcmFwcGluZzoKCgkJCQkJdXYueSA9IHV2LnkgPCAwID8gMCA6IDE7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nOgoKCQkJCQlpZiAoIE1hdGguYWJzKCBNYXRoLmZsb29yKCB1di55ICkgJSAyICkgPT09IDEgKSB7CgoJCQkJCQl1di55ID0gTWF0aC5jZWlsKCB1di55ICkgLSB1di55OwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdXYueSA9IHV2LnkgLSBNYXRoLmZsb29yKCB1di55ICk7CgoJCQkJCX0KCgkJCQkJYnJlYWs7CgoJCQl9CgoJCX0KCgkJaWYgKCB0aGlzLmZsaXBZICkgewoKCQkJdXYueSA9IDEgLSB1di55OwoKCQl9CgoJCXJldHVybiB1djsKCgl9CgoJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCgkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHsKCgkJCXRoaXMudmVyc2lvbiArKzsKCQkJdGhpcy5zb3VyY2UubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9CgoJfQoKCWdldCBlbmNvZGluZygpIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTIKCgkJd2Fybk9uY2UoICdUSFJFRS5UZXh0dXJlOiBQcm9wZXJ0eSAuZW5jb2RpbmcgaGFzIGJlZW4gcmVwbGFjZWQgYnkgLmNvbG9yU3BhY2UuJyApOwoJCXJldHVybiB0aGlzLmNvbG9yU3BhY2UgPT09IFNSR0JDb2xvclNwYWNlID8gc1JHQkVuY29kaW5nIDogTGluZWFyRW5jb2Rpbmc7CgoJfQoKCXNldCBlbmNvZGluZyggZW5jb2RpbmcgKSB7IC8vIEBkZXByZWNhdGVkLCByMTUyCgoJCXdhcm5PbmNlKCAnVEhSRUUuVGV4dHVyZTogUHJvcGVydHkgLmVuY29kaW5nIGhhcyBiZWVuIHJlcGxhY2VkIGJ5IC5jb2xvclNwYWNlLicgKTsKCQl0aGlzLmNvbG9yU3BhY2UgPSBlbmNvZGluZyA9PT0gc1JHQkVuY29kaW5nID8gU1JHQkNvbG9yU3BhY2UgOiBOb0NvbG9yU3BhY2U7CgoJfQoKfQoKVGV4dHVyZS5ERUZBVUxUX0lNQUdFID0gbnVsbDsKVGV4dHVyZS5ERUZBVUxUX01BUFBJTkcgPSBVVk1hcHBpbmc7ClRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZID0gMTsKCmNsYXNzIFZlY3RvcjQgewoKCWNvbnN0cnVjdG9yKCB4ID0gMCwgeSA9IDAsIHogPSAwLCB3ID0gMSApIHsKCgkJVmVjdG9yNC5wcm90b3R5cGUuaXNWZWN0b3I0ID0gdHJ1ZTsKCgkJdGhpcy54ID0geDsKCQl0aGlzLnkgPSB5OwoJCXRoaXMueiA9IHo7CgkJdGhpcy53ID0gdzsKCgl9CgoJZ2V0IHdpZHRoKCkgewoKCQlyZXR1cm4gdGhpcy56OwoKCX0KCglzZXQgd2lkdGgoIHZhbHVlICkgewoKCQl0aGlzLnogPSB2YWx1ZTsKCgl9CgoJZ2V0IGhlaWdodCgpIHsKCgkJcmV0dXJuIHRoaXMudzsKCgl9CgoJc2V0IGhlaWdodCggdmFsdWUgKSB7CgoJCXRoaXMudyA9IHZhbHVlOwoKCX0KCglzZXQoIHgsIHksIHosIHcgKSB7CgoJCXRoaXMueCA9IHg7CgkJdGhpcy55ID0geTsKCQl0aGlzLnogPSB6OwoJCXRoaXMudyA9IHc7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRTY2FsYXIoIHNjYWxhciApIHsKCgkJdGhpcy54ID0gc2NhbGFyOwoJCXRoaXMueSA9IHNjYWxhcjsKCQl0aGlzLnogPSBzY2FsYXI7CgkJdGhpcy53ID0gc2NhbGFyOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WCggeCApIHsKCgkJdGhpcy54ID0geDsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFkoIHkgKSB7CgoJCXRoaXMueSA9IHk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRaKCB6ICkgewoKCQl0aGlzLnogPSB6OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0VyggdyApIHsKCgkJdGhpcy53ID0gdzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldENvbXBvbmVudCggaW5kZXgsIHZhbHVlICkgewoKCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCWNhc2UgMDogdGhpcy54ID0gdmFsdWU7IGJyZWFrOwoJCQljYXNlIDE6IHRoaXMueSA9IHZhbHVlOyBicmVhazsKCQkJY2FzZSAyOiB0aGlzLnogPSB2YWx1ZTsgYnJlYWs7CgkJCWNhc2UgMzogdGhpcy53ID0gdmFsdWU7IGJyZWFrOwoJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRDb21wb25lbnQoIGluZGV4ICkgewoKCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCWNhc2UgMDogcmV0dXJuIHRoaXMueDsKCQkJY2FzZSAxOiByZXR1cm4gdGhpcy55OwoJCQljYXNlIDI6IHJldHVybiB0aGlzLno7CgkJCWNhc2UgMzogcmV0dXJuIHRoaXMudzsKCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJfQoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncgKTsKCgl9CgoJY29weSggdiApIHsKCgkJdGhpcy54ID0gdi54OwoJCXRoaXMueSA9IHYueTsKCQl0aGlzLnogPSB2Lno7CgkJdGhpcy53ID0gKCB2LncgIT09IHVuZGVmaW5lZCApID8gdi53IDogMTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZCggdiApIHsKCgkJdGhpcy54ICs9IHYueDsKCQl0aGlzLnkgKz0gdi55OwoJCXRoaXMueiArPSB2Lno7CgkJdGhpcy53ICs9IHYudzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZFNjYWxhciggcyApIHsKCgkJdGhpcy54ICs9IHM7CgkJdGhpcy55ICs9IHM7CgkJdGhpcy56ICs9IHM7CgkJdGhpcy53ICs9IHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRWZWN0b3JzKCBhLCBiICkgewoKCQl0aGlzLnggPSBhLnggKyBiLng7CgkJdGhpcy55ID0gYS55ICsgYi55OwoJCXRoaXMueiA9IGEueiArIGIuejsKCQl0aGlzLncgPSBhLncgKyBiLnc7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRTY2FsZWRWZWN0b3IoIHYsIHMgKSB7CgoJCXRoaXMueCArPSB2LnggKiBzOwoJCXRoaXMueSArPSB2LnkgKiBzOwoJCXRoaXMueiArPSB2LnogKiBzOwoJCXRoaXMudyArPSB2LncgKiBzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3ViKCB2ICkgewoKCQl0aGlzLnggLT0gdi54OwoJCXRoaXMueSAtPSB2Lnk7CgkJdGhpcy56IC09IHYuejsKCQl0aGlzLncgLT0gdi53OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3ViU2NhbGFyKCBzICkgewoKCQl0aGlzLnggLT0gczsKCQl0aGlzLnkgLT0gczsKCQl0aGlzLnogLT0gczsKCQl0aGlzLncgLT0gczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN1YlZlY3RvcnMoIGEsIGIgKSB7CgoJCXRoaXMueCA9IGEueCAtIGIueDsKCQl0aGlzLnkgPSBhLnkgLSBiLnk7CgkJdGhpcy56ID0gYS56IC0gYi56OwoJCXRoaXMudyA9IGEudyAtIGIudzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5KCB2ICkgewoKCQl0aGlzLnggKj0gdi54OwoJCXRoaXMueSAqPSB2Lnk7CgkJdGhpcy56ICo9IHYuejsKCQl0aGlzLncgKj0gdi53OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbXVsdGlwbHlTY2FsYXIoIHNjYWxhciApIHsKCgkJdGhpcy54ICo9IHNjYWxhcjsKCQl0aGlzLnkgKj0gc2NhbGFyOwoJCXRoaXMueiAqPSBzY2FsYXI7CgkJdGhpcy53ICo9IHNjYWxhcjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5TWF0cml4NCggbSApIHsKCgkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMueiwgdyA9IHRoaXMudzsKCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA4IF0gKiB6ICsgZVsgMTIgXSAqIHc7CgkJdGhpcy55ID0gZVsgMSBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA5IF0gKiB6ICsgZVsgMTMgXSAqIHc7CgkJdGhpcy56ID0gZVsgMiBdICogeCArIGVbIDYgXSAqIHkgKyBlWyAxMCBdICogeiArIGVbIDE0IF0gKiB3OwoJCXRoaXMudyA9IGVbIDMgXSAqIHggKyBlWyA3IF0gKiB5ICsgZVsgMTEgXSAqIHogKyBlWyAxNSBdICogdzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpdmlkZVNjYWxhciggc2NhbGFyICkgewoKCQlyZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhciggMSAvIHNjYWxhciApOwoKCX0KCglzZXRBeGlzQW5nbGVGcm9tUXVhdGVybmlvbiggcSApIHsKCgkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL3F1YXRlcm5pb25Ub0FuZ2xlL2luZGV4Lmh0bQoKCQkvLyBxIGlzIGFzc3VtZWQgdG8gYmUgbm9ybWFsaXplZAoKCQl0aGlzLncgPSAyICogTWF0aC5hY29zKCBxLncgKTsKCgkJY29uc3QgcyA9IE1hdGguc3FydCggMSAtIHEudyAqIHEudyApOwoKCQlpZiAoIHMgPCAwLjAwMDEgKSB7CgoJCQl0aGlzLnggPSAxOwoJCQl0aGlzLnkgPSAwOwoJCQl0aGlzLnogPSAwOwoKCQl9IGVsc2UgewoKCQkJdGhpcy54ID0gcS54IC8gczsKCQkJdGhpcy55ID0gcS55IC8gczsKCQkJdGhpcy56ID0gcS56IC8gczsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0QXhpc0FuZ2xlRnJvbVJvdGF0aW9uTWF0cml4KCBtICkgewoKCQkvLyBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9nZW9tZXRyeS9yb3RhdGlvbnMvY29udmVyc2lvbnMvbWF0cml4VG9BbmdsZS9pbmRleC5odG0KCgkJLy8gYXNzdW1lcyB0aGUgdXBwZXIgM3gzIG9mIG0gaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLCB1bnNjYWxlZCkKCgkJbGV0IGFuZ2xlLCB4LCB5LCB6OyAvLyB2YXJpYWJsZXMgZm9yIHJlc3VsdAoJCWNvbnN0IGVwc2lsb24gPSAwLjAxLAkJLy8gbWFyZ2luIHRvIGFsbG93IGZvciByb3VuZGluZyBlcnJvcnMKCQkJZXBzaWxvbjIgPSAwLjEsCQkvLyBtYXJnaW4gdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiAwIGFuZCAxODAgZGVncmVlcwoKCQkJdGUgPSBtLmVsZW1lbnRzLAoKCQkJbTExID0gdGVbIDAgXSwgbTEyID0gdGVbIDQgXSwgbTEzID0gdGVbIDggXSwKCQkJbTIxID0gdGVbIDEgXSwgbTIyID0gdGVbIDUgXSwgbTIzID0gdGVbIDkgXSwKCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF07CgoJCWlmICggKCBNYXRoLmFicyggbTEyIC0gbTIxICkgPCBlcHNpbG9uICkgJiYKCQkgICAgICggTWF0aC5hYnMoIG0xMyAtIG0zMSApIDwgZXBzaWxvbiApICYmCgkJICAgICAoIE1hdGguYWJzKCBtMjMgLSBtMzIgKSA8IGVwc2lsb24gKSApIHsKCgkJCS8vIHNpbmd1bGFyaXR5IGZvdW5kCgkJCS8vIGZpcnN0IGNoZWNrIGZvciBpZGVudGl0eSBtYXRyaXggd2hpY2ggbXVzdCBoYXZlICsxIGZvciBhbGwgdGVybXMKCQkJLy8gaW4gbGVhZGluZyBkaWFnb25hbCBhbmQgemVybyBpbiBvdGhlciB0ZXJtcwoKCQkJaWYgKCAoIE1hdGguYWJzKCBtMTIgKyBtMjEgKSA8IGVwc2lsb24yICkgJiYKCQkJICAgICAoIE1hdGguYWJzKCBtMTMgKyBtMzEgKSA8IGVwc2lsb24yICkgJiYKCQkJICAgICAoIE1hdGguYWJzKCBtMjMgKyBtMzIgKSA8IGVwc2lsb24yICkgJiYKCQkJICAgICAoIE1hdGguYWJzKCBtMTEgKyBtMjIgKyBtMzMgLSAzICkgPCBlcHNpbG9uMiApICkgewoKCQkJCS8vIHRoaXMgc2luZ3VsYXJpdHkgaXMgaWRlbnRpdHkgbWF0cml4IHNvIGFuZ2xlID0gMAoKCQkJCXRoaXMuc2V0KCAxLCAwLCAwLCAwICk7CgoJCQkJcmV0dXJuIHRoaXM7IC8vIHplcm8gYW5nbGUsIGFyYml0cmFyeSBheGlzCgoJCQl9CgoJCQkvLyBvdGhlcndpc2UgdGhpcyBzaW5ndWxhcml0eSBpcyBhbmdsZSA9IDE4MAoKCQkJYW5nbGUgPSBNYXRoLlBJOwoKCQkJY29uc3QgeHggPSAoIG0xMSArIDEgKSAvIDI7CgkJCWNvbnN0IHl5ID0gKCBtMjIgKyAxICkgLyAyOwoJCQljb25zdCB6eiA9ICggbTMzICsgMSApIC8gMjsKCQkJY29uc3QgeHkgPSAoIG0xMiArIG0yMSApIC8gNDsKCQkJY29uc3QgeHogPSAoIG0xMyArIG0zMSApIC8gNDsKCQkJY29uc3QgeXogPSAoIG0yMyArIG0zMiApIC8gNDsKCgkJCWlmICggKCB4eCA+IHl5ICkgJiYgKCB4eCA+IHp6ICkgKSB7CgoJCQkJLy8gbTExIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCgkJCQlpZiAoIHh4IDwgZXBzaWxvbiApIHsKCgkJCQkJeCA9IDA7CgkJCQkJeSA9IDAuNzA3MTA2NzgxOwoJCQkJCXogPSAwLjcwNzEwNjc4MTsKCgkJCQl9IGVsc2UgewoKCQkJCQl4ID0gTWF0aC5zcXJ0KCB4eCApOwoJCQkJCXkgPSB4eSAvIHg7CgkJCQkJeiA9IHh6IC8geDsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCB5eSA+IHp6ICkgewoKCQkJCS8vIG0yMiBpcyB0aGUgbGFyZ2VzdCBkaWFnb25hbCB0ZXJtCgoJCQkJaWYgKCB5eSA8IGVwc2lsb24gKSB7CgoJCQkJCXggPSAwLjcwNzEwNjc4MTsKCQkJCQl5ID0gMDsKCQkJCQl6ID0gMC43MDcxMDY3ODE7CgoJCQkJfSBlbHNlIHsKCgkJCQkJeSA9IE1hdGguc3FydCggeXkgKTsKCQkJCQl4ID0geHkgLyB5OwoJCQkJCXogPSB5eiAvIHk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQkvLyBtMzMgaXMgdGhlIGxhcmdlc3QgZGlhZ29uYWwgdGVybSBzbyBiYXNlIHJlc3VsdCBvbiB0aGlzCgoJCQkJaWYgKCB6eiA8IGVwc2lsb24gKSB7CgoJCQkJCXggPSAwLjcwNzEwNjc4MTsKCQkJCQl5ID0gMC43MDcxMDY3ODE7CgkJCQkJeiA9IDA7CgoJCQkJfSBlbHNlIHsKCgkJCQkJeiA9IE1hdGguc3FydCggenogKTsKCQkJCQl4ID0geHogLyB6OwoJCQkJCXkgPSB5eiAvIHo7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5zZXQoIHgsIHksIHosIGFuZ2xlICk7CgoJCQlyZXR1cm4gdGhpczsgLy8gcmV0dXJuIDE4MCBkZWcgcm90YXRpb24KCgkJfQoKCQkvLyBhcyB3ZSBoYXZlIHJlYWNoZWQgaGVyZSB0aGVyZSBhcmUgbm8gc2luZ3VsYXJpdGllcyBzbyB3ZSBjYW4gaGFuZGxlIG5vcm1hbGx5CgoJCWxldCBzID0gTWF0aC5zcXJ0KCAoIG0zMiAtIG0yMyApICogKCBtMzIgLSBtMjMgKSArCgkJCSggbTEzIC0gbTMxICkgKiAoIG0xMyAtIG0zMSApICsKCQkJKCBtMjEgLSBtMTIgKSAqICggbTIxIC0gbTEyICkgKTsgLy8gdXNlZCB0byBub3JtYWxpemUKCgkJaWYgKCBNYXRoLmFicyggcyApIDwgMC4wMDEgKSBzID0gMTsKCgkJLy8gcHJldmVudCBkaXZpZGUgYnkgemVybywgc2hvdWxkIG5vdCBoYXBwZW4gaWYgbWF0cml4IGlzIG9ydGhvZ29uYWwgYW5kIHNob3VsZCBiZQoJCS8vIGNhdWdodCBieSBzaW5ndWxhcml0eSB0ZXN0IGFib3ZlLCBidXQgSSd2ZSBsZWZ0IGl0IGluIGp1c3QgaW4gY2FzZQoKCQl0aGlzLnggPSAoIG0zMiAtIG0yMyApIC8gczsKCQl0aGlzLnkgPSAoIG0xMyAtIG0zMSApIC8gczsKCQl0aGlzLnogPSAoIG0yMSAtIG0xMiApIC8gczsKCQl0aGlzLncgPSBNYXRoLmFjb3MoICggbTExICsgbTIyICsgbTMzIC0gMSApIC8gMiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWluKCB2ICkgewoKCQl0aGlzLnggPSBNYXRoLm1pbiggdGhpcy54LCB2LnggKTsKCQl0aGlzLnkgPSBNYXRoLm1pbiggdGhpcy55LCB2LnkgKTsKCQl0aGlzLnogPSBNYXRoLm1pbiggdGhpcy56LCB2LnogKTsKCQl0aGlzLncgPSBNYXRoLm1pbiggdGhpcy53LCB2LncgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW1heCggdiApIHsKCgkJdGhpcy54ID0gTWF0aC5tYXgoIHRoaXMueCwgdi54ICk7CgkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CgkJdGhpcy56ID0gTWF0aC5tYXgoIHRoaXMueiwgdi56ICk7CgkJdGhpcy53ID0gTWF0aC5tYXgoIHRoaXMudywgdi53ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbGFtcCggbWluLCBtYXggKSB7CgoJCS8vIGFzc3VtZXMgbWluIDwgbWF4LCBjb21wb25lbnR3aXNlCgoJCXRoaXMueCA9IE1hdGgubWF4KCBtaW4ueCwgTWF0aC5taW4oIG1heC54LCB0aGlzLnggKSApOwoJCXRoaXMueSA9IE1hdGgubWF4KCBtaW4ueSwgTWF0aC5taW4oIG1heC55LCB0aGlzLnkgKSApOwoJCXRoaXMueiA9IE1hdGgubWF4KCBtaW4ueiwgTWF0aC5taW4oIG1heC56LCB0aGlzLnogKSApOwoJCXRoaXMudyA9IE1hdGgubWF4KCBtaW4udywgTWF0aC5taW4oIG1heC53LCB0aGlzLncgKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xhbXBTY2FsYXIoIG1pblZhbCwgbWF4VmFsICkgewoKCQl0aGlzLnggPSBNYXRoLm1heCggbWluVmFsLCBNYXRoLm1pbiggbWF4VmFsLCB0aGlzLnggKSApOwoJCXRoaXMueSA9IE1hdGgubWF4KCBtaW5WYWwsIE1hdGgubWluKCBtYXhWYWwsIHRoaXMueSApICk7CgkJdGhpcy56ID0gTWF0aC5tYXgoIG1pblZhbCwgTWF0aC5taW4oIG1heFZhbCwgdGhpcy56ICkgKTsKCQl0aGlzLncgPSBNYXRoLm1heCggbWluVmFsLCBNYXRoLm1pbiggbWF4VmFsLCB0aGlzLncgKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xhbXBMZW5ndGgoIG1pbiwgbWF4ICkgewoKCQljb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aCgpOwoKCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIGxlbmd0aCB8fCAxICkubXVsdGlwbHlTY2FsYXIoIE1hdGgubWF4KCBtaW4sIE1hdGgubWluKCBtYXgsIGxlbmd0aCApICkgKTsKCgl9CgoJZmxvb3IoKSB7CgoJCXRoaXMueCA9IE1hdGguZmxvb3IoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGguZmxvb3IoIHRoaXMueSApOwoJCXRoaXMueiA9IE1hdGguZmxvb3IoIHRoaXMueiApOwoJCXRoaXMudyA9IE1hdGguZmxvb3IoIHRoaXMudyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2VpbCgpIHsKCgkJdGhpcy54ID0gTWF0aC5jZWlsKCB0aGlzLnggKTsKCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoJCXRoaXMueiA9IE1hdGguY2VpbCggdGhpcy56ICk7CgkJdGhpcy53ID0gTWF0aC5jZWlsKCB0aGlzLncgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJvdW5kKCkgewoKCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQl0aGlzLnkgPSBNYXRoLnJvdW5kKCB0aGlzLnkgKTsKCQl0aGlzLnogPSBNYXRoLnJvdW5kKCB0aGlzLnogKTsKCQl0aGlzLncgPSBNYXRoLnJvdW5kKCB0aGlzLncgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJvdW5kVG9aZXJvKCkgewoKCQl0aGlzLnggPSBNYXRoLnRydW5jKCB0aGlzLnggKTsKCQl0aGlzLnkgPSBNYXRoLnRydW5jKCB0aGlzLnkgKTsKCQl0aGlzLnogPSBNYXRoLnRydW5jKCB0aGlzLnogKTsKCQl0aGlzLncgPSBNYXRoLnRydW5jKCB0aGlzLncgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW5lZ2F0ZSgpIHsKCgkJdGhpcy54ID0gLSB0aGlzLng7CgkJdGhpcy55ID0gLSB0aGlzLnk7CgkJdGhpcy56ID0gLSB0aGlzLno7CgkJdGhpcy53ID0gLSB0aGlzLnc7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkb3QoIHYgKSB7CgoJCXJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2LnkgKyB0aGlzLnogKiB2LnogKyB0aGlzLncgKiB2Lnc7CgoJfQoKCWxlbmd0aFNxKCkgewoKCQlyZXR1cm4gdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53OwoKCX0KCglsZW5ndGgoKSB7CgoJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyApOwoKCX0KCgltYW5oYXR0YW5MZW5ndGgoKSB7CgoJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICkgKyBNYXRoLmFicyggdGhpcy56ICkgKyBNYXRoLmFicyggdGhpcy53ICk7CgoJfQoKCW5vcm1hbGl6ZSgpIHsKCgkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCgl9CgoJc2V0TGVuZ3RoKCBsZW5ndGggKSB7CgoJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCgl9CgoJbGVycCggdiwgYWxwaGEgKSB7CgoJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CgkJdGhpcy55ICs9ICggdi55IC0gdGhpcy55ICkgKiBhbHBoYTsKCQl0aGlzLnogKz0gKCB2LnogLSB0aGlzLnogKSAqIGFscGhhOwoJCXRoaXMudyArPSAoIHYudyAtIHRoaXMudyApICogYWxwaGE7CgoJCXJldHVybiB0aGlzOwoKCX0KCglsZXJwVmVjdG9ycyggdjEsIHYyLCBhbHBoYSApIHsKCgkJdGhpcy54ID0gdjEueCArICggdjIueCAtIHYxLnggKSAqIGFscGhhOwoJCXRoaXMueSA9IHYxLnkgKyAoIHYyLnkgLSB2MS55ICkgKiBhbHBoYTsKCQl0aGlzLnogPSB2MS56ICsgKCB2Mi56IC0gdjEueiApICogYWxwaGE7CgkJdGhpcy53ID0gdjEudyArICggdjIudyAtIHYxLncgKSAqIGFscGhhOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCB2ICkgewoKCQlyZXR1cm4gKCAoIHYueCA9PT0gdGhpcy54ICkgJiYgKCB2LnkgPT09IHRoaXMueSApICYmICggdi56ID09PSB0aGlzLnogKSAmJiAoIHYudyA9PT0gdGhpcy53ICkgKTsKCgl9CgoJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJdGhpcy54ID0gYXJyYXlbIG9mZnNldCBdOwoJCXRoaXMueSA9IGFycmF5WyBvZmZzZXQgKyAxIF07CgkJdGhpcy56ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCQl0aGlzLncgPSBhcnJheVsgb2Zmc2V0ICsgMyBdOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy54OwoJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRoaXMuejsKCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGhpcy53OwoKCQlyZXR1cm4gYXJyYXk7CgoJfQoKCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgoJCXRoaXMueCA9IGF0dHJpYnV0ZS5nZXRYKCBpbmRleCApOwoJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwoJCXRoaXMueiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwoJCXRoaXMudyA9IGF0dHJpYnV0ZS5nZXRXKCBpbmRleCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcmFuZG9tKCkgewoKCQl0aGlzLnggPSBNYXRoLnJhbmRvbSgpOwoJCXRoaXMueSA9IE1hdGgucmFuZG9tKCk7CgkJdGhpcy56ID0gTWF0aC5yYW5kb20oKTsKCQl0aGlzLncgPSBNYXRoLnJhbmRvbSgpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgoJCXlpZWxkIHRoaXMueDsKCQl5aWVsZCB0aGlzLnk7CgkJeWllbGQgdGhpcy56OwoJCXlpZWxkIHRoaXMudzsKCgl9Cgp9CgovKgogSW4gb3B0aW9ucywgd2UgY2FuIHNwZWNpZnk6CiAqIFRleHR1cmUgcGFyYW1ldGVycyBmb3IgYW4gYXV0by1nZW5lcmF0ZWQgdGFyZ2V0IHRleHR1cmUKICogZGVwdGhCdWZmZXIvc3RlbmNpbEJ1ZmZlcjogQm9vbGVhbnMgdG8gaW5kaWNhdGUgaWYgd2Ugc2hvdWxkIGdlbmVyYXRlIHRoZXNlIGJ1ZmZlcnMKKi8KY2xhc3MgUmVuZGVyVGFyZ2V0IGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNSZW5kZXJUYXJnZXQgPSB0cnVlOwoKCQl0aGlzLndpZHRoID0gd2lkdGg7CgkJdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkJdGhpcy5kZXB0aCA9IDE7CgoJCXRoaXMuc2Npc3NvciA9IG5ldyBWZWN0b3I0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgkJdGhpcy5zY2lzc29yVGVzdCA9IGZhbHNlOwoKCQl0aGlzLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCgkJY29uc3QgaW1hZ2UgPSB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIGRlcHRoOiAxIH07CgoJCWlmICggb3B0aW9ucy5lbmNvZGluZyAhPT0gdW5kZWZpbmVkICkgewoKCQkJLy8gQGRlcHJlY2F0ZWQsIHIxNTIKCQkJd2Fybk9uY2UoICdUSFJFRS5XZWJHTFJlbmRlclRhcmdldDogb3B0aW9uLmVuY29kaW5nIGhhcyBiZWVuIHJlcGxhY2VkIGJ5IG9wdGlvbi5jb2xvclNwYWNlLicgKTsKCQkJb3B0aW9ucy5jb2xvclNwYWNlID0gb3B0aW9ucy5lbmNvZGluZyA9PT0gc1JHQkVuY29kaW5nID8gU1JHQkNvbG9yU3BhY2UgOiBOb0NvbG9yU3BhY2U7CgoJCX0KCgkJb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oIHsKCQkJZ2VuZXJhdGVNaXBtYXBzOiBmYWxzZSwKCQkJaW50ZXJuYWxGb3JtYXQ6IG51bGwsCgkJCW1pbkZpbHRlcjogTGluZWFyRmlsdGVyLAoJCQlkZXB0aEJ1ZmZlcjogdHJ1ZSwKCQkJc3RlbmNpbEJ1ZmZlcjogZmFsc2UsCgkJCWRlcHRoVGV4dHVyZTogbnVsbCwKCQkJc2FtcGxlczogMAoJCX0sIG9wdGlvbnMgKTsKCgkJdGhpcy50ZXh0dXJlID0gbmV3IFRleHR1cmUoIGltYWdlLCBvcHRpb25zLm1hcHBpbmcsIG9wdGlvbnMud3JhcFMsIG9wdGlvbnMud3JhcFQsIG9wdGlvbnMubWFnRmlsdGVyLCBvcHRpb25zLm1pbkZpbHRlciwgb3B0aW9ucy5mb3JtYXQsIG9wdGlvbnMudHlwZSwgb3B0aW9ucy5hbmlzb3Ryb3B5LCBvcHRpb25zLmNvbG9yU3BhY2UgKTsKCQl0aGlzLnRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCgkJdGhpcy50ZXh0dXJlLmZsaXBZID0gZmFsc2U7CgkJdGhpcy50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IG9wdGlvbnMuZ2VuZXJhdGVNaXBtYXBzOwoJCXRoaXMudGV4dHVyZS5pbnRlcm5hbEZvcm1hdCA9IG9wdGlvbnMuaW50ZXJuYWxGb3JtYXQ7CgoJCXRoaXMuZGVwdGhCdWZmZXIgPSBvcHRpb25zLmRlcHRoQnVmZmVyOwoJCXRoaXMuc3RlbmNpbEJ1ZmZlciA9IG9wdGlvbnMuc3RlbmNpbEJ1ZmZlcjsKCgkJdGhpcy5kZXB0aFRleHR1cmUgPSBvcHRpb25zLmRlcHRoVGV4dHVyZTsKCgkJdGhpcy5zYW1wbGVzID0gb3B0aW9ucy5zYW1wbGVzOwoKCX0KCglzZXRTaXplKCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCA9IDEgKSB7CgoJCWlmICggdGhpcy53aWR0aCAhPT0gd2lkdGggfHwgdGhpcy5oZWlnaHQgIT09IGhlaWdodCB8fCB0aGlzLmRlcHRoICE9PSBkZXB0aCApIHsKCgkJCXRoaXMud2lkdGggPSB3aWR0aDsKCQkJdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkJCXRoaXMuZGVwdGggPSBkZXB0aDsKCgkJCXRoaXMudGV4dHVyZS5pbWFnZS53aWR0aCA9IHdpZHRoOwoJCQl0aGlzLnRleHR1cmUuaW1hZ2UuaGVpZ2h0ID0gaGVpZ2h0OwoJCQl0aGlzLnRleHR1cmUuaW1hZ2UuZGVwdGggPSBkZXB0aDsKCgkJCXRoaXMuZGlzcG9zZSgpOwoKCQl9CgoJCXRoaXMudmlld3BvcnQuc2V0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgkJdGhpcy5zY2lzc29yLnNldCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXRoaXMud2lkdGggPSBzb3VyY2Uud2lkdGg7CgkJdGhpcy5oZWlnaHQgPSBzb3VyY2UuaGVpZ2h0OwoJCXRoaXMuZGVwdGggPSBzb3VyY2UuZGVwdGg7CgoJCXRoaXMuc2Npc3Nvci5jb3B5KCBzb3VyY2Uuc2Npc3NvciApOwoJCXRoaXMuc2Npc3NvclRlc3QgPSBzb3VyY2Uuc2Npc3NvclRlc3Q7CgoJCXRoaXMudmlld3BvcnQuY29weSggc291cmNlLnZpZXdwb3J0ICk7CgoJCXRoaXMudGV4dHVyZSA9IHNvdXJjZS50ZXh0dXJlLmNsb25lKCk7CgkJdGhpcy50ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9IHRydWU7CgoJCS8vIGVuc3VyZSBpbWFnZSBvYmplY3QgaXMgbm90IHNoYXJlZCwgc2VlICMyMDMyOAoKCQljb25zdCBpbWFnZSA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UudGV4dHVyZS5pbWFnZSApOwoJCXRoaXMudGV4dHVyZS5zb3VyY2UgPSBuZXcgU291cmNlKCBpbWFnZSApOwoKCQl0aGlzLmRlcHRoQnVmZmVyID0gc291cmNlLmRlcHRoQnVmZmVyOwoJCXRoaXMuc3RlbmNpbEJ1ZmZlciA9IHNvdXJjZS5zdGVuY2lsQnVmZmVyOwoKCQlpZiAoIHNvdXJjZS5kZXB0aFRleHR1cmUgIT09IG51bGwgKSB0aGlzLmRlcHRoVGV4dHVyZSA9IHNvdXJjZS5kZXB0aFRleHR1cmUuY2xvbmUoKTsKCgkJdGhpcy5zYW1wbGVzID0gc291cmNlLnNhbXBsZXM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCgl9Cgp9CgpjbGFzcyBXZWJHTFJlbmRlclRhcmdldCBleHRlbmRzIFJlbmRlclRhcmdldCB7CgoJY29uc3RydWN0b3IoIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgb3B0aW9ucyA9IHt9ICkgewoKCQlzdXBlciggd2lkdGgsIGhlaWdodCwgb3B0aW9ucyApOwoKCQl0aGlzLmlzV2ViR0xSZW5kZXJUYXJnZXQgPSB0cnVlOwoKCX0KCn0KCmNsYXNzIERhdGFBcnJheVRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCgljb25zdHJ1Y3RvciggZGF0YSA9IG51bGwsIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgZGVwdGggPSAxICkgewoKCQlzdXBlciggbnVsbCApOwoKCQl0aGlzLmlzRGF0YUFycmF5VGV4dHVyZSA9IHRydWU7CgoJCXRoaXMuaW1hZ2UgPSB7IGRhdGEsIHdpZHRoLCBoZWlnaHQsIGRlcHRoIH07CgoJCXRoaXMubWFnRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCQl0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCXRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CgoJfQoKfQoKY2xhc3MgV2ViR0xBcnJheVJlbmRlclRhcmdldCBleHRlbmRzIFdlYkdMUmVuZGVyVGFyZ2V0IHsKCgljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBkZXB0aCA9IDEsIG9wdGlvbnMgPSB7fSApIHsKCgkJc3VwZXIoIHdpZHRoLCBoZWlnaHQsIG9wdGlvbnMgKTsKCgkJdGhpcy5pc1dlYkdMQXJyYXlSZW5kZXJUYXJnZXQgPSB0cnVlOwoKCQl0aGlzLmRlcHRoID0gZGVwdGg7CgoJCXRoaXMudGV4dHVyZSA9IG5ldyBEYXRhQXJyYXlUZXh0dXJlKCBudWxsLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCApOwoKCQl0aGlzLnRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCgl9Cgp9CgpjbGFzcyBEYXRhM0RUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsLCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSApIHsKCgkJLy8gV2UncmUgZ29pbmcgdG8gYWRkIC5zZXRYWFgoKSBtZXRob2RzIGZvciBzZXR0aW5nIHByb3BlcnRpZXMgbGF0ZXIuCgkJLy8gVXNlcnMgY2FuIHN0aWxsIHNldCBpbiBEYXRhVGV4dHVyZTNEIGRpcmVjdGx5LgoJCS8vCgkJLy8JY29uc3QgdGV4dHVyZSA9IG5ldyBUSFJFRS5EYXRhVGV4dHVyZTNEKCBkYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCApOwoJCS8vIAl0ZXh0dXJlLmFuaXNvdHJvcHkgPSAxNjsKCQkvLwoJCS8vIFNlZSAjMTQ4MzkKCgkJc3VwZXIoIG51bGwgKTsKCgkJdGhpcy5pc0RhdGEzRFRleHR1cmUgPSB0cnVlOwoKCQl0aGlzLmltYWdlID0geyBkYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCB9OwoKCQl0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgkJdGhpcy5taW5GaWx0ZXIgPSBOZWFyZXN0RmlsdGVyOwoKCQl0aGlzLndyYXBSID0gQ2xhbXBUb0VkZ2VXcmFwcGluZzsKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCQl0aGlzLmZsaXBZID0gZmFsc2U7CgkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSAxOwoKCX0KCn0KCmNsYXNzIFdlYkdMM0RSZW5kZXJUYXJnZXQgZXh0ZW5kcyBXZWJHTFJlbmRlclRhcmdldCB7CgoJY29uc3RydWN0b3IoIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgZGVwdGggPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCXN1cGVyKCB3aWR0aCwgaGVpZ2h0LCBvcHRpb25zICk7CgoJCXRoaXMuaXNXZWJHTDNEUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsKCgkJdGhpcy5kZXB0aCA9IGRlcHRoOwoKCQl0aGlzLnRleHR1cmUgPSBuZXcgRGF0YTNEVGV4dHVyZSggbnVsbCwgd2lkdGgsIGhlaWdodCwgZGVwdGggKTsKCgkJdGhpcy50ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9IHRydWU7CgoJfQoKfQoKY2xhc3MgV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMgZXh0ZW5kcyBXZWJHTFJlbmRlclRhcmdldCB7CgoJY29uc3RydWN0b3IoIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgY291bnQgPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCXN1cGVyKCB3aWR0aCwgaGVpZ2h0LCBvcHRpb25zICk7CgoJCXRoaXMuaXNXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cyA9IHRydWU7CgoJCWNvbnN0IHRleHR1cmUgPSB0aGlzLnRleHR1cmU7CgoJCXRoaXMudGV4dHVyZSA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSArKyApIHsKCgkJCXRoaXMudGV4dHVyZVsgaSBdID0gdGV4dHVyZS5jbG9uZSgpOwoJCQl0aGlzLnRleHR1cmVbIGkgXS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwoKCQl9CgoJfQoKCXNldFNpemUoIHdpZHRoLCBoZWlnaHQsIGRlcHRoID0gMSApIHsKCgkJaWYgKCB0aGlzLndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLmhlaWdodCAhPT0gaGVpZ2h0IHx8IHRoaXMuZGVwdGggIT09IGRlcHRoICkgewoKCQkJdGhpcy53aWR0aCA9IHdpZHRoOwoJCQl0aGlzLmhlaWdodCA9IGhlaWdodDsKCQkJdGhpcy5kZXB0aCA9IGRlcHRoOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRoaXMudGV4dHVyZS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl0aGlzLnRleHR1cmVbIGkgXS5pbWFnZS53aWR0aCA9IHdpZHRoOwoJCQkJdGhpcy50ZXh0dXJlWyBpIF0uaW1hZ2UuaGVpZ2h0ID0gaGVpZ2h0OwoJCQkJdGhpcy50ZXh0dXJlWyBpIF0uaW1hZ2UuZGVwdGggPSBkZXB0aDsKCgkJCX0KCgkJCXRoaXMuZGlzcG9zZSgpOwoKCQl9CgoJCXRoaXMudmlld3BvcnQuc2V0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgkJdGhpcy5zY2lzc29yLnNldCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXRoaXMuZGlzcG9zZSgpOwoKCQl0aGlzLndpZHRoID0gc291cmNlLndpZHRoOwoJCXRoaXMuaGVpZ2h0ID0gc291cmNlLmhlaWdodDsKCQl0aGlzLmRlcHRoID0gc291cmNlLmRlcHRoOwoKCQl0aGlzLnNjaXNzb3IuY29weSggc291cmNlLnNjaXNzb3IgKTsKCQl0aGlzLnNjaXNzb3JUZXN0ID0gc291cmNlLnNjaXNzb3JUZXN0OwoKCQl0aGlzLnZpZXdwb3J0LmNvcHkoIHNvdXJjZS52aWV3cG9ydCApOwoKCQl0aGlzLmRlcHRoQnVmZmVyID0gc291cmNlLmRlcHRoQnVmZmVyOwoJCXRoaXMuc3RlbmNpbEJ1ZmZlciA9IHNvdXJjZS5zdGVuY2lsQnVmZmVyOwoKCQlpZiAoIHNvdXJjZS5kZXB0aFRleHR1cmUgIT09IG51bGwgKSB0aGlzLmRlcHRoVGV4dHVyZSA9IHNvdXJjZS5kZXB0aFRleHR1cmUuY2xvbmUoKTsKCgkJdGhpcy50ZXh0dXJlLmxlbmd0aCA9IDA7CgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBzb3VyY2UudGV4dHVyZS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCXRoaXMudGV4dHVyZVsgaSBdID0gc291cmNlLnRleHR1cmVbIGkgXS5jbG9uZSgpOwoJCQl0aGlzLnRleHR1cmVbIGkgXS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFF1YXRlcm5pb24gewoKCWNvbnN0cnVjdG9yKCB4ID0gMCwgeSA9IDAsIHogPSAwLCB3ID0gMSApIHsKCgkJdGhpcy5pc1F1YXRlcm5pb24gPSB0cnVlOwoKCQl0aGlzLl94ID0geDsKCQl0aGlzLl95ID0geTsKCQl0aGlzLl96ID0gejsKCQl0aGlzLl93ID0gdzsKCgl9CgoJc3RhdGljIHNsZXJwRmxhdCggZHN0LCBkc3RPZmZzZXQsIHNyYzAsIHNyY09mZnNldDAsIHNyYzEsIHNyY09mZnNldDEsIHQgKSB7CgoJCS8vIGZ1enotZnJlZSwgYXJyYXktYmFzZWQgUXVhdGVybmlvbiBTTEVSUCBvcGVyYXRpb24KCgkJbGV0IHgwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDAgXSwKCQkJeTAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMSBdLAoJCQl6MCA9IHNyYzBbIHNyY09mZnNldDAgKyAyIF0sCgkJCXcwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDMgXTsKCgkJY29uc3QgeDEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMCBdLAoJCQl5MSA9IHNyYzFbIHNyY09mZnNldDEgKyAxIF0sCgkJCXoxID0gc3JjMVsgc3JjT2Zmc2V0MSArIDIgXSwKCQkJdzEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMyBdOwoKCQlpZiAoIHQgPT09IDAgKSB7CgoJCQlkc3RbIGRzdE9mZnNldCArIDAgXSA9IHgwOwoJCQlkc3RbIGRzdE9mZnNldCArIDEgXSA9IHkwOwoJCQlkc3RbIGRzdE9mZnNldCArIDIgXSA9IHowOwoJCQlkc3RbIGRzdE9mZnNldCArIDMgXSA9IHcwOwoJCQlyZXR1cm47CgoJCX0KCgkJaWYgKCB0ID09PSAxICkgewoKCQkJZHN0WyBkc3RPZmZzZXQgKyAwIF0gPSB4MTsKCQkJZHN0WyBkc3RPZmZzZXQgKyAxIF0gPSB5MTsKCQkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MTsKCQkJZHN0WyBkc3RPZmZzZXQgKyAzIF0gPSB3MTsKCQkJcmV0dXJuOwoKCQl9CgoJCWlmICggdzAgIT09IHcxIHx8IHgwICE9PSB4MSB8fCB5MCAhPT0geTEgfHwgejAgIT09IHoxICkgewoKCQkJbGV0IHMgPSAxIC0gdDsKCQkJY29uc3QgY29zID0geDAgKiB4MSArIHkwICogeTEgKyB6MCAqIHoxICsgdzAgKiB3MSwKCQkJCWRpciA9ICggY29zID49IDAgPyAxIDogLSAxICksCgkJCQlzcXJTaW4gPSAxIC0gY29zICogY29zOwoKCQkJLy8gU2tpcCB0aGUgU2xlcnAgZm9yIHRpbnkgc3RlcHMgdG8gYXZvaWQgbnVtZXJpYyBwcm9ibGVtczoKCQkJaWYgKCBzcXJTaW4gPiBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCQljb25zdCBzaW4gPSBNYXRoLnNxcnQoIHNxclNpbiApLAoJCQkJCWxlbiA9IE1hdGguYXRhbjIoIHNpbiwgY29zICogZGlyICk7CgoJCQkJcyA9IE1hdGguc2luKCBzICogbGVuICkgLyBzaW47CgkJCQl0ID0gTWF0aC5zaW4oIHQgKiBsZW4gKSAvIHNpbjsKCgkJCX0KCgkJCWNvbnN0IHREaXIgPSB0ICogZGlyOwoKCQkJeDAgPSB4MCAqIHMgKyB4MSAqIHREaXI7CgkJCXkwID0geTAgKiBzICsgeTEgKiB0RGlyOwoJCQl6MCA9IHowICogcyArIHoxICogdERpcjsKCQkJdzAgPSB3MCAqIHMgKyB3MSAqIHREaXI7CgoJCQkvLyBOb3JtYWxpemUgaW4gY2FzZSB3ZSBqdXN0IGRpZCBhIGxlcnA6CgkJCWlmICggcyA9PT0gMSAtIHQgKSB7CgoJCQkJY29uc3QgZiA9IDEgLyBNYXRoLnNxcnQoIHgwICogeDAgKyB5MCAqIHkwICsgejAgKiB6MCArIHcwICogdzAgKTsKCgkJCQl4MCAqPSBmOwoJCQkJeTAgKj0gZjsKCQkJCXowICo9IGY7CgkJCQl3MCAqPSBmOwoKCQkJfQoKCQl9CgoJCWRzdFsgZHN0T2Zmc2V0IF0gPSB4MDsKCQlkc3RbIGRzdE9mZnNldCArIDEgXSA9IHkwOwoJCWRzdFsgZHN0T2Zmc2V0ICsgMiBdID0gejA7CgkJZHN0WyBkc3RPZmZzZXQgKyAzIF0gPSB3MDsKCgl9CgoJc3RhdGljIG11bHRpcGx5UXVhdGVybmlvbnNGbGF0KCBkc3QsIGRzdE9mZnNldCwgc3JjMCwgc3JjT2Zmc2V0MCwgc3JjMSwgc3JjT2Zmc2V0MSApIHsKCgkJY29uc3QgeDAgPSBzcmMwWyBzcmNPZmZzZXQwIF07CgkJY29uc3QgeTAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMSBdOwoJCWNvbnN0IHowID0gc3JjMFsgc3JjT2Zmc2V0MCArIDIgXTsKCQljb25zdCB3MCA9IHNyYzBbIHNyY09mZnNldDAgKyAzIF07CgoJCWNvbnN0IHgxID0gc3JjMVsgc3JjT2Zmc2V0MSBdOwoJCWNvbnN0IHkxID0gc3JjMVsgc3JjT2Zmc2V0MSArIDEgXTsKCQljb25zdCB6MSA9IHNyYzFbIHNyY09mZnNldDEgKyAyIF07CgkJY29uc3QgdzEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMyBdOwoKCQlkc3RbIGRzdE9mZnNldCBdID0geDAgKiB3MSArIHcwICogeDEgKyB5MCAqIHoxIC0gejAgKiB5MTsKCQlkc3RbIGRzdE9mZnNldCArIDEgXSA9IHkwICogdzEgKyB3MCAqIHkxICsgejAgKiB4MSAtIHgwICogejE7CgkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MCAqIHcxICsgdzAgKiB6MSArIHgwICogeTEgLSB5MCAqIHgxOwoJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzAgKiB3MSAtIHgwICogeDEgLSB5MCAqIHkxIC0gejAgKiB6MTsKCgkJcmV0dXJuIGRzdDsKCgl9CgoJZ2V0IHgoKSB7CgoJCXJldHVybiB0aGlzLl94OwoKCX0KCglzZXQgeCggdmFsdWUgKSB7CgoJCXRoaXMuX3ggPSB2YWx1ZTsKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJfQoKCWdldCB5KCkgewoKCQlyZXR1cm4gdGhpcy5feTsKCgl9CgoJc2V0IHkoIHZhbHVlICkgewoKCQl0aGlzLl95ID0gdmFsdWU7CgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCX0KCglnZXQgeigpIHsKCgkJcmV0dXJuIHRoaXMuX3o7CgoJfQoKCXNldCB6KCB2YWx1ZSApIHsKCgkJdGhpcy5feiA9IHZhbHVlOwoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgl9CgoJZ2V0IHcoKSB7CgoJCXJldHVybiB0aGlzLl93OwoKCX0KCglzZXQgdyggdmFsdWUgKSB7CgoJCXRoaXMuX3cgPSB2YWx1ZTsKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJfQoKCXNldCggeCwgeSwgeiwgdyApIHsKCgkJdGhpcy5feCA9IHg7CgkJdGhpcy5feSA9IHk7CgkJdGhpcy5feiA9IHo7CgkJdGhpcy5fdyA9IHc7CgoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3osIHRoaXMuX3cgKTsKCgl9CgoJY29weSggcXVhdGVybmlvbiApIHsKCgkJdGhpcy5feCA9IHF1YXRlcm5pb24ueDsKCQl0aGlzLl95ID0gcXVhdGVybmlvbi55OwoJCXRoaXMuX3ogPSBxdWF0ZXJuaW9uLno7CgkJdGhpcy5fdyA9IHF1YXRlcm5pb24udzsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbUV1bGVyKCBldWxlciwgdXBkYXRlID0gdHJ1ZSApIHsKCgkJY29uc3QgeCA9IGV1bGVyLl94LCB5ID0gZXVsZXIuX3ksIHogPSBldWxlci5feiwgb3JkZXIgPSBldWxlci5fb3JkZXI7CgoJCS8vIGh0dHA6Ly93d3cubWF0aHdvcmtzLmNvbS9tYXRsYWJjZW50cmFsL2ZpbGVleGNoYW5nZS8KCQkvLyAJMjA2OTYtZnVuY3Rpb24tdG8tY29udmVydC1iZXR3ZWVuLWRjbS1ldWxlci1hbmdsZXMtcXVhdGVybmlvbnMtYW5kLWV1bGVyLXZlY3RvcnMvCgkJLy8JY29udGVudC9TcGluQ2FsYy5tCgoJCWNvbnN0IGNvcyA9IE1hdGguY29zOwoJCWNvbnN0IHNpbiA9IE1hdGguc2luOwoKCQljb25zdCBjMSA9IGNvcyggeCAvIDIgKTsKCQljb25zdCBjMiA9IGNvcyggeSAvIDIgKTsKCQljb25zdCBjMyA9IGNvcyggeiAvIDIgKTsKCgkJY29uc3QgczEgPSBzaW4oIHggLyAyICk7CgkJY29uc3QgczIgPSBzaW4oIHkgLyAyICk7CgkJY29uc3QgczMgPSBzaW4oIHogLyAyICk7CgoJCXN3aXRjaCAoIG9yZGVyICkgewoKCQkJY2FzZSAnWFlaJzoKCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CgkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwoJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CgkJCQlicmVhazsKCgkJCWNhc2UgJ1lYWic6CgkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwoJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CgkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwoJCQkJYnJlYWs7CgoJCQljYXNlICdaWFknOgoJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CgkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwoJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnWllYJzoKCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CgkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwoJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CgkJCQlicmVhazsKCgkJCWNhc2UgJ1laWCc6CgkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwoJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CgkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwoJCQkJYnJlYWs7CgoJCQljYXNlICdYWlknOgoJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CgkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwoJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKCQkJCWJyZWFrOwoKCQkJZGVmYXVsdDoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlF1YXRlcm5pb246IC5zZXRGcm9tRXVsZXIoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAnICsgb3JkZXIgKTsKCgkJfQoKCQlpZiAoIHVwZGF0ZSA9PT0gdHJ1ZSApIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICkgewoKCQkvLyBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9nZW9tZXRyeS9yb3RhdGlvbnMvY29udmVyc2lvbnMvYW5nbGVUb1F1YXRlcm5pb24vaW5kZXguaHRtCgoJCS8vIGFzc3VtZXMgYXhpcyBpcyBub3JtYWxpemVkCgoJCWNvbnN0IGhhbGZBbmdsZSA9IGFuZ2xlIC8gMiwgcyA9IE1hdGguc2luKCBoYWxmQW5nbGUgKTsKCgkJdGhpcy5feCA9IGF4aXMueCAqIHM7CgkJdGhpcy5feSA9IGF4aXMueSAqIHM7CgkJdGhpcy5feiA9IGF4aXMueiAqIHM7CgkJdGhpcy5fdyA9IE1hdGguY29zKCBoYWxmQW5nbGUgKTsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBtICkgewoKCQkvLyBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9nZW9tZXRyeS9yb3RhdGlvbnMvY29udmVyc2lvbnMvbWF0cml4VG9RdWF0ZXJuaW9uL2luZGV4Lmh0bQoKCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQljb25zdCB0ZSA9IG0uZWxlbWVudHMsCgoJCQltMTEgPSB0ZVsgMCBdLCBtMTIgPSB0ZVsgNCBdLCBtMTMgPSB0ZVsgOCBdLAoJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAoJCQltMzEgPSB0ZVsgMiBdLCBtMzIgPSB0ZVsgNiBdLCBtMzMgPSB0ZVsgMTAgXSwKCgkJCXRyYWNlID0gbTExICsgbTIyICsgbTMzOwoKCQlpZiAoIHRyYWNlID4gMCApIHsKCgkJCWNvbnN0IHMgPSAwLjUgLyBNYXRoLnNxcnQoIHRyYWNlICsgMS4wICk7CgoJCQl0aGlzLl93ID0gMC4yNSAvIHM7CgkJCXRoaXMuX3ggPSAoIG0zMiAtIG0yMyApICogczsKCQkJdGhpcy5feSA9ICggbTEzIC0gbTMxICkgKiBzOwoJCQl0aGlzLl96ID0gKCBtMjEgLSBtMTIgKSAqIHM7CgoJCX0gZWxzZSBpZiAoIG0xMSA+IG0yMiAmJiBtMTEgPiBtMzMgKSB7CgoJCQljb25zdCBzID0gMi4wICogTWF0aC5zcXJ0KCAxLjAgKyBtMTEgLSBtMjIgLSBtMzMgKTsKCgkJCXRoaXMuX3cgPSAoIG0zMiAtIG0yMyApIC8gczsKCQkJdGhpcy5feCA9IDAuMjUgKiBzOwoJCQl0aGlzLl95ID0gKCBtMTIgKyBtMjEgKSAvIHM7CgkJCXRoaXMuX3ogPSAoIG0xMyArIG0zMSApIC8gczsKCgkJfSBlbHNlIGlmICggbTIyID4gbTMzICkgewoKCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTIyIC0gbTExIC0gbTMzICk7CgoJCQl0aGlzLl93ID0gKCBtMTMgLSBtMzEgKSAvIHM7CgkJCXRoaXMuX3ggPSAoIG0xMiArIG0yMSApIC8gczsKCQkJdGhpcy5feSA9IDAuMjUgKiBzOwoJCQl0aGlzLl96ID0gKCBtMjMgKyBtMzIgKSAvIHM7CgoJCX0gZWxzZSB7CgoJCQljb25zdCBzID0gMi4wICogTWF0aC5zcXJ0KCAxLjAgKyBtMzMgLSBtMTEgLSBtMjIgKTsKCgkJCXRoaXMuX3cgPSAoIG0yMSAtIG0xMiApIC8gczsKCQkJdGhpcy5feCA9ICggbTEzICsgbTMxICkgLyBzOwoJCQl0aGlzLl95ID0gKCBtMjMgKyBtMzIgKSAvIHM7CgkJCXRoaXMuX3ogPSAwLjI1ICogczsKCgkJfQoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tVW5pdFZlY3RvcnMoIHZGcm9tLCB2VG8gKSB7CgoJCS8vIGFzc3VtZXMgZGlyZWN0aW9uIHZlY3RvcnMgdkZyb20gYW5kIHZUbyBhcmUgbm9ybWFsaXplZAoKCQlsZXQgciA9IHZGcm9tLmRvdCggdlRvICkgKyAxOwoKCQlpZiAoIHIgPCBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCS8vIHZGcm9tIGFuZCB2VG8gcG9pbnQgaW4gb3Bwb3NpdGUgZGlyZWN0aW9ucwoKCQkJciA9IDA7CgoJCQlpZiAoIE1hdGguYWJzKCB2RnJvbS54ICkgPiBNYXRoLmFicyggdkZyb20ueiApICkgewoKCQkJCXRoaXMuX3ggPSAtIHZGcm9tLnk7CgkJCQl0aGlzLl95ID0gdkZyb20ueDsKCQkJCXRoaXMuX3ogPSAwOwoJCQkJdGhpcy5fdyA9IHI7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMuX3ggPSAwOwoJCQkJdGhpcy5feSA9IC0gdkZyb20uejsKCQkJCXRoaXMuX3ogPSB2RnJvbS55OwoJCQkJdGhpcy5fdyA9IHI7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQkvLyBjcm9zc1ZlY3RvcnMoIHZGcm9tLCB2VG8gKTsgLy8gaW5saW5lZCB0byBhdm9pZCBjeWNsaWMgZGVwZW5kZW5jeSBvbiBWZWN0b3IzCgoJCQl0aGlzLl94ID0gdkZyb20ueSAqIHZUby56IC0gdkZyb20ueiAqIHZUby55OwoJCQl0aGlzLl95ID0gdkZyb20ueiAqIHZUby54IC0gdkZyb20ueCAqIHZUby56OwoJCQl0aGlzLl96ID0gdkZyb20ueCAqIHZUby55IC0gdkZyb20ueSAqIHZUby54OwoJCQl0aGlzLl93ID0gcjsKCgkJfQoKCQlyZXR1cm4gdGhpcy5ub3JtYWxpemUoKTsKCgl9CgoJYW5nbGVUbyggcSApIHsKCgkJcmV0dXJuIDIgKiBNYXRoLmFjb3MoIE1hdGguYWJzKCBjbGFtcCggdGhpcy5kb3QoIHEgKSwgLSAxLCAxICkgKSApOwoKCX0KCglyb3RhdGVUb3dhcmRzKCBxLCBzdGVwICkgewoKCQljb25zdCBhbmdsZSA9IHRoaXMuYW5nbGVUbyggcSApOwoKCQlpZiAoIGFuZ2xlID09PSAwICkgcmV0dXJuIHRoaXM7CgoJCWNvbnN0IHQgPSBNYXRoLm1pbiggMSwgc3RlcCAvIGFuZ2xlICk7CgoJCXRoaXMuc2xlcnAoIHEsIHQgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWlkZW50aXR5KCkgewoKCQlyZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAsIDEgKTsKCgl9CgoJaW52ZXJ0KCkgewoKCQkvLyBxdWF0ZXJuaW9uIGlzIGFzc3VtZWQgdG8gaGF2ZSB1bml0IGxlbmd0aAoKCQlyZXR1cm4gdGhpcy5jb25qdWdhdGUoKTsKCgl9CgoJY29uanVnYXRlKCkgewoKCQl0aGlzLl94ICo9IC0gMTsKCQl0aGlzLl95ICo9IC0gMTsKCQl0aGlzLl96ICo9IC0gMTsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZG90KCB2ICkgewoKCQlyZXR1cm4gdGhpcy5feCAqIHYuX3ggKyB0aGlzLl95ICogdi5feSArIHRoaXMuX3ogKiB2Ll96ICsgdGhpcy5fdyAqIHYuX3c7CgoJfQoKCWxlbmd0aFNxKCkgewoKCQlyZXR1cm4gdGhpcy5feCAqIHRoaXMuX3ggKyB0aGlzLl95ICogdGhpcy5feSArIHRoaXMuX3ogKiB0aGlzLl96ICsgdGhpcy5fdyAqIHRoaXMuX3c7CgoJfQoKCWxlbmd0aCgpIHsKCgkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5feCAqIHRoaXMuX3ggKyB0aGlzLl95ICogdGhpcy5feSArIHRoaXMuX3ogKiB0aGlzLl96ICsgdGhpcy5fdyAqIHRoaXMuX3cgKTsKCgl9CgoJbm9ybWFsaXplKCkgewoKCQlsZXQgbCA9IHRoaXMubGVuZ3RoKCk7CgoJCWlmICggbCA9PT0gMCApIHsKCgkJCXRoaXMuX3ggPSAwOwoJCQl0aGlzLl95ID0gMDsKCQkJdGhpcy5feiA9IDA7CgkJCXRoaXMuX3cgPSAxOwoKCQl9IGVsc2UgewoKCQkJbCA9IDEgLyBsOwoKCQkJdGhpcy5feCA9IHRoaXMuX3ggKiBsOwoJCQl0aGlzLl95ID0gdGhpcy5feSAqIGw7CgkJCXRoaXMuX3ogPSB0aGlzLl96ICogbDsKCQkJdGhpcy5fdyA9IHRoaXMuX3cgKiBsOwoKCQl9CgoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5KCBxICkgewoKCQlyZXR1cm4gdGhpcy5tdWx0aXBseVF1YXRlcm5pb25zKCB0aGlzLCBxICk7CgoJfQoKCXByZW11bHRpcGx5KCBxICkgewoKCQlyZXR1cm4gdGhpcy5tdWx0aXBseVF1YXRlcm5pb25zKCBxLCB0aGlzICk7CgoJfQoKCW11bHRpcGx5UXVhdGVybmlvbnMoIGEsIGIgKSB7CgoJCS8vIGZyb20gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9yZWFsTm9ybWVkQWxnZWJyYS9xdWF0ZXJuaW9ucy9jb2RlL2luZGV4Lmh0bQoKCQljb25zdCBxYXggPSBhLl94LCBxYXkgPSBhLl95LCBxYXogPSBhLl96LCBxYXcgPSBhLl93OwoJCWNvbnN0IHFieCA9IGIuX3gsIHFieSA9IGIuX3ksIHFieiA9IGIuX3osIHFidyA9IGIuX3c7CgoJCXRoaXMuX3ggPSBxYXggKiBxYncgKyBxYXcgKiBxYnggKyBxYXkgKiBxYnogLSBxYXogKiBxYnk7CgkJdGhpcy5feSA9IHFheSAqIHFidyArIHFhdyAqIHFieSArIHFheiAqIHFieCAtIHFheCAqIHFiejsKCQl0aGlzLl96ID0gcWF6ICogcWJ3ICsgcWF3ICogcWJ6ICsgcWF4ICogcWJ5IC0gcWF5ICogcWJ4OwoJCXRoaXMuX3cgPSBxYXcgKiBxYncgLSBxYXggKiBxYnggLSBxYXkgKiBxYnkgLSBxYXogKiBxYno7CgoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNsZXJwKCBxYiwgdCApIHsKCgkJaWYgKCB0ID09PSAwICkgcmV0dXJuIHRoaXM7CgkJaWYgKCB0ID09PSAxICkgcmV0dXJuIHRoaXMuY29weSggcWIgKTsKCgkJY29uc3QgeCA9IHRoaXMuX3gsIHkgPSB0aGlzLl95LCB6ID0gdGhpcy5feiwgdyA9IHRoaXMuX3c7CgoJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2FsZ2VicmEvcmVhbE5vcm1lZEFsZ2VicmEvcXVhdGVybmlvbnMvc2xlcnAvCgoJCWxldCBjb3NIYWxmVGhldGEgPSB3ICogcWIuX3cgKyB4ICogcWIuX3ggKyB5ICogcWIuX3kgKyB6ICogcWIuX3o7CgoJCWlmICggY29zSGFsZlRoZXRhIDwgMCApIHsKCgkJCXRoaXMuX3cgPSAtIHFiLl93OwoJCQl0aGlzLl94ID0gLSBxYi5feDsKCQkJdGhpcy5feSA9IC0gcWIuX3k7CgkJCXRoaXMuX3ogPSAtIHFiLl96OwoKCQkJY29zSGFsZlRoZXRhID0gLSBjb3NIYWxmVGhldGE7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLmNvcHkoIHFiICk7CgoJCX0KCgkJaWYgKCBjb3NIYWxmVGhldGEgPj0gMS4wICkgewoKCQkJdGhpcy5fdyA9IHc7CgkJCXRoaXMuX3ggPSB4OwoJCQl0aGlzLl95ID0geTsKCQkJdGhpcy5feiA9IHo7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQljb25zdCBzcXJTaW5IYWxmVGhldGEgPSAxLjAgLSBjb3NIYWxmVGhldGEgKiBjb3NIYWxmVGhldGE7CgoJCWlmICggc3FyU2luSGFsZlRoZXRhIDw9IE51bWJlci5FUFNJTE9OICkgewoKCQkJY29uc3QgcyA9IDEgLSB0OwoJCQl0aGlzLl93ID0gcyAqIHcgKyB0ICogdGhpcy5fdzsKCQkJdGhpcy5feCA9IHMgKiB4ICsgdCAqIHRoaXMuX3g7CgkJCXRoaXMuX3kgPSBzICogeSArIHQgKiB0aGlzLl95OwoJCQl0aGlzLl96ID0gcyAqIHogKyB0ICogdGhpcy5fejsKCgkJCXRoaXMubm9ybWFsaXplKCk7IC8vIG5vcm1hbGl6ZSBjYWxscyBfb25DaGFuZ2VDYWxsYmFjaygpCgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQljb25zdCBzaW5IYWxmVGhldGEgPSBNYXRoLnNxcnQoIHNxclNpbkhhbGZUaGV0YSApOwoJCWNvbnN0IGhhbGZUaGV0YSA9IE1hdGguYXRhbjIoIHNpbkhhbGZUaGV0YSwgY29zSGFsZlRoZXRhICk7CgkJY29uc3QgcmF0aW9BID0gTWF0aC5zaW4oICggMSAtIHQgKSAqIGhhbGZUaGV0YSApIC8gc2luSGFsZlRoZXRhLAoJCQlyYXRpb0IgPSBNYXRoLnNpbiggdCAqIGhhbGZUaGV0YSApIC8gc2luSGFsZlRoZXRhOwoKCQl0aGlzLl93ID0gKCB3ICogcmF0aW9BICsgdGhpcy5fdyAqIHJhdGlvQiApOwoJCXRoaXMuX3ggPSAoIHggKiByYXRpb0EgKyB0aGlzLl94ICogcmF0aW9CICk7CgkJdGhpcy5feSA9ICggeSAqIHJhdGlvQSArIHRoaXMuX3kgKiByYXRpb0IgKTsKCQl0aGlzLl96ID0gKCB6ICogcmF0aW9BICsgdGhpcy5feiAqIHJhdGlvQiApOwoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzbGVycFF1YXRlcm5pb25zKCBxYSwgcWIsIHQgKSB7CgoJCXJldHVybiB0aGlzLmNvcHkoIHFhICkuc2xlcnAoIHFiLCB0ICk7CgoJfQoKCXJhbmRvbSgpIHsKCgkJLy8gRGVyaXZlZCBmcm9tIGh0dHA6Ly9wbGFubmluZy5jcy51aXVjLmVkdS9ub2RlMTk4Lmh0bWwKCQkvLyBOb3RlLCB0aGlzIHNvdXJjZSB1c2VzIHcsIHgsIHksIHogb3JkZXJpbmcsCgkJLy8gc28gd2Ugc3dhcCB0aGUgb3JkZXIgYmVsb3cuCgoJCWNvbnN0IHUxID0gTWF0aC5yYW5kb20oKTsKCQljb25zdCBzcXJ0MXUxID0gTWF0aC5zcXJ0KCAxIC0gdTEgKTsKCQljb25zdCBzcXJ0dTEgPSBNYXRoLnNxcnQoIHUxICk7CgoJCWNvbnN0IHUyID0gMiAqIE1hdGguUEkgKiBNYXRoLnJhbmRvbSgpOwoKCQljb25zdCB1MyA9IDIgKiBNYXRoLlBJICogTWF0aC5yYW5kb20oKTsKCgkJcmV0dXJuIHRoaXMuc2V0KAoJCQlzcXJ0MXUxICogTWF0aC5jb3MoIHUyICksCgkJCXNxcnR1MSAqIE1hdGguc2luKCB1MyApLAoJCQlzcXJ0dTEgKiBNYXRoLmNvcyggdTMgKSwKCQkJc3FydDF1MSAqIE1hdGguc2luKCB1MiApLAoJCSk7CgoJfQoKCWVxdWFscyggcXVhdGVybmlvbiApIHsKCgkJcmV0dXJuICggcXVhdGVybmlvbi5feCA9PT0gdGhpcy5feCApICYmICggcXVhdGVybmlvbi5feSA9PT0gdGhpcy5feSApICYmICggcXVhdGVybmlvbi5feiA9PT0gdGhpcy5feiApICYmICggcXVhdGVybmlvbi5fdyA9PT0gdGhpcy5fdyApOwoKCX0KCglmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKCQl0aGlzLl94ID0gYXJyYXlbIG9mZnNldCBdOwoJCXRoaXMuX3kgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoJCXRoaXMuX3ogPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwoJCXRoaXMuX3cgPSBhcnJheVsgb2Zmc2V0ICsgMyBdOwoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLl94OwoJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLl95OwoJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLl96OwoJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0aGlzLl93OwoKCQlyZXR1cm4gYXJyYXk7CgoJfQoKCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgoJCXRoaXMuX3ggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKCQl0aGlzLl95ID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CgkJdGhpcy5feiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwoJCXRoaXMuX3cgPSBhdHRyaWJ1dGUuZ2V0VyggaW5kZXggKTsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQlyZXR1cm4gdGhpcy50b0FycmF5KCk7CgoJfQoKCV9vbkNoYW5nZSggY2FsbGJhY2sgKSB7CgoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2sgPSBjYWxsYmFjazsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCV9vbkNoYW5nZUNhbGxiYWNrKCkge30KCgkqWyBTeW1ib2wuaXRlcmF0b3IgXSgpIHsKCgkJeWllbGQgdGhpcy5feDsKCQl5aWVsZCB0aGlzLl95OwoJCXlpZWxkIHRoaXMuX3o7CgkJeWllbGQgdGhpcy5fdzsKCgl9Cgp9CgpjbGFzcyBWZWN0b3IzIHsKCgljb25zdHJ1Y3RvciggeCA9IDAsIHkgPSAwLCB6ID0gMCApIHsKCgkJVmVjdG9yMy5wcm90b3R5cGUuaXNWZWN0b3IzID0gdHJ1ZTsKCgkJdGhpcy54ID0geDsKCQl0aGlzLnkgPSB5OwoJCXRoaXMueiA9IHo7CgoJfQoKCXNldCggeCwgeSwgeiApIHsKCgkJaWYgKCB6ID09PSB1bmRlZmluZWQgKSB6ID0gdGhpcy56OyAvLyBzcHJpdGUuc2NhbGUuc2V0KHgseSkKCgkJdGhpcy54ID0geDsKCQl0aGlzLnkgPSB5OwoJCXRoaXMueiA9IHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRTY2FsYXIoIHNjYWxhciApIHsKCgkJdGhpcy54ID0gc2NhbGFyOwoJCXRoaXMueSA9IHNjYWxhcjsKCQl0aGlzLnogPSBzY2FsYXI7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYKCB4ICkgewoKCQl0aGlzLnggPSB4OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WSggeSApIHsKCgkJdGhpcy55ID0geTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFooIHogKSB7CgoJCXRoaXMueiA9IHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRDb21wb25lbnQoIGluZGV4LCB2YWx1ZSApIHsKCgkJc3dpdGNoICggaW5kZXggKSB7CgoJCQljYXNlIDA6IHRoaXMueCA9IHZhbHVlOyBicmVhazsKCQkJY2FzZSAxOiB0aGlzLnkgPSB2YWx1ZTsgYnJlYWs7CgkJCWNhc2UgMjogdGhpcy56ID0gdmFsdWU7IGJyZWFrOwoJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRDb21wb25lbnQoIGluZGV4ICkgewoKCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCWNhc2UgMDogcmV0dXJuIHRoaXMueDsKCQkJY2FzZSAxOiByZXR1cm4gdGhpcy55OwoJCQljYXNlIDI6IHJldHVybiB0aGlzLno7CgkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgoJCX0KCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy54LCB0aGlzLnksIHRoaXMueiApOwoKCX0KCgljb3B5KCB2ICkgewoKCQl0aGlzLnggPSB2Lng7CgkJdGhpcy55ID0gdi55OwoJCXRoaXMueiA9IHYuejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZCggdiApIHsKCgkJdGhpcy54ICs9IHYueDsKCQl0aGlzLnkgKz0gdi55OwoJCXRoaXMueiArPSB2Lno7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRTY2FsYXIoIHMgKSB7CgoJCXRoaXMueCArPSBzOwoJCXRoaXMueSArPSBzOwoJCXRoaXMueiArPSBzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkVmVjdG9ycyggYSwgYiApIHsKCgkJdGhpcy54ID0gYS54ICsgYi54OwoJCXRoaXMueSA9IGEueSArIGIueTsKCQl0aGlzLnogPSBhLnogKyBiLno7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRTY2FsZWRWZWN0b3IoIHYsIHMgKSB7CgoJCXRoaXMueCArPSB2LnggKiBzOwoJCXRoaXMueSArPSB2LnkgKiBzOwoJCXRoaXMueiArPSB2LnogKiBzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3ViKCB2ICkgewoKCQl0aGlzLnggLT0gdi54OwoJCXRoaXMueSAtPSB2Lnk7CgkJdGhpcy56IC09IHYuejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN1YlNjYWxhciggcyApIHsKCgkJdGhpcy54IC09IHM7CgkJdGhpcy55IC09IHM7CgkJdGhpcy56IC09IHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdWJWZWN0b3JzKCBhLCBiICkgewoKCQl0aGlzLnggPSBhLnggLSBiLng7CgkJdGhpcy55ID0gYS55IC0gYi55OwoJCXRoaXMueiA9IGEueiAtIGIuejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5KCB2ICkgewoKCQl0aGlzLnggKj0gdi54OwoJCXRoaXMueSAqPSB2Lnk7CgkJdGhpcy56ICo9IHYuejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5U2NhbGFyKCBzY2FsYXIgKSB7CgoJCXRoaXMueCAqPSBzY2FsYXI7CgkJdGhpcy55ICo9IHNjYWxhcjsKCQl0aGlzLnogKj0gc2NhbGFyOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbXVsdGlwbHlWZWN0b3JzKCBhLCBiICkgewoKCQl0aGlzLnggPSBhLnggKiBiLng7CgkJdGhpcy55ID0gYS55ICogYi55OwoJCXRoaXMueiA9IGEueiAqIGIuejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5RXVsZXIoIGV1bGVyICkgewoKCQlyZXR1cm4gdGhpcy5hcHBseVF1YXRlcm5pb24oIF9xdWF0ZXJuaW9uJDQuc2V0RnJvbUV1bGVyKCBldWxlciApICk7CgoJfQoKCWFwcGx5QXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApIHsKCgkJcmV0dXJuIHRoaXMuYXBwbHlRdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiQ0LnNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICkgKTsKCgl9CgoJYXBwbHlNYXRyaXgzKCBtICkgewoKCQljb25zdCB4ID0gdGhpcy54LCB5ID0gdGhpcy55LCB6ID0gdGhpcy56OwoJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQl0aGlzLnggPSBlWyAwIF0gKiB4ICsgZVsgMyBdICogeSArIGVbIDYgXSAqIHo7CgkJdGhpcy55ID0gZVsgMSBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA3IF0gKiB6OwoJCXRoaXMueiA9IGVbIDIgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOCBdICogejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5Tm9ybWFsTWF0cml4KCBtICkgewoKCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDMoIG0gKS5ub3JtYWxpemUoKTsKCgl9CgoJYXBwbHlNYXRyaXg0KCBtICkgewoKCQljb25zdCB4ID0gdGhpcy54LCB5ID0gdGhpcy55LCB6ID0gdGhpcy56OwoJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQljb25zdCB3ID0gMSAvICggZVsgMyBdICogeCArIGVbIDcgXSAqIHkgKyBlWyAxMSBdICogeiArIGVbIDE1IF0gKTsKCgkJdGhpcy54ID0gKCBlWyAwIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDggXSAqIHogKyBlWyAxMiBdICkgKiB3OwoJCXRoaXMueSA9ICggZVsgMSBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA5IF0gKiB6ICsgZVsgMTMgXSApICogdzsKCQl0aGlzLnogPSAoIGVbIDIgXSAqIHggKyBlWyA2IF0gKiB5ICsgZVsgMTAgXSAqIHogKyBlWyAxNCBdICkgKiB3OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYXBwbHlRdWF0ZXJuaW9uKCBxICkgewoKCQkvLyBxdWF0ZXJuaW9uIHEgaXMgYXNzdW1lZCB0byBoYXZlIHVuaXQgbGVuZ3RoCgoJCWNvbnN0IHZ4ID0gdGhpcy54LCB2eSA9IHRoaXMueSwgdnogPSB0aGlzLno7CgkJY29uc3QgcXggPSBxLngsIHF5ID0gcS55LCBxeiA9IHEueiwgcXcgPSBxLnc7CgoJCS8vIHQgPSAyICogY3Jvc3MoIHEueHl6LCB2ICk7CgkJY29uc3QgdHggPSAyICogKCBxeSAqIHZ6IC0gcXogKiB2eSApOwoJCWNvbnN0IHR5ID0gMiAqICggcXogKiB2eCAtIHF4ICogdnogKTsKCQljb25zdCB0eiA9IDIgKiAoIHF4ICogdnkgLSBxeSAqIHZ4ICk7CgoJCS8vIHYgKyBxLncgKiB0ICsgY3Jvc3MoIHEueHl6LCB0ICk7CgkJdGhpcy54ID0gdnggKyBxdyAqIHR4ICsgcXkgKiB0eiAtIHF6ICogdHk7CgkJdGhpcy55ID0gdnkgKyBxdyAqIHR5ICsgcXogKiB0eCAtIHF4ICogdHo7CgkJdGhpcy56ID0gdnogKyBxdyAqIHR6ICsgcXggKiB0eSAtIHF5ICogdHg7CgoJCXJldHVybiB0aGlzOwoKCX0KCglwcm9qZWN0KCBjYW1lcmEgKSB7CgoJCXJldHVybiB0aGlzLmFwcGx5TWF0cml4NCggY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSApLmFwcGx5TWF0cml4NCggY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKTsKCgl9CgoJdW5wcm9qZWN0KCBjYW1lcmEgKSB7CgoJCXJldHVybiB0aGlzLmFwcGx5TWF0cml4NCggY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICkuYXBwbHlNYXRyaXg0KCBjYW1lcmEubWF0cml4V29ybGQgKTsKCgl9CgoJdHJhbnNmb3JtRGlyZWN0aW9uKCBtICkgewoKCQkvLyBpbnB1dDogVEhSRUUuTWF0cml4NCBhZmZpbmUgbWF0cml4CgkJLy8gdmVjdG9yIGludGVycHJldGVkIGFzIGEgZGlyZWN0aW9uCgoJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CgkJY29uc3QgZSA9IG0uZWxlbWVudHM7CgoJCXRoaXMueCA9IGVbIDAgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgOCBdICogejsKCQl0aGlzLnkgPSBlWyAxIF0gKiB4ICsgZVsgNSBdICogeSArIGVbIDkgXSAqIHo7CgkJdGhpcy56ID0gZVsgMiBdICogeCArIGVbIDYgXSAqIHkgKyBlWyAxMCBdICogejsKCgkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCk7CgoJfQoKCWRpdmlkZSggdiApIHsKCgkJdGhpcy54IC89IHYueDsKCQl0aGlzLnkgLz0gdi55OwoJCXRoaXMueiAvPSB2Lno7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCgkJcmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIoIDEgLyBzY2FsYXIgKTsKCgl9CgoJbWluKCB2ICkgewoKCQl0aGlzLnggPSBNYXRoLm1pbiggdGhpcy54LCB2LnggKTsKCQl0aGlzLnkgPSBNYXRoLm1pbiggdGhpcy55LCB2LnkgKTsKCQl0aGlzLnogPSBNYXRoLm1pbiggdGhpcy56LCB2LnogKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW1heCggdiApIHsKCgkJdGhpcy54ID0gTWF0aC5tYXgoIHRoaXMueCwgdi54ICk7CgkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CgkJdGhpcy56ID0gTWF0aC5tYXgoIHRoaXMueiwgdi56ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbGFtcCggbWluLCBtYXggKSB7CgoJCS8vIGFzc3VtZXMgbWluIDwgbWF4LCBjb21wb25lbnR3aXNlCgoJCXRoaXMueCA9IE1hdGgubWF4KCBtaW4ueCwgTWF0aC5taW4oIG1heC54LCB0aGlzLnggKSApOwoJCXRoaXMueSA9IE1hdGgubWF4KCBtaW4ueSwgTWF0aC5taW4oIG1heC55LCB0aGlzLnkgKSApOwoJCXRoaXMueiA9IE1hdGgubWF4KCBtaW4ueiwgTWF0aC5taW4oIG1heC56LCB0aGlzLnogKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xhbXBTY2FsYXIoIG1pblZhbCwgbWF4VmFsICkgewoKCQl0aGlzLnggPSBNYXRoLm1heCggbWluVmFsLCBNYXRoLm1pbiggbWF4VmFsLCB0aGlzLnggKSApOwoJCXRoaXMueSA9IE1hdGgubWF4KCBtaW5WYWwsIE1hdGgubWluKCBtYXhWYWwsIHRoaXMueSApICk7CgkJdGhpcy56ID0gTWF0aC5tYXgoIG1pblZhbCwgTWF0aC5taW4oIG1heFZhbCwgdGhpcy56ICkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsYW1wTGVuZ3RoKCBtaW4sIG1heCApIHsKCgkJY29uc3QgbGVuZ3RoID0gdGhpcy5sZW5ndGgoKTsKCgkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCBsZW5ndGggfHwgMSApLm11bHRpcGx5U2NhbGFyKCBNYXRoLm1heCggbWluLCBNYXRoLm1pbiggbWF4LCBsZW5ndGggKSApICk7CgoJfQoKCWZsb29yKCkgewoKCQl0aGlzLnggPSBNYXRoLmZsb29yKCB0aGlzLnggKTsKCQl0aGlzLnkgPSBNYXRoLmZsb29yKCB0aGlzLnkgKTsKCQl0aGlzLnogPSBNYXRoLmZsb29yKCB0aGlzLnogKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNlaWwoKSB7CgoJCXRoaXMueCA9IE1hdGguY2VpbCggdGhpcy54ICk7CgkJdGhpcy55ID0gTWF0aC5jZWlsKCB0aGlzLnkgKTsKCQl0aGlzLnogPSBNYXRoLmNlaWwoIHRoaXMueiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm91bmQoKSB7CgoJCXRoaXMueCA9IE1hdGgucm91bmQoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGgucm91bmQoIHRoaXMueSApOwoJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm91bmRUb1plcm8oKSB7CgoJCXRoaXMueCA9IE1hdGgudHJ1bmMoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGgudHJ1bmMoIHRoaXMueSApOwoJCXRoaXMueiA9IE1hdGgudHJ1bmMoIHRoaXMueiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbmVnYXRlKCkgewoKCQl0aGlzLnggPSAtIHRoaXMueDsKCQl0aGlzLnkgPSAtIHRoaXMueTsKCQl0aGlzLnogPSAtIHRoaXMuejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRvdCggdiApIHsKCgkJcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYuejsKCgl9CgoJLy8gVE9ETyBsZW5ndGhTcXVhcmVkPwoKCWxlbmd0aFNxKCkgewoKCQlyZXR1cm4gdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56OwoKCX0KCglsZW5ndGgoKSB7CgoJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiApOwoKCX0KCgltYW5oYXR0YW5MZW5ndGgoKSB7CgoJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICkgKyBNYXRoLmFicyggdGhpcy56ICk7CgoJfQoKCW5vcm1hbGl6ZSgpIHsKCgkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCgl9CgoJc2V0TGVuZ3RoKCBsZW5ndGggKSB7CgoJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCgl9CgoJbGVycCggdiwgYWxwaGEgKSB7CgoJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CgkJdGhpcy55ICs9ICggdi55IC0gdGhpcy55ICkgKiBhbHBoYTsKCQl0aGlzLnogKz0gKCB2LnogLSB0aGlzLnogKSAqIGFscGhhOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbGVycFZlY3RvcnMoIHYxLCB2MiwgYWxwaGEgKSB7CgoJCXRoaXMueCA9IHYxLnggKyAoIHYyLnggLSB2MS54ICkgKiBhbHBoYTsKCQl0aGlzLnkgPSB2MS55ICsgKCB2Mi55IC0gdjEueSApICogYWxwaGE7CgkJdGhpcy56ID0gdjEueiArICggdjIueiAtIHYxLnogKSAqIGFscGhhOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY3Jvc3MoIHYgKSB7CgoJCXJldHVybiB0aGlzLmNyb3NzVmVjdG9ycyggdGhpcywgdiApOwoKCX0KCgljcm9zc1ZlY3RvcnMoIGEsIGIgKSB7CgoJCWNvbnN0IGF4ID0gYS54LCBheSA9IGEueSwgYXogPSBhLno7CgkJY29uc3QgYnggPSBiLngsIGJ5ID0gYi55LCBieiA9IGIuejsKCgkJdGhpcy54ID0gYXkgKiBieiAtIGF6ICogYnk7CgkJdGhpcy55ID0gYXogKiBieCAtIGF4ICogYno7CgkJdGhpcy56ID0gYXggKiBieSAtIGF5ICogYng7CgoJCXJldHVybiB0aGlzOwoKCX0KCglwcm9qZWN0T25WZWN0b3IoIHYgKSB7CgoJCWNvbnN0IGRlbm9taW5hdG9yID0gdi5sZW5ndGhTcSgpOwoKCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIHRoaXMuc2V0KCAwLCAwLCAwICk7CgoJCWNvbnN0IHNjYWxhciA9IHYuZG90KCB0aGlzICkgLyBkZW5vbWluYXRvcjsKCgkJcmV0dXJuIHRoaXMuY29weSggdiApLm11bHRpcGx5U2NhbGFyKCBzY2FsYXIgKTsKCgl9CgoJcHJvamVjdE9uUGxhbmUoIHBsYW5lTm9ybWFsICkgewoKCQlfdmVjdG9yJGMuY29weSggdGhpcyApLnByb2plY3RPblZlY3RvciggcGxhbmVOb3JtYWwgKTsKCgkJcmV0dXJuIHRoaXMuc3ViKCBfdmVjdG9yJGMgKTsKCgl9CgoJcmVmbGVjdCggbm9ybWFsICkgewoKCQkvLyByZWZsZWN0IGluY2lkZW50IHZlY3RvciBvZmYgcGxhbmUgb3J0aG9nb25hbCB0byBub3JtYWwKCQkvLyBub3JtYWwgaXMgYXNzdW1lZCB0byBoYXZlIHVuaXQgbGVuZ3RoCgoJCXJldHVybiB0aGlzLnN1YiggX3ZlY3RvciRjLmNvcHkoIG5vcm1hbCApLm11bHRpcGx5U2NhbGFyKCAyICogdGhpcy5kb3QoIG5vcm1hbCApICkgKTsKCgl9CgoJYW5nbGVUbyggdiApIHsKCgkJY29uc3QgZGVub21pbmF0b3IgPSBNYXRoLnNxcnQoIHRoaXMubGVuZ3RoU3EoKSAqIHYubGVuZ3RoU3EoKSApOwoKCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIE1hdGguUEkgLyAyOwoKCQljb25zdCB0aGV0YSA9IHRoaXMuZG90KCB2ICkgLyBkZW5vbWluYXRvcjsKCgkJLy8gY2xhbXAsIHRvIGhhbmRsZSBudW1lcmljYWwgcHJvYmxlbXMKCgkJcmV0dXJuIE1hdGguYWNvcyggY2xhbXAoIHRoZXRhLCAtIDEsIDEgKSApOwoKCX0KCglkaXN0YW5jZVRvKCB2ICkgewoKCQlyZXR1cm4gTWF0aC5zcXJ0KCB0aGlzLmRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgKTsKCgl9CgoJZGlzdGFuY2VUb1NxdWFyZWQoIHYgKSB7CgoJCWNvbnN0IGR4ID0gdGhpcy54IC0gdi54LCBkeSA9IHRoaXMueSAtIHYueSwgZHogPSB0aGlzLnogLSB2Lno7CgoJCXJldHVybiBkeCAqIGR4ICsgZHkgKiBkeSArIGR6ICogZHo7CgoJfQoKCW1hbmhhdHRhbkRpc3RhbmNlVG8oIHYgKSB7CgoJCXJldHVybiBNYXRoLmFicyggdGhpcy54IC0gdi54ICkgKyBNYXRoLmFicyggdGhpcy55IC0gdi55ICkgKyBNYXRoLmFicyggdGhpcy56IC0gdi56ICk7CgoJfQoKCXNldEZyb21TcGhlcmljYWwoIHMgKSB7CgoJCXJldHVybiB0aGlzLnNldEZyb21TcGhlcmljYWxDb29yZHMoIHMucmFkaXVzLCBzLnBoaSwgcy50aGV0YSApOwoKCX0KCglzZXRGcm9tU3BoZXJpY2FsQ29vcmRzKCByYWRpdXMsIHBoaSwgdGhldGEgKSB7CgoJCWNvbnN0IHNpblBoaVJhZGl1cyA9IE1hdGguc2luKCBwaGkgKSAqIHJhZGl1czsKCgkJdGhpcy54ID0gc2luUGhpUmFkaXVzICogTWF0aC5zaW4oIHRoZXRhICk7CgkJdGhpcy55ID0gTWF0aC5jb3MoIHBoaSApICogcmFkaXVzOwoJCXRoaXMueiA9IHNpblBoaVJhZGl1cyAqIE1hdGguY29zKCB0aGV0YSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbUN5bGluZHJpY2FsKCBjICkgewoKCQlyZXR1cm4gdGhpcy5zZXRGcm9tQ3lsaW5kcmljYWxDb29yZHMoIGMucmFkaXVzLCBjLnRoZXRhLCBjLnkgKTsKCgl9CgoJc2V0RnJvbUN5bGluZHJpY2FsQ29vcmRzKCByYWRpdXMsIHRoZXRhLCB5ICkgewoKCQl0aGlzLnggPSByYWRpdXMgKiBNYXRoLnNpbiggdGhldGEgKTsKCQl0aGlzLnkgPSB5OwoJCXRoaXMueiA9IHJhZGl1cyAqIE1hdGguY29zKCB0aGV0YSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBtICkgewoKCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJdGhpcy54ID0gZVsgMTIgXTsKCQl0aGlzLnkgPSBlWyAxMyBdOwoJCXRoaXMueiA9IGVbIDE0IF07CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tTWF0cml4U2NhbGUoIG0gKSB7CgoJCWNvbnN0IHN4ID0gdGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAwICkubGVuZ3RoKCk7CgkJY29uc3Qgc3kgPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDEgKS5sZW5ndGgoKTsKCQljb25zdCBzeiA9IHRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgMiApLmxlbmd0aCgpOwoKCQl0aGlzLnggPSBzeDsKCQl0aGlzLnkgPSBzeTsKCQl0aGlzLnogPSBzejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21NYXRyaXhDb2x1bW4oIG0sIGluZGV4ICkgewoKCQlyZXR1cm4gdGhpcy5mcm9tQXJyYXkoIG0uZWxlbWVudHMsIGluZGV4ICogNCApOwoKCX0KCglzZXRGcm9tTWF0cml4M0NvbHVtbiggbSwgaW5kZXggKSB7CgoJCXJldHVybiB0aGlzLmZyb21BcnJheSggbS5lbGVtZW50cywgaW5kZXggKiAzICk7CgoJfQoKCXNldEZyb21FdWxlciggZSApIHsKCgkJdGhpcy54ID0gZS5feDsKCQl0aGlzLnkgPSBlLl95OwoJCXRoaXMueiA9IGUuX3o7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tQ29sb3IoIGMgKSB7CgoJCXRoaXMueCA9IGMucjsKCQl0aGlzLnkgPSBjLmc7CgkJdGhpcy56ID0gYy5iOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCB2ICkgewoKCQlyZXR1cm4gKCAoIHYueCA9PT0gdGhpcy54ICkgJiYgKCB2LnkgPT09IHRoaXMueSApICYmICggdi56ID09PSB0aGlzLnogKSApOwoKCX0KCglmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKCQl0aGlzLnggPSBhcnJheVsgb2Zmc2V0IF07CgkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCQl0aGlzLnogPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy54OwoJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRoaXMuejsKCgkJcmV0dXJuIGFycmF5OwoKCX0KCglmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKCQl0aGlzLnggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKCQl0aGlzLnkgPSBhdHRyaWJ1dGUuZ2V0WSggaW5kZXggKTsKCQl0aGlzLnogPSBhdHRyaWJ1dGUuZ2V0WiggaW5kZXggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJhbmRvbSgpIHsKCgkJdGhpcy54ID0gTWF0aC5yYW5kb20oKTsKCQl0aGlzLnkgPSBNYXRoLnJhbmRvbSgpOwoJCXRoaXMueiA9IE1hdGgucmFuZG9tKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyYW5kb21EaXJlY3Rpb24oKSB7CgoJCS8vIERlcml2ZWQgZnJvbSBodHRwczovL21hdGh3b3JsZC53b2xmcmFtLmNvbS9TcGhlcmVQb2ludFBpY2tpbmcuaHRtbAoKCQljb25zdCB1ID0gKCBNYXRoLnJhbmRvbSgpIC0gMC41ICkgKiAyOwoJCWNvbnN0IHQgPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDI7CgkJY29uc3QgZiA9IE1hdGguc3FydCggMSAtIHUgKiogMiApOwoKCQl0aGlzLnggPSBmICogTWF0aC5jb3MoIHQgKTsKCQl0aGlzLnkgPSBmICogTWF0aC5zaW4oIHQgKTsKCQl0aGlzLnogPSB1OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgoJCXlpZWxkIHRoaXMueDsKCQl5aWVsZCB0aGlzLnk7CgkJeWllbGQgdGhpcy56OwoKCX0KCn0KCmNvbnN0IF92ZWN0b3IkYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3F1YXRlcm5pb24kNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFF1YXRlcm5pb24oKTsKCmNsYXNzIEJveDMgewoKCWNvbnN0cnVjdG9yKCBtaW4gPSBuZXcgVmVjdG9yMyggKyBJbmZpbml0eSwgKyBJbmZpbml0eSwgKyBJbmZpbml0eSApLCBtYXggPSBuZXcgVmVjdG9yMyggLSBJbmZpbml0eSwgLSBJbmZpbml0eSwgLSBJbmZpbml0eSApICkgewoKCQl0aGlzLmlzQm94MyA9IHRydWU7CgoJCXRoaXMubWluID0gbWluOwoJCXRoaXMubWF4ID0gbWF4OwoKCX0KCglzZXQoIG1pbiwgbWF4ICkgewoKCQl0aGlzLm1pbi5jb3B5KCBtaW4gKTsKCQl0aGlzLm1heC5jb3B5KCBtYXggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21BcnJheSggYXJyYXkgKSB7CgoJCXRoaXMubWFrZUVtcHR5KCk7CgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBhcnJheS5sZW5ndGg7IGkgPCBpbDsgaSArPSAzICkgewoKCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdmVjdG9yJGIuZnJvbUFycmF5KCBhcnJheSwgaSApICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSApIHsKCgkJdGhpcy5tYWtlRW1wdHkoKTsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGF0dHJpYnV0ZS5jb3VudDsgaSA8IGlsOyBpICsrICkgewoKCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdmVjdG9yJGIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpICkgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbVBvaW50cyggcG9pbnRzICkgewoKCQl0aGlzLm1ha2VFbXB0eSgpOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJdGhpcy5leHBhbmRCeVBvaW50KCBwb2ludHNbIGkgXSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tQ2VudGVyQW5kU2l6ZSggY2VudGVyLCBzaXplICkgewoKCQljb25zdCBoYWxmU2l6ZSA9IF92ZWN0b3IkYi5jb3B5KCBzaXplICkubXVsdGlwbHlTY2FsYXIoIDAuNSApOwoKCQl0aGlzLm1pbi5jb3B5KCBjZW50ZXIgKS5zdWIoIGhhbGZTaXplICk7CgkJdGhpcy5tYXguY29weSggY2VudGVyICkuYWRkKCBoYWxmU2l6ZSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbU9iamVjdCggb2JqZWN0LCBwcmVjaXNlID0gZmFsc2UgKSB7CgoJCXRoaXMubWFrZUVtcHR5KCk7CgoJCXJldHVybiB0aGlzLmV4cGFuZEJ5T2JqZWN0KCBvYmplY3QsIHByZWNpc2UgKTsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9CgoJY29weSggYm94ICkgewoKCQl0aGlzLm1pbi5jb3B5KCBib3gubWluICk7CgkJdGhpcy5tYXguY29weSggYm94Lm1heCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWFrZUVtcHR5KCkgewoKCQl0aGlzLm1pbi54ID0gdGhpcy5taW4ueSA9IHRoaXMubWluLnogPSArIEluZmluaXR5OwoJCXRoaXMubWF4LnggPSB0aGlzLm1heC55ID0gdGhpcy5tYXgueiA9IC0gSW5maW5pdHk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglpc0VtcHR5KCkgewoKCQkvLyB0aGlzIGlzIGEgbW9yZSByb2J1c3QgY2hlY2sgZm9yIGVtcHR5IHRoYW4gKCB2b2x1bWUgPD0gMCApIGJlY2F1c2Ugdm9sdW1lIGNhbiBnZXQgcG9zaXRpdmUgd2l0aCB0d28gbmVnYXRpdmUgYXhlcwoKCQlyZXR1cm4gKCB0aGlzLm1heC54IDwgdGhpcy5taW4ueCApIHx8ICggdGhpcy5tYXgueSA8IHRoaXMubWluLnkgKSB8fCAoIHRoaXMubWF4LnogPCB0aGlzLm1pbi56ICk7CgoJfQoKCWdldENlbnRlciggdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGhpcy5pc0VtcHR5KCkgPyB0YXJnZXQuc2V0KCAwLCAwLCAwICkgOiB0YXJnZXQuYWRkVmVjdG9ycyggdGhpcy5taW4sIHRoaXMubWF4ICkubXVsdGlwbHlTY2FsYXIoIDAuNSApOwoKCX0KCglnZXRTaXplKCB0YXJnZXQgKSB7CgoJCXJldHVybiB0aGlzLmlzRW1wdHkoKSA/IHRhcmdldC5zZXQoIDAsIDAsIDAgKSA6IHRhcmdldC5zdWJWZWN0b3JzKCB0aGlzLm1heCwgdGhpcy5taW4gKTsKCgl9CgoJZXhwYW5kQnlQb2ludCggcG9pbnQgKSB7CgoJCXRoaXMubWluLm1pbiggcG9pbnQgKTsKCQl0aGlzLm1heC5tYXgoIHBvaW50ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglleHBhbmRCeVZlY3RvciggdmVjdG9yICkgewoKCQl0aGlzLm1pbi5zdWIoIHZlY3RvciApOwoJCXRoaXMubWF4LmFkZCggdmVjdG9yICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglleHBhbmRCeVNjYWxhciggc2NhbGFyICkgewoKCQl0aGlzLm1pbi5hZGRTY2FsYXIoIC0gc2NhbGFyICk7CgkJdGhpcy5tYXguYWRkU2NhbGFyKCBzY2FsYXIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWV4cGFuZEJ5T2JqZWN0KCBvYmplY3QsIHByZWNpc2UgPSBmYWxzZSApIHsKCgkJLy8gQ29tcHV0ZXMgdGhlIHdvcmxkLWF4aXMtYWxpZ25lZCBib3VuZGluZyBib3ggb2YgYW4gb2JqZWN0IChpbmNsdWRpbmcgaXRzIGNoaWxkcmVuKSwKCQkvLyBhY2NvdW50aW5nIGZvciBib3RoIHRoZSBvYmplY3QncywgYW5kIGNoaWxkcmVuJ3MsIHdvcmxkIHRyYW5zZm9ybXMKCgkJb2JqZWN0LnVwZGF0ZVdvcmxkTWF0cml4KCBmYWxzZSwgZmFsc2UgKTsKCgkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgoJCWlmICggZ2VvbWV0cnkgIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCAncG9zaXRpb24nICk7CgoJCQkvLyBwcmVjaXNlIEFBQkIgY29tcHV0YXRpb24gYmFzZWQgb24gdmVydGV4IGRhdGEgcmVxdWlyZXMgYXQgbGVhc3QgYSBwb3NpdGlvbiBhdHRyaWJ1dGUuCgkJCS8vIGluc3RhbmNpbmcgaXNuJ3Qgc3VwcG9ydGVkIHNvIGZhciBhbmQgdXNlcyB0aGUgbm9ybWFsIChjb25zZXJ2YXRpdmUpIGNvZGUgcGF0aC4KCgkJCWlmICggcHJlY2lzZSA9PT0gdHJ1ZSAmJiBwb3NpdGlvbkF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICYmIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggIT09IHRydWUgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCQlpZiAoIG9iamVjdC5pc01lc2ggPT09IHRydWUgKSB7CgoJCQkJCQlvYmplY3QuZ2V0VmVydGV4UG9zaXRpb24oIGksIF92ZWN0b3IkYiApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJX3ZlY3RvciRiLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICk7CgoJCQkJCX0KCgkJCQkJX3ZlY3RvciRiLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgkJCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdmVjdG9yJGIgKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWlmICggb2JqZWN0LmJvdW5kaW5nQm94ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCS8vIG9iamVjdC1sZXZlbCBib3VuZGluZyBib3gKCgkJCQkJaWYgKCBvYmplY3QuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQkJCQlvYmplY3QuY29tcHV0ZUJvdW5kaW5nQm94KCk7CgoJCQkJCX0KCgkJCQkJX2JveCQ0LmNvcHkoIG9iamVjdC5ib3VuZGluZ0JveCApOwoKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBnZW9tZXRyeS1sZXZlbCBib3VuZGluZyBib3gKCgkJCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCgkJCQkJCWdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQkJCQl9CgoJCQkJCV9ib3gkNC5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ0JveCApOwoKCQkJCX0KCgkJCQlfYm94JDQuYXBwbHlNYXRyaXg0KCBvYmplY3QubWF0cml4V29ybGQgKTsKCgkJCQl0aGlzLnVuaW9uKCBfYm94JDQgKTsKCgkJCX0KCgkJfQoKCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCXRoaXMuZXhwYW5kQnlPYmplY3QoIGNoaWxkcmVuWyBpIF0sIHByZWNpc2UgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29udGFpbnNQb2ludCggcG9pbnQgKSB7CgoJCXJldHVybiBwb2ludC54IDwgdGhpcy5taW4ueCB8fCBwb2ludC54ID4gdGhpcy5tYXgueCB8fAoJCQlwb2ludC55IDwgdGhpcy5taW4ueSB8fCBwb2ludC55ID4gdGhpcy5tYXgueSB8fAoJCQlwb2ludC56IDwgdGhpcy5taW4ueiB8fCBwb2ludC56ID4gdGhpcy5tYXgueiA/IGZhbHNlIDogdHJ1ZTsKCgl9CgoJY29udGFpbnNCb3goIGJveCApIHsKCgkJcmV0dXJuIHRoaXMubWluLnggPD0gYm94Lm1pbi54ICYmIGJveC5tYXgueCA8PSB0aGlzLm1heC54ICYmCgkJCXRoaXMubWluLnkgPD0gYm94Lm1pbi55ICYmIGJveC5tYXgueSA8PSB0aGlzLm1heC55ICYmCgkJCXRoaXMubWluLnogPD0gYm94Lm1pbi56ICYmIGJveC5tYXgueiA8PSB0aGlzLm1heC56OwoKCX0KCglnZXRQYXJhbWV0ZXIoIHBvaW50LCB0YXJnZXQgKSB7CgoJCS8vIFRoaXMgY2FuIHBvdGVudGlhbGx5IGhhdmUgYSBkaXZpZGUgYnkgemVybyBpZiB0aGUgYm94CgkJLy8gaGFzIGEgc2l6ZSBkaW1lbnNpb24gb2YgMC4KCgkJcmV0dXJuIHRhcmdldC5zZXQoCgkJCSggcG9pbnQueCAtIHRoaXMubWluLnggKSAvICggdGhpcy5tYXgueCAtIHRoaXMubWluLnggKSwKCQkJKCBwb2ludC55IC0gdGhpcy5taW4ueSApIC8gKCB0aGlzLm1heC55IC0gdGhpcy5taW4ueSApLAoJCQkoIHBvaW50LnogLSB0aGlzLm1pbi56ICkgLyAoIHRoaXMubWF4LnogLSB0aGlzLm1pbi56ICkKCQkpOwoKCX0KCglpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCS8vIHVzaW5nIDYgc3BsaXR0aW5nIHBsYW5lcyB0byBydWxlIG91dCBpbnRlcnNlY3Rpb25zLgoJCXJldHVybiBib3gubWF4LnggPCB0aGlzLm1pbi54IHx8IGJveC5taW4ueCA+IHRoaXMubWF4LnggfHwKCQkJYm94Lm1heC55IDwgdGhpcy5taW4ueSB8fCBib3gubWluLnkgPiB0aGlzLm1heC55IHx8CgkJCWJveC5tYXgueiA8IHRoaXMubWluLnogfHwgYm94Lm1pbi56ID4gdGhpcy5tYXgueiA/IGZhbHNlIDogdHJ1ZTsKCgl9CgoJaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICkgewoKCQkvLyBGaW5kIHRoZSBwb2ludCBvbiB0aGUgQUFCQiBjbG9zZXN0IHRvIHRoZSBzcGhlcmUgY2VudGVyLgoJCXRoaXMuY2xhbXBQb2ludCggc3BoZXJlLmNlbnRlciwgX3ZlY3RvciRiICk7CgoJCS8vIElmIHRoYXQgcG9pbnQgaXMgaW5zaWRlIHRoZSBzcGhlcmUsIHRoZSBBQUJCIGFuZCBzcGhlcmUgaW50ZXJzZWN0LgoJCXJldHVybiBfdmVjdG9yJGIuZGlzdGFuY2VUb1NxdWFyZWQoIHNwaGVyZS5jZW50ZXIgKSA8PSAoIHNwaGVyZS5yYWRpdXMgKiBzcGhlcmUucmFkaXVzICk7CgoJfQoKCWludGVyc2VjdHNQbGFuZSggcGxhbmUgKSB7CgoJCS8vIFdlIGNvbXB1dGUgdGhlIG1pbmltdW0gYW5kIG1heGltdW0gZG90IHByb2R1Y3QgdmFsdWVzLiBJZiB0aG9zZSB2YWx1ZXMKCQkvLyBhcmUgb24gdGhlIHNhbWUgc2lkZSAoYmFjayBvciBmcm9udCkgb2YgdGhlIHBsYW5lLCB0aGVuIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbi4KCgkJbGV0IG1pbiwgbWF4OwoKCQlpZiAoIHBsYW5lLm5vcm1hbC54ID4gMCApIHsKCgkJCW1pbiA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5taW4ueDsKCQkJbWF4ID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1heC54OwoKCQl9IGVsc2UgewoKCQkJbWluID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1heC54OwoJCQltYXggPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWluLng7CgoJCX0KCgkJaWYgKCBwbGFuZS5ub3JtYWwueSA+IDAgKSB7CgoJCQltaW4gKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1pbi55OwoJCQltYXggKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1heC55OwoKCQl9IGVsc2UgewoKCQkJbWluICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5taW4ueTsKCgkJfQoKCQlpZiAoIHBsYW5lLm5vcm1hbC56ID4gMCApIHsKCgkJCW1pbiArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWluLno7CgkJCW1heCArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWF4Lno7CgoJCX0gZWxzZSB7CgoJCQltaW4gKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1heC56OwoJCQltYXggKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1pbi56OwoKCQl9CgoJCXJldHVybiAoIG1pbiA8PSAtIHBsYW5lLmNvbnN0YW50ICYmIG1heCA+PSAtIHBsYW5lLmNvbnN0YW50ICk7CgoJfQoKCWludGVyc2VjdHNUcmlhbmdsZSggdHJpYW5nbGUgKSB7CgoJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB7CgoJCQlyZXR1cm4gZmFsc2U7CgoJCX0KCgkJLy8gY29tcHV0ZSBib3ggY2VudGVyIGFuZCBleHRlbnRzCgkJdGhpcy5nZXRDZW50ZXIoIF9jZW50ZXIgKTsKCQlfZXh0ZW50cy5zdWJWZWN0b3JzKCB0aGlzLm1heCwgX2NlbnRlciApOwoKCQkvLyB0cmFuc2xhdGUgdHJpYW5nbGUgdG8gYWFiYiBvcmlnaW4KCQlfdjAkMi5zdWJWZWN0b3JzKCB0cmlhbmdsZS5hLCBfY2VudGVyICk7CgkJX3YxJDcuc3ViVmVjdG9ycyggdHJpYW5nbGUuYiwgX2NlbnRlciApOwoJCV92MiQ0LnN1YlZlY3RvcnMoIHRyaWFuZ2xlLmMsIF9jZW50ZXIgKTsKCgkJLy8gY29tcHV0ZSBlZGdlIHZlY3RvcnMgZm9yIHRyaWFuZ2xlCgkJX2YwLnN1YlZlY3RvcnMoIF92MSQ3LCBfdjAkMiApOwoJCV9mMS5zdWJWZWN0b3JzKCBfdjIkNCwgX3YxJDcgKTsKCQlfZjIuc3ViVmVjdG9ycyggX3YwJDIsIF92MiQ0ICk7CgoJCS8vIHRlc3QgYWdhaW5zdCBheGVzIHRoYXQgYXJlIGdpdmVuIGJ5IGNyb3NzIHByb2R1Y3QgY29tYmluYXRpb25zIG9mIHRoZSBlZGdlcyBvZiB0aGUgdHJpYW5nbGUgYW5kIHRoZSBlZGdlcyBvZiB0aGUgYWFiYgoJCS8vIG1ha2UgYW4gYXhpcyB0ZXN0aW5nIG9mIGVhY2ggb2YgdGhlIDMgc2lkZXMgb2YgdGhlIGFhYmIgYWdhaW5zdCBlYWNoIG9mIHRoZSAzIHNpZGVzIG9mIHRoZSB0cmlhbmdsZSA9IDkgYXhpcyBvZiBzZXBhcmF0aW9uCgkJLy8gYXhpc19paiA9IHVfaSB4IGZfaiAodTAsIHUxLCB1MiA9IGZhY2Ugbm9ybWFscyBvZiBhYWJiID0geCx5LHogYXhlcyB2ZWN0b3JzIHNpbmNlIGFhYmIgaXMgYXhpcyBhbGlnbmVkKQoJCWxldCBheGVzID0gWwoJCQkwLCAtIF9mMC56LCBfZjAueSwgMCwgLSBfZjEueiwgX2YxLnksIDAsIC0gX2YyLnosIF9mMi55LAoJCQlfZjAueiwgMCwgLSBfZjAueCwgX2YxLnosIDAsIC0gX2YxLngsIF9mMi56LCAwLCAtIF9mMi54LAoJCQktIF9mMC55LCBfZjAueCwgMCwgLSBfZjEueSwgX2YxLngsIDAsIC0gX2YyLnksIF9mMi54LCAwCgkJXTsKCQlpZiAoICEgc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKSApIHsKCgkJCXJldHVybiBmYWxzZTsKCgkJfQoKCQkvLyB0ZXN0IDMgZmFjZSBub3JtYWxzIGZyb20gdGhlIGFhYmIKCQlheGVzID0gWyAxLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAxIF07CgkJaWYgKCAhIHNhdEZvckF4ZXMoIGF4ZXMsIF92MCQyLCBfdjEkNywgX3YyJDQsIF9leHRlbnRzICkgKSB7CgoJCQlyZXR1cm4gZmFsc2U7CgoJCX0KCgkJLy8gZmluYWxseSB0ZXN0aW5nIHRoZSBmYWNlIG5vcm1hbCBvZiB0aGUgdHJpYW5nbGUKCQkvLyB1c2UgYWxyZWFkeSBleGlzdGluZyB0cmlhbmdsZSBlZGdlIHZlY3RvcnMgaGVyZQoJCV90cmlhbmdsZU5vcm1hbC5jcm9zc1ZlY3RvcnMoIF9mMCwgX2YxICk7CgkJYXhlcyA9IFsgX3RyaWFuZ2xlTm9ybWFsLngsIF90cmlhbmdsZU5vcm1hbC55LCBfdHJpYW5nbGVOb3JtYWwueiBdOwoKCQlyZXR1cm4gc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKTsKCgl9CgoJY2xhbXBQb2ludCggcG9pbnQsIHRhcmdldCApIHsKCgkJcmV0dXJuIHRhcmdldC5jb3B5KCBwb2ludCApLmNsYW1wKCB0aGlzLm1pbiwgdGhpcy5tYXggKTsKCgl9CgoJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuIHRoaXMuY2xhbXBQb2ludCggcG9pbnQsIF92ZWN0b3IkYiApLmRpc3RhbmNlVG8oIHBvaW50ICk7CgoJfQoKCWdldEJvdW5kaW5nU3BoZXJlKCB0YXJnZXQgKSB7CgoJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB7CgoJCQl0YXJnZXQubWFrZUVtcHR5KCk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLmdldENlbnRlciggdGFyZ2V0LmNlbnRlciApOwoKCQkJdGFyZ2V0LnJhZGl1cyA9IHRoaXMuZ2V0U2l6ZSggX3ZlY3RvciRiICkubGVuZ3RoKCkgKiAwLjU7CgoJCX0KCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJaW50ZXJzZWN0KCBib3ggKSB7CgoJCXRoaXMubWluLm1heCggYm94Lm1pbiApOwoJCXRoaXMubWF4Lm1pbiggYm94Lm1heCApOwoKCQkvLyBlbnN1cmUgdGhhdCBpZiB0aGVyZSBpcyBubyBvdmVybGFwLCB0aGUgcmVzdWx0IGlzIGZ1bGx5IGVtcHR5LCBub3Qgc2xpZ2h0bHkgZW1wdHkgd2l0aCBub24taW5mLytpbmYgdmFsdWVzIHRoYXQgd2lsbCBjYXVzZSBzdWJzZXF1ZW5jZSBpbnRlcnNlY3RzIHRvIGVycm9uZW91c2x5IHJldHVybiB2YWxpZCB2YWx1ZXMuCgkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHRoaXMubWFrZUVtcHR5KCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl1bmlvbiggYm94ICkgewoKCQl0aGlzLm1pbi5taW4oIGJveC5taW4gKTsKCQl0aGlzLm1heC5tYXgoIGJveC5tYXggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5TWF0cml4NCggbWF0cml4ICkgewoKCQkvLyB0cmFuc2Zvcm0gb2YgZW1wdHkgYm94IGlzIGFuIGVtcHR5IGJveC4KCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgcmV0dXJuIHRoaXM7CgoJCS8vIE5PVEU6IEkgYW0gdXNpbmcgYSBiaW5hcnkgcGF0dGVybiB0byBzcGVjaWZ5IGFsbCAyXjMgY29tYmluYXRpb25zIGJlbG93CgkJX3BvaW50c1sgMCBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5taW4ueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAwMAoJCV9wb2ludHNbIDEgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWluLnksIHRoaXMubWF4LnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMDEKCQlfcG9pbnRzWyAyIF0uc2V0KCB0aGlzLm1pbi54LCB0aGlzLm1heC55LCB0aGlzLm1pbi56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMDEwCgkJX3BvaW50c1sgMyBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5tYXgueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAxMQoJCV9wb2ludHNbIDQgXS5zZXQoIHRoaXMubWF4LngsIHRoaXMubWluLnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAxMDAKCQlfcG9pbnRzWyA1IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1pbi55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTAxCgkJX3BvaW50c1sgNiBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5tYXgueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDExMAoJCV9wb2ludHNbIDcgXS5zZXQoIHRoaXMubWF4LngsIHRoaXMubWF4LnksIHRoaXMubWF4LnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAxMTEKCgkJdGhpcy5zZXRGcm9tUG9pbnRzKCBfcG9pbnRzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0cmFuc2xhdGUoIG9mZnNldCApIHsKCgkJdGhpcy5taW4uYWRkKCBvZmZzZXQgKTsKCQl0aGlzLm1heC5hZGQoIG9mZnNldCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCBib3ggKSB7CgoJCXJldHVybiBib3gubWluLmVxdWFscyggdGhpcy5taW4gKSAmJiBib3gubWF4LmVxdWFscyggdGhpcy5tYXggKTsKCgl9Cgp9Cgpjb25zdCBfcG9pbnRzID0gWwoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpCl07Cgpjb25zdCBfdmVjdG9yJGIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgpjb25zdCBfYm94JDQgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CgovLyB0cmlhbmdsZSBjZW50ZXJlZCB2ZXJ0aWNlcwoKY29uc3QgX3YwJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92MSQ3ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdjIkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCi8vIHRyaWFuZ2xlIGVkZ2UgdmVjdG9ycwoKY29uc3QgX2YwID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfZjEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9mMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9jZW50ZXIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9leHRlbnRzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdHJpYW5nbGVOb3JtYWwgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF90ZXN0QXhpcyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmZ1bmN0aW9uIHNhdEZvckF4ZXMoIGF4ZXMsIHYwLCB2MSwgdjIsIGV4dGVudHMgKSB7CgoJZm9yICggbGV0IGkgPSAwLCBqID0gYXhlcy5sZW5ndGggLSAzOyBpIDw9IGo7IGkgKz0gMyApIHsKCgkJX3Rlc3RBeGlzLmZyb21BcnJheSggYXhlcywgaSApOwoJCS8vIHByb2plY3QgdGhlIGFhYmIgb250byB0aGUgc2VwYXJhdGluZyBheGlzCgkJY29uc3QgciA9IGV4dGVudHMueCAqIE1hdGguYWJzKCBfdGVzdEF4aXMueCApICsgZXh0ZW50cy55ICogTWF0aC5hYnMoIF90ZXN0QXhpcy55ICkgKyBleHRlbnRzLnogKiBNYXRoLmFicyggX3Rlc3RBeGlzLnogKTsKCQkvLyBwcm9qZWN0IGFsbCAzIHZlcnRpY2VzIG9mIHRoZSB0cmlhbmdsZSBvbnRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCQljb25zdCBwMCA9IHYwLmRvdCggX3Rlc3RBeGlzICk7CgkJY29uc3QgcDEgPSB2MS5kb3QoIF90ZXN0QXhpcyApOwoJCWNvbnN0IHAyID0gdjIuZG90KCBfdGVzdEF4aXMgKTsKCQkvLyBhY3R1YWwgdGVzdCwgYmFzaWNhbGx5IHNlZSBpZiBlaXRoZXIgb2YgdGhlIG1vc3QgZXh0cmVtZSBvZiB0aGUgdHJpYW5nbGUgcG9pbnRzIGludGVyc2VjdHMgcgoJCWlmICggTWF0aC5tYXgoIC0gTWF0aC5tYXgoIHAwLCBwMSwgcDIgKSwgTWF0aC5taW4oIHAwLCBwMSwgcDIgKSApID4gciApIHsKCgkJCS8vIHBvaW50cyBvZiB0aGUgcHJvamVjdGVkIHRyaWFuZ2xlIGFyZSBvdXRzaWRlIHRoZSBwcm9qZWN0ZWQgaGFsZi1sZW5ndGggb2YgdGhlIGFhYmIKCQkJLy8gdGhlIGF4aXMgaXMgc2VwYXJhdGluZyBhbmQgd2UgY2FuIGV4aXQKCQkJcmV0dXJuIGZhbHNlOwoKCQl9CgoJfQoKCXJldHVybiB0cnVlOwoKfQoKY29uc3QgX2JveCQzID0gLypAX19QVVJFX18qLyBuZXcgQm94MygpOwpjb25zdCBfdjEkNiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3YyJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBTcGhlcmUgewoKCWNvbnN0cnVjdG9yKCBjZW50ZXIgPSBuZXcgVmVjdG9yMygpLCByYWRpdXMgPSAtIDEgKSB7CgoJCXRoaXMuaXNTcGhlcmUgPSB0cnVlOwoKCQl0aGlzLmNlbnRlciA9IGNlbnRlcjsKCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCgl9CgoJc2V0KCBjZW50ZXIsIHJhZGl1cyApIHsKCgkJdGhpcy5jZW50ZXIuY29weSggY2VudGVyICk7CgkJdGhpcy5yYWRpdXMgPSByYWRpdXM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tUG9pbnRzKCBwb2ludHMsIG9wdGlvbmFsQ2VudGVyICkgewoKCQljb25zdCBjZW50ZXIgPSB0aGlzLmNlbnRlcjsKCgkJaWYgKCBvcHRpb25hbENlbnRlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJY2VudGVyLmNvcHkoIG9wdGlvbmFsQ2VudGVyICk7CgoJCX0gZWxzZSB7CgoJCQlfYm94JDMuc2V0RnJvbVBvaW50cyggcG9pbnRzICkuZ2V0Q2VudGVyKCBjZW50ZXIgKTsKCgkJfQoKCQlsZXQgbWF4UmFkaXVzU3EgPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJbWF4UmFkaXVzU3EgPSBNYXRoLm1heCggbWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnRzWyBpIF0gKSApOwoKCQl9CgoJCXRoaXMucmFkaXVzID0gTWF0aC5zcXJ0KCBtYXhSYWRpdXNTcSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weSggc3BoZXJlICkgewoKCQl0aGlzLmNlbnRlci5jb3B5KCBzcGhlcmUuY2VudGVyICk7CgkJdGhpcy5yYWRpdXMgPSBzcGhlcmUucmFkaXVzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJaXNFbXB0eSgpIHsKCgkJcmV0dXJuICggdGhpcy5yYWRpdXMgPCAwICk7CgoJfQoKCW1ha2VFbXB0eSgpIHsKCgkJdGhpcy5jZW50ZXIuc2V0KCAwLCAwLCAwICk7CgkJdGhpcy5yYWRpdXMgPSAtIDE7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb250YWluc1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuICggcG9pbnQuZGlzdGFuY2VUb1NxdWFyZWQoIHRoaXMuY2VudGVyICkgPD0gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKTsKCgl9CgoJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuICggcG9pbnQuZGlzdGFuY2VUbyggdGhpcy5jZW50ZXIgKSAtIHRoaXMucmFkaXVzICk7CgoJfQoKCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCgkJY29uc3QgcmFkaXVzU3VtID0gdGhpcy5yYWRpdXMgKyBzcGhlcmUucmFkaXVzOwoKCQlyZXR1cm4gc3BoZXJlLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggdGhpcy5jZW50ZXIgKSA8PSAoIHJhZGl1c1N1bSAqIHJhZGl1c1N1bSApOwoKCX0KCglpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCXJldHVybiBib3guaW50ZXJzZWN0c1NwaGVyZSggdGhpcyApOwoKCX0KCglpbnRlcnNlY3RzUGxhbmUoIHBsYW5lICkgewoKCQlyZXR1cm4gTWF0aC5hYnMoIHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggdGhpcy5jZW50ZXIgKSApIDw9IHRoaXMucmFkaXVzOwoKCX0KCgljbGFtcFBvaW50KCBwb2ludCwgdGFyZ2V0ICkgewoKCQljb25zdCBkZWx0YUxlbmd0aFNxID0gdGhpcy5jZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIHBvaW50ICk7CgoJCXRhcmdldC5jb3B5KCBwb2ludCApOwoKCQlpZiAoIGRlbHRhTGVuZ3RoU3EgPiAoIHRoaXMucmFkaXVzICogdGhpcy5yYWRpdXMgKSApIHsKCgkJCXRhcmdldC5zdWIoIHRoaXMuY2VudGVyICkubm9ybWFsaXplKCk7CgkJCXRhcmdldC5tdWx0aXBseVNjYWxhciggdGhpcy5yYWRpdXMgKS5hZGQoIHRoaXMuY2VudGVyICk7CgoJCX0KCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJZ2V0Qm91bmRpbmdCb3goIHRhcmdldCApIHsKCgkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCS8vIEVtcHR5IHNwaGVyZSBwcm9kdWNlcyBlbXB0eSBib3VuZGluZyBib3gKCQkJdGFyZ2V0Lm1ha2VFbXB0eSgpOwoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCXRhcmdldC5zZXQoIHRoaXMuY2VudGVyLCB0aGlzLmNlbnRlciApOwoJCXRhcmdldC5leHBhbmRCeVNjYWxhciggdGhpcy5yYWRpdXMgKTsKCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJYXBwbHlNYXRyaXg0KCBtYXRyaXggKSB7CgoJCXRoaXMuY2VudGVyLmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgkJdGhpcy5yYWRpdXMgPSB0aGlzLnJhZGl1cyAqIG1hdHJpeC5nZXRNYXhTY2FsZU9uQXhpcygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdHJhbnNsYXRlKCBvZmZzZXQgKSB7CgoJCXRoaXMuY2VudGVyLmFkZCggb2Zmc2V0ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglleHBhbmRCeVBvaW50KCBwb2ludCApIHsKCgkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCXRoaXMuY2VudGVyLmNvcHkoIHBvaW50ICk7CgoJCQl0aGlzLnJhZGl1cyA9IDA7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlfdjEkNi5zdWJWZWN0b3JzKCBwb2ludCwgdGhpcy5jZW50ZXIgKTsKCgkJY29uc3QgbGVuZ3RoU3EgPSBfdjEkNi5sZW5ndGhTcSgpOwoKCQlpZiAoIGxlbmd0aFNxID4gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKSB7CgoJCQkvLyBjYWxjdWxhdGUgdGhlIG1pbmltYWwgc3BoZXJlCgoJCQljb25zdCBsZW5ndGggPSBNYXRoLnNxcnQoIGxlbmd0aFNxICk7CgoJCQljb25zdCBkZWx0YSA9ICggbGVuZ3RoIC0gdGhpcy5yYWRpdXMgKSAqIDAuNTsKCgkJCXRoaXMuY2VudGVyLmFkZFNjYWxlZFZlY3RvciggX3YxJDYsIGRlbHRhIC8gbGVuZ3RoICk7CgoJCQl0aGlzLnJhZGl1cyArPSBkZWx0YTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdW5pb24oIHNwaGVyZSApIHsKCgkJaWYgKCBzcGhlcmUuaXNFbXB0eSgpICkgewoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCXRoaXMuY29weSggc3BoZXJlICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlpZiAoIHRoaXMuY2VudGVyLmVxdWFscyggc3BoZXJlLmNlbnRlciApID09PSB0cnVlICkgewoKCQkJIHRoaXMucmFkaXVzID0gTWF0aC5tYXgoIHRoaXMucmFkaXVzLCBzcGhlcmUucmFkaXVzICk7CgoJCX0gZWxzZSB7CgoJCQlfdjIkMy5zdWJWZWN0b3JzKCBzcGhlcmUuY2VudGVyLCB0aGlzLmNlbnRlciApLnNldExlbmd0aCggc3BoZXJlLnJhZGl1cyApOwoKCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdjEkNi5jb3B5KCBzcGhlcmUuY2VudGVyICkuYWRkKCBfdjIkMyApICk7CgoJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92MSQ2LmNvcHkoIHNwaGVyZS5jZW50ZXIgKS5zdWIoIF92MiQzICkgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCBzcGhlcmUgKSB7CgoJCXJldHVybiBzcGhlcmUuY2VudGVyLmVxdWFscyggdGhpcy5jZW50ZXIgKSAmJiAoIHNwaGVyZS5yYWRpdXMgPT09IHRoaXMucmFkaXVzICk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKfQoKY29uc3QgX3ZlY3RvciRhID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfc2VnQ2VudGVyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfc2VnRGlyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfZGlmZiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9lZGdlMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX2VkZ2UyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfbm9ybWFsJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBSYXkgewoKCWNvbnN0cnVjdG9yKCBvcmlnaW4gPSBuZXcgVmVjdG9yMygpLCBkaXJlY3Rpb24gPSBuZXcgVmVjdG9yMyggMCwgMCwgLSAxICkgKSB7CgoJCXRoaXMub3JpZ2luID0gb3JpZ2luOwoJCXRoaXMuZGlyZWN0aW9uID0gZGlyZWN0aW9uOwoKCX0KCglzZXQoIG9yaWdpbiwgZGlyZWN0aW9uICkgewoKCQl0aGlzLm9yaWdpbi5jb3B5KCBvcmlnaW4gKTsKCQl0aGlzLmRpcmVjdGlvbi5jb3B5KCBkaXJlY3Rpb24gKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIHJheSApIHsKCgkJdGhpcy5vcmlnaW4uY29weSggcmF5Lm9yaWdpbiApOwoJCXRoaXMuZGlyZWN0aW9uLmNvcHkoIHJheS5kaXJlY3Rpb24gKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWF0KCB0LCB0YXJnZXQgKSB7CgoJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCB0ICk7CgoJfQoKCWxvb2tBdCggdiApIHsKCgkJdGhpcy5kaXJlY3Rpb24uY29weSggdiApLnN1YiggdGhpcy5vcmlnaW4gKS5ub3JtYWxpemUoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJlY2FzdCggdCApIHsKCgkJdGhpcy5vcmlnaW4uY29weSggdGhpcy5hdCggdCwgX3ZlY3RvciRhICkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb3Nlc3RQb2ludFRvUG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCXRhcmdldC5zdWJWZWN0b3JzKCBwb2ludCwgdGhpcy5vcmlnaW4gKTsKCgkJY29uc3QgZGlyZWN0aW9uRGlzdGFuY2UgPSB0YXJnZXQuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoKCQlpZiAoIGRpcmVjdGlvbkRpc3RhbmNlIDwgMCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKTsKCgkJfQoKCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHRoaXMub3JpZ2luICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLmRpcmVjdGlvbiwgZGlyZWN0aW9uRGlzdGFuY2UgKTsKCgl9CgoJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVNxVG9Qb2ludCggcG9pbnQgKSApOwoKCX0KCglkaXN0YW5jZVNxVG9Qb2ludCggcG9pbnQgKSB7CgoJCWNvbnN0IGRpcmVjdGlvbkRpc3RhbmNlID0gX3ZlY3RvciRhLnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLm9yaWdpbiApLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJLy8gcG9pbnQgYmVoaW5kIHRoZSByYXkKCgkJaWYgKCBkaXJlY3Rpb25EaXN0YW5jZSA8IDAgKSB7CgoJCQlyZXR1cm4gdGhpcy5vcmlnaW4uZGlzdGFuY2VUb1NxdWFyZWQoIHBvaW50ICk7CgoJCX0KCgkJX3ZlY3RvciRhLmNvcHkoIHRoaXMub3JpZ2luICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLmRpcmVjdGlvbiwgZGlyZWN0aW9uRGlzdGFuY2UgKTsKCgkJcmV0dXJuIF92ZWN0b3IkYS5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnQgKTsKCgl9CgoJZGlzdGFuY2VTcVRvU2VnbWVudCggdjAsIHYxLCBvcHRpb25hbFBvaW50T25SYXksIG9wdGlvbmFsUG9pbnRPblNlZ21lbnQgKSB7CgoJCS8vIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL3Btam9uaWFrL0dlb21ldHJpY1Rvb2xzL2Jsb2IvbWFzdGVyL0dURW5naW5lL0luY2x1ZGUvTWF0aGVtYXRpY3MvR3RlRGlzdFJheVNlZ21lbnQuaAoJCS8vIEl0IHJldHVybnMgdGhlIG1pbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSByYXkgYW5kIHRoZSBzZWdtZW50CgkJLy8gZGVmaW5lZCBieSB2MCBhbmQgdjEKCQkvLyBJdCBjYW4gYWxzbyBzZXQgdHdvIG9wdGlvbmFsIHRhcmdldHMgOgoJCS8vIC0gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHJheQoJCS8vIC0gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHNlZ21lbnQKCgkJX3NlZ0NlbnRlci5jb3B5KCB2MCApLmFkZCggdjEgKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgkJX3NlZ0Rpci5jb3B5KCB2MSApLnN1YiggdjAgKS5ub3JtYWxpemUoKTsKCQlfZGlmZi5jb3B5KCB0aGlzLm9yaWdpbiApLnN1YiggX3NlZ0NlbnRlciApOwoKCQljb25zdCBzZWdFeHRlbnQgPSB2MC5kaXN0YW5jZVRvKCB2MSApICogMC41OwoJCWNvbnN0IGEwMSA9IC0gdGhpcy5kaXJlY3Rpb24uZG90KCBfc2VnRGlyICk7CgkJY29uc3QgYjAgPSBfZGlmZi5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgkJY29uc3QgYjEgPSAtIF9kaWZmLmRvdCggX3NlZ0RpciApOwoJCWNvbnN0IGMgPSBfZGlmZi5sZW5ndGhTcSgpOwoJCWNvbnN0IGRldCA9IE1hdGguYWJzKCAxIC0gYTAxICogYTAxICk7CgkJbGV0IHMwLCBzMSwgc3FyRGlzdCwgZXh0RGV0OwoKCQlpZiAoIGRldCA+IDAgKSB7CgoJCQkvLyBUaGUgcmF5IGFuZCBzZWdtZW50IGFyZSBub3QgcGFyYWxsZWwuCgoJCQlzMCA9IGEwMSAqIGIxIC0gYjA7CgkJCXMxID0gYTAxICogYjAgLSBiMTsKCQkJZXh0RGV0ID0gc2VnRXh0ZW50ICogZGV0OwoKCQkJaWYgKCBzMCA+PSAwICkgewoKCQkJCWlmICggczEgPj0gLSBleHREZXQgKSB7CgoJCQkJCWlmICggczEgPD0gZXh0RGV0ICkgewoKCQkJCQkJLy8gcmVnaW9uIDAKCQkJCQkJLy8gTWluaW11bSBhdCBpbnRlcmlvciBwb2ludHMgb2YgcmF5IGFuZCBzZWdtZW50LgoKCQkJCQkJY29uc3QgaW52RGV0ID0gMSAvIGRldDsKCQkJCQkJczAgKj0gaW52RGV0OwoJCQkJCQlzMSAqPSBpbnZEZXQ7CgkJCQkJCXNxckRpc3QgPSBzMCAqICggczAgKyBhMDEgKiBzMSArIDIgKiBiMCApICsgczEgKiAoIGEwMSAqIHMwICsgczEgKyAyICogYjEgKSArIGM7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyByZWdpb24gMQoKCQkJCQkJczEgPSBzZWdFeHRlbnQ7CgkJCQkJCXMwID0gTWF0aC5tYXgoIDAsIC0gKCBhMDEgKiBzMSArIGIwICkgKTsKCQkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIHJlZ2lvbiA1CgoJCQkJCXMxID0gLSBzZWdFeHRlbnQ7CgkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHMxICsgYjAgKSApOwoJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIHMxIDw9IC0gZXh0RGV0ICkgewoKCQkJCQkvLyByZWdpb24gNAoKCQkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggLSBhMDEgKiBzZWdFeHRlbnQgKyBiMCApICk7CgkJCQkJczEgPSAoIHMwID4gMCApID8gLSBzZWdFeHRlbnQgOiBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwoJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJfSBlbHNlIGlmICggczEgPD0gZXh0RGV0ICkgewoKCQkJCQkvLyByZWdpb24gMwoKCQkJCQlzMCA9IDA7CgkJCQkJczEgPSBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwoJCQkJCXNxckRpc3QgPSBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gcmVnaW9uIDIKCgkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHNlZ0V4dGVudCArIGIwICkgKTsKCQkJCQlzMSA9ICggczAgPiAwICkgPyBzZWdFeHRlbnQgOiBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwoJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJfQoKCQkJfQoKCQl9IGVsc2UgewoKCQkJLy8gUmF5IGFuZCBzZWdtZW50IGFyZSBwYXJhbGxlbC4KCgkJCXMxID0gKCBhMDEgPiAwICkgPyAtIHNlZ0V4dGVudCA6IHNlZ0V4dGVudDsKCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHMxICsgYjAgKSApOwoJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKCQl9CgoJCWlmICggb3B0aW9uYWxQb2ludE9uUmF5ICkgewoKCQkJb3B0aW9uYWxQb2ludE9uUmF5LmNvcHkoIHRoaXMub3JpZ2luICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLmRpcmVjdGlvbiwgczAgKTsKCgkJfQoKCQlpZiAoIG9wdGlvbmFsUG9pbnRPblNlZ21lbnQgKSB7CgoJCQlvcHRpb25hbFBvaW50T25TZWdtZW50LmNvcHkoIF9zZWdDZW50ZXIgKS5hZGRTY2FsZWRWZWN0b3IoIF9zZWdEaXIsIHMxICk7CgoJCX0KCgkJcmV0dXJuIHNxckRpc3Q7CgoJfQoKCWludGVyc2VjdFNwaGVyZSggc3BoZXJlLCB0YXJnZXQgKSB7CgoJCV92ZWN0b3IkYS5zdWJWZWN0b3JzKCBzcGhlcmUuY2VudGVyLCB0aGlzLm9yaWdpbiApOwoJCWNvbnN0IHRjYSA9IF92ZWN0b3IkYS5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgkJY29uc3QgZDIgPSBfdmVjdG9yJGEuZG90KCBfdmVjdG9yJGEgKSAtIHRjYSAqIHRjYTsKCQljb25zdCByYWRpdXMyID0gc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXM7CgoJCWlmICggZDIgPiByYWRpdXMyICkgcmV0dXJuIG51bGw7CgoJCWNvbnN0IHRoYyA9IE1hdGguc3FydCggcmFkaXVzMiAtIGQyICk7CgoJCS8vIHQwID0gZmlyc3QgaW50ZXJzZWN0IHBvaW50IC0gZW50cmFuY2Ugb24gZnJvbnQgb2Ygc3BoZXJlCgkJY29uc3QgdDAgPSB0Y2EgLSB0aGM7CgoJCS8vIHQxID0gc2Vjb25kIGludGVyc2VjdCBwb2ludCAtIGV4aXQgcG9pbnQgb24gYmFjayBvZiBzcGhlcmUKCQljb25zdCB0MSA9IHRjYSArIHRoYzsKCgkJLy8gdGVzdCB0byBzZWUgaWYgdDEgaXMgYmVoaW5kIHRoZSByYXkgLSBpZiBzbywgcmV0dXJuIG51bGwKCQlpZiAoIHQxIDwgMCApIHJldHVybiBudWxsOwoKCQkvLyB0ZXN0IHRvIHNlZSBpZiB0MCBpcyBiZWhpbmQgdGhlIHJheToKCQkvLyBpZiBpdCBpcywgdGhlIHJheSBpcyBpbnNpZGUgdGhlIHNwaGVyZSwgc28gcmV0dXJuIHRoZSBzZWNvbmQgZXhpdCBwb2ludCBzY2FsZWQgYnkgdDEsCgkJLy8gaW4gb3JkZXIgdG8gYWx3YXlzIHJldHVybiBhbiBpbnRlcnNlY3QgcG9pbnQgdGhhdCBpcyBpbiBmcm9udCBvZiB0aGUgcmF5LgoJCWlmICggdDAgPCAwICkgcmV0dXJuIHRoaXMuYXQoIHQxLCB0YXJnZXQgKTsKCgkJLy8gZWxzZSB0MCBpcyBpbiBmcm9udCBvZiB0aGUgcmF5LCBzbyByZXR1cm4gdGhlIGZpcnN0IGNvbGxpc2lvbiBwb2ludCBzY2FsZWQgYnkgdDAKCQlyZXR1cm4gdGhpcy5hdCggdDAsIHRhcmdldCApOwoKCX0KCglpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgoJCXJldHVybiB0aGlzLmRpc3RhbmNlU3FUb1BvaW50KCBzcGhlcmUuY2VudGVyICkgPD0gKCBzcGhlcmUucmFkaXVzICogc3BoZXJlLnJhZGl1cyApOwoKCX0KCglkaXN0YW5jZVRvUGxhbmUoIHBsYW5lICkgewoKCQljb25zdCBkZW5vbWluYXRvciA9IHBsYW5lLm5vcm1hbC5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgoJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSB7CgoJCQkvLyBsaW5lIGlzIGNvcGxhbmFyLCByZXR1cm4gb3JpZ2luCgkJCWlmICggcGxhbmUuZGlzdGFuY2VUb1BvaW50KCB0aGlzLm9yaWdpbiApID09PSAwICkgewoKCQkJCXJldHVybiAwOwoKCQkJfQoKCQkJLy8gTnVsbCBpcyBwcmVmZXJhYmxlIHRvIHVuZGVmaW5lZCBzaW5jZSB1bmRlZmluZWQgbWVhbnMuLi4uIGl0IGlzIHVuZGVmaW5lZAoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJY29uc3QgdCA9IC0gKCB0aGlzLm9yaWdpbi5kb3QoIHBsYW5lLm5vcm1hbCApICsgcGxhbmUuY29uc3RhbnQgKSAvIGRlbm9taW5hdG9yOwoKCQkvLyBSZXR1cm4gaWYgdGhlIHJheSBuZXZlciBpbnRlcnNlY3RzIHRoZSBwbGFuZQoKCQlyZXR1cm4gdCA+PSAwID8gdCA6IG51bGw7CgoJfQoKCWludGVyc2VjdFBsYW5lKCBwbGFuZSwgdGFyZ2V0ICkgewoKCQljb25zdCB0ID0gdGhpcy5kaXN0YW5jZVRvUGxhbmUoIHBsYW5lICk7CgoJCWlmICggdCA9PT0gbnVsbCApIHsKCgkJCXJldHVybiBudWxsOwoKCQl9CgoJCXJldHVybiB0aGlzLmF0KCB0LCB0YXJnZXQgKTsKCgl9CgoJaW50ZXJzZWN0c1BsYW5lKCBwbGFuZSApIHsKCgkJLy8gY2hlY2sgaWYgdGhlIHJheSBsaWVzIG9uIHRoZSBwbGFuZSBmaXJzdAoKCQljb25zdCBkaXN0VG9Qb2ludCA9IHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggdGhpcy5vcmlnaW4gKTsKCgkJaWYgKCBkaXN0VG9Qb2ludCA9PT0gMCApIHsKCgkJCXJldHVybiB0cnVlOwoKCQl9CgoJCWNvbnN0IGRlbm9taW5hdG9yID0gcGxhbmUubm9ybWFsLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJaWYgKCBkZW5vbWluYXRvciAqIGRpc3RUb1BvaW50IDwgMCApIHsKCgkJCXJldHVybiB0cnVlOwoKCQl9CgoJCS8vIHJheSBvcmlnaW4gaXMgYmVoaW5kIHRoZSBwbGFuZSAoYW5kIGlzIHBvaW50aW5nIGJlaGluZCBpdCkKCgkJcmV0dXJuIGZhbHNlOwoKCX0KCglpbnRlcnNlY3RCb3goIGJveCwgdGFyZ2V0ICkgewoKCQlsZXQgdG1pbiwgdG1heCwgdHltaW4sIHR5bWF4LCB0em1pbiwgdHptYXg7CgoJCWNvbnN0IGludmRpcnggPSAxIC8gdGhpcy5kaXJlY3Rpb24ueCwKCQkJaW52ZGlyeSA9IDEgLyB0aGlzLmRpcmVjdGlvbi55LAoJCQlpbnZkaXJ6ID0gMSAvIHRoaXMuZGlyZWN0aW9uLno7CgoJCWNvbnN0IG9yaWdpbiA9IHRoaXMub3JpZ2luOwoKCQlpZiAoIGludmRpcnggPj0gMCApIHsKCgkJCXRtaW4gPSAoIGJveC5taW4ueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQl0bWF4ID0gKCBib3gubWF4LnggLSBvcmlnaW4ueCApICogaW52ZGlyeDsKCgkJfSBlbHNlIHsKCgkJCXRtaW4gPSAoIGJveC5tYXgueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQl0bWF4ID0gKCBib3gubWluLnggLSBvcmlnaW4ueCApICogaW52ZGlyeDsKCgkJfQoKCQlpZiAoIGludmRpcnkgPj0gMCApIHsKCgkJCXR5bWluID0gKCBib3gubWluLnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCQkJdHltYXggPSAoIGJveC5tYXgueSAtIG9yaWdpbi55ICkgKiBpbnZkaXJ5OwoKCQl9IGVsc2UgewoKCQkJdHltaW4gPSAoIGJveC5tYXgueSAtIG9yaWdpbi55ICkgKiBpbnZkaXJ5OwoJCQl0eW1heCA9ICggYm94Lm1pbi55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CgoJCX0KCgkJaWYgKCAoIHRtaW4gPiB0eW1heCApIHx8ICggdHltaW4gPiB0bWF4ICkgKSByZXR1cm4gbnVsbDsKCgkJaWYgKCB0eW1pbiA+IHRtaW4gfHwgaXNOYU4oIHRtaW4gKSApIHRtaW4gPSB0eW1pbjsKCgkJaWYgKCB0eW1heCA8IHRtYXggfHwgaXNOYU4oIHRtYXggKSApIHRtYXggPSB0eW1heDsKCgkJaWYgKCBpbnZkaXJ6ID49IDAgKSB7CgoJCQl0em1pbiA9ICggYm94Lm1pbi56IC0gb3JpZ2luLnogKSAqIGludmRpcno7CgkJCXR6bWF4ID0gKCBib3gubWF4LnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKCgkJfSBlbHNlIHsKCgkJCXR6bWluID0gKCBib3gubWF4LnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKCQkJdHptYXggPSAoIGJveC5taW4ueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoKCQl9CgoJCWlmICggKCB0bWluID4gdHptYXggKSB8fCAoIHR6bWluID4gdG1heCApICkgcmV0dXJuIG51bGw7CgoJCWlmICggdHptaW4gPiB0bWluIHx8IHRtaW4gIT09IHRtaW4gKSB0bWluID0gdHptaW47CgoJCWlmICggdHptYXggPCB0bWF4IHx8IHRtYXggIT09IHRtYXggKSB0bWF4ID0gdHptYXg7CgoJCS8vcmV0dXJuIHBvaW50IGNsb3Nlc3QgdG8gdGhlIHJheSAocG9zaXRpdmUgc2lkZSkKCgkJaWYgKCB0bWF4IDwgMCApIHJldHVybiBudWxsOwoKCQlyZXR1cm4gdGhpcy5hdCggdG1pbiA+PSAwID8gdG1pbiA6IHRtYXgsIHRhcmdldCApOwoKCX0KCglpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCXJldHVybiB0aGlzLmludGVyc2VjdEJveCggYm94LCBfdmVjdG9yJGEgKSAhPT0gbnVsbDsKCgl9CgoJaW50ZXJzZWN0VHJpYW5nbGUoIGEsIGIsIGMsIGJhY2tmYWNlQ3VsbGluZywgdGFyZ2V0ICkgewoKCQkvLyBDb21wdXRlIHRoZSBvZmZzZXQgb3JpZ2luLCBlZGdlcywgYW5kIG5vcm1hbC4KCgkJLy8gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vcG1qb25pYWsvR2VvbWV0cmljVG9vbHMvYmxvYi9tYXN0ZXIvR1RFbmdpbmUvSW5jbHVkZS9NYXRoZW1hdGljcy9HdGVJbnRyUmF5M1RyaWFuZ2xlMy5oCgoJCV9lZGdlMS5zdWJWZWN0b3JzKCBiLCBhICk7CgkJX2VkZ2UyLnN1YlZlY3RvcnMoIGMsIGEgKTsKCQlfbm9ybWFsJDEuY3Jvc3NWZWN0b3JzKCBfZWRnZTEsIF9lZGdlMiApOwoKCQkvLyBTb2x2ZSBRICsgdCpEID0gYjEqRTEgKyBiMipFMiAoUSA9IGtEaWZmLCBEID0gcmF5IGRpcmVjdGlvbiwKCQkvLyBFMSA9IGtFZGdlMSwgRTIgPSBrRWRnZTIsIE4gPSBDcm9zcyhFMSxFMikpIGJ5CgkJLy8gICB8RG90KEQsTil8KmIxID0gc2lnbihEb3QoRCxOKSkqRG90KEQsQ3Jvc3MoUSxFMikpCgkJLy8gICB8RG90KEQsTil8KmIyID0gc2lnbihEb3QoRCxOKSkqRG90KEQsQ3Jvc3MoRTEsUSkpCgkJLy8gICB8RG90KEQsTil8KnQgPSAtc2lnbihEb3QoRCxOKSkqRG90KFEsTikKCQlsZXQgRGROID0gdGhpcy5kaXJlY3Rpb24uZG90KCBfbm9ybWFsJDEgKTsKCQlsZXQgc2lnbjsKCgkJaWYgKCBEZE4gPiAwICkgewoKCQkJaWYgKCBiYWNrZmFjZUN1bGxpbmcgKSByZXR1cm4gbnVsbDsKCQkJc2lnbiA9IDE7CgoJCX0gZWxzZSBpZiAoIERkTiA8IDAgKSB7CgoJCQlzaWduID0gLSAxOwoJCQlEZE4gPSAtIERkTjsKCgkJfSBlbHNlIHsKCgkJCXJldHVybiBudWxsOwoKCQl9CgoJCV9kaWZmLnN1YlZlY3RvcnMoIHRoaXMub3JpZ2luLCBhICk7CgkJY29uc3QgRGRReEUyID0gc2lnbiAqIHRoaXMuZGlyZWN0aW9uLmRvdCggX2VkZ2UyLmNyb3NzVmVjdG9ycyggX2RpZmYsIF9lZGdlMiApICk7CgoJCS8vIGIxIDwgMCwgbm8gaW50ZXJzZWN0aW9uCgkJaWYgKCBEZFF4RTIgPCAwICkgewoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJY29uc3QgRGRFMXhRID0gc2lnbiAqIHRoaXMuZGlyZWN0aW9uLmRvdCggX2VkZ2UxLmNyb3NzKCBfZGlmZiApICk7CgoJCS8vIGIyIDwgMCwgbm8gaW50ZXJzZWN0aW9uCgkJaWYgKCBEZEUxeFEgPCAwICkgewoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJLy8gYjErYjIgPiAxLCBubyBpbnRlcnNlY3Rpb24KCQlpZiAoIERkUXhFMiArIERkRTF4USA+IERkTiApIHsKCgkJCXJldHVybiBudWxsOwoKCQl9CgoJCS8vIExpbmUgaW50ZXJzZWN0cyB0cmlhbmdsZSwgY2hlY2sgaWYgcmF5IGRvZXMuCgkJY29uc3QgUWROID0gLSBzaWduICogX2RpZmYuZG90KCBfbm9ybWFsJDEgKTsKCgkJLy8gdCA8IDAsIG5vIGludGVyc2VjdGlvbgoJCWlmICggUWROIDwgMCApIHsKCgkJCXJldHVybiBudWxsOwoKCQl9CgoJCS8vIFJheSBpbnRlcnNlY3RzIHRyaWFuZ2xlLgoJCXJldHVybiB0aGlzLmF0KCBRZE4gLyBEZE4sIHRhcmdldCApOwoKCX0KCglhcHBseU1hdHJpeDQoIG1hdHJpeDQgKSB7CgoJCXRoaXMub3JpZ2luLmFwcGx5TWF0cml4NCggbWF0cml4NCApOwoJCXRoaXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4NCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCByYXkgKSB7CgoJCXJldHVybiByYXkub3JpZ2luLmVxdWFscyggdGhpcy5vcmlnaW4gKSAmJiByYXkuZGlyZWN0aW9uLmVxdWFscyggdGhpcy5kaXJlY3Rpb24gKTsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9Cgp9CgpjbGFzcyBNYXRyaXg0IHsKCgljb25zdHJ1Y3RvciggbjExLCBuMTIsIG4xMywgbjE0LCBuMjEsIG4yMiwgbjIzLCBuMjQsIG4zMSwgbjMyLCBuMzMsIG4zNCwgbjQxLCBuNDIsIG40MywgbjQ0ICkgewoKCQlNYXRyaXg0LnByb3RvdHlwZS5pc01hdHJpeDQgPSB0cnVlOwoKCQl0aGlzLmVsZW1lbnRzID0gWwoKCQkJMSwgMCwgMCwgMCwKCQkJMCwgMSwgMCwgMCwKCQkJMCwgMCwgMSwgMCwKCQkJMCwgMCwgMCwgMQoKCQldOwoKCQlpZiAoIG4xMSAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5zZXQoIG4xMSwgbjEyLCBuMTMsIG4xNCwgbjIxLCBuMjIsIG4yMywgbjI0LCBuMzEsIG4zMiwgbjMzLCBuMzQsIG40MSwgbjQyLCBuNDMsIG40NCApOwoKCQl9CgoJfQoKCXNldCggbjExLCBuMTIsIG4xMywgbjE0LCBuMjEsIG4yMiwgbjIzLCBuMjQsIG4zMSwgbjMyLCBuMzMsIG4zNCwgbjQxLCBuNDIsIG40MywgbjQ0ICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCXRlWyAwIF0gPSBuMTE7IHRlWyA0IF0gPSBuMTI7IHRlWyA4IF0gPSBuMTM7IHRlWyAxMiBdID0gbjE0OwoJCXRlWyAxIF0gPSBuMjE7IHRlWyA1IF0gPSBuMjI7IHRlWyA5IF0gPSBuMjM7IHRlWyAxMyBdID0gbjI0OwoJCXRlWyAyIF0gPSBuMzE7IHRlWyA2IF0gPSBuMzI7IHRlWyAxMCBdID0gbjMzOyB0ZVsgMTQgXSA9IG4zNDsKCQl0ZVsgMyBdID0gbjQxOyB0ZVsgNyBdID0gbjQyOyB0ZVsgMTEgXSA9IG40MzsgdGVbIDE1IF0gPSBuNDQ7CgoJCXJldHVybiB0aGlzOwoKCX0KCglpZGVudGl0eSgpIHsKCgkJdGhpcy5zZXQoCgoJCQkxLCAwLCAwLCAwLAoJCQkwLCAxLCAwLCAwLAoJCQkwLCAwLCAxLCAwLAoJCQkwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyBNYXRyaXg0KCkuZnJvbUFycmF5KCB0aGlzLmVsZW1lbnRzICk7CgoJfQoKCWNvcHkoIG0gKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCXRlWyAwIF0gPSBtZVsgMCBdOyB0ZVsgMSBdID0gbWVbIDEgXTsgdGVbIDIgXSA9IG1lWyAyIF07IHRlWyAzIF0gPSBtZVsgMyBdOwoJCXRlWyA0IF0gPSBtZVsgNCBdOyB0ZVsgNSBdID0gbWVbIDUgXTsgdGVbIDYgXSA9IG1lWyA2IF07IHRlWyA3IF0gPSBtZVsgNyBdOwoJCXRlWyA4IF0gPSBtZVsgOCBdOyB0ZVsgOSBdID0gbWVbIDkgXTsgdGVbIDEwIF0gPSBtZVsgMTAgXTsgdGVbIDExIF0gPSBtZVsgMTEgXTsKCQl0ZVsgMTIgXSA9IG1lWyAxMiBdOyB0ZVsgMTMgXSA9IG1lWyAxMyBdOyB0ZVsgMTQgXSA9IG1lWyAxNCBdOyB0ZVsgMTUgXSA9IG1lWyAxNSBdOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weVBvc2l0aW9uKCBtICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHMsIG1lID0gbS5lbGVtZW50czsKCgkJdGVbIDEyIF0gPSBtZVsgMTIgXTsKCQl0ZVsgMTMgXSA9IG1lWyAxMyBdOwoJCXRlWyAxNCBdID0gbWVbIDE0IF07CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tTWF0cml4MyggbSApIHsKCgkJY29uc3QgbWUgPSBtLmVsZW1lbnRzOwoKCQl0aGlzLnNldCgKCgkJCW1lWyAwIF0sIG1lWyAzIF0sIG1lWyA2IF0sIDAsCgkJCW1lWyAxIF0sIG1lWyA0IF0sIG1lWyA3IF0sIDAsCgkJCW1lWyAyIF0sIG1lWyA1IF0sIG1lWyA4IF0sIDAsCgkJCTAsIDAsIDAsIDEKCgkJKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWV4dHJhY3RCYXNpcyggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCgkJeEF4aXMuc2V0RnJvbU1hdHJpeENvbHVtbiggdGhpcywgMCApOwoJCXlBeGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIHRoaXMsIDEgKTsKCQl6QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCB0aGlzLCAyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlQmFzaXMoIHhBeGlzLCB5QXhpcywgekF4aXMgKSB7CgoJCXRoaXMuc2V0KAoJCQl4QXhpcy54LCB5QXhpcy54LCB6QXhpcy54LCAwLAoJCQl4QXhpcy55LCB5QXhpcy55LCB6QXhpcy55LCAwLAoJCQl4QXhpcy56LCB5QXhpcy56LCB6QXhpcy56LCAwLAoJCQkwLCAwLCAwLCAxCgkJKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWV4dHJhY3RSb3RhdGlvbiggbSApIHsKCgkJLy8gdGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCByZWZsZWN0aW9uIG1hdHJpY2VzCgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCWNvbnN0IHNjYWxlWCA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAwICkubGVuZ3RoKCk7CgkJY29uc3Qgc2NhbGVZID0gMSAvIF92MSQ1LnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDEgKS5sZW5ndGgoKTsKCQljb25zdCBzY2FsZVogPSAxIC8gX3YxJDUuc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgMiApLmxlbmd0aCgpOwoKCQl0ZVsgMCBdID0gbWVbIDAgXSAqIHNjYWxlWDsKCQl0ZVsgMSBdID0gbWVbIDEgXSAqIHNjYWxlWDsKCQl0ZVsgMiBdID0gbWVbIDIgXSAqIHNjYWxlWDsKCQl0ZVsgMyBdID0gMDsKCgkJdGVbIDQgXSA9IG1lWyA0IF0gKiBzY2FsZVk7CgkJdGVbIDUgXSA9IG1lWyA1IF0gKiBzY2FsZVk7CgkJdGVbIDYgXSA9IG1lWyA2IF0gKiBzY2FsZVk7CgkJdGVbIDcgXSA9IDA7CgoJCXRlWyA4IF0gPSBtZVsgOCBdICogc2NhbGVaOwoJCXRlWyA5IF0gPSBtZVsgOSBdICogc2NhbGVaOwoJCXRlWyAxMCBdID0gbWVbIDEwIF0gKiBzY2FsZVo7CgkJdGVbIDExIF0gPSAwOwoKCQl0ZVsgMTIgXSA9IDA7CgkJdGVbIDEzIF0gPSAwOwoJCXRlWyAxNCBdID0gMDsKCQl0ZVsgMTUgXSA9IDE7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25Gcm9tRXVsZXIoIGV1bGVyICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCWNvbnN0IHggPSBldWxlci54LCB5ID0gZXVsZXIueSwgeiA9IGV1bGVyLno7CgkJY29uc3QgYSA9IE1hdGguY29zKCB4ICksIGIgPSBNYXRoLnNpbiggeCApOwoJCWNvbnN0IGMgPSBNYXRoLmNvcyggeSApLCBkID0gTWF0aC5zaW4oIHkgKTsKCQljb25zdCBlID0gTWF0aC5jb3MoIHogKSwgZiA9IE1hdGguc2luKCB6ICk7CgoJCWlmICggZXVsZXIub3JkZXIgPT09ICdYWVonICkgewoKCQkJY29uc3QgYWUgPSBhICogZSwgYWYgPSBhICogZiwgYmUgPSBiICogZSwgYmYgPSBiICogZjsKCgkJCXRlWyAwIF0gPSBjICogZTsKCQkJdGVbIDQgXSA9IC0gYyAqIGY7CgkJCXRlWyA4IF0gPSBkOwoKCQkJdGVbIDEgXSA9IGFmICsgYmUgKiBkOwoJCQl0ZVsgNSBdID0gYWUgLSBiZiAqIGQ7CgkJCXRlWyA5IF0gPSAtIGIgKiBjOwoKCQkJdGVbIDIgXSA9IGJmIC0gYWUgKiBkOwoJCQl0ZVsgNiBdID0gYmUgKyBhZiAqIGQ7CgkJCXRlWyAxMCBdID0gYSAqIGM7CgoJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWVhaJyApIHsKCgkJCWNvbnN0IGNlID0gYyAqIGUsIGNmID0gYyAqIGYsIGRlID0gZCAqIGUsIGRmID0gZCAqIGY7CgoJCQl0ZVsgMCBdID0gY2UgKyBkZiAqIGI7CgkJCXRlWyA0IF0gPSBkZSAqIGIgLSBjZjsKCQkJdGVbIDggXSA9IGEgKiBkOwoKCQkJdGVbIDEgXSA9IGEgKiBmOwoJCQl0ZVsgNSBdID0gYSAqIGU7CgkJCXRlWyA5IF0gPSAtIGI7CgoJCQl0ZVsgMiBdID0gY2YgKiBiIC0gZGU7CgkJCXRlWyA2IF0gPSBkZiArIGNlICogYjsKCQkJdGVbIDEwIF0gPSBhICogYzsKCgkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdaWFknICkgewoKCQkJY29uc3QgY2UgPSBjICogZSwgY2YgPSBjICogZiwgZGUgPSBkICogZSwgZGYgPSBkICogZjsKCgkJCXRlWyAwIF0gPSBjZSAtIGRmICogYjsKCQkJdGVbIDQgXSA9IC0gYSAqIGY7CgkJCXRlWyA4IF0gPSBkZSArIGNmICogYjsKCgkJCXRlWyAxIF0gPSBjZiArIGRlICogYjsKCQkJdGVbIDUgXSA9IGEgKiBlOwoJCQl0ZVsgOSBdID0gZGYgLSBjZSAqIGI7CgoJCQl0ZVsgMiBdID0gLSBhICogZDsKCQkJdGVbIDYgXSA9IGI7CgkJCXRlWyAxMCBdID0gYSAqIGM7CgoJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWllYJyApIHsKCgkJCWNvbnN0IGFlID0gYSAqIGUsIGFmID0gYSAqIGYsIGJlID0gYiAqIGUsIGJmID0gYiAqIGY7CgoJCQl0ZVsgMCBdID0gYyAqIGU7CgkJCXRlWyA0IF0gPSBiZSAqIGQgLSBhZjsKCQkJdGVbIDggXSA9IGFlICogZCArIGJmOwoKCQkJdGVbIDEgXSA9IGMgKiBmOwoJCQl0ZVsgNSBdID0gYmYgKiBkICsgYWU7CgkJCXRlWyA5IF0gPSBhZiAqIGQgLSBiZTsKCgkJCXRlWyAyIF0gPSAtIGQ7CgkJCXRlWyA2IF0gPSBiICogYzsKCQkJdGVbIDEwIF0gPSBhICogYzsKCgkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdZWlgnICkgewoKCQkJY29uc3QgYWMgPSBhICogYywgYWQgPSBhICogZCwgYmMgPSBiICogYywgYmQgPSBiICogZDsKCgkJCXRlWyAwIF0gPSBjICogZTsKCQkJdGVbIDQgXSA9IGJkIC0gYWMgKiBmOwoJCQl0ZVsgOCBdID0gYmMgKiBmICsgYWQ7CgoJCQl0ZVsgMSBdID0gZjsKCQkJdGVbIDUgXSA9IGEgKiBlOwoJCQl0ZVsgOSBdID0gLSBiICogZTsKCgkJCXRlWyAyIF0gPSAtIGQgKiBlOwoJCQl0ZVsgNiBdID0gYWQgKiBmICsgYmM7CgkJCXRlWyAxMCBdID0gYWMgLSBiZCAqIGY7CgoJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWFpZJyApIHsKCgkJCWNvbnN0IGFjID0gYSAqIGMsIGFkID0gYSAqIGQsIGJjID0gYiAqIGMsIGJkID0gYiAqIGQ7CgoJCQl0ZVsgMCBdID0gYyAqIGU7CgkJCXRlWyA0IF0gPSAtIGY7CgkJCXRlWyA4IF0gPSBkICogZTsKCgkJCXRlWyAxIF0gPSBhYyAqIGYgKyBiZDsKCQkJdGVbIDUgXSA9IGEgKiBlOwoJCQl0ZVsgOSBdID0gYWQgKiBmIC0gYmM7CgoJCQl0ZVsgMiBdID0gYmMgKiBmIC0gYWQ7CgkJCXRlWyA2IF0gPSBiICogZTsKCQkJdGVbIDEwIF0gPSBiZCAqIGYgKyBhYzsKCgkJfQoKCQkvLyBib3R0b20gcm93CgkJdGVbIDMgXSA9IDA7CgkJdGVbIDcgXSA9IDA7CgkJdGVbIDExIF0gPSAwOwoKCQkvLyBsYXN0IGNvbHVtbgoJCXRlWyAxMiBdID0gMDsKCQl0ZVsgMTMgXSA9IDA7CgkJdGVbIDE0IF0gPSAwOwoJCXRlWyAxNSBdID0gMTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICkgewoKCQlyZXR1cm4gdGhpcy5jb21wb3NlKCBfemVybywgcSwgX29uZSApOwoKCX0KCglsb29rQXQoIGV5ZSwgdGFyZ2V0LCB1cCApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQlfei5zdWJWZWN0b3JzKCBleWUsIHRhcmdldCApOwoKCQlpZiAoIF96Lmxlbmd0aFNxKCkgPT09IDAgKSB7CgoJCQkvLyBleWUgYW5kIHRhcmdldCBhcmUgaW4gdGhlIHNhbWUgcG9zaXRpb24KCgkJCV96LnogPSAxOwoKCQl9CgoJCV96Lm5vcm1hbGl6ZSgpOwoJCV94LmNyb3NzVmVjdG9ycyggdXAsIF96ICk7CgoJCWlmICggX3gubGVuZ3RoU3EoKSA9PT0gMCApIHsKCgkJCS8vIHVwIGFuZCB6IGFyZSBwYXJhbGxlbAoKCQkJaWYgKCBNYXRoLmFicyggdXAueiApID09PSAxICkgewoKCQkJCV96LnggKz0gMC4wMDAxOwoKCQkJfSBlbHNlIHsKCgkJCQlfei56ICs9IDAuMDAwMTsKCgkJCX0KCgkJCV96Lm5vcm1hbGl6ZSgpOwoJCQlfeC5jcm9zc1ZlY3RvcnMoIHVwLCBfeiApOwoKCQl9CgoJCV94Lm5vcm1hbGl6ZSgpOwoJCV95LmNyb3NzVmVjdG9ycyggX3osIF94ICk7CgoJCXRlWyAwIF0gPSBfeC54OyB0ZVsgNCBdID0gX3kueDsgdGVbIDggXSA9IF96Lng7CgkJdGVbIDEgXSA9IF94Lnk7IHRlWyA1IF0gPSBfeS55OyB0ZVsgOSBdID0gX3oueTsKCQl0ZVsgMiBdID0gX3guejsgdGVbIDYgXSA9IF95Lno7IHRlWyAxMCBdID0gX3ouejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5KCBtICkgewoKCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLCBtICk7CgoJfQoKCXByZW11bHRpcGx5KCBtICkgewoKCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCBtLCB0aGlzICk7CgoJfQoKCW11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSB7CgoJCWNvbnN0IGFlID0gYS5lbGVtZW50czsKCQljb25zdCBiZSA9IGIuZWxlbWVudHM7CgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQljb25zdCBhMTEgPSBhZVsgMCBdLCBhMTIgPSBhZVsgNCBdLCBhMTMgPSBhZVsgOCBdLCBhMTQgPSBhZVsgMTIgXTsKCQljb25zdCBhMjEgPSBhZVsgMSBdLCBhMjIgPSBhZVsgNSBdLCBhMjMgPSBhZVsgOSBdLCBhMjQgPSBhZVsgMTMgXTsKCQljb25zdCBhMzEgPSBhZVsgMiBdLCBhMzIgPSBhZVsgNiBdLCBhMzMgPSBhZVsgMTAgXSwgYTM0ID0gYWVbIDE0IF07CgkJY29uc3QgYTQxID0gYWVbIDMgXSwgYTQyID0gYWVbIDcgXSwgYTQzID0gYWVbIDExIF0sIGE0NCA9IGFlWyAxNSBdOwoKCQljb25zdCBiMTEgPSBiZVsgMCBdLCBiMTIgPSBiZVsgNCBdLCBiMTMgPSBiZVsgOCBdLCBiMTQgPSBiZVsgMTIgXTsKCQljb25zdCBiMjEgPSBiZVsgMSBdLCBiMjIgPSBiZVsgNSBdLCBiMjMgPSBiZVsgOSBdLCBiMjQgPSBiZVsgMTMgXTsKCQljb25zdCBiMzEgPSBiZVsgMiBdLCBiMzIgPSBiZVsgNiBdLCBiMzMgPSBiZVsgMTAgXSwgYjM0ID0gYmVbIDE0IF07CgkJY29uc3QgYjQxID0gYmVbIDMgXSwgYjQyID0gYmVbIDcgXSwgYjQzID0gYmVbIDExIF0sIGI0NCA9IGJlWyAxNSBdOwoKCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxICsgYTE0ICogYjQxOwoJCXRlWyA0IF0gPSBhMTEgKiBiMTIgKyBhMTIgKiBiMjIgKyBhMTMgKiBiMzIgKyBhMTQgKiBiNDI7CgkJdGVbIDggXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMyArIGExNCAqIGI0MzsKCQl0ZVsgMTIgXSA9IGExMSAqIGIxNCArIGExMiAqIGIyNCArIGExMyAqIGIzNCArIGExNCAqIGI0NDsKCgkJdGVbIDEgXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMSArIGEyNCAqIGI0MTsKCQl0ZVsgNSBdID0gYTIxICogYjEyICsgYTIyICogYjIyICsgYTIzICogYjMyICsgYTI0ICogYjQyOwoJCXRlWyA5IF0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzMgKyBhMjQgKiBiNDM7CgkJdGVbIDEzIF0gPSBhMjEgKiBiMTQgKyBhMjIgKiBiMjQgKyBhMjMgKiBiMzQgKyBhMjQgKiBiNDQ7CgoJCXRlWyAyIF0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzEgKyBhMzQgKiBiNDE7CgkJdGVbIDYgXSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMiArIGEzNCAqIGI0MjsKCQl0ZVsgMTAgXSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMyArIGEzNCAqIGI0MzsKCQl0ZVsgMTQgXSA9IGEzMSAqIGIxNCArIGEzMiAqIGIyNCArIGEzMyAqIGIzNCArIGEzNCAqIGI0NDsKCgkJdGVbIDMgXSA9IGE0MSAqIGIxMSArIGE0MiAqIGIyMSArIGE0MyAqIGIzMSArIGE0NCAqIGI0MTsKCQl0ZVsgNyBdID0gYTQxICogYjEyICsgYTQyICogYjIyICsgYTQzICogYjMyICsgYTQ0ICogYjQyOwoJCXRlWyAxMSBdID0gYTQxICogYjEzICsgYTQyICogYjIzICsgYTQzICogYjMzICsgYTQ0ICogYjQzOwoJCXRlWyAxNSBdID0gYTQxICogYjE0ICsgYTQyICogYjI0ICsgYTQzICogYjM0ICsgYTQ0ICogYjQ0OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJdGVbIDAgXSAqPSBzOyB0ZVsgNCBdICo9IHM7IHRlWyA4IF0gKj0gczsgdGVbIDEyIF0gKj0gczsKCQl0ZVsgMSBdICo9IHM7IHRlWyA1IF0gKj0gczsgdGVbIDkgXSAqPSBzOyB0ZVsgMTMgXSAqPSBzOwoJCXRlWyAyIF0gKj0gczsgdGVbIDYgXSAqPSBzOyB0ZVsgMTAgXSAqPSBzOyB0ZVsgMTQgXSAqPSBzOwoJCXRlWyAzIF0gKj0gczsgdGVbIDcgXSAqPSBzOyB0ZVsgMTEgXSAqPSBzOyB0ZVsgMTUgXSAqPSBzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGV0ZXJtaW5hbnQoKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJY29uc3QgbjExID0gdGVbIDAgXSwgbjEyID0gdGVbIDQgXSwgbjEzID0gdGVbIDggXSwgbjE0ID0gdGVbIDEyIF07CgkJY29uc3QgbjIxID0gdGVbIDEgXSwgbjIyID0gdGVbIDUgXSwgbjIzID0gdGVbIDkgXSwgbjI0ID0gdGVbIDEzIF07CgkJY29uc3QgbjMxID0gdGVbIDIgXSwgbjMyID0gdGVbIDYgXSwgbjMzID0gdGVbIDEwIF0sIG4zNCA9IHRlWyAxNCBdOwoJCWNvbnN0IG40MSA9IHRlWyAzIF0sIG40MiA9IHRlWyA3IF0sIG40MyA9IHRlWyAxMSBdLCBuNDQgPSB0ZVsgMTUgXTsKCgkJLy9UT0RPOiBtYWtlIHRoaXMgbW9yZSBlZmZpY2llbnQKCQkvLyggYmFzZWQgb24gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9tYXRyaXgvZnVuY3Rpb25zL2ludmVyc2UvZm91ckQvaW5kZXguaHRtICkKCgkJcmV0dXJuICgKCQkJbjQxICogKAoJCQkJKyBuMTQgKiBuMjMgKiBuMzIKCQkJCSAtIG4xMyAqIG4yNCAqIG4zMgoJCQkJIC0gbjE0ICogbjIyICogbjMzCgkJCQkgKyBuMTIgKiBuMjQgKiBuMzMKCQkJCSArIG4xMyAqIG4yMiAqIG4zNAoJCQkJIC0gbjEyICogbjIzICogbjM0CgkJCSkgKwoJCQluNDIgKiAoCgkJCQkrIG4xMSAqIG4yMyAqIG4zNAoJCQkJIC0gbjExICogbjI0ICogbjMzCgkJCQkgKyBuMTQgKiBuMjEgKiBuMzMKCQkJCSAtIG4xMyAqIG4yMSAqIG4zNAoJCQkJICsgbjEzICogbjI0ICogbjMxCgkJCQkgLSBuMTQgKiBuMjMgKiBuMzEKCQkJKSArCgkJCW40MyAqICgKCQkJCSsgbjExICogbjI0ICogbjMyCgkJCQkgLSBuMTEgKiBuMjIgKiBuMzQKCQkJCSAtIG4xNCAqIG4yMSAqIG4zMgoJCQkJICsgbjEyICogbjIxICogbjM0CgkJCQkgKyBuMTQgKiBuMjIgKiBuMzEKCQkJCSAtIG4xMiAqIG4yNCAqIG4zMQoJCQkpICsKCQkJbjQ0ICogKAoJCQkJLSBuMTMgKiBuMjIgKiBuMzEKCQkJCSAtIG4xMSAqIG4yMyAqIG4zMgoJCQkJICsgbjExICogbjIyICogbjMzCgkJCQkgKyBuMTMgKiBuMjEgKiBuMzIKCQkJCSAtIG4xMiAqIG4yMSAqIG4zMwoJCQkJICsgbjEyICogbjIzICogbjMxCgkJCSkKCgkJKTsKCgl9CgoJdHJhbnNwb3NlKCkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJbGV0IHRtcDsKCgkJdG1wID0gdGVbIDEgXTsgdGVbIDEgXSA9IHRlWyA0IF07IHRlWyA0IF0gPSB0bXA7CgkJdG1wID0gdGVbIDIgXTsgdGVbIDIgXSA9IHRlWyA4IF07IHRlWyA4IF0gPSB0bXA7CgkJdG1wID0gdGVbIDYgXTsgdGVbIDYgXSA9IHRlWyA5IF07IHRlWyA5IF0gPSB0bXA7CgoJCXRtcCA9IHRlWyAzIF07IHRlWyAzIF0gPSB0ZVsgMTIgXTsgdGVbIDEyIF0gPSB0bXA7CgkJdG1wID0gdGVbIDcgXTsgdGVbIDcgXSA9IHRlWyAxMyBdOyB0ZVsgMTMgXSA9IHRtcDsKCQl0bXAgPSB0ZVsgMTEgXTsgdGVbIDExIF0gPSB0ZVsgMTQgXTsgdGVbIDE0IF0gPSB0bXA7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRQb3NpdGlvbiggeCwgeSwgeiApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQlpZiAoIHguaXNWZWN0b3IzICkgewoKCQkJdGVbIDEyIF0gPSB4Lng7CgkJCXRlWyAxMyBdID0geC55OwoJCQl0ZVsgMTQgXSA9IHguejsKCgkJfSBlbHNlIHsKCgkJCXRlWyAxMiBdID0geDsKCQkJdGVbIDEzIF0gPSB5OwoJCQl0ZVsgMTQgXSA9IHo7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWludmVydCgpIHsKCgkJLy8gYmFzZWQgb24gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9tYXRyaXgvZnVuY3Rpb25zL2ludmVyc2UvZm91ckQvaW5kZXguaHRtCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLAoKCQkJbjExID0gdGVbIDAgXSwgbjIxID0gdGVbIDEgXSwgbjMxID0gdGVbIDIgXSwgbjQxID0gdGVbIDMgXSwKCQkJbjEyID0gdGVbIDQgXSwgbjIyID0gdGVbIDUgXSwgbjMyID0gdGVbIDYgXSwgbjQyID0gdGVbIDcgXSwKCQkJbjEzID0gdGVbIDggXSwgbjIzID0gdGVbIDkgXSwgbjMzID0gdGVbIDEwIF0sIG40MyA9IHRlWyAxMSBdLAoJCQluMTQgPSB0ZVsgMTIgXSwgbjI0ID0gdGVbIDEzIF0sIG4zNCA9IHRlWyAxNCBdLCBuNDQgPSB0ZVsgMTUgXSwKCgkJCXQxMSA9IG4yMyAqIG4zNCAqIG40MiAtIG4yNCAqIG4zMyAqIG40MiArIG4yNCAqIG4zMiAqIG40MyAtIG4yMiAqIG4zNCAqIG40MyAtIG4yMyAqIG4zMiAqIG40NCArIG4yMiAqIG4zMyAqIG40NCwKCQkJdDEyID0gbjE0ICogbjMzICogbjQyIC0gbjEzICogbjM0ICogbjQyIC0gbjE0ICogbjMyICogbjQzICsgbjEyICogbjM0ICogbjQzICsgbjEzICogbjMyICogbjQ0IC0gbjEyICogbjMzICogbjQ0LAoJCQl0MTMgPSBuMTMgKiBuMjQgKiBuNDIgLSBuMTQgKiBuMjMgKiBuNDIgKyBuMTQgKiBuMjIgKiBuNDMgLSBuMTIgKiBuMjQgKiBuNDMgLSBuMTMgKiBuMjIgKiBuNDQgKyBuMTIgKiBuMjMgKiBuNDQsCgkJCXQxNCA9IG4xNCAqIG4yMyAqIG4zMiAtIG4xMyAqIG4yNCAqIG4zMiAtIG4xNCAqIG4yMiAqIG4zMyArIG4xMiAqIG4yNCAqIG4zMyArIG4xMyAqIG4yMiAqIG4zNCAtIG4xMiAqIG4yMyAqIG4zNDsKCgkJY29uc3QgZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzICsgbjQxICogdDE0OwoKCQlpZiAoIGRldCA9PT0gMCApIHJldHVybiB0aGlzLnNldCggMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCApOwoKCQljb25zdCBkZXRJbnYgPSAxIC8gZGV0OwoKCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwoJCXRlWyAxIF0gPSAoIG4yNCAqIG4zMyAqIG40MSAtIG4yMyAqIG4zNCAqIG40MSAtIG4yNCAqIG4zMSAqIG40MyArIG4yMSAqIG4zNCAqIG40MyArIG4yMyAqIG4zMSAqIG40NCAtIG4yMSAqIG4zMyAqIG40NCApICogZGV0SW52OwoJCXRlWyAyIF0gPSAoIG4yMiAqIG4zNCAqIG40MSAtIG4yNCAqIG4zMiAqIG40MSArIG4yNCAqIG4zMSAqIG40MiAtIG4yMSAqIG4zNCAqIG40MiAtIG4yMiAqIG4zMSAqIG40NCArIG4yMSAqIG4zMiAqIG40NCApICogZGV0SW52OwoJCXRlWyAzIF0gPSAoIG4yMyAqIG4zMiAqIG40MSAtIG4yMiAqIG4zMyAqIG40MSAtIG4yMyAqIG4zMSAqIG40MiArIG4yMSAqIG4zMyAqIG40MiArIG4yMiAqIG4zMSAqIG40MyAtIG4yMSAqIG4zMiAqIG40MyApICogZGV0SW52OwoKCQl0ZVsgNCBdID0gdDEyICogZGV0SW52OwoJCXRlWyA1IF0gPSAoIG4xMyAqIG4zNCAqIG40MSAtIG4xNCAqIG4zMyAqIG40MSArIG4xNCAqIG4zMSAqIG40MyAtIG4xMSAqIG4zNCAqIG40MyAtIG4xMyAqIG4zMSAqIG40NCArIG4xMSAqIG4zMyAqIG40NCApICogZGV0SW52OwoJCXRlWyA2IF0gPSAoIG4xNCAqIG4zMiAqIG40MSAtIG4xMiAqIG4zNCAqIG40MSAtIG4xNCAqIG4zMSAqIG40MiArIG4xMSAqIG4zNCAqIG40MiArIG4xMiAqIG4zMSAqIG40NCAtIG4xMSAqIG4zMiAqIG40NCApICogZGV0SW52OwoJCXRlWyA3IF0gPSAoIG4xMiAqIG4zMyAqIG40MSAtIG4xMyAqIG4zMiAqIG40MSArIG4xMyAqIG4zMSAqIG40MiAtIG4xMSAqIG4zMyAqIG40MiAtIG4xMiAqIG4zMSAqIG40MyArIG4xMSAqIG4zMiAqIG40MyApICogZGV0SW52OwoKCQl0ZVsgOCBdID0gdDEzICogZGV0SW52OwoJCXRlWyA5IF0gPSAoIG4xNCAqIG4yMyAqIG40MSAtIG4xMyAqIG4yNCAqIG40MSAtIG4xNCAqIG4yMSAqIG40MyArIG4xMSAqIG4yNCAqIG40MyArIG4xMyAqIG4yMSAqIG40NCAtIG4xMSAqIG4yMyAqIG40NCApICogZGV0SW52OwoJCXRlWyAxMCBdID0gKCBuMTIgKiBuMjQgKiBuNDEgLSBuMTQgKiBuMjIgKiBuNDEgKyBuMTQgKiBuMjEgKiBuNDIgLSBuMTEgKiBuMjQgKiBuNDIgLSBuMTIgKiBuMjEgKiBuNDQgKyBuMTEgKiBuMjIgKiBuNDQgKSAqIGRldEludjsKCQl0ZVsgMTEgXSA9ICggbjEzICogbjIyICogbjQxIC0gbjEyICogbjIzICogbjQxIC0gbjEzICogbjIxICogbjQyICsgbjExICogbjIzICogbjQyICsgbjEyICogbjIxICogbjQzIC0gbjExICogbjIyICogbjQzICkgKiBkZXRJbnY7CgoJCXRlWyAxMiBdID0gdDE0ICogZGV0SW52OwoJCXRlWyAxMyBdID0gKCBuMTMgKiBuMjQgKiBuMzEgLSBuMTQgKiBuMjMgKiBuMzEgKyBuMTQgKiBuMjEgKiBuMzMgLSBuMTEgKiBuMjQgKiBuMzMgLSBuMTMgKiBuMjEgKiBuMzQgKyBuMTEgKiBuMjMgKiBuMzQgKSAqIGRldEludjsKCQl0ZVsgMTQgXSA9ICggbjE0ICogbjIyICogbjMxIC0gbjEyICogbjI0ICogbjMxIC0gbjE0ICogbjIxICogbjMyICsgbjExICogbjI0ICogbjMyICsgbjEyICogbjIxICogbjM0IC0gbjExICogbjIyICogbjM0ICkgKiBkZXRJbnY7CgkJdGVbIDE1IF0gPSAoIG4xMiAqIG4yMyAqIG4zMSAtIG4xMyAqIG4yMiAqIG4zMSArIG4xMyAqIG4yMSAqIG4zMiAtIG4xMSAqIG4yMyAqIG4zMiAtIG4xMiAqIG4yMSAqIG4zMyArIG4xMSAqIG4yMiAqIG4zMyApICogZGV0SW52OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2NhbGUoIHYgKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCB4ID0gdi54LCB5ID0gdi55LCB6ID0gdi56OwoKCQl0ZVsgMCBdICo9IHg7IHRlWyA0IF0gKj0geTsgdGVbIDggXSAqPSB6OwoJCXRlWyAxIF0gKj0geDsgdGVbIDUgXSAqPSB5OyB0ZVsgOSBdICo9IHo7CgkJdGVbIDIgXSAqPSB4OyB0ZVsgNiBdICo9IHk7IHRlWyAxMCBdICo9IHo7CgkJdGVbIDMgXSAqPSB4OyB0ZVsgNyBdICo9IHk7IHRlWyAxMSBdICo9IHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRNYXhTY2FsZU9uQXhpcygpIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQljb25zdCBzY2FsZVhTcSA9IHRlWyAwIF0gKiB0ZVsgMCBdICsgdGVbIDEgXSAqIHRlWyAxIF0gKyB0ZVsgMiBdICogdGVbIDIgXTsKCQljb25zdCBzY2FsZVlTcSA9IHRlWyA0IF0gKiB0ZVsgNCBdICsgdGVbIDUgXSAqIHRlWyA1IF0gKyB0ZVsgNiBdICogdGVbIDYgXTsKCQljb25zdCBzY2FsZVpTcSA9IHRlWyA4IF0gKiB0ZVsgOCBdICsgdGVbIDkgXSAqIHRlWyA5IF0gKyB0ZVsgMTAgXSAqIHRlWyAxMCBdOwoKCQlyZXR1cm4gTWF0aC5zcXJ0KCBNYXRoLm1heCggc2NhbGVYU3EsIHNjYWxlWVNxLCBzY2FsZVpTcSApICk7CgoJfQoKCW1ha2VUcmFuc2xhdGlvbiggeCwgeSwgeiApIHsKCgkJaWYgKCB4LmlzVmVjdG9yMyApIHsKCgkJCXRoaXMuc2V0KAoKCQkJCTEsIDAsIDAsIHgueCwKCQkJCTAsIDEsIDAsIHgueSwKCQkJCTAsIDAsIDEsIHgueiwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLnNldCgKCgkJCQkxLCAwLCAwLCB4LAoJCQkJMCwgMSwgMCwgeSwKCQkJCTAsIDAsIDEsIHosCgkJCQkwLCAwLCAwLCAxCgoJCQkpOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25YKCB0aGV0YSApIHsKCgkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCXRoaXMuc2V0KAoKCQkJMSwgMCwgMCwgMCwKCQkJMCwgYywgLSBzLCAwLAoJCQkwLCBzLCBjLCAwLAoJCQkwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25ZKCB0aGV0YSApIHsKCgkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCXRoaXMuc2V0KAoKCQkJIGMsIDAsIHMsIDAsCgkJCSAwLCAxLCAwLCAwLAoJCQktIHMsIDAsIGMsIDAsCgkJCSAwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25aKCB0aGV0YSApIHsKCgkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCXRoaXMuc2V0KAoKCQkJYywgLSBzLCAwLCAwLAoJCQlzLCBjLCAwLCAwLAoJCQkwLCAwLCAxLCAwLAoJCQkwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25BeGlzKCBheGlzLCBhbmdsZSApIHsKCgkJLy8gQmFzZWQgb24gaHR0cDovL3d3dy5nYW1lZGV2Lm5ldC9yZWZlcmVuY2UvYXJ0aWNsZXMvYXJ0aWNsZTExOTkuYXNwCgoJCWNvbnN0IGMgPSBNYXRoLmNvcyggYW5nbGUgKTsKCQljb25zdCBzID0gTWF0aC5zaW4oIGFuZ2xlICk7CgkJY29uc3QgdCA9IDEgLSBjOwoJCWNvbnN0IHggPSBheGlzLngsIHkgPSBheGlzLnksIHogPSBheGlzLno7CgkJY29uc3QgdHggPSB0ICogeCwgdHkgPSB0ICogeTsKCgkJdGhpcy5zZXQoCgoJCQl0eCAqIHggKyBjLCB0eCAqIHkgLSBzICogeiwgdHggKiB6ICsgcyAqIHksIDAsCgkJCXR4ICogeSArIHMgKiB6LCB0eSAqIHkgKyBjLCB0eSAqIHogLSBzICogeCwgMCwKCQkJdHggKiB6IC0gcyAqIHksIHR5ICogeiArIHMgKiB4LCB0ICogeiAqIHogKyBjLCAwLAoJCQkwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlU2NhbGUoIHgsIHksIHogKSB7CgoJCXRoaXMuc2V0KAoKCQkJeCwgMCwgMCwgMCwKCQkJMCwgeSwgMCwgMCwKCQkJMCwgMCwgeiwgMCwKCQkJMCwgMCwgMCwgMQoKCQkpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWFrZVNoZWFyKCB4eSwgeHosIHl4LCB5eiwgengsIHp5ICkgewoKCQl0aGlzLnNldCgKCgkJCTEsIHl4LCB6eCwgMCwKCQkJeHksIDEsIHp5LCAwLAoJCQl4eiwgeXosIDEsIDAsCgkJCTAsIDAsIDAsIDEKCgkJKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQljb25zdCB4ID0gcXVhdGVybmlvbi5feCwgeSA9IHF1YXRlcm5pb24uX3ksIHogPSBxdWF0ZXJuaW9uLl96LCB3ID0gcXVhdGVybmlvbi5fdzsKCQljb25zdCB4MiA9IHggKyB4LAl5MiA9IHkgKyB5LCB6MiA9IHogKyB6OwoJCWNvbnN0IHh4ID0geCAqIHgyLCB4eSA9IHggKiB5MiwgeHogPSB4ICogejI7CgkJY29uc3QgeXkgPSB5ICogeTIsIHl6ID0geSAqIHoyLCB6eiA9IHogKiB6MjsKCQljb25zdCB3eCA9IHcgKiB4Miwgd3kgPSB3ICogeTIsIHd6ID0gdyAqIHoyOwoKCQljb25zdCBzeCA9IHNjYWxlLngsIHN5ID0gc2NhbGUueSwgc3ogPSBzY2FsZS56OwoKCQl0ZVsgMCBdID0gKCAxIC0gKCB5eSArIHp6ICkgKSAqIHN4OwoJCXRlWyAxIF0gPSAoIHh5ICsgd3ogKSAqIHN4OwoJCXRlWyAyIF0gPSAoIHh6IC0gd3kgKSAqIHN4OwoJCXRlWyAzIF0gPSAwOwoKCQl0ZVsgNCBdID0gKCB4eSAtIHd6ICkgKiBzeTsKCQl0ZVsgNSBdID0gKCAxIC0gKCB4eCArIHp6ICkgKSAqIHN5OwoJCXRlWyA2IF0gPSAoIHl6ICsgd3ggKSAqIHN5OwoJCXRlWyA3IF0gPSAwOwoKCQl0ZVsgOCBdID0gKCB4eiArIHd5ICkgKiBzejsKCQl0ZVsgOSBdID0gKCB5eiAtIHd4ICkgKiBzejsKCQl0ZVsgMTAgXSA9ICggMSAtICggeHggKyB5eSApICkgKiBzejsKCQl0ZVsgMTEgXSA9IDA7CgoJCXRlWyAxMiBdID0gcG9zaXRpb24ueDsKCQl0ZVsgMTMgXSA9IHBvc2l0aW9uLnk7CgkJdGVbIDE0IF0gPSBwb3NpdGlvbi56OwoJCXRlWyAxNSBdID0gMTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRlY29tcG9zZSggcG9zaXRpb24sIHF1YXRlcm5pb24sIHNjYWxlICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCWxldCBzeCA9IF92MSQ1LnNldCggdGVbIDAgXSwgdGVbIDEgXSwgdGVbIDIgXSApLmxlbmd0aCgpOwoJCWNvbnN0IHN5ID0gX3YxJDUuc2V0KCB0ZVsgNCBdLCB0ZVsgNSBdLCB0ZVsgNiBdICkubGVuZ3RoKCk7CgkJY29uc3Qgc3ogPSBfdjEkNS5zZXQoIHRlWyA4IF0sIHRlWyA5IF0sIHRlWyAxMCBdICkubGVuZ3RoKCk7CgoJCS8vIGlmIGRldGVybWluZSBpcyBuZWdhdGl2ZSwgd2UgbmVlZCB0byBpbnZlcnQgb25lIHNjYWxlCgkJY29uc3QgZGV0ID0gdGhpcy5kZXRlcm1pbmFudCgpOwoJCWlmICggZGV0IDwgMCApIHN4ID0gLSBzeDsKCgkJcG9zaXRpb24ueCA9IHRlWyAxMiBdOwoJCXBvc2l0aW9uLnkgPSB0ZVsgMTMgXTsKCQlwb3NpdGlvbi56ID0gdGVbIDE0IF07CgoJCS8vIHNjYWxlIHRoZSByb3RhdGlvbiBwYXJ0CgkJX20xJDIuY29weSggdGhpcyApOwoKCQljb25zdCBpbnZTWCA9IDEgLyBzeDsKCQljb25zdCBpbnZTWSA9IDEgLyBzeTsKCQljb25zdCBpbnZTWiA9IDEgLyBzejsKCgkJX20xJDIuZWxlbWVudHNbIDAgXSAqPSBpbnZTWDsKCQlfbTEkMi5lbGVtZW50c1sgMSBdICo9IGludlNYOwoJCV9tMSQyLmVsZW1lbnRzWyAyIF0gKj0gaW52U1g7CgoJCV9tMSQyLmVsZW1lbnRzWyA0IF0gKj0gaW52U1k7CgkJX20xJDIuZWxlbWVudHNbIDUgXSAqPSBpbnZTWTsKCQlfbTEkMi5lbGVtZW50c1sgNiBdICo9IGludlNZOwoKCQlfbTEkMi5lbGVtZW50c1sgOCBdICo9IGludlNaOwoJCV9tMSQyLmVsZW1lbnRzWyA5IF0gKj0gaW52U1o7CgkJX20xJDIuZWxlbWVudHNbIDEwIF0gKj0gaW52U1o7CgoJCXF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBfbTEkMiApOwoKCQlzY2FsZS54ID0gc3g7CgkJc2NhbGUueSA9IHN5OwoJCXNjYWxlLnogPSBzejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW1ha2VQZXJzcGVjdGl2ZSggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCBuZWFyLCBmYXIsIGNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCB4ID0gMiAqIG5lYXIgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCWNvbnN0IHkgPSAyICogbmVhciAvICggdG9wIC0gYm90dG9tICk7CgoJCWNvbnN0IGEgPSAoIHJpZ2h0ICsgbGVmdCApIC8gKCByaWdodCAtIGxlZnQgKTsKCQljb25zdCBiID0gKCB0b3AgKyBib3R0b20gKSAvICggdG9wIC0gYm90dG9tICk7CgoJCWxldCBjLCBkOwoKCQlpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCWMgPSAtICggZmFyICsgbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgkJCWQgPSAoIC0gMiAqIGZhciAqIG5lYXIgKSAvICggZmFyIC0gbmVhciApOwoKCQl9IGVsc2UgaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHUFVDb29yZGluYXRlU3lzdGVtICkgewoKCQkJYyA9IC0gZmFyIC8gKCBmYXIgLSBuZWFyICk7CgkJCWQgPSAoIC0gZmFyICogbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgoJCX0gZWxzZSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5NYXRyaXg0Lm1ha2VQZXJzcGVjdGl2ZSgpOiBJbnZhbGlkIGNvb3JkaW5hdGUgc3lzdGVtOiAnICsgY29vcmRpbmF0ZVN5c3RlbSApOwoKCQl9CgoJCXRlWyAwIF0gPSB4Owl0ZVsgNCBdID0gMDsJdGVbIDggXSA9IGE7IAl0ZVsgMTIgXSA9IDA7CgkJdGVbIDEgXSA9IDA7CXRlWyA1IF0gPSB5Owl0ZVsgOSBdID0gYjsgCXRlWyAxMyBdID0gMDsKCQl0ZVsgMiBdID0gMDsJdGVbIDYgXSA9IDA7CXRlWyAxMCBdID0gYzsgCXRlWyAxNCBdID0gZDsKCQl0ZVsgMyBdID0gMDsJdGVbIDcgXSA9IDA7CXRlWyAxMSBdID0gLSAxOwl0ZVsgMTUgXSA9IDA7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlT3J0aG9ncmFwaGljKCBsZWZ0LCByaWdodCwgdG9wLCBib3R0b20sIG5lYXIsIGZhciwgY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCWNvbnN0IHcgPSAxLjAgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCWNvbnN0IGggPSAxLjAgLyAoIHRvcCAtIGJvdHRvbSApOwoJCWNvbnN0IHAgPSAxLjAgLyAoIGZhciAtIG5lYXIgKTsKCgkJY29uc3QgeCA9ICggcmlnaHQgKyBsZWZ0ICkgKiB3OwoJCWNvbnN0IHkgPSAoIHRvcCArIGJvdHRvbSApICogaDsKCgkJbGV0IHosIHpJbnY7CgoJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJeiA9ICggZmFyICsgbmVhciApICogcDsKCQkJekludiA9IC0gMiAqIHA7CgoJCX0gZWxzZSBpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQl6ID0gbmVhciAqIHA7CgkJCXpJbnYgPSAtIDEgKiBwOwoKCQl9IGVsc2UgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuTWF0cml4NC5tYWtlT3J0aG9ncmFwaGljKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgoJCX0KCgkJdGVbIDAgXSA9IDIgKiB3Owl0ZVsgNCBdID0gMDsJCXRlWyA4IF0gPSAwOyAJCXRlWyAxMiBdID0gLSB4OwoJCXRlWyAxIF0gPSAwOyAJCXRlWyA1IF0gPSAyICogaDsJdGVbIDkgXSA9IDA7IAkJdGVbIDEzIF0gPSAtIHk7CgkJdGVbIDIgXSA9IDA7IAkJdGVbIDYgXSA9IDA7CQl0ZVsgMTAgXSA9IHpJbnY7CXRlWyAxNCBdID0gLSB6OwoJCXRlWyAzIF0gPSAwOyAJCXRlWyA3IF0gPSAwOwkJdGVbIDExIF0gPSAwOwkJdGVbIDE1IF0gPSAxOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCBtYXRyaXggKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCBtZSA9IG1hdHJpeC5lbGVtZW50czsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgMTY7IGkgKysgKSB7CgoJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgoJCX0KCgkJcmV0dXJuIHRydWU7CgoJfQoKCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDE2OyBpICsrICkgewoKCQkJdGhpcy5lbGVtZW50c1sgaSBdID0gYXJyYXlbIGkgKyBvZmZzZXQgXTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQlhcnJheVsgb2Zmc2V0IF0gPSB0ZVsgMCBdOwoJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0ZVsgMSBdOwoJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0ZVsgMiBdOwoJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0ZVsgMyBdOwoKCQlhcnJheVsgb2Zmc2V0ICsgNCBdID0gdGVbIDQgXTsKCQlhcnJheVsgb2Zmc2V0ICsgNSBdID0gdGVbIDUgXTsKCQlhcnJheVsgb2Zmc2V0ICsgNiBdID0gdGVbIDYgXTsKCQlhcnJheVsgb2Zmc2V0ICsgNyBdID0gdGVbIDcgXTsKCgkJYXJyYXlbIG9mZnNldCArIDggXSA9IHRlWyA4IF07CgkJYXJyYXlbIG9mZnNldCArIDkgXSA9IHRlWyA5IF07CgkJYXJyYXlbIG9mZnNldCArIDEwIF0gPSB0ZVsgMTAgXTsKCQlhcnJheVsgb2Zmc2V0ICsgMTEgXSA9IHRlWyAxMSBdOwoKCQlhcnJheVsgb2Zmc2V0ICsgMTIgXSA9IHRlWyAxMiBdOwoJCWFycmF5WyBvZmZzZXQgKyAxMyBdID0gdGVbIDEzIF07CgkJYXJyYXlbIG9mZnNldCArIDE0IF0gPSB0ZVsgMTQgXTsKCQlhcnJheVsgb2Zmc2V0ICsgMTUgXSA9IHRlWyAxNSBdOwoKCQlyZXR1cm4gYXJyYXk7CgoJfQoKfQoKY29uc3QgX3YxJDUgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9tMSQyID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwpjb25zdCBfemVybyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIDAsIDAgKTsKY29uc3QgX29uZSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDEsIDEgKTsKY29uc3QgX3ggPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF95ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfeiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9tYXRyaXgkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX3F1YXRlcm5pb24kMyA9IC8qQF9fUFVSRV9fKi8gbmV3IFF1YXRlcm5pb24oKTsKCmNsYXNzIEV1bGVyIHsKCgljb25zdHJ1Y3RvciggeCA9IDAsIHkgPSAwLCB6ID0gMCwgb3JkZXIgPSBFdWxlci5ERUZBVUxUX09SREVSICkgewoKCQl0aGlzLmlzRXVsZXIgPSB0cnVlOwoKCQl0aGlzLl94ID0geDsKCQl0aGlzLl95ID0geTsKCQl0aGlzLl96ID0gejsKCQl0aGlzLl9vcmRlciA9IG9yZGVyOwoKCX0KCglnZXQgeCgpIHsKCgkJcmV0dXJuIHRoaXMuX3g7CgoJfQoKCXNldCB4KCB2YWx1ZSApIHsKCgkJdGhpcy5feCA9IHZhbHVlOwoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgl9CgoJZ2V0IHkoKSB7CgoJCXJldHVybiB0aGlzLl95OwoKCX0KCglzZXQgeSggdmFsdWUgKSB7CgoJCXRoaXMuX3kgPSB2YWx1ZTsKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJfQoKCWdldCB6KCkgewoKCQlyZXR1cm4gdGhpcy5fejsKCgl9CgoJc2V0IHooIHZhbHVlICkgewoKCQl0aGlzLl96ID0gdmFsdWU7CgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCX0KCglnZXQgb3JkZXIoKSB7CgoJCXJldHVybiB0aGlzLl9vcmRlcjsKCgl9CgoJc2V0IG9yZGVyKCB2YWx1ZSApIHsKCgkJdGhpcy5fb3JkZXIgPSB2YWx1ZTsKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJfQoKCXNldCggeCwgeSwgeiwgb3JkZXIgPSB0aGlzLl9vcmRlciApIHsKCgkJdGhpcy5feCA9IHg7CgkJdGhpcy5feSA9IHk7CgkJdGhpcy5feiA9IHo7CgkJdGhpcy5fb3JkZXIgPSBvcmRlcjsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy5feCwgdGhpcy5feSwgdGhpcy5feiwgdGhpcy5fb3JkZXIgKTsKCgl9CgoJY29weSggZXVsZXIgKSB7CgoJCXRoaXMuX3ggPSBldWxlci5feDsKCQl0aGlzLl95ID0gZXVsZXIuX3k7CgkJdGhpcy5feiA9IGV1bGVyLl96OwoJCXRoaXMuX29yZGVyID0gZXVsZXIuX29yZGVyOwoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tUm90YXRpb25NYXRyaXgoIG0sIG9yZGVyID0gdGhpcy5fb3JkZXIsIHVwZGF0ZSA9IHRydWUgKSB7CgoJCS8vIGFzc3VtZXMgdGhlIHVwcGVyIDN4MyBvZiBtIGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXggKGkuZSwgdW5zY2FsZWQpCgoJCWNvbnN0IHRlID0gbS5lbGVtZW50czsKCQljb25zdCBtMTEgPSB0ZVsgMCBdLCBtMTIgPSB0ZVsgNCBdLCBtMTMgPSB0ZVsgOCBdOwoJCWNvbnN0IG0yMSA9IHRlWyAxIF0sIG0yMiA9IHRlWyA1IF0sIG0yMyA9IHRlWyA5IF07CgkJY29uc3QgbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF07CgoJCXN3aXRjaCAoIG9yZGVyICkgewoKCQkJY2FzZSAnWFlaJzoKCgkJCQl0aGlzLl95ID0gTWF0aC5hc2luKCBjbGFtcCggbTEzLCAtIDEsIDEgKSApOwoKCQkJCWlmICggTWF0aC5hYnMoIG0xMyApIDwgMC45OTk5OTk5ICkgewoKCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0zMyApOwoJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCAtIG0xMiwgbTExICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIG0zMiwgbTIyICk7CgkJCQkJdGhpcy5feiA9IDA7CgoJCQkJfQoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnWVhaJzoKCgkJCQl0aGlzLl94ID0gTWF0aC5hc2luKCAtIGNsYW1wKCBtMjMsIC0gMSwgMSApICk7CgoJCQkJaWYgKCBNYXRoLmFicyggbTIzICkgPCAwLjk5OTk5OTkgKSB7CgoJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0zMyApOwoJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCBtMjEsIG0yMiApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCAtIG0zMSwgbTExICk7CgkJCQkJdGhpcy5feiA9IDA7CgoJCQkJfQoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnWlhZJzoKCgkJCQl0aGlzLl94ID0gTWF0aC5hc2luKCBjbGFtcCggbTMyLCAtIDEsIDEgKSApOwoKCQkJCWlmICggTWF0aC5hYnMoIG0zMiApIDwgMC45OTk5OTk5ICkgewoKCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0zMyApOwoJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCAtIG0xMiwgbTIyICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGhpcy5feSA9IDA7CgkJCQkJdGhpcy5feiA9IE1hdGguYXRhbjIoIG0yMSwgbTExICk7CgoJCQkJfQoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnWllYJzoKCgkJCQl0aGlzLl95ID0gTWF0aC5hc2luKCAtIGNsYW1wKCBtMzEsIC0gMSwgMSApICk7CgoJCQkJaWYgKCBNYXRoLmFicyggbTMxICkgPCAwLjk5OTk5OTkgKSB7CgoJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0zMyApOwoJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCBtMjEsIG0xMSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMuX3ggPSAwOwoJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCAtIG0xMiwgbTIyICk7CgoJCQkJfQoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnWVpYJzoKCgkJCQl0aGlzLl96ID0gTWF0aC5hc2luKCBjbGFtcCggbTIxLCAtIDEsIDEgKSApOwoKCQkJCWlmICggTWF0aC5hYnMoIG0yMSApIDwgMC45OTk5OTk5ICkgewoKCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0yMiApOwoJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCAtIG0zMSwgbTExICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGhpcy5feCA9IDA7CgkJCQkJdGhpcy5feSA9IE1hdGguYXRhbjIoIG0xMywgbTMzICk7CgoJCQkJfQoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnWFpZJzoKCgkJCQl0aGlzLl96ID0gTWF0aC5hc2luKCAtIGNsYW1wKCBtMTIsIC0gMSwgMSApICk7CgoJCQkJaWYgKCBNYXRoLmFicyggbTEyICkgPCAwLjk5OTk5OTkgKSB7CgoJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0yMiApOwoJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0xMSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCAtIG0yMywgbTMzICk7CgkJCQkJdGhpcy5feSA9IDA7CgoJCQkJfQoKCQkJCWJyZWFrOwoKCQkJZGVmYXVsdDoKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5FdWxlcjogLnNldEZyb21Sb3RhdGlvbk1hdHJpeCgpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICcgKyBvcmRlciApOwoKCQl9CgoJCXRoaXMuX29yZGVyID0gb3JkZXI7CgoJCWlmICggdXBkYXRlID09PSB0cnVlICkgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbVF1YXRlcm5pb24oIHEsIG9yZGVyLCB1cGRhdGUgKSB7CgoJCV9tYXRyaXgkMS5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbiggcSApOwoKCQlyZXR1cm4gdGhpcy5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tYXRyaXgkMSwgb3JkZXIsIHVwZGF0ZSApOwoKCX0KCglzZXRGcm9tVmVjdG9yMyggdiwgb3JkZXIgPSB0aGlzLl9vcmRlciApIHsKCgkJcmV0dXJuIHRoaXMuc2V0KCB2LngsIHYueSwgdi56LCBvcmRlciApOwoKCX0KCglyZW9yZGVyKCBuZXdPcmRlciApIHsKCgkJLy8gV0FSTklORzogdGhpcyBkaXNjYXJkcyByZXZvbHV0aW9uIGluZm9ybWF0aW9uIC1iaG91c3RvbgoKCQlfcXVhdGVybmlvbiQzLnNldEZyb21FdWxlciggdGhpcyApOwoKCQlyZXR1cm4gdGhpcy5zZXRGcm9tUXVhdGVybmlvbiggX3F1YXRlcm5pb24kMywgbmV3T3JkZXIgKTsKCgl9CgoJZXF1YWxzKCBldWxlciApIHsKCgkJcmV0dXJuICggZXVsZXIuX3ggPT09IHRoaXMuX3ggKSAmJiAoIGV1bGVyLl95ID09PSB0aGlzLl95ICkgJiYgKCBldWxlci5feiA9PT0gdGhpcy5feiApICYmICggZXVsZXIuX29yZGVyID09PSB0aGlzLl9vcmRlciApOwoKCX0KCglmcm9tQXJyYXkoIGFycmF5ICkgewoKCQl0aGlzLl94ID0gYXJyYXlbIDAgXTsKCQl0aGlzLl95ID0gYXJyYXlbIDEgXTsKCQl0aGlzLl96ID0gYXJyYXlbIDIgXTsKCQlpZiAoIGFycmF5WyAzIF0gIT09IHVuZGVmaW5lZCApIHRoaXMuX29yZGVyID0gYXJyYXlbIDMgXTsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy5feDsKCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGhpcy5feTsKCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGhpcy5fejsKCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGhpcy5fb3JkZXI7CgoJCXJldHVybiBhcnJheTsKCgl9CgoJX29uQ2hhbmdlKCBjYWxsYmFjayApIHsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjayA9IGNhbGxiYWNrOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJX29uQ2hhbmdlQ2FsbGJhY2soKSB7fQoKCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKCQl5aWVsZCB0aGlzLl94OwoJCXlpZWxkIHRoaXMuX3k7CgkJeWllbGQgdGhpcy5fejsKCQl5aWVsZCB0aGlzLl9vcmRlcjsKCgl9Cgp9CgpFdWxlci5ERUZBVUxUX09SREVSID0gJ1hZWic7CgpjbGFzcyBMYXllcnMgewoKCWNvbnN0cnVjdG9yKCkgewoKCQl0aGlzLm1hc2sgPSAxIHwgMDsKCgl9CgoJc2V0KCBjaGFubmVsICkgewoKCQl0aGlzLm1hc2sgPSAoIDEgPDwgY2hhbm5lbCB8IDAgKSA+Pj4gMDsKCgl9CgoJZW5hYmxlKCBjaGFubmVsICkgewoKCQl0aGlzLm1hc2sgfD0gMSA8PCBjaGFubmVsIHwgMDsKCgl9CgoJZW5hYmxlQWxsKCkgewoKCQl0aGlzLm1hc2sgPSAweGZmZmZmZmZmIHwgMDsKCgl9CgoJdG9nZ2xlKCBjaGFubmVsICkgewoKCQl0aGlzLm1hc2sgXj0gMSA8PCBjaGFubmVsIHwgMDsKCgl9CgoJZGlzYWJsZSggY2hhbm5lbCApIHsKCgkJdGhpcy5tYXNrICY9IH4gKCAxIDw8IGNoYW5uZWwgfCAwICk7CgoJfQoKCWRpc2FibGVBbGwoKSB7CgoJCXRoaXMubWFzayA9IDA7CgoJfQoKCXRlc3QoIGxheWVycyApIHsKCgkJcmV0dXJuICggdGhpcy5tYXNrICYgbGF5ZXJzLm1hc2sgKSAhPT0gMDsKCgl9CgoJaXNFbmFibGVkKCBjaGFubmVsICkgewoKCQlyZXR1cm4gKCB0aGlzLm1hc2sgJiAoIDEgPDwgY2hhbm5lbCB8IDAgKSApICE9PSAwOwoKCX0KCn0KCmxldCBfb2JqZWN0M0RJZCA9IDA7Cgpjb25zdCBfdjEkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ExID0gLypAX19QVVJFX18qLyBuZXcgUXVhdGVybmlvbigpOwpjb25zdCBfbTEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX3RhcmdldCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9wb3NpdGlvbiQzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfc2NhbGUkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3F1YXRlcm5pb24kMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFF1YXRlcm5pb24oKTsKCmNvbnN0IF94QXhpcyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDAsIDAgKTsKY29uc3QgX3lBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwpjb25zdCBfekF4aXMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCAwLCAxICk7Cgpjb25zdCBfYWRkZWRFdmVudCA9IHsgdHlwZTogJ2FkZGVkJyB9Owpjb25zdCBfcmVtb3ZlZEV2ZW50ID0geyB0eXBlOiAncmVtb3ZlZCcgfTsKCmNsYXNzIE9iamVjdDNEIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc09iamVjdDNEID0gdHJ1ZTsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBfb2JqZWN0M0RJZCArKyB9ICk7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQl0aGlzLm5hbWUgPSAnJzsKCQl0aGlzLnR5cGUgPSAnT2JqZWN0M0QnOwoKCQl0aGlzLnBhcmVudCA9IG51bGw7CgkJdGhpcy5jaGlsZHJlbiA9IFtdOwoKCQl0aGlzLnVwID0gT2JqZWN0M0QuREVGQVVMVF9VUC5jbG9uZSgpOwoKCQljb25zdCBwb3NpdGlvbiA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3Qgcm90YXRpb24gPSBuZXcgRXVsZXIoKTsKCQljb25zdCBxdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCQljb25zdCBzY2FsZSA9IG5ldyBWZWN0b3IzKCAxLCAxLCAxICk7CgoJCWZ1bmN0aW9uIG9uUm90YXRpb25DaGFuZ2UoKSB7CgoJCQlxdWF0ZXJuaW9uLnNldEZyb21FdWxlciggcm90YXRpb24sIGZhbHNlICk7CgoJCX0KCgkJZnVuY3Rpb24gb25RdWF0ZXJuaW9uQ2hhbmdlKCkgewoKCQkJcm90YXRpb24uc2V0RnJvbVF1YXRlcm5pb24oIHF1YXRlcm5pb24sIHVuZGVmaW5lZCwgZmFsc2UgKTsKCgkJfQoKCQlyb3RhdGlvbi5fb25DaGFuZ2UoIG9uUm90YXRpb25DaGFuZ2UgKTsKCQlxdWF0ZXJuaW9uLl9vbkNoYW5nZSggb25RdWF0ZXJuaW9uQ2hhbmdlICk7CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCB0aGlzLCB7CgkJCXBvc2l0aW9uOiB7CgkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJdmFsdWU6IHBvc2l0aW9uCgkJCX0sCgkJCXJvdGF0aW9uOiB7CgkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJdmFsdWU6IHJvdGF0aW9uCgkJCX0sCgkJCXF1YXRlcm5pb246IHsKCQkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQl2YWx1ZTogcXVhdGVybmlvbgoJCQl9LAoJCQlzY2FsZTogewoJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCQkJCXZhbHVlOiBzY2FsZQoJCQl9LAoJCQltb2RlbFZpZXdNYXRyaXg6IHsKCQkJCXZhbHVlOiBuZXcgTWF0cml4NCgpCgkJCX0sCgkJCW5vcm1hbE1hdHJpeDogewoJCQkJdmFsdWU6IG5ldyBNYXRyaXgzKCkKCQkJfQoJCX0gKTsKCgkJdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4NCgpOwoJCXRoaXMubWF0cml4V29ybGQgPSBuZXcgTWF0cml4NCgpOwoKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURTsKCgkJdGhpcy5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPSBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9XT1JMRF9BVVRPX1VQREFURTsgLy8gY2hlY2tlZCBieSB0aGUgcmVuZGVyZXIKCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy5sYXllcnMgPSBuZXcgTGF5ZXJzKCk7CgkJdGhpcy52aXNpYmxlID0gdHJ1ZTsKCgkJdGhpcy5jYXN0U2hhZG93ID0gZmFsc2U7CgkJdGhpcy5yZWNlaXZlU2hhZG93ID0gZmFsc2U7CgoJCXRoaXMuZnJ1c3R1bUN1bGxlZCA9IHRydWU7CgkJdGhpcy5yZW5kZXJPcmRlciA9IDA7CgoJCXRoaXMuYW5pbWF0aW9ucyA9IFtdOwoKCQl0aGlzLnVzZXJEYXRhID0ge307CgoJfQoKCW9uQmVmb3JlU2hhZG93KCAvKiByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIGdyb3VwICovICkge30KCglvbkFmdGVyU2hhZG93KCAvKiByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIGdyb3VwICovICkge30KCglvbkJlZm9yZVJlbmRlciggLyogcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKi8gKSB7fQoKCW9uQWZ0ZXJSZW5kZXIoIC8qIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICovICkge30KCglhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCgkJaWYgKCB0aGlzLm1hdHJpeEF1dG9VcGRhdGUgKSB0aGlzLnVwZGF0ZU1hdHJpeCgpOwoKCQl0aGlzLm1hdHJpeC5wcmVtdWx0aXBseSggbWF0cml4ICk7CgoJCXRoaXMubWF0cml4LmRlY29tcG9zZSggdGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCB0aGlzLnNjYWxlICk7CgoJfQoKCWFwcGx5UXVhdGVybmlvbiggcSApIHsKCgkJdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KCBxICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRSb3RhdGlvbkZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICkgewoKCQkvLyBhc3N1bWVzIGF4aXMgaXMgbm9ybWFsaXplZAoKCQl0aGlzLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKTsKCgl9CgoJc2V0Um90YXRpb25Gcm9tRXVsZXIoIGV1bGVyICkgewoKCQl0aGlzLnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKCBldWxlciwgdHJ1ZSApOwoKCX0KCglzZXRSb3RhdGlvbkZyb21NYXRyaXgoIG0gKSB7CgoJCS8vIGFzc3VtZXMgdGhlIHVwcGVyIDN4MyBvZiBtIGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXggKGkuZSwgdW5zY2FsZWQpCgoJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIG0gKTsKCgl9CgoJc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbiggcSApIHsKCgkJLy8gYXNzdW1lcyBxIGlzIG5vcm1hbGl6ZWQKCgkJdGhpcy5xdWF0ZXJuaW9uLmNvcHkoIHEgKTsKCgl9CgoJcm90YXRlT25BeGlzKCBheGlzLCBhbmdsZSApIHsKCgkJLy8gcm90YXRlIG9iamVjdCBvbiBheGlzIGluIG9iamVjdCBzcGFjZQoJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJCV9xMS5zZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApOwoKCQl0aGlzLnF1YXRlcm5pb24ubXVsdGlwbHkoIF9xMSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm90YXRlT25Xb3JsZEF4aXMoIGF4aXMsIGFuZ2xlICkgewoKCQkvLyByb3RhdGUgb2JqZWN0IG9uIGF4aXMgaW4gd29ybGQgc3BhY2UKCQkvLyBheGlzIGlzIGFzc3VtZWQgdG8gYmUgbm9ybWFsaXplZAoJCS8vIG1ldGhvZCBhc3N1bWVzIG5vIHJvdGF0ZWQgcGFyZW50CgoJCV9xMS5zZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApOwoKCQl0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkoIF9xMSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm90YXRlWCggYW5nbGUgKSB7CgoJCXJldHVybiB0aGlzLnJvdGF0ZU9uQXhpcyggX3hBeGlzLCBhbmdsZSApOwoKCX0KCglyb3RhdGVZKCBhbmdsZSApIHsKCgkJcmV0dXJuIHRoaXMucm90YXRlT25BeGlzKCBfeUF4aXMsIGFuZ2xlICk7CgoJfQoKCXJvdGF0ZVooIGFuZ2xlICkgewoKCQlyZXR1cm4gdGhpcy5yb3RhdGVPbkF4aXMoIF96QXhpcywgYW5nbGUgKTsKCgl9CgoJdHJhbnNsYXRlT25BeGlzKCBheGlzLCBkaXN0YW5jZSApIHsKCgkJLy8gdHJhbnNsYXRlIG9iamVjdCBieSBkaXN0YW5jZSBhbG9uZyBheGlzIGluIG9iamVjdCBzcGFjZQoJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJCV92MSQ0LmNvcHkoIGF4aXMgKS5hcHBseVF1YXRlcm5pb24oIHRoaXMucXVhdGVybmlvbiApOwoKCQl0aGlzLnBvc2l0aW9uLmFkZCggX3YxJDQubXVsdGlwbHlTY2FsYXIoIGRpc3RhbmNlICkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyYW5zbGF0ZVgoIGRpc3RhbmNlICkgewoKCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF94QXhpcywgZGlzdGFuY2UgKTsKCgl9CgoJdHJhbnNsYXRlWSggZGlzdGFuY2UgKSB7CgoJCXJldHVybiB0aGlzLnRyYW5zbGF0ZU9uQXhpcyggX3lBeGlzLCBkaXN0YW5jZSApOwoKCX0KCgl0cmFuc2xhdGVaKCBkaXN0YW5jZSApIHsKCgkJcmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKCBfekF4aXMsIGRpc3RhbmNlICk7CgoJfQoKCWxvY2FsVG9Xb3JsZCggdmVjdG9yICkgewoKCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQlyZXR1cm4gdmVjdG9yLmFwcGx5TWF0cml4NCggdGhpcy5tYXRyaXhXb3JsZCApOwoKCX0KCgl3b3JsZFRvTG9jYWwoIHZlY3RvciApIHsKCgkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJcmV0dXJuIHZlY3Rvci5hcHBseU1hdHJpeDQoIF9tMSQxLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKSApOwoKCX0KCglsb29rQXQoIHgsIHksIHogKSB7CgoJCS8vIFRoaXMgbWV0aG9kIGRvZXMgbm90IHN1cHBvcnQgb2JqZWN0cyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgcGFyZW50KHMpCgoJCWlmICggeC5pc1ZlY3RvcjMgKSB7CgoJCQlfdGFyZ2V0LmNvcHkoIHggKTsKCgkJfSBlbHNlIHsKCgkJCV90YXJnZXQuc2V0KCB4LCB5LCB6ICk7CgoJCX0KCgkJY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgoJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCV9wb3NpdGlvbiQzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggdGhpcy5tYXRyaXhXb3JsZCApOwoKCQlpZiAoIHRoaXMuaXNDYW1lcmEgfHwgdGhpcy5pc0xpZ2h0ICkgewoKCQkJX20xJDEubG9va0F0KCBfcG9zaXRpb24kMywgX3RhcmdldCwgdGhpcy51cCApOwoKCQl9IGVsc2UgewoKCQkJX20xJDEubG9va0F0KCBfdGFyZ2V0LCBfcG9zaXRpb24kMywgdGhpcy51cCApOwoKCQl9CgoJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQxICk7CgoJCWlmICggcGFyZW50ICkgewoKCQkJX20xJDEuZXh0cmFjdFJvdGF0aW9uKCBwYXJlbnQubWF0cml4V29ybGQgKTsKCQkJX3ExLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggX20xJDEgKTsKCQkJdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KCBfcTEuaW52ZXJ0KCkgKTsKCgkJfQoKCX0KCglhZGQoIG9iamVjdCApIHsKCgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoID4gMSApIHsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdGhpcy5hZGQoIGFyZ3VtZW50c1sgaSBdICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlpZiAoIG9iamVjdCA9PT0gdGhpcyApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBjYW5cJ3QgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiBpdHNlbGYuJywgb2JqZWN0ICk7CgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCWlmICggb2JqZWN0ICYmIG9iamVjdC5pc09iamVjdDNEICkgewoKCQkJaWYgKCBvYmplY3QucGFyZW50ICE9PSBudWxsICkgewoKCQkJCW9iamVjdC5wYXJlbnQucmVtb3ZlKCBvYmplY3QgKTsKCgkJCX0KCgkJCW9iamVjdC5wYXJlbnQgPSB0aGlzOwoJCQl0aGlzLmNoaWxkcmVuLnB1c2goIG9iamVjdCApOwoKCQkJb2JqZWN0LmRpc3BhdGNoRXZlbnQoIF9hZGRlZEV2ZW50ICk7CgoJCX0gZWxzZSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuT2JqZWN0M0QuYWRkOiBvYmplY3Qgbm90IGFuIGluc3RhbmNlIG9mIFRIUkVFLk9iamVjdDNELicsIG9iamVjdCApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglyZW1vdmUoIG9iamVjdCApIHsKCgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoID4gMSApIHsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdGhpcy5yZW1vdmUoIGFyZ3VtZW50c1sgaSBdICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQljb25zdCBpbmRleCA9IHRoaXMuY2hpbGRyZW4uaW5kZXhPZiggb2JqZWN0ICk7CgoJCWlmICggaW5kZXggIT09IC0gMSApIHsKCgkJCW9iamVjdC5wYXJlbnQgPSBudWxsOwoJCQl0aGlzLmNoaWxkcmVuLnNwbGljZSggaW5kZXgsIDEgKTsKCgkJCW9iamVjdC5kaXNwYXRjaEV2ZW50KCBfcmVtb3ZlZEV2ZW50ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJlbW92ZUZyb21QYXJlbnQoKSB7CgoJCWNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwoKCQlpZiAoIHBhcmVudCAhPT0gbnVsbCApIHsKCgkJCXBhcmVudC5yZW1vdmUoIHRoaXMgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xlYXIoKSB7CgoJCXJldHVybiB0aGlzLnJlbW92ZSggLi4uIHRoaXMuY2hpbGRyZW4gKTsKCgl9CgoJYXR0YWNoKCBvYmplY3QgKSB7CgoJCS8vIGFkZHMgb2JqZWN0IGFzIGEgY2hpbGQgb2YgdGhpcywgd2hpbGUgbWFpbnRhaW5pbmcgdGhlIG9iamVjdCdzIHdvcmxkIHRyYW5zZm9ybQoKCQkvLyBOb3RlOiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IHNjZW5lIGdyYXBocyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgbm9kZXMocykKCgkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJX20xJDEuY29weSggdGhpcy5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKCQlpZiAoIG9iamVjdC5wYXJlbnQgIT09IG51bGwgKSB7CgoJCQlvYmplY3QucGFyZW50LnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQkJX20xJDEubXVsdGlwbHkoIG9iamVjdC5wYXJlbnQubWF0cml4V29ybGQgKTsKCgkJfQoKCQlvYmplY3QuYXBwbHlNYXRyaXg0KCBfbTEkMSApOwoKCQl0aGlzLmFkZCggb2JqZWN0ICk7CgoJCW9iamVjdC51cGRhdGVXb3JsZE1hdHJpeCggZmFsc2UsIHRydWUgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldE9iamVjdEJ5SWQoIGlkICkgewoKCQlyZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCAnaWQnLCBpZCApOwoKCX0KCglnZXRPYmplY3RCeU5hbWUoIG5hbWUgKSB7CgoJCXJldHVybiB0aGlzLmdldE9iamVjdEJ5UHJvcGVydHkoICduYW1lJywgbmFtZSApOwoKCX0KCglnZXRPYmplY3RCeVByb3BlcnR5KCBuYW1lLCB2YWx1ZSApIHsKCgkJaWYgKCB0aGlzWyBuYW1lIF0gPT09IHZhbHVlICkgcmV0dXJuIHRoaXM7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlblsgaSBdOwoJCQljb25zdCBvYmplY3QgPSBjaGlsZC5nZXRPYmplY3RCeVByb3BlcnR5KCBuYW1lLCB2YWx1ZSApOwoKCQkJaWYgKCBvYmplY3QgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlyZXR1cm4gb2JqZWN0OwoKCQkJfQoKCQl9CgoJCXJldHVybiB1bmRlZmluZWQ7CgoJfQoKCWdldE9iamVjdHNCeVByb3BlcnR5KCBuYW1lLCB2YWx1ZSwgcmVzdWx0ID0gW10gKSB7CgoJCWlmICggdGhpc1sgbmFtZSBdID09PSB2YWx1ZSApIHJlc3VsdC5wdXNoKCB0aGlzICk7CgoJCWNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNoaWxkcmVuWyBpIF0uZ2V0T2JqZWN0c0J5UHJvcGVydHkoIG5hbWUsIHZhbHVlLCByZXN1bHQgKTsKCgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoKCX0KCglnZXRXb3JsZFBvc2l0aW9uKCB0YXJnZXQgKSB7CgoJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCXJldHVybiB0YXJnZXQuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJfQoKCWdldFdvcmxkUXVhdGVybmlvbiggdGFyZ2V0ICkgewoKCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQl0aGlzLm1hdHJpeFdvcmxkLmRlY29tcG9zZSggX3Bvc2l0aW9uJDMsIHRhcmdldCwgX3NjYWxlJDIgKTsKCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJZ2V0V29ybGRTY2FsZSggdGFyZ2V0ICkgewoKCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQl0aGlzLm1hdHJpeFdvcmxkLmRlY29tcG9zZSggX3Bvc2l0aW9uJDMsIF9xdWF0ZXJuaW9uJDIsIHRhcmdldCApOwoKCQlyZXR1cm4gdGFyZ2V0OwoKCX0KCglnZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkgewoKCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQljb25zdCBlID0gdGhpcy5tYXRyaXhXb3JsZC5lbGVtZW50czsKCgkJcmV0dXJuIHRhcmdldC5zZXQoIGVbIDggXSwgZVsgOSBdLCBlWyAxMCBdICkubm9ybWFsaXplKCk7CgoJfQoKCXJheWNhc3QoIC8qIHJheWNhc3RlciwgaW50ZXJzZWN0cyAqLyApIHt9CgoJdHJhdmVyc2UoIGNhbGxiYWNrICkgewoKCQljYWxsYmFjayggdGhpcyApOwoKCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljaGlsZHJlblsgaSBdLnRyYXZlcnNlKCBjYWxsYmFjayApOwoKCQl9CgoJfQoKCXRyYXZlcnNlVmlzaWJsZSggY2FsbGJhY2sgKSB7CgoJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCgkJY2FsbGJhY2soIHRoaXMgKTsKCgkJY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY2hpbGRyZW5bIGkgXS50cmF2ZXJzZVZpc2libGUoIGNhbGxiYWNrICk7CgoJCX0KCgl9CgoJdHJhdmVyc2VBbmNlc3RvcnMoIGNhbGxiYWNrICkgewoKCQljb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudDsKCgkJaWYgKCBwYXJlbnQgIT09IG51bGwgKSB7CgoJCQljYWxsYmFjayggcGFyZW50ICk7CgoJCQlwYXJlbnQudHJhdmVyc2VBbmNlc3RvcnMoIGNhbGxiYWNrICk7CgoJCX0KCgl9CgoJdXBkYXRlTWF0cml4KCkgewoKCQl0aGlzLm1hdHJpeC5jb21wb3NlKCB0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHRoaXMuc2NhbGUgKTsKCgkJdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJdXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICkgewoKCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSApIHRoaXMudXBkYXRlTWF0cml4KCk7CgoJCWlmICggdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlIHx8IGZvcmNlICkgewoKCQkJaWYgKCB0aGlzLnBhcmVudCA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLm1hdHJpeFdvcmxkLmNvcHkoIHRoaXMubWF0cml4ICk7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMubWF0cml4V29ybGQubXVsdGlwbHlNYXRyaWNlcyggdGhpcy5wYXJlbnQubWF0cml4V29ybGQsIHRoaXMubWF0cml4ICk7CgoJCQl9CgoJCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCWZvcmNlID0gdHJ1ZTsKCgkJfQoKCQkvLyB1cGRhdGUgY2hpbGRyZW4KCgkJY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgY2hpbGQgPSBjaGlsZHJlblsgaSBdOwoKCQkJaWYgKCBjaGlsZC5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPT09IHRydWUgfHwgZm9yY2UgPT09IHRydWUgKSB7CgoJCQkJY2hpbGQudXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICk7CgoJCQl9CgoJCX0KCgl9CgoJdXBkYXRlV29ybGRNYXRyaXgoIHVwZGF0ZVBhcmVudHMsIHVwZGF0ZUNoaWxkcmVuICkgewoKCQljb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudDsKCgkJaWYgKCB1cGRhdGVQYXJlbnRzID09PSB0cnVlICYmIHBhcmVudCAhPT0gbnVsbCAmJiBwYXJlbnQubWF0cml4V29ybGRBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJcGFyZW50LnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQl9CgoJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlICkgdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJaWYgKCB0aGlzLnBhcmVudCA9PT0gbnVsbCApIHsKCgkJCXRoaXMubWF0cml4V29ybGQuY29weSggdGhpcy5tYXRyaXggKTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMubWF0cml4V29ybGQubXVsdGlwbHlNYXRyaWNlcyggdGhpcy5wYXJlbnQubWF0cml4V29ybGQsIHRoaXMubWF0cml4ICk7CgoJCX0KCgkJLy8gdXBkYXRlIGNoaWxkcmVuCgoJCWlmICggdXBkYXRlQ2hpbGRyZW4gPT09IHRydWUgKSB7CgoJCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IGNoaWxkID0gY2hpbGRyZW5bIGkgXTsKCgkJCQlpZiAoIGNoaWxkLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJY2hpbGQudXBkYXRlV29ybGRNYXRyaXgoIGZhbHNlLCB0cnVlICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJLy8gbWV0YSBpcyBhIHN0cmluZyB3aGVuIGNhbGxlZCBmcm9tIEpTT04uc3RyaW5naWZ5CgkJY29uc3QgaXNSb290T2JqZWN0ID0gKCBtZXRhID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG1ldGEgPT09ICdzdHJpbmcnICk7CgoJCWNvbnN0IG91dHB1dCA9IHt9OwoKCQkvLyBtZXRhIGlzIGEgaGFzaCB1c2VkIHRvIGNvbGxlY3QgZ2VvbWV0cmllcywgbWF0ZXJpYWxzLgoJCS8vIG5vdCBwcm92aWRpbmcgaXQgaW1wbGllcyB0aGF0IHRoaXMgaXMgdGhlIHJvb3Qgb2JqZWN0CgkJLy8gYmVpbmcgc2VyaWFsaXplZC4KCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCgkJCS8vIGluaXRpYWxpemUgbWV0YSBvYmoKCQkJbWV0YSA9IHsKCQkJCWdlb21ldHJpZXM6IHt9LAoJCQkJbWF0ZXJpYWxzOiB7fSwKCQkJCXRleHR1cmVzOiB7fSwKCQkJCWltYWdlczoge30sCgkJCQlzaGFwZXM6IHt9LAoJCQkJc2tlbGV0b25zOiB7fSwKCQkJCWFuaW1hdGlvbnM6IHt9LAoJCQkJbm9kZXM6IHt9CgkJCX07CgoJCQlvdXRwdXQubWV0YWRhdGEgPSB7CgkJCQl2ZXJzaW9uOiA0LjYsCgkJCQl0eXBlOiAnT2JqZWN0JywKCQkJCWdlbmVyYXRvcjogJ09iamVjdDNELnRvSlNPTicKCQkJfTsKCgkJfQoKCQkvLyBzdGFuZGFyZCBPYmplY3QzRCBzZXJpYWxpemF0aW9uCgoJCWNvbnN0IG9iamVjdCA9IHt9OwoKCQlvYmplY3QudXVpZCA9IHRoaXMudXVpZDsKCQlvYmplY3QudHlwZSA9IHRoaXMudHlwZTsKCgkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgb2JqZWN0Lm5hbWUgPSB0aGlzLm5hbWU7CgkJaWYgKCB0aGlzLmNhc3RTaGFkb3cgPT09IHRydWUgKSBvYmplY3QuY2FzdFNoYWRvdyA9IHRydWU7CgkJaWYgKCB0aGlzLnJlY2VpdmVTaGFkb3cgPT09IHRydWUgKSBvYmplY3QucmVjZWl2ZVNoYWRvdyA9IHRydWU7CgkJaWYgKCB0aGlzLnZpc2libGUgPT09IGZhbHNlICkgb2JqZWN0LnZpc2libGUgPSBmYWxzZTsKCQlpZiAoIHRoaXMuZnJ1c3R1bUN1bGxlZCA9PT0gZmFsc2UgKSBvYmplY3QuZnJ1c3R1bUN1bGxlZCA9IGZhbHNlOwoJCWlmICggdGhpcy5yZW5kZXJPcmRlciAhPT0gMCApIG9iamVjdC5yZW5kZXJPcmRlciA9IHRoaXMucmVuZGVyT3JkZXI7CgkJaWYgKCBPYmplY3Qua2V5cyggdGhpcy51c2VyRGF0YSApLmxlbmd0aCA+IDAgKSBvYmplY3QudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKCQlvYmplY3QubGF5ZXJzID0gdGhpcy5sYXllcnMubWFzazsKCQlvYmplY3QubWF0cml4ID0gdGhpcy5tYXRyaXgudG9BcnJheSgpOwoJCW9iamVjdC51cCA9IHRoaXMudXAudG9BcnJheSgpOwoKCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSA9PT0gZmFsc2UgKSBvYmplY3QubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQkvLyBvYmplY3Qgc3BlY2lmaWMgcHJvcGVydGllcwoKCQlpZiAoIHRoaXMuaXNJbnN0YW5jZWRNZXNoICkgewoKCQkJb2JqZWN0LnR5cGUgPSAnSW5zdGFuY2VkTWVzaCc7CgkJCW9iamVjdC5jb3VudCA9IHRoaXMuY291bnQ7CgkJCW9iamVjdC5pbnN0YW5jZU1hdHJpeCA9IHRoaXMuaW5zdGFuY2VNYXRyaXgudG9KU09OKCk7CgkJCWlmICggdGhpcy5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgb2JqZWN0Lmluc3RhbmNlQ29sb3IgPSB0aGlzLmluc3RhbmNlQ29sb3IudG9KU09OKCk7CgoJCX0KCgkJaWYgKCB0aGlzLmlzQmF0Y2hlZE1lc2ggKSB7CgoJCQlvYmplY3QudHlwZSA9ICdCYXRjaGVkTWVzaCc7CgkJCW9iamVjdC5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkID0gdGhpcy5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkOwoJCQlvYmplY3Quc29ydE9iamVjdHMgPSB0aGlzLnNvcnRPYmplY3RzOwoKCQkJb2JqZWN0LmRyYXdSYW5nZXMgPSB0aGlzLl9kcmF3UmFuZ2VzOwoJCQlvYmplY3QucmVzZXJ2ZWRSYW5nZXMgPSB0aGlzLl9yZXNlcnZlZFJhbmdlczsKCgkJCW9iamVjdC52aXNpYmlsaXR5ID0gdGhpcy5fdmlzaWJpbGl0eTsKCQkJb2JqZWN0LmFjdGl2ZSA9IHRoaXMuX2FjdGl2ZTsKCQkJb2JqZWN0LmJvdW5kcyA9IHRoaXMuX2JvdW5kcy5tYXAoIGJvdW5kID0+ICggewoJCQkJYm94SW5pdGlhbGl6ZWQ6IGJvdW5kLmJveEluaXRpYWxpemVkLAoJCQkJYm94TWluOiBib3VuZC5ib3gubWluLnRvQXJyYXkoKSwKCQkJCWJveE1heDogYm91bmQuYm94Lm1heC50b0FycmF5KCksCgoJCQkJc3BoZXJlSW5pdGlhbGl6ZWQ6IGJvdW5kLnNwaGVyZUluaXRpYWxpemVkLAoJCQkJc3BoZXJlUmFkaXVzOiBib3VuZC5zcGhlcmUucmFkaXVzLAoJCQkJc3BoZXJlQ2VudGVyOiBib3VuZC5zcGhlcmUuY2VudGVyLnRvQXJyYXkoKQoJCQl9ICkgKTsKCgkJCW9iamVjdC5tYXhHZW9tZXRyeUNvdW50ID0gdGhpcy5fbWF4R2VvbWV0cnlDb3VudDsKCQkJb2JqZWN0Lm1heFZlcnRleENvdW50ID0gdGhpcy5fbWF4VmVydGV4Q291bnQ7CgkJCW9iamVjdC5tYXhJbmRleENvdW50ID0gdGhpcy5fbWF4SW5kZXhDb3VudDsKCgkJCW9iamVjdC5nZW9tZXRyeUluaXRpYWxpemVkID0gdGhpcy5fZ2VvbWV0cnlJbml0aWFsaXplZDsKCQkJb2JqZWN0Lmdlb21ldHJ5Q291bnQgPSB0aGlzLl9nZW9tZXRyeUNvdW50OwoKCQkJb2JqZWN0Lm1hdHJpY2VzVGV4dHVyZSA9IHRoaXMuX21hdHJpY2VzVGV4dHVyZS50b0pTT04oIG1ldGEgKTsKCgkJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQlvYmplY3QuYm91bmRpbmdTcGhlcmUgPSB7CgkJCQkJY2VudGVyOiBvYmplY3QuYm91bmRpbmdTcGhlcmUuY2VudGVyLnRvQXJyYXkoKSwKCQkJCQlyYWRpdXM6IG9iamVjdC5ib3VuZGluZ1NwaGVyZS5yYWRpdXMKCQkJCX07CgoJCQl9CgoJCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJb2JqZWN0LmJvdW5kaW5nQm94ID0gewoJCQkJCW1pbjogb2JqZWN0LmJvdW5kaW5nQm94Lm1pbi50b0FycmF5KCksCgkJCQkJbWF4OiBvYmplY3QuYm91bmRpbmdCb3gubWF4LnRvQXJyYXkoKQoJCQkJfTsKCgkJCX0KCgkJfQoKCQkvLwoKCQlmdW5jdGlvbiBzZXJpYWxpemUoIGxpYnJhcnksIGVsZW1lbnQgKSB7CgoJCQlpZiAoIGxpYnJhcnlbIGVsZW1lbnQudXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJbGlicmFyeVsgZWxlbWVudC51dWlkIF0gPSBlbGVtZW50LnRvSlNPTiggbWV0YSApOwoKCQkJfQoKCQkJcmV0dXJuIGVsZW1lbnQudXVpZDsKCgkJfQoKCQlpZiAoIHRoaXMuaXNTY2VuZSApIHsKCgkJCWlmICggdGhpcy5iYWNrZ3JvdW5kICkgewoKCQkJCWlmICggdGhpcy5iYWNrZ3JvdW5kLmlzQ29sb3IgKSB7CgoJCQkJCW9iamVjdC5iYWNrZ3JvdW5kID0gdGhpcy5iYWNrZ3JvdW5kLnRvSlNPTigpOwoKCQkJCX0gZWxzZSBpZiAoIHRoaXMuYmFja2dyb3VuZC5pc1RleHR1cmUgKSB7CgoJCQkJCW9iamVjdC5iYWNrZ3JvdW5kID0gdGhpcy5iYWNrZ3JvdW5kLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0aGlzLmVudmlyb25tZW50ICYmIHRoaXMuZW52aXJvbm1lbnQuaXNUZXh0dXJlICYmIHRoaXMuZW52aXJvbm1lbnQuaXNSZW5kZXJUYXJnZXRUZXh0dXJlICE9PSB0cnVlICkgewoKCQkJCW9iamVjdC5lbnZpcm9ubWVudCA9IHRoaXMuZW52aXJvbm1lbnQudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCX0KCgkJfSBlbHNlIGlmICggdGhpcy5pc01lc2ggfHwgdGhpcy5pc0xpbmUgfHwgdGhpcy5pc1BvaW50cyApIHsKCgkJCW9iamVjdC5nZW9tZXRyeSA9IHNlcmlhbGl6ZSggbWV0YS5nZW9tZXRyaWVzLCB0aGlzLmdlb21ldHJ5ICk7CgoJCQljb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5nZW9tZXRyeS5wYXJhbWV0ZXJzOwoKCQkJaWYgKCBwYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgJiYgcGFyYW1ldGVycy5zaGFwZXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zdCBzaGFwZXMgPSBwYXJhbWV0ZXJzLnNoYXBlczsKCgkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHNoYXBlcyApICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBzaGFwZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJCWNvbnN0IHNoYXBlID0gc2hhcGVzWyBpIF07CgoJCQkJCQlzZXJpYWxpemUoIG1ldGEuc2hhcGVzLCBzaGFwZSApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJc2VyaWFsaXplKCBtZXRhLnNoYXBlcywgc2hhcGVzICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWlmICggdGhpcy5pc1NraW5uZWRNZXNoICkgewoKCQkJb2JqZWN0LmJpbmRNb2RlID0gdGhpcy5iaW5kTW9kZTsKCQkJb2JqZWN0LmJpbmRNYXRyaXggPSB0aGlzLmJpbmRNYXRyaXgudG9BcnJheSgpOwoKCQkJaWYgKCB0aGlzLnNrZWxldG9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJc2VyaWFsaXplKCBtZXRhLnNrZWxldG9ucywgdGhpcy5za2VsZXRvbiApOwoKCQkJCW9iamVjdC5za2VsZXRvbiA9IHRoaXMuc2tlbGV0b24udXVpZDsKCgkJCX0KCgkJfQoKCQlpZiAoIHRoaXMubWF0ZXJpYWwgIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggQXJyYXkuaXNBcnJheSggdGhpcy5tYXRlcmlhbCApICkgewoKCQkJCWNvbnN0IHV1aWRzID0gW107CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5tYXRlcmlhbC5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQl1dWlkcy5wdXNoKCBzZXJpYWxpemUoIG1ldGEubWF0ZXJpYWxzLCB0aGlzLm1hdGVyaWFsWyBpIF0gKSApOwoKCQkJCX0KCgkJCQlvYmplY3QubWF0ZXJpYWwgPSB1dWlkczsKCgkJCX0gZWxzZSB7CgoJCQkJb2JqZWN0Lm1hdGVyaWFsID0gc2VyaWFsaXplKCBtZXRhLm1hdGVyaWFscywgdGhpcy5tYXRlcmlhbCApOwoKCQkJfQoKCQl9CgoJCS8vCgoJCWlmICggdGhpcy5jaGlsZHJlbi5sZW5ndGggPiAwICkgewoKCQkJb2JqZWN0LmNoaWxkcmVuID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCgkJCQlvYmplY3QuY2hpbGRyZW4ucHVzaCggdGhpcy5jaGlsZHJlblsgaSBdLnRvSlNPTiggbWV0YSApLm9iamVjdCApOwoKCQkJfQoKCQl9CgoJCS8vCgoJCWlmICggdGhpcy5hbmltYXRpb25zLmxlbmd0aCA+IDAgKSB7CgoJCQlvYmplY3QuYW5pbWF0aW9ucyA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5hbmltYXRpb25zLmxlbmd0aDsgaSArKyApIHsKCgkJCQljb25zdCBhbmltYXRpb24gPSB0aGlzLmFuaW1hdGlvbnNbIGkgXTsKCgkJCQlvYmplY3QuYW5pbWF0aW9ucy5wdXNoKCBzZXJpYWxpemUoIG1ldGEuYW5pbWF0aW9ucywgYW5pbWF0aW9uICkgKTsKCgkJCX0KCgkJfQoKCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCgkJCWNvbnN0IGdlb21ldHJpZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmdlb21ldHJpZXMgKTsKCQkJY29uc3QgbWF0ZXJpYWxzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5tYXRlcmlhbHMgKTsKCQkJY29uc3QgdGV4dHVyZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLnRleHR1cmVzICk7CgkJCWNvbnN0IGltYWdlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuaW1hZ2VzICk7CgkJCWNvbnN0IHNoYXBlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuc2hhcGVzICk7CgkJCWNvbnN0IHNrZWxldG9ucyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuc2tlbGV0b25zICk7CgkJCWNvbnN0IGFuaW1hdGlvbnMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmFuaW1hdGlvbnMgKTsKCQkJY29uc3Qgbm9kZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLm5vZGVzICk7CgoJCQlpZiAoIGdlb21ldHJpZXMubGVuZ3RoID4gMCApIG91dHB1dC5nZW9tZXRyaWVzID0gZ2VvbWV0cmllczsKCQkJaWYgKCBtYXRlcmlhbHMubGVuZ3RoID4gMCApIG91dHB1dC5tYXRlcmlhbHMgPSBtYXRlcmlhbHM7CgkJCWlmICggdGV4dHVyZXMubGVuZ3RoID4gMCApIG91dHB1dC50ZXh0dXJlcyA9IHRleHR1cmVzOwoJCQlpZiAoIGltYWdlcy5sZW5ndGggPiAwICkgb3V0cHV0LmltYWdlcyA9IGltYWdlczsKCQkJaWYgKCBzaGFwZXMubGVuZ3RoID4gMCApIG91dHB1dC5zaGFwZXMgPSBzaGFwZXM7CgkJCWlmICggc2tlbGV0b25zLmxlbmd0aCA+IDAgKSBvdXRwdXQuc2tlbGV0b25zID0gc2tlbGV0b25zOwoJCQlpZiAoIGFuaW1hdGlvbnMubGVuZ3RoID4gMCApIG91dHB1dC5hbmltYXRpb25zID0gYW5pbWF0aW9uczsKCQkJaWYgKCBub2Rlcy5sZW5ndGggPiAwICkgb3V0cHV0Lm5vZGVzID0gbm9kZXM7CgoJCX0KCgkJb3V0cHV0Lm9iamVjdCA9IG9iamVjdDsKCgkJcmV0dXJuIG91dHB1dDsKCgkJLy8gZXh0cmFjdCBkYXRhIGZyb20gdGhlIGNhY2hlIGhhc2gKCQkvLyByZW1vdmUgbWV0YWRhdGEgb24gZWFjaCBpdGVtCgkJLy8gYW5kIHJldHVybiBhcyBhcnJheQoJCWZ1bmN0aW9uIGV4dHJhY3RGcm9tQ2FjaGUoIGNhY2hlICkgewoKCQkJY29uc3QgdmFsdWVzID0gW107CgkJCWZvciAoIGNvbnN0IGtleSBpbiBjYWNoZSApIHsKCgkJCQljb25zdCBkYXRhID0gY2FjaGVbIGtleSBdOwoJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CgkJCQl2YWx1ZXMucHVzaCggZGF0YSApOwoKCQkJfQoKCQkJcmV0dXJuIHZhbHVlczsKCgkJfQoKCX0KCgljbG9uZSggcmVjdXJzaXZlICkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzLCByZWN1cnNpdmUgKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgPSB0cnVlICkgewoKCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCgkJdGhpcy51cC5jb3B5KCBzb3VyY2UudXAgKTsKCgkJdGhpcy5wb3NpdGlvbi5jb3B5KCBzb3VyY2UucG9zaXRpb24gKTsKCQl0aGlzLnJvdGF0aW9uLm9yZGVyID0gc291cmNlLnJvdGF0aW9uLm9yZGVyOwoJCXRoaXMucXVhdGVybmlvbi5jb3B5KCBzb3VyY2UucXVhdGVybmlvbiApOwoJCXRoaXMuc2NhbGUuY29weSggc291cmNlLnNjYWxlICk7CgoJCXRoaXMubWF0cml4LmNvcHkoIHNvdXJjZS5tYXRyaXggKTsKCQl0aGlzLm1hdHJpeFdvcmxkLmNvcHkoIHNvdXJjZS5tYXRyaXhXb3JsZCApOwoKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCgkJdGhpcy5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4V29ybGRBdXRvVXBkYXRlOwoJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHNvdXJjZS5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlOwoKCQl0aGlzLmxheWVycy5tYXNrID0gc291cmNlLmxheWVycy5tYXNrOwoJCXRoaXMudmlzaWJsZSA9IHNvdXJjZS52aXNpYmxlOwoKCQl0aGlzLmNhc3RTaGFkb3cgPSBzb3VyY2UuY2FzdFNoYWRvdzsKCQl0aGlzLnJlY2VpdmVTaGFkb3cgPSBzb3VyY2UucmVjZWl2ZVNoYWRvdzsKCgkJdGhpcy5mcnVzdHVtQ3VsbGVkID0gc291cmNlLmZydXN0dW1DdWxsZWQ7CgkJdGhpcy5yZW5kZXJPcmRlciA9IHNvdXJjZS5yZW5kZXJPcmRlcjsKCgkJdGhpcy5hbmltYXRpb25zID0gc291cmNlLmFuaW1hdGlvbnMuc2xpY2UoKTsKCgkJdGhpcy51c2VyRGF0YSA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBzb3VyY2UudXNlckRhdGEgKSApOwoKCQlpZiAoIHJlY3Vyc2l2ZSA9PT0gdHJ1ZSApIHsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHNvdXJjZS5jaGlsZHJlbi5sZW5ndGg7IGkgKysgKSB7CgoJCQkJY29uc3QgY2hpbGQgPSBzb3VyY2UuY2hpbGRyZW5bIGkgXTsKCQkJCXRoaXMuYWRkKCBjaGlsZC5jbG9uZSgpICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKT2JqZWN0M0QuREVGQVVMVF9VUCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIDEsIDAgKTsKT2JqZWN0M0QuREVGQVVMVF9NQVRSSVhfQVVUT19VUERBVEUgPSB0cnVlOwpPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9XT1JMRF9BVVRPX1VQREFURSA9IHRydWU7Cgpjb25zdCBfdjAkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3YxJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92MiQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdjMkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF92YWIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92YWMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92YmMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92YXAgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92YnAgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92Y3AgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpsZXQgd2FybmVkR2V0VVYgPSBmYWxzZTsKCmNsYXNzIFRyaWFuZ2xlIHsKCgljb25zdHJ1Y3RvciggYSA9IG5ldyBWZWN0b3IzKCksIGIgPSBuZXcgVmVjdG9yMygpLCBjID0gbmV3IFZlY3RvcjMoKSApIHsKCgkJdGhpcy5hID0gYTsKCQl0aGlzLmIgPSBiOwoJCXRoaXMuYyA9IGM7CgoJfQoKCXN0YXRpYyBnZXROb3JtYWwoIGEsIGIsIGMsIHRhcmdldCApIHsKCgkJdGFyZ2V0LnN1YlZlY3RvcnMoIGMsIGIgKTsKCQlfdjAkMS5zdWJWZWN0b3JzKCBhLCBiICk7CgkJdGFyZ2V0LmNyb3NzKCBfdjAkMSApOwoKCQljb25zdCB0YXJnZXRMZW5ndGhTcSA9IHRhcmdldC5sZW5ndGhTcSgpOwoJCWlmICggdGFyZ2V0TGVuZ3RoU3EgPiAwICkgewoKCQkJcmV0dXJuIHRhcmdldC5tdWx0aXBseVNjYWxhciggMSAvIE1hdGguc3FydCggdGFyZ2V0TGVuZ3RoU3EgKSApOwoKCQl9CgoJCXJldHVybiB0YXJnZXQuc2V0KCAwLCAwLCAwICk7CgoJfQoKCS8vIHN0YXRpYy9pbnN0YW5jZSBtZXRob2QgdG8gY2FsY3VsYXRlIGJhcnljZW50cmljIGNvb3JkaW5hdGVzCgkvLyBiYXNlZCBvbjogaHR0cDovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbAoJc3RhdGljIGdldEJhcnljb29yZCggcG9pbnQsIGEsIGIsIGMsIHRhcmdldCApIHsKCgkJX3YwJDEuc3ViVmVjdG9ycyggYywgYSApOwoJCV92MSQzLnN1YlZlY3RvcnMoIGIsIGEgKTsKCQlfdjIkMi5zdWJWZWN0b3JzKCBwb2ludCwgYSApOwoKCQljb25zdCBkb3QwMCA9IF92MCQxLmRvdCggX3YwJDEgKTsKCQljb25zdCBkb3QwMSA9IF92MCQxLmRvdCggX3YxJDMgKTsKCQljb25zdCBkb3QwMiA9IF92MCQxLmRvdCggX3YyJDIgKTsKCQljb25zdCBkb3QxMSA9IF92MSQzLmRvdCggX3YxJDMgKTsKCQljb25zdCBkb3QxMiA9IF92MSQzLmRvdCggX3YyJDIgKTsKCgkJY29uc3QgZGVub20gPSAoIGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxICk7CgoJCS8vIGNvbGxpbmVhciBvciBzaW5ndWxhciB0cmlhbmdsZQoJCWlmICggZGVub20gPT09IDAgKSB7CgoJCQl0YXJnZXQuc2V0KCAwLCAwLCAwICk7CgkJCXJldHVybiBudWxsOwoKCQl9CgoJCWNvbnN0IGludkRlbm9tID0gMSAvIGRlbm9tOwoJCWNvbnN0IHUgPSAoIGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyICkgKiBpbnZEZW5vbTsKCQljb25zdCB2ID0gKCBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMiApICogaW52RGVub207CgoJCS8vIGJhcnljZW50cmljIGNvb3JkaW5hdGVzIG11c3QgYWx3YXlzIHN1bSB0byAxCgkJcmV0dXJuIHRhcmdldC5zZXQoIDEgLSB1IC0gdiwgdiwgdSApOwoKCX0KCglzdGF0aWMgY29udGFpbnNQb2ludCggcG9pbnQsIGEsIGIsIGMgKSB7CgoJCS8vIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlIHRoZW4gd2UgY2FuJ3QgY29udGFpbiBhIHBvaW50CgkJaWYgKCB0aGlzLmdldEJhcnljb29yZCggcG9pbnQsIGEsIGIsIGMsIF92MyQxICkgPT09IG51bGwgKSB7CgoJCQlyZXR1cm4gZmFsc2U7CgoJCX0KCgkJcmV0dXJuICggX3YzJDEueCA+PSAwICkgJiYgKCBfdjMkMS55ID49IDAgKSAmJiAoICggX3YzJDEueCArIF92MyQxLnkgKSA8PSAxICk7CgoJfQoKCXN0YXRpYyBnZXRVViggcG9pbnQsIHAxLCBwMiwgcDMsIHV2MSwgdXYyLCB1djMsIHRhcmdldCApIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTEKCgkJaWYgKCB3YXJuZWRHZXRVViA9PT0gZmFsc2UgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5UcmlhbmdsZS5nZXRVVigpIGhhcyBiZWVuIHJlbmFtZWQgdG8gVEhSRUUuVHJpYW5nbGUuZ2V0SW50ZXJwb2xhdGlvbigpLicgKTsKCgkJCXdhcm5lZEdldFVWID0gdHJ1ZTsKCgkJfQoKCQlyZXR1cm4gdGhpcy5nZXRJbnRlcnBvbGF0aW9uKCBwb2ludCwgcDEsIHAyLCBwMywgdXYxLCB1djIsIHV2MywgdGFyZ2V0ICk7CgoJfQoKCXN0YXRpYyBnZXRJbnRlcnBvbGF0aW9uKCBwb2ludCwgcDEsIHAyLCBwMywgdjEsIHYyLCB2MywgdGFyZ2V0ICkgewoKCQlpZiAoIHRoaXMuZ2V0QmFyeWNvb3JkKCBwb2ludCwgcDEsIHAyLCBwMywgX3YzJDEgKSA9PT0gbnVsbCApIHsKCgkJCXRhcmdldC54ID0gMDsKCQkJdGFyZ2V0LnkgPSAwOwoJCQlpZiAoICd6JyBpbiB0YXJnZXQgKSB0YXJnZXQueiA9IDA7CgkJCWlmICggJ3cnIGluIHRhcmdldCApIHRhcmdldC53ID0gMDsKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJdGFyZ2V0LnNldFNjYWxhciggMCApOwoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIHYxLCBfdjMkMS54ICk7CgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjIsIF92MyQxLnkgKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCB2MywgX3YzJDEueiApOwoKCQlyZXR1cm4gdGFyZ2V0OwoKCX0KCglzdGF0aWMgaXNGcm9udEZhY2luZyggYSwgYiwgYywgZGlyZWN0aW9uICkgewoKCQlfdjAkMS5zdWJWZWN0b3JzKCBjLCBiICk7CgkJX3YxJDMuc3ViVmVjdG9ycyggYSwgYiApOwoKCQkvLyBzdHJpY3RseSBmcm9udCBmYWNpbmcKCQlyZXR1cm4gKCBfdjAkMS5jcm9zcyggX3YxJDMgKS5kb3QoIGRpcmVjdGlvbiApIDwgMCApID8gdHJ1ZSA6IGZhbHNlOwoKCX0KCglzZXQoIGEsIGIsIGMgKSB7CgoJCXRoaXMuYS5jb3B5KCBhICk7CgkJdGhpcy5iLmNvcHkoIGIgKTsKCQl0aGlzLmMuY29weSggYyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbVBvaW50c0FuZEluZGljZXMoIHBvaW50cywgaTAsIGkxLCBpMiApIHsKCgkJdGhpcy5hLmNvcHkoIHBvaW50c1sgaTAgXSApOwoJCXRoaXMuYi5jb3B5KCBwb2ludHNbIGkxIF0gKTsKCQl0aGlzLmMuY29weSggcG9pbnRzWyBpMiBdICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tQXR0cmlidXRlQW5kSW5kaWNlcyggYXR0cmlidXRlLCBpMCwgaTEsIGkyICkgewoKCQl0aGlzLmEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMCApOwoJCXRoaXMuYi5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGkxICk7CgkJdGhpcy5jLmZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaTIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKCWNvcHkoIHRyaWFuZ2xlICkgewoKCQl0aGlzLmEuY29weSggdHJpYW5nbGUuYSApOwoJCXRoaXMuYi5jb3B5KCB0cmlhbmdsZS5iICk7CgkJdGhpcy5jLmNvcHkoIHRyaWFuZ2xlLmMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldEFyZWEoKSB7CgoJCV92MCQxLnN1YlZlY3RvcnMoIHRoaXMuYywgdGhpcy5iICk7CgkJX3YxJDMuc3ViVmVjdG9ycyggdGhpcy5hLCB0aGlzLmIgKTsKCgkJcmV0dXJuIF92MCQxLmNyb3NzKCBfdjEkMyApLmxlbmd0aCgpICogMC41OwoKCX0KCglnZXRNaWRwb2ludCggdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMuYSwgdGhpcy5iICkuYWRkKCB0aGlzLmMgKS5tdWx0aXBseVNjYWxhciggMSAvIDMgKTsKCgl9CgoJZ2V0Tm9ybWFsKCB0YXJnZXQgKSB7CgoJCXJldHVybiBUcmlhbmdsZS5nZXROb3JtYWwoIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIHRhcmdldCApOwoKCX0KCglnZXRQbGFuZSggdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGFyZ2V0LnNldEZyb21Db3BsYW5hclBvaW50cyggdGhpcy5hLCB0aGlzLmIsIHRoaXMuYyApOwoKCX0KCglnZXRCYXJ5Y29vcmQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCXJldHVybiBUcmlhbmdsZS5nZXRCYXJ5Y29vcmQoIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB0YXJnZXQgKTsKCgl9CgoJZ2V0VVYoIHBvaW50LCB1djEsIHV2MiwgdXYzLCB0YXJnZXQgKSB7IC8vIEBkZXByZWNhdGVkLCByMTUxCgoJCWlmICggd2FybmVkR2V0VVYgPT09IGZhbHNlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVHJpYW5nbGUuZ2V0VVYoKSBoYXMgYmVlbiByZW5hbWVkIHRvIFRIUkVFLlRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oKS4nICk7CgoJCQl3YXJuZWRHZXRVViA9IHRydWU7CgoJCX0KCgkJcmV0dXJuIFRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB1djEsIHV2MiwgdXYzLCB0YXJnZXQgKTsKCgl9CgoJZ2V0SW50ZXJwb2xhdGlvbiggcG9pbnQsIHYxLCB2MiwgdjMsIHRhcmdldCApIHsKCgkJcmV0dXJuIFRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB2MSwgdjIsIHYzLCB0YXJnZXQgKTsKCgl9CgoJY29udGFpbnNQb2ludCggcG9pbnQgKSB7CgoJCXJldHVybiBUcmlhbmdsZS5jb250YWluc1BvaW50KCBwb2ludCwgdGhpcy5hLCB0aGlzLmIsIHRoaXMuYyApOwoKCX0KCglpc0Zyb250RmFjaW5nKCBkaXJlY3Rpb24gKSB7CgoJCXJldHVybiBUcmlhbmdsZS5pc0Zyb250RmFjaW5nKCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCBkaXJlY3Rpb24gKTsKCgl9CgoJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQlyZXR1cm4gYm94LmludGVyc2VjdHNUcmlhbmdsZSggdGhpcyApOwoKCX0KCgljbG9zZXN0UG9pbnRUb1BvaW50KCBwLCB0YXJnZXQgKSB7CgoJCWNvbnN0IGEgPSB0aGlzLmEsIGIgPSB0aGlzLmIsIGMgPSB0aGlzLmM7CgkJbGV0IHYsIHc7CgoJCS8vIGFsZ29yaXRobSB0aGFua3MgdG8gUmVhbC1UaW1lIENvbGxpc2lvbiBEZXRlY3Rpb24gYnkgQ2hyaXN0ZXIgRXJpY3NvbiwKCQkvLyBwdWJsaXNoZWQgYnkgTW9yZ2FuIEthdWZtYW5uIFB1Ymxpc2hlcnMsIChjKSAyMDA1IEVsc2V2aWVyIEluYy4sCgkJLy8gdW5kZXIgdGhlIGFjY29tcGFueWluZyBsaWNlbnNlOyBzZWUgY2hhcHRlciA1LjEuNSBmb3IgZGV0YWlsZWQgZXhwbGFuYXRpb24uCgkJLy8gYmFzaWNhbGx5LCB3ZSdyZSBkaXN0aW5ndWlzaGluZyB3aGljaCBvZiB0aGUgdm9yb25vaSByZWdpb25zIG9mIHRoZSB0cmlhbmdsZQoJCS8vIHRoZSBwb2ludCBsaWVzIGluIHdpdGggdGhlIG1pbmltdW0gYW1vdW50IG9mIHJlZHVuZGFudCBjb21wdXRhdGlvbi4KCgkJX3ZhYi5zdWJWZWN0b3JzKCBiLCBhICk7CgkJX3ZhYy5zdWJWZWN0b3JzKCBjLCBhICk7CgkJX3ZhcC5zdWJWZWN0b3JzKCBwLCBhICk7CgkJY29uc3QgZDEgPSBfdmFiLmRvdCggX3ZhcCApOwoJCWNvbnN0IGQyID0gX3ZhYy5kb3QoIF92YXAgKTsKCQlpZiAoIGQxIDw9IDAgJiYgZDIgPD0gMCApIHsKCgkJCS8vIHZlcnRleCByZWdpb24gb2YgQTsgYmFyeWNlbnRyaWMgY29vcmRzICgxLCAwLCAwKQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKTsKCgkJfQoKCQlfdmJwLnN1YlZlY3RvcnMoIHAsIGIgKTsKCQljb25zdCBkMyA9IF92YWIuZG90KCBfdmJwICk7CgkJY29uc3QgZDQgPSBfdmFjLmRvdCggX3ZicCApOwoJCWlmICggZDMgPj0gMCAmJiBkNCA8PSBkMyApIHsKCgkJCS8vIHZlcnRleCByZWdpb24gb2YgQjsgYmFyeWNlbnRyaWMgY29vcmRzICgwLCAxLCAwKQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGIgKTsKCgkJfQoKCQljb25zdCB2YyA9IGQxICogZDQgLSBkMyAqIGQyOwoJCWlmICggdmMgPD0gMCAmJiBkMSA+PSAwICYmIGQzIDw9IDAgKSB7CgoJCQl2ID0gZDEgLyAoIGQxIC0gZDMgKTsKCQkJLy8gZWRnZSByZWdpb24gb2YgQUI7IGJhcnljZW50cmljIGNvb3JkcyAoMS12LCB2LCAwKQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIF92YWIsIHYgKTsKCgkJfQoKCQlfdmNwLnN1YlZlY3RvcnMoIHAsIGMgKTsKCQljb25zdCBkNSA9IF92YWIuZG90KCBfdmNwICk7CgkJY29uc3QgZDYgPSBfdmFjLmRvdCggX3ZjcCApOwoJCWlmICggZDYgPj0gMCAmJiBkNSA8PSBkNiApIHsKCgkJCS8vIHZlcnRleCByZWdpb24gb2YgQzsgYmFyeWNlbnRyaWMgY29vcmRzICgwLCAwLCAxKQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGMgKTsKCgkJfQoKCQljb25zdCB2YiA9IGQ1ICogZDIgLSBkMSAqIGQ2OwoJCWlmICggdmIgPD0gMCAmJiBkMiA+PSAwICYmIGQ2IDw9IDAgKSB7CgoJCQl3ID0gZDIgLyAoIGQyIC0gZDYgKTsKCQkJLy8gZWRnZSByZWdpb24gb2YgQUM7IGJhcnljZW50cmljIGNvb3JkcyAoMS13LCAwLCB3KQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIF92YWMsIHcgKTsKCgkJfQoKCQljb25zdCB2YSA9IGQzICogZDYgLSBkNSAqIGQ0OwoJCWlmICggdmEgPD0gMCAmJiAoIGQ0IC0gZDMgKSA+PSAwICYmICggZDUgLSBkNiApID49IDAgKSB7CgoJCQlfdmJjLnN1YlZlY3RvcnMoIGMsIGIgKTsKCQkJdyA9ICggZDQgLSBkMyApIC8gKCAoIGQ0IC0gZDMgKSArICggZDUgLSBkNiApICk7CgkJCS8vIGVkZ2UgcmVnaW9uIG9mIEJDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDAsIDEtdywgdykKCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBiICkuYWRkU2NhbGVkVmVjdG9yKCBfdmJjLCB3ICk7IC8vIGVkZ2UgcmVnaW9uIG9mIEJDCgoJCX0KCgkJLy8gZmFjZSByZWdpb24KCQljb25zdCBkZW5vbSA9IDEgLyAoIHZhICsgdmIgKyB2YyApOwoJCS8vIHUgPSB2YSAqIGRlbm9tCgkJdiA9IHZiICogZGVub207CgkJdyA9IHZjICogZGVub207CgoJCXJldHVybiB0YXJnZXQuY29weSggYSApLmFkZFNjYWxlZFZlY3RvciggX3ZhYiwgdiApLmFkZFNjYWxlZFZlY3RvciggX3ZhYywgdyApOwoKCX0KCgllcXVhbHMoIHRyaWFuZ2xlICkgewoKCQlyZXR1cm4gdHJpYW5nbGUuYS5lcXVhbHMoIHRoaXMuYSApICYmIHRyaWFuZ2xlLmIuZXF1YWxzKCB0aGlzLmIgKSAmJiB0cmlhbmdsZS5jLmVxdWFscyggdGhpcy5jICk7CgoJfQoKfQoKY29uc3QgX2NvbG9yS2V5d29yZHMgPSB7ICdhbGljZWJsdWUnOiAweEYwRjhGRiwgJ2FudGlxdWV3aGl0ZSc6IDB4RkFFQkQ3LCAnYXF1YSc6IDB4MDBGRkZGLCAnYXF1YW1hcmluZSc6IDB4N0ZGRkQ0LCAnYXp1cmUnOiAweEYwRkZGRiwKCSdiZWlnZSc6IDB4RjVGNURDLCAnYmlzcXVlJzogMHhGRkU0QzQsICdibGFjayc6IDB4MDAwMDAwLCAnYmxhbmNoZWRhbG1vbmQnOiAweEZGRUJDRCwgJ2JsdWUnOiAweDAwMDBGRiwgJ2JsdWV2aW9sZXQnOiAweDhBMkJFMiwKCSdicm93bic6IDB4QTUyQTJBLCAnYnVybHl3b29kJzogMHhERUI4ODcsICdjYWRldGJsdWUnOiAweDVGOUVBMCwgJ2NoYXJ0cmV1c2UnOiAweDdGRkYwMCwgJ2Nob2NvbGF0ZSc6IDB4RDI2OTFFLCAnY29yYWwnOiAweEZGN0Y1MCwKCSdjb3JuZmxvd2VyYmx1ZSc6IDB4NjQ5NUVELCAnY29ybnNpbGsnOiAweEZGRjhEQywgJ2NyaW1zb24nOiAweERDMTQzQywgJ2N5YW4nOiAweDAwRkZGRiwgJ2RhcmtibHVlJzogMHgwMDAwOEIsICdkYXJrY3lhbic6IDB4MDA4QjhCLAoJJ2Rhcmtnb2xkZW5yb2QnOiAweEI4ODYwQiwgJ2RhcmtncmF5JzogMHhBOUE5QTksICdkYXJrZ3JlZW4nOiAweDAwNjQwMCwgJ2RhcmtncmV5JzogMHhBOUE5QTksICdkYXJra2hha2knOiAweEJEQjc2QiwgJ2RhcmttYWdlbnRhJzogMHg4QjAwOEIsCgknZGFya29saXZlZ3JlZW4nOiAweDU1NkIyRiwgJ2RhcmtvcmFuZ2UnOiAweEZGOEMwMCwgJ2RhcmtvcmNoaWQnOiAweDk5MzJDQywgJ2RhcmtyZWQnOiAweDhCMDAwMCwgJ2RhcmtzYWxtb24nOiAweEU5OTY3QSwgJ2RhcmtzZWFncmVlbic6IDB4OEZCQzhGLAoJJ2RhcmtzbGF0ZWJsdWUnOiAweDQ4M0Q4QiwgJ2RhcmtzbGF0ZWdyYXknOiAweDJGNEY0RiwgJ2RhcmtzbGF0ZWdyZXknOiAweDJGNEY0RiwgJ2Rhcmt0dXJxdW9pc2UnOiAweDAwQ0VEMSwgJ2Rhcmt2aW9sZXQnOiAweDk0MDBEMywKCSdkZWVwcGluayc6IDB4RkYxNDkzLCAnZGVlcHNreWJsdWUnOiAweDAwQkZGRiwgJ2RpbWdyYXknOiAweDY5Njk2OSwgJ2RpbWdyZXknOiAweDY5Njk2OSwgJ2RvZGdlcmJsdWUnOiAweDFFOTBGRiwgJ2ZpcmVicmljayc6IDB4QjIyMjIyLAoJJ2Zsb3JhbHdoaXRlJzogMHhGRkZBRjAsICdmb3Jlc3RncmVlbic6IDB4MjI4QjIyLCAnZnVjaHNpYSc6IDB4RkYwMEZGLCAnZ2FpbnNib3JvJzogMHhEQ0RDREMsICdnaG9zdHdoaXRlJzogMHhGOEY4RkYsICdnb2xkJzogMHhGRkQ3MDAsCgknZ29sZGVucm9kJzogMHhEQUE1MjAsICdncmF5JzogMHg4MDgwODAsICdncmVlbic6IDB4MDA4MDAwLCAnZ3JlZW55ZWxsb3cnOiAweEFERkYyRiwgJ2dyZXknOiAweDgwODA4MCwgJ2hvbmV5ZGV3JzogMHhGMEZGRjAsICdob3RwaW5rJzogMHhGRjY5QjQsCgknaW5kaWFucmVkJzogMHhDRDVDNUMsICdpbmRpZ28nOiAweDRCMDA4MiwgJ2l2b3J5JzogMHhGRkZGRjAsICdraGFraSc6IDB4RjBFNjhDLCAnbGF2ZW5kZXInOiAweEU2RTZGQSwgJ2xhdmVuZGVyYmx1c2gnOiAweEZGRjBGNSwgJ2xhd25ncmVlbic6IDB4N0NGQzAwLAoJJ2xlbW9uY2hpZmZvbic6IDB4RkZGQUNELCAnbGlnaHRibHVlJzogMHhBREQ4RTYsICdsaWdodGNvcmFsJzogMHhGMDgwODAsICdsaWdodGN5YW4nOiAweEUwRkZGRiwgJ2xpZ2h0Z29sZGVucm9keWVsbG93JzogMHhGQUZBRDIsICdsaWdodGdyYXknOiAweEQzRDNEMywKCSdsaWdodGdyZWVuJzogMHg5MEVFOTAsICdsaWdodGdyZXknOiAweEQzRDNEMywgJ2xpZ2h0cGluayc6IDB4RkZCNkMxLCAnbGlnaHRzYWxtb24nOiAweEZGQTA3QSwgJ2xpZ2h0c2VhZ3JlZW4nOiAweDIwQjJBQSwgJ2xpZ2h0c2t5Ymx1ZSc6IDB4ODdDRUZBLAoJJ2xpZ2h0c2xhdGVncmF5JzogMHg3Nzg4OTksICdsaWdodHNsYXRlZ3JleSc6IDB4Nzc4ODk5LCAnbGlnaHRzdGVlbGJsdWUnOiAweEIwQzRERSwgJ2xpZ2h0eWVsbG93JzogMHhGRkZGRTAsICdsaW1lJzogMHgwMEZGMDAsICdsaW1lZ3JlZW4nOiAweDMyQ0QzMiwKCSdsaW5lbic6IDB4RkFGMEU2LCAnbWFnZW50YSc6IDB4RkYwMEZGLCAnbWFyb29uJzogMHg4MDAwMDAsICdtZWRpdW1hcXVhbWFyaW5lJzogMHg2NkNEQUEsICdtZWRpdW1ibHVlJzogMHgwMDAwQ0QsICdtZWRpdW1vcmNoaWQnOiAweEJBNTVEMywKCSdtZWRpdW1wdXJwbGUnOiAweDkzNzBEQiwgJ21lZGl1bXNlYWdyZWVuJzogMHgzQ0IzNzEsICdtZWRpdW1zbGF0ZWJsdWUnOiAweDdCNjhFRSwgJ21lZGl1bXNwcmluZ2dyZWVuJzogMHgwMEZBOUEsICdtZWRpdW10dXJxdW9pc2UnOiAweDQ4RDFDQywKCSdtZWRpdW12aW9sZXRyZWQnOiAweEM3MTU4NSwgJ21pZG5pZ2h0Ymx1ZSc6IDB4MTkxOTcwLCAnbWludGNyZWFtJzogMHhGNUZGRkEsICdtaXN0eXJvc2UnOiAweEZGRTRFMSwgJ21vY2Nhc2luJzogMHhGRkU0QjUsICduYXZham93aGl0ZSc6IDB4RkZERUFELAoJJ25hdnknOiAweDAwMDA4MCwgJ29sZGxhY2UnOiAweEZERjVFNiwgJ29saXZlJzogMHg4MDgwMDAsICdvbGl2ZWRyYWInOiAweDZCOEUyMywgJ29yYW5nZSc6IDB4RkZBNTAwLCAnb3JhbmdlcmVkJzogMHhGRjQ1MDAsICdvcmNoaWQnOiAweERBNzBENiwKCSdwYWxlZ29sZGVucm9kJzogMHhFRUU4QUEsICdwYWxlZ3JlZW4nOiAweDk4RkI5OCwgJ3BhbGV0dXJxdW9pc2UnOiAweEFGRUVFRSwgJ3BhbGV2aW9sZXRyZWQnOiAweERCNzA5MywgJ3BhcGF5YXdoaXAnOiAweEZGRUZENSwgJ3BlYWNocHVmZic6IDB4RkZEQUI5LAoJJ3BlcnUnOiAweENEODUzRiwgJ3BpbmsnOiAweEZGQzBDQiwgJ3BsdW0nOiAweEREQTBERCwgJ3Bvd2RlcmJsdWUnOiAweEIwRTBFNiwgJ3B1cnBsZSc6IDB4ODAwMDgwLCAncmViZWNjYXB1cnBsZSc6IDB4NjYzMzk5LCAncmVkJzogMHhGRjAwMDAsICdyb3N5YnJvd24nOiAweEJDOEY4RiwKCSdyb3lhbGJsdWUnOiAweDQxNjlFMSwgJ3NhZGRsZWJyb3duJzogMHg4QjQ1MTMsICdzYWxtb24nOiAweEZBODA3MiwgJ3NhbmR5YnJvd24nOiAweEY0QTQ2MCwgJ3NlYWdyZWVuJzogMHgyRThCNTcsICdzZWFzaGVsbCc6IDB4RkZGNUVFLAoJJ3NpZW5uYSc6IDB4QTA1MjJELCAnc2lsdmVyJzogMHhDMEMwQzAsICdza3libHVlJzogMHg4N0NFRUIsICdzbGF0ZWJsdWUnOiAweDZBNUFDRCwgJ3NsYXRlZ3JheSc6IDB4NzA4MDkwLCAnc2xhdGVncmV5JzogMHg3MDgwOTAsICdzbm93JzogMHhGRkZBRkEsCgknc3ByaW5nZ3JlZW4nOiAweDAwRkY3RiwgJ3N0ZWVsYmx1ZSc6IDB4NDY4MkI0LCAndGFuJzogMHhEMkI0OEMsICd0ZWFsJzogMHgwMDgwODAsICd0aGlzdGxlJzogMHhEOEJGRDgsICd0b21hdG8nOiAweEZGNjM0NywgJ3R1cnF1b2lzZSc6IDB4NDBFMEQwLAoJJ3Zpb2xldCc6IDB4RUU4MkVFLCAnd2hlYXQnOiAweEY1REVCMywgJ3doaXRlJzogMHhGRkZGRkYsICd3aGl0ZXNtb2tlJzogMHhGNUY1RjUsICd5ZWxsb3cnOiAweEZGRkYwMCwgJ3llbGxvd2dyZWVuJzogMHg5QUNEMzIgfTsKCmNvbnN0IF9oc2xBID0geyBoOiAwLCBzOiAwLCBsOiAwIH07CmNvbnN0IF9oc2xCID0geyBoOiAwLCBzOiAwLCBsOiAwIH07CgpmdW5jdGlvbiBodWUycmdiKCBwLCBxLCB0ICkgewoKCWlmICggdCA8IDAgKSB0ICs9IDE7CglpZiAoIHQgPiAxICkgdCAtPSAxOwoJaWYgKCB0IDwgMSAvIDYgKSByZXR1cm4gcCArICggcSAtIHAgKSAqIDYgKiB0OwoJaWYgKCB0IDwgMSAvIDIgKSByZXR1cm4gcTsKCWlmICggdCA8IDIgLyAzICkgcmV0dXJuIHAgKyAoIHEgLSBwICkgKiA2ICogKCAyIC8gMyAtIHQgKTsKCXJldHVybiBwOwoKfQoKY2xhc3MgQ29sb3IgewoKCWNvbnN0cnVjdG9yKCByLCBnLCBiICkgewoKCQl0aGlzLmlzQ29sb3IgPSB0cnVlOwoKCQl0aGlzLnIgPSAxOwoJCXRoaXMuZyA9IDE7CgkJdGhpcy5iID0gMTsKCgkJcmV0dXJuIHRoaXMuc2V0KCByLCBnLCBiICk7CgoJfQoKCXNldCggciwgZywgYiApIHsKCgkJaWYgKCBnID09PSB1bmRlZmluZWQgJiYgYiA9PT0gdW5kZWZpbmVkICkgewoKCQkJLy8gciBpcyBUSFJFRS5Db2xvciwgaGV4IG9yIHN0cmluZwoKCQkJY29uc3QgdmFsdWUgPSByOwoKCQkJaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc0NvbG9yICkgewoKCQkJCXRoaXMuY29weSggdmFsdWUgKTsKCgkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgKSB7CgoJCQkJdGhpcy5zZXRIZXgoIHZhbHVlICk7CgoJCQl9IGVsc2UgaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICkgewoKCQkJCXRoaXMuc2V0U3R5bGUoIHZhbHVlICk7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQl0aGlzLnNldFJHQiggciwgZywgYiApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRTY2FsYXIoIHNjYWxhciApIHsKCgkJdGhpcy5yID0gc2NhbGFyOwoJCXRoaXMuZyA9IHNjYWxhcjsKCQl0aGlzLmIgPSBzY2FsYXI7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRIZXgoIGhleCwgY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQloZXggPSBNYXRoLmZsb29yKCBoZXggKTsKCgkJdGhpcy5yID0gKCBoZXggPj4gMTYgJiAyNTUgKSAvIDI1NTsKCQl0aGlzLmcgPSAoIGhleCA+PiA4ICYgMjU1ICkgLyAyNTU7CgkJdGhpcy5iID0gKCBoZXggJiAyNTUgKSAvIDI1NTsKCgkJQ29sb3JNYW5hZ2VtZW50LnRvV29ya2luZ0NvbG9yU3BhY2UoIHRoaXMsIGNvbG9yU3BhY2UgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFJHQiggciwgZywgYiwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCgkJdGhpcy5yID0gcjsKCQl0aGlzLmcgPSBnOwoJCXRoaXMuYiA9IGI7CgoJCUNvbG9yTWFuYWdlbWVudC50b1dvcmtpbmdDb2xvclNwYWNlKCB0aGlzLCBjb2xvclNwYWNlICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRIU0woIGgsIHMsIGwsIGNvbG9yU3BhY2UgPSBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgKSB7CgoJCS8vIGgscyxsIHJhbmdlcyBhcmUgaW4gMC4wIC0gMS4wCgkJaCA9IGV1Y2xpZGVhbk1vZHVsbyggaCwgMSApOwoJCXMgPSBjbGFtcCggcywgMCwgMSApOwoJCWwgPSBjbGFtcCggbCwgMCwgMSApOwoKCQlpZiAoIHMgPT09IDAgKSB7CgoJCQl0aGlzLnIgPSB0aGlzLmcgPSB0aGlzLmIgPSBsOwoKCQl9IGVsc2UgewoKCQkJY29uc3QgcCA9IGwgPD0gMC41ID8gbCAqICggMSArIHMgKSA6IGwgKyBzIC0gKCBsICogcyApOwoJCQljb25zdCBxID0gKCAyICogbCApIC0gcDsKCgkJCXRoaXMuciA9IGh1ZTJyZ2IoIHEsIHAsIGggKyAxIC8gMyApOwoJCQl0aGlzLmcgPSBodWUycmdiKCBxLCBwLCBoICk7CgkJCXRoaXMuYiA9IGh1ZTJyZ2IoIHEsIHAsIGggLSAxIC8gMyApOwoKCQl9CgoJCUNvbG9yTWFuYWdlbWVudC50b1dvcmtpbmdDb2xvclNwYWNlKCB0aGlzLCBjb2xvclNwYWNlICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRTdHlsZSggc3R5bGUsIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJZnVuY3Rpb24gaGFuZGxlQWxwaGEoIHN0cmluZyApIHsKCgkJCWlmICggc3RyaW5nID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQlpZiAoIHBhcnNlRmxvYXQoIHN0cmluZyApIDwgMSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogQWxwaGEgY29tcG9uZW50IG9mICcgKyBzdHlsZSArICcgd2lsbCBiZSBpZ25vcmVkLicgKTsKCgkJCX0KCgkJfQoKCgkJbGV0IG07CgoJCWlmICggbSA9IC9eKFx3KylcKChbXlwpXSopXCkvLmV4ZWMoIHN0eWxlICkgKSB7CgoJCQkvLyByZ2IgLyBoc2wKCgkJCWxldCBjb2xvcjsKCQkJY29uc3QgbmFtZSA9IG1bIDEgXTsKCQkJY29uc3QgY29tcG9uZW50cyA9IG1bIDIgXTsKCgkJCXN3aXRjaCAoIG5hbWUgKSB7CgoJCQkJY2FzZSAncmdiJzoKCQkJCWNhc2UgJ3JnYmEnOgoKCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQrKVxzKixccyooXGQrKVxzKixccyooXGQrKVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKCQkJCQkJLy8gcmdiKDI1NSwwLDApIHJnYmEoMjU1LDAsMCwwLjUpCgoJCQkJCQloYW5kbGVBbHBoYSggY29sb3JbIDQgXSApOwoKCQkJCQkJcmV0dXJuIHRoaXMuc2V0UkdCKAoJCQkJCQkJTWF0aC5taW4oIDI1NSwgcGFyc2VJbnQoIGNvbG9yWyAxIF0sIDEwICkgKSAvIDI1NSwKCQkJCQkJCU1hdGgubWluKCAyNTUsIHBhcnNlSW50KCBjb2xvclsgMiBdLCAxMCApICkgLyAyNTUsCgkJCQkJCQlNYXRoLm1pbiggMjU1LCBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSApIC8gMjU1LAoJCQkJCQkJY29sb3JTcGFjZQoJCQkJCQkpOwoKCQkJCQl9CgoJCQkJCWlmICggY29sb3IgPSAvXlxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKixccyooXGQrKVwlXHMqKD86LFxzKihcZCpcLj9cZCspXHMqKT8kLy5leGVjKCBjb21wb25lbnRzICkgKSB7CgoJCQkJCQkvLyByZ2IoMTAwJSwwJSwwJSkgcmdiYSgxMDAlLDAlLDAlLDAuNSkKCgkJCQkJCWhhbmRsZUFscGhhKCBjb2xvclsgNCBdICk7CgoJCQkJCQlyZXR1cm4gdGhpcy5zZXRSR0IoCgkJCQkJCQlNYXRoLm1pbiggMTAwLCBwYXJzZUludCggY29sb3JbIDEgXSwgMTAgKSApIC8gMTAwLAoJCQkJCQkJTWF0aC5taW4oIDEwMCwgcGFyc2VJbnQoIGNvbG9yWyAyIF0sIDEwICkgKSAvIDEwMCwKCQkJCQkJCU1hdGgubWluKCAxMDAsIHBhcnNlSW50KCBjb2xvclsgMyBdLCAxMCApICkgLyAxMDAsCgkJCQkJCQljb2xvclNwYWNlCgkJCQkJCSk7CgoJCQkJCX0KCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnaHNsJzoKCQkJCWNhc2UgJ2hzbGEnOgoKCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQqXC4/XGQrKVxzKixccyooXGQqXC4/XGQrKVwlXHMqLFxzKihcZCpcLj9cZCspXCVccyooPzosXHMqKFxkKlwuP1xkKylccyopPyQvLmV4ZWMoIGNvbXBvbmVudHMgKSApIHsKCgkJCQkJCS8vIGhzbCgxMjAsNTAlLDUwJSkgaHNsYSgxMjAsNTAlLDUwJSwwLjUpCgoJCQkJCQloYW5kbGVBbHBoYSggY29sb3JbIDQgXSApOwoKCQkJCQkJcmV0dXJuIHRoaXMuc2V0SFNMKAoJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDEgXSApIC8gMzYwLAoJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDIgXSApIC8gMTAwLAoJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDMgXSApIC8gMTAwLAoJCQkJCQkJY29sb3JTcGFjZQoJCQkJCQkpOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkNvbG9yOiBVbmtub3duIGNvbG9yIG1vZGVsICcgKyBzdHlsZSApOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCBtID0gL15cIyhbQS1GYS1mXGRdKykkLy5leGVjKCBzdHlsZSApICkgewoKCQkJLy8gaGV4IGNvbG9yCgoJCQljb25zdCBoZXggPSBtWyAxIF07CgkJCWNvbnN0IHNpemUgPSBoZXgubGVuZ3RoOwoKCQkJaWYgKCBzaXplID09PSAzICkgewoKCQkJCS8vICNmZjAKCQkJCXJldHVybiB0aGlzLnNldFJHQigKCQkJCQlwYXJzZUludCggaGV4LmNoYXJBdCggMCApLCAxNiApIC8gMTUsCgkJCQkJcGFyc2VJbnQoIGhleC5jaGFyQXQoIDEgKSwgMTYgKSAvIDE1LAoJCQkJCXBhcnNlSW50KCBoZXguY2hhckF0KCAyICksIDE2ICkgLyAxNSwKCQkJCQljb2xvclNwYWNlCgkJCQkpOwoKCQkJfSBlbHNlIGlmICggc2l6ZSA9PT0gNiApIHsKCgkJCQkvLyAjZmYwMDAwCgkJCQlyZXR1cm4gdGhpcy5zZXRIZXgoIHBhcnNlSW50KCBoZXgsIDE2ICksIGNvbG9yU3BhY2UgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IEludmFsaWQgaGV4IGNvbG9yICcgKyBzdHlsZSApOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCBzdHlsZSAmJiBzdHlsZS5sZW5ndGggPiAwICkgewoKCQkJcmV0dXJuIHRoaXMuc2V0Q29sb3JOYW1lKCBzdHlsZSwgY29sb3JTcGFjZSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRDb2xvck5hbWUoIHN0eWxlLCBjb2xvclNwYWNlID0gU1JHQkNvbG9yU3BhY2UgKSB7CgoJCS8vIGNvbG9yIGtleXdvcmRzCgkJY29uc3QgaGV4ID0gX2NvbG9yS2V5d29yZHNbIHN0eWxlLnRvTG93ZXJDYXNlKCkgXTsKCgkJaWYgKCBoZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCS8vIHJlZAoJCQl0aGlzLnNldEhleCggaGV4LCBjb2xvclNwYWNlICk7CgoJCX0gZWxzZSB7CgoJCQkvLyB1bmtub3duIGNvbG9yCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkNvbG9yOiBVbmtub3duIGNvbG9yICcgKyBzdHlsZSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLnIsIHRoaXMuZywgdGhpcy5iICk7CgoJfQoKCWNvcHkoIGNvbG9yICkgewoKCQl0aGlzLnIgPSBjb2xvci5yOwoJCXRoaXMuZyA9IGNvbG9yLmc7CgkJdGhpcy5iID0gY29sb3IuYjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHlTUkdCVG9MaW5lYXIoIGNvbG9yICkgewoKCQl0aGlzLnIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLnIgKTsKCQl0aGlzLmcgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLmcgKTsKCQl0aGlzLmIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLmIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHlMaW5lYXJUb1NSR0IoIGNvbG9yICkgewoKCQl0aGlzLnIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLnIgKTsKCQl0aGlzLmcgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmcgKTsKCQl0aGlzLmIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvbnZlcnRTUkdCVG9MaW5lYXIoKSB7CgoJCXRoaXMuY29weVNSR0JUb0xpbmVhciggdGhpcyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29udmVydExpbmVhclRvU1JHQigpIHsKCgkJdGhpcy5jb3B5TGluZWFyVG9TUkdCKCB0aGlzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRIZXgoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJQ29sb3JNYW5hZ2VtZW50LmZyb21Xb3JraW5nQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKCQlyZXR1cm4gTWF0aC5yb3VuZCggY2xhbXAoIF9jb2xvci5yICogMjU1LCAwLCAyNTUgKSApICogNjU1MzYgKyBNYXRoLnJvdW5kKCBjbGFtcCggX2NvbG9yLmcgKiAyNTUsIDAsIDI1NSApICkgKiAyNTYgKyBNYXRoLnJvdW5kKCBjbGFtcCggX2NvbG9yLmIgKiAyNTUsIDAsIDI1NSApICk7CgoJfQoKCWdldEhleFN0cmluZyggY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQlyZXR1cm4gKCAnMDAwMDAwJyArIHRoaXMuZ2V0SGV4KCBjb2xvclNwYWNlICkudG9TdHJpbmcoIDE2ICkgKS5zbGljZSggLSA2ICk7CgoJfQoKCWdldEhTTCggdGFyZ2V0LCBjb2xvclNwYWNlID0gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICkgewoKCQkvLyBoLHMsbCByYW5nZXMgYXJlIGluIDAuMCAtIDEuMAoKCQlDb2xvck1hbmFnZW1lbnQuZnJvbVdvcmtpbmdDb2xvclNwYWNlKCBfY29sb3IuY29weSggdGhpcyApLCBjb2xvclNwYWNlICk7CgoJCWNvbnN0IHIgPSBfY29sb3IuciwgZyA9IF9jb2xvci5nLCBiID0gX2NvbG9yLmI7CgoJCWNvbnN0IG1heCA9IE1hdGgubWF4KCByLCBnLCBiICk7CgkJY29uc3QgbWluID0gTWF0aC5taW4oIHIsIGcsIGIgKTsKCgkJbGV0IGh1ZSwgc2F0dXJhdGlvbjsKCQljb25zdCBsaWdodG5lc3MgPSAoIG1pbiArIG1heCApIC8gMi4wOwoKCQlpZiAoIG1pbiA9PT0gbWF4ICkgewoKCQkJaHVlID0gMDsKCQkJc2F0dXJhdGlvbiA9IDA7CgoJCX0gZWxzZSB7CgoJCQljb25zdCBkZWx0YSA9IG1heCAtIG1pbjsKCgkJCXNhdHVyYXRpb24gPSBsaWdodG5lc3MgPD0gMC41ID8gZGVsdGEgLyAoIG1heCArIG1pbiApIDogZGVsdGEgLyAoIDIgLSBtYXggLSBtaW4gKTsKCgkJCXN3aXRjaCAoIG1heCApIHsKCgkJCQljYXNlIHI6IGh1ZSA9ICggZyAtIGIgKSAvIGRlbHRhICsgKCBnIDwgYiA/IDYgOiAwICk7IGJyZWFrOwoJCQkJY2FzZSBnOiBodWUgPSAoIGIgLSByICkgLyBkZWx0YSArIDI7IGJyZWFrOwoJCQkJY2FzZSBiOiBodWUgPSAoIHIgLSBnICkgLyBkZWx0YSArIDQ7IGJyZWFrOwoKCQkJfQoKCQkJaHVlIC89IDY7CgoJCX0KCgkJdGFyZ2V0LmggPSBodWU7CgkJdGFyZ2V0LnMgPSBzYXR1cmF0aW9uOwoJCXRhcmdldC5sID0gbGlnaHRuZXNzOwoKCQlyZXR1cm4gdGFyZ2V0OwoKCX0KCglnZXRSR0IoIHRhcmdldCwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCgkJQ29sb3JNYW5hZ2VtZW50LmZyb21Xb3JraW5nQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKCQl0YXJnZXQuciA9IF9jb2xvci5yOwoJCXRhcmdldC5nID0gX2NvbG9yLmc7CgkJdGFyZ2V0LmIgPSBfY29sb3IuYjsKCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJZ2V0U3R5bGUoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJQ29sb3JNYW5hZ2VtZW50LmZyb21Xb3JraW5nQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKCQljb25zdCByID0gX2NvbG9yLnIsIGcgPSBfY29sb3IuZywgYiA9IF9jb2xvci5iOwoKCQlpZiAoIGNvbG9yU3BhY2UgIT09IFNSR0JDb2xvclNwYWNlICkgewoKCQkJLy8gUmVxdWlyZXMgQ1NTIENvbG9yIE1vZHVsZSBMZXZlbCA0IChodHRwczovL3d3dy53My5vcmcvVFIvY3NzLWNvbG9yLTQvKS4KCQkJcmV0dXJuIGBjb2xvcigkeyBjb2xvclNwYWNlIH0gJHsgci50b0ZpeGVkKCAzICkgfSAkeyBnLnRvRml4ZWQoIDMgKSB9ICR7IGIudG9GaXhlZCggMyApIH0pYDsKCgkJfQoKCQlyZXR1cm4gYHJnYigkeyBNYXRoLnJvdW5kKCByICogMjU1ICkgfSwkeyBNYXRoLnJvdW5kKCBnICogMjU1ICkgfSwkeyBNYXRoLnJvdW5kKCBiICogMjU1ICkgfSlgOwoKCX0KCglvZmZzZXRIU0woIGgsIHMsIGwgKSB7CgoJCXRoaXMuZ2V0SFNMKCBfaHNsQSApOwoKCQlyZXR1cm4gdGhpcy5zZXRIU0woIF9oc2xBLmggKyBoLCBfaHNsQS5zICsgcywgX2hzbEEubCArIGwgKTsKCgl9CgoJYWRkKCBjb2xvciApIHsKCgkJdGhpcy5yICs9IGNvbG9yLnI7CgkJdGhpcy5nICs9IGNvbG9yLmc7CgkJdGhpcy5iICs9IGNvbG9yLmI7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRDb2xvcnMoIGNvbG9yMSwgY29sb3IyICkgewoKCQl0aGlzLnIgPSBjb2xvcjEuciArIGNvbG9yMi5yOwoJCXRoaXMuZyA9IGNvbG9yMS5nICsgY29sb3IyLmc7CgkJdGhpcy5iID0gY29sb3IxLmIgKyBjb2xvcjIuYjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZFNjYWxhciggcyApIHsKCgkJdGhpcy5yICs9IHM7CgkJdGhpcy5nICs9IHM7CgkJdGhpcy5iICs9IHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdWIoIGNvbG9yICkgewoKCQl0aGlzLnIgPSBNYXRoLm1heCggMCwgdGhpcy5yIC0gY29sb3IuciApOwoJCXRoaXMuZyA9IE1hdGgubWF4KCAwLCB0aGlzLmcgLSBjb2xvci5nICk7CgkJdGhpcy5iID0gTWF0aC5tYXgoIDAsIHRoaXMuYiAtIGNvbG9yLmIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5KCBjb2xvciApIHsKCgkJdGhpcy5yICo9IGNvbG9yLnI7CgkJdGhpcy5nICo9IGNvbG9yLmc7CgkJdGhpcy5iICo9IGNvbG9yLmI7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltdWx0aXBseVNjYWxhciggcyApIHsKCgkJdGhpcy5yICo9IHM7CgkJdGhpcy5nICo9IHM7CgkJdGhpcy5iICo9IHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglsZXJwKCBjb2xvciwgYWxwaGEgKSB7CgoJCXRoaXMuciArPSAoIGNvbG9yLnIgLSB0aGlzLnIgKSAqIGFscGhhOwoJCXRoaXMuZyArPSAoIGNvbG9yLmcgLSB0aGlzLmcgKSAqIGFscGhhOwoJCXRoaXMuYiArPSAoIGNvbG9yLmIgLSB0aGlzLmIgKSAqIGFscGhhOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbGVycENvbG9ycyggY29sb3IxLCBjb2xvcjIsIGFscGhhICkgewoKCQl0aGlzLnIgPSBjb2xvcjEuciArICggY29sb3IyLnIgLSBjb2xvcjEuciApICogYWxwaGE7CgkJdGhpcy5nID0gY29sb3IxLmcgKyAoIGNvbG9yMi5nIC0gY29sb3IxLmcgKSAqIGFscGhhOwoJCXRoaXMuYiA9IGNvbG9yMS5iICsgKCBjb2xvcjIuYiAtIGNvbG9yMS5iICkgKiBhbHBoYTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWxlcnBIU0woIGNvbG9yLCBhbHBoYSApIHsKCgkJdGhpcy5nZXRIU0woIF9oc2xBICk7CgkJY29sb3IuZ2V0SFNMKCBfaHNsQiApOwoKCQljb25zdCBoID0gbGVycCggX2hzbEEuaCwgX2hzbEIuaCwgYWxwaGEgKTsKCQljb25zdCBzID0gbGVycCggX2hzbEEucywgX2hzbEIucywgYWxwaGEgKTsKCQljb25zdCBsID0gbGVycCggX2hzbEEubCwgX2hzbEIubCwgYWxwaGEgKTsKCgkJdGhpcy5zZXRIU0woIGgsIHMsIGwgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21WZWN0b3IzKCB2ICkgewoKCQl0aGlzLnIgPSB2Lng7CgkJdGhpcy5nID0gdi55OwoJCXRoaXMuYiA9IHYuejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5TWF0cml4MyggbSApIHsKCgkJY29uc3QgciA9IHRoaXMuciwgZyA9IHRoaXMuZywgYiA9IHRoaXMuYjsKCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJdGhpcy5yID0gZVsgMCBdICogciArIGVbIDMgXSAqIGcgKyBlWyA2IF0gKiBiOwoJCXRoaXMuZyA9IGVbIDEgXSAqIHIgKyBlWyA0IF0gKiBnICsgZVsgNyBdICogYjsKCQl0aGlzLmIgPSBlWyAyIF0gKiByICsgZVsgNSBdICogZyArIGVbIDggXSAqIGI7CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIGMgKSB7CgoJCXJldHVybiAoIGMuciA9PT0gdGhpcy5yICkgJiYgKCBjLmcgPT09IHRoaXMuZyApICYmICggYy5iID09PSB0aGlzLmIgKTsKCgl9CgoJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJdGhpcy5yID0gYXJyYXlbIG9mZnNldCBdOwoJCXRoaXMuZyA9IGFycmF5WyBvZmZzZXQgKyAxIF07CgkJdGhpcy5iID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMucjsKCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGhpcy5nOwoJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLmI7CgoJCXJldHVybiBhcnJheTsKCgl9CgoJZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCApIHsKCgkJdGhpcy5yID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJdGhpcy5nID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CgkJdGhpcy5iID0gYXR0cmlidXRlLmdldFooIGluZGV4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCXJldHVybiB0aGlzLmdldEhleCgpOwoKCX0KCgkqWyBTeW1ib2wuaXRlcmF0b3IgXSgpIHsKCgkJeWllbGQgdGhpcy5yOwoJCXlpZWxkIHRoaXMuZzsKCQl5aWVsZCB0aGlzLmI7CgoJfQoKfQoKY29uc3QgX2NvbG9yID0gLypAX19QVVJFX18qLyBuZXcgQ29sb3IoKTsKCkNvbG9yLk5BTUVTID0gX2NvbG9yS2V5d29yZHM7CgpsZXQgX21hdGVyaWFsSWQgPSAwOwoKY2xhc3MgTWF0ZXJpYWwgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKCWNvbnN0cnVjdG9yKCkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWF0ZXJpYWwgPSB0cnVlOwoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9tYXRlcmlhbElkICsrIH0gKTsKCgkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJCXRoaXMubmFtZSA9ICcnOwoJCXRoaXMudHlwZSA9ICdNYXRlcmlhbCc7CgoJCXRoaXMuYmxlbmRpbmcgPSBOb3JtYWxCbGVuZGluZzsKCQl0aGlzLnNpZGUgPSBGcm9udFNpZGU7CgkJdGhpcy52ZXJ0ZXhDb2xvcnMgPSBmYWxzZTsKCgkJdGhpcy5vcGFjaXR5ID0gMTsKCQl0aGlzLnRyYW5zcGFyZW50ID0gZmFsc2U7CgkJdGhpcy5hbHBoYUhhc2ggPSBmYWxzZTsKCgkJdGhpcy5ibGVuZFNyYyA9IFNyY0FscGhhRmFjdG9yOwoJCXRoaXMuYmxlbmREc3QgPSBPbmVNaW51c1NyY0FscGhhRmFjdG9yOwoJCXRoaXMuYmxlbmRFcXVhdGlvbiA9IEFkZEVxdWF0aW9uOwoJCXRoaXMuYmxlbmRTcmNBbHBoYSA9IG51bGw7CgkJdGhpcy5ibGVuZERzdEFscGhhID0gbnVsbDsKCQl0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSA9IG51bGw7CgkJdGhpcy5ibGVuZENvbG9yID0gbmV3IENvbG9yKCAwLCAwLCAwICk7CgkJdGhpcy5ibGVuZEFscGhhID0gMDsKCgkJdGhpcy5kZXB0aEZ1bmMgPSBMZXNzRXF1YWxEZXB0aDsKCQl0aGlzLmRlcHRoVGVzdCA9IHRydWU7CgkJdGhpcy5kZXB0aFdyaXRlID0gdHJ1ZTsKCgkJdGhpcy5zdGVuY2lsV3JpdGVNYXNrID0gMHhmZjsKCQl0aGlzLnN0ZW5jaWxGdW5jID0gQWx3YXlzU3RlbmNpbEZ1bmM7CgkJdGhpcy5zdGVuY2lsUmVmID0gMDsKCQl0aGlzLnN0ZW5jaWxGdW5jTWFzayA9IDB4ZmY7CgkJdGhpcy5zdGVuY2lsRmFpbCA9IEtlZXBTdGVuY2lsT3A7CgkJdGhpcy5zdGVuY2lsWkZhaWwgPSBLZWVwU3RlbmNpbE9wOwoJCXRoaXMuc3RlbmNpbFpQYXNzID0gS2VlcFN0ZW5jaWxPcDsKCQl0aGlzLnN0ZW5jaWxXcml0ZSA9IGZhbHNlOwoKCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gbnVsbDsKCQl0aGlzLmNsaXBJbnRlcnNlY3Rpb24gPSBmYWxzZTsKCQl0aGlzLmNsaXBTaGFkb3dzID0gZmFsc2U7CgoJCXRoaXMuc2hhZG93U2lkZSA9IG51bGw7CgoJCXRoaXMuY29sb3JXcml0ZSA9IHRydWU7CgoJCXRoaXMucHJlY2lzaW9uID0gbnVsbDsgLy8gb3ZlcnJpZGUgdGhlIHJlbmRlcmVyJ3MgZGVmYXVsdCBwcmVjaXNpb24gZm9yIHRoaXMgbWF0ZXJpYWwKCgkJdGhpcy5wb2x5Z29uT2Zmc2V0ID0gZmFsc2U7CgkJdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gMDsKCQl0aGlzLnBvbHlnb25PZmZzZXRVbml0cyA9IDA7CgoJCXRoaXMuZGl0aGVyaW5nID0gZmFsc2U7CgoJCXRoaXMuYWxwaGFUb0NvdmVyYWdlID0gZmFsc2U7CgkJdGhpcy5wcmVtdWx0aXBsaWVkQWxwaGEgPSBmYWxzZTsKCQl0aGlzLmZvcmNlU2luZ2xlUGFzcyA9IGZhbHNlOwoKCQl0aGlzLnZpc2libGUgPSB0cnVlOwoKCQl0aGlzLnRvbmVNYXBwZWQgPSB0cnVlOwoKCQl0aGlzLnVzZXJEYXRhID0ge307CgoJCXRoaXMudmVyc2lvbiA9IDA7CgoJCXRoaXMuX2FscGhhVGVzdCA9IDA7CgoJfQoKCWdldCBhbHBoYVRlc3QoKSB7CgoJCXJldHVybiB0aGlzLl9hbHBoYVRlc3Q7CgoJfQoKCXNldCBhbHBoYVRlc3QoIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuX2FscGhhVGVzdCA+IDAgIT09IHZhbHVlID4gMCApIHsKCgkJCXRoaXMudmVyc2lvbiArKzsKCgkJfQoKCQl0aGlzLl9hbHBoYVRlc3QgPSB2YWx1ZTsKCgl9CgoJb25CdWlsZCggLyogc2hhZGVyb2JqZWN0LCByZW5kZXJlciAqLyApIHt9CgoJb25CZWZvcmVSZW5kZXIoIC8qIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgb2JqZWN0LCBncm91cCAqLyApIHt9CgoJb25CZWZvcmVDb21waWxlKCAvKiBzaGFkZXJvYmplY3QsIHJlbmRlcmVyICovICkge30KCgljdXN0b21Qcm9ncmFtQ2FjaGVLZXkoKSB7CgoJCXJldHVybiB0aGlzLm9uQmVmb3JlQ29tcGlsZS50b1N0cmluZygpOwoKCX0KCglzZXRWYWx1ZXMoIHZhbHVlcyApIHsKCgkJaWYgKCB2YWx1ZXMgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJZm9yICggY29uc3Qga2V5IGluIHZhbHVlcyApIHsKCgkJCWNvbnN0IG5ld1ZhbHVlID0gdmFsdWVzWyBrZXkgXTsKCgkJCWlmICggbmV3VmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oIGBUSFJFRS5NYXRlcmlhbDogcGFyYW1ldGVyICckeyBrZXkgfScgaGFzIHZhbHVlIG9mIHVuZGVmaW5lZC5gICk7CgkJCQljb250aW51ZTsKCgkJCX0KCgkJCWNvbnN0IGN1cnJlbnRWYWx1ZSA9IHRoaXNbIGtleSBdOwoKCQkJaWYgKCBjdXJyZW50VmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oIGBUSFJFRS5NYXRlcmlhbDogJyR7IGtleSB9JyBpcyBub3QgYSBwcm9wZXJ0eSBvZiBUSFJFRS4keyB0aGlzLnR5cGUgfS5gICk7CgkJCQljb250aW51ZTsKCgkJCX0KCgkJCWlmICggY3VycmVudFZhbHVlICYmIGN1cnJlbnRWYWx1ZS5pc0NvbG9yICkgewoKCQkJCWN1cnJlbnRWYWx1ZS5zZXQoIG5ld1ZhbHVlICk7CgoJCQl9IGVsc2UgaWYgKCAoIGN1cnJlbnRWYWx1ZSAmJiBjdXJyZW50VmFsdWUuaXNWZWN0b3IzICkgJiYgKCBuZXdWYWx1ZSAmJiBuZXdWYWx1ZS5pc1ZlY3RvcjMgKSApIHsKCgkJCQljdXJyZW50VmFsdWUuY29weSggbmV3VmFsdWUgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhpc1sga2V5IF0gPSBuZXdWYWx1ZTsKCgkJCX0KCgkJfQoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCWNvbnN0IGlzUm9vdE9iamVjdCA9ICggbWV0YSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBtZXRhID09PSAnc3RyaW5nJyApOwoKCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCgkJCW1ldGEgPSB7CgkJCQl0ZXh0dXJlczoge30sCgkJCQlpbWFnZXM6IHt9CgkJCX07CgoJCX0KCgkJY29uc3QgZGF0YSA9IHsKCQkJbWV0YWRhdGE6IHsKCQkJCXZlcnNpb246IDQuNiwKCQkJCXR5cGU6ICdNYXRlcmlhbCcsCgkJCQlnZW5lcmF0b3I6ICdNYXRlcmlhbC50b0pTT04nCgkJCX0KCQl9OwoKCQkvLyBzdGFuZGFyZCBNYXRlcmlhbCBzZXJpYWxpemF0aW9uCgkJZGF0YS51dWlkID0gdGhpcy51dWlkOwoJCWRhdGEudHlwZSA9IHRoaXMudHlwZTsKCgkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwoKCQlpZiAoIHRoaXMuY29sb3IgJiYgdGhpcy5jb2xvci5pc0NvbG9yICkgZGF0YS5jb2xvciA9IHRoaXMuY29sb3IuZ2V0SGV4KCk7CgoJCWlmICggdGhpcy5yb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEucm91Z2huZXNzID0gdGhpcy5yb3VnaG5lc3M7CgkJaWYgKCB0aGlzLm1ldGFsbmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5tZXRhbG5lc3MgPSB0aGlzLm1ldGFsbmVzczsKCgkJaWYgKCB0aGlzLnNoZWVuICE9PSB1bmRlZmluZWQgKSBkYXRhLnNoZWVuID0gdGhpcy5zaGVlbjsKCQlpZiAoIHRoaXMuc2hlZW5Db2xvciAmJiB0aGlzLnNoZWVuQ29sb3IuaXNDb2xvciApIGRhdGEuc2hlZW5Db2xvciA9IHRoaXMuc2hlZW5Db2xvci5nZXRIZXgoKTsKCQlpZiAoIHRoaXMuc2hlZW5Sb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuc2hlZW5Sb3VnaG5lc3MgPSB0aGlzLnNoZWVuUm91Z2huZXNzOwoJCWlmICggdGhpcy5lbWlzc2l2ZSAmJiB0aGlzLmVtaXNzaXZlLmlzQ29sb3IgKSBkYXRhLmVtaXNzaXZlID0gdGhpcy5lbWlzc2l2ZS5nZXRIZXgoKTsKCQlpZiAoIHRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgJiYgdGhpcy5lbWlzc2l2ZUludGVuc2l0eSAhPT0gMSApIGRhdGEuZW1pc3NpdmVJbnRlbnNpdHkgPSB0aGlzLmVtaXNzaXZlSW50ZW5zaXR5OwoKCQlpZiAoIHRoaXMuc3BlY3VsYXIgJiYgdGhpcy5zcGVjdWxhci5pc0NvbG9yICkgZGF0YS5zcGVjdWxhciA9IHRoaXMuc3BlY3VsYXIuZ2V0SGV4KCk7CgkJaWYgKCB0aGlzLnNwZWN1bGFySW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgKSBkYXRhLnNwZWN1bGFySW50ZW5zaXR5ID0gdGhpcy5zcGVjdWxhckludGVuc2l0eTsKCQlpZiAoIHRoaXMuc3BlY3VsYXJDb2xvciAmJiB0aGlzLnNwZWN1bGFyQ29sb3IuaXNDb2xvciApIGRhdGEuc3BlY3VsYXJDb2xvciA9IHRoaXMuc3BlY3VsYXJDb2xvci5nZXRIZXgoKTsKCQlpZiAoIHRoaXMuc2hpbmluZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLnNoaW5pbmVzcyA9IHRoaXMuc2hpbmluZXNzOwoJCWlmICggdGhpcy5jbGVhcmNvYXQgIT09IHVuZGVmaW5lZCApIGRhdGEuY2xlYXJjb2F0ID0gdGhpcy5jbGVhcmNvYXQ7CgkJaWYgKCB0aGlzLmNsZWFyY29hdFJvdWdobmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5jbGVhcmNvYXRSb3VnaG5lc3MgPSB0aGlzLmNsZWFyY29hdFJvdWdobmVzczsKCgkJaWYgKCB0aGlzLmNsZWFyY29hdE1hcCAmJiB0aGlzLmNsZWFyY29hdE1hcC5pc1RleHR1cmUgKSB7CgoJCQlkYXRhLmNsZWFyY29hdE1hcCA9IHRoaXMuY2xlYXJjb2F0TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCX0KCgkJaWYgKCB0aGlzLmNsZWFyY29hdFJvdWdobmVzc01hcCAmJiB0aGlzLmNsZWFyY29hdFJvdWdobmVzc01hcC5pc1RleHR1cmUgKSB7CgoJCQlkYXRhLmNsZWFyY29hdFJvdWdobmVzc01hcCA9IHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCX0KCgkJaWYgKCB0aGlzLmNsZWFyY29hdE5vcm1hbE1hcCAmJiB0aGlzLmNsZWFyY29hdE5vcm1hbE1hcC5pc1RleHR1cmUgKSB7CgoJCQlkYXRhLmNsZWFyY29hdE5vcm1hbE1hcCA9IHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWRhdGEuY2xlYXJjb2F0Tm9ybWFsU2NhbGUgPSB0aGlzLmNsZWFyY29hdE5vcm1hbFNjYWxlLnRvQXJyYXkoKTsKCgkJfQoKCQlpZiAoIHRoaXMuaXJpZGVzY2VuY2UgIT09IHVuZGVmaW5lZCApIGRhdGEuaXJpZGVzY2VuY2UgPSB0aGlzLmlyaWRlc2NlbmNlOwoJCWlmICggdGhpcy5pcmlkZXNjZW5jZUlPUiAhPT0gdW5kZWZpbmVkICkgZGF0YS5pcmlkZXNjZW5jZUlPUiA9IHRoaXMuaXJpZGVzY2VuY2VJT1I7CgkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2UgIT09IHVuZGVmaW5lZCApIGRhdGEuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSA9IHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZTsKCgkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlTWFwICYmIHRoaXMuaXJpZGVzY2VuY2VNYXAuaXNUZXh0dXJlICkgewoKCQkJZGF0YS5pcmlkZXNjZW5jZU1hcCA9IHRoaXMuaXJpZGVzY2VuY2VNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJfQoKCQlpZiAoIHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgJiYgdGhpcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcC5pc1RleHR1cmUgKSB7CgoJCQlkYXRhLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID0gdGhpcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKCQl9CgoJCWlmICggdGhpcy5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSBkYXRhLmFuaXNvdHJvcHkgPSB0aGlzLmFuaXNvdHJvcHk7CgkJaWYgKCB0aGlzLmFuaXNvdHJvcHlSb3RhdGlvbiAhPT0gdW5kZWZpbmVkICkgZGF0YS5hbmlzb3Ryb3B5Um90YXRpb24gPSB0aGlzLmFuaXNvdHJvcHlSb3RhdGlvbjsKCgkJaWYgKCB0aGlzLmFuaXNvdHJvcHlNYXAgJiYgdGhpcy5hbmlzb3Ryb3B5TWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuYW5pc290cm9weU1hcCA9IHRoaXMuYW5pc290cm9weU1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKCQl9CgoJCWlmICggdGhpcy5tYXAgJiYgdGhpcy5tYXAuaXNUZXh0dXJlICkgZGF0YS5tYXAgPSB0aGlzLm1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCWlmICggdGhpcy5tYXRjYXAgJiYgdGhpcy5tYXRjYXAuaXNUZXh0dXJlICkgZGF0YS5tYXRjYXAgPSB0aGlzLm1hdGNhcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCWlmICggdGhpcy5hbHBoYU1hcCAmJiB0aGlzLmFscGhhTWFwLmlzVGV4dHVyZSApIGRhdGEuYWxwaGFNYXAgPSB0aGlzLmFscGhhTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCWlmICggdGhpcy5saWdodE1hcCAmJiB0aGlzLmxpZ2h0TWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEubGlnaHRNYXAgPSB0aGlzLmxpZ2h0TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWRhdGEubGlnaHRNYXBJbnRlbnNpdHkgPSB0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQl9CgoJCWlmICggdGhpcy5hb01hcCAmJiB0aGlzLmFvTWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuYW9NYXAgPSB0aGlzLmFvTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWRhdGEuYW9NYXBJbnRlbnNpdHkgPSB0aGlzLmFvTWFwSW50ZW5zaXR5OwoKCQl9CgoJCWlmICggdGhpcy5idW1wTWFwICYmIHRoaXMuYnVtcE1hcC5pc1RleHR1cmUgKSB7CgoJCQlkYXRhLmJ1bXBNYXAgPSB0aGlzLmJ1bXBNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJZGF0YS5idW1wU2NhbGUgPSB0aGlzLmJ1bXBTY2FsZTsKCgkJfQoKCQlpZiAoIHRoaXMubm9ybWFsTWFwICYmIHRoaXMubm9ybWFsTWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEubm9ybWFsTWFwID0gdGhpcy5ub3JtYWxNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJZGF0YS5ub3JtYWxNYXBUeXBlID0gdGhpcy5ub3JtYWxNYXBUeXBlOwoJCQlkYXRhLm5vcm1hbFNjYWxlID0gdGhpcy5ub3JtYWxTY2FsZS50b0FycmF5KCk7CgoJCX0KCgkJaWYgKCB0aGlzLmRpc3BsYWNlbWVudE1hcCAmJiB0aGlzLmRpc3BsYWNlbWVudE1hcC5pc1RleHR1cmUgKSB7CgoJCQlkYXRhLmRpc3BsYWNlbWVudE1hcCA9IHRoaXMuZGlzcGxhY2VtZW50TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWRhdGEuZGlzcGxhY2VtZW50U2NhbGUgPSB0aGlzLmRpc3BsYWNlbWVudFNjYWxlOwoJCQlkYXRhLmRpc3BsYWNlbWVudEJpYXMgPSB0aGlzLmRpc3BsYWNlbWVudEJpYXM7CgoJCX0KCgkJaWYgKCB0aGlzLnJvdWdobmVzc01hcCAmJiB0aGlzLnJvdWdobmVzc01hcC5pc1RleHR1cmUgKSBkYXRhLnJvdWdobmVzc01hcCA9IHRoaXMucm91Z2huZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJaWYgKCB0aGlzLm1ldGFsbmVzc01hcCAmJiB0aGlzLm1ldGFsbmVzc01hcC5pc1RleHR1cmUgKSBkYXRhLm1ldGFsbmVzc01hcCA9IHRoaXMubWV0YWxuZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCWlmICggdGhpcy5lbWlzc2l2ZU1hcCAmJiB0aGlzLmVtaXNzaXZlTWFwLmlzVGV4dHVyZSApIGRhdGEuZW1pc3NpdmVNYXAgPSB0aGlzLmVtaXNzaXZlTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJaWYgKCB0aGlzLnNwZWN1bGFyTWFwICYmIHRoaXMuc3BlY3VsYXJNYXAuaXNUZXh0dXJlICkgZGF0YS5zcGVjdWxhck1hcCA9IHRoaXMuc3BlY3VsYXJNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQlpZiAoIHRoaXMuc3BlY3VsYXJJbnRlbnNpdHlNYXAgJiYgdGhpcy5zcGVjdWxhckludGVuc2l0eU1hcC5pc1RleHR1cmUgKSBkYXRhLnNwZWN1bGFySW50ZW5zaXR5TWFwID0gdGhpcy5zcGVjdWxhckludGVuc2l0eU1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCWlmICggdGhpcy5zcGVjdWxhckNvbG9yTWFwICYmIHRoaXMuc3BlY3VsYXJDb2xvck1hcC5pc1RleHR1cmUgKSBkYXRhLnNwZWN1bGFyQ29sb3JNYXAgPSB0aGlzLnNwZWN1bGFyQ29sb3JNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJaWYgKCB0aGlzLmVudk1hcCAmJiB0aGlzLmVudk1hcC5pc1RleHR1cmUgKSB7CgoJCQlkYXRhLmVudk1hcCA9IHRoaXMuZW52TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQlpZiAoIHRoaXMuY29tYmluZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5jb21iaW5lID0gdGhpcy5jb21iaW5lOwoKCQl9CgoJCWlmICggdGhpcy5lbnZNYXBJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEuZW52TWFwSW50ZW5zaXR5ID0gdGhpcy5lbnZNYXBJbnRlbnNpdHk7CgkJaWYgKCB0aGlzLnJlZmxlY3Rpdml0eSAhPT0gdW5kZWZpbmVkICkgZGF0YS5yZWZsZWN0aXZpdHkgPSB0aGlzLnJlZmxlY3Rpdml0eTsKCQlpZiAoIHRoaXMucmVmcmFjdGlvblJhdGlvICE9PSB1bmRlZmluZWQgKSBkYXRhLnJlZnJhY3Rpb25SYXRpbyA9IHRoaXMucmVmcmFjdGlvblJhdGlvOwoKCQlpZiAoIHRoaXMuZ3JhZGllbnRNYXAgJiYgdGhpcy5ncmFkaWVudE1hcC5pc1RleHR1cmUgKSB7CgoJCQlkYXRhLmdyYWRpZW50TWFwID0gdGhpcy5ncmFkaWVudE1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKCQl9CgoJCWlmICggdGhpcy50cmFuc21pc3Npb24gIT09IHVuZGVmaW5lZCApIGRhdGEudHJhbnNtaXNzaW9uID0gdGhpcy50cmFuc21pc3Npb247CgkJaWYgKCB0aGlzLnRyYW5zbWlzc2lvbk1hcCAmJiB0aGlzLnRyYW5zbWlzc2lvbk1hcC5pc1RleHR1cmUgKSBkYXRhLnRyYW5zbWlzc2lvbk1hcCA9IHRoaXMudHJhbnNtaXNzaW9uTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJaWYgKCB0aGlzLnRoaWNrbmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS50aGlja25lc3MgPSB0aGlzLnRoaWNrbmVzczsKCQlpZiAoIHRoaXMudGhpY2tuZXNzTWFwICYmIHRoaXMudGhpY2tuZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEudGhpY2tuZXNzTWFwID0gdGhpcy50aGlja25lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQlpZiAoIHRoaXMuYXR0ZW51YXRpb25EaXN0YW5jZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuYXR0ZW51YXRpb25EaXN0YW5jZSAhPT0gSW5maW5pdHkgKSBkYXRhLmF0dGVudWF0aW9uRGlzdGFuY2UgPSB0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2U7CgkJaWYgKCB0aGlzLmF0dGVudWF0aW9uQ29sb3IgIT09IHVuZGVmaW5lZCApIGRhdGEuYXR0ZW51YXRpb25Db2xvciA9IHRoaXMuYXR0ZW51YXRpb25Db2xvci5nZXRIZXgoKTsKCgkJaWYgKCB0aGlzLnNpemUgIT09IHVuZGVmaW5lZCApIGRhdGEuc2l6ZSA9IHRoaXMuc2l6ZTsKCQlpZiAoIHRoaXMuc2hhZG93U2lkZSAhPT0gbnVsbCApIGRhdGEuc2hhZG93U2lkZSA9IHRoaXMuc2hhZG93U2lkZTsKCQlpZiAoIHRoaXMuc2l6ZUF0dGVudWF0aW9uICE9PSB1bmRlZmluZWQgKSBkYXRhLnNpemVBdHRlbnVhdGlvbiA9IHRoaXMuc2l6ZUF0dGVudWF0aW9uOwoKCQlpZiAoIHRoaXMuYmxlbmRpbmcgIT09IE5vcm1hbEJsZW5kaW5nICkgZGF0YS5ibGVuZGluZyA9IHRoaXMuYmxlbmRpbmc7CgkJaWYgKCB0aGlzLnNpZGUgIT09IEZyb250U2lkZSApIGRhdGEuc2lkZSA9IHRoaXMuc2lkZTsKCQlpZiAoIHRoaXMudmVydGV4Q29sb3JzID09PSB0cnVlICkgZGF0YS52ZXJ0ZXhDb2xvcnMgPSB0cnVlOwoKCQlpZiAoIHRoaXMub3BhY2l0eSA8IDEgKSBkYXRhLm9wYWNpdHkgPSB0aGlzLm9wYWNpdHk7CgkJaWYgKCB0aGlzLnRyYW5zcGFyZW50ID09PSB0cnVlICkgZGF0YS50cmFuc3BhcmVudCA9IHRydWU7CgoJCWlmICggdGhpcy5ibGVuZFNyYyAhPT0gU3JjQWxwaGFGYWN0b3IgKSBkYXRhLmJsZW5kU3JjID0gdGhpcy5ibGVuZFNyYzsKCQlpZiAoIHRoaXMuYmxlbmREc3QgIT09IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IgKSBkYXRhLmJsZW5kRHN0ID0gdGhpcy5ibGVuZERzdDsKCQlpZiAoIHRoaXMuYmxlbmRFcXVhdGlvbiAhPT0gQWRkRXF1YXRpb24gKSBkYXRhLmJsZW5kRXF1YXRpb24gPSB0aGlzLmJsZW5kRXF1YXRpb247CgkJaWYgKCB0aGlzLmJsZW5kU3JjQWxwaGEgIT09IG51bGwgKSBkYXRhLmJsZW5kU3JjQWxwaGEgPSB0aGlzLmJsZW5kU3JjQWxwaGE7CgkJaWYgKCB0aGlzLmJsZW5kRHN0QWxwaGEgIT09IG51bGwgKSBkYXRhLmJsZW5kRHN0QWxwaGEgPSB0aGlzLmJsZW5kRHN0QWxwaGE7CgkJaWYgKCB0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSAhPT0gbnVsbCApIGRhdGEuYmxlbmRFcXVhdGlvbkFscGhhID0gdGhpcy5ibGVuZEVxdWF0aW9uQWxwaGE7CgkJaWYgKCB0aGlzLmJsZW5kQ29sb3IgJiYgdGhpcy5ibGVuZENvbG9yLmlzQ29sb3IgKSBkYXRhLmJsZW5kQ29sb3IgPSB0aGlzLmJsZW5kQ29sb3IuZ2V0SGV4KCk7CgkJaWYgKCB0aGlzLmJsZW5kQWxwaGEgIT09IDAgKSBkYXRhLmJsZW5kQWxwaGEgPSB0aGlzLmJsZW5kQWxwaGE7CgoJCWlmICggdGhpcy5kZXB0aEZ1bmMgIT09IExlc3NFcXVhbERlcHRoICkgZGF0YS5kZXB0aEZ1bmMgPSB0aGlzLmRlcHRoRnVuYzsKCQlpZiAoIHRoaXMuZGVwdGhUZXN0ID09PSBmYWxzZSApIGRhdGEuZGVwdGhUZXN0ID0gdGhpcy5kZXB0aFRlc3Q7CgkJaWYgKCB0aGlzLmRlcHRoV3JpdGUgPT09IGZhbHNlICkgZGF0YS5kZXB0aFdyaXRlID0gdGhpcy5kZXB0aFdyaXRlOwoJCWlmICggdGhpcy5jb2xvcldyaXRlID09PSBmYWxzZSApIGRhdGEuY29sb3JXcml0ZSA9IHRoaXMuY29sb3JXcml0ZTsKCgkJaWYgKCB0aGlzLnN0ZW5jaWxXcml0ZU1hc2sgIT09IDB4ZmYgKSBkYXRhLnN0ZW5jaWxXcml0ZU1hc2sgPSB0aGlzLnN0ZW5jaWxXcml0ZU1hc2s7CgkJaWYgKCB0aGlzLnN0ZW5jaWxGdW5jICE9PSBBbHdheXNTdGVuY2lsRnVuYyApIGRhdGEuc3RlbmNpbEZ1bmMgPSB0aGlzLnN0ZW5jaWxGdW5jOwoJCWlmICggdGhpcy5zdGVuY2lsUmVmICE9PSAwICkgZGF0YS5zdGVuY2lsUmVmID0gdGhpcy5zdGVuY2lsUmVmOwoJCWlmICggdGhpcy5zdGVuY2lsRnVuY01hc2sgIT09IDB4ZmYgKSBkYXRhLnN0ZW5jaWxGdW5jTWFzayA9IHRoaXMuc3RlbmNpbEZ1bmNNYXNrOwoJCWlmICggdGhpcy5zdGVuY2lsRmFpbCAhPT0gS2VlcFN0ZW5jaWxPcCApIGRhdGEuc3RlbmNpbEZhaWwgPSB0aGlzLnN0ZW5jaWxGYWlsOwoJCWlmICggdGhpcy5zdGVuY2lsWkZhaWwgIT09IEtlZXBTdGVuY2lsT3AgKSBkYXRhLnN0ZW5jaWxaRmFpbCA9IHRoaXMuc3RlbmNpbFpGYWlsOwoJCWlmICggdGhpcy5zdGVuY2lsWlBhc3MgIT09IEtlZXBTdGVuY2lsT3AgKSBkYXRhLnN0ZW5jaWxaUGFzcyA9IHRoaXMuc3RlbmNpbFpQYXNzOwoJCWlmICggdGhpcy5zdGVuY2lsV3JpdGUgPT09IHRydWUgKSBkYXRhLnN0ZW5jaWxXcml0ZSA9IHRoaXMuc3RlbmNpbFdyaXRlOwoKCQkvLyByb3RhdGlvbiAoU3ByaXRlTWF0ZXJpYWwpCgkJaWYgKCB0aGlzLnJvdGF0aW9uICE9PSB1bmRlZmluZWQgJiYgdGhpcy5yb3RhdGlvbiAhPT0gMCApIGRhdGEucm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwoKCQlpZiAoIHRoaXMucG9seWdvbk9mZnNldCA9PT0gdHJ1ZSApIGRhdGEucG9seWdvbk9mZnNldCA9IHRydWU7CgkJaWYgKCB0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3IgIT09IDAgKSBkYXRhLnBvbHlnb25PZmZzZXRGYWN0b3IgPSB0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3I7CgkJaWYgKCB0aGlzLnBvbHlnb25PZmZzZXRVbml0cyAhPT0gMCApIGRhdGEucG9seWdvbk9mZnNldFVuaXRzID0gdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHM7CgoJCWlmICggdGhpcy5saW5ld2lkdGggIT09IHVuZGVmaW5lZCAmJiB0aGlzLmxpbmV3aWR0aCAhPT0gMSApIGRhdGEubGluZXdpZHRoID0gdGhpcy5saW5ld2lkdGg7CgkJaWYgKCB0aGlzLmRhc2hTaXplICE9PSB1bmRlZmluZWQgKSBkYXRhLmRhc2hTaXplID0gdGhpcy5kYXNoU2l6ZTsKCQlpZiAoIHRoaXMuZ2FwU2l6ZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5nYXBTaXplID0gdGhpcy5nYXBTaXplOwoJCWlmICggdGhpcy5zY2FsZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5zY2FsZSA9IHRoaXMuc2NhbGU7CgoJCWlmICggdGhpcy5kaXRoZXJpbmcgPT09IHRydWUgKSBkYXRhLmRpdGhlcmluZyA9IHRydWU7CgoJCWlmICggdGhpcy5hbHBoYVRlc3QgPiAwICkgZGF0YS5hbHBoYVRlc3QgPSB0aGlzLmFscGhhVGVzdDsKCQlpZiAoIHRoaXMuYWxwaGFIYXNoID09PSB0cnVlICkgZGF0YS5hbHBoYUhhc2ggPSB0cnVlOwoJCWlmICggdGhpcy5hbHBoYVRvQ292ZXJhZ2UgPT09IHRydWUgKSBkYXRhLmFscGhhVG9Db3ZlcmFnZSA9IHRydWU7CgkJaWYgKCB0aGlzLnByZW11bHRpcGxpZWRBbHBoYSA9PT0gdHJ1ZSApIGRhdGEucHJlbXVsdGlwbGllZEFscGhhID0gdHJ1ZTsKCQlpZiAoIHRoaXMuZm9yY2VTaW5nbGVQYXNzID09PSB0cnVlICkgZGF0YS5mb3JjZVNpbmdsZVBhc3MgPSB0cnVlOwoKCQlpZiAoIHRoaXMud2lyZWZyYW1lID09PSB0cnVlICkgZGF0YS53aXJlZnJhbWUgPSB0cnVlOwoJCWlmICggdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPiAxICkgZGF0YS53aXJlZnJhbWVMaW5ld2lkdGggPSB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aDsKCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZWNhcCAhPT0gJ3JvdW5kJyApIGRhdGEud2lyZWZyYW1lTGluZWNhcCA9IHRoaXMud2lyZWZyYW1lTGluZWNhcDsKCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZWpvaW4gIT09ICdyb3VuZCcgKSBkYXRhLndpcmVmcmFtZUxpbmVqb2luID0gdGhpcy53aXJlZnJhbWVMaW5lam9pbjsKCgkJaWYgKCB0aGlzLmZsYXRTaGFkaW5nID09PSB0cnVlICkgZGF0YS5mbGF0U2hhZGluZyA9IHRydWU7CgoJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIGRhdGEudmlzaWJsZSA9IGZhbHNlOwoKCQlpZiAoIHRoaXMudG9uZU1hcHBlZCA9PT0gZmFsc2UgKSBkYXRhLnRvbmVNYXBwZWQgPSBmYWxzZTsKCgkJaWYgKCB0aGlzLmZvZyA9PT0gZmFsc2UgKSBkYXRhLmZvZyA9IGZhbHNlOwoKCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLnVzZXJEYXRhICkubGVuZ3RoID4gMCApIGRhdGEudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKCQkvLyBUT0RPOiBDb3BpZWQgZnJvbSBPYmplY3QzRC50b0pTT04KCgkJZnVuY3Rpb24gZXh0cmFjdEZyb21DYWNoZSggY2FjaGUgKSB7CgoJCQljb25zdCB2YWx1ZXMgPSBbXTsKCgkJCWZvciAoIGNvbnN0IGtleSBpbiBjYWNoZSApIHsKCgkJCQljb25zdCBkYXRhID0gY2FjaGVbIGtleSBdOwoJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CgkJCQl2YWx1ZXMucHVzaCggZGF0YSApOwoKCQkJfQoKCQkJcmV0dXJuIHZhbHVlczsKCgkJfQoKCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCgkJCWNvbnN0IHRleHR1cmVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS50ZXh0dXJlcyApOwoJCQljb25zdCBpbWFnZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmltYWdlcyApOwoKCQkJaWYgKCB0ZXh0dXJlcy5sZW5ndGggPiAwICkgZGF0YS50ZXh0dXJlcyA9IHRleHR1cmVzOwoJCQlpZiAoIGltYWdlcy5sZW5ndGggPiAwICkgZGF0YS5pbWFnZXMgPSBpbWFnZXM7CgoJCX0KCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgoJCXRoaXMuYmxlbmRpbmcgPSBzb3VyY2UuYmxlbmRpbmc7CgkJdGhpcy5zaWRlID0gc291cmNlLnNpZGU7CgkJdGhpcy52ZXJ0ZXhDb2xvcnMgPSBzb3VyY2UudmVydGV4Q29sb3JzOwoKCQl0aGlzLm9wYWNpdHkgPSBzb3VyY2Uub3BhY2l0eTsKCQl0aGlzLnRyYW5zcGFyZW50ID0gc291cmNlLnRyYW5zcGFyZW50OwoKCQl0aGlzLmJsZW5kU3JjID0gc291cmNlLmJsZW5kU3JjOwoJCXRoaXMuYmxlbmREc3QgPSBzb3VyY2UuYmxlbmREc3Q7CgkJdGhpcy5ibGVuZEVxdWF0aW9uID0gc291cmNlLmJsZW5kRXF1YXRpb247CgkJdGhpcy5ibGVuZFNyY0FscGhhID0gc291cmNlLmJsZW5kU3JjQWxwaGE7CgkJdGhpcy5ibGVuZERzdEFscGhhID0gc291cmNlLmJsZW5kRHN0QWxwaGE7CgkJdGhpcy5ibGVuZEVxdWF0aW9uQWxwaGEgPSBzb3VyY2UuYmxlbmRFcXVhdGlvbkFscGhhOwoJCXRoaXMuYmxlbmRDb2xvci5jb3B5KCBzb3VyY2UuYmxlbmRDb2xvciApOwoJCXRoaXMuYmxlbmRBbHBoYSA9IHNvdXJjZS5ibGVuZEFscGhhOwoKCQl0aGlzLmRlcHRoRnVuYyA9IHNvdXJjZS5kZXB0aEZ1bmM7CgkJdGhpcy5kZXB0aFRlc3QgPSBzb3VyY2UuZGVwdGhUZXN0OwoJCXRoaXMuZGVwdGhXcml0ZSA9IHNvdXJjZS5kZXB0aFdyaXRlOwoKCQl0aGlzLnN0ZW5jaWxXcml0ZU1hc2sgPSBzb3VyY2Uuc3RlbmNpbFdyaXRlTWFzazsKCQl0aGlzLnN0ZW5jaWxGdW5jID0gc291cmNlLnN0ZW5jaWxGdW5jOwoJCXRoaXMuc3RlbmNpbFJlZiA9IHNvdXJjZS5zdGVuY2lsUmVmOwoJCXRoaXMuc3RlbmNpbEZ1bmNNYXNrID0gc291cmNlLnN0ZW5jaWxGdW5jTWFzazsKCQl0aGlzLnN0ZW5jaWxGYWlsID0gc291cmNlLnN0ZW5jaWxGYWlsOwoJCXRoaXMuc3RlbmNpbFpGYWlsID0gc291cmNlLnN0ZW5jaWxaRmFpbDsKCQl0aGlzLnN0ZW5jaWxaUGFzcyA9IHNvdXJjZS5zdGVuY2lsWlBhc3M7CgkJdGhpcy5zdGVuY2lsV3JpdGUgPSBzb3VyY2Uuc3RlbmNpbFdyaXRlOwoKCQljb25zdCBzcmNQbGFuZXMgPSBzb3VyY2UuY2xpcHBpbmdQbGFuZXM7CgkJbGV0IGRzdFBsYW5lcyA9IG51bGw7CgoJCWlmICggc3JjUGxhbmVzICE9PSBudWxsICkgewoKCQkJY29uc3QgbiA9IHNyY1BsYW5lcy5sZW5ndGg7CgkJCWRzdFBsYW5lcyA9IG5ldyBBcnJheSggbiApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJCWRzdFBsYW5lc1sgaSBdID0gc3JjUGxhbmVzWyBpIF0uY2xvbmUoKTsKCgkJCX0KCgkJfQoKCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gZHN0UGxhbmVzOwoJCXRoaXMuY2xpcEludGVyc2VjdGlvbiA9IHNvdXJjZS5jbGlwSW50ZXJzZWN0aW9uOwoJCXRoaXMuY2xpcFNoYWRvd3MgPSBzb3VyY2UuY2xpcFNoYWRvd3M7CgoJCXRoaXMuc2hhZG93U2lkZSA9IHNvdXJjZS5zaGFkb3dTaWRlOwoKCQl0aGlzLmNvbG9yV3JpdGUgPSBzb3VyY2UuY29sb3JXcml0ZTsKCgkJdGhpcy5wcmVjaXNpb24gPSBzb3VyY2UucHJlY2lzaW9uOwoKCQl0aGlzLnBvbHlnb25PZmZzZXQgPSBzb3VyY2UucG9seWdvbk9mZnNldDsKCQl0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3IgPSBzb3VyY2UucG9seWdvbk9mZnNldEZhY3RvcjsKCQl0aGlzLnBvbHlnb25PZmZzZXRVbml0cyA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0VW5pdHM7CgoJCXRoaXMuZGl0aGVyaW5nID0gc291cmNlLmRpdGhlcmluZzsKCgkJdGhpcy5hbHBoYVRlc3QgPSBzb3VyY2UuYWxwaGFUZXN0OwoJCXRoaXMuYWxwaGFIYXNoID0gc291cmNlLmFscGhhSGFzaDsKCQl0aGlzLmFscGhhVG9Db3ZlcmFnZSA9IHNvdXJjZS5hbHBoYVRvQ292ZXJhZ2U7CgkJdGhpcy5wcmVtdWx0aXBsaWVkQWxwaGEgPSBzb3VyY2UucHJlbXVsdGlwbGllZEFscGhhOwoJCXRoaXMuZm9yY2VTaW5nbGVQYXNzID0gc291cmNlLmZvcmNlU2luZ2xlUGFzczsKCgkJdGhpcy52aXNpYmxlID0gc291cmNlLnZpc2libGU7CgoJCXRoaXMudG9uZU1hcHBlZCA9IHNvdXJjZS50b25lTWFwcGVkOwoKCQl0aGlzLnVzZXJEYXRhID0gSlNPTi5wYXJzZSggSlNPTi5zdHJpbmdpZnkoIHNvdXJjZS51c2VyRGF0YSApICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCgl9CgoJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCgkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHRoaXMudmVyc2lvbiArKzsKCgl9Cgp9CgpjbGFzcyBNZXNoQmFzaWNNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc01lc2hCYXNpY01hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hCYXNpY01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZW1pc3NpdmUKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmFvTWFwID0gbnVsbDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLnNwZWN1bGFyTWFwID0gbnVsbDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuZW52TWFwID0gbnVsbDsKCQl0aGlzLmNvbWJpbmUgPSBNdWx0aXBseU9wZXJhdGlvbjsKCQl0aGlzLnJlZmxlY3Rpdml0eSA9IDE7CgkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSAwLjk4OwoKCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSAncm91bmQnOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSAncm91bmQnOwoKCQl0aGlzLmZvZyA9IHRydWU7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQl0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSBzb3VyY2UuYW9NYXBJbnRlbnNpdHk7CgoJCXRoaXMuc3BlY3VsYXJNYXAgPSBzb3VyY2Uuc3BlY3VsYXJNYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuZW52TWFwID0gc291cmNlLmVudk1hcDsKCQl0aGlzLmNvbWJpbmUgPSBzb3VyY2UuY29tYmluZTsKCQl0aGlzLnJlZmxlY3Rpdml0eSA9IHNvdXJjZS5yZWZsZWN0aXZpdHk7CgkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSBzb3VyY2UucmVmcmFjdGlvblJhdGlvOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9IHNvdXJjZS53aXJlZnJhbWVMaW5lY2FwOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgoJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKLy8gRmFzdCBIYWxmIEZsb2F0IENvbnZlcnNpb25zLCBodHRwOi8vd3d3LmZveC10b29sa2l0Lm9yZy9mdHAvZmFzdGhhbGZmbG9hdGNvbnZlcnNpb24ucGRmCgpjb25zdCBfdGFibGVzID0gLypAX19QVVJFX18qLyBfZ2VuZXJhdGVUYWJsZXMoKTsKCmZ1bmN0aW9uIF9nZW5lcmF0ZVRhYmxlcygpIHsKCgkvLyBmbG9hdDMyIHRvIGZsb2F0MTYgaGVscGVycwoKCWNvbnN0IGJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlciggNCApOwoJY29uc3QgZmxvYXRWaWV3ID0gbmV3IEZsb2F0MzJBcnJheSggYnVmZmVyICk7Cgljb25zdCB1aW50MzJWaWV3ID0gbmV3IFVpbnQzMkFycmF5KCBidWZmZXIgKTsKCgljb25zdCBiYXNlVGFibGUgPSBuZXcgVWludDMyQXJyYXkoIDUxMiApOwoJY29uc3Qgc2hpZnRUYWJsZSA9IG5ldyBVaW50MzJBcnJheSggNTEyICk7CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgMjU2OyArKyBpICkgewoKCQljb25zdCBlID0gaSAtIDEyNzsKCgkJLy8gdmVyeSBzbWFsbCBudW1iZXIgKDAsIC0wKQoKCQlpZiAoIGUgPCAtIDI3ICkgewoKCQkJYmFzZVRhYmxlWyBpIF0gPSAweDAwMDA7CgkJCWJhc2VUYWJsZVsgaSB8IDB4MTAwIF0gPSAweDgwMDA7CgkJCXNoaWZ0VGFibGVbIGkgXSA9IDI0OwoJCQlzaGlmdFRhYmxlWyBpIHwgMHgxMDAgXSA9IDI0OwoKCQkJLy8gc21hbGwgbnVtYmVyIChkZW5vcm0pCgoJCX0gZWxzZSBpZiAoIGUgPCAtIDE0ICkgewoKCQkJYmFzZVRhYmxlWyBpIF0gPSAweDA0MDAgPj4gKCAtIGUgLSAxNCApOwoJCQliYXNlVGFibGVbIGkgfCAweDEwMCBdID0gKCAweDA0MDAgPj4gKCAtIGUgLSAxNCApICkgfCAweDgwMDA7CgkJCXNoaWZ0VGFibGVbIGkgXSA9IC0gZSAtIDE7CgkJCXNoaWZ0VGFibGVbIGkgfCAweDEwMCBdID0gLSBlIC0gMTsKCgkJCS8vIG5vcm1hbCBudW1iZXIKCgkJfSBlbHNlIGlmICggZSA8PSAxNSApIHsKCgkJCWJhc2VUYWJsZVsgaSBdID0gKCBlICsgMTUgKSA8PCAxMDsKCQkJYmFzZVRhYmxlWyBpIHwgMHgxMDAgXSA9ICggKCBlICsgMTUgKSA8PCAxMCApIHwgMHg4MDAwOwoJCQlzaGlmdFRhYmxlWyBpIF0gPSAxMzsKCQkJc2hpZnRUYWJsZVsgaSB8IDB4MTAwIF0gPSAxMzsKCgkJCS8vIGxhcmdlIG51bWJlciAoSW5maW5pdHksIC1JbmZpbml0eSkKCgkJfSBlbHNlIGlmICggZSA8IDEyOCApIHsKCgkJCWJhc2VUYWJsZVsgaSBdID0gMHg3YzAwOwoJCQliYXNlVGFibGVbIGkgfCAweDEwMCBdID0gMHhmYzAwOwoJCQlzaGlmdFRhYmxlWyBpIF0gPSAyNDsKCQkJc2hpZnRUYWJsZVsgaSB8IDB4MTAwIF0gPSAyNDsKCgkJCS8vIHN0YXkgKE5hTiwgSW5maW5pdHksIC1JbmZpbml0eSkKCgkJfSBlbHNlIHsKCgkJCWJhc2VUYWJsZVsgaSBdID0gMHg3YzAwOwoJCQliYXNlVGFibGVbIGkgfCAweDEwMCBdID0gMHhmYzAwOwoJCQlzaGlmdFRhYmxlWyBpIF0gPSAxMzsKCQkJc2hpZnRUYWJsZVsgaSB8IDB4MTAwIF0gPSAxMzsKCgkJfQoKCX0KCgkvLyBmbG9hdDE2IHRvIGZsb2F0MzIgaGVscGVycwoKCWNvbnN0IG1hbnRpc3NhVGFibGUgPSBuZXcgVWludDMyQXJyYXkoIDIwNDggKTsKCWNvbnN0IGV4cG9uZW50VGFibGUgPSBuZXcgVWludDMyQXJyYXkoIDY0ICk7Cgljb25zdCBvZmZzZXRUYWJsZSA9IG5ldyBVaW50MzJBcnJheSggNjQgKTsKCglmb3IgKCBsZXQgaSA9IDE7IGkgPCAxMDI0OyArKyBpICkgewoKCQlsZXQgbSA9IGkgPDwgMTM7IC8vIHplcm8gcGFkIG1hbnRpc3NhIGJpdHMKCQlsZXQgZSA9IDA7IC8vIHplcm8gZXhwb25lbnQKCgkJLy8gbm9ybWFsaXplZAoJCXdoaWxlICggKCBtICYgMHgwMDgwMDAwMCApID09PSAwICkgewoKCQkJbSA8PD0gMTsKCQkJZSAtPSAweDAwODAwMDAwOyAvLyBkZWNyZW1lbnQgZXhwb25lbnQKCgkJfQoKCQltICY9IH4gMHgwMDgwMDAwMDsgLy8gY2xlYXIgbGVhZGluZyAxIGJpdAoJCWUgKz0gMHgzODgwMDAwMDsgLy8gYWRqdXN0IGJpYXMKCgkJbWFudGlzc2FUYWJsZVsgaSBdID0gbSB8IGU7CgoJfQoKCWZvciAoIGxldCBpID0gMTAyNDsgaSA8IDIwNDg7ICsrIGkgKSB7CgoJCW1hbnRpc3NhVGFibGVbIGkgXSA9IDB4MzgwMDAwMDAgKyAoICggaSAtIDEwMjQgKSA8PCAxMyApOwoKCX0KCglmb3IgKCBsZXQgaSA9IDE7IGkgPCAzMTsgKysgaSApIHsKCgkJZXhwb25lbnRUYWJsZVsgaSBdID0gaSA8PCAyMzsKCgl9CgoJZXhwb25lbnRUYWJsZVsgMzEgXSA9IDB4NDc4MDAwMDA7CglleHBvbmVudFRhYmxlWyAzMiBdID0gMHg4MDAwMDAwMDsKCglmb3IgKCBsZXQgaSA9IDMzOyBpIDwgNjM7ICsrIGkgKSB7CgoJCWV4cG9uZW50VGFibGVbIGkgXSA9IDB4ODAwMDAwMDAgKyAoICggaSAtIDMyICkgPDwgMjMgKTsKCgl9CgoJZXhwb25lbnRUYWJsZVsgNjMgXSA9IDB4Yzc4MDAwMDA7CgoJZm9yICggbGV0IGkgPSAxOyBpIDwgNjQ7ICsrIGkgKSB7CgoJCWlmICggaSAhPT0gMzIgKSB7CgoJCQlvZmZzZXRUYWJsZVsgaSBdID0gMTAyNDsKCgkJfQoKCX0KCglyZXR1cm4gewoJCWZsb2F0VmlldzogZmxvYXRWaWV3LAoJCXVpbnQzMlZpZXc6IHVpbnQzMlZpZXcsCgkJYmFzZVRhYmxlOiBiYXNlVGFibGUsCgkJc2hpZnRUYWJsZTogc2hpZnRUYWJsZSwKCQltYW50aXNzYVRhYmxlOiBtYW50aXNzYVRhYmxlLAoJCWV4cG9uZW50VGFibGU6IGV4cG9uZW50VGFibGUsCgkJb2Zmc2V0VGFibGU6IG9mZnNldFRhYmxlCgl9OwoKfQoKLy8gZmxvYXQzMiB0byBmbG9hdDE2CgpmdW5jdGlvbiB0b0hhbGZGbG9hdCggdmFsICkgewoKCWlmICggTWF0aC5hYnMoIHZhbCApID4gNjU1MDQgKSBjb25zb2xlLndhcm4oICdUSFJFRS5EYXRhVXRpbHMudG9IYWxmRmxvYXQoKTogVmFsdWUgb3V0IG9mIHJhbmdlLicgKTsKCgl2YWwgPSBjbGFtcCggdmFsLCAtIDY1NTA0LCA2NTUwNCApOwoKCV90YWJsZXMuZmxvYXRWaWV3WyAwIF0gPSB2YWw7Cgljb25zdCBmID0gX3RhYmxlcy51aW50MzJWaWV3WyAwIF07Cgljb25zdCBlID0gKCBmID4+IDIzICkgJiAweDFmZjsKCXJldHVybiBfdGFibGVzLmJhc2VUYWJsZVsgZSBdICsgKCAoIGYgJiAweDAwN2ZmZmZmICkgPj4gX3RhYmxlcy5zaGlmdFRhYmxlWyBlIF0gKTsKCn0KCi8vIGZsb2F0MTYgdG8gZmxvYXQzMgoKZnVuY3Rpb24gZnJvbUhhbGZGbG9hdCggdmFsICkgewoKCWNvbnN0IG0gPSB2YWwgPj4gMTA7CglfdGFibGVzLnVpbnQzMlZpZXdbIDAgXSA9IF90YWJsZXMubWFudGlzc2FUYWJsZVsgX3RhYmxlcy5vZmZzZXRUYWJsZVsgbSBdICsgKCB2YWwgJiAweDNmZiApIF0gKyBfdGFibGVzLmV4cG9uZW50VGFibGVbIG0gXTsKCXJldHVybiBfdGFibGVzLmZsb2F0Vmlld1sgMCBdOwoKfQoKY29uc3QgRGF0YVV0aWxzID0gewoJdG9IYWxmRmxvYXQ6IHRvSGFsZkZsb2F0LAoJZnJvbUhhbGZGbG9hdDogZnJvbUhhbGZGbG9hdCwKfTsKCmNvbnN0IF92ZWN0b3IkOSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZlY3RvcjIkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoKTsKCmNsYXNzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCA9IGZhbHNlICkgewoKCQlpZiAoIEFycmF5LmlzQXJyYXkoIGFycmF5ICkgKSB7CgoJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCAnVEhSRUUuQnVmZmVyQXR0cmlidXRlOiBhcnJheSBzaG91bGQgYmUgYSBUeXBlZCBBcnJheS4nICk7CgoJCX0KCgkJdGhpcy5pc0J1ZmZlckF0dHJpYnV0ZSA9IHRydWU7CgoJCXRoaXMubmFtZSA9ICcnOwoKCQl0aGlzLmFycmF5ID0gYXJyYXk7CgkJdGhpcy5pdGVtU2l6ZSA9IGl0ZW1TaXplOwoJCXRoaXMuY291bnQgPSBhcnJheSAhPT0gdW5kZWZpbmVkID8gYXJyYXkubGVuZ3RoIC8gaXRlbVNpemUgOiAwOwoJCXRoaXMubm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQ7CgoJCXRoaXMudXNhZ2UgPSBTdGF0aWNEcmF3VXNhZ2U7CgkJdGhpcy5fdXBkYXRlUmFuZ2UgPSB7IG9mZnNldDogMCwgY291bnQ6IC0gMSB9OwoJCXRoaXMudXBkYXRlUmFuZ2VzID0gW107CgkJdGhpcy5ncHVUeXBlID0gRmxvYXRUeXBlOwoKCQl0aGlzLnZlcnNpb24gPSAwOwoKCX0KCglvblVwbG9hZENhbGxiYWNrKCkge30KCglzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKCQlpZiAoIHZhbHVlID09PSB0cnVlICkgdGhpcy52ZXJzaW9uICsrOwoKCX0KCglnZXQgdXBkYXRlUmFuZ2UoKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckF0dHJpYnV0ZTogdXBkYXRlUmFuZ2UoKSBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gcjE2OS4gVXNlIGFkZFVwZGF0ZVJhbmdlKCkgaW5zdGVhZC4nICk7IC8vIEBkZXByZWNhdGVkLCByMTU5CgkJcmV0dXJuIHRoaXMuX3VwZGF0ZVJhbmdlOwoKCX0KCglzZXRVc2FnZSggdmFsdWUgKSB7CgoJCXRoaXMudXNhZ2UgPSB2YWx1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZFVwZGF0ZVJhbmdlKCBzdGFydCwgY291bnQgKSB7CgoJCXRoaXMudXBkYXRlUmFuZ2VzLnB1c2goIHsgc3RhcnQsIGNvdW50IH0gKTsKCgl9CgoJY2xlYXJVcGRhdGVSYW5nZXMoKSB7CgoJCXRoaXMudXBkYXRlUmFuZ2VzLmxlbmd0aCA9IDA7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgkJdGhpcy5hcnJheSA9IG5ldyBzb3VyY2UuYXJyYXkuY29uc3RydWN0b3IoIHNvdXJjZS5hcnJheSApOwoJCXRoaXMuaXRlbVNpemUgPSBzb3VyY2UuaXRlbVNpemU7CgkJdGhpcy5jb3VudCA9IHNvdXJjZS5jb3VudDsKCQl0aGlzLm5vcm1hbGl6ZWQgPSBzb3VyY2Uubm9ybWFsaXplZDsKCgkJdGhpcy51c2FnZSA9IHNvdXJjZS51c2FnZTsKCQl0aGlzLmdwdVR5cGUgPSBzb3VyY2UuZ3B1VHlwZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHlBdCggaW5kZXgxLCBhdHRyaWJ1dGUsIGluZGV4MiApIHsKCgkJaW5kZXgxICo9IHRoaXMuaXRlbVNpemU7CgkJaW5kZXgyICo9IGF0dHJpYnV0ZS5pdGVtU2l6ZTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5pdGVtU2l6ZTsgaSA8IGw7IGkgKysgKSB7CgoJCQl0aGlzLmFycmF5WyBpbmRleDEgKyBpIF0gPSBhdHRyaWJ1dGUuYXJyYXlbIGluZGV4MiArIGkgXTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weUFycmF5KCBhcnJheSApIHsKCgkJdGhpcy5hcnJheS5zZXQoIGFycmF5ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcHBseU1hdHJpeDMoIG0gKSB7CgoJCWlmICggdGhpcy5pdGVtU2l6ZSA9PT0gMiApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCV92ZWN0b3IyJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdGhpcywgaSApOwoJCQkJX3ZlY3RvcjIkMS5hcHBseU1hdHJpeDMoIG0gKTsKCgkJCQl0aGlzLnNldFhZKCBpLCBfdmVjdG9yMiQxLngsIF92ZWN0b3IyJDEueSApOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCB0aGlzLml0ZW1TaXplID09PSAzICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCQkJCV92ZWN0b3IkOS5hcHBseU1hdHJpeDMoIG0gKTsKCgkJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ5LngsIF92ZWN0b3IkOS55LCBfdmVjdG9yJDkueiApOwoKCQkJfQoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcHBseU1hdHJpeDQoIG0gKSB7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCgkJCV92ZWN0b3IkOS5hcHBseU1hdHJpeDQoIG0gKTsKCgkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDkueCwgX3ZlY3RvciQ5LnksIF92ZWN0b3IkOS56ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5Tm9ybWFsTWF0cml4KCBtICkgewoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCgkJCV92ZWN0b3IkOS5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CgoJCQlfdmVjdG9yJDkuYXBwbHlOb3JtYWxNYXRyaXgoIG0gKTsKCgkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDkueCwgX3ZlY3RvciQ5LnksIF92ZWN0b3IkOS56ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyYW5zZm9ybURpcmVjdGlvbiggbSApIHsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQlfdmVjdG9yJDkuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdGhpcywgaSApOwoKCQkJX3ZlY3RvciQ5LnRyYW5zZm9ybURpcmVjdGlvbiggbSApOwoKCQkJdGhpcy5zZXRYWVooIGksIF92ZWN0b3IkOS54LCBfdmVjdG9yJDkueSwgX3ZlY3RvciQ5LnogKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0KCB2YWx1ZSwgb2Zmc2V0ID0gMCApIHsKCgkJLy8gTWF0Y2hpbmcgQnVmZmVyQXR0cmlidXRlIGNvbnN0cnVjdG9yLCBkbyBub3Qgbm9ybWFsaXplIHRoZSBhcnJheS4KCQl0aGlzLmFycmF5LnNldCggdmFsdWUsIG9mZnNldCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0Q29tcG9uZW50KCBpbmRleCwgY29tcG9uZW50ICkgewoKCQlsZXQgdmFsdWUgPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyBjb21wb25lbnQgXTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB2YWx1ZSA9IGRlbm9ybWFsaXplKCB2YWx1ZSwgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4gdmFsdWU7CgoJfQoKCXNldENvbXBvbmVudCggaW5kZXgsIGNvbXBvbmVudCwgdmFsdWUgKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgdmFsdWUgPSBub3JtYWxpemUoIHZhbHVlLCB0aGlzLmFycmF5ICk7CgoJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIGNvbXBvbmVudCBdID0gdmFsdWU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRYKCBpbmRleCApIHsKCgkJbGV0IHggPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgXTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB4ID0gZGVub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCgkJcmV0dXJuIHg7CgoJfQoKCXNldFgoIGluZGV4LCB4ICkgewoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCgkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplIF0gPSB4OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0WSggaW5kZXggKSB7CgoJCWxldCB5ID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMSBdOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHkgPSBkZW5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4geTsKCgl9CgoJc2V0WSggaW5kZXgsIHkgKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAxIF0gPSB5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0WiggaW5kZXggKSB7CgoJCWxldCB6ID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMiBdOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHogPSBkZW5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4gejsKCgl9CgoJc2V0WiggaW5kZXgsIHogKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyIF0gPSB6OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0VyggaW5kZXggKSB7CgoJCWxldCB3ID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMyBdOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHcgPSBkZW5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4gdzsKCgl9CgoJc2V0VyggaW5kZXgsIHcgKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgdyA9IG5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAzIF0gPSB3OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WFkoIGluZGV4LCB4LCB5ICkgewoKCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQl9CgoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0geDsKCQl0aGlzLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYWVooIGluZGV4LCB4LCB5LCB6ICkgewoKCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoJCQl6ID0gbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgoJCX0KCgkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0geTsKCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYWVpXKCBpbmRleCwgeCwgeSwgeiwgdyApIHsKCgkJaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgoJCQl4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgkJCXkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCQkJeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoJCQl3ID0gbm9ybWFsaXplKCB3LCB0aGlzLmFycmF5ICk7CgoJCX0KCgkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0geTsKCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgkJdGhpcy5hcnJheVsgaW5kZXggKyAzIF0gPSB3OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJb25VcGxvYWQoIGNhbGxiYWNrICkgewoKCQl0aGlzLm9uVXBsb2FkQ2FsbGJhY2sgPSBjYWxsYmFjazsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuYXJyYXksIHRoaXMuaXRlbVNpemUgKS5jb3B5KCB0aGlzICk7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHsKCQkJaXRlbVNpemU6IHRoaXMuaXRlbVNpemUsCgkJCXR5cGU6IHRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSwKCQkJYXJyYXk6IEFycmF5LmZyb20oIHRoaXMuYXJyYXkgKSwKCQkJbm9ybWFsaXplZDogdGhpcy5ub3JtYWxpemVkCgkJfTsKCgkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwoJCWlmICggdGhpcy51c2FnZSAhPT0gU3RhdGljRHJhd1VzYWdlICkgZGF0YS51c2FnZSA9IHRoaXMudXNhZ2U7CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCi8vCgpjbGFzcyBJbnQ4QnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlzdXBlciggbmV3IEludDhBcnJheSggYXJyYXkgKSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCgl9Cgp9CgpjbGFzcyBVaW50OEJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJc3VwZXIoIG5ldyBVaW50OEFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCn0KCmNsYXNzIFVpbnQ4Q2xhbXBlZEJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJc3VwZXIoIG5ldyBVaW50OENsYW1wZWRBcnJheSggYXJyYXkgKSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCgl9Cgp9CgpjbGFzcyBJbnQxNkJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJc3VwZXIoIG5ldyBJbnQxNkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCn0KCmNsYXNzIFVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJc3VwZXIoIG5ldyBVaW50MTZBcnJheSggYXJyYXkgKSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCgl9Cgp9CgpjbGFzcyBJbnQzMkJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJc3VwZXIoIG5ldyBJbnQzMkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCn0KCmNsYXNzIFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJc3VwZXIoIG5ldyBVaW50MzJBcnJheSggYXJyYXkgKSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCgl9Cgp9CgpjbGFzcyBGbG9hdDE2QnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlzdXBlciggbmV3IFVpbnQxNkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCQl0aGlzLmlzRmxvYXQxNkJ1ZmZlckF0dHJpYnV0ZSA9IHRydWU7CgoJfQoKCWdldFgoIGluZGV4ICkgewoKCQlsZXQgeCA9IGZyb21IYWxmRmxvYXQoIHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSBdICk7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeCA9IGRlbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgoJCXJldHVybiB4OwoKCX0KCglzZXRYKCBpbmRleCwgeCApIHsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgoJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSBdID0gdG9IYWxmRmxvYXQoIHggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldFkoIGluZGV4ICkgewoKCQlsZXQgeSA9IGZyb21IYWxmRmxvYXQoIHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDEgXSApOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHkgPSBkZW5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4geTsKCgl9CgoJc2V0WSggaW5kZXgsIHkgKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAxIF0gPSB0b0hhbGZGbG9hdCggeSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0WiggaW5kZXggKSB7CgoJCWxldCB6ID0gZnJvbUhhbGZGbG9hdCggdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMiBdICk7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeiA9IGRlbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgoJCXJldHVybiB6OwoKCX0KCglzZXRaKCBpbmRleCwgeiApIHsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB6ID0gbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgoJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDIgXSA9IHRvSGFsZkZsb2F0KCB6ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRXKCBpbmRleCApIHsKCgkJbGV0IHcgPSBmcm9tSGFsZkZsb2F0KCB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAzIF0gKTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB3ID0gZGVub3JtYWxpemUoIHcsIHRoaXMuYXJyYXkgKTsKCgkJcmV0dXJuIHc7CgoJfQoKCXNldFcoIGluZGV4LCB3ICkgewoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHcgPSBub3JtYWxpemUoIHcsIHRoaXMuYXJyYXkgKTsKCgkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMyBdID0gdG9IYWxmRmxvYXQoIHcgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFhZKCBpbmRleCwgeCwgeSApIHsKCgkJaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgoJCQl4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgkJCXkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCgkJfQoKCQl0aGlzLmFycmF5WyBpbmRleCArIDAgXSA9IHRvSGFsZkZsb2F0KCB4ICk7CgkJdGhpcy5hcnJheVsgaW5kZXggKyAxIF0gPSB0b0hhbGZGbG9hdCggeSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WFlaKCBpbmRleCwgeCwgeSwgeiApIHsKCgkJaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgoJCQl4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgkJCXkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCQkJeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQl9CgoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0gdG9IYWxmRmxvYXQoIHggKTsKCQl0aGlzLmFycmF5WyBpbmRleCArIDEgXSA9IHRvSGFsZkZsb2F0KCB5ICk7CgkJdGhpcy5hcnJheVsgaW5kZXggKyAyIF0gPSB0b0hhbGZGbG9hdCggeiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WFlaVyggaW5kZXgsIHgsIHksIHosIHcgKSB7CgoJCWluZGV4ICo9IHRoaXMuaXRlbVNpemU7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgewoKCQkJeCA9IG5vcm1hbGl6ZSggeCwgdGhpcy5hcnJheSApOwoJCQl5ID0gbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgkJCXogPSBub3JtYWxpemUoIHosIHRoaXMuYXJyYXkgKTsKCQkJdyA9IG5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQl9CgoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0gdG9IYWxmRmxvYXQoIHggKTsKCQl0aGlzLmFycmF5WyBpbmRleCArIDEgXSA9IHRvSGFsZkZsb2F0KCB5ICk7CgkJdGhpcy5hcnJheVsgaW5kZXggKyAyIF0gPSB0b0hhbGZGbG9hdCggeiApOwoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMyBdID0gdG9IYWxmRmxvYXQoIHcgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKCmNsYXNzIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCXN1cGVyKCBuZXcgRmxvYXQzMkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCn0KCmNsYXNzIEZsb2F0NjRCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCXN1cGVyKCBuZXcgRmxvYXQ2NEFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCn0KCmxldCBfaWQkMiA9IDA7Cgpjb25zdCBfbTEgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9vYmogPSAvKkBfX1BVUkVfXyovIG5ldyBPYmplY3QzRCgpOwpjb25zdCBfb2Zmc2V0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfYm94JDIgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CmNvbnN0IF9ib3hNb3JwaFRhcmdldHMgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CmNvbnN0IF92ZWN0b3IkOCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIEJ1ZmZlckdlb21ldHJ5IGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0J1ZmZlckdlb21ldHJ5ID0gdHJ1ZTsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBfaWQkMiArKyB9ICk7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQl0aGlzLm5hbWUgPSAnJzsKCQl0aGlzLnR5cGUgPSAnQnVmZmVyR2VvbWV0cnknOwoKCQl0aGlzLmluZGV4ID0gbnVsbDsKCQl0aGlzLmF0dHJpYnV0ZXMgPSB7fTsKCgkJdGhpcy5tb3JwaEF0dHJpYnV0ZXMgPSB7fTsKCQl0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gZmFsc2U7CgoJCXRoaXMuZ3JvdXBzID0gW107CgoJCXRoaXMuYm91bmRpbmdCb3ggPSBudWxsOwoJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBudWxsOwoKCQl0aGlzLmRyYXdSYW5nZSA9IHsgc3RhcnQ6IDAsIGNvdW50OiBJbmZpbml0eSB9OwoKCQl0aGlzLnVzZXJEYXRhID0ge307CgoJfQoKCWdldEluZGV4KCkgewoKCQlyZXR1cm4gdGhpcy5pbmRleDsKCgl9CgoJc2V0SW5kZXgoIGluZGV4ICkgewoKCQlpZiAoIEFycmF5LmlzQXJyYXkoIGluZGV4ICkgKSB7CgoJCQl0aGlzLmluZGV4ID0gbmV3ICggYXJyYXlOZWVkc1VpbnQzMiggaW5kZXggKSA/IFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA6IFVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSApKCBpbmRleCwgMSApOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5pbmRleCA9IGluZGV4OwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRBdHRyaWJ1dGUoIG5hbWUgKSB7CgoJCXJldHVybiB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXTsKCgl9CgoJc2V0QXR0cmlidXRlKCBuYW1lLCBhdHRyaWJ1dGUgKSB7CgoJCXRoaXMuYXR0cmlidXRlc1sgbmFtZSBdID0gYXR0cmlidXRlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGVsZXRlQXR0cmlidXRlKCBuYW1lICkgewoKCQlkZWxldGUgdGhpcy5hdHRyaWJ1dGVzWyBuYW1lIF07CgoJCXJldHVybiB0aGlzOwoKCX0KCgloYXNBdHRyaWJ1dGUoIG5hbWUgKSB7CgoJCXJldHVybiB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXSAhPT0gdW5kZWZpbmVkOwoKCX0KCglhZGRHcm91cCggc3RhcnQsIGNvdW50LCBtYXRlcmlhbEluZGV4ID0gMCApIHsKCgkJdGhpcy5ncm91cHMucHVzaCggewoKCQkJc3RhcnQ6IHN0YXJ0LAoJCQljb3VudDogY291bnQsCgkJCW1hdGVyaWFsSW5kZXg6IG1hdGVyaWFsSW5kZXgKCgkJfSApOwoKCX0KCgljbGVhckdyb3VwcygpIHsKCgkJdGhpcy5ncm91cHMgPSBbXTsKCgl9CgoJc2V0RHJhd1JhbmdlKCBzdGFydCwgY291bnQgKSB7CgoJCXRoaXMuZHJhd1JhbmdlLnN0YXJ0ID0gc3RhcnQ7CgkJdGhpcy5kcmF3UmFuZ2UuY291bnQgPSBjb3VudDsKCgl9CgoJYXBwbHlNYXRyaXg0KCBtYXRyaXggKSB7CgoJCWNvbnN0IHBvc2l0aW9uID0gdGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQlpZiAoIHBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQlwb3NpdGlvbi5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKCQkJcG9zaXRpb24ubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9CgoJCWNvbnN0IG5vcm1hbCA9IHRoaXMuYXR0cmlidXRlcy5ub3JtYWw7CgoJCWlmICggbm9ybWFsICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBub3JtYWxNYXRyaXggPSBuZXcgTWF0cml4MygpLmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CgoJCQlub3JtYWwuYXBwbHlOb3JtYWxNYXRyaXgoIG5vcm1hbE1hdHJpeCApOwoKCQkJbm9ybWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJfQoKCQljb25zdCB0YW5nZW50ID0gdGhpcy5hdHRyaWJ1dGVzLnRhbmdlbnQ7CgoJCWlmICggdGFuZ2VudCAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGFuZ2VudC50cmFuc2Zvcm1EaXJlY3Rpb24oIG1hdHJpeCApOwoKCQkJdGFuZ2VudC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKCQkJdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKTsKCgkJfQoKCQlpZiAoIHRoaXMuYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB7CgoJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcHBseVF1YXRlcm5pb24oIHEgKSB7CgoJCV9tMS5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbiggcSApOwoKCQl0aGlzLmFwcGx5TWF0cml4NCggX20xICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyb3RhdGVYKCBhbmdsZSApIHsKCgkJLy8gcm90YXRlIGdlb21ldHJ5IGFyb3VuZCB3b3JsZCB4LWF4aXMKCgkJX20xLm1ha2VSb3RhdGlvblgoIGFuZ2xlICk7CgoJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJvdGF0ZVkoIGFuZ2xlICkgewoKCQkvLyByb3RhdGUgZ2VvbWV0cnkgYXJvdW5kIHdvcmxkIHktYXhpcwoKCQlfbTEubWFrZVJvdGF0aW9uWSggYW5nbGUgKTsKCgkJdGhpcy5hcHBseU1hdHJpeDQoIF9tMSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm90YXRlWiggYW5nbGUgKSB7CgoJCS8vIHJvdGF0ZSBnZW9tZXRyeSBhcm91bmQgd29ybGQgei1heGlzCgoJCV9tMS5tYWtlUm90YXRpb25aKCBhbmdsZSApOwoKCQl0aGlzLmFwcGx5TWF0cml4NCggX20xICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0cmFuc2xhdGUoIHgsIHksIHogKSB7CgoJCS8vIHRyYW5zbGF0ZSBnZW9tZXRyeQoKCQlfbTEubWFrZVRyYW5zbGF0aW9uKCB4LCB5LCB6ICk7CgoJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNjYWxlKCB4LCB5LCB6ICkgewoKCQkvLyBzY2FsZSBnZW9tZXRyeQoKCQlfbTEubWFrZVNjYWxlKCB4LCB5LCB6ICk7CgoJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWxvb2tBdCggdmVjdG9yICkgewoKCQlfb2JqLmxvb2tBdCggdmVjdG9yICk7CgoJCV9vYmoudXBkYXRlTWF0cml4KCk7CgoJCXRoaXMuYXBwbHlNYXRyaXg0KCBfb2JqLm1hdHJpeCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2VudGVyKCkgewoKCQl0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQl0aGlzLmJvdW5kaW5nQm94LmdldENlbnRlciggX29mZnNldCApLm5lZ2F0ZSgpOwoKCQl0aGlzLnRyYW5zbGF0ZSggX29mZnNldC54LCBfb2Zmc2V0LnksIF9vZmZzZXQueiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbVBvaW50cyggcG9pbnRzICkgewoKCQljb25zdCBwb3NpdGlvbiA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBwb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHBvaW50ID0gcG9pbnRzWyBpIF07CgkJCXBvc2l0aW9uLnB1c2goIHBvaW50LngsIHBvaW50LnksIHBvaW50LnogfHwgMCApOwoKCQl9CgoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIDMgKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29tcHV0ZUJvdW5kaW5nQm94KCkgewoKCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQl0aGlzLmJvdW5kaW5nQm94ID0gbmV3IEJveDMoKTsKCgkJfQoKCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQljb25zdCBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbiA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQlpZiAoIHBvc2l0aW9uICYmIHBvc2l0aW9uLmlzR0xCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk6IEdMQnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIGEgbWFudWFsIGJvdW5kaW5nIGJveC4gQWx0ZXJuYXRpdmVseSBzZXQgIm1lc2guZnJ1c3R1bUN1bGxlZCIgdG8gImZhbHNlIi4nLCB0aGlzICk7CgoJCQl0aGlzLmJvdW5kaW5nQm94LnNldCgKCQkJCW5ldyBWZWN0b3IzKCAtIEluZmluaXR5LCAtIEluZmluaXR5LCAtIEluZmluaXR5ICksCgkJCQluZXcgVmVjdG9yMyggKyBJbmZpbml0eSwgKyBJbmZpbml0eSwgKyBJbmZpbml0eSApCgkJCSk7CgoJCQlyZXR1cm47CgoJCX0KCgkJaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5ib3VuZGluZ0JveC5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiApOwoKCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCgkJCWlmICggbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CgkJCQkJX2JveCQyLnNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoQXR0cmlidXRlICk7CgoJCQkJCWlmICggdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSApIHsKCgkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCB0aGlzLmJvdW5kaW5nQm94Lm1pbiwgX2JveCQyLm1pbiApOwoJCQkJCQl0aGlzLmJvdW5kaW5nQm94LmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkOCApOwoKCQkJCQkJX3ZlY3RvciQ4LmFkZFZlY3RvcnMoIHRoaXMuYm91bmRpbmdCb3gubWF4LCBfYm94JDIubWF4ICk7CgkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX3ZlY3RvciQ4ICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl0aGlzLmJvdW5kaW5nQm94LmV4cGFuZEJ5UG9pbnQoIF9ib3gkMi5taW4gKTsKCQkJCQkJdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KCBfYm94JDIubWF4ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQl0aGlzLmJvdW5kaW5nQm94Lm1ha2VFbXB0eSgpOwoKCQl9CgoJCWlmICggaXNOYU4oIHRoaXMuYm91bmRpbmdCb3gubWluLnggKSB8fCBpc05hTiggdGhpcy5ib3VuZGluZ0JveC5taW4ueSApIHx8IGlzTmFOKCB0aGlzLmJvdW5kaW5nQm94Lm1pbi56ICkgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk6IENvbXB1dGVkIG1pbi9tYXggaGF2ZSBOYU4gdmFsdWVzLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLCB0aGlzICk7CgoJCX0KCgl9CgoJY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCkgewoKCQlpZiAoIHRoaXMuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSB7CgoJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gbmV3IFNwaGVyZSgpOwoKCQl9CgoJCWNvbnN0IHBvc2l0aW9uID0gdGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCWNvbnN0IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uID0gdGhpcy5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CgoJCWlmICggcG9zaXRpb24gJiYgcG9zaXRpb24uaXNHTEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTogR0xCdWZmZXJBdHRyaWJ1dGUgcmVxdWlyZXMgYSBtYW51YWwgYm91bmRpbmcgc3BoZXJlLiBBbHRlcm5hdGl2ZWx5IHNldCAibWVzaC5mcnVzdHVtQ3VsbGVkIiB0byAiZmFsc2UiLicsIHRoaXMgKTsKCgkJCXRoaXMuYm91bmRpbmdTcGhlcmUuc2V0KCBuZXcgVmVjdG9yMygpLCBJbmZpbml0eSApOwoKCQkJcmV0dXJuOwoKCQl9CgoJCWlmICggcG9zaXRpb24gKSB7CgoJCQkvLyBmaXJzdCwgZmluZCB0aGUgY2VudGVyIG9mIHRoZSBib3VuZGluZyBzcGhlcmUKCgkJCWNvbnN0IGNlbnRlciA9IHRoaXMuYm91bmRpbmdTcGhlcmUuY2VudGVyOwoKCQkJX2JveCQyLnNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uICk7CgoJCQkvLyBwcm9jZXNzIG1vcnBoIGF0dHJpYnV0ZXMgaWYgcHJlc2VudAoKCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbiApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb25bIGkgXTsKCQkJCQlfYm94TW9ycGhUYXJnZXRzLnNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoQXR0cmlidXRlICk7CgoJCQkJCWlmICggdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSApIHsKCgkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCBfYm94JDIubWluLCBfYm94TW9ycGhUYXJnZXRzLm1pbiApOwoJCQkJCQlfYm94JDIuZXhwYW5kQnlQb2ludCggX3ZlY3RvciQ4ICk7CgoJCQkJCQlfdmVjdG9yJDguYWRkVmVjdG9ycyggX2JveCQyLm1heCwgX2JveE1vcnBoVGFyZ2V0cy5tYXggKTsKCQkJCQkJX2JveCQyLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkOCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJX2JveCQyLmV4cGFuZEJ5UG9pbnQoIF9ib3hNb3JwaFRhcmdldHMubWluICk7CgkJCQkJCV9ib3gkMi5leHBhbmRCeVBvaW50KCBfYm94TW9ycGhUYXJnZXRzLm1heCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJX2JveCQyLmdldENlbnRlciggY2VudGVyICk7CgoJCQkvLyBzZWNvbmQsIHRyeSB0byBmaW5kIGEgYm91bmRpbmdTcGhlcmUgd2l0aCBhIHJhZGl1cyBzbWFsbGVyIHRoYW4gdGhlCgkJCS8vIGJvdW5kaW5nU3BoZXJlIG9mIHRoZSBib3VuZGluZ0JveDogc3FydCgzKSBzbWFsbGVyIGluIHRoZSBiZXN0IGNhc2UKCgkJCWxldCBtYXhSYWRpdXNTcSA9IDA7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gcG9zaXRpb24uY291bnQ7IGkgPCBpbDsgaSArKyApIHsKCgkJCQlfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGkgKTsKCgkJCQltYXhSYWRpdXNTcSA9IE1hdGgubWF4KCBtYXhSYWRpdXNTcSwgY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKCBfdmVjdG9yJDggKSApOwoKCQkJfQoKCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCgkJCWlmICggbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CgkJCQkJY29uc3QgbW9ycGhUYXJnZXRzUmVsYXRpdmUgPSB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwoKCQkJCQlmb3IgKCBsZXQgaiA9IDAsIGpsID0gbW9ycGhBdHRyaWJ1dGUuY291bnQ7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJCV92ZWN0b3IkOC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSwgaiApOwoKCQkJCQkJaWYgKCBtb3JwaFRhcmdldHNSZWxhdGl2ZSApIHsKCgkJCQkJCQlfb2Zmc2V0LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBqICk7CgkJCQkJCQlfdmVjdG9yJDguYWRkKCBfb2Zmc2V0ICk7CgoJCQkJCQl9CgoJCQkJCQltYXhSYWRpdXNTcSA9IE1hdGgubWF4KCBtYXhSYWRpdXNTcSwgY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKCBfdmVjdG9yJDggKSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgoJCQlpZiAoIGlzTmFOKCB0aGlzLmJvdW5kaW5nU3BoZXJlLnJhZGl1cyApICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTogQ29tcHV0ZWQgcmFkaXVzIGlzIE5hTi4gVGhlICJwb3NpdGlvbiIgYXR0cmlidXRlIGlzIGxpa2VseSB0byBoYXZlIE5hTiB2YWx1ZXMuJywgdGhpcyApOwoKCQkJfQoKCQl9CgoJfQoKCWNvbXB1dGVUYW5nZW50cygpIHsKCgkJY29uc3QgaW5kZXggPSB0aGlzLmluZGV4OwoJCWNvbnN0IGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgoJCS8vIGJhc2VkIG9uIGh0dHA6Ly93d3cudGVyYXRob24uY29tL2NvZGUvdGFuZ2VudC5odG1sCgkJLy8gKHBlciB2ZXJ0ZXggdGFuZ2VudHMpCgoJCWlmICggaW5kZXggPT09IG51bGwgfHwKCQkJIGF0dHJpYnV0ZXMucG9zaXRpb24gPT09IHVuZGVmaW5lZCB8fAoJCQkgYXR0cmlidXRlcy5ub3JtYWwgPT09IHVuZGVmaW5lZCB8fAoJCQkgYXR0cmlidXRlcy51diA9PT0gdW5kZWZpbmVkICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuY29tcHV0ZVRhbmdlbnRzKCkgZmFpbGVkLiBNaXNzaW5nIHJlcXVpcmVkIGF0dHJpYnV0ZXMgKGluZGV4LCBwb3NpdGlvbiwgbm9ybWFsIG9yIHV2KScgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCWNvbnN0IGluZGljZXMgPSBpbmRleC5hcnJheTsKCQljb25zdCBwb3NpdGlvbnMgPSBhdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5OwoJCWNvbnN0IG5vcm1hbHMgPSBhdHRyaWJ1dGVzLm5vcm1hbC5hcnJheTsKCQljb25zdCB1dnMgPSBhdHRyaWJ1dGVzLnV2LmFycmF5OwoKCQljb25zdCBuVmVydGljZXMgPSBwb3NpdGlvbnMubGVuZ3RoIC8gMzsKCgkJaWYgKCB0aGlzLmhhc0F0dHJpYnV0ZSggJ3RhbmdlbnQnICkgPT09IGZhbHNlICkgewoKCQkJdGhpcy5zZXRBdHRyaWJ1dGUoICd0YW5nZW50JywgbmV3IEJ1ZmZlckF0dHJpYnV0ZSggbmV3IEZsb2F0MzJBcnJheSggNCAqIG5WZXJ0aWNlcyApLCA0ICkgKTsKCgkJfQoKCQljb25zdCB0YW5nZW50cyA9IHRoaXMuZ2V0QXR0cmlidXRlKCAndGFuZ2VudCcgKS5hcnJheTsKCgkJY29uc3QgdGFuMSA9IFtdLCB0YW4yID0gW107CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IG5WZXJ0aWNlczsgaSArKyApIHsKCgkJCXRhbjFbIGkgXSA9IG5ldyBWZWN0b3IzKCk7CgkJCXRhbjJbIGkgXSA9IG5ldyBWZWN0b3IzKCk7CgoJCX0KCgkJY29uc3QgdkEgPSBuZXcgVmVjdG9yMygpLAoJCQl2QiA9IG5ldyBWZWN0b3IzKCksCgkJCXZDID0gbmV3IFZlY3RvcjMoKSwKCgkJCXV2QSA9IG5ldyBWZWN0b3IyKCksCgkJCXV2QiA9IG5ldyBWZWN0b3IyKCksCgkJCXV2QyA9IG5ldyBWZWN0b3IyKCksCgoJCQlzZGlyID0gbmV3IFZlY3RvcjMoKSwKCQkJdGRpciA9IG5ldyBWZWN0b3IzKCk7CgoJCWZ1bmN0aW9uIGhhbmRsZVRyaWFuZ2xlKCBhLCBiLCBjICkgewoKCQkJdkEuZnJvbUFycmF5KCBwb3NpdGlvbnMsIGEgKiAzICk7CgkJCXZCLmZyb21BcnJheSggcG9zaXRpb25zLCBiICogMyApOwoJCQl2Qy5mcm9tQXJyYXkoIHBvc2l0aW9ucywgYyAqIDMgKTsKCgkJCXV2QS5mcm9tQXJyYXkoIHV2cywgYSAqIDIgKTsKCQkJdXZCLmZyb21BcnJheSggdXZzLCBiICogMiApOwoJCQl1dkMuZnJvbUFycmF5KCB1dnMsIGMgKiAyICk7CgoJCQl2Qi5zdWIoIHZBICk7CgkJCXZDLnN1YiggdkEgKTsKCgkJCXV2Qi5zdWIoIHV2QSApOwoJCQl1dkMuc3ViKCB1dkEgKTsKCgkJCWNvbnN0IHIgPSAxLjAgLyAoIHV2Qi54ICogdXZDLnkgLSB1dkMueCAqIHV2Qi55ICk7CgoJCQkvLyBzaWxlbnRseSBpZ25vcmUgZGVnZW5lcmF0ZSB1diB0cmlhbmdsZXMgaGF2aW5nIGNvaW5jaWRlbnQgb3IgY29saW5lYXIgdmVydGljZXMKCgkJCWlmICggISBpc0Zpbml0ZSggciApICkgcmV0dXJuOwoKCQkJc2Rpci5jb3B5KCB2QiApLm11bHRpcGx5U2NhbGFyKCB1dkMueSApLmFkZFNjYWxlZFZlY3RvciggdkMsIC0gdXZCLnkgKS5tdWx0aXBseVNjYWxhciggciApOwoJCQl0ZGlyLmNvcHkoIHZDICkubXVsdGlwbHlTY2FsYXIoIHV2Qi54ICkuYWRkU2NhbGVkVmVjdG9yKCB2QiwgLSB1dkMueCApLm11bHRpcGx5U2NhbGFyKCByICk7CgoJCQl0YW4xWyBhIF0uYWRkKCBzZGlyICk7CgkJCXRhbjFbIGIgXS5hZGQoIHNkaXIgKTsKCQkJdGFuMVsgYyBdLmFkZCggc2RpciApOwoKCQkJdGFuMlsgYSBdLmFkZCggdGRpciApOwoJCQl0YW4yWyBiIF0uYWRkKCB0ZGlyICk7CgkJCXRhbjJbIGMgXS5hZGQoIHRkaXIgKTsKCgkJfQoKCQlsZXQgZ3JvdXBzID0gdGhpcy5ncm91cHM7CgoJCWlmICggZ3JvdXBzLmxlbmd0aCA9PT0gMCApIHsKCgkJCWdyb3VwcyA9IFsgewoJCQkJc3RhcnQ6IDAsCgkJCQljb3VudDogaW5kaWNlcy5sZW5ndGgKCQkJfSBdOwoKCQl9CgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBncm91cHMubGVuZ3RoOyBpIDwgaWw7ICsrIGkgKSB7CgoJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwoKCQkJY29uc3Qgc3RhcnQgPSBncm91cC5zdGFydDsKCQkJY29uc3QgY291bnQgPSBncm91cC5jb3VudDsKCgkJCWZvciAoIGxldCBqID0gc3RhcnQsIGpsID0gc3RhcnQgKyBjb3VudDsgaiA8IGpsOyBqICs9IDMgKSB7CgoJCQkJaGFuZGxlVHJpYW5nbGUoCgkJCQkJaW5kaWNlc1sgaiArIDAgXSwKCQkJCQlpbmRpY2VzWyBqICsgMSBdLAoJCQkJCWluZGljZXNbIGogKyAyIF0KCQkJCSk7CgoJCQl9CgoJCX0KCgkJY29uc3QgdG1wID0gbmV3IFZlY3RvcjMoKSwgdG1wMiA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3QgbiA9IG5ldyBWZWN0b3IzKCksIG4yID0gbmV3IFZlY3RvcjMoKTsKCgkJZnVuY3Rpb24gaGFuZGxlVmVydGV4KCB2ICkgewoKCQkJbi5mcm9tQXJyYXkoIG5vcm1hbHMsIHYgKiAzICk7CgkJCW4yLmNvcHkoIG4gKTsKCgkJCWNvbnN0IHQgPSB0YW4xWyB2IF07CgoJCQkvLyBHcmFtLVNjaG1pZHQgb3J0aG9nb25hbGl6ZQoKCQkJdG1wLmNvcHkoIHQgKTsKCQkJdG1wLnN1Yiggbi5tdWx0aXBseVNjYWxhciggbi5kb3QoIHQgKSApICkubm9ybWFsaXplKCk7CgoJCQkvLyBDYWxjdWxhdGUgaGFuZGVkbmVzcwoKCQkJdG1wMi5jcm9zc1ZlY3RvcnMoIG4yLCB0ICk7CgkJCWNvbnN0IHRlc3QgPSB0bXAyLmRvdCggdGFuMlsgdiBdICk7CgkJCWNvbnN0IHcgPSAoIHRlc3QgPCAwLjAgKSA/IC0gMS4wIDogMS4wOwoKCQkJdGFuZ2VudHNbIHYgKiA0IF0gPSB0bXAueDsKCQkJdGFuZ2VudHNbIHYgKiA0ICsgMSBdID0gdG1wLnk7CgkJCXRhbmdlbnRzWyB2ICogNCArIDIgXSA9IHRtcC56OwoJCQl0YW5nZW50c1sgdiAqIDQgKyAzIF0gPSB3OwoKCQl9CgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBncm91cHMubGVuZ3RoOyBpIDwgaWw7ICsrIGkgKSB7CgoJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwoKCQkJY29uc3Qgc3RhcnQgPSBncm91cC5zdGFydDsKCQkJY29uc3QgY291bnQgPSBncm91cC5jb3VudDsKCgkJCWZvciAoIGxldCBqID0gc3RhcnQsIGpsID0gc3RhcnQgKyBjb3VudDsgaiA8IGpsOyBqICs9IDMgKSB7CgoJCQkJaGFuZGxlVmVydGV4KCBpbmRpY2VzWyBqICsgMCBdICk7CgkJCQloYW5kbGVWZXJ0ZXgoIGluZGljZXNbIGogKyAxIF0gKTsKCQkJCWhhbmRsZVZlcnRleCggaW5kaWNlc1sgaiArIDIgXSApOwoKCQkJfQoKCQl9CgoJfQoKCWNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCkgewoKCQljb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7CgkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSB0aGlzLmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKCQlpZiAoIHBvc2l0aW9uQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlsZXQgbm9ybWFsQXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdub3JtYWwnICk7CgoJCQlpZiAoIG5vcm1hbEF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCW5vcm1hbEF0dHJpYnV0ZSA9IG5ldyBCdWZmZXJBdHRyaWJ1dGUoIG5ldyBGbG9hdDMyQXJyYXkoIHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICogMyApLCAzICk7CgkJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5vcm1hbEF0dHJpYnV0ZSApOwoKCQkJfSBlbHNlIHsKCgkJCQkvLyByZXNldCBleGlzdGluZyBub3JtYWxzIHRvIHplcm8KCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbm9ybWFsQXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCW5vcm1hbEF0dHJpYnV0ZS5zZXRYWVooIGksIDAsIDAsIDAgKTsKCgkJCQl9CgoJCQl9CgoJCQljb25zdCBwQSA9IG5ldyBWZWN0b3IzKCksIHBCID0gbmV3IFZlY3RvcjMoKSwgcEMgPSBuZXcgVmVjdG9yMygpOwoJCQljb25zdCBuQSA9IG5ldyBWZWN0b3IzKCksIG5CID0gbmV3IFZlY3RvcjMoKSwgbkMgPSBuZXcgVmVjdG9yMygpOwoJCQljb25zdCBjYiA9IG5ldyBWZWN0b3IzKCksIGFiID0gbmV3IFZlY3RvcjMoKTsKCgkJCS8vIGluZGV4ZWQgZWxlbWVudHMKCgkJCWlmICggaW5kZXggKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGluZGV4LmNvdW50OyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQkJY29uc3QgdkEgPSBpbmRleC5nZXRYKCBpICsgMCApOwoJCQkJCWNvbnN0IHZCID0gaW5kZXguZ2V0WCggaSArIDEgKTsKCQkJCQljb25zdCB2QyA9IGluZGV4LmdldFgoIGkgKyAyICk7CgoJCQkJCXBBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCB2QSApOwoJCQkJCXBCLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCB2QiApOwoJCQkJCXBDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCB2QyApOwoKCQkJCQljYi5zdWJWZWN0b3JzKCBwQywgcEIgKTsKCQkJCQlhYi5zdWJWZWN0b3JzKCBwQSwgcEIgKTsKCQkJCQljYi5jcm9zcyggYWIgKTsKCgkJCQkJbkEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsQXR0cmlidXRlLCB2QSApOwoJCQkJCW5CLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbEF0dHJpYnV0ZSwgdkIgKTsKCQkJCQluQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBdHRyaWJ1dGUsIHZDICk7CgoJCQkJCW5BLmFkZCggY2IgKTsKCQkJCQluQi5hZGQoIGNiICk7CgkJCQkJbkMuYWRkKCBjYiApOwoKCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCB2QSwgbkEueCwgbkEueSwgbkEueiApOwoJCQkJCW5vcm1hbEF0dHJpYnV0ZS5zZXRYWVooIHZCLCBuQi54LCBuQi55LCBuQi56ICk7CgkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkMsIG5DLngsIG5DLnksIG5DLnogKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCS8vIG5vbi1pbmRleGVkIGVsZW1lbnRzICh1bmNvbm5lY3RlZCB0cmlhbmdsZSBzb3VwKQoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudDsgaSA8IGlsOyBpICs9IDMgKSB7CgoJCQkJCXBBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMCApOwoJCQkJCXBCLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMSApOwoJCQkJCXBDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMiApOwoKCQkJCQljYi5zdWJWZWN0b3JzKCBwQywgcEIgKTsKCQkJCQlhYi5zdWJWZWN0b3JzKCBwQSwgcEIgKTsKCQkJCQljYi5jcm9zcyggYWIgKTsKCgkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggaSArIDAsIGNiLngsIGNiLnksIGNiLnogKTsKCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMSwgY2IueCwgY2IueSwgY2IueiApOwoJCQkJCW5vcm1hbEF0dHJpYnV0ZS5zZXRYWVooIGkgKyAyLCBjYi54LCBjYi55LCBjYi56ICk7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5ub3JtYWxpemVOb3JtYWxzKCk7CgoJCQlub3JtYWxBdHRyaWJ1dGUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9CgoJfQoKCW5vcm1hbGl6ZU5vcm1hbHMoKSB7CgoJCWNvbnN0IG5vcm1hbHMgPSB0aGlzLmF0dHJpYnV0ZXMubm9ybWFsOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbm9ybWFscy5jb3VudDsgaSA8IGlsOyBpICsrICkgewoKCQkJX3ZlY3RvciQ4LmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIGkgKTsKCgkJCV92ZWN0b3IkOC5ub3JtYWxpemUoKTsKCgkJCW5vcm1hbHMuc2V0WFlaKCBpLCBfdmVjdG9yJDgueCwgX3ZlY3RvciQ4LnksIF92ZWN0b3IkOC56ICk7CgoJCX0KCgl9CgoJdG9Ob25JbmRleGVkKCkgewoKCQlmdW5jdGlvbiBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKSB7CgoJCQljb25zdCBhcnJheSA9IGF0dHJpYnV0ZS5hcnJheTsKCQkJY29uc3QgaXRlbVNpemUgPSBhdHRyaWJ1dGUuaXRlbVNpemU7CgkJCWNvbnN0IG5vcm1hbGl6ZWQgPSBhdHRyaWJ1dGUubm9ybWFsaXplZDsKCgkJCWNvbnN0IGFycmF5MiA9IG5ldyBhcnJheS5jb25zdHJ1Y3RvciggaW5kaWNlcy5sZW5ndGggKiBpdGVtU2l6ZSApOwoKCQkJbGV0IGluZGV4ID0gMCwgaW5kZXgyID0gMDsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGluZGljZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQlpZiAoIGF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlICkgewoKCQkJCQlpbmRleCA9IGluZGljZXNbIGkgXSAqIGF0dHJpYnV0ZS5kYXRhLnN0cmlkZSArIGF0dHJpYnV0ZS5vZmZzZXQ7CgoJCQkJfSBlbHNlIHsKCgkJCQkJaW5kZXggPSBpbmRpY2VzWyBpIF0gKiBpdGVtU2l6ZTsKCgkJCQl9CgoJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgaXRlbVNpemU7IGogKysgKSB7CgoJCQkJCWFycmF5MlsgaW5kZXgyICsrIF0gPSBhcnJheVsgaW5kZXggKysgXTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gbmV3IEJ1ZmZlckF0dHJpYnV0ZSggYXJyYXkyLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCQl9CgoJCS8vCgoJCWlmICggdGhpcy5pbmRleCA9PT0gbnVsbCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LnRvTm9uSW5kZXhlZCgpOiBCdWZmZXJHZW9tZXRyeSBpcyBhbHJlYWR5IG5vbi1pbmRleGVkLicgKTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJY29uc3QgZ2VvbWV0cnkyID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgoJCWNvbnN0IGluZGljZXMgPSB0aGlzLmluZGV4LmFycmF5OwoJCWNvbnN0IGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgoJCS8vIGF0dHJpYnV0ZXMKCgkJZm9yICggY29uc3QgbmFtZSBpbiBhdHRyaWJ1dGVzICkgewoKCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJY29uc3QgbmV3QXR0cmlidXRlID0gY29udmVydEJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRpY2VzICk7CgoJCQlnZW9tZXRyeTIuc2V0QXR0cmlidXRlKCBuYW1lLCBuZXdBdHRyaWJ1dGUgKTsKCgkJfQoKCQkvLyBtb3JwaCBhdHRyaWJ1dGVzCgoJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzOwoKCQlmb3IgKCBjb25zdCBuYW1lIGluIG1vcnBoQXR0cmlidXRlcyApIHsKCgkJCWNvbnN0IG1vcnBoQXJyYXkgPSBbXTsKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXTsgLy8gbW9ycGhBdHRyaWJ1dGU6IGFycmF5IG9mIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGVzCgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgYXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVbIGkgXTsKCgkJCQljb25zdCBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKTsKCgkJCQltb3JwaEFycmF5LnB1c2goIG5ld0F0dHJpYnV0ZSApOwoKCQkJfQoKCQkJZ2VvbWV0cnkyLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gbW9ycGhBcnJheTsKCgkJfQoKCQlnZW9tZXRyeTIubW9ycGhUYXJnZXRzUmVsYXRpdmUgPSB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwoKCQkvLyBncm91cHMKCgkJY29uc3QgZ3JvdXBzID0gdGhpcy5ncm91cHM7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJZ2VvbWV0cnkyLmFkZEdyb3VwKCBncm91cC5zdGFydCwgZ3JvdXAuY291bnQsIGdyb3VwLm1hdGVyaWFsSW5kZXggKTsKCgkJfQoKCQlyZXR1cm4gZ2VvbWV0cnkyOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSB7CgkJCW1ldGFkYXRhOiB7CgkJCQl2ZXJzaW9uOiA0LjYsCgkJCQl0eXBlOiAnQnVmZmVyR2VvbWV0cnknLAoJCQkJZ2VuZXJhdG9yOiAnQnVmZmVyR2VvbWV0cnkudG9KU09OJwoJCQl9CgkJfTsKCgkJLy8gc3RhbmRhcmQgQnVmZmVyR2VvbWV0cnkgc2VyaWFsaXphdGlvbgoKCQlkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CgkJZGF0YS50eXBlID0gdGhpcy50eXBlOwoJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIGRhdGEubmFtZSA9IHRoaXMubmFtZTsKCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLnVzZXJEYXRhICkubGVuZ3RoID4gMCApIGRhdGEudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKCQlpZiAoIHRoaXMucGFyYW1ldGVycyAhPT0gdW5kZWZpbmVkICkgewoKCQkJY29uc3QgcGFyYW1ldGVycyA9IHRoaXMucGFyYW1ldGVyczsKCgkJCWZvciAoIGNvbnN0IGtleSBpbiBwYXJhbWV0ZXJzICkgewoKCQkJCWlmICggcGFyYW1ldGVyc1sga2V5IF0gIT09IHVuZGVmaW5lZCApIGRhdGFbIGtleSBdID0gcGFyYW1ldGVyc1sga2V5IF07CgoJCQl9CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCQkvLyBmb3Igc2ltcGxpY2l0eSB0aGUgY29kZSBhc3N1bWVzIGF0dHJpYnV0ZXMgYXJlIG5vdCBzaGFyZWQgYWNyb3NzIGdlb21ldHJpZXMsIHNlZSAjMTU4MTEKCgkJZGF0YS5kYXRhID0geyBhdHRyaWJ1dGVzOiB7fSB9OwoKCQljb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7CgoJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQlkYXRhLmRhdGEuaW5kZXggPSB7CgkJCQl0eXBlOiBpbmRleC5hcnJheS5jb25zdHJ1Y3Rvci5uYW1lLAoJCQkJYXJyYXk6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBpbmRleC5hcnJheSApCgkJCX07CgoJCX0KCgkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCgkJZm9yICggY29uc3Qga2V5IGluIGF0dHJpYnV0ZXMgKSB7CgoJCQljb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBrZXkgXTsKCgkJCWRhdGEuZGF0YS5hdHRyaWJ1dGVzWyBrZXkgXSA9IGF0dHJpYnV0ZS50b0pTT04oIGRhdGEuZGF0YSApOwoKCQl9CgoJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IHt9OwoJCWxldCBoYXNNb3JwaEF0dHJpYnV0ZXMgPSBmYWxzZTsKCgkJZm9yICggY29uc3Qga2V5IGluIHRoaXMubW9ycGhBdHRyaWJ1dGVzICkgewoKCQkJY29uc3QgYXR0cmlidXRlQXJyYXkgPSB0aGlzLm1vcnBoQXR0cmlidXRlc1sga2V5IF07CgoJCQljb25zdCBhcnJheSA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGF0dHJpYnV0ZUFycmF5Lmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZUFycmF5WyBpIF07CgoJCQkJYXJyYXkucHVzaCggYXR0cmlidXRlLnRvSlNPTiggZGF0YS5kYXRhICkgKTsKCgkJCX0KCgkJCWlmICggYXJyYXkubGVuZ3RoID4gMCApIHsKCgkJCQltb3JwaEF0dHJpYnV0ZXNbIGtleSBdID0gYXJyYXk7CgoJCQkJaGFzTW9ycGhBdHRyaWJ1dGVzID0gdHJ1ZTsKCgkJCX0KCgkJfQoKCQlpZiAoIGhhc01vcnBoQXR0cmlidXRlcyApIHsKCgkJCWRhdGEuZGF0YS5tb3JwaEF0dHJpYnV0ZXMgPSBtb3JwaEF0dHJpYnV0ZXM7CgkJCWRhdGEuZGF0YS5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgoJCX0KCgkJY29uc3QgZ3JvdXBzID0gdGhpcy5ncm91cHM7CgoJCWlmICggZ3JvdXBzLmxlbmd0aCA+IDAgKSB7CgoJCQlkYXRhLmRhdGEuZ3JvdXBzID0gSlNPTi5wYXJzZSggSlNPTi5zdHJpbmdpZnkoIGdyb3VwcyApICk7CgoJCX0KCgkJY29uc3QgYm91bmRpbmdTcGhlcmUgPSB0aGlzLmJvdW5kaW5nU3BoZXJlOwoKCQlpZiAoIGJvdW5kaW5nU3BoZXJlICE9PSBudWxsICkgewoKCQkJZGF0YS5kYXRhLmJvdW5kaW5nU3BoZXJlID0gewoJCQkJY2VudGVyOiBib3VuZGluZ1NwaGVyZS5jZW50ZXIudG9BcnJheSgpLAoJCQkJcmFkaXVzOiBib3VuZGluZ1NwaGVyZS5yYWRpdXMKCQkJfTsKCgkJfQoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQkvLyByZXNldAoKCQl0aGlzLmluZGV4ID0gbnVsbDsKCQl0aGlzLmF0dHJpYnV0ZXMgPSB7fTsKCQl0aGlzLm1vcnBoQXR0cmlidXRlcyA9IHt9OwoJCXRoaXMuZ3JvdXBzID0gW107CgkJdGhpcy5ib3VuZGluZ0JveCA9IG51bGw7CgkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCS8vIHVzZWQgZm9yIHN0b3JpbmcgY2xvbmVkLCBzaGFyZWQgZGF0YQoKCQljb25zdCBkYXRhID0ge307CgoJCS8vIG5hbWUKCgkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgoJCS8vIGluZGV4CgoJCWNvbnN0IGluZGV4ID0gc291cmNlLmluZGV4OwoKCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJdGhpcy5zZXRJbmRleCggaW5kZXguY2xvbmUoIGRhdGEgKSApOwoKCQl9CgoJCS8vIGF0dHJpYnV0ZXMKCgkJY29uc3QgYXR0cmlidXRlcyA9IHNvdXJjZS5hdHRyaWJ1dGVzOwoKCQlmb3IgKCBjb25zdCBuYW1lIGluIGF0dHJpYnV0ZXMgKSB7CgoJCQljb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBuYW1lIF07CgkJCXRoaXMuc2V0QXR0cmlidXRlKCBuYW1lLCBhdHRyaWJ1dGUuY2xvbmUoIGRhdGEgKSApOwoKCQl9CgoJCS8vIG1vcnBoIGF0dHJpYnV0ZXMKCgkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gc291cmNlLm1vcnBoQXR0cmlidXRlczsKCgkJZm9yICggY29uc3QgbmFtZSBpbiBtb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQljb25zdCBhcnJheSA9IFtdOwoJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1sgbmFtZSBdOyAvLyBtb3JwaEF0dHJpYnV0ZTogYXJyYXkgb2YgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZXMKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJYXJyYXkucHVzaCggbW9ycGhBdHRyaWJ1dGVbIGkgXS5jbG9uZSggZGF0YSApICk7CgoJCQl9CgoJCQl0aGlzLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gYXJyYXk7CgoJCX0KCgkJdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHNvdXJjZS5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCgkJLy8gZ3JvdXBzCgoJCWNvbnN0IGdyb3VwcyA9IHNvdXJjZS5ncm91cHM7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJdGhpcy5hZGRHcm91cCggZ3JvdXAuc3RhcnQsIGdyb3VwLmNvdW50LCBncm91cC5tYXRlcmlhbEluZGV4ICk7CgoJCX0KCgkJLy8gYm91bmRpbmcgYm94CgoJCWNvbnN0IGJvdW5kaW5nQm94ID0gc291cmNlLmJvdW5kaW5nQm94OwoKCQlpZiAoIGJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKCQkJdGhpcy5ib3VuZGluZ0JveCA9IGJvdW5kaW5nQm94LmNsb25lKCk7CgoJCX0KCgkJLy8gYm91bmRpbmcgc3BoZXJlCgoJCWNvbnN0IGJvdW5kaW5nU3BoZXJlID0gc291cmNlLmJvdW5kaW5nU3BoZXJlOwoKCQlpZiAoIGJvdW5kaW5nU3BoZXJlICE9PSBudWxsICkgewoKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IGJvdW5kaW5nU3BoZXJlLmNsb25lKCk7CgoJCX0KCgkJLy8gZHJhdyByYW5nZQoKCQl0aGlzLmRyYXdSYW5nZS5zdGFydCA9IHNvdXJjZS5kcmF3UmFuZ2Uuc3RhcnQ7CgkJdGhpcy5kcmF3UmFuZ2UuY291bnQgPSBzb3VyY2UuZHJhd1JhbmdlLmNvdW50OwoKCQkvLyB1c2VyIGRhdGEKCgkJdGhpcy51c2VyRGF0YSA9IHNvdXJjZS51c2VyRGF0YTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCX0KCn0KCmNvbnN0IF9pbnZlcnNlTWF0cml4JDMgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9yYXkkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IFJheSgpOwpjb25zdCBfc3BoZXJlJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBTcGhlcmUoKTsKY29uc3QgX3NwaGVyZUhpdEF0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY29uc3QgX3ZBJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92QiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdkMkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF90ZW1wQSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX21vcnBoQSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF91dkEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoKTsKY29uc3QgX3V2QiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwpjb25zdCBfdXZDJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7Cgpjb25zdCBfbm9ybWFsQSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX25vcm1hbEIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9ub3JtYWxDID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY29uc3QgX2ludGVyc2VjdGlvblBvaW50ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIE1lc2ggZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoIGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCksIG1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKCkgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNNZXNoID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2gnOwoKCQl0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgkJdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsOwoKCQl0aGlzLnVwZGF0ZU1vcnBoVGFyZ2V0cygpOwoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJaWYgKCBzb3VyY2UubW9ycGhUYXJnZXRJbmZsdWVuY2VzICE9PSB1bmRlZmluZWQgKSB7CgoJCQl0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyA9IHNvdXJjZS5tb3JwaFRhcmdldEluZmx1ZW5jZXMuc2xpY2UoKTsKCgkJfQoKCQlpZiAoIHNvdXJjZS5tb3JwaFRhcmdldERpY3Rpb25hcnkgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5ID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5tb3JwaFRhcmdldERpY3Rpb25hcnkgKTsKCgkJfQoKCQl0aGlzLm1hdGVyaWFsID0gQXJyYXkuaXNBcnJheSggc291cmNlLm1hdGVyaWFsICkgPyBzb3VyY2UubWF0ZXJpYWwuc2xpY2UoKSA6IHNvdXJjZS5tYXRlcmlhbDsKCQl0aGlzLmdlb21ldHJ5ID0gc291cmNlLmdlb21ldHJ5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdXBkYXRlTW9ycGhUYXJnZXRzKCkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgoJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlczsKCQljb25zdCBrZXlzID0gT2JqZWN0LmtleXMoIG1vcnBoQXR0cmlidXRlcyApOwoKCQlpZiAoIGtleXMubGVuZ3RoID4gMCApIHsKCgkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzWyBrZXlzWyAwIF0gXTsKCgkJCWlmICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyA9IFtdOwoJCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSB7fTsKCgkJCQlmb3IgKCBsZXQgbSA9IDAsIG1sID0gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoOyBtIDwgbWw7IG0gKysgKSB7CgoJCQkJCWNvbnN0IG5hbWUgPSBtb3JwaEF0dHJpYnV0ZVsgbSBdLm5hbWUgfHwgU3RyaW5nKCBtICk7CgoJCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzLnB1c2goIDAgKTsKCQkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeVsgbmFtZSBdID0gbTsKCgkJCQl9CgoJCQl9CgoJCX0KCgl9CgoJZ2V0VmVydGV4UG9zaXRpb24oIGluZGV4LCB0YXJnZXQgKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQljb25zdCBwb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgkJY29uc3QgbW9ycGhQb3NpdGlvbiA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCQljb25zdCBtb3JwaFRhcmdldHNSZWxhdGl2ZSA9IGdlb21ldHJ5Lm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwoKCQl0YXJnZXQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGluZGV4ICk7CgoJCWNvbnN0IG1vcnBoSW5mbHVlbmNlcyA9IHRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzOwoKCQlpZiAoIG1vcnBoUG9zaXRpb24gJiYgbW9ycGhJbmZsdWVuY2VzICkgewoKCQkJX21vcnBoQS5zZXQoIDAsIDAsIDAgKTsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaFBvc2l0aW9uLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCWNvbnN0IGluZmx1ZW5jZSA9IG1vcnBoSW5mbHVlbmNlc1sgaSBdOwoJCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaFBvc2l0aW9uWyBpIF07CgoJCQkJaWYgKCBpbmZsdWVuY2UgPT09IDAgKSBjb250aW51ZTsKCgkJCQlfdGVtcEEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhBdHRyaWJ1dGUsIGluZGV4ICk7CgoJCQkJaWYgKCBtb3JwaFRhcmdldHNSZWxhdGl2ZSApIHsKCgkJCQkJX21vcnBoQS5hZGRTY2FsZWRWZWN0b3IoIF90ZW1wQSwgaW5mbHVlbmNlICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX21vcnBoQS5hZGRTY2FsZWRWZWN0b3IoIF90ZW1wQS5zdWIoIHRhcmdldCApLCBpbmZsdWVuY2UgKTsKCgkJCQl9CgoJCQl9CgoJCQl0YXJnZXQuYWRkKCBfbW9ycGhBICk7CgoJCX0KCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJcmF5Y2FzdCggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzICkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoJCWNvbnN0IG1hdHJpeFdvcmxkID0gdGhpcy5tYXRyaXhXb3JsZDsKCgkJaWYgKCBtYXRlcmlhbCA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkvLyB0ZXN0IHdpdGggYm91bmRpbmcgc3BoZXJlIGluIHdvcmxkIHNwYWNlCgoJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJX3NwaGVyZSQ2LmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlICk7CgkJX3NwaGVyZSQ2LmFwcGx5TWF0cml4NCggbWF0cml4V29ybGQgKTsKCgkJLy8gY2hlY2sgZGlzdGFuY2UgZnJvbSByYXkgb3JpZ2luIHRvIGJvdW5kaW5nIHNwaGVyZQoKCQlfcmF5JDMuY29weSggcmF5Y2FzdGVyLnJheSApLnJlY2FzdCggcmF5Y2FzdGVyLm5lYXIgKTsKCgkJaWYgKCBfc3BoZXJlJDYuY29udGFpbnNQb2ludCggX3JheSQzLm9yaWdpbiApID09PSBmYWxzZSApIHsKCgkJCWlmICggX3JheSQzLmludGVyc2VjdFNwaGVyZSggX3NwaGVyZSQ2LCBfc3BoZXJlSGl0QXQgKSA9PT0gbnVsbCApIHJldHVybjsKCgkJCWlmICggX3JheSQzLm9yaWdpbi5kaXN0YW5jZVRvU3F1YXJlZCggX3NwaGVyZUhpdEF0ICkgPiAoIHJheWNhc3Rlci5mYXIgLSByYXljYXN0ZXIubmVhciApICoqIDIgKSByZXR1cm47CgoJCX0KCgkJLy8gY29udmVydCByYXkgdG8gbG9jYWwgc3BhY2Ugb2YgbWVzaAoKCQlfaW52ZXJzZU1hdHJpeCQzLmNvcHkoIG1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgkJX3JheSQzLmNvcHkoIHJheWNhc3Rlci5yYXkgKS5hcHBseU1hdHJpeDQoIF9pbnZlcnNlTWF0cml4JDMgKTsKCgkJLy8gdGVzdCB3aXRoIGJvdW5kaW5nIGJveCBpbiBsb2NhbCBzcGFjZQoKCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKCQkJaWYgKCBfcmF5JDMuaW50ZXJzZWN0c0JveCggZ2VvbWV0cnkuYm91bmRpbmdCb3ggKSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCX0KCgkJLy8gdGVzdCBmb3IgaW50ZXJzZWN0aW9ucyB3aXRoIGdlb21ldHJ5CgoJCXRoaXMuX2NvbXB1dGVJbnRlcnNlY3Rpb25zKCByYXljYXN0ZXIsIGludGVyc2VjdHMsIF9yYXkkMyApOwoKCX0KCglfY29tcHV0ZUludGVyc2VjdGlvbnMoIHJheWNhc3RlciwgaW50ZXJzZWN0cywgcmF5TG9jYWxTcGFjZSApIHsKCgkJbGV0IGludGVyc2VjdGlvbjsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCWNvbnN0IG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKCgkJY29uc3QgaW5kZXggPSBnZW9tZXRyeS5pbmRleDsKCQljb25zdCBwb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgkJY29uc3QgdXYgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2OwoJCWNvbnN0IHV2MSA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudXYxOwoJCWNvbnN0IG5vcm1hbCA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMubm9ybWFsOwoJCWNvbnN0IGdyb3VwcyA9IGdlb21ldHJ5Lmdyb3VwczsKCQljb25zdCBkcmF3UmFuZ2UgPSBnZW9tZXRyeS5kcmF3UmFuZ2U7CgoJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkvLyBpbmRleGVkIGJ1ZmZlciBnZW9tZXRyeQoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBncm91cHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCWNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoIGdyb3VwLnN0YXJ0LCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggaW5kZXguY291bnQsIE1hdGgubWluKCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApICk7CgoJCQkJCWZvciAoIGxldCBqID0gc3RhcnQsIGpsID0gZW5kOyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQkJCWNvbnN0IGEgPSBpbmRleC5nZXRYKCBqICk7CgkJCQkJCWNvbnN0IGIgPSBpbmRleC5nZXRYKCBqICsgMSApOwoJCQkJCQljb25zdCBjID0gaW5kZXguZ2V0WCggaiArIDIgKTsKCgkJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIGdyb3VwTWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5TG9jYWxTcGFjZSwgdXYsIHV2MSwgbm9ybWFsLCBhLCBiLCBjICk7CgoJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gTWF0aC5mbG9vciggaiAvIDMgKTsgLy8gdHJpYW5nbGUgbnVtYmVyIGluIGluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwoJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2UubWF0ZXJpYWxJbmRleCA9IGdyb3VwLm1hdGVyaWFsSW5kZXg7CgkJCQkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdGlvbiApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCAwLCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJCWNvbnN0IGVuZCA9IE1hdGgubWluKCBpbmRleC5jb3VudCwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApOwoKCQkJCWZvciAoIGxldCBpID0gc3RhcnQsIGlsID0gZW5kOyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQkJY29uc3QgYSA9IGluZGV4LmdldFgoIGkgKTsKCQkJCQljb25zdCBiID0gaW5kZXguZ2V0WCggaSArIDEgKTsKCQkJCQljb25zdCBjID0gaW5kZXguZ2V0WCggaSArIDIgKTsKCgkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5TG9jYWxTcGFjZSwgdXYsIHV2MSwgbm9ybWFsLCBhLCBiLCBjICk7CgoJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGkgLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBpbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKCQkJCQkJaW50ZXJzZWN0cy5wdXNoKCBpbnRlcnNlY3Rpb24gKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfSBlbHNlIGlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCS8vIG5vbi1pbmRleGVkIGJ1ZmZlciBnZW9tZXRyeQoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBncm91cHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCWNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoIGdyb3VwLnN0YXJ0LCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb24uY291bnQsIE1hdGgubWluKCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApICk7CgoJCQkJCWZvciAoIGxldCBqID0gc3RhcnQsIGpsID0gZW5kOyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQkJCWNvbnN0IGEgPSBqOwoJCQkJCQljb25zdCBiID0gaiArIDE7CgkJCQkJCWNvbnN0IGMgPSBqICsgMjsKCgkJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIGdyb3VwTWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5TG9jYWxTcGFjZSwgdXYsIHV2MSwgbm9ybWFsLCBhLCBiLCBjICk7CgoJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gTWF0aC5mbG9vciggaiAvIDMgKTsgLy8gdHJpYW5nbGUgbnVtYmVyIGluIG5vbi1pbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlLm1hdGVyaWFsSW5kZXggPSBncm91cC5tYXRlcmlhbEluZGV4OwoJCQkJCQkJaW50ZXJzZWN0cy5wdXNoKCBpbnRlcnNlY3Rpb24gKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggMCwgZHJhd1JhbmdlLnN0YXJ0ICk7CgkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb24uY291bnQsICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKTsKCgkJCQlmb3IgKCBsZXQgaSA9IHN0YXJ0LCBpbCA9IGVuZDsgaSA8IGlsOyBpICs9IDMgKSB7CgoJCQkJCWNvbnN0IGEgPSBpOwoJCQkJCWNvbnN0IGIgPSBpICsgMTsKCQkJCQljb25zdCBjID0gaSArIDI7CgoJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIG1hdGVyaWFsLCByYXljYXN0ZXIsIHJheUxvY2FsU3BhY2UsIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApOwoKCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJCWludGVyc2VjdGlvbi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKCBpIC8gMyApOyAvLyB0cmlhbmdsZSBudW1iZXIgaW4gbm9uLWluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwoJCQkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdGlvbiApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQl9CgoJfQoKfQoKZnVuY3Rpb24gY2hlY2tJbnRlcnNlY3Rpb24oIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBwQSwgcEIsIHBDLCBwb2ludCApIHsKCglsZXQgaW50ZXJzZWN0OwoKCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB7CgoJCWludGVyc2VjdCA9IHJheS5pbnRlcnNlY3RUcmlhbmdsZSggcEMsIHBCLCBwQSwgdHJ1ZSwgcG9pbnQgKTsKCgl9IGVsc2UgewoKCQlpbnRlcnNlY3QgPSByYXkuaW50ZXJzZWN0VHJpYW5nbGUoIHBBLCBwQiwgcEMsICggbWF0ZXJpYWwuc2lkZSA9PT0gRnJvbnRTaWRlICksIHBvaW50ICk7CgoJfQoKCWlmICggaW50ZXJzZWN0ID09PSBudWxsICkgcmV0dXJuIG51bGw7CgoJX2ludGVyc2VjdGlvblBvaW50V29ybGQuY29weSggcG9pbnQgKTsKCV9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgoJY29uc3QgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKCBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCApOwoKCWlmICggZGlzdGFuY2UgPCByYXljYXN0ZXIubmVhciB8fCBkaXN0YW5jZSA+IHJheWNhc3Rlci5mYXIgKSByZXR1cm4gbnVsbDsKCglyZXR1cm4gewoJCWRpc3RhbmNlOiBkaXN0YW5jZSwKCQlwb2ludDogX2ludGVyc2VjdGlvblBvaW50V29ybGQuY2xvbmUoKSwKCQlvYmplY3Q6IG9iamVjdAoJfTsKCn0KCmZ1bmN0aW9uIGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKSB7CgoJb2JqZWN0LmdldFZlcnRleFBvc2l0aW9uKCBhLCBfdkEkMSApOwoJb2JqZWN0LmdldFZlcnRleFBvc2l0aW9uKCBiLCBfdkIkMSApOwoJb2JqZWN0LmdldFZlcnRleFBvc2l0aW9uKCBjLCBfdkMkMSApOwoKCWNvbnN0IGludGVyc2VjdGlvbiA9IGNoZWNrSW50ZXJzZWN0aW9uKCBvYmplY3QsIG1hdGVyaWFsLCByYXljYXN0ZXIsIHJheSwgX3ZBJDEsIF92QiQxLCBfdkMkMSwgX2ludGVyc2VjdGlvblBvaW50ICk7CgoJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgoJCWlmICggdXYgKSB7CgoJCQlfdXZBJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdXYsIGEgKTsKCQkJX3V2QiQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHV2LCBiICk7CgkJCV91dkMkMS5mcm9tQnVmZmVyQXR0cmlidXRlKCB1diwgYyApOwoKCQkJaW50ZXJzZWN0aW9uLnV2ID0gVHJpYW5nbGUuZ2V0SW50ZXJwb2xhdGlvbiggX2ludGVyc2VjdGlvblBvaW50LCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBfdXZBJDEsIF91dkIkMSwgX3V2QyQxLCBuZXcgVmVjdG9yMigpICk7CgoJCX0KCgkJaWYgKCB1djEgKSB7CgoJCQlfdXZBJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdXYxLCBhICk7CgkJCV91dkIkMS5mcm9tQnVmZmVyQXR0cmlidXRlKCB1djEsIGIgKTsKCQkJX3V2QyQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHV2MSwgYyApOwoKCQkJaW50ZXJzZWN0aW9uLnV2MSA9IFRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oIF9pbnRlcnNlY3Rpb25Qb2ludCwgX3ZBJDEsIF92QiQxLCBfdkMkMSwgX3V2QSQxLCBfdXZCJDEsIF91dkMkMSwgbmV3IFZlY3RvcjIoKSApOwoJCQlpbnRlcnNlY3Rpb24udXYyID0gaW50ZXJzZWN0aW9uLnV2MTsgLy8gQGRlcHJlY2F0ZWQsIHIxNTIKCgkJfQoKCQlpZiAoIG5vcm1hbCApIHsKCgkJCV9ub3JtYWxBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbCwgYSApOwoJCQlfbm9ybWFsQi5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWwsIGIgKTsKCQkJX25vcm1hbEMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsLCBjICk7CgoJCQlpbnRlcnNlY3Rpb24ubm9ybWFsID0gVHJpYW5nbGUuZ2V0SW50ZXJwb2xhdGlvbiggX2ludGVyc2VjdGlvblBvaW50LCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBfbm9ybWFsQSwgX25vcm1hbEIsIF9ub3JtYWxDLCBuZXcgVmVjdG9yMygpICk7CgoJCQlpZiAoIGludGVyc2VjdGlvbi5ub3JtYWwuZG90KCByYXkuZGlyZWN0aW9uICkgPiAwICkgewoKCQkJCWludGVyc2VjdGlvbi5ub3JtYWwubXVsdGlwbHlTY2FsYXIoIC0gMSApOwoKCQkJfQoKCQl9CgoJCWNvbnN0IGZhY2UgPSB7CgkJCWE6IGEsCgkJCWI6IGIsCgkJCWM6IGMsCgkJCW5vcm1hbDogbmV3IFZlY3RvcjMoKSwKCQkJbWF0ZXJpYWxJbmRleDogMAoJCX07CgoJCVRyaWFuZ2xlLmdldE5vcm1hbCggX3ZBJDEsIF92QiQxLCBfdkMkMSwgZmFjZS5ub3JtYWwgKTsKCgkJaW50ZXJzZWN0aW9uLmZhY2UgPSBmYWNlOwoKCX0KCglyZXR1cm4gaW50ZXJzZWN0aW9uOwoKfQoKY2xhc3MgQm94R2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgZGVwdGggPSAxLCB3aWR0aFNlZ21lbnRzID0gMSwgaGVpZ2h0U2VnbWVudHMgPSAxLCBkZXB0aFNlZ21lbnRzID0gMSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ0JveEdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQl3aWR0aDogd2lkdGgsCgkJCWhlaWdodDogaGVpZ2h0LAoJCQlkZXB0aDogZGVwdGgsCgkJCXdpZHRoU2VnbWVudHM6IHdpZHRoU2VnbWVudHMsCgkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cywKCQkJZGVwdGhTZWdtZW50czogZGVwdGhTZWdtZW50cwoJCX07CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJLy8gc2VnbWVudHMKCgkJd2lkdGhTZWdtZW50cyA9IE1hdGguZmxvb3IoIHdpZHRoU2VnbWVudHMgKTsKCQloZWlnaHRTZWdtZW50cyA9IE1hdGguZmxvb3IoIGhlaWdodFNlZ21lbnRzICk7CgkJZGVwdGhTZWdtZW50cyA9IE1hdGguZmxvb3IoIGRlcHRoU2VnbWVudHMgKTsKCgkJLy8gYnVmZmVycwoKCQljb25zdCBpbmRpY2VzID0gW107CgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBub3JtYWxzID0gW107CgkJY29uc3QgdXZzID0gW107CgoJCS8vIGhlbHBlciB2YXJpYWJsZXMKCgkJbGV0IG51bWJlck9mVmVydGljZXMgPSAwOwoJCWxldCBncm91cFN0YXJ0ID0gMDsKCgkJLy8gYnVpbGQgZWFjaCBzaWRlIG9mIHRoZSBib3ggZ2VvbWV0cnkKCgkJYnVpbGRQbGFuZSggJ3onLCAneScsICd4JywgLSAxLCAtIDEsIGRlcHRoLCBoZWlnaHQsIHdpZHRoLCBkZXB0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgMCApOyAvLyBweAoJCWJ1aWxkUGxhbmUoICd6JywgJ3knLCAneCcsIDEsIC0gMSwgZGVwdGgsIGhlaWdodCwgLSB3aWR0aCwgZGVwdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDEgKTsgLy8gbngKCQlidWlsZFBsYW5lKCAneCcsICd6JywgJ3knLCAxLCAxLCB3aWR0aCwgZGVwdGgsIGhlaWdodCwgd2lkdGhTZWdtZW50cywgZGVwdGhTZWdtZW50cywgMiApOyAvLyBweQoJCWJ1aWxkUGxhbmUoICd4JywgJ3onLCAneScsIDEsIC0gMSwgd2lkdGgsIGRlcHRoLCAtIGhlaWdodCwgd2lkdGhTZWdtZW50cywgZGVwdGhTZWdtZW50cywgMyApOyAvLyBueQoJCWJ1aWxkUGxhbmUoICd4JywgJ3knLCAneicsIDEsIC0gMSwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIHdpZHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCA0ICk7IC8vIHB6CgkJYnVpbGRQbGFuZSggJ3gnLCAneScsICd6JywgLSAxLCAtIDEsIHdpZHRoLCBoZWlnaHQsIC0gZGVwdGgsIHdpZHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCA1ICk7IC8vIG56CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJCWZ1bmN0aW9uIGJ1aWxkUGxhbmUoIHUsIHYsIHcsIHVkaXIsIHZkaXIsIHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBncmlkWCwgZ3JpZFksIG1hdGVyaWFsSW5kZXggKSB7CgoJCQljb25zdCBzZWdtZW50V2lkdGggPSB3aWR0aCAvIGdyaWRYOwoJCQljb25zdCBzZWdtZW50SGVpZ2h0ID0gaGVpZ2h0IC8gZ3JpZFk7CgoJCQljb25zdCB3aWR0aEhhbGYgPSB3aWR0aCAvIDI7CgkJCWNvbnN0IGhlaWdodEhhbGYgPSBoZWlnaHQgLyAyOwoJCQljb25zdCBkZXB0aEhhbGYgPSBkZXB0aCAvIDI7CgoJCQljb25zdCBncmlkWDEgPSBncmlkWCArIDE7CgkJCWNvbnN0IGdyaWRZMSA9IGdyaWRZICsgMTsKCgkJCWxldCB2ZXJ0ZXhDb3VudGVyID0gMDsKCQkJbGV0IGdyb3VwQ291bnQgPSAwOwoKCQkJY29uc3QgdmVjdG9yID0gbmV3IFZlY3RvcjMoKTsKCgkJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJCWZvciAoIGxldCBpeSA9IDA7IGl5IDwgZ3JpZFkxOyBpeSArKyApIHsKCgkJCQljb25zdCB5ID0gaXkgKiBzZWdtZW50SGVpZ2h0IC0gaGVpZ2h0SGFsZjsKCgkJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYMTsgaXggKysgKSB7CgoJCQkJCWNvbnN0IHggPSBpeCAqIHNlZ21lbnRXaWR0aCAtIHdpZHRoSGFsZjsKCgkJCQkJLy8gc2V0IHZhbHVlcyB0byBjb3JyZWN0IHZlY3RvciBjb21wb25lbnQKCgkJCQkJdmVjdG9yWyB1IF0gPSB4ICogdWRpcjsKCQkJCQl2ZWN0b3JbIHYgXSA9IHkgKiB2ZGlyOwoJCQkJCXZlY3RvclsgdyBdID0gZGVwdGhIYWxmOwoKCQkJCQkvLyBub3cgYXBwbHkgdmVjdG9yIHRvIHZlcnRleCBidWZmZXIKCgkJCQkJdmVydGljZXMucHVzaCggdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiApOwoKCQkJCQkvLyBzZXQgdmFsdWVzIHRvIGNvcnJlY3QgdmVjdG9yIGNvbXBvbmVudAoKCQkJCQl2ZWN0b3JbIHUgXSA9IDA7CgkJCQkJdmVjdG9yWyB2IF0gPSAwOwoJCQkJCXZlY3RvclsgdyBdID0gZGVwdGggPiAwID8gMSA6IC0gMTsKCgkJCQkJLy8gbm93IGFwcGx5IHZlY3RvciB0byBub3JtYWwgYnVmZmVyCgoJCQkJCW5vcm1hbHMucHVzaCggdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiApOwoKCQkJCQkvLyB1dnMKCgkJCQkJdXZzLnB1c2goIGl4IC8gZ3JpZFggKTsKCQkJCQl1dnMucHVzaCggMSAtICggaXkgLyBncmlkWSApICk7CgoJCQkJCS8vIGNvdW50ZXJzCgoJCQkJCXZlcnRleENvdW50ZXIgKz0gMTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBpbmRpY2VzCgoJCQkvLyAxLiB5b3UgbmVlZCB0aHJlZSBpbmRpY2VzIHRvIGRyYXcgYSBzaW5nbGUgZmFjZQoJCQkvLyAyLiBhIHNpbmdsZSBzZWdtZW50IGNvbnNpc3RzIG9mIHR3byBmYWNlcwoJCQkvLyAzLiBzbyB3ZSBuZWVkIHRvIGdlbmVyYXRlIHNpeCAoMiozKSBpbmRpY2VzIHBlciBzZWdtZW50CgoJCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZOyBpeSArKyApIHsKCgkJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYOyBpeCArKyApIHsKCgkJCQkJY29uc3QgYSA9IG51bWJlck9mVmVydGljZXMgKyBpeCArIGdyaWRYMSAqIGl5OwoJCQkJCWNvbnN0IGIgPSBudW1iZXJPZlZlcnRpY2VzICsgaXggKyBncmlkWDEgKiAoIGl5ICsgMSApOwoJCQkJCWNvbnN0IGMgPSBudW1iZXJPZlZlcnRpY2VzICsgKCBpeCArIDEgKSArIGdyaWRYMSAqICggaXkgKyAxICk7CgkJCQkJY29uc3QgZCA9IG51bWJlck9mVmVydGljZXMgKyAoIGl4ICsgMSApICsgZ3JpZFgxICogaXk7CgoJCQkJCS8vIGZhY2VzCgoJCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJCWluZGljZXMucHVzaCggYiwgYywgZCApOwoKCQkJCQkvLyBpbmNyZWFzZSBjb3VudGVyCgoJCQkJCWdyb3VwQ291bnQgKz0gNjsKCgkJCQl9CgoJCQl9CgoJCQkvLyBhZGQgYSBncm91cCB0byB0aGUgZ2VvbWV0cnkuIHRoaXMgd2lsbCBlbnN1cmUgbXVsdGkgbWF0ZXJpYWwgc3VwcG9ydAoKCQkJc2NvcGUuYWRkR3JvdXAoIGdyb3VwU3RhcnQsIGdyb3VwQ291bnQsIG1hdGVyaWFsSW5kZXggKTsKCgkJCS8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgdmFsdWUgZm9yIGdyb3VwcwoKCQkJZ3JvdXBTdGFydCArPSBncm91cENvdW50OwoKCQkJLy8gdXBkYXRlIHRvdGFsIG51bWJlciBvZiB2ZXJ0aWNlcwoKCQkJbnVtYmVyT2ZWZXJ0aWNlcyArPSB2ZXJ0ZXhDb3VudGVyOwoKCQl9CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IEJveEdlb21ldHJ5KCBkYXRhLndpZHRoLCBkYXRhLmhlaWdodCwgZGF0YS5kZXB0aCwgZGF0YS53aWR0aFNlZ21lbnRzLCBkYXRhLmhlaWdodFNlZ21lbnRzLCBkYXRhLmRlcHRoU2VnbWVudHMgKTsKCgl9Cgp9CgovKioKICogVW5pZm9ybSBVdGlsaXRpZXMKICovCgpmdW5jdGlvbiBjbG9uZVVuaWZvcm1zKCBzcmMgKSB7CgoJY29uc3QgZHN0ID0ge307CgoJZm9yICggY29uc3QgdSBpbiBzcmMgKSB7CgoJCWRzdFsgdSBdID0ge307CgoJCWZvciAoIGNvbnN0IHAgaW4gc3JjWyB1IF0gKSB7CgoJCQljb25zdCBwcm9wZXJ0eSA9IHNyY1sgdSBdWyBwIF07CgoJCQlpZiAoIHByb3BlcnR5ICYmICggcHJvcGVydHkuaXNDb2xvciB8fAoJCQkJcHJvcGVydHkuaXNNYXRyaXgzIHx8IHByb3BlcnR5LmlzTWF0cml4NCB8fAoJCQkJcHJvcGVydHkuaXNWZWN0b3IyIHx8IHByb3BlcnR5LmlzVmVjdG9yMyB8fCBwcm9wZXJ0eS5pc1ZlY3RvcjQgfHwKCQkJCXByb3BlcnR5LmlzVGV4dHVyZSB8fCBwcm9wZXJ0eS5pc1F1YXRlcm5pb24gKSApIHsKCgkJCQlpZiAoIHByb3BlcnR5LmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVW5pZm9ybXNVdGlsczogVGV4dHVyZXMgb2YgcmVuZGVyIHRhcmdldHMgY2Fubm90IGJlIGNsb25lZCB2aWEgY2xvbmVVbmlmb3JtcygpIG9yIG1lcmdlVW5pZm9ybXMoKS4nICk7CgkJCQkJZHN0WyB1IF1bIHAgXSA9IG51bGw7CgoJCQkJfSBlbHNlIHsKCgkJCQkJZHN0WyB1IF1bIHAgXSA9IHByb3BlcnR5LmNsb25lKCk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggQXJyYXkuaXNBcnJheSggcHJvcGVydHkgKSApIHsKCgkJCQlkc3RbIHUgXVsgcCBdID0gcHJvcGVydHkuc2xpY2UoKTsKCgkJCX0gZWxzZSB7CgoJCQkJZHN0WyB1IF1bIHAgXSA9IHByb3BlcnR5OwoKCQkJfQoKCQl9CgoJfQoKCXJldHVybiBkc3Q7Cgp9CgpmdW5jdGlvbiBtZXJnZVVuaWZvcm1zKCB1bmlmb3JtcyApIHsKCgljb25zdCBtZXJnZWQgPSB7fTsKCglmb3IgKCBsZXQgdSA9IDA7IHUgPCB1bmlmb3Jtcy5sZW5ndGg7IHUgKysgKSB7CgoJCWNvbnN0IHRtcCA9IGNsb25lVW5pZm9ybXMoIHVuaWZvcm1zWyB1IF0gKTsKCgkJZm9yICggY29uc3QgcCBpbiB0bXAgKSB7CgoJCQltZXJnZWRbIHAgXSA9IHRtcFsgcCBdOwoKCQl9CgoJfQoKCXJldHVybiBtZXJnZWQ7Cgp9CgpmdW5jdGlvbiBjbG9uZVVuaWZvcm1zR3JvdXBzKCBzcmMgKSB7CgoJY29uc3QgZHN0ID0gW107CgoJZm9yICggbGV0IHUgPSAwOyB1IDwgc3JjLmxlbmd0aDsgdSArKyApIHsKCgkJZHN0LnB1c2goIHNyY1sgdSBdLmNsb25lKCkgKTsKCgl9CgoJcmV0dXJuIGRzdDsKCn0KCmZ1bmN0aW9uIGdldFVubGl0VW5pZm9ybUNvbG9yU3BhY2UoIHJlbmRlcmVyICkgewoKCWlmICggcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCkgPT09IG51bGwgKSB7CgoJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvcHVsbC8yMzkzNyNpc3N1ZWNvbW1lbnQtMTExMTA2NzM5OAoJCXJldHVybiByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlOwoKCX0KCglyZXR1cm4gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlOwoKfQoKLy8gTGVnYWN5Cgpjb25zdCBVbmlmb3Jtc1V0aWxzID0geyBjbG9uZTogY2xvbmVVbmlmb3JtcywgbWVyZ2U6IG1lcmdlVW5pZm9ybXMgfTsKCnZhciBkZWZhdWx0X3ZlcnRleCA9ICJ2b2lkIG1haW4oKSB7XG5cdGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG1vZGVsVmlld01hdHJpeCAqIHZlYzQoIHBvc2l0aW9uLCAxLjAgKTtcbn0iOwoKdmFyIGRlZmF1bHRfZnJhZ21lbnQgPSAidm9pZCBtYWluKCkge1xuXHRnbF9GcmFnQ29sb3IgPSB2ZWM0KCAxLjAsIDAuMCwgMC4wLCAxLjAgKTtcbn0iOwoKY2xhc3MgU2hhZGVyTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgoJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNTaGFkZXJNYXRlcmlhbCA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdTaGFkZXJNYXRlcmlhbCc7CgoJCXRoaXMuZGVmaW5lcyA9IHt9OwoJCXRoaXMudW5pZm9ybXMgPSB7fTsKCQl0aGlzLnVuaWZvcm1zR3JvdXBzID0gW107CgoJCXRoaXMudmVydGV4U2hhZGVyID0gZGVmYXVsdF92ZXJ0ZXg7CgkJdGhpcy5mcmFnbWVudFNoYWRlciA9IGRlZmF1bHRfZnJhZ21lbnQ7CgoJCXRoaXMubGluZXdpZHRoID0gMTsKCgkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgoJCXRoaXMuZm9nID0gZmFsc2U7IC8vIHNldCB0byB1c2Ugc2NlbmUgZm9nCgkJdGhpcy5saWdodHMgPSBmYWxzZTsgLy8gc2V0IHRvIHVzZSBzY2VuZSBsaWdodHMKCQl0aGlzLmNsaXBwaW5nID0gZmFsc2U7IC8vIHNldCB0byB1c2UgdXNlci1kZWZpbmVkIGNsaXBwaW5nIHBsYW5lcwoKCQl0aGlzLmZvcmNlU2luZ2xlUGFzcyA9IHRydWU7CgoJCXRoaXMuZXh0ZW5zaW9ucyA9IHsKCQkJZGVyaXZhdGl2ZXM6IGZhbHNlLCAvLyBzZXQgdG8gdXNlIGRlcml2YXRpdmVzCgkJCWZyYWdEZXB0aDogZmFsc2UsIC8vIHNldCB0byB1c2UgZnJhZ21lbnQgZGVwdGggdmFsdWVzCgkJCWRyYXdCdWZmZXJzOiBmYWxzZSwgLy8gc2V0IHRvIHVzZSBkcmF3IGJ1ZmZlcnMKCQkJc2hhZGVyVGV4dHVyZUxPRDogZmFsc2UsIC8vIHNldCB0byB1c2Ugc2hhZGVyIHRleHR1cmUgTE9ECgkJCWNsaXBDdWxsRGlzdGFuY2U6IGZhbHNlIC8vIHNldCB0byB1c2UgdmVydGV4IHNoYWRlciBjbGlwcGluZwoJCX07CgoJCS8vIFdoZW4gcmVuZGVyZWQgZ2VvbWV0cnkgZG9lc24ndCBpbmNsdWRlIHRoZXNlIGF0dHJpYnV0ZXMgYnV0IHRoZSBtYXRlcmlhbCBkb2VzLAoJCS8vIHVzZSB0aGVzZSBkZWZhdWx0IHZhbHVlcyBpbiBXZWJHTC4gVGhpcyBhdm9pZHMgZXJyb3JzIHdoZW4gYnVmZmVyIGRhdGEgaXMgbWlzc2luZy4KCQl0aGlzLmRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXMgPSB7CgkJCSdjb2xvcic6IFsgMSwgMSwgMSBdLAoJCQkndXYnOiBbIDAsIDAgXSwKCQkJJ3V2MSc6IFsgMCwgMCBdCgkJfTsKCgkJdGhpcy5pbmRleDBBdHRyaWJ1dGVOYW1lID0gdW5kZWZpbmVkOwoJCXRoaXMudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuZ2xzbFZlcnNpb24gPSBudWxsOwoKCQlpZiAoIHBhcmFtZXRlcnMgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5mcmFnbWVudFNoYWRlciA9IHNvdXJjZS5mcmFnbWVudFNoYWRlcjsKCQl0aGlzLnZlcnRleFNoYWRlciA9IHNvdXJjZS52ZXJ0ZXhTaGFkZXI7CgoJCXRoaXMudW5pZm9ybXMgPSBjbG9uZVVuaWZvcm1zKCBzb3VyY2UudW5pZm9ybXMgKTsKCQl0aGlzLnVuaWZvcm1zR3JvdXBzID0gY2xvbmVVbmlmb3Jtc0dyb3Vwcyggc291cmNlLnVuaWZvcm1zR3JvdXBzICk7CgoJCXRoaXMuZGVmaW5lcyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UuZGVmaW5lcyApOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgkJdGhpcy5saWdodHMgPSBzb3VyY2UubGlnaHRzOwoJCXRoaXMuY2xpcHBpbmcgPSBzb3VyY2UuY2xpcHBpbmc7CgoJCXRoaXMuZXh0ZW5zaW9ucyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UuZXh0ZW5zaW9ucyApOwoKCQl0aGlzLmdsc2xWZXJzaW9uID0gc291cmNlLmdsc2xWZXJzaW9uOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCBtZXRhICkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCBtZXRhICk7CgoJCWRhdGEuZ2xzbFZlcnNpb24gPSB0aGlzLmdsc2xWZXJzaW9uOwoJCWRhdGEudW5pZm9ybXMgPSB7fTsKCgkJZm9yICggY29uc3QgbmFtZSBpbiB0aGlzLnVuaWZvcm1zICkgewoKCQkJY29uc3QgdW5pZm9ybSA9IHRoaXMudW5pZm9ybXNbIG5hbWUgXTsKCQkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoKCQkJaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc1RleHR1cmUgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICd0JywKCQkJCQl2YWx1ZTogdmFsdWUudG9KU09OKCBtZXRhICkudXVpZAoJCQkJfTsKCgkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzQ29sb3IgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICdjJywKCQkJCQl2YWx1ZTogdmFsdWUuZ2V0SGV4KCkKCQkJCX07CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc1ZlY3RvcjIgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICd2MicsCgkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJfTsKCgkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yMyApIHsKCgkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJdHlwZTogJ3YzJywKCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCgkJCQl9OwoKCQkJfSBlbHNlIGlmICggdmFsdWUgJiYgdmFsdWUuaXNWZWN0b3I0ICkgewoKCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQl0eXBlOiAndjQnLAoJCQkJCXZhbHVlOiB2YWx1ZS50b0FycmF5KCkKCQkJCX07CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc01hdHJpeDMgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICdtMycsCgkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJfTsKCgkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzTWF0cml4NCApIHsKCgkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJdHlwZTogJ200JywKCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCgkJCQl9OwoKCQkJfSBlbHNlIHsKCgkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJdmFsdWU6IHZhbHVlCgkJCQl9OwoKCQkJCS8vIG5vdGU6IHRoZSBhcnJheSB2YXJpYW50cyB2MnYsIHYzdiwgdjR2LCBtNHYgYW5kIHR2IGFyZSBub3Qgc3VwcG9ydGVkIHNvIGZhcgoKCQkJfQoKCQl9CgoJCWlmICggT2JqZWN0LmtleXMoIHRoaXMuZGVmaW5lcyApLmxlbmd0aCA+IDAgKSBkYXRhLmRlZmluZXMgPSB0aGlzLmRlZmluZXM7CgoJCWRhdGEudmVydGV4U2hhZGVyID0gdGhpcy52ZXJ0ZXhTaGFkZXI7CgkJZGF0YS5mcmFnbWVudFNoYWRlciA9IHRoaXMuZnJhZ21lbnRTaGFkZXI7CgoJCWRhdGEubGlnaHRzID0gdGhpcy5saWdodHM7CgkJZGF0YS5jbGlwcGluZyA9IHRoaXMuY2xpcHBpbmc7CgoJCWNvbnN0IGV4dGVuc2lvbnMgPSB7fTsKCgkJZm9yICggY29uc3Qga2V5IGluIHRoaXMuZXh0ZW5zaW9ucyApIHsKCgkJCWlmICggdGhpcy5leHRlbnNpb25zWyBrZXkgXSA9PT0gdHJ1ZSApIGV4dGVuc2lvbnNbIGtleSBdID0gdHJ1ZTsKCgkJfQoKCQlpZiAoIE9iamVjdC5rZXlzKCBleHRlbnNpb25zICkubGVuZ3RoID4gMCApIGRhdGEuZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbnM7CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNsYXNzIENhbWVyYSBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0NhbWVyYSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdDYW1lcmEnOwoKCQl0aGlzLm1hdHJpeFdvcmxkSW52ZXJzZSA9IG5ldyBNYXRyaXg0KCk7CgoJCXRoaXMucHJvamVjdGlvbk1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSA9IG5ldyBNYXRyaXg0KCk7CgoJCXRoaXMuY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHNvdXJjZS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIHNvdXJjZS5wcm9qZWN0aW9uTWF0cml4ICk7CgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBzb3VyY2UucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCgkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gc291cmNlLmNvb3JkaW5hdGVTeXN0ZW07CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkgewoKCQlyZXR1cm4gc3VwZXIuZ2V0V29ybGREaXJlY3Rpb24oIHRhcmdldCApLm5lZ2F0ZSgpOwoKCX0KCgl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCXN1cGVyLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCQl0aGlzLm1hdHJpeFdvcmxkSW52ZXJzZS5jb3B5KCB0aGlzLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgoJfQoKCXVwZGF0ZVdvcmxkTWF0cml4KCB1cGRhdGVQYXJlbnRzLCB1cGRhdGVDaGlsZHJlbiApIHsKCgkJc3VwZXIudXBkYXRlV29ybGRNYXRyaXgoIHVwZGF0ZVBhcmVudHMsIHVwZGF0ZUNoaWxkcmVuICk7CgoJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9Cgp9CgpjbGFzcyBQZXJzcGVjdGl2ZUNhbWVyYSBleHRlbmRzIENhbWVyYSB7CgoJY29uc3RydWN0b3IoIGZvdiA9IDUwLCBhc3BlY3QgPSAxLCBuZWFyID0gMC4xLCBmYXIgPSAyMDAwICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzUGVyc3BlY3RpdmVDYW1lcmEgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUGVyc3BlY3RpdmVDYW1lcmEnOwoKCQl0aGlzLmZvdiA9IGZvdjsKCQl0aGlzLnpvb20gPSAxOwoKCQl0aGlzLm5lYXIgPSBuZWFyOwoJCXRoaXMuZmFyID0gZmFyOwoJCXRoaXMuZm9jdXMgPSAxMDsKCgkJdGhpcy5hc3BlY3QgPSBhc3BlY3Q7CgkJdGhpcy52aWV3ID0gbnVsbDsKCgkJdGhpcy5maWxtR2F1Z2UgPSAzNTsJLy8gd2lkdGggb2YgdGhlIGZpbG0gKGRlZmF1bHQgaW4gbWlsbGltZXRlcnMpCgkJdGhpcy5maWxtT2Zmc2V0ID0gMDsJLy8gaG9yaXpvbnRhbCBmaWxtIG9mZnNldCAoc2FtZSB1bml0IGFzIGdhdWdlKQoKCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMuZm92ID0gc291cmNlLmZvdjsKCQl0aGlzLnpvb20gPSBzb3VyY2Uuem9vbTsKCgkJdGhpcy5uZWFyID0gc291cmNlLm5lYXI7CgkJdGhpcy5mYXIgPSBzb3VyY2UuZmFyOwoJCXRoaXMuZm9jdXMgPSBzb3VyY2UuZm9jdXM7CgoJCXRoaXMuYXNwZWN0ID0gc291cmNlLmFzcGVjdDsKCQl0aGlzLnZpZXcgPSBzb3VyY2UudmlldyA9PT0gbnVsbCA/IG51bGwgOiBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnZpZXcgKTsKCgkJdGhpcy5maWxtR2F1Z2UgPSBzb3VyY2UuZmlsbUdhdWdlOwoJCXRoaXMuZmlsbU9mZnNldCA9IHNvdXJjZS5maWxtT2Zmc2V0OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLyoqCgkgKiBTZXRzIHRoZSBGT1YgYnkgZm9jYWwgbGVuZ3RoIGluIHJlc3BlY3QgdG8gdGhlIGN1cnJlbnQgLmZpbG1HYXVnZS4KCSAqCgkgKiBUaGUgZGVmYXVsdCBmaWxtIGdhdWdlIGlzIDM1LCBzbyB0aGF0IHRoZSBmb2NhbCBsZW5ndGggY2FuIGJlIHNwZWNpZmllZCBmb3IKCSAqIGEgMzVtbSAoZnVsbCBmcmFtZSkgY2FtZXJhLgoJICoKCSAqIFZhbHVlcyBmb3IgZm9jYWwgbGVuZ3RoIGFuZCBmaWxtIGdhdWdlIG11c3QgaGF2ZSB0aGUgc2FtZSB1bml0LgoJICovCglzZXRGb2NhbExlbmd0aCggZm9jYWxMZW5ndGggKSB7CgoJCS8qKiBzZWUge0BsaW5rIGh0dHA6Ly93d3cuYm9iYXRraW5zLmNvbS9waG90b2dyYXBoeS90ZWNobmljYWwvZmllbGRfb2Zfdmlldy5odG1sfSAqLwoJCWNvbnN0IHZFeHRlbnRTbG9wZSA9IDAuNSAqIHRoaXMuZ2V0RmlsbUhlaWdodCgpIC8gZm9jYWxMZW5ndGg7CgoJCXRoaXMuZm92ID0gUkFEMkRFRyAqIDIgKiBNYXRoLmF0YW4oIHZFeHRlbnRTbG9wZSApOwoJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCX0KCgkvKioKCSAqIENhbGN1bGF0ZXMgdGhlIGZvY2FsIGxlbmd0aCBmcm9tIHRoZSBjdXJyZW50IC5mb3YgYW5kIC5maWxtR2F1Z2UuCgkgKi8KCWdldEZvY2FsTGVuZ3RoKCkgewoKCQljb25zdCB2RXh0ZW50U2xvcGUgPSBNYXRoLnRhbiggREVHMlJBRCAqIDAuNSAqIHRoaXMuZm92ICk7CgoJCXJldHVybiAwLjUgKiB0aGlzLmdldEZpbG1IZWlnaHQoKSAvIHZFeHRlbnRTbG9wZTsKCgl9CgoJZ2V0RWZmZWN0aXZlRk9WKCkgewoKCQlyZXR1cm4gUkFEMkRFRyAqIDIgKiBNYXRoLmF0YW4oCgkJCU1hdGgudGFuKCBERUcyUkFEICogMC41ICogdGhpcy5mb3YgKSAvIHRoaXMuem9vbSApOwoKCX0KCglnZXRGaWxtV2lkdGgoKSB7CgoJCS8vIGZpbG0gbm90IGNvbXBsZXRlbHkgY292ZXJlZCBpbiBwb3J0cmFpdCBmb3JtYXQgKGFzcGVjdCA8IDEpCgkJcmV0dXJuIHRoaXMuZmlsbUdhdWdlICogTWF0aC5taW4oIHRoaXMuYXNwZWN0LCAxICk7CgoJfQoKCWdldEZpbG1IZWlnaHQoKSB7CgoJCS8vIGZpbG0gbm90IGNvbXBsZXRlbHkgY292ZXJlZCBpbiBsYW5kc2NhcGUgZm9ybWF0IChhc3BlY3QgPiAxKQoJCXJldHVybiB0aGlzLmZpbG1HYXVnZSAvIE1hdGgubWF4KCB0aGlzLmFzcGVjdCwgMSApOwoKCX0KCgkvKioKCSAqIFNldHMgYW4gb2Zmc2V0IGluIGEgbGFyZ2VyIGZydXN0dW0uIFRoaXMgaXMgdXNlZnVsIGZvciBtdWx0aS13aW5kb3cgb3IKCSAqIG11bHRpLW1vbml0b3IvbXVsdGktbWFjaGluZSBzZXR1cHMuCgkgKgoJICogRm9yIGV4YW1wbGUsIGlmIHlvdSBoYXZlIDN4MiBtb25pdG9ycyBhbmQgZWFjaCBtb25pdG9yIGlzIDE5MjB4MTA4MCBhbmQKCSAqIHRoZSBtb25pdG9ycyBhcmUgaW4gZ3JpZCBsaWtlIHRoaXMKCSAqCgkgKiAgICstLS0rLS0tKy0tLSsKCSAqICAgfCBBIHwgQiB8IEMgfAoJICogICArLS0tKy0tLSstLS0rCgkgKiAgIHwgRCB8IEUgfCBGIHwKCSAqICAgKy0tLSstLS0rLS0tKwoJICoKCSAqIHRoZW4gZm9yIGVhY2ggbW9uaXRvciB5b3Ugd291bGQgY2FsbCBpdCBsaWtlIHRoaXMKCSAqCgkgKiAgIGNvbnN0IHcgPSAxOTIwOwoJICogICBjb25zdCBoID0gMTA4MDsKCSAqICAgY29uc3QgZnVsbFdpZHRoID0gdyAqIDM7CgkgKiAgIGNvbnN0IGZ1bGxIZWlnaHQgPSBoICogMjsKCSAqCgkgKiAgIC0tQS0tCgkgKiAgIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAwLCBoICogMCwgdywgaCApOwoJICogICAtLUItLQoJICogICBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDAsIHcsIGggKTsKCSAqICAgLS1DLS0KCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDIsIGggKiAwLCB3LCBoICk7CgkgKiAgIC0tRC0tCgkgKiAgIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAwLCBoICogMSwgdywgaCApOwoJICogICAtLUUtLQoJICogICBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDEsIHcsIGggKTsKCSAqICAgLS1GLS0KCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDIsIGggKiAxLCB3LCBoICk7CgkgKgoJICogICBOb3RlIHRoZXJlIGlzIG5vIHJlYXNvbiBtb25pdG9ycyBoYXZlIHRvIGJlIHRoZSBzYW1lIHNpemUgb3IgaW4gYSBncmlkLgoJICovCglzZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCXRoaXMuYXNwZWN0ID0gZnVsbFdpZHRoIC8gZnVsbEhlaWdodDsKCgkJaWYgKCB0aGlzLnZpZXcgPT09IG51bGwgKSB7CgoJCQl0aGlzLnZpZXcgPSB7CgkJCQllbmFibGVkOiB0cnVlLAoJCQkJZnVsbFdpZHRoOiAxLAoJCQkJZnVsbEhlaWdodDogMSwKCQkJCW9mZnNldFg6IDAsCgkJCQlvZmZzZXRZOiAwLAoJCQkJd2lkdGg6IDEsCgkJCQloZWlnaHQ6IDEKCQkJfTsKCgkJfQoKCQl0aGlzLnZpZXcuZW5hYmxlZCA9IHRydWU7CgkJdGhpcy52aWV3LmZ1bGxXaWR0aCA9IGZ1bGxXaWR0aDsKCQl0aGlzLnZpZXcuZnVsbEhlaWdodCA9IGZ1bGxIZWlnaHQ7CgkJdGhpcy52aWV3Lm9mZnNldFggPSB4OwoJCXRoaXMudmlldy5vZmZzZXRZID0geTsKCQl0aGlzLnZpZXcud2lkdGggPSB3aWR0aDsKCQl0aGlzLnZpZXcuaGVpZ2h0ID0gaGVpZ2h0OwoKCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgl9CgoJY2xlYXJWaWV3T2Zmc2V0KCkgewoKCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCApIHsKCgkJCXRoaXMudmlldy5lbmFibGVkID0gZmFsc2U7CgoJCX0KCgkJdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgoJfQoKCXVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKSB7CgoJCWNvbnN0IG5lYXIgPSB0aGlzLm5lYXI7CgkJbGV0IHRvcCA9IG5lYXIgKiBNYXRoLnRhbiggREVHMlJBRCAqIDAuNSAqIHRoaXMuZm92ICkgLyB0aGlzLnpvb207CgkJbGV0IGhlaWdodCA9IDIgKiB0b3A7CgkJbGV0IHdpZHRoID0gdGhpcy5hc3BlY3QgKiBoZWlnaHQ7CgkJbGV0IGxlZnQgPSAtIDAuNSAqIHdpZHRoOwoJCWNvbnN0IHZpZXcgPSB0aGlzLnZpZXc7CgoJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICYmIHRoaXMudmlldy5lbmFibGVkICkgewoKCQkJY29uc3QgZnVsbFdpZHRoID0gdmlldy5mdWxsV2lkdGgsCgkJCQlmdWxsSGVpZ2h0ID0gdmlldy5mdWxsSGVpZ2h0OwoKCQkJbGVmdCArPSB2aWV3Lm9mZnNldFggKiB3aWR0aCAvIGZ1bGxXaWR0aDsKCQkJdG9wIC09IHZpZXcub2Zmc2V0WSAqIGhlaWdodCAvIGZ1bGxIZWlnaHQ7CgkJCXdpZHRoICo9IHZpZXcud2lkdGggLyBmdWxsV2lkdGg7CgkJCWhlaWdodCAqPSB2aWV3LmhlaWdodCAvIGZ1bGxIZWlnaHQ7CgoJCX0KCgkJY29uc3Qgc2tldyA9IHRoaXMuZmlsbU9mZnNldDsKCQlpZiAoIHNrZXcgIT09IDAgKSBsZWZ0ICs9IG5lYXIgKiBza2V3IC8gdGhpcy5nZXRGaWxtV2lkdGgoKTsKCgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4Lm1ha2VQZXJzcGVjdGl2ZSggbGVmdCwgbGVmdCArIHdpZHRoLCB0b3AsIHRvcCAtIGhlaWdodCwgbmVhciwgdGhpcy5mYXIsIHRoaXMuY29vcmRpbmF0ZVN5c3RlbSApOwoKCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJZGF0YS5vYmplY3QuZm92ID0gdGhpcy5mb3Y7CgkJZGF0YS5vYmplY3Quem9vbSA9IHRoaXMuem9vbTsKCgkJZGF0YS5vYmplY3QubmVhciA9IHRoaXMubmVhcjsKCQlkYXRhLm9iamVjdC5mYXIgPSB0aGlzLmZhcjsKCQlkYXRhLm9iamVjdC5mb2N1cyA9IHRoaXMuZm9jdXM7CgoJCWRhdGEub2JqZWN0LmFzcGVjdCA9IHRoaXMuYXNwZWN0OwoKCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCApIGRhdGEub2JqZWN0LnZpZXcgPSBPYmplY3QuYXNzaWduKCB7fSwgdGhpcy52aWV3ICk7CgoJCWRhdGEub2JqZWN0LmZpbG1HYXVnZSA9IHRoaXMuZmlsbUdhdWdlOwoJCWRhdGEub2JqZWN0LmZpbG1PZmZzZXQgPSB0aGlzLmZpbG1PZmZzZXQ7CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNvbnN0IGZvdiA9IC0gOTA7IC8vIG5lZ2F0aXZlIGZvdiBpcyBub3QgYW4gZXJyb3IKY29uc3QgYXNwZWN0ID0gMTsKCmNsYXNzIEN1YmVDYW1lcmEgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoIG5lYXIsIGZhciwgcmVuZGVyVGFyZ2V0ICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnQ3ViZUNhbWVyYSc7CgoJCXRoaXMucmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoJCXRoaXMuY29vcmRpbmF0ZVN5c3RlbSA9IG51bGw7CgkJdGhpcy5hY3RpdmVNaXBtYXBMZXZlbCA9IDA7CgoJCWNvbnN0IGNhbWVyYVBYID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhUFgubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYVBYICk7CgoJCWNvbnN0IGNhbWVyYU5YID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhTlgubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYU5YICk7CgoJCWNvbnN0IGNhbWVyYVBZID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhUFkubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYVBZICk7CgoJCWNvbnN0IGNhbWVyYU5ZID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhTlkubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYU5ZICk7CgoJCWNvbnN0IGNhbWVyYVBaID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhUFoubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYVBaICk7CgoJCWNvbnN0IGNhbWVyYU5aID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhTloubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYU5aICk7CgoJfQoKCXVwZGF0ZUNvb3JkaW5hdGVTeXN0ZW0oKSB7CgoJCWNvbnN0IGNvb3JkaW5hdGVTeXN0ZW0gPSB0aGlzLmNvb3JkaW5hdGVTeXN0ZW07CgoJCWNvbnN0IGNhbWVyYXMgPSB0aGlzLmNoaWxkcmVuLmNvbmNhdCgpOwoKCQljb25zdCBbIGNhbWVyYVBYLCBjYW1lcmFOWCwgY2FtZXJhUFksIGNhbWVyYU5ZLCBjYW1lcmFQWiwgY2FtZXJhTlogXSA9IGNhbWVyYXM7CgoJCWZvciAoIGNvbnN0IGNhbWVyYSBvZiBjYW1lcmFzICkgdGhpcy5yZW1vdmUoIGNhbWVyYSApOwoKCQlpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCWNhbWVyYVBYLnVwLnNldCggMCwgMSwgMCApOwoJCQljYW1lcmFQWC5sb29rQXQoIDEsIDAsIDAgKTsKCgkJCWNhbWVyYU5YLnVwLnNldCggMCwgMSwgMCApOwoJCQljYW1lcmFOWC5sb29rQXQoIC0gMSwgMCwgMCApOwoKCQkJY2FtZXJhUFkudXAuc2V0KCAwLCAwLCAtIDEgKTsKCQkJY2FtZXJhUFkubG9va0F0KCAwLCAxLCAwICk7CgoJCQljYW1lcmFOWS51cC5zZXQoIDAsIDAsIDEgKTsKCQkJY2FtZXJhTlkubG9va0F0KCAwLCAtIDEsIDAgKTsKCgkJCWNhbWVyYVBaLnVwLnNldCggMCwgMSwgMCApOwoJCQljYW1lcmFQWi5sb29rQXQoIDAsIDAsIDEgKTsKCgkJCWNhbWVyYU5aLnVwLnNldCggMCwgMSwgMCApOwoJCQljYW1lcmFOWi5sb29rQXQoIDAsIDAsIC0gMSApOwoKCQl9IGVsc2UgaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHUFVDb29yZGluYXRlU3lzdGVtICkgewoKCQkJY2FtZXJhUFgudXAuc2V0KCAwLCAtIDEsIDAgKTsKCQkJY2FtZXJhUFgubG9va0F0KCAtIDEsIDAsIDAgKTsKCgkJCWNhbWVyYU5YLnVwLnNldCggMCwgLSAxLCAwICk7CgkJCWNhbWVyYU5YLmxvb2tBdCggMSwgMCwgMCApOwoKCQkJY2FtZXJhUFkudXAuc2V0KCAwLCAwLCAxICk7CgkJCWNhbWVyYVBZLmxvb2tBdCggMCwgMSwgMCApOwoKCQkJY2FtZXJhTlkudXAuc2V0KCAwLCAwLCAtIDEgKTsKCQkJY2FtZXJhTlkubG9va0F0KCAwLCAtIDEsIDAgKTsKCgkJCWNhbWVyYVBaLnVwLnNldCggMCwgLSAxLCAwICk7CgkJCWNhbWVyYVBaLmxvb2tBdCggMCwgMCwgMSApOwoKCQkJY2FtZXJhTloudXAuc2V0KCAwLCAtIDEsIDAgKTsKCQkJY2FtZXJhTloubG9va0F0KCAwLCAwLCAtIDEgKTsKCgkJfSBlbHNlIHsKCgkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLkN1YmVDYW1lcmEudXBkYXRlQ29vcmRpbmF0ZVN5c3RlbSgpOiBJbnZhbGlkIGNvb3JkaW5hdGUgc3lzdGVtOiAnICsgY29vcmRpbmF0ZVN5c3RlbSApOwoKCQl9CgoJCWZvciAoIGNvbnN0IGNhbWVyYSBvZiBjYW1lcmFzICkgewoKCQkJdGhpcy5hZGQoIGNhbWVyYSApOwoKCQkJY2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCX0KCgl9CgoJdXBkYXRlKCByZW5kZXJlciwgc2NlbmUgKSB7CgoJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB0aGlzLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCWNvbnN0IHsgcmVuZGVyVGFyZ2V0LCBhY3RpdmVNaXBtYXBMZXZlbCB9ID0gdGhpczsKCgkJaWYgKCB0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gIT09IHJlbmRlcmVyLmNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQl0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gPSByZW5kZXJlci5jb29yZGluYXRlU3lzdGVtOwoKCQkJdGhpcy51cGRhdGVDb29yZGluYXRlU3lzdGVtKCk7CgoJCX0KCgkJY29uc3QgWyBjYW1lcmFQWCwgY2FtZXJhTlgsIGNhbWVyYVBZLCBjYW1lcmFOWSwgY2FtZXJhUFosIGNhbWVyYU5aIF0gPSB0aGlzLmNoaWxkcmVuOwoKCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgkJY29uc3QgY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKCQljb25zdCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSByZW5kZXJlci5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwoKCQljb25zdCBjdXJyZW50WHJFbmFibGVkID0gcmVuZGVyZXIueHIuZW5hYmxlZDsKCgkJcmVuZGVyZXIueHIuZW5hYmxlZCA9IGZhbHNlOwoKCQljb25zdCBnZW5lcmF0ZU1pcG1hcHMgPSByZW5kZXJUYXJnZXQudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHM7CgoJCXJlbmRlclRhcmdldC50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMCwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWCApOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMSwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFOWCApOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMiwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWSApOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMywgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFOWSApOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgNCwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWiApOwoKCQkvLyBtaXBtYXBzIGFyZSBnZW5lcmF0ZWQgZHVyaW5nIHRoZSBsYXN0IGNhbGwgb2YgcmVuZGVyKCkKCQkvLyBhdCB0aGlzIHBvaW50LCBhbGwgc2lkZXMgb2YgdGhlIGN1YmUgcmVuZGVyIHRhcmdldCBhcmUgZGVmaW5lZAoKCQlyZW5kZXJUYXJnZXQudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBnZW5lcmF0ZU1pcG1hcHM7CgoJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCA1LCBhY3RpdmVNaXBtYXBMZXZlbCApOwoJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYU5aICk7CgoJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgY3VycmVudEFjdGl2ZUN1YmVGYWNlLCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgKTsKCgkJcmVuZGVyZXIueHIuZW5hYmxlZCA9IGN1cnJlbnRYckVuYWJsZWQ7CgoJCXJlbmRlclRhcmdldC50ZXh0dXJlLm5lZWRzUE1SRU1VcGRhdGUgPSB0cnVlOwoKCX0KCn0KCmNsYXNzIEN1YmVUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIGltYWdlcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICkgewoKCQlpbWFnZXMgPSBpbWFnZXMgIT09IHVuZGVmaW5lZCA/IGltYWdlcyA6IFtdOwoJCW1hcHBpbmcgPSBtYXBwaW5nICE9PSB1bmRlZmluZWQgPyBtYXBwaW5nIDogQ3ViZVJlZmxlY3Rpb25NYXBwaW5nOwoKCQlzdXBlciggaW1hZ2VzLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHksIGNvbG9yU3BhY2UgKTsKCgkJdGhpcy5pc0N1YmVUZXh0dXJlID0gdHJ1ZTsKCgkJdGhpcy5mbGlwWSA9IGZhbHNlOwoKCX0KCglnZXQgaW1hZ2VzKCkgewoKCQlyZXR1cm4gdGhpcy5pbWFnZTsKCgl9CgoJc2V0IGltYWdlcyggdmFsdWUgKSB7CgoJCXRoaXMuaW1hZ2UgPSB2YWx1ZTsKCgl9Cgp9CgpjbGFzcyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQgZXh0ZW5kcyBXZWJHTFJlbmRlclRhcmdldCB7CgoJY29uc3RydWN0b3IoIHNpemUgPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCXN1cGVyKCBzaXplLCBzaXplLCBvcHRpb25zICk7CgoJCXRoaXMuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgPSB0cnVlOwoKCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHNpemUsIGhlaWdodDogc2l6ZSwgZGVwdGg6IDEgfTsKCQljb25zdCBpbWFnZXMgPSBbIGltYWdlLCBpbWFnZSwgaW1hZ2UsIGltYWdlLCBpbWFnZSwgaW1hZ2UgXTsKCgkJaWYgKCBvcHRpb25zLmVuY29kaW5nICE9PSB1bmRlZmluZWQgKSB7CgoJCQkvLyBAZGVwcmVjYXRlZCwgcjE1MgoJCQl3YXJuT25jZSggJ1RIUkVFLldlYkdMQ3ViZVJlbmRlclRhcmdldDogb3B0aW9uLmVuY29kaW5nIGhhcyBiZWVuIHJlcGxhY2VkIGJ5IG9wdGlvbi5jb2xvclNwYWNlLicgKTsKCQkJb3B0aW9ucy5jb2xvclNwYWNlID0gb3B0aW9ucy5lbmNvZGluZyA9PT0gc1JHQkVuY29kaW5nID8gU1JHQkNvbG9yU3BhY2UgOiBOb0NvbG9yU3BhY2U7CgoJCX0KCgkJdGhpcy50ZXh0dXJlID0gbmV3IEN1YmVUZXh0dXJlKCBpbWFnZXMsIG9wdGlvbnMubWFwcGluZywgb3B0aW9ucy53cmFwUywgb3B0aW9ucy53cmFwVCwgb3B0aW9ucy5tYWdGaWx0ZXIsIG9wdGlvbnMubWluRmlsdGVyLCBvcHRpb25zLmZvcm1hdCwgb3B0aW9ucy50eXBlLCBvcHRpb25zLmFuaXNvdHJvcHksIG9wdGlvbnMuY29sb3JTcGFjZSApOwoKCQkvLyBCeSBjb252ZW50aW9uIC0tIGxpa2VseSBiYXNlZCBvbiB0aGUgUmVuZGVyTWFuIHNwZWMgZnJvbSB0aGUgMTk5MCdzIC0tIGN1YmUgbWFwcyBhcmUgc3BlY2lmaWVkIGJ5IFdlYkdMIChhbmQgdGhyZWUuanMpCgkJLy8gaW4gYSBjb29yZGluYXRlIHN5c3RlbSBpbiB3aGljaCBwb3NpdGl2ZS14IGlzIHRvIHRoZSByaWdodCB3aGVuIGxvb2tpbmcgdXAgdGhlIHBvc2l0aXZlLXogYXhpcyAtLSBpbiBvdGhlciB3b3JkcywKCQkvLyBpbiBhIGxlZnQtaGFuZGVkIGNvb3JkaW5hdGUgc3lzdGVtLiBCeSBjb250aW51aW5nIHRoaXMgY29udmVudGlvbiwgcHJlZXhpc3RpbmcgY3ViZSBtYXBzIGNvbnRpbnVlZCB0byByZW5kZXIgY29ycmVjdGx5LgoKCQkvLyB0aHJlZS5qcyB1c2VzIGEgcmlnaHQtaGFuZGVkIGNvb3JkaW5hdGUgc3lzdGVtLiBTbyBlbnZpcm9ubWVudCBtYXBzIHVzZWQgaW4gdGhyZWUuanMgYXBwZWFyIHRvIGhhdmUgcHggYW5kIG54IHN3YXBwZWQKCQkvLyBhbmQgdGhlIGZsYWcgaXNSZW5kZXJUYXJnZXRUZXh0dXJlIGNvbnRyb2xzIHRoaXMgY29udmVyc2lvbi4gVGhlIGZsaXAgaXMgbm90IHJlcXVpcmVkIHdoZW4gdXNpbmcgV2ViR0xDdWJlUmVuZGVyVGFyZ2V0LnRleHR1cmUKCQkvLyBhcyBhIGN1YmUgdGV4dHVyZSAodGhpcyBpcyBkZXRlY3RlZCB3aGVuIGlzUmVuZGVyVGFyZ2V0VGV4dHVyZSBpcyBzZXQgdG8gdHJ1ZSBmb3IgY3ViZSB0ZXh0dXJlcykuCgoJCXRoaXMudGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwoKCQl0aGlzLnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gb3B0aW9ucy5nZW5lcmF0ZU1pcG1hcHMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuZ2VuZXJhdGVNaXBtYXBzIDogZmFsc2U7CgkJdGhpcy50ZXh0dXJlLm1pbkZpbHRlciA9IG9wdGlvbnMubWluRmlsdGVyICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLm1pbkZpbHRlciA6IExpbmVhckZpbHRlcjsKCgl9CgoJZnJvbUVxdWlyZWN0YW5ndWxhclRleHR1cmUoIHJlbmRlcmVyLCB0ZXh0dXJlICkgewoKCQl0aGlzLnRleHR1cmUudHlwZSA9IHRleHR1cmUudHlwZTsKCQl0aGlzLnRleHR1cmUuY29sb3JTcGFjZSA9IHRleHR1cmUuY29sb3JTcGFjZTsKCgkJdGhpcy50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoJCXRoaXMudGV4dHVyZS5taW5GaWx0ZXIgPSB0ZXh0dXJlLm1pbkZpbHRlcjsKCQl0aGlzLnRleHR1cmUubWFnRmlsdGVyID0gdGV4dHVyZS5tYWdGaWx0ZXI7CgoJCWNvbnN0IHNoYWRlciA9IHsKCgkJCXVuaWZvcm1zOiB7CgkJCQl0RXF1aXJlY3Q6IHsgdmFsdWU6IG51bGwgfSwKCQkJfSwKCgkJCXZlcnRleFNoYWRlcjogLyogZ2xzbCAqL2AKCgkJCQl2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uOwoKCQkJCXZlYzMgdHJhbnNmb3JtRGlyZWN0aW9uKCBpbiB2ZWMzIGRpciwgaW4gbWF0NCBtYXRyaXggKSB7CgoJCQkJCXJldHVybiBub3JtYWxpemUoICggbWF0cml4ICogdmVjNCggZGlyLCAwLjAgKSApLnh5eiApOwoKCQkJCX0KCgkJCQl2b2lkIG1haW4oKSB7CgoJCQkJCXZXb3JsZERpcmVjdGlvbiA9IHRyYW5zZm9ybURpcmVjdGlvbiggcG9zaXRpb24sIG1vZGVsTWF0cml4ICk7CgoJCQkJCSNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+CgkJCQkJI2luY2x1ZGUgPHByb2plY3RfdmVydGV4PgoKCQkJCX0KCQkJYCwKCgkJCWZyYWdtZW50U2hhZGVyOiAvKiBnbHNsICovYAoKCQkJCXVuaWZvcm0gc2FtcGxlcjJEIHRFcXVpcmVjdDsKCgkJCQl2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uOwoKCQkJCSNpbmNsdWRlIDxjb21tb24+CgoJCQkJdm9pZCBtYWluKCkgewoKCQkJCQl2ZWMzIGRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggdldvcmxkRGlyZWN0aW9uICk7CgoJCQkJCXZlYzIgc2FtcGxlVVYgPSBlcXVpcmVjdFV2KCBkaXJlY3Rpb24gKTsKCgkJCQkJZ2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKCB0RXF1aXJlY3QsIHNhbXBsZVVWICk7CgoJCQkJfQoJCQlgCgkJfTsKCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgQm94R2VvbWV0cnkoIDUsIDUsIDUgKTsKCgkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCgkJCW5hbWU6ICdDdWJlbWFwRnJvbUVxdWlyZWN0JywKCgkJCXVuaWZvcm1zOiBjbG9uZVVuaWZvcm1zKCBzaGFkZXIudW5pZm9ybXMgKSwKCQkJdmVydGV4U2hhZGVyOiBzaGFkZXIudmVydGV4U2hhZGVyLAoJCQlmcmFnbWVudFNoYWRlcjogc2hhZGVyLmZyYWdtZW50U2hhZGVyLAoJCQlzaWRlOiBCYWNrU2lkZSwKCQkJYmxlbmRpbmc6IE5vQmxlbmRpbmcKCgkJfSApOwoKCQltYXRlcmlhbC51bmlmb3Jtcy50RXF1aXJlY3QudmFsdWUgPSB0ZXh0dXJlOwoKCQljb25zdCBtZXNoID0gbmV3IE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQljb25zdCBjdXJyZW50TWluRmlsdGVyID0gdGV4dHVyZS5taW5GaWx0ZXI7CgoJCS8vIEF2b2lkIGJsdXJyZWQgcG9sZXMKCQlpZiAoIHRleHR1cmUubWluRmlsdGVyID09PSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgKSB0ZXh0dXJlLm1pbkZpbHRlciA9IExpbmVhckZpbHRlcjsKCgkJY29uc3QgY2FtZXJhID0gbmV3IEN1YmVDYW1lcmEoIDEsIDEwLCB0aGlzICk7CgkJY2FtZXJhLnVwZGF0ZSggcmVuZGVyZXIsIG1lc2ggKTsKCgkJdGV4dHVyZS5taW5GaWx0ZXIgPSBjdXJyZW50TWluRmlsdGVyOwoKCQltZXNoLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQltZXNoLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsZWFyKCByZW5kZXJlciwgY29sb3IsIGRlcHRoLCBzdGVuY2lsICkgewoKCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHRoaXMsIGkgKTsKCgkJCXJlbmRlcmVyLmNsZWFyKCBjb2xvciwgZGVwdGgsIHN0ZW5jaWwgKTsKCgkJfQoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgl9Cgp9Cgpjb25zdCBfdmVjdG9yMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZlY3RvcjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9ub3JtYWxNYXRyaXggPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCk7CgpjbGFzcyBQbGFuZSB7CgoJY29uc3RydWN0b3IoIG5vcm1hbCA9IG5ldyBWZWN0b3IzKCAxLCAwLCAwICksIGNvbnN0YW50ID0gMCApIHsKCgkJdGhpcy5pc1BsYW5lID0gdHJ1ZTsKCgkJLy8gbm9ybWFsIGlzIGFzc3VtZWQgdG8gYmUgbm9ybWFsaXplZAoKCQl0aGlzLm5vcm1hbCA9IG5vcm1hbDsKCQl0aGlzLmNvbnN0YW50ID0gY29uc3RhbnQ7CgoJfQoKCXNldCggbm9ybWFsLCBjb25zdGFudCApIHsKCgkJdGhpcy5ub3JtYWwuY29weSggbm9ybWFsICk7CgkJdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0Q29tcG9uZW50cyggeCwgeSwgeiwgdyApIHsKCgkJdGhpcy5ub3JtYWwuc2V0KCB4LCB5LCB6ICk7CgkJdGhpcy5jb25zdGFudCA9IHc7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludCggbm9ybWFsLCBwb2ludCApIHsKCgkJdGhpcy5ub3JtYWwuY29weSggbm9ybWFsICk7CgkJdGhpcy5jb25zdGFudCA9IC0gcG9pbnQuZG90KCB0aGlzLm5vcm1hbCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbUNvcGxhbmFyUG9pbnRzKCBhLCBiLCBjICkgewoKCQljb25zdCBub3JtYWwgPSBfdmVjdG9yMS5zdWJWZWN0b3JzKCBjLCBiICkuY3Jvc3MoIF92ZWN0b3IyLnN1YlZlY3RvcnMoIGEsIGIgKSApLm5vcm1hbGl6ZSgpOwoKCQkvLyBROiBzaG91bGQgYW4gZXJyb3IgYmUgdGhyb3duIGlmIG5vcm1hbCBpcyB6ZXJvIChlLmcuIGRlZ2VuZXJhdGUgcGxhbmUpPwoKCQl0aGlzLnNldEZyb21Ob3JtYWxBbmRDb3BsYW5hclBvaW50KCBub3JtYWwsIGEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIHBsYW5lICkgewoKCQl0aGlzLm5vcm1hbC5jb3B5KCBwbGFuZS5ub3JtYWwgKTsKCQl0aGlzLmNvbnN0YW50ID0gcGxhbmUuY29uc3RhbnQ7CgoJCXJldHVybiB0aGlzOwoKCX0KCglub3JtYWxpemUoKSB7CgoJCS8vIE5vdGU6IHdpbGwgbGVhZCB0byBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBwbGFuZSBpcyBpbnZhbGlkLgoKCQljb25zdCBpbnZlcnNlTm9ybWFsTGVuZ3RoID0gMS4wIC8gdGhpcy5ub3JtYWwubGVuZ3RoKCk7CgkJdGhpcy5ub3JtYWwubXVsdGlwbHlTY2FsYXIoIGludmVyc2VOb3JtYWxMZW5ndGggKTsKCQl0aGlzLmNvbnN0YW50ICo9IGludmVyc2VOb3JtYWxMZW5ndGg7CgoJCXJldHVybiB0aGlzOwoKCX0KCgluZWdhdGUoKSB7CgoJCXRoaXMuY29uc3RhbnQgKj0gLSAxOwoJCXRoaXMubm9ybWFsLm5lZ2F0ZSgpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuIHRoaXMubm9ybWFsLmRvdCggcG9pbnQgKSArIHRoaXMuY29uc3RhbnQ7CgoJfQoKCWRpc3RhbmNlVG9TcGhlcmUoIHNwaGVyZSApIHsKCgkJcmV0dXJuIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBzcGhlcmUuY2VudGVyICkgLSBzcGhlcmUucmFkaXVzOwoKCX0KCglwcm9qZWN0UG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCXJldHVybiB0YXJnZXQuY29weSggcG9pbnQgKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMubm9ybWFsLCAtIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBwb2ludCApICk7CgoJfQoKCWludGVyc2VjdExpbmUoIGxpbmUsIHRhcmdldCApIHsKCgkJY29uc3QgZGlyZWN0aW9uID0gbGluZS5kZWx0YSggX3ZlY3RvcjEgKTsKCgkJY29uc3QgZGVub21pbmF0b3IgPSB0aGlzLm5vcm1hbC5kb3QoIGRpcmVjdGlvbiApOwoKCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgewoKCQkJLy8gbGluZSBpcyBjb3BsYW5hciwgcmV0dXJuIG9yaWdpbgoJCQlpZiAoIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICkgPT09IDAgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBsaW5lLnN0YXJ0ICk7CgoJCQl9CgoJCQkvLyBVbnN1cmUgaWYgdGhpcyBpcyB0aGUgY29ycmVjdCBtZXRob2QgdG8gaGFuZGxlIHRoaXMgY2FzZS4KCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJY29uc3QgdCA9IC0gKCBsaW5lLnN0YXJ0LmRvdCggdGhpcy5ub3JtYWwgKSArIHRoaXMuY29uc3RhbnQgKSAvIGRlbm9taW5hdG9yOwoKCQlpZiAoIHQgPCAwIHx8IHQgPiAxICkgewoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJcmV0dXJuIHRhcmdldC5jb3B5KCBsaW5lLnN0YXJ0ICkuYWRkU2NhbGVkVmVjdG9yKCBkaXJlY3Rpb24sIHQgKTsKCgl9CgoJaW50ZXJzZWN0c0xpbmUoIGxpbmUgKSB7CgoJCS8vIE5vdGU6IHRoaXMgdGVzdHMgaWYgYSBsaW5lIGludGVyc2VjdHMgdGhlIHBsYW5lLCBub3Qgd2hldGhlciBpdCAob3IgaXRzIGVuZC1wb2ludHMpIGFyZSBjb3BsYW5hciB3aXRoIGl0LgoKCQljb25zdCBzdGFydFNpZ24gPSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggbGluZS5zdGFydCApOwoJCWNvbnN0IGVuZFNpZ24gPSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggbGluZS5lbmQgKTsKCgkJcmV0dXJuICggc3RhcnRTaWduIDwgMCAmJiBlbmRTaWduID4gMCApIHx8ICggZW5kU2lnbiA8IDAgJiYgc3RhcnRTaWduID4gMCApOwoKCX0KCglpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCXJldHVybiBib3guaW50ZXJzZWN0c1BsYW5lKCB0aGlzICk7CgoJfQoKCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCgkJcmV0dXJuIHNwaGVyZS5pbnRlcnNlY3RzUGxhbmUoIHRoaXMgKTsKCgl9CgoJY29wbGFuYXJQb2ludCggdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHRoaXMubm9ybWFsICkubXVsdGlwbHlTY2FsYXIoIC0gdGhpcy5jb25zdGFudCApOwoKCX0KCglhcHBseU1hdHJpeDQoIG1hdHJpeCwgb3B0aW9uYWxOb3JtYWxNYXRyaXggKSB7CgoJCWNvbnN0IG5vcm1hbE1hdHJpeCA9IG9wdGlvbmFsTm9ybWFsTWF0cml4IHx8IF9ub3JtYWxNYXRyaXguZ2V0Tm9ybWFsTWF0cml4KCBtYXRyaXggKTsKCgkJY29uc3QgcmVmZXJlbmNlUG9pbnQgPSB0aGlzLmNvcGxhbmFyUG9pbnQoIF92ZWN0b3IxICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsKCgkJY29uc3Qgbm9ybWFsID0gdGhpcy5ub3JtYWwuYXBwbHlNYXRyaXgzKCBub3JtYWxNYXRyaXggKS5ub3JtYWxpemUoKTsKCgkJdGhpcy5jb25zdGFudCA9IC0gcmVmZXJlbmNlUG9pbnQuZG90KCBub3JtYWwgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyYW5zbGF0ZSggb2Zmc2V0ICkgewoKCQl0aGlzLmNvbnN0YW50IC09IG9mZnNldC5kb3QoIHRoaXMubm9ybWFsICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIHBsYW5lICkgewoKCQlyZXR1cm4gcGxhbmUubm9ybWFsLmVxdWFscyggdGhpcy5ub3JtYWwgKSAmJiAoIHBsYW5lLmNvbnN0YW50ID09PSB0aGlzLmNvbnN0YW50ICk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKfQoKY29uc3QgX3NwaGVyZSQ1ID0gLypAX19QVVJFX18qLyBuZXcgU3BoZXJlKCk7CmNvbnN0IF92ZWN0b3IkNyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIEZydXN0dW0gewoKCWNvbnN0cnVjdG9yKCBwMCA9IG5ldyBQbGFuZSgpLCBwMSA9IG5ldyBQbGFuZSgpLCBwMiA9IG5ldyBQbGFuZSgpLCBwMyA9IG5ldyBQbGFuZSgpLCBwNCA9IG5ldyBQbGFuZSgpLCBwNSA9IG5ldyBQbGFuZSgpICkgewoKCQl0aGlzLnBsYW5lcyA9IFsgcDAsIHAxLCBwMiwgcDMsIHA0LCBwNSBdOwoKCX0KCglzZXQoIHAwLCBwMSwgcDIsIHAzLCBwNCwgcDUgKSB7CgoJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwoKCQlwbGFuZXNbIDAgXS5jb3B5KCBwMCApOwoJCXBsYW5lc1sgMSBdLmNvcHkoIHAxICk7CgkJcGxhbmVzWyAyIF0uY29weSggcDIgKTsKCQlwbGFuZXNbIDMgXS5jb3B5KCBwMyApOwoJCXBsYW5lc1sgNCBdLmNvcHkoIHA0ICk7CgkJcGxhbmVzWyA1IF0uY29weSggcDUgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIGZydXN0dW0gKSB7CgoJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJcGxhbmVzWyBpIF0uY29weSggZnJ1c3R1bS5wbGFuZXNbIGkgXSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggbSwgY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgkJY29uc3QgbWUgPSBtLmVsZW1lbnRzOwoJCWNvbnN0IG1lMCA9IG1lWyAwIF0sIG1lMSA9IG1lWyAxIF0sIG1lMiA9IG1lWyAyIF0sIG1lMyA9IG1lWyAzIF07CgkJY29uc3QgbWU0ID0gbWVbIDQgXSwgbWU1ID0gbWVbIDUgXSwgbWU2ID0gbWVbIDYgXSwgbWU3ID0gbWVbIDcgXTsKCQljb25zdCBtZTggPSBtZVsgOCBdLCBtZTkgPSBtZVsgOSBdLCBtZTEwID0gbWVbIDEwIF0sIG1lMTEgPSBtZVsgMTEgXTsKCQljb25zdCBtZTEyID0gbWVbIDEyIF0sIG1lMTMgPSBtZVsgMTMgXSwgbWUxNCA9IG1lWyAxNCBdLCBtZTE1ID0gbWVbIDE1IF07CgoJCXBsYW5lc1sgMCBdLnNldENvbXBvbmVudHMoIG1lMyAtIG1lMCwgbWU3IC0gbWU0LCBtZTExIC0gbWU4LCBtZTE1IC0gbWUxMiApLm5vcm1hbGl6ZSgpOwoJCXBsYW5lc1sgMSBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMCwgbWU3ICsgbWU0LCBtZTExICsgbWU4LCBtZTE1ICsgbWUxMiApLm5vcm1hbGl6ZSgpOwoJCXBsYW5lc1sgMiBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMSwgbWU3ICsgbWU1LCBtZTExICsgbWU5LCBtZTE1ICsgbWUxMyApLm5vcm1hbGl6ZSgpOwoJCXBsYW5lc1sgMyBdLnNldENvbXBvbmVudHMoIG1lMyAtIG1lMSwgbWU3IC0gbWU1LCBtZTExIC0gbWU5LCBtZTE1IC0gbWUxMyApLm5vcm1hbGl6ZSgpOwoJCXBsYW5lc1sgNCBdLnNldENvbXBvbmVudHMoIG1lMyAtIG1lMiwgbWU3IC0gbWU2LCBtZTExIC0gbWUxMCwgbWUxNSAtIG1lMTQgKS5ub3JtYWxpemUoKTsKCgkJaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQlwbGFuZXNbIDUgXS5zZXRDb21wb25lbnRzKCBtZTMgKyBtZTIsIG1lNyArIG1lNiwgbWUxMSArIG1lMTAsIG1lMTUgKyBtZTE0ICkubm9ybWFsaXplKCk7CgoJCX0gZWxzZSBpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQlwbGFuZXNbIDUgXS5zZXRDb21wb25lbnRzKCBtZTIsIG1lNiwgbWUxMCwgbWUxNCApLm5vcm1hbGl6ZSgpOwoKCQl9IGVsc2UgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuRnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCgpOiBJbnZhbGlkIGNvb3JkaW5hdGUgc3lzdGVtOiAnICsgY29vcmRpbmF0ZVN5c3RlbSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglpbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSB7CgoJCWlmICggb2JqZWN0LmJvdW5kaW5nU3BoZXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIG9iamVjdC5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJCV9zcGhlcmUkNS5jb3B5KCBvYmplY3QuYm91bmRpbmdTcGhlcmUgKS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQl9IGVsc2UgewoKCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgoJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCQlfc3BoZXJlJDUuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQl9CgoJCXJldHVybiB0aGlzLmludGVyc2VjdHNTcGhlcmUoIF9zcGhlcmUkNSApOwoKCX0KCglpbnRlcnNlY3RzU3ByaXRlKCBzcHJpdGUgKSB7CgoJCV9zcGhlcmUkNS5jZW50ZXIuc2V0KCAwLCAwLCAwICk7CgkJX3NwaGVyZSQ1LnJhZGl1cyA9IDAuNzA3MTA2NzgxMTg2NTQ3NjsKCQlfc3BoZXJlJDUuYXBwbHlNYXRyaXg0KCBzcHJpdGUubWF0cml4V29ybGQgKTsKCgkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQ1ICk7CgoJfQoKCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCgkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgkJY29uc3QgY2VudGVyID0gc3BoZXJlLmNlbnRlcjsKCQljb25zdCBuZWdSYWRpdXMgPSAtIHNwaGVyZS5yYWRpdXM7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQljb25zdCBkaXN0YW5jZSA9IHBsYW5lc1sgaSBdLmRpc3RhbmNlVG9Qb2ludCggY2VudGVyICk7CgoJCQlpZiAoIGRpc3RhbmNlIDwgbmVnUmFkaXVzICkgewoKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCWNvbnN0IHBsYW5lID0gcGxhbmVzWyBpIF07CgoJCQkvLyBjb3JuZXIgYXQgbWF4IGRpc3RhbmNlCgoJCQlfdmVjdG9yJDcueCA9IHBsYW5lLm5vcm1hbC54ID4gMCA/IGJveC5tYXgueCA6IGJveC5taW4ueDsKCQkJX3ZlY3RvciQ3LnkgPSBwbGFuZS5ub3JtYWwueSA+IDAgPyBib3gubWF4LnkgOiBib3gubWluLnk7CgkJCV92ZWN0b3IkNy56ID0gcGxhbmUubm9ybWFsLnogPiAwID8gYm94Lm1heC56IDogYm94Lm1pbi56OwoKCQkJaWYgKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIF92ZWN0b3IkNyApIDwgMCApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRydWU7CgoJfQoKCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCWlmICggcGxhbmVzWyBpIF0uZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIDwgMCApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRydWU7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKfQoKZnVuY3Rpb24gV2ViR0xBbmltYXRpb24oKSB7CgoJbGV0IGNvbnRleHQgPSBudWxsOwoJbGV0IGlzQW5pbWF0aW5nID0gZmFsc2U7CglsZXQgYW5pbWF0aW9uTG9vcCA9IG51bGw7CglsZXQgcmVxdWVzdElkID0gbnVsbDsKCglmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lLCBmcmFtZSApIHsKCgkJYW5pbWF0aW9uTG9vcCggdGltZSwgZnJhbWUgKTsKCgkJcmVxdWVzdElkID0gY29udGV4dC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIG9uQW5pbWF0aW9uRnJhbWUgKTsKCgl9CgoJcmV0dXJuIHsKCgkJc3RhcnQ6IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggaXNBbmltYXRpbmcgPT09IHRydWUgKSByZXR1cm47CgkJCWlmICggYW5pbWF0aW9uTG9vcCA9PT0gbnVsbCApIHJldHVybjsKCgkJCXJlcXVlc3RJZCA9IGNvbnRleHQucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBvbkFuaW1hdGlvbkZyYW1lICk7CgoJCQlpc0FuaW1hdGluZyA9IHRydWU7CgoJCX0sCgoJCXN0b3A6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnRleHQuY2FuY2VsQW5pbWF0aW9uRnJhbWUoIHJlcXVlc3RJZCApOwoKCQkJaXNBbmltYXRpbmcgPSBmYWxzZTsKCgkJfSwKCgkJc2V0QW5pbWF0aW9uTG9vcDogZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCWFuaW1hdGlvbkxvb3AgPSBjYWxsYmFjazsKCgkJfSwKCgkJc2V0Q29udGV4dDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWNvbnRleHQgPSB2YWx1ZTsKCgkJfQoKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTEF0dHJpYnV0ZXMoIGdsLCBjYXBhYmlsaXRpZXMgKSB7CgoJY29uc3QgaXNXZWJHTDIgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDI7CgoJY29uc3QgYnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CgoJZnVuY3Rpb24gY3JlYXRlQnVmZmVyKCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKSB7CgoJCWNvbnN0IGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCWNvbnN0IHVzYWdlID0gYXR0cmlidXRlLnVzYWdlOwoJCWNvbnN0IHNpemUgPSBhcnJheS5ieXRlTGVuZ3RoOwoKCQljb25zdCBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKCgkJZ2wuYmluZEJ1ZmZlciggYnVmZmVyVHlwZSwgYnVmZmVyICk7CgkJZ2wuYnVmZmVyRGF0YSggYnVmZmVyVHlwZSwgYXJyYXksIHVzYWdlICk7CgoJCWF0dHJpYnV0ZS5vblVwbG9hZENhbGxiYWNrKCk7CgoJCWxldCB0eXBlOwoKCQlpZiAoIGFycmF5IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5ICkgewoKCQkJdHlwZSA9IGdsLkZMT0FUOwoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQxNkFycmF5ICkgewoKCQkJaWYgKCBhdHRyaWJ1dGUuaXNGbG9hdDE2QnVmZmVyQXR0cmlidXRlICkgewoKCQkJCWlmICggaXNXZWJHTDIgKSB7CgoJCQkJCXR5cGUgPSBnbC5IQUxGX0ZMT0FUOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLldlYkdMQXR0cmlidXRlczogVXNhZ2Ugb2YgRmxvYXQxNkJ1ZmZlckF0dHJpYnV0ZSByZXF1aXJlcyBXZWJHTDIuJyApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJdHlwZSA9IGdsLlVOU0lHTkVEX1NIT1JUOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDE2QXJyYXkgKSB7CgoJCQl0eXBlID0gZ2wuU0hPUlQ7CgoJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgVWludDMyQXJyYXkgKSB7CgoJCQl0eXBlID0gZ2wuVU5TSUdORURfSU5UOwoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDMyQXJyYXkgKSB7CgoJCQl0eXBlID0gZ2wuSU5UOwoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDhBcnJheSApIHsKCgkJCXR5cGUgPSBnbC5CWVRFOwoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgKSB7CgoJCQl0eXBlID0gZ2wuVU5TSUdORURfQllURTsKCgkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheSApIHsKCgkJCXR5cGUgPSBnbC5VTlNJR05FRF9CWVRFOwoKCQl9IGVsc2UgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xBdHRyaWJ1dGVzOiBVbnN1cHBvcnRlZCBidWZmZXIgZGF0YSBmb3JtYXQ6ICcgKyBhcnJheSApOwoKCQl9CgoJCXJldHVybiB7CgkJCWJ1ZmZlcjogYnVmZmVyLAoJCQl0eXBlOiB0eXBlLAoJCQlieXRlc1BlckVsZW1lbnQ6IGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAoJCQl2ZXJzaW9uOiBhdHRyaWJ1dGUudmVyc2lvbiwKCQkJc2l6ZTogc2l6ZQoJCX07CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZUJ1ZmZlciggYnVmZmVyLCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKSB7CgoJCWNvbnN0IGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCWNvbnN0IHVwZGF0ZVJhbmdlID0gYXR0cmlidXRlLl91cGRhdGVSYW5nZTsgLy8gZGVwcmVjYXRlZAoJCWNvbnN0IHVwZGF0ZVJhbmdlcyA9IGF0dHJpYnV0ZS51cGRhdGVSYW5nZXM7CgoJCWdsLmJpbmRCdWZmZXIoIGJ1ZmZlclR5cGUsIGJ1ZmZlciApOwoKCQlpZiAoIHVwZGF0ZVJhbmdlLmNvdW50ID09PSAtIDEgJiYgdXBkYXRlUmFuZ2VzLmxlbmd0aCA9PT0gMCApIHsKCgkJCS8vIE5vdCB1c2luZyB1cGRhdGUgcmFuZ2VzCgkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIDAsIGFycmF5ICk7CgoJCX0KCgkJaWYgKCB1cGRhdGVSYW5nZXMubGVuZ3RoICE9PSAwICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgcmFuZ2UgPSB1cGRhdGVSYW5nZXNbIGkgXTsKCQkJCWlmICggaXNXZWJHTDIgKSB7CgoJCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIHJhbmdlLnN0YXJ0ICogYXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCgkJCQkJCWFycmF5LCByYW5nZS5zdGFydCwgcmFuZ2UuY291bnQgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlnbC5idWZmZXJTdWJEYXRhKCBidWZmZXJUeXBlLCByYW5nZS5zdGFydCAqIGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAoJCQkJCQlhcnJheS5zdWJhcnJheSggcmFuZ2Uuc3RhcnQsIHJhbmdlLnN0YXJ0ICsgcmFuZ2UuY291bnQgKSApOwoKCQkJCX0KCgkJCX0KCgkJCWF0dHJpYnV0ZS5jbGVhclVwZGF0ZVJhbmdlcygpOwoKCQl9CgoJCS8vIGRlcHJlY2F0ZWQKCQlpZiAoIHVwZGF0ZVJhbmdlLmNvdW50ICE9PSAtIDEgKSB7CgoJCQlpZiAoIGlzV2ViR0wyICkgewoKCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIHVwZGF0ZVJhbmdlLm9mZnNldCAqIGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAoJCQkJCWFycmF5LCB1cGRhdGVSYW5nZS5vZmZzZXQsIHVwZGF0ZVJhbmdlLmNvdW50ICk7CgoJCQl9IGVsc2UgewoKCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIHVwZGF0ZVJhbmdlLm9mZnNldCAqIGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAoJCQkJCWFycmF5LnN1YmFycmF5KCB1cGRhdGVSYW5nZS5vZmZzZXQsIHVwZGF0ZVJhbmdlLm9mZnNldCArIHVwZGF0ZVJhbmdlLmNvdW50ICkgKTsKCgkJCX0KCgkJCXVwZGF0ZVJhbmdlLmNvdW50ID0gLSAxOyAvLyByZXNldCByYW5nZQoKCQl9CgoJCWF0dHJpYnV0ZS5vblVwbG9hZENhbGxiYWNrKCk7CgoJfQoKCS8vCgoJZnVuY3Rpb24gZ2V0KCBhdHRyaWJ1dGUgKSB7CgoJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJcmV0dXJuIGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCgl9CgoJZnVuY3Rpb24gcmVtb3ZlKCBhdHRyaWJ1dGUgKSB7CgoJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJY29uc3QgZGF0YSA9IGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCgkJaWYgKCBkYXRhICkgewoKCQkJZ2wuZGVsZXRlQnVmZmVyKCBkYXRhLmJ1ZmZlciApOwoKCQkJYnVmZmVycy5kZWxldGUoIGF0dHJpYnV0ZSApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZSggYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKCQlpZiAoIGF0dHJpYnV0ZS5pc0dMQnVmZmVyQXR0cmlidXRlICkgewoKCQkJY29uc3QgY2FjaGVkID0gYnVmZmVycy5nZXQoIGF0dHJpYnV0ZSApOwoKCQkJaWYgKCAhIGNhY2hlZCB8fCBjYWNoZWQudmVyc2lvbiA8IGF0dHJpYnV0ZS52ZXJzaW9uICkgewoKCQkJCWJ1ZmZlcnMuc2V0KCBhdHRyaWJ1dGUsIHsKCQkJCQlidWZmZXI6IGF0dHJpYnV0ZS5idWZmZXIsCgkJCQkJdHlwZTogYXR0cmlidXRlLnR5cGUsCgkJCQkJYnl0ZXNQZXJFbGVtZW50OiBhdHRyaWJ1dGUuZWxlbWVudFNpemUsCgkJCQkJdmVyc2lvbjogYXR0cmlidXRlLnZlcnNpb24KCQkJCX0gKTsKCgkJCX0KCgkJCXJldHVybjsKCgkJfQoKCQlpZiAoIGF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlICkgYXR0cmlidXRlID0gYXR0cmlidXRlLmRhdGE7CgoJCWNvbnN0IGRhdGEgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgoJCWlmICggZGF0YSA9PT0gdW5kZWZpbmVkICkgewoKCQkJYnVmZmVycy5zZXQoIGF0dHJpYnV0ZSwgY3JlYXRlQnVmZmVyKCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKSApOwoKCQl9IGVsc2UgaWYgKCBkYXRhLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbiApIHsKCgkJCWlmICggZGF0YS5zaXplICE9PSBhdHRyaWJ1dGUuYXJyYXkuYnl0ZUxlbmd0aCApIHsKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5XZWJHTEF0dHJpYnV0ZXM6IFRoZSBzaXplIG9mIHRoZSBidWZmZXIgYXR0cmlidXRlXCdzIGFycmF5IGJ1ZmZlciBkb2VzIG5vdCBtYXRjaCB0aGUgb3JpZ2luYWwgc2l6ZS4gUmVzaXppbmcgYnVmZmVyIGF0dHJpYnV0ZXMgaXMgbm90IHN1cHBvcnRlZC4nICk7CgoJCQl9CgoJCQl1cGRhdGVCdWZmZXIoIGRhdGEuYnVmZmVyLCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKTsKCgkJCWRhdGEudmVyc2lvbiA9IGF0dHJpYnV0ZS52ZXJzaW9uOwoKCQl9CgoJfQoKCXJldHVybiB7CgoJCWdldDogZ2V0LAoJCXJlbW92ZTogcmVtb3ZlLAoJCXVwZGF0ZTogdXBkYXRlCgoJfTsKCn0KCmNsYXNzIFBsYW5lR2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgd2lkdGhTZWdtZW50cyA9IDEsIGhlaWdodFNlZ21lbnRzID0gMSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ1BsYW5lR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXdpZHRoOiB3aWR0aCwKCQkJaGVpZ2h0OiBoZWlnaHQsCgkJCXdpZHRoU2VnbWVudHM6IHdpZHRoU2VnbWVudHMsCgkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cwoJCX07CgoJCWNvbnN0IHdpZHRoX2hhbGYgPSB3aWR0aCAvIDI7CgkJY29uc3QgaGVpZ2h0X2hhbGYgPSBoZWlnaHQgLyAyOwoKCQljb25zdCBncmlkWCA9IE1hdGguZmxvb3IoIHdpZHRoU2VnbWVudHMgKTsKCQljb25zdCBncmlkWSA9IE1hdGguZmxvb3IoIGhlaWdodFNlZ21lbnRzICk7CgoJCWNvbnN0IGdyaWRYMSA9IGdyaWRYICsgMTsKCQljb25zdCBncmlkWTEgPSBncmlkWSArIDE7CgoJCWNvbnN0IHNlZ21lbnRfd2lkdGggPSB3aWR0aCAvIGdyaWRYOwoJCWNvbnN0IHNlZ21lbnRfaGVpZ2h0ID0gaGVpZ2h0IC8gZ3JpZFk7CgoJCS8vCgoJCWNvbnN0IGluZGljZXMgPSBbXTsKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCgkJZm9yICggbGV0IGl5ID0gMDsgaXkgPCBncmlkWTE7IGl5ICsrICkgewoKCQkJY29uc3QgeSA9IGl5ICogc2VnbWVudF9oZWlnaHQgLSBoZWlnaHRfaGFsZjsKCgkJCWZvciAoIGxldCBpeCA9IDA7IGl4IDwgZ3JpZFgxOyBpeCArKyApIHsKCgkJCQljb25zdCB4ID0gaXggKiBzZWdtZW50X3dpZHRoIC0gd2lkdGhfaGFsZjsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB4LCAtIHksIDAgKTsKCgkJCQlub3JtYWxzLnB1c2goIDAsIDAsIDEgKTsKCgkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwoJCQkJdXZzLnB1c2goIDEgLSAoIGl5IC8gZ3JpZFkgKSApOwoKCQkJfQoKCQl9CgoJCWZvciAoIGxldCBpeSA9IDA7IGl5IDwgZ3JpZFk7IGl5ICsrICkgewoKCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCBncmlkWDsgaXggKysgKSB7CgoJCQkJY29uc3QgYSA9IGl4ICsgZ3JpZFgxICogaXk7CgkJCQljb25zdCBiID0gaXggKyBncmlkWDEgKiAoIGl5ICsgMSApOwoJCQkJY29uc3QgYyA9ICggaXggKyAxICkgKyBncmlkWDEgKiAoIGl5ICsgMSApOwoJCQkJY29uc3QgZCA9ICggaXggKyAxICkgKyBncmlkWDEgKiBpeTsKCgkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKCQkJCWluZGljZXMucHVzaCggYiwgYywgZCApOwoKCQkJfQoKCQl9CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IFBsYW5lR2VvbWV0cnkoIGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0LCBkYXRhLndpZHRoU2VnbWVudHMsIGRhdGEuaGVpZ2h0U2VnbWVudHMgKTsKCgl9Cgp9Cgp2YXIgYWxwaGFoYXNoX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFIQVNIXG5cdGlmICggZGlmZnVzZUNvbG9yLmEgPCBnZXRBbHBoYUhhc2hUaHJlc2hvbGQoIHZQb3NpdGlvbiApICkgZGlzY2FyZDtcbiNlbmRpZiI7Cgp2YXIgYWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BTFBIQUhBU0hcblx0Y29uc3QgZmxvYXQgQUxQSEFfSEFTSF9TQ0FMRSA9IDAuMDU7XG5cdGZsb2F0IGhhc2gyRCggdmVjMiB2YWx1ZSApIHtcblx0XHRyZXR1cm4gZnJhY3QoIDEuMGU0ICogc2luKCAxNy4wICogdmFsdWUueCArIDAuMSAqIHZhbHVlLnkgKSAqICggMC4xICsgYWJzKCBzaW4oIDEzLjAgKiB2YWx1ZS55ICsgdmFsdWUueCApICkgKSApO1xuXHR9XG5cdGZsb2F0IGhhc2gzRCggdmVjMyB2YWx1ZSApIHtcblx0XHRyZXR1cm4gaGFzaDJEKCB2ZWMyKCBoYXNoMkQoIHZhbHVlLnh5ICksIHZhbHVlLnogKSApO1xuXHR9XG5cdGZsb2F0IGdldEFscGhhSGFzaFRocmVzaG9sZCggdmVjMyBwb3NpdGlvbiApIHtcblx0XHRmbG9hdCBtYXhEZXJpdiA9IG1heChcblx0XHRcdGxlbmd0aCggZEZkeCggcG9zaXRpb24ueHl6ICkgKSxcblx0XHRcdGxlbmd0aCggZEZkeSggcG9zaXRpb24ueHl6ICkgKVxuXHRcdCk7XG5cdFx0ZmxvYXQgcGl4U2NhbGUgPSAxLjAgLyAoIEFMUEhBX0hBU0hfU0NBTEUgKiBtYXhEZXJpdiApO1xuXHRcdHZlYzIgcGl4U2NhbGVzID0gdmVjMihcblx0XHRcdGV4cDIoIGZsb29yKCBsb2cyKCBwaXhTY2FsZSApICkgKSxcblx0XHRcdGV4cDIoIGNlaWwoIGxvZzIoIHBpeFNjYWxlICkgKSApXG5cdFx0KTtcblx0XHR2ZWMyIGFscGhhID0gdmVjMihcblx0XHRcdGhhc2gzRCggZmxvb3IoIHBpeFNjYWxlcy54ICogcG9zaXRpb24ueHl6ICkgKSxcblx0XHRcdGhhc2gzRCggZmxvb3IoIHBpeFNjYWxlcy55ICogcG9zaXRpb24ueHl6ICkgKVxuXHRcdCk7XG5cdFx0ZmxvYXQgbGVycEZhY3RvciA9IGZyYWN0KCBsb2cyKCBwaXhTY2FsZSApICk7XG5cdFx0ZmxvYXQgeCA9ICggMS4wIC0gbGVycEZhY3RvciApICogYWxwaGEueCArIGxlcnBGYWN0b3IgKiBhbHBoYS55O1xuXHRcdGZsb2F0IGEgPSBtaW4oIGxlcnBGYWN0b3IsIDEuMCAtIGxlcnBGYWN0b3IgKTtcblx0XHR2ZWMzIGNhc2VzID0gdmVjMyhcblx0XHRcdHggKiB4IC8gKCAyLjAgKiBhICogKCAxLjAgLSBhICkgKSxcblx0XHRcdCggeCAtIDAuNSAqIGEgKSAvICggMS4wIC0gYSApLFxuXHRcdFx0MS4wIC0gKCAoIDEuMCAtIHggKSAqICggMS4wIC0geCApIC8gKCAyLjAgKiBhICogKCAxLjAgLSBhICkgKSApXG5cdFx0KTtcblx0XHRmbG9hdCB0aHJlc2hvbGQgPSAoIHggPCAoIDEuMCAtIGEgKSApXG5cdFx0XHQ/ICggKCB4IDwgYSApID8gY2FzZXMueCA6IGNhc2VzLnkgKVxuXHRcdFx0OiBjYXNlcy56O1xuXHRcdHJldHVybiBjbGFtcCggdGhyZXNob2xkICwgMS4wZS02LCAxLjAgKTtcblx0fVxuI2VuZGlmIjsKCnZhciBhbHBoYW1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBTUFQXG5cdGRpZmZ1c2VDb2xvci5hICo9IHRleHR1cmUyRCggYWxwaGFNYXAsIHZBbHBoYU1hcFV2ICkuZztcbiNlbmRpZiI7Cgp2YXIgYWxwaGFtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGFscGhhTWFwO1xuI2VuZGlmIjsKCnZhciBhbHBoYXRlc3RfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BTFBIQVRFU1Rcblx0aWYgKCBkaWZmdXNlQ29sb3IuYSA8IGFscGhhVGVzdCApIGRpc2NhcmQ7XG4jZW5kaWYiOwoKdmFyIGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFURVNUXG5cdHVuaWZvcm0gZmxvYXQgYWxwaGFUZXN0O1xuI2VuZGlmIjsKCnZhciBhb21hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FPTUFQXG5cdGZsb2F0IGFtYmllbnRPY2NsdXNpb24gPSAoIHRleHR1cmUyRCggYW9NYXAsIHZBb01hcFV2ICkuciAtIDEuMCApICogYW9NYXBJbnRlbnNpdHkgKyAxLjA7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSAqPSBhbWJpZW50T2NjbHVzaW9uO1xuXHQjaWYgZGVmaW5lZCggVVNFX0NMRUFSQ09BVCApIFxuXHRcdGNsZWFyY29hdFNwZWN1bGFySW5kaXJlY3QgKj0gYW1iaWVudE9jY2x1c2lvbjtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBVU0VfU0hFRU4gKSBcblx0XHRzaGVlblNwZWN1bGFySW5kaXJlY3QgKj0gYW1iaWVudE9jY2x1c2lvbjtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgJiYgZGVmaW5lZCggU1RBTkRBUkQgKVxuXHRcdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciApICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciAqPSBjb21wdXRlU3BlY3VsYXJPY2NsdXNpb24oIGRvdE5WLCBhbWJpZW50T2NjbHVzaW9uLCBtYXRlcmlhbC5yb3VnaG5lc3MgKTtcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGFvbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhb01hcDtcblx0dW5pZm9ybSBmbG9hdCBhb01hcEludGVuc2l0eTtcbiNlbmRpZiI7Cgp2YXIgYmF0Y2hpbmdfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9CQVRDSElOR1xuXHRhdHRyaWJ1dGUgZmxvYXQgYmF0Y2hJZDtcblx0dW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgYmF0Y2hpbmdUZXh0dXJlO1xuXHRtYXQ0IGdldEJhdGNoaW5nTWF0cml4KCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdGludCBzaXplID0gdGV4dHVyZVNpemUoIGJhdGNoaW5nVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IGogPSBpbnQoIGkgKSAqIDQ7XG5cdFx0aW50IHggPSBqICUgc2l6ZTtcblx0XHRpbnQgeSA9IGogLyBzaXplO1xuXHRcdHZlYzQgdjEgPSB0ZXhlbEZldGNoKCBiYXRjaGluZ1RleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKTtcblx0XHR2ZWM0IHYyID0gdGV4ZWxGZXRjaCggYmF0Y2hpbmdUZXh0dXJlLCBpdmVjMiggeCArIDEsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjMgPSB0ZXhlbEZldGNoKCBiYXRjaGluZ1RleHR1cmUsIGl2ZWMyKCB4ICsgMiwgeSApLCAwICk7XG5cdFx0dmVjNCB2NCA9IHRleGVsRmV0Y2goIGJhdGNoaW5nVGV4dHVyZSwgaXZlYzIoIHggKyAzLCB5ICksIDAgKTtcblx0XHRyZXR1cm4gbWF0NCggdjEsIHYyLCB2MywgdjQgKTtcblx0fVxuI2VuZGlmIjsKCnZhciBiYXRjaGluZ192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9CQVRDSElOR1xuXHRtYXQ0IGJhdGNoaW5nTWF0cml4ID0gZ2V0QmF0Y2hpbmdNYXRyaXgoIGJhdGNoSWQgKTtcbiNlbmRpZiI7Cgp2YXIgYmVnaW5fdmVydGV4ID0gInZlYzMgdHJhbnNmb3JtZWQgPSB2ZWMzKCBwb3NpdGlvbiApO1xuI2lmZGVmIFVTRV9BTFBIQUhBU0hcblx0dlBvc2l0aW9uID0gdmVjMyggcG9zaXRpb24gKTtcbiNlbmRpZiI7Cgp2YXIgYmVnaW5ub3JtYWxfdmVydGV4ID0gInZlYzMgb2JqZWN0Tm9ybWFsID0gdmVjMyggbm9ybWFsICk7XG4jaWZkZWYgVVNFX1RBTkdFTlRcblx0dmVjMyBvYmplY3RUYW5nZW50ID0gdmVjMyggdGFuZ2VudC54eXogKTtcbiNlbmRpZiI7Cgp2YXIgYnNkZnMgPSAiZmxvYXQgR19CbGlublBob25nX0ltcGxpY2l0KCApIHtcblx0cmV0dXJuIDAuMjU7XG59XG5mbG9hdCBEX0JsaW5uUGhvbmcoIGNvbnN0IGluIGZsb2F0IHNoaW5pbmVzcywgY29uc3QgaW4gZmxvYXQgZG90TkggKSB7XG5cdHJldHVybiBSRUNJUFJPQ0FMX1BJICogKCBzaGluaW5lc3MgKiAwLjUgKyAxLjAgKSAqIHBvdyggZG90TkgsIHNoaW5pbmVzcyApO1xufVxudmVjMyBCUkRGX0JsaW5uUGhvbmcoIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc2hpbmluZXNzICkge1xuXHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdHZlYzMgRiA9IEZfU2NobGljayggc3BlY3VsYXJDb2xvciwgMS4wLCBkb3RWSCApO1xuXHRmbG9hdCBHID0gR19CbGlublBob25nX0ltcGxpY2l0KCApO1xuXHRmbG9hdCBEID0gRF9CbGlublBob25nKCBzaGluaW5lc3MsIGRvdE5IICk7XG5cdHJldHVybiBGICogKCBHICogRCApO1xufSAvLyB2YWxpZGF0ZWQiOwoKdmFyIGlyaWRlc2NlbmNlX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0Y29uc3QgbWF0MyBYWVpfVE9fUkVDNzA5ID0gbWF0Myhcblx0XHQgMy4yNDA0NTQyLCAtMC45NjkyNjYwLCAgMC4wNTU2NDM0LFxuXHRcdC0xLjUzNzEzODUsICAxLjg3NjAxMDgsIC0wLjIwNDAyNTksXG5cdFx0LTAuNDk4NTMxNCwgIDAuMDQxNTU2MCwgIDEuMDU3MjI1MlxuXHQpO1xuXHR2ZWMzIEZyZXNuZWwwVG9Jb3IoIHZlYzMgZnJlc25lbDAgKSB7XG5cdFx0dmVjMyBzcXJ0RjAgPSBzcXJ0KCBmcmVzbmVsMCApO1xuXHRcdHJldHVybiAoIHZlYzMoIDEuMCApICsgc3FydEYwICkgLyAoIHZlYzMoIDEuMCApIC0gc3FydEYwICk7XG5cdH1cblx0dmVjMyBJb3JUb0ZyZXNuZWwwKCB2ZWMzIHRyYW5zbWl0dGVkSW9yLCBmbG9hdCBpbmNpZGVudElvciApIHtcblx0XHRyZXR1cm4gcG93MiggKCB0cmFuc21pdHRlZElvciAtIHZlYzMoIGluY2lkZW50SW9yICkgKSAvICggdHJhbnNtaXR0ZWRJb3IgKyB2ZWMzKCBpbmNpZGVudElvciApICkgKTtcblx0fVxuXHRmbG9hdCBJb3JUb0ZyZXNuZWwwKCBmbG9hdCB0cmFuc21pdHRlZElvciwgZmxvYXQgaW5jaWRlbnRJb3IgKSB7XG5cdFx0cmV0dXJuIHBvdzIoICggdHJhbnNtaXR0ZWRJb3IgLSBpbmNpZGVudElvciApIC8gKCB0cmFuc21pdHRlZElvciArIGluY2lkZW50SW9yICkpO1xuXHR9XG5cdHZlYzMgZXZhbFNlbnNpdGl2aXR5KCBmbG9hdCBPUEQsIHZlYzMgc2hpZnQgKSB7XG5cdFx0ZmxvYXQgcGhhc2UgPSAyLjAgKiBQSSAqIE9QRCAqIDEuMGUtOTtcblx0XHR2ZWMzIHZhbCA9IHZlYzMoIDUuNDg1NmUtMTMsIDQuNDIwMWUtMTMsIDUuMjQ4MWUtMTMgKTtcblx0XHR2ZWMzIHBvcyA9IHZlYzMoIDEuNjgxMGUrMDYsIDEuNzk1M2UrMDYsIDIuMjA4NGUrMDYgKTtcblx0XHR2ZWMzIHZhciA9IHZlYzMoIDQuMzI3OGUrMDksIDkuMzA0NmUrMDksIDYuNjEyMWUrMDkgKTtcblx0XHR2ZWMzIHh5eiA9IHZhbCAqIHNxcnQoIDIuMCAqIFBJICogdmFyICkgKiBjb3MoIHBvcyAqIHBoYXNlICsgc2hpZnQgKSAqIGV4cCggLSBwb3cyKCBwaGFzZSApICogdmFyICk7XG5cdFx0eHl6LnggKz0gOS43NDcwZS0xNCAqIHNxcnQoIDIuMCAqIFBJICogNC41MjgyZSswOSApICogY29zKCAyLjIzOTllKzA2ICogcGhhc2UgKyBzaGlmdFsgMCBdICkgKiBleHAoIC0gNC41MjgyZSswOSAqIHBvdzIoIHBoYXNlICkgKTtcblx0XHR4eXogLz0gMS4wNjg1ZS03O1xuXHRcdHZlYzMgcmdiID0gWFlaX1RPX1JFQzcwOSAqIHh5ejtcblx0XHRyZXR1cm4gcmdiO1xuXHR9XG5cdHZlYzMgZXZhbElyaWRlc2NlbmNlKCBmbG9hdCBvdXRzaWRlSU9SLCBmbG9hdCBldGEyLCBmbG9hdCBjb3NUaGV0YTEsIGZsb2F0IHRoaW5GaWxtVGhpY2tuZXNzLCB2ZWMzIGJhc2VGMCApIHtcblx0XHR2ZWMzIEk7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VJT1IgPSBtaXgoIG91dHNpZGVJT1IsIGV0YTIsIHNtb290aHN0ZXAoIDAuMCwgMC4wMywgdGhpbkZpbG1UaGlja25lc3MgKSApO1xuXHRcdGZsb2F0IHNpblRoZXRhMlNxID0gcG93Miggb3V0c2lkZUlPUiAvIGlyaWRlc2NlbmNlSU9SICkgKiAoIDEuMCAtIHBvdzIoIGNvc1RoZXRhMSApICk7XG5cdFx0ZmxvYXQgY29zVGhldGEyU3EgPSAxLjAgLSBzaW5UaGV0YTJTcTtcblx0XHRpZiAoIGNvc1RoZXRhMlNxIDwgMC4wICkge1xuXHRcdFx0cmV0dXJuIHZlYzMoIDEuMCApO1xuXHRcdH1cblx0XHRmbG9hdCBjb3NUaGV0YTIgPSBzcXJ0KCBjb3NUaGV0YTJTcSApO1xuXHRcdGZsb2F0IFIwID0gSW9yVG9GcmVzbmVsMCggaXJpZGVzY2VuY2VJT1IsIG91dHNpZGVJT1IgKTtcblx0XHRmbG9hdCBSMTIgPSBGX1NjaGxpY2soIFIwLCAxLjAsIGNvc1RoZXRhMSApO1xuXHRcdGZsb2F0IFQxMjEgPSAxLjAgLSBSMTI7XG5cdFx0ZmxvYXQgcGhpMTIgPSAwLjA7XG5cdFx0aWYgKCBpcmlkZXNjZW5jZUlPUiA8IG91dHNpZGVJT1IgKSBwaGkxMiA9IFBJO1xuXHRcdGZsb2F0IHBoaTIxID0gUEkgLSBwaGkxMjtcblx0XHR2ZWMzIGJhc2VJT1IgPSBGcmVzbmVsMFRvSW9yKCBjbGFtcCggYmFzZUYwLCAwLjAsIDAuOTk5OSApICk7XHRcdHZlYzMgUjEgPSBJb3JUb0ZyZXNuZWwwKCBiYXNlSU9SLCBpcmlkZXNjZW5jZUlPUiApO1xuXHRcdHZlYzMgUjIzID0gRl9TY2hsaWNrKCBSMSwgMS4wLCBjb3NUaGV0YTIgKTtcblx0XHR2ZWMzIHBoaTIzID0gdmVjMyggMC4wICk7XG5cdFx0aWYgKCBiYXNlSU9SWyAwIF0gPCBpcmlkZXNjZW5jZUlPUiApIHBoaTIzWyAwIF0gPSBQSTtcblx0XHRpZiAoIGJhc2VJT1JbIDEgXSA8IGlyaWRlc2NlbmNlSU9SICkgcGhpMjNbIDEgXSA9IFBJO1xuXHRcdGlmICggYmFzZUlPUlsgMiBdIDwgaXJpZGVzY2VuY2VJT1IgKSBwaGkyM1sgMiBdID0gUEk7XG5cdFx0ZmxvYXQgT1BEID0gMi4wICogaXJpZGVzY2VuY2VJT1IgKiB0aGluRmlsbVRoaWNrbmVzcyAqIGNvc1RoZXRhMjtcblx0XHR2ZWMzIHBoaSA9IHZlYzMoIHBoaTIxICkgKyBwaGkyMztcblx0XHR2ZWMzIFIxMjMgPSBjbGFtcCggUjEyICogUjIzLCAxZS01LCAwLjk5OTkgKTtcblx0XHR2ZWMzIHIxMjMgPSBzcXJ0KCBSMTIzICk7XG5cdFx0dmVjMyBScyA9IHBvdzIoIFQxMjEgKSAqIFIyMyAvICggdmVjMyggMS4wICkgLSBSMTIzICk7XG5cdFx0dmVjMyBDMCA9IFIxMiArIFJzO1xuXHRcdEkgPSBDMDtcblx0XHR2ZWMzIENtID0gUnMgLSBUMTIxO1xuXHRcdGZvciAoIGludCBtID0gMTsgbSA8PSAyOyArKyBtICkge1xuXHRcdFx0Q20gKj0gcjEyMztcblx0XHRcdHZlYzMgU20gPSAyLjAgKiBldmFsU2Vuc2l0aXZpdHkoIGZsb2F0KCBtICkgKiBPUEQsIGZsb2F0KCBtICkgKiBwaGkgKTtcblx0XHRcdEkgKz0gQ20gKiBTbTtcblx0XHR9XG5cdFx0cmV0dXJuIG1heCggSSwgdmVjMyggMC4wICkgKTtcblx0fVxuI2VuZGlmIjsKCnZhciBidW1wbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9CVU1QTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGJ1bXBNYXA7XG5cdHVuaWZvcm0gZmxvYXQgYnVtcFNjYWxlO1xuXHR2ZWMyIGRIZHh5X2Z3ZCgpIHtcblx0XHR2ZWMyIGRTVGR4ID0gZEZkeCggdkJ1bXBNYXBVdiApO1xuXHRcdHZlYzIgZFNUZHkgPSBkRmR5KCB2QnVtcE1hcFV2ICk7XG5cdFx0ZmxvYXQgSGxsID0gYnVtcFNjYWxlICogdGV4dHVyZTJEKCBidW1wTWFwLCB2QnVtcE1hcFV2ICkueDtcblx0XHRmbG9hdCBkQnggPSBidW1wU2NhbGUgKiB0ZXh0dXJlMkQoIGJ1bXBNYXAsIHZCdW1wTWFwVXYgKyBkU1RkeCApLnggLSBIbGw7XG5cdFx0ZmxvYXQgZEJ5ID0gYnVtcFNjYWxlICogdGV4dHVyZTJEKCBidW1wTWFwLCB2QnVtcE1hcFV2ICsgZFNUZHkgKS54IC0gSGxsO1xuXHRcdHJldHVybiB2ZWMyKCBkQngsIGRCeSApO1xuXHR9XG5cdHZlYzMgcGVydHVyYk5vcm1hbEFyYiggdmVjMyBzdXJmX3BvcywgdmVjMyBzdXJmX25vcm0sIHZlYzIgZEhkeHksIGZsb2F0IGZhY2VEaXJlY3Rpb24gKSB7XG5cdFx0dmVjMyB2U2lnbWFYID0gbm9ybWFsaXplKCBkRmR4KCBzdXJmX3Bvcy54eXogKSApO1xuXHRcdHZlYzMgdlNpZ21hWSA9IG5vcm1hbGl6ZSggZEZkeSggc3VyZl9wb3MueHl6ICkgKTtcblx0XHR2ZWMzIHZOID0gc3VyZl9ub3JtO1xuXHRcdHZlYzMgUjEgPSBjcm9zcyggdlNpZ21hWSwgdk4gKTtcblx0XHR2ZWMzIFIyID0gY3Jvc3MoIHZOLCB2U2lnbWFYICk7XG5cdFx0ZmxvYXQgZkRldCA9IGRvdCggdlNpZ21hWCwgUjEgKSAqIGZhY2VEaXJlY3Rpb247XG5cdFx0dmVjMyB2R3JhZCA9IHNpZ24oIGZEZXQgKSAqICggZEhkeHkueCAqIFIxICsgZEhkeHkueSAqIFIyICk7XG5cdFx0cmV0dXJuIG5vcm1hbGl6ZSggYWJzKCBmRGV0ICkgKiBzdXJmX25vcm0gLSB2R3JhZCApO1xuXHR9XG4jZW5kaWYiOwoKdmFyIGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dmVjNCBwbGFuZTtcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBVTklPTl9DTElQUElOR19QTEFORVM7IGkgKysgKSB7XG5cdFx0cGxhbmUgPSBjbGlwcGluZ1BsYW5lc1sgaSBdO1xuXHRcdGlmICggZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSBkaXNjYXJkO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNpZiBVTklPTl9DTElQUElOR19QTEFORVMgPCBOVU1fQ0xJUFBJTkdfUExBTkVTXG5cdFx0Ym9vbCBjbGlwcGVkID0gdHJ1ZTtcblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0Zm9yICggaW50IGkgPSBVTklPTl9DTElQUElOR19QTEFORVM7IGkgPCBOVU1fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdFx0cGxhbmUgPSBjbGlwcGluZ1BsYW5lc1sgaSBdO1xuXHRcdFx0Y2xpcHBlZCA9ICggZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSAmJiBjbGlwcGVkO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdGlmICggY2xpcHBlZCApIGRpc2NhcmQ7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dmFyeWluZyB2ZWMzIHZDbGlwUG9zaXRpb247XG5cdHVuaWZvcm0gdmVjNCBjbGlwcGluZ1BsYW5lc1sgTlVNX0NMSVBQSU5HX1BMQU5FUyBdO1xuI2VuZGlmIjsKCnZhciBjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXggPSAiI2lmIE5VTV9DTElQUElOR19QTEFORVMgPiAwXG5cdHZhcnlpbmcgdmVjMyB2Q2xpcFBvc2l0aW9uO1xuI2VuZGlmIjsKCnZhciBjbGlwcGluZ19wbGFuZXNfdmVydGV4ID0gIiNpZiBOVU1fQ0xJUFBJTkdfUExBTkVTID4gMFxuXHR2Q2xpcFBvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbiNlbmRpZiI7Cgp2YXIgY29sb3JfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9DT0xPUl9BTFBIQSApXG5cdGRpZmZ1c2VDb2xvciAqPSB2Q29sb3I7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKVxuXHRkaWZmdXNlQ29sb3IucmdiICo9IHZDb2xvcjtcbiNlbmRpZiI7Cgp2YXIgY29sb3JfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dmFyeWluZyB2ZWM0IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG5cdHZhcnlpbmcgdmVjMyB2Q29sb3I7XG4jZW5kaWYiOwoKdmFyIGNvbG9yX3BhcnNfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHR2YXJ5aW5nIHZlYzQgdkNvbG9yO1xuI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SICkgfHwgZGVmaW5lZCggVVNFX0lOU1RBTkNJTkdfQ09MT1IgKVxuXHR2YXJ5aW5nIHZlYzMgdkNvbG9yO1xuI2VuZGlmIjsKCnZhciBjb2xvcl92ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9DT0xPUl9BTFBIQSApXG5cdHZDb2xvciA9IHZlYzQoIDEuMCApO1xuI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SICkgfHwgZGVmaW5lZCggVVNFX0lOU1RBTkNJTkdfQ09MT1IgKVxuXHR2Q29sb3IgPSB2ZWMzKCAxLjAgKTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DT0xPUlxuXHR2Q29sb3IgKj0gY29sb3I7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSU5TVEFOQ0lOR19DT0xPUlxuXHR2Q29sb3IueHl6ICo9IGluc3RhbmNlQ29sb3IueHl6O1xuI2VuZGlmIjsKCnZhciBjb21tb24gPSAiI2RlZmluZSBQSSAzLjE0MTU5MjY1MzU4OTc5M1xuI2RlZmluZSBQSTIgNi4yODMxODUzMDcxNzk1ODZcbiNkZWZpbmUgUElfSEFMRiAxLjU3MDc5NjMyNjc5NDg5NjZcbiNkZWZpbmUgUkVDSVBST0NBTF9QSSAwLjMxODMwOTg4NjE4Mzc5MDdcbiNkZWZpbmUgUkVDSVBST0NBTF9QSTIgMC4xNTkxNTQ5NDMwOTE4OTUzNVxuI2RlZmluZSBFUFNJTE9OIDFlLTZcbiNpZm5kZWYgc2F0dXJhdGVcbiNkZWZpbmUgc2F0dXJhdGUoIGEgKSBjbGFtcCggYSwgMC4wLCAxLjAgKVxuI2VuZGlmXG4jZGVmaW5lIHdoaXRlQ29tcGxlbWVudCggYSApICggMS4wIC0gc2F0dXJhdGUoIGEgKSApXG5mbG9hdCBwb3cyKCBjb25zdCBpbiBmbG9hdCB4ICkgeyByZXR1cm4geCp4OyB9XG52ZWMzIHBvdzIoIGNvbnN0IGluIHZlYzMgeCApIHsgcmV0dXJuIHgqeDsgfVxuZmxvYXQgcG93MyggY29uc3QgaW4gZmxvYXQgeCApIHsgcmV0dXJuIHgqeCp4OyB9XG5mbG9hdCBwb3c0KCBjb25zdCBpbiBmbG9hdCB4ICkgeyBmbG9hdCB4MiA9IHgqeDsgcmV0dXJuIHgyKngyOyB9XG5mbG9hdCBtYXgzKCBjb25zdCBpbiB2ZWMzIHYgKSB7IHJldHVybiBtYXgoIG1heCggdi54LCB2LnkgKSwgdi56ICk7IH1cbmZsb2F0IGF2ZXJhZ2UoIGNvbnN0IGluIHZlYzMgdiApIHsgcmV0dXJuIGRvdCggdiwgdmVjMyggMC4zMzMzMzMzICkgKTsgfVxuaGlnaHAgZmxvYXQgcmFuZCggY29uc3QgaW4gdmVjMiB1diApIHtcblx0Y29uc3QgaGlnaHAgZmxvYXQgYSA9IDEyLjk4OTgsIGIgPSA3OC4yMzMsIGMgPSA0Mzc1OC41NDUzO1xuXHRoaWdocCBmbG9hdCBkdCA9IGRvdCggdXYueHksIHZlYzIoIGEsYiApICksIHNuID0gbW9kKCBkdCwgUEkgKTtcblx0cmV0dXJuIGZyYWN0KCBzaW4oIHNuICkgKiBjICk7XG59XG4jaWZkZWYgSElHSF9QUkVDSVNJT05cblx0ZmxvYXQgcHJlY2lzaW9uU2FmZUxlbmd0aCggdmVjMyB2ICkgeyByZXR1cm4gbGVuZ3RoKCB2ICk7IH1cbiNlbHNlXG5cdGZsb2F0IHByZWNpc2lvblNhZmVMZW5ndGgoIHZlYzMgdiApIHtcblx0XHRmbG9hdCBtYXhDb21wb25lbnQgPSBtYXgzKCBhYnMoIHYgKSApO1xuXHRcdHJldHVybiBsZW5ndGgoIHYgLyBtYXhDb21wb25lbnQgKSAqIG1heENvbXBvbmVudDtcblx0fVxuI2VuZGlmXG5zdHJ1Y3QgSW5jaWRlbnRMaWdodCB7XG5cdHZlYzMgY29sb3I7XG5cdHZlYzMgZGlyZWN0aW9uO1xuXHRib29sIHZpc2libGU7XG59O1xuc3RydWN0IFJlZmxlY3RlZExpZ2h0IHtcblx0dmVjMyBkaXJlY3REaWZmdXNlO1xuXHR2ZWMzIGRpcmVjdFNwZWN1bGFyO1xuXHR2ZWMzIGluZGlyZWN0RGlmZnVzZTtcblx0dmVjMyBpbmRpcmVjdFNwZWN1bGFyO1xufTtcbiNpZmRlZiBVU0VfQUxQSEFIQVNIXG5cdHZhcnlpbmcgdmVjMyB2UG9zaXRpb247XG4jZW5kaWZcbnZlYzMgdHJhbnNmb3JtRGlyZWN0aW9uKCBpbiB2ZWMzIGRpciwgaW4gbWF0NCBtYXRyaXggKSB7XG5cdHJldHVybiBub3JtYWxpemUoICggbWF0cml4ICogdmVjNCggZGlyLCAwLjAgKSApLnh5eiApO1xufVxudmVjMyBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBpbiB2ZWMzIGRpciwgaW4gbWF0NCBtYXRyaXggKSB7XG5cdHJldHVybiBub3JtYWxpemUoICggdmVjNCggZGlyLCAwLjAgKSAqIG1hdHJpeCApLnh5eiApO1xufVxubWF0MyB0cmFuc3Bvc2VNYXQzKCBjb25zdCBpbiBtYXQzIG0gKSB7XG5cdG1hdDMgdG1wO1xuXHR0bXBbIDAgXSA9IHZlYzMoIG1bIDAgXS54LCBtWyAxIF0ueCwgbVsgMiBdLnggKTtcblx0dG1wWyAxIF0gPSB2ZWMzKCBtWyAwIF0ueSwgbVsgMSBdLnksIG1bIDIgXS55ICk7XG5cdHRtcFsgMiBdID0gdmVjMyggbVsgMCBdLnosIG1bIDEgXS56LCBtWyAyIF0ueiApO1xuXHRyZXR1cm4gdG1wO1xufVxuZmxvYXQgbHVtaW5hbmNlKCBjb25zdCBpbiB2ZWMzIHJnYiApIHtcblx0Y29uc3QgdmVjMyB3ZWlnaHRzID0gdmVjMyggMC4yMTI2NzI5LCAwLjcxNTE1MjIsIDAuMDcyMTc1MCApO1xuXHRyZXR1cm4gZG90KCB3ZWlnaHRzLCByZ2IgKTtcbn1cbmJvb2wgaXNQZXJzcGVjdGl2ZU1hdHJpeCggbWF0NCBtICkge1xuXHRyZXR1cm4gbVsgMiBdWyAzIF0gPT0gLSAxLjA7XG59XG52ZWMyIGVxdWlyZWN0VXYoIGluIHZlYzMgZGlyICkge1xuXHRmbG9hdCB1ID0gYXRhbiggZGlyLnosIGRpci54ICkgKiBSRUNJUFJPQ0FMX1BJMiArIDAuNTtcblx0ZmxvYXQgdiA9IGFzaW4oIGNsYW1wKCBkaXIueSwgLSAxLjAsIDEuMCApICkgKiBSRUNJUFJPQ0FMX1BJICsgMC41O1xuXHRyZXR1cm4gdmVjMiggdSwgdiApO1xufVxudmVjMyBCUkRGX0xhbWJlcnQoIGNvbnN0IGluIHZlYzMgZGlmZnVzZUNvbG9yICkge1xuXHRyZXR1cm4gUkVDSVBST0NBTF9QSSAqIGRpZmZ1c2VDb2xvcjtcbn1cbnZlYzMgRl9TY2hsaWNrKCBjb25zdCBpbiB2ZWMzIGYwLCBjb25zdCBpbiBmbG9hdCBmOTAsIGNvbnN0IGluIGZsb2F0IGRvdFZIICkge1xuXHRmbG9hdCBmcmVzbmVsID0gZXhwMiggKCAtIDUuNTU0NzMgKiBkb3RWSCAtIDYuOTgzMTYgKSAqIGRvdFZIICk7XG5cdHJldHVybiBmMCAqICggMS4wIC0gZnJlc25lbCApICsgKCBmOTAgKiBmcmVzbmVsICk7XG59XG5mbG9hdCBGX1NjaGxpY2soIGNvbnN0IGluIGZsb2F0IGYwLCBjb25zdCBpbiBmbG9hdCBmOTAsIGNvbnN0IGluIGZsb2F0IGRvdFZIICkge1xuXHRmbG9hdCBmcmVzbmVsID0gZXhwMiggKCAtIDUuNTU0NzMgKiBkb3RWSCAtIDYuOTgzMTYgKSAqIGRvdFZIICk7XG5cdHJldHVybiBmMCAqICggMS4wIC0gZnJlc25lbCApICsgKCBmOTAgKiBmcmVzbmVsICk7XG59IC8vIHZhbGlkYXRlZCI7Cgp2YXIgY3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50ID0gIiNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFX1VWXG5cdCNkZWZpbmUgY3ViZVVWX21pbk1pcExldmVsIDQuMFxuXHQjZGVmaW5lIGN1YmVVVl9taW5UaWxlU2l6ZSAxNi4wXG5cdGZsb2F0IGdldEZhY2UoIHZlYzMgZGlyZWN0aW9uICkge1xuXHRcdHZlYzMgYWJzRGlyZWN0aW9uID0gYWJzKCBkaXJlY3Rpb24gKTtcblx0XHRmbG9hdCBmYWNlID0gLSAxLjA7XG5cdFx0aWYgKCBhYnNEaXJlY3Rpb24ueCA+IGFic0RpcmVjdGlvbi56ICkge1xuXHRcdFx0aWYgKCBhYnNEaXJlY3Rpb24ueCA+IGFic0RpcmVjdGlvbi55IClcblx0XHRcdFx0ZmFjZSA9IGRpcmVjdGlvbi54ID4gMC4wID8gMC4wIDogMy4wO1xuXHRcdFx0ZWxzZVxuXHRcdFx0XHRmYWNlID0gZGlyZWN0aW9uLnkgPiAwLjAgPyAxLjAgOiA0LjA7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmICggYWJzRGlyZWN0aW9uLnogPiBhYnNEaXJlY3Rpb24ueSApXG5cdFx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueiA+IDAuMCA/IDIuMCA6IDUuMDtcblx0XHRcdGVsc2Vcblx0XHRcdFx0ZmFjZSA9IGRpcmVjdGlvbi55ID4gMC4wID8gMS4wIDogNC4wO1xuXHRcdH1cblx0XHRyZXR1cm4gZmFjZTtcblx0fVxuXHR2ZWMyIGdldFVWKCB2ZWMzIGRpcmVjdGlvbiwgZmxvYXQgZmFjZSApIHtcblx0XHR2ZWMyIHV2O1xuXHRcdGlmICggZmFjZSA9PSAwLjAgKSB7XG5cdFx0XHR1diA9IHZlYzIoIGRpcmVjdGlvbi56LCBkaXJlY3Rpb24ueSApIC8gYWJzKCBkaXJlY3Rpb24ueCApO1xuXHRcdH0gZWxzZSBpZiAoIGZhY2UgPT0gMS4wICkge1xuXHRcdFx0dXYgPSB2ZWMyKCAtIGRpcmVjdGlvbi54LCAtIGRpcmVjdGlvbi56ICkgLyBhYnMoIGRpcmVjdGlvbi55ICk7XG5cdFx0fSBlbHNlIGlmICggZmFjZSA9PSAyLjAgKSB7XG5cdFx0XHR1diA9IHZlYzIoIC0gZGlyZWN0aW9uLngsIGRpcmVjdGlvbi55ICkgLyBhYnMoIGRpcmVjdGlvbi56ICk7XG5cdFx0fSBlbHNlIGlmICggZmFjZSA9PSAzLjAgKSB7XG5cdFx0XHR1diA9IHZlYzIoIC0gZGlyZWN0aW9uLnosIGRpcmVjdGlvbi55ICkgLyBhYnMoIGRpcmVjdGlvbi54ICk7XG5cdFx0fSBlbHNlIGlmICggZmFjZSA9PSA0LjAgKSB7XG5cdFx0XHR1diA9IHZlYzIoIC0gZGlyZWN0aW9uLngsIGRpcmVjdGlvbi56ICkgLyBhYnMoIGRpcmVjdGlvbi55ICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHV2ID0gdmVjMiggZGlyZWN0aW9uLngsIGRpcmVjdGlvbi55ICkgLyBhYnMoIGRpcmVjdGlvbi56ICk7XG5cdFx0fVxuXHRcdHJldHVybiAwLjUgKiAoIHV2ICsgMS4wICk7XG5cdH1cblx0dmVjMyBiaWxpbmVhckN1YmVVViggc2FtcGxlcjJEIGVudk1hcCwgdmVjMyBkaXJlY3Rpb24sIGZsb2F0IG1pcEludCApIHtcblx0XHRmbG9hdCBmYWNlID0gZ2V0RmFjZSggZGlyZWN0aW9uICk7XG5cdFx0ZmxvYXQgZmlsdGVySW50ID0gbWF4KCBjdWJlVVZfbWluTWlwTGV2ZWwgLSBtaXBJbnQsIDAuMCApO1xuXHRcdG1pcEludCA9IG1heCggbWlwSW50LCBjdWJlVVZfbWluTWlwTGV2ZWwgKTtcblx0XHRmbG9hdCBmYWNlU2l6ZSA9IGV4cDIoIG1pcEludCApO1xuXHRcdGhpZ2hwIHZlYzIgdXYgPSBnZXRVViggZGlyZWN0aW9uLCBmYWNlICkgKiAoIGZhY2VTaXplIC0gMi4wICkgKyAxLjA7XG5cdFx0aWYgKCBmYWNlID4gMi4wICkge1xuXHRcdFx0dXYueSArPSBmYWNlU2l6ZTtcblx0XHRcdGZhY2UgLT0gMy4wO1xuXHRcdH1cblx0XHR1di54ICs9IGZhY2UgKiBmYWNlU2l6ZTtcblx0XHR1di54ICs9IGZpbHRlckludCAqIDMuMCAqIGN1YmVVVl9taW5UaWxlU2l6ZTtcblx0XHR1di55ICs9IDQuMCAqICggZXhwMiggQ1VCRVVWX01BWF9NSVAgKSAtIGZhY2VTaXplICk7XG5cdFx0dXYueCAqPSBDVUJFVVZfVEVYRUxfV0lEVEg7XG5cdFx0dXYueSAqPSBDVUJFVVZfVEVYRUxfSEVJR0hUO1xuXHRcdCNpZmRlZiB0ZXh0dXJlMkRHcmFkRVhUXG5cdFx0XHRyZXR1cm4gdGV4dHVyZTJER3JhZEVYVCggZW52TWFwLCB1diwgdmVjMiggMC4wICksIHZlYzIoIDAuMCApICkucmdiO1xuXHRcdCNlbHNlXG5cdFx0XHRyZXR1cm4gdGV4dHVyZTJEKCBlbnZNYXAsIHV2ICkucmdiO1xuXHRcdCNlbmRpZlxuXHR9XG5cdCNkZWZpbmUgY3ViZVVWX3IwIDEuMFxuXHQjZGVmaW5lIGN1YmVVVl9tMCAtIDIuMFxuXHQjZGVmaW5lIGN1YmVVVl9yMSAwLjhcblx0I2RlZmluZSBjdWJlVVZfbTEgLSAxLjBcblx0I2RlZmluZSBjdWJlVVZfcjQgMC40XG5cdCNkZWZpbmUgY3ViZVVWX200IDIuMFxuXHQjZGVmaW5lIGN1YmVVVl9yNSAwLjMwNVxuXHQjZGVmaW5lIGN1YmVVVl9tNSAzLjBcblx0I2RlZmluZSBjdWJlVVZfcjYgMC4yMVxuXHQjZGVmaW5lIGN1YmVVVl9tNiA0LjBcblx0ZmxvYXQgcm91Z2huZXNzVG9NaXAoIGZsb2F0IHJvdWdobmVzcyApIHtcblx0XHRmbG9hdCBtaXAgPSAwLjA7XG5cdFx0aWYgKCByb3VnaG5lc3MgPj0gY3ViZVVWX3IxICkge1xuXHRcdFx0bWlwID0gKCBjdWJlVVZfcjAgLSByb3VnaG5lc3MgKSAqICggY3ViZVVWX20xIC0gY3ViZVVWX20wICkgLyAoIGN1YmVVVl9yMCAtIGN1YmVVVl9yMSApICsgY3ViZVVWX20wO1xuXHRcdH0gZWxzZSBpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjQgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yMSAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTQgLSBjdWJlVVZfbTEgKSAvICggY3ViZVVWX3IxIC0gY3ViZVVWX3I0ICkgKyBjdWJlVVZfbTE7XG5cdFx0fSBlbHNlIGlmICggcm91Z2huZXNzID49IGN1YmVVVl9yNSApIHtcblx0XHRcdG1pcCA9ICggY3ViZVVWX3I0IC0gcm91Z2huZXNzICkgKiAoIGN1YmVVVl9tNSAtIGN1YmVVVl9tNCApIC8gKCBjdWJlVVZfcjQgLSBjdWJlVVZfcjUgKSArIGN1YmVVVl9tNDtcblx0XHR9IGVsc2UgaWYgKCByb3VnaG5lc3MgPj0gY3ViZVVWX3I2ICkge1xuXHRcdFx0bWlwID0gKCBjdWJlVVZfcjUgLSByb3VnaG5lc3MgKSAqICggY3ViZVVWX202IC0gY3ViZVVWX201ICkgLyAoIGN1YmVVVl9yNSAtIGN1YmVVVl9yNiApICsgY3ViZVVWX201O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRtaXAgPSAtIDIuMCAqIGxvZzIoIDEuMTYgKiByb3VnaG5lc3MgKTtcdFx0fVxuXHRcdHJldHVybiBtaXA7XG5cdH1cblx0dmVjNCB0ZXh0dXJlQ3ViZVVWKCBzYW1wbGVyMkQgZW52TWFwLCB2ZWMzIHNhbXBsZURpciwgZmxvYXQgcm91Z2huZXNzICkge1xuXHRcdGZsb2F0IG1pcCA9IGNsYW1wKCByb3VnaG5lc3NUb01pcCggcm91Z2huZXNzICksIGN1YmVVVl9tMCwgQ1VCRVVWX01BWF9NSVAgKTtcblx0XHRmbG9hdCBtaXBGID0gZnJhY3QoIG1pcCApO1xuXHRcdGZsb2F0IG1pcEludCA9IGZsb29yKCBtaXAgKTtcblx0XHR2ZWMzIGNvbG9yMCA9IGJpbGluZWFyQ3ViZVVWKCBlbnZNYXAsIHNhbXBsZURpciwgbWlwSW50ICk7XG5cdFx0aWYgKCBtaXBGID09IDAuMCApIHtcblx0XHRcdHJldHVybiB2ZWM0KCBjb2xvcjAsIDEuMCApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR2ZWMzIGNvbG9yMSA9IGJpbGluZWFyQ3ViZVVWKCBlbnZNYXAsIHNhbXBsZURpciwgbWlwSW50ICsgMS4wICk7XG5cdFx0XHRyZXR1cm4gdmVjNCggbWl4KCBjb2xvcjAsIGNvbG9yMSwgbWlwRiApLCAxLjAgKTtcblx0XHR9XG5cdH1cbiNlbmRpZiI7Cgp2YXIgZGVmYXVsdG5vcm1hbF92ZXJ0ZXggPSAidmVjMyB0cmFuc2Zvcm1lZE5vcm1hbCA9IG9iamVjdE5vcm1hbDtcbiNpZmRlZiBVU0VfVEFOR0VOVFxuXHR2ZWMzIHRyYW5zZm9ybWVkVGFuZ2VudCA9IG9iamVjdFRhbmdlbnQ7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0bWF0MyBibSA9IG1hdDMoIGJhdGNoaW5nTWF0cml4ICk7XG5cdHRyYW5zZm9ybWVkTm9ybWFsIC89IHZlYzMoIGRvdCggYm1bIDAgXSwgYm1bIDAgXSApLCBkb3QoIGJtWyAxIF0sIGJtWyAxIF0gKSwgZG90KCBibVsgMiBdLCBibVsgMiBdICkgKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgPSBibSAqIHRyYW5zZm9ybWVkTm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR0cmFuc2Zvcm1lZFRhbmdlbnQgPSBibSAqIHRyYW5zZm9ybWVkVGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfSU5TVEFOQ0lOR1xuXHRtYXQzIGltID0gbWF0MyggaW5zdGFuY2VNYXRyaXggKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgLz0gdmVjMyggZG90KCBpbVsgMCBdLCBpbVsgMCBdICksIGRvdCggaW1bIDEgXSwgaW1bIDEgXSApLCBkb3QoIGltWyAyIF0sIGltWyAyIF0gKSApO1xuXHR0cmFuc2Zvcm1lZE5vcm1hbCA9IGltICogdHJhbnNmb3JtZWROb3JtYWw7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHRyYW5zZm9ybWVkVGFuZ2VudCA9IGltICogdHJhbnNmb3JtZWRUYW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZlxudHJhbnNmb3JtZWROb3JtYWwgPSBub3JtYWxNYXRyaXggKiB0cmFuc2Zvcm1lZE5vcm1hbDtcbiNpZmRlZiBGTElQX1NJREVEXG5cdHRyYW5zZm9ybWVkTm9ybWFsID0gLSB0cmFuc2Zvcm1lZE5vcm1hbDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UQU5HRU5UXG5cdHRyYW5zZm9ybWVkVGFuZ2VudCA9ICggbW9kZWxWaWV3TWF0cml4ICogdmVjNCggdHJhbnNmb3JtZWRUYW5nZW50LCAwLjAgKSApLnh5ejtcblx0I2lmZGVmIEZMSVBfU0lERURcblx0XHR0cmFuc2Zvcm1lZFRhbmdlbnQgPSAtIHRyYW5zZm9ybWVkVGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBkaXNwbGFjZW1lbnRNYXA7XG5cdHVuaWZvcm0gZmxvYXQgZGlzcGxhY2VtZW50U2NhbGU7XG5cdHVuaWZvcm0gZmxvYXQgZGlzcGxhY2VtZW50QmlhcztcbiNlbmRpZiI7Cgp2YXIgZGlzcGxhY2VtZW50bWFwX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHR0cmFuc2Zvcm1lZCArPSBub3JtYWxpemUoIG9iamVjdE5vcm1hbCApICogKCB0ZXh0dXJlMkQoIGRpc3BsYWNlbWVudE1hcCwgdkRpc3BsYWNlbWVudE1hcFV2ICkueCAqIGRpc3BsYWNlbWVudFNjYWxlICsgZGlzcGxhY2VtZW50QmlhcyApO1xuI2VuZGlmIjsKCnZhciBlbWlzc2l2ZW1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHZlYzQgZW1pc3NpdmVDb2xvciA9IHRleHR1cmUyRCggZW1pc3NpdmVNYXAsIHZFbWlzc2l2ZU1hcFV2ICk7XG5cdHRvdGFsRW1pc3NpdmVSYWRpYW5jZSAqPSBlbWlzc2l2ZUNvbG9yLnJnYjtcbiNlbmRpZiI7Cgp2YXIgZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGVtaXNzaXZlTWFwO1xuI2VuZGlmIjsKCnZhciBjb2xvcnNwYWNlX2ZyYWdtZW50ID0gImdsX0ZyYWdDb2xvciA9IGxpbmVhclRvT3V0cHV0VGV4ZWwoIGdsX0ZyYWdDb2xvciApOyI7Cgp2YXIgY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50ID0gIlxuY29uc3QgbWF0MyBMSU5FQVJfU1JHQl9UT19MSU5FQVJfRElTUExBWV9QMyA9IG1hdDMoXG5cdHZlYzMoIDAuODIyNDYyMSwgMC4xNzc1MzgsIDAuMCApLFxuXHR2ZWMzKCAwLjAzMzE5NDEsIDAuOTY2ODA1OCwgMC4wICksXG5cdHZlYzMoIDAuMDE3MDgyNywgMC4wNzIzOTc0LCAwLjkxMDUxOTkgKVxuKTtcbmNvbnN0IG1hdDMgTElORUFSX0RJU1BMQVlfUDNfVE9fTElORUFSX1NSR0IgPSBtYXQzKFxuXHR2ZWMzKCAxLjIyNDk0MDEsIC0gMC4yMjQ5NDA0LCAwLjAgKSxcblx0dmVjMyggLSAwLjA0MjA1NjksIDEuMDQyMDU3MSwgMC4wICksXG5cdHZlYzMoIC0gMC4wMTk2Mzc2LCAtIDAuMDc4NjM2MSwgMS4wOTgyNzM1IClcbik7XG52ZWM0IExpbmVhclNSR0JUb0xpbmVhckRpc3BsYXlQMyggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZlYzQoIHZhbHVlLnJnYiAqIExJTkVBUl9TUkdCX1RPX0xJTkVBUl9ESVNQTEFZX1AzLCB2YWx1ZS5hICk7XG59XG52ZWM0IExpbmVhckRpc3BsYXlQM1RvTGluZWFyU1JHQiggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZlYzQoIHZhbHVlLnJnYiAqIExJTkVBUl9ESVNQTEFZX1AzX1RPX0xJTkVBUl9TUkdCLCB2YWx1ZS5hICk7XG59XG52ZWM0IExpbmVhclRyYW5zZmVyT0VURiggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZhbHVlO1xufVxudmVjNCBzUkdCVHJhbnNmZXJPRVRGKCBpbiB2ZWM0IHZhbHVlICkge1xuXHRyZXR1cm4gdmVjNCggbWl4KCBwb3coIHZhbHVlLnJnYiwgdmVjMyggMC40MTY2NiApICkgKiAxLjA1NSAtIHZlYzMoIDAuMDU1ICksIHZhbHVlLnJnYiAqIDEyLjkyLCB2ZWMzKCBsZXNzVGhhbkVxdWFsKCB2YWx1ZS5yZ2IsIHZlYzMoIDAuMDAzMTMwOCApICkgKSApLCB2YWx1ZS5hICk7XG59XG52ZWM0IExpbmVhclRvTGluZWFyKCBpbiB2ZWM0IHZhbHVlICkge1xuXHRyZXR1cm4gdmFsdWU7XG59XG52ZWM0IExpbmVhclRvc1JHQiggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHNSR0JUcmFuc2Zlck9FVEYoIHZhbHVlICk7XG59IjsKCnZhciBlbnZtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdHZlYzMgY2FtZXJhVG9GcmFnO1xuXHRcdGlmICggaXNPcnRob2dyYXBoaWMgKSB7XG5cdFx0XHRjYW1lcmFUb0ZyYWcgPSBub3JtYWxpemUoIHZlYzMoIC0gdmlld01hdHJpeFsgMCBdWyAyIF0sIC0gdmlld01hdHJpeFsgMSBdWyAyIF0sIC0gdmlld01hdHJpeFsgMiBdWyAyIF0gKSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYW1lcmFUb0ZyYWcgPSBub3JtYWxpemUoIHZXb3JsZFBvc2l0aW9uIC0gY2FtZXJhUG9zaXRpb24gKTtcblx0XHR9XG5cdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIG5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdCNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG5cdFx0XHR2ZWMzIHJlZmxlY3RWZWMgPSByZWZsZWN0KCBjYW1lcmFUb0ZyYWcsIHdvcmxkTm9ybWFsICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZnJhY3QoIGNhbWVyYVRvRnJhZywgd29ybGROb3JtYWwsIHJlZnJhY3Rpb25SYXRpbyApO1xuXHRcdCNlbmRpZlxuXHQjZWxzZVxuXHRcdHZlYzMgcmVmbGVjdFZlYyA9IHZSZWZsZWN0O1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHR2ZWM0IGVudkNvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgdmVjMyggZmxpcEVudk1hcCAqIHJlZmxlY3RWZWMueCwgcmVmbGVjdFZlYy55eiApICk7XG5cdCNlbHNlXG5cdFx0dmVjNCBlbnZDb2xvciA9IHZlYzQoIDAuMCApO1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVk1BUF9CTEVORElOR19NVUxUSVBMWVxuXHRcdG91dGdvaW5nTGlnaHQgPSBtaXgoIG91dGdvaW5nTGlnaHQsIG91dGdvaW5nTGlnaHQgKiBlbnZDb2xvci54eXosIHNwZWN1bGFyU3RyZW5ndGggKiByZWZsZWN0aXZpdHkgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX0JMRU5ESU5HX01JWCApXG5cdFx0b3V0Z29pbmdMaWdodCA9IG1peCggb3V0Z29pbmdMaWdodCwgZW52Q29sb3IueHl6LCBzcGVjdWxhclN0cmVuZ3RoICogcmVmbGVjdGl2aXR5ICk7XG5cdCNlbGlmIGRlZmluZWQoIEVOVk1BUF9CTEVORElOR19BREQgKVxuXHRcdG91dGdvaW5nTGlnaHQgKz0gZW52Q29sb3IueHl6ICogc3BlY3VsYXJTdHJlbmd0aCAqIHJlZmxlY3Rpdml0eTtcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR1bmlmb3JtIGZsb2F0IGVudk1hcEludGVuc2l0eTtcblx0dW5pZm9ybSBmbG9hdCBmbGlwRW52TWFwO1xuXHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHRcdHVuaWZvcm0gc2FtcGxlckN1YmUgZW52TWFwO1xuXHQjZWxzZVxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIGVudk1hcDtcblx0I2VuZGlmXG5cdFxuI2VuZGlmIjsKCnZhciBlbnZtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR1bmlmb3JtIGZsb2F0IHJlZmxlY3Rpdml0eTtcblx0I2lmIGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVVNFX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFBIT05HICkgfHwgZGVmaW5lZCggTEFNQkVSVCApXG5cdFx0I2RlZmluZSBFTlZfV09STERQT1Ncblx0I2VuZGlmXG5cdCNpZmRlZiBFTlZfV09STERQT1Ncblx0XHR2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG5cdFx0dW5pZm9ybSBmbG9hdCByZWZyYWN0aW9uUmF0aW87XG5cdCNlbHNlXG5cdFx0dmFyeWluZyB2ZWMzIHZSZWZsZWN0O1xuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgZW52bWFwX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdCNpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBQSE9ORyApIHx8IGRlZmluZWQoIExBTUJFUlQgKVxuXHRcdCNkZWZpbmUgRU5WX1dPUkxEUE9TXG5cdCNlbmRpZlxuXHQjaWZkZWYgRU5WX1dPUkxEUE9TXG5cdFx0XG5cdFx0dmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuXHQjZWxzZVxuXHRcdHZhcnlpbmcgdmVjMyB2UmVmbGVjdDtcblx0XHR1bmlmb3JtIGZsb2F0IHJlZnJhY3Rpb25SYXRpbztcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGVudm1hcF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdHZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG5cdCNlbHNlXG5cdFx0dmVjMyBjYW1lcmFUb1ZlcnRleDtcblx0XHRpZiAoIGlzT3J0aG9ncmFwaGljICkge1xuXHRcdFx0Y2FtZXJhVG9WZXJ0ZXggPSBub3JtYWxpemUoIHZlYzMoIC0gdmlld01hdHJpeFsgMCBdWyAyIF0sIC0gdmlld01hdHJpeFsgMSBdWyAyIF0sIC0gdmlld01hdHJpeFsgMiBdWyAyIF0gKSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYW1lcmFUb1ZlcnRleCA9IG5vcm1hbGl6ZSggd29ybGRQb3NpdGlvbi54eXogLSBjYW1lcmFQb3NpdGlvbiApO1xuXHRcdH1cblx0XHR2ZWMzIHdvcmxkTm9ybWFsID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggdHJhbnNmb3JtZWROb3JtYWwsIHZpZXdNYXRyaXggKTtcblx0XHQjaWZkZWYgRU5WTUFQX01PREVfUkVGTEVDVElPTlxuXHRcdFx0dlJlZmxlY3QgPSByZWZsZWN0KCBjYW1lcmFUb1ZlcnRleCwgd29ybGROb3JtYWwgKTtcblx0XHQjZWxzZVxuXHRcdFx0dlJlZmxlY3QgPSByZWZyYWN0KCBjYW1lcmFUb1ZlcnRleCwgd29ybGROb3JtYWwsIHJlZnJhY3Rpb25SYXRpbyApO1xuXHRcdCNlbmRpZlxuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgZm9nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR2Rm9nRGVwdGggPSAtIG12UG9zaXRpb24uejtcbiNlbmRpZiI7Cgp2YXIgZm9nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfRk9HXG5cdHZhcnlpbmcgZmxvYXQgdkZvZ0RlcHRoO1xuI2VuZGlmIjsKCnZhciBmb2dfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9GT0dcblx0I2lmZGVmIEZPR19FWFAyXG5cdFx0ZmxvYXQgZm9nRmFjdG9yID0gMS4wIC0gZXhwKCAtIGZvZ0RlbnNpdHkgKiBmb2dEZW5zaXR5ICogdkZvZ0RlcHRoICogdkZvZ0RlcHRoICk7XG5cdCNlbHNlXG5cdFx0ZmxvYXQgZm9nRmFjdG9yID0gc21vb3Roc3RlcCggZm9nTmVhciwgZm9nRmFyLCB2Rm9nRGVwdGggKTtcblx0I2VuZGlmXG5cdGdsX0ZyYWdDb2xvci5yZ2IgPSBtaXgoIGdsX0ZyYWdDb2xvci5yZ2IsIGZvZ0NvbG9yLCBmb2dGYWN0b3IgKTtcbiNlbmRpZiI7Cgp2YXIgZm9nX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9GT0dcblx0dW5pZm9ybSB2ZWMzIGZvZ0NvbG9yO1xuXHR2YXJ5aW5nIGZsb2F0IHZGb2dEZXB0aDtcblx0I2lmZGVmIEZPR19FWFAyXG5cdFx0dW5pZm9ybSBmbG9hdCBmb2dEZW5zaXR5O1xuXHQjZWxzZVxuXHRcdHVuaWZvcm0gZmxvYXQgZm9nTmVhcjtcblx0XHR1bmlmb3JtIGZsb2F0IGZvZ0Zhcjtcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9HUkFESUVOVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBncmFkaWVudE1hcDtcbiNlbmRpZlxudmVjMyBnZXRHcmFkaWVudElycmFkaWFuY2UoIHZlYzMgbm9ybWFsLCB2ZWMzIGxpZ2h0RGlyZWN0aW9uICkge1xuXHRmbG9hdCBkb3ROTCA9IGRvdCggbm9ybWFsLCBsaWdodERpcmVjdGlvbiApO1xuXHR2ZWMyIGNvb3JkID0gdmVjMiggZG90TkwgKiAwLjUgKyAwLjUsIDAuMCApO1xuXHQjaWZkZWYgVVNFX0dSQURJRU5UTUFQXG5cdFx0cmV0dXJuIHZlYzMoIHRleHR1cmUyRCggZ3JhZGllbnRNYXAsIGNvb3JkICkuciApO1xuXHQjZWxzZVxuXHRcdHZlYzIgZncgPSBmd2lkdGgoIGNvb3JkICkgKiAwLjU7XG5cdFx0cmV0dXJuIG1peCggdmVjMyggMC43ICksIHZlYzMoIDEuMCApLCBzbW9vdGhzdGVwKCAwLjcgLSBmdy54LCAwLjcgKyBmdy54LCBjb29yZC54ICkgKTtcblx0I2VuZGlmXG59IjsKCnZhciBsaWdodG1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0xJR0hUTUFQXG5cdHZlYzQgbGlnaHRNYXBUZXhlbCA9IHRleHR1cmUyRCggbGlnaHRNYXAsIHZMaWdodE1hcFV2ICk7XG5cdHZlYzMgbGlnaHRNYXBJcnJhZGlhbmNlID0gbGlnaHRNYXBUZXhlbC5yZ2IgKiBsaWdodE1hcEludGVuc2l0eTtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGxpZ2h0TWFwSXJyYWRpYW5jZTtcbiNlbmRpZiI7Cgp2YXIgbGlnaHRtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0xJR0hUTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGxpZ2h0TWFwO1xuXHR1bmlmb3JtIGZsb2F0IGxpZ2h0TWFwSW50ZW5zaXR5O1xuI2VuZGlmIjsKCnZhciBsaWdodHNfbGFtYmVydF9mcmFnbWVudCA9ICJMYW1iZXJ0TWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiO1xubWF0ZXJpYWwuc3BlY3VsYXJTdHJlbmd0aCA9IHNwZWN1bGFyU3RyZW5ndGg7IjsKCnZhciBsaWdodHNfbGFtYmVydF9wYXJzX2ZyYWdtZW50ID0gInZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuc3RydWN0IExhbWJlcnRNYXRlcmlhbCB7XG5cdHZlYzMgZGlmZnVzZUNvbG9yO1xuXHRmbG9hdCBzcGVjdWxhclN0cmVuZ3RoO1xufTtcbnZvaWQgUkVfRGlyZWN0X0xhbWJlcnQoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIExhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IGRvdE5MICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG52b2lkIFJFX0luZGlyZWN0RGlmZnVzZV9MYW1iZXJ0KCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIExhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfTGFtYmVydFxuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX0xhbWJlcnQiOwoKdmFyIGxpZ2h0c19wYXJzX2JlZ2luID0gInVuaWZvcm0gYm9vbCByZWNlaXZlU2hhZG93O1xudW5pZm9ybSB2ZWMzIGFtYmllbnRMaWdodENvbG9yO1xuI2lmIGRlZmluZWQoIFVTRV9MSUdIVF9QUk9CRVMgKVxuXHR1bmlmb3JtIHZlYzMgbGlnaHRQcm9iZVsgOSBdO1xuI2VuZGlmXG52ZWMzIHNoR2V0SXJyYWRpYW5jZUF0KCBpbiB2ZWMzIG5vcm1hbCwgaW4gdmVjMyBzaENvZWZmaWNpZW50c1sgOSBdICkge1xuXHRmbG9hdCB4ID0gbm9ybWFsLngsIHkgPSBub3JtYWwueSwgeiA9IG5vcm1hbC56O1xuXHR2ZWMzIHJlc3VsdCA9IHNoQ29lZmZpY2llbnRzWyAwIF0gKiAwLjg4NjIyNztcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyAxIF0gKiAyLjAgKiAwLjUxMTY2NCAqIHk7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgMiBdICogMi4wICogMC41MTE2NjQgKiB6O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDMgXSAqIDIuMCAqIDAuNTExNjY0ICogeDtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA0IF0gKiAyLjAgKiAwLjQyOTA0MyAqIHggKiB5O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDUgXSAqIDIuMCAqIDAuNDI5MDQzICogeSAqIHo7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNiBdICogKCAwLjc0MzEyNSAqIHogKiB6IC0gMC4yNDc3MDggKTtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA3IF0gKiAyLjAgKiAwLjQyOTA0MyAqIHggKiB6O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDggXSAqIDAuNDI5MDQzICogKCB4ICogeCAtIHkgKiB5ICk7XG5cdHJldHVybiByZXN1bHQ7XG59XG52ZWMzIGdldExpZ2h0UHJvYmVJcnJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIGxpZ2h0UHJvYmVbIDkgXSwgY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG5cdHZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBub3JtYWwsIHZpZXdNYXRyaXggKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gc2hHZXRJcnJhZGlhbmNlQXQoIHdvcmxkTm9ybWFsLCBsaWdodFByb2JlICk7XG5cdHJldHVybiBpcnJhZGlhbmNlO1xufVxudmVjMyBnZXRBbWJpZW50TGlnaHRJcnJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIGFtYmllbnRMaWdodENvbG9yICkge1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBhbWJpZW50TGlnaHRDb2xvcjtcblx0cmV0dXJuIGlycmFkaWFuY2U7XG59XG5mbG9hdCBnZXREaXN0YW5jZUF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCBsaWdodERpc3RhbmNlLCBjb25zdCBpbiBmbG9hdCBjdXRvZmZEaXN0YW5jZSwgY29uc3QgaW4gZmxvYXQgZGVjYXlFeHBvbmVudCApIHtcblx0I2lmIGRlZmluZWQgKCBMRUdBQ1lfTElHSFRTIClcblx0XHRpZiAoIGN1dG9mZkRpc3RhbmNlID4gMC4wICYmIGRlY2F5RXhwb25lbnQgPiAwLjAgKSB7XG5cdFx0XHRyZXR1cm4gcG93KCBzYXR1cmF0ZSggLSBsaWdodERpc3RhbmNlIC8gY3V0b2ZmRGlzdGFuY2UgKyAxLjAgKSwgZGVjYXlFeHBvbmVudCApO1xuXHRcdH1cblx0XHRyZXR1cm4gMS4wO1xuXHQjZWxzZVxuXHRcdGZsb2F0IGRpc3RhbmNlRmFsbG9mZiA9IDEuMCAvIG1heCggcG93KCBsaWdodERpc3RhbmNlLCBkZWNheUV4cG9uZW50ICksIDAuMDEgKTtcblx0XHRpZiAoIGN1dG9mZkRpc3RhbmNlID4gMC4wICkge1xuXHRcdFx0ZGlzdGFuY2VGYWxsb2ZmICo9IHBvdzIoIHNhdHVyYXRlKCAxLjAgLSBwb3c0KCBsaWdodERpc3RhbmNlIC8gY3V0b2ZmRGlzdGFuY2UgKSApICk7XG5cdFx0fVxuXHRcdHJldHVybiBkaXN0YW5jZUZhbGxvZmY7XG5cdCNlbmRpZlxufVxuZmxvYXQgZ2V0U3BvdEF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCBjb25lQ29zaW5lLCBjb25zdCBpbiBmbG9hdCBwZW51bWJyYUNvc2luZSwgY29uc3QgaW4gZmxvYXQgYW5nbGVDb3NpbmUgKSB7XG5cdHJldHVybiBzbW9vdGhzdGVwKCBjb25lQ29zaW5lLCBwZW51bWJyYUNvc2luZSwgYW5nbGVDb3NpbmUgKTtcbn1cbiNpZiBOVU1fRElSX0xJR0hUUyA+IDBcblx0c3RydWN0IERpcmVjdGlvbmFsTGlnaHQge1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdH07XG5cdHVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0c1sgTlVNX0RJUl9MSUdIVFMgXTtcblx0dm9pZCBnZXREaXJlY3Rpb25hbExpZ2h0SW5mbyggY29uc3QgaW4gRGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0LCBvdXQgSW5jaWRlbnRMaWdodCBsaWdodCApIHtcblx0XHRsaWdodC5jb2xvciA9IGRpcmVjdGlvbmFsTGlnaHQuY29sb3I7XG5cdFx0bGlnaHQuZGlyZWN0aW9uID0gZGlyZWN0aW9uYWxMaWdodC5kaXJlY3Rpb247XG5cdFx0bGlnaHQudmlzaWJsZSA9IHRydWU7XG5cdH1cbiNlbmRpZlxuI2lmIE5VTV9QT0lOVF9MSUdIVFMgPiAwXG5cdHN0cnVjdCBQb2ludExpZ2h0IHtcblx0XHR2ZWMzIHBvc2l0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdFx0ZmxvYXQgZGlzdGFuY2U7XG5cdFx0ZmxvYXQgZGVjYXk7XG5cdH07XG5cdHVuaWZvcm0gUG9pbnRMaWdodCBwb2ludExpZ2h0c1sgTlVNX1BPSU5UX0xJR0hUUyBdO1xuXHR2b2lkIGdldFBvaW50TGlnaHRJbmZvKCBjb25zdCBpbiBQb2ludExpZ2h0IHBvaW50TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgb3V0IEluY2lkZW50TGlnaHQgbGlnaHQgKSB7XG5cdFx0dmVjMyBsVmVjdG9yID0gcG9pbnRMaWdodC5wb3NpdGlvbiAtIGdlb21ldHJ5UG9zaXRpb247XG5cdFx0bGlnaHQuZGlyZWN0aW9uID0gbm9ybWFsaXplKCBsVmVjdG9yICk7XG5cdFx0ZmxvYXQgbGlnaHREaXN0YW5jZSA9IGxlbmd0aCggbFZlY3RvciApO1xuXHRcdGxpZ2h0LmNvbG9yID0gcG9pbnRMaWdodC5jb2xvcjtcblx0XHRsaWdodC5jb2xvciAqPSBnZXREaXN0YW5jZUF0dGVudWF0aW9uKCBsaWdodERpc3RhbmNlLCBwb2ludExpZ2h0LmRpc3RhbmNlLCBwb2ludExpZ2h0LmRlY2F5ICk7XG5cdFx0bGlnaHQudmlzaWJsZSA9ICggbGlnaHQuY29sb3IgIT0gdmVjMyggMC4wICkgKTtcblx0fVxuI2VuZGlmXG4jaWYgTlVNX1NQT1RfTElHSFRTID4gMFxuXHRzdHJ1Y3QgU3BvdExpZ2h0IHtcblx0XHR2ZWMzIHBvc2l0aW9uO1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdFx0ZmxvYXQgZGlzdGFuY2U7XG5cdFx0ZmxvYXQgZGVjYXk7XG5cdFx0ZmxvYXQgY29uZUNvcztcblx0XHRmbG9hdCBwZW51bWJyYUNvcztcblx0fTtcblx0dW5pZm9ybSBTcG90TGlnaHQgc3BvdExpZ2h0c1sgTlVNX1NQT1RfTElHSFRTIF07XG5cdHZvaWQgZ2V0U3BvdExpZ2h0SW5mbyggY29uc3QgaW4gU3BvdExpZ2h0IHNwb3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBvdXQgSW5jaWRlbnRMaWdodCBsaWdodCApIHtcblx0XHR2ZWMzIGxWZWN0b3IgPSBzcG90TGlnaHQucG9zaXRpb24gLSBnZW9tZXRyeVBvc2l0aW9uO1xuXHRcdGxpZ2h0LmRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggbFZlY3RvciApO1xuXHRcdGZsb2F0IGFuZ2xlQ29zID0gZG90KCBsaWdodC5kaXJlY3Rpb24sIHNwb3RMaWdodC5kaXJlY3Rpb24gKTtcblx0XHRmbG9hdCBzcG90QXR0ZW51YXRpb24gPSBnZXRTcG90QXR0ZW51YXRpb24oIHNwb3RMaWdodC5jb25lQ29zLCBzcG90TGlnaHQucGVudW1icmFDb3MsIGFuZ2xlQ29zICk7XG5cdFx0aWYgKCBzcG90QXR0ZW51YXRpb24gPiAwLjAgKSB7XG5cdFx0XHRmbG9hdCBsaWdodERpc3RhbmNlID0gbGVuZ3RoKCBsVmVjdG9yICk7XG5cdFx0XHRsaWdodC5jb2xvciA9IHNwb3RMaWdodC5jb2xvciAqIHNwb3RBdHRlbnVhdGlvbjtcblx0XHRcdGxpZ2h0LmNvbG9yICo9IGdldERpc3RhbmNlQXR0ZW51YXRpb24oIGxpZ2h0RGlzdGFuY2UsIHNwb3RMaWdodC5kaXN0YW5jZSwgc3BvdExpZ2h0LmRlY2F5ICk7XG5cdFx0XHRsaWdodC52aXNpYmxlID0gKCBsaWdodC5jb2xvciAhPSB2ZWMzKCAwLjAgKSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsaWdodC5jb2xvciA9IHZlYzMoIDAuMCApO1xuXHRcdFx0bGlnaHQudmlzaWJsZSA9IGZhbHNlO1xuXHRcdH1cblx0fVxuI2VuZGlmXG4jaWYgTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBSZWN0QXJlYUxpZ2h0IHtcblx0XHR2ZWMzIGNvbG9yO1xuXHRcdHZlYzMgcG9zaXRpb247XG5cdFx0dmVjMyBoYWxmV2lkdGg7XG5cdFx0dmVjMyBoYWxmSGVpZ2h0O1xuXHR9O1xuXHR1bmlmb3JtIHNhbXBsZXIyRCBsdGNfMTtcdHVuaWZvcm0gc2FtcGxlcjJEIGx0Y18yO1xuXHR1bmlmb3JtIFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodHNbIE5VTV9SRUNUX0FSRUFfTElHSFRTIF07XG4jZW5kaWZcbiNpZiBOVU1fSEVNSV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBIZW1pc3BoZXJlTGlnaHQge1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgc2t5Q29sb3I7XG5cdFx0dmVjMyBncm91bmRDb2xvcjtcblx0fTtcblx0dW5pZm9ybSBIZW1pc3BoZXJlTGlnaHQgaGVtaXNwaGVyZUxpZ2h0c1sgTlVNX0hFTUlfTElHSFRTIF07XG5cdHZlYzMgZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gSGVtaXNwaGVyZUxpZ2h0IGhlbWlMaWdodCwgY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG5cdFx0ZmxvYXQgZG90TkwgPSBkb3QoIG5vcm1hbCwgaGVtaUxpZ2h0LmRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IGhlbWlEaWZmdXNlV2VpZ2h0ID0gMC41ICogZG90TkwgKyAwLjU7XG5cdFx0dmVjMyBpcnJhZGlhbmNlID0gbWl4KCBoZW1pTGlnaHQuZ3JvdW5kQ29sb3IsIGhlbWlMaWdodC5za3lDb2xvciwgaGVtaURpZmZ1c2VXZWlnaHQgKTtcblx0XHRyZXR1cm4gaXJyYWRpYW5jZTtcblx0fVxuI2VuZGlmIjsKCnZhciBlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR2ZWMzIGdldElCTElycmFkaWFuY2UoIGNvbnN0IGluIHZlYzMgbm9ybWFsICkge1xuXHRcdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFX1VWXG5cdFx0XHR2ZWMzIHdvcmxkTm9ybWFsID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmVVViggZW52TWFwLCB3b3JsZE5vcm1hbCwgMS4wICk7XG5cdFx0XHRyZXR1cm4gUEkgKiBlbnZNYXBDb2xvci5yZ2IgKiBlbnZNYXBJbnRlbnNpdHk7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB2ZWMzKCAwLjAgKTtcblx0XHQjZW5kaWZcblx0fVxuXHR2ZWMzIGdldElCTFJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdFx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVfVVZcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZmxlY3QoIC0gdmlld0Rpciwgbm9ybWFsICk7XG5cdFx0XHRyZWZsZWN0VmVjID0gbm9ybWFsaXplKCBtaXgoIHJlZmxlY3RWZWMsIG5vcm1hbCwgcm91Z2huZXNzICogcm91Z2huZXNzKSApO1xuXHRcdFx0cmVmbGVjdFZlYyA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHJlZmxlY3RWZWMsIHZpZXdNYXRyaXggKTtcblx0XHRcdHZlYzQgZW52TWFwQ29sb3IgPSB0ZXh0dXJlQ3ViZVVWKCBlbnZNYXAsIHJlZmxlY3RWZWMsIHJvdWdobmVzcyApO1xuXHRcdFx0cmV0dXJuIGVudk1hcENvbG9yLnJnYiAqIGVudk1hcEludGVuc2l0eTtcblx0XHQjZWxzZVxuXHRcdFx0cmV0dXJuIHZlYzMoIDAuMCApO1xuXHRcdCNlbmRpZlxuXHR9XG5cdCNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHRcdHZlYzMgZ2V0SUJMQW5pc290cm9weVJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGNvbnN0IGluIHZlYzMgYml0YW5nZW50LCBjb25zdCBpbiBmbG9hdCBhbmlzb3Ryb3B5ICkge1xuXHRcdFx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVfVVZcblx0XHRcdFx0dmVjMyBiZW50Tm9ybWFsID0gY3Jvc3MoIGJpdGFuZ2VudCwgdmlld0RpciApO1xuXHRcdFx0XHRiZW50Tm9ybWFsID0gbm9ybWFsaXplKCBjcm9zcyggYmVudE5vcm1hbCwgYml0YW5nZW50ICkgKTtcblx0XHRcdFx0YmVudE5vcm1hbCA9IG5vcm1hbGl6ZSggbWl4KCBiZW50Tm9ybWFsLCBub3JtYWwsIHBvdzIoIHBvdzIoIDEuMCAtIGFuaXNvdHJvcHkgKiAoIDEuMCAtIHJvdWdobmVzcyApICkgKSApICk7XG5cdFx0XHRcdHJldHVybiBnZXRJQkxSYWRpYW5jZSggdmlld0RpciwgYmVudE5vcm1hbCwgcm91Z2huZXNzICk7XG5cdFx0XHQjZWxzZVxuXHRcdFx0XHRyZXR1cm4gdmVjMyggMC4wICk7XG5cdFx0XHQjZW5kaWZcblx0XHR9XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBsaWdodHNfdG9vbl9mcmFnbWVudCA9ICJUb29uTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiOyI7Cgp2YXIgbGlnaHRzX3Rvb25fcGFyc19mcmFnbWVudCA9ICJ2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbnN0cnVjdCBUb29uTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcbn07XG52b2lkIFJFX0RpcmVjdF9Ub29uKCBjb25zdCBpbiBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBUb29uTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBnZXRHcmFkaWVudElycmFkaWFuY2UoIGdlb21ldHJ5Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfVG9vbiggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBUb29uTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG4jZGVmaW5lIFJFX0RpcmVjdFx0XHRcdFx0UkVfRGlyZWN0X1Rvb25cbiNkZWZpbmUgUkVfSW5kaXJlY3REaWZmdXNlXHRcdFJFX0luZGlyZWN0RGlmZnVzZV9Ub29uIjsKCnZhciBsaWdodHNfcGhvbmdfZnJhZ21lbnQgPSAiQmxpbm5QaG9uZ01hdGVyaWFsIG1hdGVyaWFsO1xubWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gZGlmZnVzZUNvbG9yLnJnYjtcbm1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgPSBzcGVjdWxhcjtcbm1hdGVyaWFsLnNwZWN1bGFyU2hpbmluZXNzID0gc2hpbmluZXNzO1xubWF0ZXJpYWwuc3BlY3VsYXJTdHJlbmd0aCA9IHNwZWN1bGFyU3RyZW5ndGg7IjsKCnZhciBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCA9ICJ2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbnN0cnVjdCBCbGlublBob25nTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcblx0dmVjMyBzcGVjdWxhckNvbG9yO1xuXHRmbG9hdCBzcGVjdWxhclNoaW5pbmVzcztcblx0ZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbn07XG52b2lkIFJFX0RpcmVjdF9CbGlublBob25nKCBjb25zdCBpbiBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBkb3ROTCAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBpcnJhZGlhbmNlICogQlJERl9CbGlublBob25nKCBkaXJlY3RMaWdodC5kaXJlY3Rpb24sIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyU2hpbmluZXNzICkgKiBtYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfQmxpbm5QaG9uZyggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG4jZGVmaW5lIFJFX0RpcmVjdFx0XHRcdFx0UkVfRGlyZWN0X0JsaW5uUGhvbmdcbiNkZWZpbmUgUkVfSW5kaXJlY3REaWZmdXNlXHRcdFJFX0luZGlyZWN0RGlmZnVzZV9CbGlublBob25nIjsKCnZhciBsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQgPSAiUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbDtcbm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IGRpZmZ1c2VDb2xvci5yZ2IgKiAoIDEuMCAtIG1ldGFsbmVzc0ZhY3RvciApO1xudmVjMyBkeHkgPSBtYXgoIGFicyggZEZkeCggbm9uUGVydHVyYmVkTm9ybWFsICkgKSwgYWJzKCBkRmR5KCBub25QZXJ0dXJiZWROb3JtYWwgKSApICk7XG5mbG9hdCBnZW9tZXRyeVJvdWdobmVzcyA9IG1heCggbWF4KCBkeHkueCwgZHh5LnkgKSwgZHh5LnogKTtcbm1hdGVyaWFsLnJvdWdobmVzcyA9IG1heCggcm91Z2huZXNzRmFjdG9yLCAwLjA1MjUgKTttYXRlcmlhbC5yb3VnaG5lc3MgKz0gZ2VvbWV0cnlSb3VnaG5lc3M7XG5tYXRlcmlhbC5yb3VnaG5lc3MgPSBtaW4oIG1hdGVyaWFsLnJvdWdobmVzcywgMS4wICk7XG4jaWZkZWYgSU9SXG5cdG1hdGVyaWFsLmlvciA9IGlvcjtcblx0I2lmZGVmIFVTRV9TUEVDVUxBUlxuXHRcdGZsb2F0IHNwZWN1bGFySW50ZW5zaXR5RmFjdG9yID0gc3BlY3VsYXJJbnRlbnNpdHk7XG5cdFx0dmVjMyBzcGVjdWxhckNvbG9yRmFjdG9yID0gc3BlY3VsYXJDb2xvcjtcblx0XHQjaWZkZWYgVVNFX1NQRUNVTEFSX0NPTE9STUFQXG5cdFx0XHRzcGVjdWxhckNvbG9yRmFjdG9yICo9IHRleHR1cmUyRCggc3BlY3VsYXJDb2xvck1hcCwgdlNwZWN1bGFyQ29sb3JNYXBVdiApLnJnYjtcblx0XHQjZW5kaWZcblx0XHQjaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHRcdFx0c3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IgKj0gdGV4dHVyZTJEKCBzcGVjdWxhckludGVuc2l0eU1hcCwgdlNwZWN1bGFySW50ZW5zaXR5TWFwVXYgKS5hO1xuXHRcdCNlbmRpZlxuXHRcdG1hdGVyaWFsLnNwZWN1bGFyRjkwID0gbWl4KCBzcGVjdWxhckludGVuc2l0eUZhY3RvciwgMS4wLCBtZXRhbG5lc3NGYWN0b3IgKTtcblx0I2Vsc2Vcblx0XHRmbG9hdCBzcGVjdWxhckludGVuc2l0eUZhY3RvciA9IDEuMDtcblx0XHR2ZWMzIHNwZWN1bGFyQ29sb3JGYWN0b3IgPSB2ZWMzKCAxLjAgKTtcblx0XHRtYXRlcmlhbC5zcGVjdWxhckY5MCA9IDEuMDtcblx0I2VuZGlmXG5cdG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgPSBtaXgoIG1pbiggcG93MiggKCBtYXRlcmlhbC5pb3IgLSAxLjAgKSAvICggbWF0ZXJpYWwuaW9yICsgMS4wICkgKSAqIHNwZWN1bGFyQ29sb3JGYWN0b3IsIHZlYzMoIDEuMCApICkgKiBzcGVjdWxhckludGVuc2l0eUZhY3RvciwgZGlmZnVzZUNvbG9yLnJnYiwgbWV0YWxuZXNzRmFjdG9yICk7XG4jZWxzZVxuXHRtYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gbWl4KCB2ZWMzKCAwLjA0ICksIGRpZmZ1c2VDb2xvci5yZ2IsIG1ldGFsbmVzc0ZhY3RvciApO1xuXHRtYXRlcmlhbC5zcGVjdWxhckY5MCA9IDEuMDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0bWF0ZXJpYWwuY2xlYXJjb2F0ID0gY2xlYXJjb2F0O1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgPSBjbGVhcmNvYXRSb3VnaG5lc3M7XG5cdG1hdGVyaWFsLmNsZWFyY29hdEYwID0gdmVjMyggMC4wNCApO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRGOTAgPSAxLjA7XG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG5cdFx0bWF0ZXJpYWwuY2xlYXJjb2F0ICo9IHRleHR1cmUyRCggY2xlYXJjb2F0TWFwLCB2Q2xlYXJjb2F0TWFwVXYgKS54O1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQXG5cdFx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICo9IHRleHR1cmUyRCggY2xlYXJjb2F0Um91Z2huZXNzTWFwLCB2Q2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgKS55O1xuXHQjZW5kaWZcblx0bWF0ZXJpYWwuY2xlYXJjb2F0ID0gc2F0dXJhdGUoIG1hdGVyaWFsLmNsZWFyY29hdCApO1x0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzID0gbWF4KCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MsIDAuMDUyNSApO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgKz0gZ2VvbWV0cnlSb3VnaG5lc3M7XG5cdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyA9IG1pbiggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzLCAxLjAgKTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IGlyaWRlc2NlbmNlO1xuXHRtYXRlcmlhbC5pcmlkZXNjZW5jZUlPUiA9IGlyaWRlc2NlbmNlSU9SO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFTUFQXG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2UgKj0gdGV4dHVyZTJEKCBpcmlkZXNjZW5jZU1hcCwgdklyaWRlc2NlbmNlTWFwVXYgKS5yO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzcyA9IChpcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW0gLSBpcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW0pICogdGV4dHVyZTJEKCBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcCwgdklyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgKS5nICsgaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtO1xuXHQjZWxzZVxuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzID0gaXJpZGVzY2VuY2VUaGlja25lc3NNYXhpbXVtO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTlxuXHRtYXRlcmlhbC5zaGVlbkNvbG9yID0gc2hlZW5Db2xvcjtcblx0I2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHRcdG1hdGVyaWFsLnNoZWVuQ29sb3IgKj0gdGV4dHVyZTJEKCBzaGVlbkNvbG9yTWFwLCB2U2hlZW5Db2xvck1hcFV2ICkucmdiO1xuXHQjZW5kaWZcblx0bWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgPSBjbGFtcCggc2hlZW5Sb3VnaG5lc3MsIDAuMDcsIDEuMCApO1xuXHQjaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHRcdG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzICo9IHRleHR1cmUyRCggc2hlZW5Sb3VnaG5lc3NNYXAsIHZTaGVlblJvdWdobmVzc01hcFV2ICkuYTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0XHRtYXQyIGFuaXNvdHJvcHlNYXQgPSBtYXQyKCBhbmlzb3Ryb3B5VmVjdG9yLngsIGFuaXNvdHJvcHlWZWN0b3IueSwgLSBhbmlzb3Ryb3B5VmVjdG9yLnksIGFuaXNvdHJvcHlWZWN0b3IueCApO1xuXHRcdHZlYzMgYW5pc290cm9weVBvbGFyID0gdGV4dHVyZTJEKCBhbmlzb3Ryb3B5TWFwLCB2QW5pc290cm9weU1hcFV2ICkucmdiO1xuXHRcdHZlYzIgYW5pc290cm9weVYgPSBhbmlzb3Ryb3B5TWF0ICogbm9ybWFsaXplKCAyLjAgKiBhbmlzb3Ryb3B5UG9sYXIucmcgLSB2ZWMyKCAxLjAgKSApICogYW5pc290cm9weVBvbGFyLmI7XG5cdCNlbHNlXG5cdFx0dmVjMiBhbmlzb3Ryb3B5ViA9IGFuaXNvdHJvcHlWZWN0b3I7XG5cdCNlbmRpZlxuXHRtYXRlcmlhbC5hbmlzb3Ryb3B5ID0gbGVuZ3RoKCBhbmlzb3Ryb3B5ViApO1xuXHRpZiggbWF0ZXJpYWwuYW5pc290cm9weSA9PSAwLjAgKSB7XG5cdFx0YW5pc290cm9weVYgPSB2ZWMyKCAxLjAsIDAuMCApO1xuXHR9IGVsc2Uge1xuXHRcdGFuaXNvdHJvcHlWIC89IG1hdGVyaWFsLmFuaXNvdHJvcHk7XG5cdFx0bWF0ZXJpYWwuYW5pc290cm9weSA9IHNhdHVyYXRlKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICk7XG5cdH1cblx0bWF0ZXJpYWwuYWxwaGFUID0gbWl4KCBwb3cyKCBtYXRlcmlhbC5yb3VnaG5lc3MgKSwgMS4wLCBwb3cyKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICkgKTtcblx0bWF0ZXJpYWwuYW5pc290cm9weVQgPSB0Ym5bIDAgXSAqIGFuaXNvdHJvcHlWLnggKyB0Ym5bIDEgXSAqIGFuaXNvdHJvcHlWLnk7XG5cdG1hdGVyaWFsLmFuaXNvdHJvcHlCID0gdGJuWyAxIF0gKiBhbmlzb3Ryb3B5Vi54IC0gdGJuWyAwIF0gKiBhbmlzb3Ryb3B5Vi55O1xuI2VuZGlmIjsKCnZhciBsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudCA9ICJzdHJ1Y3QgUGh5c2ljYWxNYXRlcmlhbCB7XG5cdHZlYzMgZGlmZnVzZUNvbG9yO1xuXHRmbG9hdCByb3VnaG5lc3M7XG5cdHZlYzMgc3BlY3VsYXJDb2xvcjtcblx0ZmxvYXQgc3BlY3VsYXJGOTA7XG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0ZmxvYXQgY2xlYXJjb2F0O1xuXHRcdGZsb2F0IGNsZWFyY29hdFJvdWdobmVzcztcblx0XHR2ZWMzIGNsZWFyY29hdEYwO1xuXHRcdGZsb2F0IGNsZWFyY29hdEY5MDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0XHRmbG9hdCBpcmlkZXNjZW5jZTtcblx0XHRmbG9hdCBpcmlkZXNjZW5jZUlPUjtcblx0XHRmbG9hdCBpcmlkZXNjZW5jZVRoaWNrbmVzcztcblx0XHR2ZWMzIGlyaWRlc2NlbmNlRnJlc25lbDtcblx0XHR2ZWMzIGlyaWRlc2NlbmNlRjA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0dmVjMyBzaGVlbkNvbG9yO1xuXHRcdGZsb2F0IHNoZWVuUm91Z2huZXNzO1xuXHQjZW5kaWZcblx0I2lmZGVmIElPUlxuXHRcdGZsb2F0IGlvcjtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdFx0ZmxvYXQgdHJhbnNtaXNzaW9uO1xuXHRcdGZsb2F0IHRyYW5zbWlzc2lvbkFscGhhO1xuXHRcdGZsb2F0IHRoaWNrbmVzcztcblx0XHRmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlO1xuXHRcdHZlYzMgYXR0ZW51YXRpb25Db2xvcjtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHRcdGZsb2F0IGFuaXNvdHJvcHk7XG5cdFx0ZmxvYXQgYWxwaGFUO1xuXHRcdHZlYzMgYW5pc290cm9weVQ7XG5cdFx0dmVjMyBhbmlzb3Ryb3B5Qjtcblx0I2VuZGlmXG59O1xudmVjMyBjbGVhcmNvYXRTcGVjdWxhckRpcmVjdCA9IHZlYzMoIDAuMCApO1xudmVjMyBjbGVhcmNvYXRTcGVjdWxhckluZGlyZWN0ID0gdmVjMyggMC4wICk7XG52ZWMzIHNoZWVuU3BlY3VsYXJEaXJlY3QgPSB2ZWMzKCAwLjAgKTtcbnZlYzMgc2hlZW5TcGVjdWxhckluZGlyZWN0ID0gdmVjMygwLjAgKTtcbnZlYzMgU2NobGlja190b19GMCggY29uc3QgaW4gdmVjMyBmLCBjb25zdCBpbiBmbG9hdCBmOTAsIGNvbnN0IGluIGZsb2F0IGRvdFZIICkge1xuICAgIGZsb2F0IHggPSBjbGFtcCggMS4wIC0gZG90VkgsIDAuMCwgMS4wICk7XG4gICAgZmxvYXQgeDIgPSB4ICogeDtcbiAgICBmbG9hdCB4NSA9IGNsYW1wKCB4ICogeDIgKiB4MiwgMC4wLCAwLjk5OTkgKTtcbiAgICByZXR1cm4gKCBmIC0gdmVjMyggZjkwICkgKiB4NSApIC8gKCAxLjAgLSB4NSApO1xufVxuZmxvYXQgVl9HR1hfU21pdGhDb3JyZWxhdGVkKCBjb25zdCBpbiBmbG9hdCBhbHBoYSwgY29uc3QgaW4gZmxvYXQgZG90TkwsIGNvbnN0IGluIGZsb2F0IGRvdE5WICkge1xuXHRmbG9hdCBhMiA9IHBvdzIoIGFscGhhICk7XG5cdGZsb2F0IGd2ID0gZG90TkwgKiBzcXJ0KCBhMiArICggMS4wIC0gYTIgKSAqIHBvdzIoIGRvdE5WICkgKTtcblx0ZmxvYXQgZ2wgPSBkb3ROViAqIHNxcnQoIGEyICsgKCAxLjAgLSBhMiApICogcG93MiggZG90TkwgKSApO1xuXHRyZXR1cm4gMC41IC8gbWF4KCBndiArIGdsLCBFUFNJTE9OICk7XG59XG5mbG9hdCBEX0dHWCggY29uc3QgaW4gZmxvYXQgYWxwaGEsIGNvbnN0IGluIGZsb2F0IGRvdE5IICkge1xuXHRmbG9hdCBhMiA9IHBvdzIoIGFscGhhICk7XG5cdGZsb2F0IGRlbm9tID0gcG93MiggZG90TkggKSAqICggYTIgLSAxLjAgKSArIDEuMDtcblx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiBhMiAvIHBvdzIoIGRlbm9tICk7XG59XG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0ZmxvYXQgVl9HR1hfU21pdGhDb3JyZWxhdGVkX0FuaXNvdHJvcGljKCBjb25zdCBpbiBmbG9hdCBhbHBoYVQsIGNvbnN0IGluIGZsb2F0IGFscGhhQiwgY29uc3QgaW4gZmxvYXQgZG90VFYsIGNvbnN0IGluIGZsb2F0IGRvdEJWLCBjb25zdCBpbiBmbG9hdCBkb3RUTCwgY29uc3QgaW4gZmxvYXQgZG90QkwsIGNvbnN0IGluIGZsb2F0IGRvdE5WLCBjb25zdCBpbiBmbG9hdCBkb3ROTCApIHtcblx0XHRmbG9hdCBndiA9IGRvdE5MICogbGVuZ3RoKCB2ZWMzKCBhbHBoYVQgKiBkb3RUViwgYWxwaGFCICogZG90QlYsIGRvdE5WICkgKTtcblx0XHRmbG9hdCBnbCA9IGRvdE5WICogbGVuZ3RoKCB2ZWMzKCBhbHBoYVQgKiBkb3RUTCwgYWxwaGFCICogZG90QkwsIGRvdE5MICkgKTtcblx0XHRmbG9hdCB2ID0gMC41IC8gKCBndiArIGdsICk7XG5cdFx0cmV0dXJuIHNhdHVyYXRlKHYpO1xuXHR9XG5cdGZsb2F0IERfR0dYX0FuaXNvdHJvcGljKCBjb25zdCBpbiBmbG9hdCBhbHBoYVQsIGNvbnN0IGluIGZsb2F0IGFscGhhQiwgY29uc3QgaW4gZmxvYXQgZG90TkgsIGNvbnN0IGluIGZsb2F0IGRvdFRILCBjb25zdCBpbiBmbG9hdCBkb3RCSCApIHtcblx0XHRmbG9hdCBhMiA9IGFscGhhVCAqIGFscGhhQjtcblx0XHRoaWdocCB2ZWMzIHYgPSB2ZWMzKCBhbHBoYUIgKiBkb3RUSCwgYWxwaGFUICogZG90QkgsIGEyICogZG90TkggKTtcblx0XHRoaWdocCBmbG9hdCB2MiA9IGRvdCggdiwgdiApO1xuXHRcdGZsb2F0IHcyID0gYTIgLyB2Mjtcblx0XHRyZXR1cm4gUkVDSVBST0NBTF9QSSAqIGEyICogcG93MiAoIHcyICk7XG5cdH1cbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0dmVjMyBCUkRGX0dHWF9DbGVhcmNvYXQoIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwpIHtcblx0XHR2ZWMzIGYwID0gbWF0ZXJpYWwuY2xlYXJjb2F0RjA7XG5cdFx0ZmxvYXQgZjkwID0gbWF0ZXJpYWwuY2xlYXJjb2F0RjkwO1xuXHRcdGZsb2F0IHJvdWdobmVzcyA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcztcblx0XHRmbG9hdCBhbHBoYSA9IHBvdzIoIHJvdWdobmVzcyApO1xuXHRcdHZlYzMgaGFsZkRpciA9IG5vcm1hbGl6ZSggbGlnaHREaXIgKyB2aWV3RGlyICk7XG5cdFx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGxpZ2h0RGlyICkgKTtcblx0XHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgdmlld0RpciApICk7XG5cdFx0ZmxvYXQgZG90TkggPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGhhbGZEaXIgKSApO1xuXHRcdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdFx0dmVjMyBGID0gRl9TY2hsaWNrKCBmMCwgZjkwLCBkb3RWSCApO1xuXHRcdGZsb2F0IFYgPSBWX0dHWF9TbWl0aENvcnJlbGF0ZWQoIGFscGhhLCBkb3ROTCwgZG90TlYgKTtcblx0XHRmbG9hdCBEID0gRF9HR1goIGFscGhhLCBkb3ROSCApO1xuXHRcdHJldHVybiBGICogKCBWICogRCApO1xuXHR9XG4jZW5kaWZcbnZlYzMgQlJERl9HR1goIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwgKSB7XG5cdHZlYzMgZjAgPSBtYXRlcmlhbC5zcGVjdWxhckNvbG9yO1xuXHRmbG9hdCBmOTAgPSBtYXRlcmlhbC5zcGVjdWxhckY5MDtcblx0ZmxvYXQgcm91Z2huZXNzID0gbWF0ZXJpYWwucm91Z2huZXNzO1xuXHRmbG9hdCBhbHBoYSA9IHBvdzIoIHJvdWdobmVzcyApO1xuXHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgbGlnaHREaXIgKSApO1xuXHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgdmlld0RpciApICk7XG5cdGZsb2F0IGRvdE5IID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBoYWxmRGlyICkgKTtcblx0ZmxvYXQgZG90VkggPSBzYXR1cmF0ZSggZG90KCB2aWV3RGlyLCBoYWxmRGlyICkgKTtcblx0dmVjMyBGID0gRl9TY2hsaWNrKCBmMCwgZjkwLCBkb3RWSCApO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0RiA9IG1peCggRiwgbWF0ZXJpYWwuaXJpZGVzY2VuY2VGcmVzbmVsLCBtYXRlcmlhbC5pcmlkZXNjZW5jZSApO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdFx0ZmxvYXQgZG90VEwgPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlULCBsaWdodERpciApO1xuXHRcdGZsb2F0IGRvdFRWID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5VCwgdmlld0RpciApO1xuXHRcdGZsb2F0IGRvdFRIID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5VCwgaGFsZkRpciApO1xuXHRcdGZsb2F0IGRvdEJMID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5QiwgbGlnaHREaXIgKTtcblx0XHRmbG9hdCBkb3RCViA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weUIsIHZpZXdEaXIgKTtcblx0XHRmbG9hdCBkb3RCSCA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weUIsIGhhbGZEaXIgKTtcblx0XHRmbG9hdCBWID0gVl9HR1hfU21pdGhDb3JyZWxhdGVkX0FuaXNvdHJvcGljKCBtYXRlcmlhbC5hbHBoYVQsIGFscGhhLCBkb3RUViwgZG90QlYsIGRvdFRMLCBkb3RCTCwgZG90TlYsIGRvdE5MICk7XG5cdFx0ZmxvYXQgRCA9IERfR0dYX0FuaXNvdHJvcGljKCBtYXRlcmlhbC5hbHBoYVQsIGFscGhhLCBkb3ROSCwgZG90VEgsIGRvdEJIICk7XG5cdCNlbHNlXG5cdFx0ZmxvYXQgViA9IFZfR0dYX1NtaXRoQ29ycmVsYXRlZCggYWxwaGEsIGRvdE5MLCBkb3ROViApO1xuXHRcdGZsb2F0IEQgPSBEX0dHWCggYWxwaGEsIGRvdE5IICk7XG5cdCNlbmRpZlxuXHRyZXR1cm4gRiAqICggViAqIEQgKTtcbn1cbnZlYzIgTFRDX1V2KCBjb25zdCBpbiB2ZWMzIE4sIGNvbnN0IGluIHZlYzMgViwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRjb25zdCBmbG9hdCBMVVRfU0laRSA9IDY0LjA7XG5cdGNvbnN0IGZsb2F0IExVVF9TQ0FMRSA9ICggTFVUX1NJWkUgLSAxLjAgKSAvIExVVF9TSVpFO1xuXHRjb25zdCBmbG9hdCBMVVRfQklBUyA9IDAuNSAvIExVVF9TSVpFO1xuXHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIE4sIFYgKSApO1xuXHR2ZWMyIHV2ID0gdmVjMiggcm91Z2huZXNzLCBzcXJ0KCAxLjAgLSBkb3ROViApICk7XG5cdHV2ID0gdXYgKiBMVVRfU0NBTEUgKyBMVVRfQklBUztcblx0cmV0dXJuIHV2O1xufVxuZmxvYXQgTFRDX0NsaXBwZWRTcGhlcmVGb3JtRmFjdG9yKCBjb25zdCBpbiB2ZWMzIGYgKSB7XG5cdGZsb2F0IGwgPSBsZW5ndGgoIGYgKTtcblx0cmV0dXJuIG1heCggKCBsICogbCArIGYueiApIC8gKCBsICsgMS4wICksIDAuMCApO1xufVxudmVjMyBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvbnN0IGluIHZlYzMgdjEsIGNvbnN0IGluIHZlYzMgdjIgKSB7XG5cdGZsb2F0IHggPSBkb3QoIHYxLCB2MiApO1xuXHRmbG9hdCB5ID0gYWJzKCB4ICk7XG5cdGZsb2F0IGEgPSAwLjg1NDM5ODUgKyAoIDAuNDk2NTE1NSArIDAuMDE0NTIwNiAqIHkgKSAqIHk7XG5cdGZsb2F0IGIgPSAzLjQxNzU5NDAgKyAoIDQuMTYxNjcyNCArIHkgKSAqIHk7XG5cdGZsb2F0IHYgPSBhIC8gYjtcblx0ZmxvYXQgdGhldGFfc2ludGhldGEgPSAoIHggPiAwLjAgKSA/IHYgOiAwLjUgKiBpbnZlcnNlc3FydCggbWF4KCAxLjAgLSB4ICogeCwgMWUtNyApICkgLSB2O1xuXHRyZXR1cm4gY3Jvc3MoIHYxLCB2MiApICogdGhldGFfc2ludGhldGE7XG59XG52ZWMzIExUQ19FdmFsdWF0ZSggY29uc3QgaW4gdmVjMyBOLCBjb25zdCBpbiB2ZWMzIFYsIGNvbnN0IGluIHZlYzMgUCwgY29uc3QgaW4gbWF0MyBtSW52LCBjb25zdCBpbiB2ZWMzIHJlY3RDb29yZHNbIDQgXSApIHtcblx0dmVjMyB2MSA9IHJlY3RDb29yZHNbIDEgXSAtIHJlY3RDb29yZHNbIDAgXTtcblx0dmVjMyB2MiA9IHJlY3RDb29yZHNbIDMgXSAtIHJlY3RDb29yZHNbIDAgXTtcblx0dmVjMyBsaWdodE5vcm1hbCA9IGNyb3NzKCB2MSwgdjIgKTtcblx0aWYoIGRvdCggbGlnaHROb3JtYWwsIFAgLSByZWN0Q29vcmRzWyAwIF0gKSA8IDAuMCApIHJldHVybiB2ZWMzKCAwLjAgKTtcblx0dmVjMyBUMSwgVDI7XG5cdFQxID0gbm9ybWFsaXplKCBWIC0gTiAqIGRvdCggViwgTiApICk7XG5cdFQyID0gLSBjcm9zcyggTiwgVDEgKTtcblx0bWF0MyBtYXQgPSBtSW52ICogdHJhbnNwb3NlTWF0MyggbWF0MyggVDEsIFQyLCBOICkgKTtcblx0dmVjMyBjb29yZHNbIDQgXTtcblx0Y29vcmRzWyAwIF0gPSBtYXQgKiAoIHJlY3RDb29yZHNbIDAgXSAtIFAgKTtcblx0Y29vcmRzWyAxIF0gPSBtYXQgKiAoIHJlY3RDb29yZHNbIDEgXSAtIFAgKTtcblx0Y29vcmRzWyAyIF0gPSBtYXQgKiAoIHJlY3RDb29yZHNbIDIgXSAtIFAgKTtcblx0Y29vcmRzWyAzIF0gPSBtYXQgKiAoIHJlY3RDb29yZHNbIDMgXSAtIFAgKTtcblx0Y29vcmRzWyAwIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMCBdICk7XG5cdGNvb3Jkc1sgMSBdID0gbm9ybWFsaXplKCBjb29yZHNbIDEgXSApO1xuXHRjb29yZHNbIDIgXSA9IG5vcm1hbGl6ZSggY29vcmRzWyAyIF0gKTtcblx0Y29vcmRzWyAzIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMyBdICk7XG5cdHZlYzMgdmVjdG9yRm9ybUZhY3RvciA9IHZlYzMoIDAuMCApO1xuXHR2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAwIF0sIGNvb3Jkc1sgMSBdICk7XG5cdHZlY3RvckZvcm1GYWN0b3IgKz0gTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb29yZHNbIDEgXSwgY29vcmRzWyAyIF0gKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMiBdLCBjb29yZHNbIDMgXSApO1xuXHR2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAzIF0sIGNvb3Jkc1sgMCBdICk7XG5cdGZsb2F0IHJlc3VsdCA9IExUQ19DbGlwcGVkU3BoZXJlRm9ybUZhY3RvciggdmVjdG9yRm9ybUZhY3RvciApO1xuXHRyZXR1cm4gdmVjMyggcmVzdWx0ICk7XG59XG4jaWYgZGVmaW5lZCggVVNFX1NIRUVOIClcbmZsb2F0IERfQ2hhcmxpZSggZmxvYXQgcm91Z2huZXNzLCBmbG9hdCBkb3ROSCApIHtcblx0ZmxvYXQgYWxwaGEgPSBwb3cyKCByb3VnaG5lc3MgKTtcblx0ZmxvYXQgaW52QWxwaGEgPSAxLjAgLyBhbHBoYTtcblx0ZmxvYXQgY29zMmggPSBkb3ROSCAqIGRvdE5IO1xuXHRmbG9hdCBzaW4yaCA9IG1heCggMS4wIC0gY29zMmgsIDAuMDA3ODEyNSApO1xuXHRyZXR1cm4gKCAyLjAgKyBpbnZBbHBoYSApICogcG93KCBzaW4yaCwgaW52QWxwaGEgKiAwLjUgKSAvICggMi4wICogUEkgKTtcbn1cbmZsb2F0IFZfTmV1YmVsdCggZmxvYXQgZG90TlYsIGZsb2F0IGRvdE5MICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIDEuMCAvICggNC4wICogKCBkb3ROTCArIGRvdE5WIC0gZG90TkwgKiBkb3ROViApICkgKTtcbn1cbnZlYzMgQlJERl9TaGVlbiggY29uc3QgaW4gdmVjMyBsaWdodERpciwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgdmVjMyBzaGVlbkNvbG9yLCBjb25zdCBpbiBmbG9hdCBzaGVlblJvdWdobmVzcyApIHtcblx0dmVjMyBoYWxmRGlyID0gbm9ybWFsaXplKCBsaWdodERpciArIHZpZXdEaXIgKTtcblx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGxpZ2h0RGlyICkgKTtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IEQgPSBEX0NoYXJsaWUoIHNoZWVuUm91Z2huZXNzLCBkb3ROSCApO1xuXHRmbG9hdCBWID0gVl9OZXViZWx0KCBkb3ROViwgZG90TkwgKTtcblx0cmV0dXJuIHNoZWVuQ29sb3IgKiAoIEQgKiBWICk7XG59XG4jZW5kaWZcbmZsb2F0IElCTFNoZWVuQlJERiggY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgdmlld0RpciApICk7XG5cdGZsb2F0IHIyID0gcm91Z2huZXNzICogcm91Z2huZXNzO1xuXHRmbG9hdCBhID0gcm91Z2huZXNzIDwgMC4yNSA/IC0zMzkuMiAqIHIyICsgMTYxLjQgKiByb3VnaG5lc3MgLSAyNS45IDogLTguNDggKiByMiArIDE0LjMgKiByb3VnaG5lc3MgLSA5Ljk1O1xuXHRmbG9hdCBiID0gcm91Z2huZXNzIDwgMC4yNSA/IDQ0LjAgKiByMiAtIDIzLjcgKiByb3VnaG5lc3MgKyAzLjI2IDogMS45NyAqIHIyIC0gMy4yNyAqIHJvdWdobmVzcyArIDAuNzI7XG5cdGZsb2F0IERHID0gZXhwKCBhICogZG90TlYgKyBiICkgKyAoIHJvdWdobmVzcyA8IDAuMjUgPyAwLjAgOiAwLjEgKiAoIHJvdWdobmVzcyAtIDAuMjUgKSApO1xuXHRyZXR1cm4gc2F0dXJhdGUoIERHICogUkVDSVBST0NBTF9QSSApO1xufVxudmVjMiBERkdBcHByb3goIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRjb25zdCB2ZWM0IGMwID0gdmVjNCggLSAxLCAtIDAuMDI3NSwgLSAwLjU3MiwgMC4wMjIgKTtcblx0Y29uc3QgdmVjNCBjMSA9IHZlYzQoIDEsIDAuMDQyNSwgMS4wNCwgLSAwLjA0ICk7XG5cdHZlYzQgciA9IHJvdWdobmVzcyAqIGMwICsgYzE7XG5cdGZsb2F0IGEwMDQgPSBtaW4oIHIueCAqIHIueCwgZXhwMiggLSA5LjI4ICogZG90TlYgKSApICogci54ICsgci55O1xuXHR2ZWMyIGZhYiA9IHZlYzIoIC0gMS4wNCwgMS4wNCApICogYTAwNCArIHIuenc7XG5cdHJldHVybiBmYWI7XG59XG52ZWMzIEVudmlyb25tZW50QlJERiggY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCBzcGVjdWxhckY5MCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHR2ZWMyIGZhYiA9IERGR0FwcHJveCggbm9ybWFsLCB2aWV3RGlyLCByb3VnaG5lc3MgKTtcblx0cmV0dXJuIHNwZWN1bGFyQ29sb3IgKiBmYWIueCArIHNwZWN1bGFyRjkwICogZmFiLnk7XG59XG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFXG52b2lkIGNvbXB1dGVNdWx0aXNjYXR0ZXJpbmdJcmlkZXNjZW5jZSggY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCBzcGVjdWxhckY5MCwgY29uc3QgaW4gZmxvYXQgaXJpZGVzY2VuY2UsIGNvbnN0IGluIHZlYzMgaXJpZGVzY2VuY2VGMCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBpbm91dCB2ZWMzIHNpbmdsZVNjYXR0ZXIsIGlub3V0IHZlYzMgbXVsdGlTY2F0dGVyICkge1xuI2Vsc2VcbnZvaWQgY29tcHV0ZU11bHRpc2NhdHRlcmluZyggY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCBzcGVjdWxhckY5MCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBpbm91dCB2ZWMzIHNpbmdsZVNjYXR0ZXIsIGlub3V0IHZlYzMgbXVsdGlTY2F0dGVyICkge1xuI2VuZGlmXG5cdHZlYzIgZmFiID0gREZHQXBwcm94KCBub3JtYWwsIHZpZXdEaXIsIHJvdWdobmVzcyApO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0dmVjMyBGciA9IG1peCggc3BlY3VsYXJDb2xvciwgaXJpZGVzY2VuY2VGMCwgaXJpZGVzY2VuY2UgKTtcblx0I2Vsc2Vcblx0XHR2ZWMzIEZyID0gc3BlY3VsYXJDb2xvcjtcblx0I2VuZGlmXG5cdHZlYzMgRnNzRXNzID0gRnIgKiBmYWIueCArIHNwZWN1bGFyRjkwICogZmFiLnk7XG5cdGZsb2F0IEVzcyA9IGZhYi54ICsgZmFiLnk7XG5cdGZsb2F0IEVtcyA9IDEuMCAtIEVzcztcblx0dmVjMyBGYXZnID0gRnIgKyAoIDEuMCAtIEZyICkgKiAwLjA0NzYxOTtcdHZlYzMgRm1zID0gRnNzRXNzICogRmF2ZyAvICggMS4wIC0gRW1zICogRmF2ZyApO1xuXHRzaW5nbGVTY2F0dGVyICs9IEZzc0Vzcztcblx0bXVsdGlTY2F0dGVyICs9IEZtcyAqIEVtcztcbn1cbiNpZiBOVU1fUkVDVF9BUkVBX0xJR0hUUyA+IDBcblx0dm9pZCBSRV9EaXJlY3RfUmVjdEFyZWFfUGh5c2ljYWwoIGNvbnN0IGluIFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdFx0dmVjMyBub3JtYWwgPSBnZW9tZXRyeU5vcm1hbDtcblx0XHR2ZWMzIHZpZXdEaXIgPSBnZW9tZXRyeVZpZXdEaXI7XG5cdFx0dmVjMyBwb3NpdGlvbiA9IGdlb21ldHJ5UG9zaXRpb247XG5cdFx0dmVjMyBsaWdodFBvcyA9IHJlY3RBcmVhTGlnaHQucG9zaXRpb247XG5cdFx0dmVjMyBoYWxmV2lkdGggPSByZWN0QXJlYUxpZ2h0LmhhbGZXaWR0aDtcblx0XHR2ZWMzIGhhbGZIZWlnaHQgPSByZWN0QXJlYUxpZ2h0LmhhbGZIZWlnaHQ7XG5cdFx0dmVjMyBsaWdodENvbG9yID0gcmVjdEFyZWFMaWdodC5jb2xvcjtcblx0XHRmbG9hdCByb3VnaG5lc3MgPSBtYXRlcmlhbC5yb3VnaG5lc3M7XG5cdFx0dmVjMyByZWN0Q29vcmRzWyA0IF07XG5cdFx0cmVjdENvb3Jkc1sgMCBdID0gbGlnaHRQb3MgKyBoYWxmV2lkdGggLSBoYWxmSGVpZ2h0O1x0XHRyZWN0Q29vcmRzWyAxIF0gPSBsaWdodFBvcyAtIGhhbGZXaWR0aCAtIGhhbGZIZWlnaHQ7XG5cdFx0cmVjdENvb3Jkc1sgMiBdID0gbGlnaHRQb3MgLSBoYWxmV2lkdGggKyBoYWxmSGVpZ2h0O1xuXHRcdHJlY3RDb29yZHNbIDMgXSA9IGxpZ2h0UG9zICsgaGFsZldpZHRoICsgaGFsZkhlaWdodDtcblx0XHR2ZWMyIHV2ID0gTFRDX1V2KCBub3JtYWwsIHZpZXdEaXIsIHJvdWdobmVzcyApO1xuXHRcdHZlYzQgdDEgPSB0ZXh0dXJlMkQoIGx0Y18xLCB1diApO1xuXHRcdHZlYzQgdDIgPSB0ZXh0dXJlMkQoIGx0Y18yLCB1diApO1xuXHRcdG1hdDMgbUludiA9IG1hdDMoXG5cdFx0XHR2ZWMzKCB0MS54LCAwLCB0MS55ICksXG5cdFx0XHR2ZWMzKCAgICAwLCAxLCAgICAwICksXG5cdFx0XHR2ZWMzKCB0MS56LCAwLCB0MS53IClcblx0XHQpO1xuXHRcdHZlYzMgZnJlc25lbCA9ICggbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciAqIHQyLnggKyAoIHZlYzMoIDEuMCApIC0gbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciApICogdDIueSApO1xuXHRcdHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICs9IGxpZ2h0Q29sb3IgKiBmcmVzbmVsICogTFRDX0V2YWx1YXRlKCBub3JtYWwsIHZpZXdEaXIsIHBvc2l0aW9uLCBtSW52LCByZWN0Q29vcmRzICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBsaWdodENvbG9yICogbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICogTFRDX0V2YWx1YXRlKCBub3JtYWwsIHZpZXdEaXIsIHBvc2l0aW9uLCBtYXQzKCAxLjAgKSwgcmVjdENvb3JkcyApO1xuXHR9XG4jZW5kaWZcbnZvaWQgUkVfRGlyZWN0X1BoeXNpY2FsKCBjb25zdCBpbiBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeU5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gZG90TkwgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0I2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0XHRmbG9hdCBkb3ROTGNjID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdFx0dmVjMyBjY0lycmFkaWFuY2UgPSBkb3ROTGNjICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdFx0Y2xlYXJjb2F0U3BlY3VsYXJEaXJlY3QgKz0gY2NJcnJhZGlhbmNlICogQlJERl9HR1hfQ2xlYXJjb2F0KCBkaXJlY3RMaWdodC5kaXJlY3Rpb24sIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0c2hlZW5TcGVjdWxhckRpcmVjdCArPSBpcnJhZGlhbmNlICogQlJERl9TaGVlbiggZGlyZWN0TGlnaHQuZGlyZWN0aW9uLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Tm9ybWFsLCBtYXRlcmlhbC5zaGVlbkNvbG9yLCBtYXRlcmlhbC5zaGVlblJvdWdobmVzcyApO1xuXHQjZW5kaWZcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKz0gaXJyYWRpYW5jZSAqIEJSREZfR0dYKCBkaXJlY3RMaWdodC5kaXJlY3Rpb24sIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsICk7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG52b2lkIFJFX0luZGlyZWN0RGlmZnVzZV9QaHlzaWNhbCggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdFNwZWN1bGFyX1BoeXNpY2FsKCBjb25zdCBpbiB2ZWMzIHJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgY2xlYXJjb2F0UmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0KSB7XG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0Y2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCArPSBjbGVhcmNvYXRSYWRpYW5jZSAqIEVudmlyb25tZW50QlJERiggZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgbWF0ZXJpYWwuY2xlYXJjb2F0RjAsIG1hdGVyaWFsLmNsZWFyY29hdEY5MCwgbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0c2hlZW5TcGVjdWxhckluZGlyZWN0ICs9IGlycmFkaWFuY2UgKiBtYXRlcmlhbC5zaGVlbkNvbG9yICogSUJMU2hlZW5CUkRGKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zaGVlblJvdWdobmVzcyApO1xuXHQjZW5kaWZcblx0dmVjMyBzaW5nbGVTY2F0dGVyaW5nID0gdmVjMyggMC4wICk7XG5cdHZlYzMgbXVsdGlTY2F0dGVyaW5nID0gdmVjMyggMC4wICk7XG5cdHZlYzMgY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlID0gaXJyYWRpYW5jZSAqIFJFQ0lQUk9DQUxfUEk7XG5cdCNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0XHRjb21wdXRlTXVsdGlzY2F0dGVyaW5nSXJpZGVzY2VuY2UoIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyRjkwLCBtYXRlcmlhbC5pcmlkZXNjZW5jZSwgbWF0ZXJpYWwuaXJpZGVzY2VuY2VGcmVzbmVsLCBtYXRlcmlhbC5yb3VnaG5lc3MsIHNpbmdsZVNjYXR0ZXJpbmcsIG11bHRpU2NhdHRlcmluZyApO1xuXHQjZWxzZVxuXHRcdGNvbXB1dGVNdWx0aXNjYXR0ZXJpbmcoIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyRjkwLCBtYXRlcmlhbC5yb3VnaG5lc3MsIHNpbmdsZVNjYXR0ZXJpbmcsIG11bHRpU2NhdHRlcmluZyApO1xuXHQjZW5kaWZcblx0dmVjMyB0b3RhbFNjYXR0ZXJpbmcgPSBzaW5nbGVTY2F0dGVyaW5nICsgbXVsdGlTY2F0dGVyaW5nO1xuXHR2ZWMzIGRpZmZ1c2UgPSBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKiAoIDEuMCAtIG1heCggbWF4KCB0b3RhbFNjYXR0ZXJpbmcuciwgdG90YWxTY2F0dGVyaW5nLmcgKSwgdG90YWxTY2F0dGVyaW5nLmIgKSApO1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyICs9IHJhZGlhbmNlICogc2luZ2xlU2NhdHRlcmluZztcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArPSBtdWx0aVNjYXR0ZXJpbmcgKiBjb3NpbmVXZWlnaHRlZElycmFkaWFuY2U7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBkaWZmdXNlICogY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlO1xufVxuI2RlZmluZSBSRV9EaXJlY3RcdFx0XHRcdFJFX0RpcmVjdF9QaHlzaWNhbFxuI2RlZmluZSBSRV9EaXJlY3RfUmVjdEFyZWFcdFx0UkVfRGlyZWN0X1JlY3RBcmVhX1BoeXNpY2FsXG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZVx0XHRSRV9JbmRpcmVjdERpZmZ1c2VfUGh5c2ljYWxcbiNkZWZpbmUgUkVfSW5kaXJlY3RTcGVjdWxhclx0XHRSRV9JbmRpcmVjdFNwZWN1bGFyX1BoeXNpY2FsXG5mbG9hdCBjb21wdXRlU3BlY3VsYXJPY2NsdXNpb24oIGNvbnN0IGluIGZsb2F0IGRvdE5WLCBjb25zdCBpbiBmbG9hdCBhbWJpZW50T2NjbHVzaW9uLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdHJldHVybiBzYXR1cmF0ZSggcG93KCBkb3ROViArIGFtYmllbnRPY2NsdXNpb24sIGV4cDIoIC0gMTYuMCAqIHJvdWdobmVzcyAtIDEuMCApICkgLSAxLjAgKyBhbWJpZW50T2NjbHVzaW9uICk7XG59IjsKCnZhciBsaWdodHNfZnJhZ21lbnRfYmVnaW4gPSAiXG52ZWMzIGdlb21ldHJ5UG9zaXRpb24gPSAtIHZWaWV3UG9zaXRpb247XG52ZWMzIGdlb21ldHJ5Tm9ybWFsID0gbm9ybWFsO1xudmVjMyBnZW9tZXRyeVZpZXdEaXIgPSAoIGlzT3J0aG9ncmFwaGljICkgPyB2ZWMzKCAwLCAwLCAxICkgOiBub3JtYWxpemUoIHZWaWV3UG9zaXRpb24gKTtcbnZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwgPSB2ZWMzKCAwLjAgKTtcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsID0gY2xlYXJjb2F0Tm9ybWFsO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdGZsb2F0IGRvdE5WaSA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyICkgKTtcblx0aWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzcyA9PSAwLjAgKSB7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2UgPSAwLjA7XG5cdH0gZWxzZSB7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2UgPSBzYXR1cmF0ZSggbWF0ZXJpYWwuaXJpZGVzY2VuY2UgKTtcblx0fVxuXHRpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlID4gMC4wICkge1xuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCA9IGV2YWxJcmlkZXNjZW5jZSggMS4wLCBtYXRlcmlhbC5pcmlkZXNjZW5jZUlPUiwgZG90TlZpLCBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzcywgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciApO1xuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlRjAgPSBTY2hsaWNrX3RvX0YwKCBtYXRlcmlhbC5pcmlkZXNjZW5jZUZyZXNuZWwsIDEuMCwgZG90TlZpICk7XG5cdH1cbiNlbmRpZlxuSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodDtcbiNpZiAoIE5VTV9QT0lOVF9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0IClcblx0UG9pbnRMaWdodCBwb2ludExpZ2h0O1xuXHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHRTaGFkb3c7XG5cdCNlbmRpZlxuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVFM7IGkgKysgKSB7XG5cdFx0cG9pbnRMaWdodCA9IHBvaW50TGlnaHRzWyBpIF07XG5cdFx0Z2V0UG9pbnRMaWdodEluZm8oIHBvaW50TGlnaHQsIGdlb21ldHJ5UG9zaXRpb24sIGRpcmVjdExpZ2h0ICk7XG5cdFx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyApXG5cdFx0cG9pbnRMaWdodFNoYWRvdyA9IHBvaW50TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0ZGlyZWN0TGlnaHQuY29sb3IgKj0gKCBkaXJlY3RMaWdodC52aXNpYmxlICYmIHJlY2VpdmVTaGFkb3cgKSA/IGdldFBvaW50U2hhZG93KCBwb2ludFNoYWRvd01hcFsgaSBdLCBwb2ludExpZ2h0U2hhZG93LnNoYWRvd01hcFNpemUsIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93QmlhcywgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZQb2ludFNoYWRvd0Nvb3JkWyBpIF0sIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93Q2FtZXJhTmVhciwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dDYW1lcmFGYXIgKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmICggTlVNX1NQT1RfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdFNwb3RMaWdodCBzcG90TGlnaHQ7XG5cdHZlYzQgc3BvdENvbG9yO1xuXHR2ZWMzIHNwb3RMaWdodENvb3JkO1xuXHRib29sIGluU3BvdExpZ2h0TWFwO1xuXHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFNwb3RMaWdodFNoYWRvdyBzcG90TGlnaHRTaGFkb3c7XG5cdCNlbmRpZlxuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUUzsgaSArKyApIHtcblx0XHRzcG90TGlnaHQgPSBzcG90TGlnaHRzWyBpIF07XG5cdFx0Z2V0U3BvdExpZ2h0SW5mbyggc3BvdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBkaXJlY3RMaWdodCApO1xuXHRcdCNpZiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTX1dJVEhfTUFQUyApXG5cdFx0I2RlZmluZSBTUE9UX0xJR0hUX01BUF9JTkRFWCBVTlJPTExFRF9MT09QX0lOREVYXG5cdFx0I2VsaWYgKCBVTlJPTExFRF9MT09QX0lOREVYIDwgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyApXG5cdFx0I2RlZmluZSBTUE9UX0xJR0hUX01BUF9JTkRFWCBOVU1fU1BPVF9MSUdIVF9NQVBTXG5cdFx0I2Vsc2Vcblx0XHQjZGVmaW5lIFNQT1RfTElHSFRfTUFQX0lOREVYICggVU5ST0xMRURfTE9PUF9JTkRFWCAtIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgKyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTX1dJVEhfTUFQUyApXG5cdFx0I2VuZGlmXG5cdFx0I2lmICggU1BPVF9MSUdIVF9NQVBfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9NQVBTIClcblx0XHRcdHNwb3RMaWdodENvb3JkID0gdlNwb3RMaWdodENvb3JkWyBpIF0ueHl6IC8gdlNwb3RMaWdodENvb3JkWyBpIF0udztcblx0XHRcdGluU3BvdExpZ2h0TWFwID0gYWxsKCBsZXNzVGhhbiggYWJzKCBzcG90TGlnaHRDb29yZCAqIDIuIC0gMS4gKSwgdmVjMyggMS4wICkgKSApO1xuXHRcdFx0c3BvdENvbG9yID0gdGV4dHVyZTJEKCBzcG90TGlnaHRNYXBbIFNQT1RfTElHSFRfTUFQX0lOREVYIF0sIHNwb3RMaWdodENvb3JkLnh5ICk7XG5cdFx0XHRkaXJlY3RMaWdodC5jb2xvciA9IGluU3BvdExpZ2h0TWFwID8gZGlyZWN0TGlnaHQuY29sb3IgKiBzcG90Q29sb3IucmdiIDogZGlyZWN0TGlnaHQuY29sb3I7XG5cdFx0I2VuZGlmXG5cdFx0I3VuZGVmIFNQT1RfTElHSFRfTUFQX0lOREVYXG5cdFx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcblx0XHRzcG90TGlnaHRTaGFkb3cgPSBzcG90TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0ZGlyZWN0TGlnaHQuY29sb3IgKj0gKCBkaXJlY3RMaWdodC52aXNpYmxlICYmIHJlY2VpdmVTaGFkb3cgKSA/IGdldFNoYWRvdyggc3BvdFNoYWRvd01hcFsgaSBdLCBzcG90TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgc3BvdExpZ2h0U2hhZG93LnNoYWRvd0JpYXMsIHNwb3RMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZTcG90TGlnaHRDb29yZFsgaSBdICkgOiAxLjA7XG5cdFx0I2VuZGlmXG5cdFx0UkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiAoIE5VTV9ESVJfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdERpcmVjdGlvbmFsTGlnaHQgZGlyZWN0aW9uYWxMaWdodDtcblx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG5cdERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZGlyZWN0aW9uYWxMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVFM7IGkgKysgKSB7XG5cdFx0ZGlyZWN0aW9uYWxMaWdodCA9IGRpcmVjdGlvbmFsTGlnaHRzWyBpIF07XG5cdFx0Z2V0RGlyZWN0aW9uYWxMaWdodEluZm8oIGRpcmVjdGlvbmFsTGlnaHQsIGRpcmVjdExpZ2h0ICk7XG5cdFx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fRElSX0xJR0hUX1NIQURPV1MgKVxuXHRcdGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cgPSBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdGRpcmVjdExpZ2h0LmNvbG9yICo9ICggZGlyZWN0TGlnaHQudmlzaWJsZSAmJiByZWNlaXZlU2hhZG93ICkgPyBnZXRTaGFkb3coIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBpIF0sIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dCaWFzLCBkaXJlY3Rpb25hbExpZ2h0U2hhZG93LnNoYWRvd1JhZGl1cywgdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIGkgXSApIDogMS4wO1xuXHRcdCNlbmRpZlxuXHRcdFJFX0RpcmVjdCggZGlyZWN0TGlnaHQsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuI2VuZGlmXG4jaWYgKCBOVU1fUkVDVF9BUkVBX0xJR0hUUyA+IDAgKSAmJiBkZWZpbmVkKCBSRV9EaXJlY3RfUmVjdEFyZWEgKVxuXHRSZWN0QXJlYUxpZ2h0IHJlY3RBcmVhTGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1JFQ1RfQVJFQV9MSUdIVFM7IGkgKysgKSB7XG5cdFx0cmVjdEFyZWFMaWdodCA9IHJlY3RBcmVhTGlnaHRzWyBpIF07XG5cdFx0UkVfRGlyZWN0X1JlY3RBcmVhKCByZWN0QXJlYUxpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG5cdHZlYzMgaWJsSXJyYWRpYW5jZSA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBnZXRBbWJpZW50TGlnaHRJcnJhZGlhbmNlKCBhbWJpZW50TGlnaHRDb2xvciApO1xuXHQjaWYgZGVmaW5lZCggVVNFX0xJR0hUX1BST0JFUyApXG5cdFx0aXJyYWRpYW5jZSArPSBnZXRMaWdodFByb2JlSXJyYWRpYW5jZSggbGlnaHRQcm9iZSwgZ2VvbWV0cnlOb3JtYWwgKTtcblx0I2VuZGlmXG5cdCNpZiAoIE5VTV9IRU1JX0xJR0hUUyA+IDAgKVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fSEVNSV9MSUdIVFM7IGkgKysgKSB7XG5cdFx0XHRpcnJhZGlhbmNlICs9IGdldEhlbWlzcGhlcmVMaWdodElycmFkaWFuY2UoIGhlbWlzcGhlcmVMaWdodHNbIGkgXSwgZ2VvbWV0cnlOb3JtYWwgKTtcblx0XHR9XG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdFNwZWN1bGFyIClcblx0dmVjMyByYWRpYW5jZSA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIGNsZWFyY29hdFJhZGlhbmNlID0gdmVjMyggMC4wICk7XG4jZW5kaWYiOwoKdmFyIGxpZ2h0c19mcmFnbWVudF9tYXBzID0gIiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdERpZmZ1c2UgKVxuXHQjaWZkZWYgVVNFX0xJR0hUTUFQXG5cdFx0dmVjNCBsaWdodE1hcFRleGVsID0gdGV4dHVyZTJEKCBsaWdodE1hcCwgdkxpZ2h0TWFwVXYgKTtcblx0XHR2ZWMzIGxpZ2h0TWFwSXJyYWRpYW5jZSA9IGxpZ2h0TWFwVGV4ZWwucmdiICogbGlnaHRNYXBJbnRlbnNpdHk7XG5cdFx0aXJyYWRpYW5jZSArPSBsaWdodE1hcElycmFkaWFuY2U7XG5cdCNlbmRpZlxuXHQjaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApICYmIGRlZmluZWQoIFNUQU5EQVJEICkgJiYgZGVmaW5lZCggRU5WTUFQX1RZUEVfQ1VCRV9VViApXG5cdFx0aWJsSXJyYWRpYW5jZSArPSBnZXRJQkxJcnJhZGlhbmNlKCBnZW9tZXRyeU5vcm1hbCApO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSAmJiBkZWZpbmVkKCBSRV9JbmRpcmVjdFNwZWN1bGFyIClcblx0I2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdFx0cmFkaWFuY2UgKz0gZ2V0SUJMQW5pc290cm9weVJhZGlhbmNlKCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Tm9ybWFsLCBtYXRlcmlhbC5yb3VnaG5lc3MsIG1hdGVyaWFsLmFuaXNvdHJvcHlCLCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICk7XG5cdCNlbHNlXG5cdFx0cmFkaWFuY2UgKz0gZ2V0SUJMUmFkaWFuY2UoIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnJvdWdobmVzcyApO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0XHRjbGVhcmNvYXRSYWRpYW5jZSArPSBnZXRJQkxSYWRpYW5jZSggZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICk7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBsaWdodHNfZnJhZ21lbnRfZW5kID0gIiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdERpZmZ1c2UgKVxuXHRSRV9JbmRpcmVjdERpZmZ1c2UoIGlycmFkaWFuY2UsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHRSRV9JbmRpcmVjdFNwZWN1bGFyKCByYWRpYW5jZSwgaWJsSXJyYWRpYW5jZSwgY2xlYXJjb2F0UmFkaWFuY2UsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcbiNlbmRpZiI7Cgp2YXIgbG9nZGVwdGhidWZfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9MT0dERVBUSEJVRiApICYmIGRlZmluZWQoIFVTRV9MT0dERVBUSEJVRl9FWFQgKVxuXHRnbF9GcmFnRGVwdGhFWFQgPSB2SXNQZXJzcGVjdGl2ZSA9PSAwLjAgPyBnbF9GcmFnQ29vcmQueiA6IGxvZzIoIHZGcmFnRGVwdGggKSAqIGxvZ0RlcHRoQnVmRkMgKiAwLjU7XG4jZW5kaWYiOwoKdmFyIGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9MT0dERVBUSEJVRiApICYmIGRlZmluZWQoIFVTRV9MT0dERVBUSEJVRl9FWFQgKVxuXHR1bmlmb3JtIGZsb2F0IGxvZ0RlcHRoQnVmRkM7XG5cdHZhcnlpbmcgZmxvYXQgdkZyYWdEZXB0aDtcblx0dmFyeWluZyBmbG9hdCB2SXNQZXJzcGVjdGl2ZTtcbiNlbmRpZiI7Cgp2YXIgbG9nZGVwdGhidWZfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9MT0dERVBUSEJVRlxuXHQjaWZkZWYgVVNFX0xPR0RFUFRIQlVGX0VYVFxuXHRcdHZhcnlpbmcgZmxvYXQgdkZyYWdEZXB0aDtcblx0XHR2YXJ5aW5nIGZsb2F0IHZJc1BlcnNwZWN0aXZlO1xuXHQjZWxzZVxuXHRcdHVuaWZvcm0gZmxvYXQgbG9nRGVwdGhCdWZGQztcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGxvZ2RlcHRoYnVmX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0xPR0RFUFRIQlVGXG5cdCNpZmRlZiBVU0VfTE9HREVQVEhCVUZfRVhUXG5cdFx0dkZyYWdEZXB0aCA9IDEuMCArIGdsX1Bvc2l0aW9uLnc7XG5cdFx0dklzUGVyc3BlY3RpdmUgPSBmbG9hdCggaXNQZXJzcGVjdGl2ZU1hdHJpeCggcHJvamVjdGlvbk1hdHJpeCApICk7XG5cdCNlbHNlXG5cdFx0aWYgKCBpc1BlcnNwZWN0aXZlTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICkgKSB7XG5cdFx0XHRnbF9Qb3NpdGlvbi56ID0gbG9nMiggbWF4KCBFUFNJTE9OLCBnbF9Qb3NpdGlvbi53ICsgMS4wICkgKSAqIGxvZ0RlcHRoQnVmRkMgLSAxLjA7XG5cdFx0XHRnbF9Qb3NpdGlvbi56ICo9IGdsX1Bvc2l0aW9uLnc7XG5cdFx0fVxuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUFQXG5cdHZlYzQgc2FtcGxlZERpZmZ1c2VDb2xvciA9IHRleHR1cmUyRCggbWFwLCB2TWFwVXYgKTtcblx0I2lmZGVmIERFQ09ERV9WSURFT19URVhUVVJFXG5cdFx0c2FtcGxlZERpZmZ1c2VDb2xvciA9IHZlYzQoIG1peCggcG93KCBzYW1wbGVkRGlmZnVzZUNvbG9yLnJnYiAqIDAuOTQ3ODY3Mjk4NiArIHZlYzMoIDAuMDUyMTMyNzAxNCApLCB2ZWMzKCAyLjQgKSApLCBzYW1wbGVkRGlmZnVzZUNvbG9yLnJnYiAqIDAuMDc3Mzk5MzgwOCwgdmVjMyggbGVzc1RoYW5FcXVhbCggc2FtcGxlZERpZmZ1c2VDb2xvci5yZ2IsIHZlYzMoIDAuMDQwNDUgKSApICkgKSwgc2FtcGxlZERpZmZ1c2VDb2xvci53ICk7XG5cdFxuXHQjZW5kaWZcblx0ZGlmZnVzZUNvbG9yICo9IHNhbXBsZWREaWZmdXNlQ29sb3I7XG4jZW5kaWYiOwoKdmFyIG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG1hcDtcbiNlbmRpZiI7Cgp2YXIgbWFwX3BhcnRpY2xlX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTUFQICkgfHwgZGVmaW5lZCggVVNFX0FMUEhBTUFQIClcblx0I2lmIGRlZmluZWQoIFVTRV9QT0lOVFNfVVYgKVxuXHRcdHZlYzIgdXYgPSB2VXY7XG5cdCNlbHNlXG5cdFx0dmVjMiB1diA9ICggdXZUcmFuc2Zvcm0gKiB2ZWMzKCBnbF9Qb2ludENvb3JkLngsIDEuMCAtIGdsX1BvaW50Q29vcmQueSwgMSApICkueHk7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHRkaWZmdXNlQ29sb3IgKj0gdGV4dHVyZTJEKCBtYXAsIHV2ICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0ZGlmZnVzZUNvbG9yLmEgKj0gdGV4dHVyZTJEKCBhbHBoYU1hcCwgdXYgKS5nO1xuI2VuZGlmIjsKCnZhciBtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX1BPSU5UU19VViApXG5cdHZhcnlpbmcgdmVjMiB2VXY7XG4jZWxzZVxuXHQjaWYgZGVmaW5lZCggVVNFX01BUCApIHx8IGRlZmluZWQoIFVTRV9BTFBIQU1BUCApXG5cdFx0dW5pZm9ybSBtYXQzIHV2VHJhbnNmb3JtO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbWFwO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGFscGhhTWFwO1xuI2VuZGlmIjsKCnZhciBtZXRhbG5lc3NtYXBfZnJhZ21lbnQgPSAiZmxvYXQgbWV0YWxuZXNzRmFjdG9yID0gbWV0YWxuZXNzO1xuI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dmVjNCB0ZXhlbE1ldGFsbmVzcyA9IHRleHR1cmUyRCggbWV0YWxuZXNzTWFwLCB2TWV0YWxuZXNzTWFwVXYgKTtcblx0bWV0YWxuZXNzRmFjdG9yICo9IHRleGVsTWV0YWxuZXNzLmI7XG4jZW5kaWYiOwoKdmFyIG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG1ldGFsbmVzc01hcDtcbiNlbmRpZiI7Cgp2YXIgbW9ycGhjb2xvcl92ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9NT1JQSENPTE9SUyApICYmIGRlZmluZWQoIE1PUlBIVEFSR0VUU19URVhUVVJFIClcblx0dkNvbG9yICo9IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTU9SUEhUQVJHRVRTX0NPVU5UOyBpICsrICkge1xuXHRcdCNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHRcdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSB2Q29sb3IgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAyICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXTtcblx0XHQjZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKVxuXHRcdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSB2Q29sb3IgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAyICkucmdiICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdFx0I2VuZGlmXG5cdH1cbiNlbmRpZiI7Cgp2YXIgbW9ycGhub3JtYWxfdmVydGV4ID0gIiNpZmRlZiBVU0VfTU9SUEhOT1JNQUxTXG5cdG9iamVjdE5vcm1hbCAqPSBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2U7XG5cdCNpZmRlZiBNT1JQSFRBUkdFVFNfVEVYVFVSRVxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IE1PUlBIVEFSR0VUU19DT1VOVDsgaSArKyApIHtcblx0XHRcdGlmICggbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF0gIT0gMC4wICkgb2JqZWN0Tm9ybWFsICs9IGdldE1vcnBoKCBnbF9WZXJ0ZXhJRCwgaSwgMSApLnh5eiAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdO1xuXHRcdH1cblx0I2Vsc2Vcblx0XHRvYmplY3ROb3JtYWwgKz0gbW9ycGhOb3JtYWwwICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAwIF07XG5cdFx0b2JqZWN0Tm9ybWFsICs9IG1vcnBoTm9ybWFsMSAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgMSBdO1xuXHRcdG9iamVjdE5vcm1hbCArPSBtb3JwaE5vcm1hbDIgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDIgXTtcblx0XHRvYmplY3ROb3JtYWwgKz0gbW9ycGhOb3JtYWwzICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAzIF07XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBtb3JwaHRhcmdldF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBIVEFSR0VUU1xuXHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0I2lmZGVmIE1PUlBIVEFSR0VUU19URVhUVVJFXG5cdFx0dW5pZm9ybSBmbG9hdCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIE1PUlBIVEFSR0VUU19DT1VOVCBdO1xuXHRcdHVuaWZvcm0gc2FtcGxlcjJEQXJyYXkgbW9ycGhUYXJnZXRzVGV4dHVyZTtcblx0XHR1bmlmb3JtIGl2ZWMyIG1vcnBoVGFyZ2V0c1RleHR1cmVTaXplO1xuXHRcdHZlYzQgZ2V0TW9ycGgoIGNvbnN0IGluIGludCB2ZXJ0ZXhJbmRleCwgY29uc3QgaW4gaW50IG1vcnBoVGFyZ2V0SW5kZXgsIGNvbnN0IGluIGludCBvZmZzZXQgKSB7XG5cdFx0XHRpbnQgdGV4ZWxJbmRleCA9IHZlcnRleEluZGV4ICogTU9SUEhUQVJHRVRTX1RFWFRVUkVfU1RSSURFICsgb2Zmc2V0O1xuXHRcdFx0aW50IHkgPSB0ZXhlbEluZGV4IC8gbW9ycGhUYXJnZXRzVGV4dHVyZVNpemUueDtcblx0XHRcdGludCB4ID0gdGV4ZWxJbmRleCAtIHkgKiBtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZS54O1xuXHRcdFx0aXZlYzMgbW9ycGhVViA9IGl2ZWMzKCB4LCB5LCBtb3JwaFRhcmdldEluZGV4ICk7XG5cdFx0XHRyZXR1cm4gdGV4ZWxGZXRjaCggbW9ycGhUYXJnZXRzVGV4dHVyZSwgbW9ycGhVViwgMCApO1xuXHRcdH1cblx0I2Vsc2Vcblx0XHQjaWZuZGVmIFVTRV9NT1JQSE5PUk1BTFNcblx0XHRcdHVuaWZvcm0gZmxvYXQgbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyA4IF07XG5cdFx0I2Vsc2Vcblx0XHRcdHVuaWZvcm0gZmxvYXQgbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyA0IF07XG5cdFx0I2VuZGlmXG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBtb3JwaHRhcmdldF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9NT1JQSFRBUkdFVFNcblx0dHJhbnNmb3JtZWQgKj0gbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlO1xuXHQjaWZkZWYgTU9SUEhUQVJHRVRTX1RFWFRVUkVcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBNT1JQSFRBUkdFVFNfQ09VTlQ7IGkgKysgKSB7XG5cdFx0XHRpZiAoIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdICE9IDAuMCApIHRyYW5zZm9ybWVkICs9IGdldE1vcnBoKCBnbF9WZXJ0ZXhJRCwgaSwgMCApLnh5eiAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdO1xuXHRcdH1cblx0I2Vsc2Vcblx0XHR0cmFuc2Zvcm1lZCArPSBtb3JwaFRhcmdldDAgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDAgXTtcblx0XHR0cmFuc2Zvcm1lZCArPSBtb3JwaFRhcmdldDEgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDEgXTtcblx0XHR0cmFuc2Zvcm1lZCArPSBtb3JwaFRhcmdldDIgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDIgXTtcblx0XHR0cmFuc2Zvcm1lZCArPSBtb3JwaFRhcmdldDMgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDMgXTtcblx0XHQjaWZuZGVmIFVTRV9NT1JQSE5PUk1BTFNcblx0XHRcdHRyYW5zZm9ybWVkICs9IG1vcnBoVGFyZ2V0NCAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgNCBdO1xuXHRcdFx0dHJhbnNmb3JtZWQgKz0gbW9ycGhUYXJnZXQ1ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyA1IF07XG5cdFx0XHR0cmFuc2Zvcm1lZCArPSBtb3JwaFRhcmdldDYgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDYgXTtcblx0XHRcdHRyYW5zZm9ybWVkICs9IG1vcnBoVGFyZ2V0NyAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgNyBdO1xuXHRcdCNlbmRpZlxuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgbm9ybWFsX2ZyYWdtZW50X2JlZ2luID0gImZsb2F0IGZhY2VEaXJlY3Rpb24gPSBnbF9Gcm9udEZhY2luZyA/IDEuMCA6IC0gMS4wO1xuI2lmZGVmIEZMQVRfU0hBREVEXG5cdHZlYzMgZmR4ID0gZEZkeCggdlZpZXdQb3NpdGlvbiApO1xuXHR2ZWMzIGZkeSA9IGRGZHkoIHZWaWV3UG9zaXRpb24gKTtcblx0dmVjMyBub3JtYWwgPSBub3JtYWxpemUoIGNyb3NzKCBmZHgsIGZkeSApICk7XG4jZWxzZVxuXHR2ZWMzIG5vcm1hbCA9IG5vcm1hbGl6ZSggdk5vcm1hbCApO1xuXHQjaWZkZWYgRE9VQkxFX1NJREVEXG5cdFx0bm9ybWFsICo9IGZhY2VEaXJlY3Rpb247XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWYgZGVmaW5lZCggVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UgKSB8fCBkZWZpbmVkKCBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZIClcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0bWF0MyB0Ym4gPSBtYXQzKCBub3JtYWxpemUoIHZUYW5nZW50ICksIG5vcm1hbGl6ZSggdkJpdGFuZ2VudCApLCBub3JtYWwgKTtcblx0I2Vsc2Vcblx0XHRtYXQzIHRibiA9IGdldFRhbmdlbnRGcmFtZSggLSB2Vmlld1Bvc2l0aW9uLCBub3JtYWwsXG5cdFx0I2lmIGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKVxuXHRcdFx0dk5vcm1hbE1hcFV2XG5cdFx0I2VsaWYgZGVmaW5lZCggVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVAgKVxuXHRcdFx0dkNsZWFyY29hdE5vcm1hbE1hcFV2XG5cdFx0I2Vsc2Vcblx0XHRcdHZVdlxuXHRcdCNlbmRpZlxuXHRcdCk7XG5cdCNlbmRpZlxuXHQjaWYgZGVmaW5lZCggRE9VQkxFX1NJREVEICkgJiYgISBkZWZpbmVkKCBGTEFUX1NIQURFRCApXG5cdFx0dGJuWzBdICo9IGZhY2VEaXJlY3Rpb247XG5cdFx0dGJuWzFdICo9IGZhY2VEaXJlY3Rpb247XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0bWF0MyB0Ym4yID0gbWF0Myggbm9ybWFsaXplKCB2VGFuZ2VudCApLCBub3JtYWxpemUoIHZCaXRhbmdlbnQgKSwgbm9ybWFsICk7XG5cdCNlbHNlXG5cdFx0bWF0MyB0Ym4yID0gZ2V0VGFuZ2VudEZyYW1lKCAtIHZWaWV3UG9zaXRpb24sIG5vcm1hbCwgdkNsZWFyY29hdE5vcm1hbE1hcFV2ICk7XG5cdCNlbmRpZlxuXHQjaWYgZGVmaW5lZCggRE9VQkxFX1NJREVEICkgJiYgISBkZWZpbmVkKCBGTEFUX1NIQURFRCApXG5cdFx0dGJuMlswXSAqPSBmYWNlRGlyZWN0aW9uO1xuXHRcdHRibjJbMV0gKj0gZmFjZURpcmVjdGlvbjtcblx0I2VuZGlmXG4jZW5kaWZcbnZlYzMgbm9uUGVydHVyYmVkTm9ybWFsID0gbm9ybWFsOyI7Cgp2YXIgbm9ybWFsX2ZyYWdtZW50X21hcHMgPSAiI2lmZGVmIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0Vcblx0bm9ybWFsID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZOb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0I2lmZGVmIEZMSVBfU0lERURcblx0XHRub3JtYWwgPSAtIG5vcm1hbDtcblx0I2VuZGlmXG5cdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRub3JtYWwgPSBub3JtYWwgKiBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcblx0bm9ybWFsID0gbm9ybWFsaXplKCBub3JtYWxNYXRyaXggKiBub3JtYWwgKTtcbiNlbGlmIGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmVjMyBtYXBOID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZOb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0bWFwTi54eSAqPSBub3JtYWxTY2FsZTtcblx0bm9ybWFsID0gbm9ybWFsaXplKCB0Ym4gKiBtYXBOICk7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApXG5cdG5vcm1hbCA9IHBlcnR1cmJOb3JtYWxBcmIoIC0gdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCBkSGR4eV9md2QoKSwgZmFjZURpcmVjdGlvbiApO1xuI2VuZGlmIjsKCnZhciBub3JtYWxfcGFyc19mcmFnbWVudCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR2YXJ5aW5nIHZlYzMgdlRhbmdlbnQ7XG5cdFx0dmFyeWluZyB2ZWMzIHZCaXRhbmdlbnQ7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBub3JtYWxfcGFyc192ZXJ0ZXggPSAiI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dmFyeWluZyB2ZWMzIHZUYW5nZW50O1xuXHRcdHZhcnlpbmcgdmVjMyB2Qml0YW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgbm9ybWFsX3ZlcnRleCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZOb3JtYWwgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkTm9ybWFsICk7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHZUYW5nZW50ID0gbm9ybWFsaXplKCB0cmFuc2Zvcm1lZFRhbmdlbnQgKTtcblx0XHR2Qml0YW5nZW50ID0gbm9ybWFsaXplKCBjcm9zcyggdk5vcm1hbCwgdlRhbmdlbnQgKSAqIHRhbmdlbnQudyApO1xuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9OT1JNQUxNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbm9ybWFsTWFwO1xuXHR1bmlmb3JtIHZlYzIgbm9ybWFsU2NhbGU7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTk9STUFMTUFQX09CSkVDVFNQQUNFXG5cdHVuaWZvcm0gbWF0MyBub3JtYWxNYXRyaXg7XG4jZW5kaWZcbiNpZiAhIGRlZmluZWQgKCBVU0VfVEFOR0VOVCApICYmICggZGVmaW5lZCAoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFICkgfHwgZGVmaW5lZCAoIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKSApXG5cdG1hdDMgZ2V0VGFuZ2VudEZyYW1lKCB2ZWMzIGV5ZV9wb3MsIHZlYzMgc3VyZl9ub3JtLCB2ZWMyIHV2ICkge1xuXHRcdHZlYzMgcTAgPSBkRmR4KCBleWVfcG9zLnh5eiApO1xuXHRcdHZlYzMgcTEgPSBkRmR5KCBleWVfcG9zLnh5eiApO1xuXHRcdHZlYzIgc3QwID0gZEZkeCggdXYuc3QgKTtcblx0XHR2ZWMyIHN0MSA9IGRGZHkoIHV2LnN0ICk7XG5cdFx0dmVjMyBOID0gc3VyZl9ub3JtO1xuXHRcdHZlYzMgcTFwZXJwID0gY3Jvc3MoIHExLCBOICk7XG5cdFx0dmVjMyBxMHBlcnAgPSBjcm9zcyggTiwgcTAgKTtcblx0XHR2ZWMzIFQgPSBxMXBlcnAgKiBzdDAueCArIHEwcGVycCAqIHN0MS54O1xuXHRcdHZlYzMgQiA9IHExcGVycCAqIHN0MC55ICsgcTBwZXJwICogc3QxLnk7XG5cdFx0ZmxvYXQgZGV0ID0gbWF4KCBkb3QoIFQsIFQgKSwgZG90KCBCLCBCICkgKTtcblx0XHRmbG9hdCBzY2FsZSA9ICggZGV0ID09IDAuMCApID8gMC4wIDogaW52ZXJzZXNxcnQoIGRldCApO1xuXHRcdHJldHVybiBtYXQzKCBUICogc2NhbGUsIEIgKiBzY2FsZSwgTiApO1xuXHR9XG4jZW5kaWYiOwoKdmFyIGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfYmVnaW4gPSAiI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0dmVjMyBjbGVhcmNvYXROb3JtYWwgPSBub25QZXJ0dXJiZWROb3JtYWw7XG4jZW5kaWYiOwoKdmFyIGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcyA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dmVjMyBjbGVhcmNvYXRNYXBOID0gdGV4dHVyZTJEKCBjbGVhcmNvYXROb3JtYWxNYXAsIHZDbGVhcmNvYXROb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0Y2xlYXJjb2F0TWFwTi54eSAqPSBjbGVhcmNvYXROb3JtYWxTY2FsZTtcblx0Y2xlYXJjb2F0Tm9ybWFsID0gbm9ybWFsaXplKCB0Ym4yICogY2xlYXJjb2F0TWFwTiApO1xuI2VuZGlmIjsKCnZhciBjbGVhcmNvYXRfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBjbGVhcmNvYXRNYXA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBjbGVhcmNvYXROb3JtYWxNYXA7XG5cdHVuaWZvcm0gdmVjMiBjbGVhcmNvYXROb3JtYWxTY2FsZTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGNsZWFyY29hdFJvdWdobmVzc01hcDtcbiNlbmRpZiI7Cgp2YXIgaXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0lSSURFU0NFTkNFTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGlyaWRlc2NlbmNlTWFwO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcDtcbiNlbmRpZiI7Cgp2YXIgb3BhcXVlX2ZyYWdtZW50ID0gIiNpZmRlZiBPUEFRVUVcbmRpZmZ1c2VDb2xvci5hID0gMS4wO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuZGlmZnVzZUNvbG9yLmEgKj0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uQWxwaGE7XG4jZW5kaWZcbmdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7IjsKCnZhciBwYWNraW5nID0gInZlYzMgcGFja05vcm1hbFRvUkdCKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggbm9ybWFsICkgKiAwLjUgKyAwLjU7XG59XG52ZWMzIHVucGFja1JHQlRvTm9ybWFsKCBjb25zdCBpbiB2ZWMzIHJnYiApIHtcblx0cmV0dXJuIDIuMCAqIHJnYi54eXogLSAxLjA7XG59XG5jb25zdCBmbG9hdCBQYWNrVXBzY2FsZSA9IDI1Ni4gLyAyNTUuO2NvbnN0IGZsb2F0IFVucGFja0Rvd25zY2FsZSA9IDI1NS4gLyAyNTYuO1xuY29uc3QgdmVjMyBQYWNrRmFjdG9ycyA9IHZlYzMoIDI1Ni4gKiAyNTYuICogMjU2LiwgMjU2LiAqIDI1Ni4sIDI1Ni4gKTtcbmNvbnN0IHZlYzQgVW5wYWNrRmFjdG9ycyA9IFVucGFja0Rvd25zY2FsZSAvIHZlYzQoIFBhY2tGYWN0b3JzLCAxLiApO1xuY29uc3QgZmxvYXQgU2hpZnRSaWdodDggPSAxLiAvIDI1Ni47XG52ZWM0IHBhY2tEZXB0aFRvUkdCQSggY29uc3QgaW4gZmxvYXQgdiApIHtcblx0dmVjNCByID0gdmVjNCggZnJhY3QoIHYgKiBQYWNrRmFjdG9ycyApLCB2ICk7XG5cdHIueXp3IC09IHIueHl6ICogU2hpZnRSaWdodDg7XHRyZXR1cm4gciAqIFBhY2tVcHNjYWxlO1xufVxuZmxvYXQgdW5wYWNrUkdCQVRvRGVwdGgoIGNvbnN0IGluIHZlYzQgdiApIHtcblx0cmV0dXJuIGRvdCggdiwgVW5wYWNrRmFjdG9ycyApO1xufVxudmVjMiBwYWNrRGVwdGhUb1JHKCBpbiBoaWdocCBmbG9hdCB2ICkge1xuXHRyZXR1cm4gcGFja0RlcHRoVG9SR0JBKCB2ICkueXg7XG59XG5mbG9hdCB1bnBhY2tSR1RvRGVwdGgoIGNvbnN0IGluIGhpZ2hwIHZlYzIgdiApIHtcblx0cmV0dXJuIHVucGFja1JHQkFUb0RlcHRoKCB2ZWM0KCB2Lnh5LCAwLjAsIDAuMCApICk7XG59XG52ZWM0IHBhY2sySGFsZlRvUkdCQSggdmVjMiB2ICkge1xuXHR2ZWM0IHIgPSB2ZWM0KCB2LngsIGZyYWN0KCB2LnggKiAyNTUuMCApLCB2LnksIGZyYWN0KCB2LnkgKiAyNTUuMCApICk7XG5cdHJldHVybiB2ZWM0KCByLnggLSByLnkgLyAyNTUuMCwgci55LCByLnogLSByLncgLyAyNTUuMCwgci53ICk7XG59XG52ZWMyIHVucGFja1JHQkFUbzJIYWxmKCB2ZWM0IHYgKSB7XG5cdHJldHVybiB2ZWMyKCB2LnggKyAoIHYueSAvIDI1NS4wICksIHYueiArICggdi53IC8gMjU1LjAgKSApO1xufVxuZmxvYXQgdmlld1pUb09ydGhvZ3JhcGhpY0RlcHRoKCBjb25zdCBpbiBmbG9hdCB2aWV3WiwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gKCB2aWV3WiArIG5lYXIgKSAvICggbmVhciAtIGZhciApO1xufVxuZmxvYXQgb3J0aG9ncmFwaGljRGVwdGhUb1ZpZXdaKCBjb25zdCBpbiBmbG9hdCBkZXB0aCwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gZGVwdGggKiAoIG5lYXIgLSBmYXIgKSAtIG5lYXI7XG59XG5mbG9hdCB2aWV3WlRvUGVyc3BlY3RpdmVEZXB0aCggY29uc3QgaW4gZmxvYXQgdmlld1osIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuICggKCBuZWFyICsgdmlld1ogKSAqIGZhciApIC8gKCAoIGZhciAtIG5lYXIgKSAqIHZpZXdaICk7XG59XG5mbG9hdCBwZXJzcGVjdGl2ZURlcHRoVG9WaWV3WiggY29uc3QgaW4gZmxvYXQgZGVwdGgsIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuICggbmVhciAqIGZhciApIC8gKCAoIGZhciAtIG5lYXIgKSAqIGRlcHRoIC0gZmFyICk7XG59IjsKCnZhciBwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50ID0gIiNpZmRlZiBQUkVNVUxUSVBMSUVEX0FMUEhBXG5cdGdsX0ZyYWdDb2xvci5yZ2IgKj0gZ2xfRnJhZ0NvbG9yLmE7XG4jZW5kaWYiOwoKdmFyIHByb2plY3RfdmVydGV4ID0gInZlYzQgbXZQb3NpdGlvbiA9IHZlYzQoIHRyYW5zZm9ybWVkLCAxLjAgKTtcbiNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0bXZQb3NpdGlvbiA9IGJhdGNoaW5nTWF0cml4ICogbXZQb3NpdGlvbjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JTlNUQU5DSU5HXG5cdG12UG9zaXRpb24gPSBpbnN0YW5jZU1hdHJpeCAqIG12UG9zaXRpb247XG4jZW5kaWZcbm12UG9zaXRpb24gPSBtb2RlbFZpZXdNYXRyaXggKiBtdlBvc2l0aW9uO1xuZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbXZQb3NpdGlvbjsiOwoKdmFyIGRpdGhlcmluZ19mcmFnbWVudCA9ICIjaWZkZWYgRElUSEVSSU5HXG5cdGdsX0ZyYWdDb2xvci5yZ2IgPSBkaXRoZXJpbmcoIGdsX0ZyYWdDb2xvci5yZ2IgKTtcbiNlbmRpZiI7Cgp2YXIgZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIERJVEhFUklOR1xuXHR2ZWMzIGRpdGhlcmluZyggdmVjMyBjb2xvciApIHtcblx0XHRmbG9hdCBncmlkX3Bvc2l0aW9uID0gcmFuZCggZ2xfRnJhZ0Nvb3JkLnh5ICk7XG5cdFx0dmVjMyBkaXRoZXJfc2hpZnRfUkdCID0gdmVjMyggMC4yNSAvIDI1NS4wLCAtMC4yNSAvIDI1NS4wLCAwLjI1IC8gMjU1LjAgKTtcblx0XHRkaXRoZXJfc2hpZnRfUkdCID0gbWl4KCAyLjAgKiBkaXRoZXJfc2hpZnRfUkdCLCAtMi4wICogZGl0aGVyX3NoaWZ0X1JHQiwgZ3JpZF9wb3NpdGlvbiApO1xuXHRcdHJldHVybiBjb2xvciArIGRpdGhlcl9zaGlmdF9SR0I7XG5cdH1cbiNlbmRpZiI7Cgp2YXIgcm91Z2huZXNzbWFwX2ZyYWdtZW50ID0gImZsb2F0IHJvdWdobmVzc0ZhY3RvciA9IHJvdWdobmVzcztcbiNpZmRlZiBVU0VfUk9VR0hORVNTTUFQXG5cdHZlYzQgdGV4ZWxSb3VnaG5lc3MgPSB0ZXh0dXJlMkQoIHJvdWdobmVzc01hcCwgdlJvdWdobmVzc01hcFV2ICk7XG5cdHJvdWdobmVzc0ZhY3RvciAqPSB0ZXhlbFJvdWdobmVzcy5nO1xuI2VuZGlmIjsKCnZhciByb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCByb3VnaG5lc3NNYXA7XG4jZW5kaWYiOwoKdmFyIHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZiBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdHZhcnlpbmcgdmVjNCB2U3BvdExpZ2h0Q29vcmRbIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyBdO1xuI2VuZGlmXG4jaWYgTlVNX1NQT1RfTElHSFRfTUFQUyA+IDBcblx0dW5pZm9ybSBzYW1wbGVyMkQgc3BvdExpZ2h0TWFwWyBOVU1fU1BPVF9MSUdIVF9NQVBTIF07XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hBRE9XTUFQXG5cdCNpZiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgZGlyZWN0aW9uYWxTaGFkb3dNYXBbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHZhcnlpbmcgdmVjNCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdFx0c3RydWN0IERpcmVjdGlvbmFsTGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0fTtcblx0XHR1bmlmb3JtIERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZGlyZWN0aW9uYWxMaWdodFNoYWRvd3NbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgc3BvdFNoYWRvd01hcFsgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBTcG90TGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0fTtcblx0XHR1bmlmb3JtIFNwb3RMaWdodFNoYWRvdyBzcG90TGlnaHRTaGFkb3dzWyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgcG9pbnRTaGFkb3dNYXBbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdFx0dmFyeWluZyB2ZWM0IHZQb2ludFNoYWRvd0Nvb3JkWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBQb2ludExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgc2hhZG93Q2FtZXJhTmVhcjtcblx0XHRcdGZsb2F0IHNoYWRvd0NhbWVyYUZhcjtcblx0XHR9O1xuXHRcdHVuaWZvcm0gUG9pbnRMaWdodFNoYWRvdyBwb2ludExpZ2h0U2hhZG93c1sgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0I2VuZGlmXG5cdGZsb2F0IHRleHR1cmUyRENvbXBhcmUoIHNhbXBsZXIyRCBkZXB0aHMsIHZlYzIgdXYsIGZsb2F0IGNvbXBhcmUgKSB7XG5cdFx0cmV0dXJuIHN0ZXAoIGNvbXBhcmUsIHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIGRlcHRocywgdXYgKSApICk7XG5cdH1cblx0dmVjMiB0ZXh0dXJlMkREaXN0cmlidXRpb24oIHNhbXBsZXIyRCBzaGFkb3csIHZlYzIgdXYgKSB7XG5cdFx0cmV0dXJuIHVucGFja1JHQkFUbzJIYWxmKCB0ZXh0dXJlMkQoIHNoYWRvdywgdXYgKSApO1xuXHR9XG5cdGZsb2F0IFZTTVNoYWRvdyAoc2FtcGxlcjJEIHNoYWRvdywgdmVjMiB1diwgZmxvYXQgY29tcGFyZSApe1xuXHRcdGZsb2F0IG9jY2x1c2lvbiA9IDEuMDtcblx0XHR2ZWMyIGRpc3RyaWJ1dGlvbiA9IHRleHR1cmUyRERpc3RyaWJ1dGlvbiggc2hhZG93LCB1diApO1xuXHRcdGZsb2F0IGhhcmRfc2hhZG93ID0gc3RlcCggY29tcGFyZSAsIGRpc3RyaWJ1dGlvbi54ICk7XG5cdFx0aWYgKGhhcmRfc2hhZG93ICE9IDEuMCApIHtcblx0XHRcdGZsb2F0IGRpc3RhbmNlID0gY29tcGFyZSAtIGRpc3RyaWJ1dGlvbi54IDtcblx0XHRcdGZsb2F0IHZhcmlhbmNlID0gbWF4KCAwLjAwMDAwLCBkaXN0cmlidXRpb24ueSAqIGRpc3RyaWJ1dGlvbi55ICk7XG5cdFx0XHRmbG9hdCBzb2Z0bmVzc19wcm9iYWJpbGl0eSA9IHZhcmlhbmNlIC8gKHZhcmlhbmNlICsgZGlzdGFuY2UgKiBkaXN0YW5jZSApO1x0XHRcdHNvZnRuZXNzX3Byb2JhYmlsaXR5ID0gY2xhbXAoICggc29mdG5lc3NfcHJvYmFiaWxpdHkgLSAwLjMgKSAvICggMC45NSAtIDAuMyApLCAwLjAsIDEuMCApO1x0XHRcdG9jY2x1c2lvbiA9IGNsYW1wKCBtYXgoIGhhcmRfc2hhZG93LCBzb2Z0bmVzc19wcm9iYWJpbGl0eSApLCAwLjAsIDEuMCApO1xuXHRcdH1cblx0XHRyZXR1cm4gb2NjbHVzaW9uO1xuXHR9XG5cdGZsb2F0IGdldFNoYWRvdyggc2FtcGxlcjJEIHNoYWRvd01hcCwgdmVjMiBzaGFkb3dNYXBTaXplLCBmbG9hdCBzaGFkb3dCaWFzLCBmbG9hdCBzaGFkb3dSYWRpdXMsIHZlYzQgc2hhZG93Q29vcmQgKSB7XG5cdFx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHRcdHNoYWRvd0Nvb3JkLnh5eiAvPSBzaGFkb3dDb29yZC53O1xuXHRcdHNoYWRvd0Nvb3JkLnogKz0gc2hhZG93Qmlhcztcblx0XHRib29sIGluRnJ1c3R1bSA9IHNoYWRvd0Nvb3JkLnggPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnggPD0gMS4wICYmIHNoYWRvd0Nvb3JkLnkgPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnkgPD0gMS4wO1xuXHRcdGJvb2wgZnJ1c3R1bVRlc3QgPSBpbkZydXN0dW0gJiYgc2hhZG93Q29vcmQueiA8PSAxLjA7XG5cdFx0aWYgKCBmcnVzdHVtVGVzdCApIHtcblx0XHQjaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHgwID0gLSB0ZXhlbFNpemUueCAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR5MCA9IC0gdGV4ZWxTaXplLnkgKiBzaGFkb3dSYWRpdXM7XG5cdFx0XHRmbG9hdCBkeDEgPSArIHRleGVsU2l6ZS54ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0ZmxvYXQgZHkxID0gKyB0ZXhlbFNpemUueSAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR4MiA9IGR4MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MiA9IGR5MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR4MyA9IGR4MSAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MyA9IGR5MSAvIDIuMDtcblx0XHRcdHNoYWRvdyA9IChcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgZHkwICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgxLCBkeTAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MiwgZHkyICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MiApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCBkeTIgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCAwLjAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIGR5MyApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTMgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MywgZHkzICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDAsIGR5MSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTEgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgZHkxICksIHNoYWRvd0Nvb3JkLnogKVxuXHRcdFx0KSAqICggMS4wIC8gMTcuMCApO1xuXHRcdCNlbGlmIGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1BDRl9TT0ZUIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHggPSB0ZXhlbFNpemUueDtcblx0XHRcdGZsb2F0IGR5ID0gdGV4ZWxTaXplLnk7XG5cdFx0XHR2ZWMyIHV2ID0gc2hhZG93Q29vcmQueHk7XG5cdFx0XHR2ZWMyIGYgPSBmcmFjdCggdXYgKiBzaGFkb3dNYXBTaXplICsgMC41ICk7XG5cdFx0XHR1diAtPSBmICogdGV4ZWxTaXplO1xuXHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCBkeSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdGV4ZWxTaXplLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAyLjAgKiBkeCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgZi54ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueCApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueSApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCBkeCwgMi4wICogZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCBmLnkgKSArXG5cdFx0XHRcdG1peCggbWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggLWR4LCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdFx0ICB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMi4wICogZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHRcdCAgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBmLnkgKVxuXHRcdFx0KSAqICggMS4wIC8gOS4wICk7XG5cdFx0I2VsaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfVlNNIClcblx0XHRcdHNoYWRvdyA9IFZTTVNoYWRvdyggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSwgc2hhZG93Q29vcmQueiApO1xuXHRcdCNlbHNlXG5cdFx0XHRzaGFkb3cgPSB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICk7XG5cdFx0I2VuZGlmXG5cdFx0fVxuXHRcdHJldHVybiBzaGFkb3c7XG5cdH1cblx0dmVjMiBjdWJlVG9VViggdmVjMyB2LCBmbG9hdCB0ZXhlbFNpemVZICkge1xuXHRcdHZlYzMgYWJzViA9IGFicyggdiApO1xuXHRcdGZsb2F0IHNjYWxlVG9DdWJlID0gMS4wIC8gbWF4KCBhYnNWLngsIG1heCggYWJzVi55LCBhYnNWLnogKSApO1xuXHRcdGFic1YgKj0gc2NhbGVUb0N1YmU7XG5cdFx0diAqPSBzY2FsZVRvQ3ViZSAqICggMS4wIC0gMi4wICogdGV4ZWxTaXplWSApO1xuXHRcdHZlYzIgcGxhbmFyID0gdi54eTtcblx0XHRmbG9hdCBhbG1vc3RBVGV4ZWwgPSAxLjUgKiB0ZXhlbFNpemVZO1xuXHRcdGZsb2F0IGFsbW9zdE9uZSA9IDEuMCAtIGFsbW9zdEFUZXhlbDtcblx0XHRpZiAoIGFic1YueiA+PSBhbG1vc3RPbmUgKSB7XG5cdFx0XHRpZiAoIHYueiA+IDAuMCApXG5cdFx0XHRcdHBsYW5hci54ID0gNC4wIC0gdi54O1xuXHRcdH0gZWxzZSBpZiAoIGFic1YueCA+PSBhbG1vc3RPbmUgKSB7XG5cdFx0XHRmbG9hdCBzaWduWCA9IHNpZ24oIHYueCApO1xuXHRcdFx0cGxhbmFyLnggPSB2LnogKiBzaWduWCArIDIuMCAqIHNpZ25YO1xuXHRcdH0gZWxzZSBpZiAoIGFic1YueSA+PSBhbG1vc3RPbmUgKSB7XG5cdFx0XHRmbG9hdCBzaWduWSA9IHNpZ24oIHYueSApO1xuXHRcdFx0cGxhbmFyLnggPSB2LnggKyAyLjAgKiBzaWduWSArIDIuMDtcblx0XHRcdHBsYW5hci55ID0gdi56ICogc2lnblkgLSAyLjA7XG5cdFx0fVxuXHRcdHJldHVybiB2ZWMyKCAwLjEyNSwgMC4yNSApICogcGxhbmFyICsgdmVjMiggMC4zNzUsIDAuNzUgKTtcblx0fVxuXHRmbG9hdCBnZXRQb2ludFNoYWRvdyggc2FtcGxlcjJEIHNoYWRvd01hcCwgdmVjMiBzaGFkb3dNYXBTaXplLCBmbG9hdCBzaGFkb3dCaWFzLCBmbG9hdCBzaGFkb3dSYWRpdXMsIHZlYzQgc2hhZG93Q29vcmQsIGZsb2F0IHNoYWRvd0NhbWVyYU5lYXIsIGZsb2F0IHNoYWRvd0NhbWVyYUZhciApIHtcblx0XHR2ZWMyIHRleGVsU2l6ZSA9IHZlYzIoIDEuMCApIC8gKCBzaGFkb3dNYXBTaXplICogdmVjMiggNC4wLCAyLjAgKSApO1xuXHRcdHZlYzMgbGlnaHRUb1Bvc2l0aW9uID0gc2hhZG93Q29vcmQueHl6O1xuXHRcdGZsb2F0IGRwID0gKCBsZW5ndGgoIGxpZ2h0VG9Qb3NpdGlvbiApIC0gc2hhZG93Q2FtZXJhTmVhciApIC8gKCBzaGFkb3dDYW1lcmFGYXIgLSBzaGFkb3dDYW1lcmFOZWFyICk7XHRcdGRwICs9IHNoYWRvd0JpYXM7XG5cdFx0dmVjMyBiZDNEID0gbm9ybWFsaXplKCBsaWdodFRvUG9zaXRpb24gKTtcblx0XHQjaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGICkgfHwgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGX1NPRlQgKSB8fCBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9WU00gKVxuXHRcdFx0dmVjMiBvZmZzZXQgPSB2ZWMyKCAtIDEsIDEgKSAqIHNoYWRvd1JhZGl1cyAqIHRleGVsU2l6ZS55O1xuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eXksIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl5eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHl4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC55eXgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNELCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eHksIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl4eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHh4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC55eHgsIHRleGVsU2l6ZS55ICksIGRwIClcblx0XHRcdCkgKiAoIDEuMCAvIDkuMCApO1xuXHRcdCNlbHNlXG5cdFx0XHRyZXR1cm4gdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCwgdGV4ZWxTaXplLnkgKSwgZHAgKTtcblx0XHQjZW5kaWZcblx0fVxuI2VuZGlmIjsKCnZhciBzaGFkb3dtYXBfcGFyc192ZXJ0ZXggPSAiI2lmIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyA+IDBcblx0dW5pZm9ybSBtYXQ0IHNwb3RMaWdodE1hdHJpeFsgTlVNX1NQT1RfTElHSFRfQ09PUkRTIF07XG5cdHZhcnlpbmcgdmVjNCB2U3BvdExpZ2h0Q29vcmRbIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyBdO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBkaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdFx0dmFyeWluZyB2ZWM0IHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgRGlyZWN0aW9uYWxMaWdodFNoYWRvdyB7XG5cdFx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHR9O1xuXHRcdHVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyA+IDBcblx0XHRzdHJ1Y3QgU3BvdExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93c1sgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBwb2ludFNoYWRvd01hdHJpeFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdlBvaW50U2hhZG93Q29vcmRbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdFx0c3RydWN0IFBvaW50TGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0XHRmbG9hdCBzaGFkb3dDYW1lcmFOZWFyO1xuXHRcdFx0ZmxvYXQgc2hhZG93Q2FtZXJhRmFyO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHRTaGFkb3dzWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgc2hhZG93bWFwX3ZlcnRleCA9ICIjaWYgKCBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgKCBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwIHx8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMCApICkgfHwgKCBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwIClcblx0dmVjMyBzaGFkb3dXb3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHRyYW5zZm9ybWVkTm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzQgc2hhZG93V29ybGRQb3NpdGlvbjtcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKVxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fRElSX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0XHRzaGFkb3dXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbiArIHZlYzQoIHNoYWRvd1dvcmxkTm9ybWFsICogZGlyZWN0aW9uYWxMaWdodFNoYWRvd3NbIGkgXS5zaGFkb3dOb3JtYWxCaWFzLCAwICk7XG5cdFx0XHR2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdID0gZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXhbIGkgXSAqIHNoYWRvd1dvcmxkUG9zaXRpb247XG5cdFx0fVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuXHRcdFx0c2hhZG93V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb24gKyB2ZWM0KCBzaGFkb3dXb3JsZE5vcm1hbCAqIHBvaW50TGlnaHRTaGFkb3dzWyBpIF0uc2hhZG93Tm9ybWFsQmlhcywgMCApO1xuXHRcdFx0dlBvaW50U2hhZG93Q29vcmRbIGkgXSA9IHBvaW50U2hhZG93TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcbiNlbmRpZlxuI2lmIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyA+IDBcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fU1BPVF9MSUdIVF9DT09SRFM7IGkgKysgKSB7XG5cdFx0c2hhZG93V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb247XG5cdFx0I2lmICggZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcblx0XHRcdHNoYWRvd1dvcmxkUG9zaXRpb24ueHl6ICs9IHNoYWRvd1dvcmxkTm9ybWFsICogc3BvdExpZ2h0U2hhZG93c1sgaSBdLnNoYWRvd05vcm1hbEJpYXM7XG5cdFx0I2VuZGlmXG5cdFx0dlNwb3RMaWdodENvb3JkWyBpIF0gPSBzcG90TGlnaHRNYXRyaXhbIGkgXSAqIHNoYWRvd1dvcmxkUG9zaXRpb247XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZiI7Cgp2YXIgc2hhZG93bWFza19wYXJzX2ZyYWdtZW50ID0gImZsb2F0IGdldFNoYWRvd01hc2soKSB7XG5cdGZsb2F0IHNoYWRvdyA9IDEuMDtcblx0I2lmZGVmIFVTRV9TSEFET1dNQVBcblx0I2lmIE5VTV9ESVJfTElHSFRfU0hBRE9XUyA+IDBcblx0RGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9ESVJfTElHSFRfU0hBRE9XUzsgaSArKyApIHtcblx0XHRkaXJlY3Rpb25hbExpZ2h0ID0gZGlyZWN0aW9uYWxMaWdodFNoYWRvd3NbIGkgXTtcblx0XHRzaGFkb3cgKj0gcmVjZWl2ZVNoYWRvdyA/IGdldFNoYWRvdyggZGlyZWN0aW9uYWxTaGFkb3dNYXBbIGkgXSwgZGlyZWN0aW9uYWxMaWdodC5zaGFkb3dNYXBTaXplLCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd0JpYXMsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93UmFkaXVzLCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuXHRTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0c3BvdExpZ2h0ID0gc3BvdExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdHNoYWRvdyAqPSByZWNlaXZlU2hhZG93ID8gZ2V0U2hhZG93KCBzcG90U2hhZG93TWFwWyBpIF0sIHNwb3RMaWdodC5zaGFkb3dNYXBTaXplLCBzcG90TGlnaHQuc2hhZG93Qmlhcywgc3BvdExpZ2h0LnNoYWRvd1JhZGl1cywgdlNwb3RMaWdodENvb3JkWyBpIF0gKSA6IDEuMDtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0cG9pbnRMaWdodCA9IHBvaW50TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0c2hhZG93ICo9IHJlY2VpdmVTaGFkb3cgPyBnZXRQb2ludFNoYWRvdyggcG9pbnRTaGFkb3dNYXBbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dNYXBTaXplLCBwb2ludExpZ2h0LnNoYWRvd0JpYXMsIHBvaW50TGlnaHQuc2hhZG93UmFkaXVzLCB2UG9pbnRTaGFkb3dDb29yZFsgaSBdLCBwb2ludExpZ2h0LnNoYWRvd0NhbWVyYU5lYXIsIHBvaW50TGlnaHQuc2hhZG93Q2FtZXJhRmFyICkgOiAxLjA7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG5cdCNlbmRpZlxuXHRyZXR1cm4gc2hhZG93O1xufSI7Cgp2YXIgc2tpbmJhc2VfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0tJTk5JTkdcblx0bWF0NCBib25lTWF0WCA9IGdldEJvbmVNYXRyaXgoIHNraW5JbmRleC54ICk7XG5cdG1hdDQgYm9uZU1hdFkgPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueSApO1xuXHRtYXQ0IGJvbmVNYXRaID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LnogKTtcblx0bWF0NCBib25lTWF0VyA9IGdldEJvbmVNYXRyaXgoIHNraW5JbmRleC53ICk7XG4jZW5kaWYiOwoKdmFyIHNraW5uaW5nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0tJTk5JTkdcblx0dW5pZm9ybSBtYXQ0IGJpbmRNYXRyaXg7XG5cdHVuaWZvcm0gbWF0NCBiaW5kTWF0cml4SW52ZXJzZTtcblx0dW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgYm9uZVRleHR1cmU7XG5cdG1hdDQgZ2V0Qm9uZU1hdHJpeCggY29uc3QgaW4gZmxvYXQgaSApIHtcblx0XHRpbnQgc2l6ZSA9IHRleHR1cmVTaXplKCBib25lVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IGogPSBpbnQoIGkgKSAqIDQ7XG5cdFx0aW50IHggPSBqICUgc2l6ZTtcblx0XHRpbnQgeSA9IGogLyBzaXplO1xuXHRcdHZlYzQgdjEgPSB0ZXhlbEZldGNoKCBib25lVGV4dHVyZSwgaXZlYzIoIHgsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjIgPSB0ZXhlbEZldGNoKCBib25lVGV4dHVyZSwgaXZlYzIoIHggKyAxLCB5ICksIDAgKTtcblx0XHR2ZWM0IHYzID0gdGV4ZWxGZXRjaCggYm9uZVRleHR1cmUsIGl2ZWMyKCB4ICsgMiwgeSApLCAwICk7XG5cdFx0dmVjNCB2NCA9IHRleGVsRmV0Y2goIGJvbmVUZXh0dXJlLCBpdmVjMiggeCArIDMsIHkgKSwgMCApO1xuXHRcdHJldHVybiBtYXQ0KCB2MSwgdjIsIHYzLCB2NCApO1xuXHR9XG4jZW5kaWYiOwoKdmFyIHNraW5uaW5nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG5cdHZlYzQgc2tpblZlcnRleCA9IGJpbmRNYXRyaXggKiB2ZWM0KCB0cmFuc2Zvcm1lZCwgMS4wICk7XG5cdHZlYzQgc2tpbm5lZCA9IHZlYzQoIDAuMCApO1xuXHRza2lubmVkICs9IGJvbmVNYXRYICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQueDtcblx0c2tpbm5lZCArPSBib25lTWF0WSAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lnk7XG5cdHNraW5uZWQgKz0gYm9uZU1hdFogKiBza2luVmVydGV4ICogc2tpbldlaWdodC56O1xuXHRza2lubmVkICs9IGJvbmVNYXRXICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQudztcblx0dHJhbnNmb3JtZWQgPSAoIGJpbmRNYXRyaXhJbnZlcnNlICogc2tpbm5lZCApLnh5ejtcbiNlbmRpZiI7Cgp2YXIgc2tpbm5vcm1hbF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHRtYXQ0IHNraW5NYXRyaXggPSBtYXQ0KCAwLjAgKTtcblx0c2tpbk1hdHJpeCArPSBza2luV2VpZ2h0LnggKiBib25lTWF0WDtcblx0c2tpbk1hdHJpeCArPSBza2luV2VpZ2h0LnkgKiBib25lTWF0WTtcblx0c2tpbk1hdHJpeCArPSBza2luV2VpZ2h0LnogKiBib25lTWF0Wjtcblx0c2tpbk1hdHJpeCArPSBza2luV2VpZ2h0LncgKiBib25lTWF0Vztcblx0c2tpbk1hdHJpeCA9IGJpbmRNYXRyaXhJbnZlcnNlICogc2tpbk1hdHJpeCAqIGJpbmRNYXRyaXg7XG5cdG9iamVjdE5vcm1hbCA9IHZlYzQoIHNraW5NYXRyaXggKiB2ZWM0KCBvYmplY3ROb3JtYWwsIDAuMCApICkueHl6O1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRvYmplY3RUYW5nZW50ID0gdmVjNCggc2tpbk1hdHJpeCAqIHZlYzQoIG9iamVjdFRhbmdlbnQsIDAuMCApICkueHl6O1xuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgc3BlY3VsYXJtYXBfZnJhZ21lbnQgPSAiZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dmVjNCB0ZXhlbFNwZWN1bGFyID0gdGV4dHVyZTJEKCBzcGVjdWxhck1hcCwgdlNwZWN1bGFyTWFwVXYgKTtcblx0c3BlY3VsYXJTdHJlbmd0aCA9IHRleGVsU3BlY3VsYXIucjtcbiNlbHNlXG5cdHNwZWN1bGFyU3RyZW5ndGggPSAxLjA7XG4jZW5kaWYiOwoKdmFyIHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhck1hcDtcbiNlbmRpZiI7Cgp2YXIgdG9uZW1hcHBpbmdfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFRPTkVfTUFQUElORyApXG5cdGdsX0ZyYWdDb2xvci5yZ2IgPSB0b25lTWFwcGluZyggZ2xfRnJhZ0NvbG9yLnJnYiApO1xuI2VuZGlmIjsKCnZhciB0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50ID0gIiNpZm5kZWYgc2F0dXJhdGVcbiNkZWZpbmUgc2F0dXJhdGUoIGEgKSBjbGFtcCggYSwgMC4wLCAxLjAgKVxuI2VuZGlmXG51bmlmb3JtIGZsb2F0IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG52ZWMzIExpbmVhclRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHRvbmVNYXBwaW5nRXhwb3N1cmUgKiBjb2xvciApO1xufVxudmVjMyBSZWluaGFyZFRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb2xvciAqPSB0b25lTWFwcGluZ0V4cG9zdXJlO1xuXHRyZXR1cm4gc2F0dXJhdGUoIGNvbG9yIC8gKCB2ZWMzKCAxLjAgKSArIGNvbG9yICkgKTtcbn1cbnZlYzMgT3B0aW1pemVkQ2luZW9uVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG5cdGNvbG9yID0gbWF4KCB2ZWMzKCAwLjAgKSwgY29sb3IgLSAwLjAwNCApO1xuXHRyZXR1cm4gcG93KCAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDAuNSApICkgLyAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDEuNyApICsgMC4wNiApLCB2ZWMzKCAyLjIgKSApO1xufVxudmVjMyBSUlRBbmRPRFRGaXQoIHZlYzMgdiApIHtcblx0dmVjMyBhID0gdiAqICggdiArIDAuMDI0NTc4NiApIC0gMC4wMDAwOTA1Mzc7XG5cdHZlYzMgYiA9IHYgKiAoIDAuOTgzNzI5ICogdiArIDAuNDMyOTUxMCApICsgMC4yMzgwODE7XG5cdHJldHVybiBhIC8gYjtcbn1cbnZlYzMgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb25zdCBtYXQzIEFDRVNJbnB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggMC41OTcxOSwgMC4wNzYwMCwgMC4wMjg0MCApLFx0XHR2ZWMzKCAwLjM1NDU4LCAwLjkwODM0LCAwLjEzMzgzICksXG5cdFx0dmVjMyggMC4wNDgyMywgMC4wMTU2NiwgMC44Mzc3NyApXG5cdCk7XG5cdGNvbnN0IG1hdDMgQUNFU091dHB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggIDEuNjA0NzUsIC0wLjEwMjA4LCAtMC4wMDMyNyApLFx0XHR2ZWMzKCAtMC41MzEwOCwgIDEuMTA4MTMsIC0wLjA3Mjc2ICksXG5cdFx0dmVjMyggLTAuMDczNjcsIC0wLjAwNjA1LCAgMS4wNzYwMiApXG5cdCk7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmUgLyAwLjY7XG5cdGNvbG9yID0gQUNFU0lucHV0TWF0ICogY29sb3I7XG5cdGNvbG9yID0gUlJUQW5kT0RURml0KCBjb2xvciApO1xuXHRjb2xvciA9IEFDRVNPdXRwdXRNYXQgKiBjb2xvcjtcblx0cmV0dXJuIHNhdHVyYXRlKCBjb2xvciApO1xufVxuY29uc3QgbWF0MyBMSU5FQVJfUkVDMjAyMF9UT19MSU5FQVJfU1JHQiA9IG1hdDMoXG5cdHZlYzMoIDEuNjYwNSwgLSAwLjEyNDYsIC0gMC4wMTgyICksXG5cdHZlYzMoIC0gMC41ODc2LCAxLjEzMjksIC0gMC4xMDA2ICksXG5cdHZlYzMoIC0gMC4wNzI4LCAtIDAuMDA4MywgMS4xMTg3IClcbik7XG5jb25zdCBtYXQzIExJTkVBUl9TUkdCX1RPX0xJTkVBUl9SRUMyMDIwID0gbWF0Myhcblx0dmVjMyggMC42Mjc0LCAwLjA2OTEsIDAuMDE2NCApLFxuXHR2ZWMzKCAwLjMyOTMsIDAuOTE5NSwgMC4wODgwICksXG5cdHZlYzMoIDAuMDQzMywgMC4wMTEzLCAwLjg5NTYgKVxuKTtcbnZlYzMgYWd4RGVmYXVsdENvbnRyYXN0QXBwcm94KCB2ZWMzIHggKSB7XG5cdHZlYzMgeDIgPSB4ICogeDtcblx0dmVjMyB4NCA9IHgyICogeDI7XG5cdHJldHVybiArIDE1LjUgKiB4NCAqIHgyXG5cdFx0LSA0MC4xNCAqIHg0ICogeFxuXHRcdCsgMzEuOTYgKiB4NFxuXHRcdC0gNi44NjggKiB4MiAqIHhcblx0XHQrIDAuNDI5OCAqIHgyXG5cdFx0KyAwLjExOTEgKiB4XG5cdFx0LSAwLjAwMjMyO1xufVxudmVjMyBBZ1hUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29uc3QgbWF0MyBBZ1hJbnNldE1hdHJpeCA9IG1hdDMoXG5cdFx0dmVjMyggMC44NTY2MjcxNTMzMTU5ODMsIDAuMTM3MzE4OTcyOTI5ODQ3LCAwLjExMTg5ODIxMjk5OTk1ICksXG5cdFx0dmVjMyggMC4wOTUxMjEyNDA1MzgxNTg4LCAwLjc2MTI0MTk5MDYwMjU5MSwgMC4wNzY3OTk0MTg2MDMxOTAzICksXG5cdFx0dmVjMyggMC4wNDgyNTE2MDYxNDU4NTgzLCAwLjEwMTQzOTAzNjQ2NzU2MiwgMC44MTEzMDIzNjgzOTY4NTkgKVxuXHQpO1xuXHRjb25zdCBtYXQzIEFnWE91dHNldE1hdHJpeCA9IG1hdDMoXG5cdFx0dmVjMyggMS4xMjcxMDA1ODE4MTQ0MzY4LCAtIDAuMTQxMzI5NzYzNDk4NDM4MywgLSAwLjE0MTMyOTc2MzQ5ODQzODI2ICksXG5cdFx0dmVjMyggLSAwLjExMDYwNjY0MzA5NjYwMzIzLCAxLjE1NzgyMzcwMjIxNjI3MiwgLSAwLjExMDYwNjY0MzA5NjYwMjk0ICksXG5cdFx0dmVjMyggLSAwLjAxNjQ5MzkzODcxNzgzNDU3MywgLSAwLjAxNjQ5MzkzODcxNzgzNDI1NywgMS4yNTE5MzY0MDY1OTUwNDA1IClcblx0KTtcblx0Y29uc3QgZmxvYXQgQWd4TWluRXYgPSAtIDEyLjQ3MzkzO1x0Y29uc3QgZmxvYXQgQWd4TWF4RXYgPSA0LjAyNjA2OTtcblx0Y29sb3IgPSBMSU5FQVJfU1JHQl9UT19MSU5FQVJfUkVDMjAyMCAqIGNvbG9yO1xuXHRjb2xvciAqPSB0b25lTWFwcGluZ0V4cG9zdXJlO1xuXHRjb2xvciA9IEFnWEluc2V0TWF0cml4ICogY29sb3I7XG5cdGNvbG9yID0gbWF4KCBjb2xvciwgMWUtMTAgKTtcdGNvbG9yID0gbG9nMiggY29sb3IgKTtcblx0Y29sb3IgPSAoIGNvbG9yIC0gQWd4TWluRXYgKSAvICggQWd4TWF4RXYgLSBBZ3hNaW5FdiApO1xuXHRjb2xvciA9IGNsYW1wKCBjb2xvciwgMC4wLCAxLjAgKTtcblx0Y29sb3IgPSBhZ3hEZWZhdWx0Q29udHJhc3RBcHByb3goIGNvbG9yICk7XG5cdGNvbG9yID0gQWdYT3V0c2V0TWF0cml4ICogY29sb3I7XG5cdGNvbG9yID0gcG93KCBtYXgoIHZlYzMoIDAuMCApLCBjb2xvciApLCB2ZWMzKCAyLjIgKSApO1xuXHRjb2xvciA9IExJTkVBUl9SRUMyMDIwX1RPX0xJTkVBUl9TUkdCICogY29sb3I7XG5cdHJldHVybiBjb2xvcjtcbn1cbnZlYzMgQ3VzdG9tVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7IHJldHVybiBjb2xvcjsgfSI7Cgp2YXIgdHJhbnNtaXNzaW9uX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA9IHRyYW5zbWlzc2lvbjtcblx0bWF0ZXJpYWwudHJhbnNtaXNzaW9uQWxwaGEgPSAxLjA7XG5cdG1hdGVyaWFsLnRoaWNrbmVzcyA9IHRoaWNrbmVzcztcblx0bWF0ZXJpYWwuYXR0ZW51YXRpb25EaXN0YW5jZSA9IGF0dGVudWF0aW9uRGlzdGFuY2U7XG5cdG1hdGVyaWFsLmF0dGVudWF0aW9uQ29sb3IgPSBhdHRlbnVhdGlvbkNvbG9yO1xuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHRcdG1hdGVyaWFsLnRyYW5zbWlzc2lvbiAqPSB0ZXh0dXJlMkQoIHRyYW5zbWlzc2lvbk1hcCwgdlRyYW5zbWlzc2lvbk1hcFV2ICkucjtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdFx0bWF0ZXJpYWwudGhpY2tuZXNzICo9IHRleHR1cmUyRCggdGhpY2tuZXNzTWFwLCB2VGhpY2tuZXNzTWFwVXYgKS5nO1xuXHQjZW5kaWZcblx0dmVjMyBwb3MgPSB2V29ybGRQb3NpdGlvbjtcblx0dmVjMyB2ID0gbm9ybWFsaXplKCBjYW1lcmFQb3NpdGlvbiAtIHBvcyApO1xuXHR2ZWMzIG4gPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBub3JtYWwsIHZpZXdNYXRyaXggKTtcblx0dmVjNCB0cmFuc21pdHRlZCA9IGdldElCTFZvbHVtZVJlZnJhY3Rpb24oXG5cdFx0biwgdiwgbWF0ZXJpYWwucm91Z2huZXNzLCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyRjkwLFxuXHRcdHBvcywgbW9kZWxNYXRyaXgsIHZpZXdNYXRyaXgsIHByb2plY3Rpb25NYXRyaXgsIG1hdGVyaWFsLmlvciwgbWF0ZXJpYWwudGhpY2tuZXNzLFxuXHRcdG1hdGVyaWFsLmF0dGVudWF0aW9uQ29sb3IsIG1hdGVyaWFsLmF0dGVudWF0aW9uRGlzdGFuY2UgKTtcblx0bWF0ZXJpYWwudHJhbnNtaXNzaW9uQWxwaGEgPSBtaXgoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbkFscGhhLCB0cmFuc21pdHRlZC5hLCBtYXRlcmlhbC50cmFuc21pc3Npb24gKTtcblx0dG90YWxEaWZmdXNlID0gbWl4KCB0b3RhbERpZmZ1c2UsIHRyYW5zbWl0dGVkLnJnYiwgbWF0ZXJpYWwudHJhbnNtaXNzaW9uICk7XG4jZW5kaWYiOwoKdmFyIHRyYW5zbWlzc2lvbl9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdHVuaWZvcm0gZmxvYXQgdHJhbnNtaXNzaW9uO1xuXHR1bmlmb3JtIGZsb2F0IHRoaWNrbmVzcztcblx0dW5pZm9ybSBmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlO1xuXHR1bmlmb3JtIHZlYzMgYXR0ZW51YXRpb25Db2xvcjtcblx0I2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCB0cmFuc21pc3Npb25NYXA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHRoaWNrbmVzc01hcDtcblx0I2VuZGlmXG5cdHVuaWZvcm0gdmVjMiB0cmFuc21pc3Npb25TYW1wbGVyU2l6ZTtcblx0dW5pZm9ybSBzYW1wbGVyMkQgdHJhbnNtaXNzaW9uU2FtcGxlck1hcDtcblx0dW5pZm9ybSBtYXQ0IG1vZGVsTWF0cml4O1xuXHR1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDtcblx0dmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuXHRmbG9hdCB3MCggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gKCAxLjAgLyA2LjAgKSAqICggYSAqICggYSAqICggLSBhICsgMy4wICkgLSAzLjAgKSArIDEuMCApO1xuXHR9XG5cdGZsb2F0IHcxKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogIGEgKiAoIDMuMCAqIGEgLSA2LjAgKSArIDQuMCApO1xuXHR9XG5cdGZsb2F0IHcyKCBmbG9hdCBhICl7XG5cdFx0cmV0dXJuICggMS4wIC8gNi4wICkgKiAoIGEgKiAoIGEgKiAoIC0gMy4wICogYSArIDMuMCApICsgMy4wICkgKyAxLjAgKTtcblx0fVxuXHRmbG9hdCB3MyggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gKCAxLjAgLyA2LjAgKSAqICggYSAqIGEgKiBhICk7XG5cdH1cblx0ZmxvYXQgZzAoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIHcwKCBhICkgKyB3MSggYSApO1xuXHR9XG5cdGZsb2F0IGcxKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiB3MiggYSApICsgdzMoIGEgKTtcblx0fVxuXHRmbG9hdCBoMCggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gLSAxLjAgKyB3MSggYSApIC8gKCB3MCggYSApICsgdzEoIGEgKSApO1xuXHR9XG5cdGZsb2F0IGgxKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAxLjAgKyB3MyggYSApIC8gKCB3MiggYSApICsgdzMoIGEgKSApO1xuXHR9XG5cdHZlYzQgYmljdWJpYyggc2FtcGxlcjJEIHRleCwgdmVjMiB1diwgdmVjNCB0ZXhlbFNpemUsIGZsb2F0IGxvZCApIHtcblx0XHR1diA9IHV2ICogdGV4ZWxTaXplLnp3ICsgMC41O1xuXHRcdHZlYzIgaXV2ID0gZmxvb3IoIHV2ICk7XG5cdFx0dmVjMiBmdXYgPSBmcmFjdCggdXYgKTtcblx0XHRmbG9hdCBnMHggPSBnMCggZnV2LnggKTtcblx0XHRmbG9hdCBnMXggPSBnMSggZnV2LnggKTtcblx0XHRmbG9hdCBoMHggPSBoMCggZnV2LnggKTtcblx0XHRmbG9hdCBoMXggPSBoMSggZnV2LnggKTtcblx0XHRmbG9hdCBoMHkgPSBoMCggZnV2LnkgKTtcblx0XHRmbG9hdCBoMXkgPSBoMSggZnV2LnkgKTtcblx0XHR2ZWMyIHAwID0gKCB2ZWMyKCBpdXYueCArIGgweCwgaXV2LnkgKyBoMHkgKSAtIDAuNSApICogdGV4ZWxTaXplLnh5O1xuXHRcdHZlYzIgcDEgPSAoIHZlYzIoIGl1di54ICsgaDF4LCBpdXYueSArIGgweSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0dmVjMiBwMiA9ICggdmVjMiggaXV2LnggKyBoMHgsIGl1di55ICsgaDF5ICkgLSAwLjUgKSAqIHRleGVsU2l6ZS54eTtcblx0XHR2ZWMyIHAzID0gKCB2ZWMyKCBpdXYueCArIGgxeCwgaXV2LnkgKyBoMXkgKSAtIDAuNSApICogdGV4ZWxTaXplLnh5O1xuXHRcdHJldHVybiBnMCggZnV2LnkgKSAqICggZzB4ICogdGV4dHVyZUxvZCggdGV4LCBwMCwgbG9kICkgKyBnMXggKiB0ZXh0dXJlTG9kKCB0ZXgsIHAxLCBsb2QgKSApICtcblx0XHRcdGcxKCBmdXYueSApICogKCBnMHggKiB0ZXh0dXJlTG9kKCB0ZXgsIHAyLCBsb2QgKSArIGcxeCAqIHRleHR1cmVMb2QoIHRleCwgcDMsIGxvZCApICk7XG5cdH1cblx0dmVjNCB0ZXh0dXJlQmljdWJpYyggc2FtcGxlcjJEIHNhbXBsZXIsIHZlYzIgdXYsIGZsb2F0IGxvZCApIHtcblx0XHR2ZWMyIGZMb2RTaXplID0gdmVjMiggdGV4dHVyZVNpemUoIHNhbXBsZXIsIGludCggbG9kICkgKSApO1xuXHRcdHZlYzIgY0xvZFNpemUgPSB2ZWMyKCB0ZXh0dXJlU2l6ZSggc2FtcGxlciwgaW50KCBsb2QgKyAxLjAgKSApICk7XG5cdFx0dmVjMiBmTG9kU2l6ZUludiA9IDEuMCAvIGZMb2RTaXplO1xuXHRcdHZlYzIgY0xvZFNpemVJbnYgPSAxLjAgLyBjTG9kU2l6ZTtcblx0XHR2ZWM0IGZTYW1wbGUgPSBiaWN1YmljKCBzYW1wbGVyLCB1diwgdmVjNCggZkxvZFNpemVJbnYsIGZMb2RTaXplICksIGZsb29yKCBsb2QgKSApO1xuXHRcdHZlYzQgY1NhbXBsZSA9IGJpY3ViaWMoIHNhbXBsZXIsIHV2LCB2ZWM0KCBjTG9kU2l6ZUludiwgY0xvZFNpemUgKSwgY2VpbCggbG9kICkgKTtcblx0XHRyZXR1cm4gbWl4KCBmU2FtcGxlLCBjU2FtcGxlLCBmcmFjdCggbG9kICkgKTtcblx0fVxuXHR2ZWMzIGdldFZvbHVtZVRyYW5zbWlzc2lvblJheSggY29uc3QgaW4gdmVjMyBuLCBjb25zdCBpbiB2ZWMzIHYsIGNvbnN0IGluIGZsb2F0IHRoaWNrbmVzcywgY29uc3QgaW4gZmxvYXQgaW9yLCBjb25zdCBpbiBtYXQ0IG1vZGVsTWF0cml4ICkge1xuXHRcdHZlYzMgcmVmcmFjdGlvblZlY3RvciA9IHJlZnJhY3QoIC0gdiwgbm9ybWFsaXplKCBuICksIDEuMCAvIGlvciApO1xuXHRcdHZlYzMgbW9kZWxTY2FsZTtcblx0XHRtb2RlbFNjYWxlLnggPSBsZW5ndGgoIHZlYzMoIG1vZGVsTWF0cml4WyAwIF0ueHl6ICkgKTtcblx0XHRtb2RlbFNjYWxlLnkgPSBsZW5ndGgoIHZlYzMoIG1vZGVsTWF0cml4WyAxIF0ueHl6ICkgKTtcblx0XHRtb2RlbFNjYWxlLnogPSBsZW5ndGgoIHZlYzMoIG1vZGVsTWF0cml4WyAyIF0ueHl6ICkgKTtcblx0XHRyZXR1cm4gbm9ybWFsaXplKCByZWZyYWN0aW9uVmVjdG9yICkgKiB0aGlja25lc3MgKiBtb2RlbFNjYWxlO1xuXHR9XG5cdGZsb2F0IGFwcGx5SW9yVG9Sb3VnaG5lc3MoIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgY29uc3QgaW4gZmxvYXQgaW9yICkge1xuXHRcdHJldHVybiByb3VnaG5lc3MgKiBjbGFtcCggaW9yICogMi4wIC0gMi4wLCAwLjAsIDEuMCApO1xuXHR9XG5cdHZlYzQgZ2V0VHJhbnNtaXNzaW9uU2FtcGxlKCBjb25zdCBpbiB2ZWMyIGZyYWdDb29yZCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiBmbG9hdCBpb3IgKSB7XG5cdFx0ZmxvYXQgbG9kID0gbG9nMiggdHJhbnNtaXNzaW9uU2FtcGxlclNpemUueCApICogYXBwbHlJb3JUb1JvdWdobmVzcyggcm91Z2huZXNzLCBpb3IgKTtcblx0XHRyZXR1cm4gdGV4dHVyZUJpY3ViaWMoIHRyYW5zbWlzc2lvblNhbXBsZXJNYXAsIGZyYWdDb29yZC54eSwgbG9kICk7XG5cdH1cblx0dmVjMyB2b2x1bWVBdHRlbnVhdGlvbiggY29uc3QgaW4gZmxvYXQgdHJhbnNtaXNzaW9uRGlzdGFuY2UsIGNvbnN0IGluIHZlYzMgYXR0ZW51YXRpb25Db2xvciwgY29uc3QgaW4gZmxvYXQgYXR0ZW51YXRpb25EaXN0YW5jZSApIHtcblx0XHRpZiAoIGlzaW5mKCBhdHRlbnVhdGlvbkRpc3RhbmNlICkgKSB7XG5cdFx0XHRyZXR1cm4gdmVjMyggMS4wICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZlYzMgYXR0ZW51YXRpb25Db2VmZmljaWVudCA9IC1sb2coIGF0dGVudWF0aW9uQ29sb3IgKSAvIGF0dGVudWF0aW9uRGlzdGFuY2U7XG5cdFx0XHR2ZWMzIHRyYW5zbWl0dGFuY2UgPSBleHAoIC0gYXR0ZW51YXRpb25Db2VmZmljaWVudCAqIHRyYW5zbWlzc2lvbkRpc3RhbmNlICk7XHRcdFx0cmV0dXJuIHRyYW5zbWl0dGFuY2U7XG5cdFx0fVxuXHR9XG5cdHZlYzQgZ2V0SUJMVm9sdW1lUmVmcmFjdGlvbiggY29uc3QgaW4gdmVjMyBuLCBjb25zdCBpbiB2ZWMzIHYsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgY29uc3QgaW4gdmVjMyBkaWZmdXNlQ29sb3IsXG5cdFx0Y29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCBzcGVjdWxhckY5MCwgY29uc3QgaW4gdmVjMyBwb3NpdGlvbiwgY29uc3QgaW4gbWF0NCBtb2RlbE1hdHJpeCxcblx0XHRjb25zdCBpbiBtYXQ0IHZpZXdNYXRyaXgsIGNvbnN0IGluIG1hdDQgcHJvak1hdHJpeCwgY29uc3QgaW4gZmxvYXQgaW9yLCBjb25zdCBpbiBmbG9hdCB0aGlja25lc3MsXG5cdFx0Y29uc3QgaW4gdmVjMyBhdHRlbnVhdGlvbkNvbG9yLCBjb25zdCBpbiBmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlICkge1xuXHRcdHZlYzMgdHJhbnNtaXNzaW9uUmF5ID0gZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KCBuLCB2LCB0aGlja25lc3MsIGlvciwgbW9kZWxNYXRyaXggKTtcblx0XHR2ZWMzIHJlZnJhY3RlZFJheUV4aXQgPSBwb3NpdGlvbiArIHRyYW5zbWlzc2lvblJheTtcblx0XHR2ZWM0IG5kY1BvcyA9IHByb2pNYXRyaXggKiB2aWV3TWF0cml4ICogdmVjNCggcmVmcmFjdGVkUmF5RXhpdCwgMS4wICk7XG5cdFx0dmVjMiByZWZyYWN0aW9uQ29vcmRzID0gbmRjUG9zLnh5IC8gbmRjUG9zLnc7XG5cdFx0cmVmcmFjdGlvbkNvb3JkcyArPSAxLjA7XG5cdFx0cmVmcmFjdGlvbkNvb3JkcyAvPSAyLjA7XG5cdFx0dmVjNCB0cmFuc21pdHRlZExpZ2h0ID0gZ2V0VHJhbnNtaXNzaW9uU2FtcGxlKCByZWZyYWN0aW9uQ29vcmRzLCByb3VnaG5lc3MsIGlvciApO1xuXHRcdHZlYzMgdHJhbnNtaXR0YW5jZSA9IGRpZmZ1c2VDb2xvciAqIHZvbHVtZUF0dGVudWF0aW9uKCBsZW5ndGgoIHRyYW5zbWlzc2lvblJheSApLCBhdHRlbnVhdGlvbkNvbG9yLCBhdHRlbnVhdGlvbkRpc3RhbmNlICk7XG5cdFx0dmVjMyBhdHRlbnVhdGVkQ29sb3IgPSB0cmFuc21pdHRhbmNlICogdHJhbnNtaXR0ZWRMaWdodC5yZ2I7XG5cdFx0dmVjMyBGID0gRW52aXJvbm1lbnRCUkRGKCBuLCB2LCBzcGVjdWxhckNvbG9yLCBzcGVjdWxhckY5MCwgcm91Z2huZXNzICk7XG5cdFx0ZmxvYXQgdHJhbnNtaXR0YW5jZUZhY3RvciA9ICggdHJhbnNtaXR0YW5jZS5yICsgdHJhbnNtaXR0YW5jZS5nICsgdHJhbnNtaXR0YW5jZS5iICkgLyAzLjA7XG5cdFx0cmV0dXJuIHZlYzQoICggMS4wIC0gRiApICogYXR0ZW51YXRlZENvbG9yLCAxLjAgLSAoIDEuMCAtIHRyYW5zbWl0dGVkTGlnaHQuYSApICogdHJhbnNtaXR0YW5jZUZhY3RvciApO1xuXHR9XG4jZW5kaWYiOwoKdmFyIHV2X3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9VViApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZIClcblx0dmFyeWluZyB2ZWMyIHZVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dmFyeWluZyB2ZWMyIHZNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR2YXJ5aW5nIHZlYzIgdkFscGhhTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTElHSFRNQVBcblx0dmFyeWluZyB2ZWMyIHZMaWdodE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FPTUFQXG5cdHZhcnlpbmcgdmVjMiB2QW9NYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9CVU1QTUFQXG5cdHZhcnlpbmcgdmVjMiB2QnVtcE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX05PUk1BTE1BUFxuXHR2YXJ5aW5nIHZlYzIgdk5vcm1hbE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHZhcnlpbmcgdmVjMiB2RW1pc3NpdmVNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZNZXRhbG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZSb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdHZhcnlpbmcgdmVjMiB2QW5pc290cm9weU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXROb3JtYWxNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQXG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0Um91Z2huZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dmFyeWluZyB2ZWMyIHZJcmlkZXNjZW5jZU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0dmFyeWluZyB2ZWMyIHZTaGVlbkNvbG9yTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5fUk9VR0hORVNTTUFQXG5cdHZhcnlpbmcgdmVjMiB2U2hlZW5Sb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJfQ09MT1JNQVBcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhckNvbG9yTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJfSU5URU5TSVRZTUFQXG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJJbnRlbnNpdHlNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0dW5pZm9ybSBtYXQzIHRyYW5zbWlzc2lvbk1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZUcmFuc21pc3Npb25NYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9USElDS05FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHRoaWNrbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZUaGlja25lc3NNYXBVdjtcbiNlbmRpZiI7Cgp2YXIgdXZfcGFyc192ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9VViApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZIClcblx0dmFyeWluZyB2ZWMyIHZVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBtYXQzIG1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIG1hdDMgYWxwaGFNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QWxwaGFNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR1bmlmb3JtIG1hdDMgbGlnaHRNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2TGlnaHRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIG1hdDMgYW9NYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QW9NYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9CVU1QTUFQXG5cdHVuaWZvcm0gbWF0MyBidW1wTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkJ1bXBNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9OT1JNQUxNQVBcblx0dW5pZm9ybSBtYXQzIG5vcm1hbE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZOb3JtYWxNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dW5pZm9ybSBtYXQzIGRpc3BsYWNlbWVudE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZEaXNwbGFjZW1lbnRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR1bmlmb3JtIG1hdDMgZW1pc3NpdmVNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2RW1pc3NpdmVNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIG1ldGFsbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZNZXRhbG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHJvdWdobmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZSb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdHVuaWZvcm0gbWF0MyBhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkFuaXNvdHJvcHlNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRNQVBcblx0dW5pZm9ybSBtYXQzIGNsZWFyY29hdE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG5cdHVuaWZvcm0gbWF0MyBjbGVhcmNvYXROb3JtYWxNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0Tm9ybWFsTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdFJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX0NPTE9STUFQXG5cdHVuaWZvcm0gbWF0MyBzaGVlbkNvbG9yTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuUm91Z2huZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dW5pZm9ybSBtYXQzIGlyaWRlc2NlbmNlTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZJcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHVuaWZvcm0gbWF0MyBzcGVjdWxhck1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0NPTE9STUFQXG5cdHVuaWZvcm0gbWF0MyBzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dW5pZm9ybSBtYXQzIHNwZWN1bGFySW50ZW5zaXR5TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFySW50ZW5zaXR5TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OTUFQXG5cdHVuaWZvcm0gbWF0MyB0cmFuc21pc3Npb25NYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VHJhbnNtaXNzaW9uTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyB0aGlja25lc3NNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VGhpY2tuZXNzTWFwVXY7XG4jZW5kaWYiOwoKdmFyIHV2X3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX1VWICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHR2VXYgPSB2ZWMzKCB1diwgMSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHR2TWFwVXYgPSAoIG1hcFRyYW5zZm9ybSAqIHZlYzMoIE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0dkFscGhhTWFwVXYgPSAoIGFscGhhTWFwVHJhbnNmb3JtICogdmVjMyggQUxQSEFNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0xJR0hUTUFQXG5cdHZMaWdodE1hcFV2ID0gKCBsaWdodE1hcFRyYW5zZm9ybSAqIHZlYzMoIExJR0hUTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BT01BUFxuXHR2QW9NYXBVdiA9ICggYW9NYXBUcmFuc2Zvcm0gKiB2ZWMzKCBBT01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQlVNUE1BUFxuXHR2QnVtcE1hcFV2ID0gKCBidW1wTWFwVHJhbnNmb3JtICogdmVjMyggQlVNUE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTk9STUFMTUFQXG5cdHZOb3JtYWxNYXBVdiA9ICggbm9ybWFsTWFwVHJhbnNmb3JtICogdmVjMyggTk9STUFMTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dkRpc3BsYWNlbWVudE1hcFV2ID0gKCBkaXNwbGFjZW1lbnRNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBESVNQTEFDRU1FTlRNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHZFbWlzc2l2ZU1hcFV2ID0gKCBlbWlzc2l2ZU1hcFRyYW5zZm9ybSAqIHZlYzMoIEVNSVNTSVZFTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dk1ldGFsbmVzc01hcFV2ID0gKCBtZXRhbG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBNRVRBTE5FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR2Um91Z2huZXNzTWFwVXYgPSAoIHJvdWdobmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIFJPVUdITkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWU1BUFxuXHR2QW5pc290cm9weU1hcFV2ID0gKCBhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtICogdmVjMyggQU5JU09UUk9QWU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG5cdHZDbGVhcmNvYXRNYXBVdiA9ICggY2xlYXJjb2F0TWFwVHJhbnNmb3JtICogdmVjMyggQ0xFQVJDT0FUTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG5cdHZDbGVhcmNvYXROb3JtYWxNYXBVdiA9ICggY2xlYXJjb2F0Tm9ybWFsTWFwVHJhbnNmb3JtICogdmVjMyggQ0xFQVJDT0FUX05PUk1BTE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR2Q2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgPSAoIGNsZWFyY29hdFJvdWdobmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIENMRUFSQ09BVF9ST1VHSE5FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFTUFQXG5cdHZJcmlkZXNjZW5jZU1hcFV2ID0gKCBpcmlkZXNjZW5jZU1hcFRyYW5zZm9ybSAqIHZlYzMoIElSSURFU0NFTkNFTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0dklyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgPSAoIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVHJhbnNmb3JtICogdmVjMyggSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHR2U2hlZW5Db2xvck1hcFV2ID0gKCBzaGVlbkNvbG9yTWFwVHJhbnNmb3JtICogdmVjMyggU0hFRU5fQ09MT1JNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHR2U2hlZW5Sb3VnaG5lc3NNYXBVdiA9ICggc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBTSEVFTl9ST1VHSE5FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHZTcGVjdWxhck1hcFV2ID0gKCBzcGVjdWxhck1hcFRyYW5zZm9ybSAqIHZlYzMoIFNQRUNVTEFSTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHR2U3BlY3VsYXJDb2xvck1hcFV2ID0gKCBzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtICogdmVjMyggU1BFQ1VMQVJfQ09MT1JNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHR2U3BlY3VsYXJJbnRlbnNpdHlNYXBVdiA9ICggc3BlY3VsYXJJbnRlbnNpdHlNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBTUEVDVUxBUl9JTlRFTlNJVFlNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHR2VHJhbnNtaXNzaW9uTWFwVXYgPSAoIHRyYW5zbWlzc2lvbk1hcFRyYW5zZm9ybSAqIHZlYzMoIFRSQU5TTUlTU0lPTk1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdHZUaGlja25lc3NNYXBVdiA9ICggdGhpY2tuZXNzTWFwVHJhbnNmb3JtICogdmVjMyggVEhJQ0tORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZiI7Cgp2YXIgd29ybGRwb3NfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgfHwgZGVmaW5lZCggRElTVEFOQ0UgKSB8fCBkZWZpbmVkICggVVNFX1NIQURPV01BUCApIHx8IGRlZmluZWQgKCBVU0VfVFJBTlNNSVNTSU9OICkgfHwgTlVNX1NQT1RfTElHSFRfQ09PUkRTID4gMFxuXHR2ZWM0IHdvcmxkUG9zaXRpb24gPSB2ZWM0KCB0cmFuc2Zvcm1lZCwgMS4wICk7XG5cdCNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0XHR3b3JsZFBvc2l0aW9uID0gYmF0Y2hpbmdNYXRyaXggKiB3b3JsZFBvc2l0aW9uO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9JTlNUQU5DSU5HXG5cdFx0d29ybGRQb3NpdGlvbiA9IGluc3RhbmNlTWF0cml4ICogd29ybGRQb3NpdGlvbjtcblx0I2VuZGlmXG5cdHdvcmxkUG9zaXRpb24gPSBtb2RlbE1hdHJpeCAqIHdvcmxkUG9zaXRpb247XG4jZW5kaWYiOwoKY29uc3QgdmVydGV4JGggPSAidmFyeWluZyB2ZWMyIHZVdjtcbnVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcbnZvaWQgbWFpbigpIHtcblx0dlV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIHV2LCAxICkgKS54eTtcblx0Z2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbi54eSwgMS4wLCAxLjAgKTtcbn0iOwoKY29uc3QgZnJhZ21lbnQkaCA9ICJ1bmlmb3JtIHNhbXBsZXIyRCB0MkQ7XG51bmlmb3JtIGZsb2F0IGJhY2tncm91bmRJbnRlbnNpdHk7XG52YXJ5aW5nIHZlYzIgdlV2O1xudm9pZCBtYWluKCkge1xuXHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZTJEKCB0MkQsIHZVdiApO1xuXHQjaWZkZWYgREVDT0RFX1ZJREVPX1RFWFRVUkVcblx0XHR0ZXhDb2xvciA9IHZlYzQoIG1peCggcG93KCB0ZXhDb2xvci5yZ2IgKiAwLjk0Nzg2NzI5ODYgKyB2ZWMzKCAwLjA1MjEzMjcwMTQgKSwgdmVjMyggMi40ICkgKSwgdGV4Q29sb3IucmdiICogMC4wNzczOTkzODA4LCB2ZWMzKCBsZXNzVGhhbkVxdWFsKCB0ZXhDb2xvci5yZ2IsIHZlYzMoIDAuMDQwNDUgKSApICkgKSwgdGV4Q29sb3IudyApO1xuXHQjZW5kaWZcblx0dGV4Q29sb3IucmdiICo9IGJhY2tncm91bmRJbnRlbnNpdHk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7Cgpjb25zdCB2ZXJ0ZXgkZyA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHRnbF9Qb3NpdGlvbi56ID0gZ2xfUG9zaXRpb24udztcbn0iOwoKY29uc3QgZnJhZ21lbnQkZyA9ICIjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHR1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDtcbiNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuXHR1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7XG4jZW5kaWZcbnVuaWZvcm0gZmxvYXQgZmxpcEVudk1hcDtcbnVuaWZvcm0gZmxvYXQgYmFja2dyb3VuZEJsdXJyaW5lc3M7XG51bmlmb3JtIGZsb2F0IGJhY2tncm91bmRJbnRlbnNpdHk7XG52YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgdmVjMyggZmxpcEVudk1hcCAqIHZXb3JsZERpcmVjdGlvbi54LCB2V29ybGREaXJlY3Rpb24ueXogKSApO1xuXHQjZWxpZiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcblx0XHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZUN1YmVVViggZW52TWFwLCB2V29ybGREaXJlY3Rpb24sIGJhY2tncm91bmRCbHVycmluZXNzICk7XG5cdCNlbHNlXG5cdFx0dmVjNCB0ZXhDb2xvciA9IHZlYzQoIDAuMCwgMC4wLCAwLjAsIDEuMCApO1xuXHQjZW5kaWZcblx0dGV4Q29sb3IucmdiICo9IGJhY2tncm91bmRJbnRlbnNpdHk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7Cgpjb25zdCB2ZXJ0ZXgkZiA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHRnbF9Qb3NpdGlvbi56ID0gZ2xfUG9zaXRpb24udztcbn0iOwoKY29uc3QgZnJhZ21lbnQkZiA9ICJ1bmlmb3JtIHNhbXBsZXJDdWJlIHRDdWJlO1xudW5pZm9ybSBmbG9hdCB0RmxpcDtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgdGV4Q29sb3IgPSB0ZXh0dXJlQ3ViZSggdEN1YmUsIHZlYzMoIHRGbGlwICogdldvcmxkRGlyZWN0aW9uLngsIHZXb3JsZERpcmVjdGlvbi55eiApICk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHRnbF9GcmFnQ29sb3IuYSAqPSBvcGFjaXR5O1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7Cgpjb25zdCB2ZXJ0ZXgkZSA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52YXJ5aW5nIHZlYzIgdkhpZ2hQcmVjaXNpb25aVztcbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZIaWdoUHJlY2lzaW9uWlcgPSBnbF9Qb3NpdGlvbi56dztcbn0iOwoKY29uc3QgZnJhZ21lbnQkZSA9ICIjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG5cdHVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50PlxudmFyeWluZyB2ZWMyIHZIaWdoUHJlY2lzaW9uWlc7XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggMS4wICk7XG5cdCNpZiBERVBUSF9QQUNLSU5HID09IDMyMDBcblx0XHRkaWZmdXNlQ29sb3IuYSA9IG9wYWNpdHk7XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0ZmxvYXQgZnJhZ0Nvb3JkWiA9IDAuNSAqIHZIaWdoUHJlY2lzaW9uWldbMF0gLyB2SGlnaFByZWNpc2lvblpXWzFdICsgMC41O1xuXHQjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG5cdFx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggdmVjMyggMS4wIC0gZnJhZ0Nvb3JkWiApLCBvcGFjaXR5ICk7XG5cdCNlbGlmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMVxuXHRcdGdsX0ZyYWdDb2xvciA9IHBhY2tEZXB0aFRvUkdCQSggZnJhZ0Nvb3JkWiApO1xuXHQjZW5kaWZcbn0iOwoKY29uc3QgdmVydGV4JGQgPSAiI2RlZmluZSBESVNUQU5DRVxudmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmF0Y2hpbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHRcdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dldvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uLnh5ejtcbn0iOwoKY29uc3QgZnJhZ21lbnQkZCA9ICIjZGVmaW5lIERJU1RBTkNFXG51bmlmb3JtIHZlYzMgcmVmZXJlbmNlUG9zaXRpb247XG51bmlmb3JtIGZsb2F0IG5lYXJEaXN0YW5jZTtcbnVuaWZvcm0gZmxvYXQgZmFyRGlzdGFuY2U7XG52YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluICgpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCAxLjAgKTtcblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHRmbG9hdCBkaXN0ID0gbGVuZ3RoKCB2V29ybGRQb3NpdGlvbiAtIHJlZmVyZW5jZVBvc2l0aW9uICk7XG5cdGRpc3QgPSAoIGRpc3QgLSBuZWFyRGlzdGFuY2UgKSAvICggZmFyRGlzdGFuY2UgLSBuZWFyRGlzdGFuY2UgKTtcblx0ZGlzdCA9IHNhdHVyYXRlKCBkaXN0ICk7XG5cdGdsX0ZyYWdDb2xvciA9IHBhY2tEZXB0aFRvUkdCQSggZGlzdCApO1xufSI7Cgpjb25zdCB2ZXJ0ZXgkYyA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxufSI7Cgpjb25zdCBmcmFnbWVudCRjID0gInVuaWZvcm0gc2FtcGxlcjJEIHRFcXVpcmVjdDtcbnZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2ZWMzIGRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggdldvcmxkRGlyZWN0aW9uICk7XG5cdHZlYzIgc2FtcGxlVVYgPSBlcXVpcmVjdFV2KCBkaXJlY3Rpb24gKTtcblx0Z2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKCB0RXF1aXJlY3QsIHNhbXBsZVVWICk7XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCRiID0gInVuaWZvcm0gZmxvYXQgc2NhbGU7XG5hdHRyaWJ1dGUgZmxvYXQgbGluZURpc3RhbmNlO1xudmFyeWluZyBmbG9hdCB2TGluZURpc3RhbmNlO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHR2TGluZURpc3RhbmNlID0gc2NhbGUgKiBsaW5lRGlzdGFuY2U7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCmNvbnN0IGZyYWdtZW50JGIgPSAidW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG51bmlmb3JtIGZsb2F0IGRhc2hTaXplO1xudW5pZm9ybSBmbG9hdCB0b3RhbFNpemU7XG52YXJ5aW5nIGZsb2F0IHZMaW5lRGlzdGFuY2U7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRpZiAoIG1vZCggdkxpbmVEaXN0YW5jZSwgdG90YWxTaXplICkgPiBkYXNoU2l6ZSApIHtcblx0XHRkaXNjYXJkO1xuXHR9XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdG91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cbn0iOwoKY29uc3QgdmVydGV4JGEgPSAiI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoY29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmF0Y2hpbmdfdmVydGV4PlxuXHQjaWYgZGVmaW5lZCAoIFVTRV9FTlZNQVAgKSB8fCBkZWZpbmVkICggVVNFX1NLSU5OSU5HIClcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGVudm1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7Cgpjb25zdCBmcmFnbWVudCRhID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0I2lmZGVmIFVTRV9MSUdIVE1BUFxuXHRcdHZlYzQgbGlnaHRNYXBUZXhlbCA9IHRleHR1cmUyRCggbGlnaHRNYXAsIHZMaWdodE1hcFV2ICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGxpZ2h0TWFwVGV4ZWwucmdiICogbGlnaHRNYXBJbnRlbnNpdHkgKiBSRUNJUFJPQ0FMX1BJO1xuXHQjZWxzZVxuXHRcdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSB2ZWMzKCAxLjAgKTtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQ5ID0gIiNkZWZpbmUgTEFNQkVSVFxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7Cgpjb25zdCBmcmFnbWVudCQ5ID0gIiNkZWZpbmUgTEFNQkVSVFxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJzZGZzPlxuI2luY2x1ZGUgPGxpZ2h0c19wYXJzX2JlZ2luPlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfbGFtYmVydF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSByZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaW5jbHVkZSA8ZW52bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKY29uc3QgdmVydGV4JDggPSAiI2RlZmluZSBNQVRDQVBcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xufSI7Cgpjb25zdCBmcmFnbWVudCQ4ID0gIiNkZWZpbmUgTUFUQ0FQXG51bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnVuaWZvcm0gc2FtcGxlcjJEIG1hdGNhcDtcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0dmVjMyB2aWV3RGlyID0gbm9ybWFsaXplKCB2Vmlld1Bvc2l0aW9uICk7XG5cdHZlYzMgeCA9IG5vcm1hbGl6ZSggdmVjMyggdmlld0Rpci56LCAwLjAsIC0gdmlld0Rpci54ICkgKTtcblx0dmVjMyB5ID0gY3Jvc3MoIHZpZXdEaXIsIHggKTtcblx0dmVjMiB1diA9IHZlYzIoIGRvdCggeCwgbm9ybWFsICksIGRvdCggeSwgbm9ybWFsICkgKSAqIDAuNDk1ICsgMC41O1xuXHQjaWZkZWYgVVNFX01BVENBUFxuXHRcdHZlYzQgbWF0Y2FwQ29sb3IgPSB0ZXh0dXJlMkQoIG1hdGNhcCwgdXYgKTtcblx0I2Vsc2Vcblx0XHR2ZWM0IG1hdGNhcENvbG9yID0gdmVjNCggdmVjMyggbWl4KCAwLjIsIDAuOCwgdXYueSApICksIDEuMCApO1xuXHQjZW5kaWZcblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYiAqIG1hdGNhcENvbG9yLnJnYjtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQ3ID0gIiNkZWZpbmUgTk9STUFMXG4jaWYgZGVmaW5lZCggRkxBVF9TSEFERUQgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG4jaWYgZGVmaW5lZCggRkxBVF9TSEFERUQgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4jZW5kaWZcbn0iOwoKY29uc3QgZnJhZ21lbnQkNyA9ICIjZGVmaW5lIE5PUk1BTFxudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmIGRlZmluZWQoIEZMQVRfU0hBREVEICkgfHwgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApXG5cdHZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2VuZGlmXG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggcGFja05vcm1hbFRvUkdCKCBub3JtYWwgKSwgb3BhY2l0eSApO1xuXHQjaWZkZWYgT1BBUVVFXG5cdFx0Z2xfRnJhZ0NvbG9yLmEgPSAxLjA7XG5cdCNlbmRpZlxufSI7Cgpjb25zdCB2ZXJ0ZXgkNiA9ICIjZGVmaW5lIFBIT05HXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxlbnZtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCmNvbnN0IGZyYWdtZW50JDYgPSAiI2RlZmluZSBQSE9OR1xudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIHZlYzMgc3BlY3VsYXI7XG51bmlmb3JtIGZsb2F0IHNoaW5pbmVzcztcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfcGhvbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQ1ID0gIiNkZWZpbmUgU1RBTkRBUkRcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cblx0dmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdHZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG4jZW5kaWZcbn0iOwoKY29uc3QgZnJhZ21lbnQkNSA9ICIjZGVmaW5lIFNUQU5EQVJEXG4jaWZkZWYgUEhZU0lDQUxcblx0I2RlZmluZSBJT1Jcblx0I2RlZmluZSBVU0VfU1BFQ1VMQVJcbiNlbmRpZlxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IHJvdWdobmVzcztcbnVuaWZvcm0gZmxvYXQgbWV0YWxuZXNzO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmZGVmIElPUlxuXHR1bmlmb3JtIGZsb2F0IGlvcjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUlxuXHR1bmlmb3JtIGZsb2F0IHNwZWN1bGFySW50ZW5zaXR5O1xuXHR1bmlmb3JtIHZlYzMgc3BlY3VsYXJDb2xvcjtcblx0I2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNwZWN1bGFyQ29sb3JNYXA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNwZWN1bGFySW50ZW5zaXR5TWFwO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0dW5pZm9ybSBmbG9hdCBjbGVhcmNvYXQ7XG5cdHVuaWZvcm0gZmxvYXQgY2xlYXJjb2F0Um91Z2huZXNzO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdHVuaWZvcm0gZmxvYXQgaXJpZGVzY2VuY2U7XG5cdHVuaWZvcm0gZmxvYXQgaXJpZGVzY2VuY2VJT1I7XG5cdHVuaWZvcm0gZmxvYXQgaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtO1xuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTlxuXHR1bmlmb3JtIHZlYzMgc2hlZW5Db2xvcjtcblx0dW5pZm9ybSBmbG9hdCBzaGVlblJvdWdobmVzcztcblx0I2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNoZWVuQ29sb3JNYXA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNoZWVuUm91Z2huZXNzTWFwO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdHVuaWZvcm0gdmVjMiBhbmlzb3Ryb3B5VmVjdG9yO1xuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBhbmlzb3Ryb3B5TWFwO1xuXHQjZW5kaWZcbiNlbmRpZlxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8aXJpZGVzY2VuY2VfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8aXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxyb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtZXRhbG5lc3NtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0dmVjMyB0b3RhbEVtaXNzaXZlUmFkaWFuY2UgPSBlbWlzc2l2ZTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHJvdWdobmVzc21hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1ldGFsbmVzc21hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8Y2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfZW5kPlxuXHQjaW5jbHVkZSA8YW9tYXBfZnJhZ21lbnQ+XG5cdHZlYzMgdG90YWxEaWZmdXNlID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZTtcblx0dmVjMyB0b3RhbFNwZWN1bGFyID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyO1xuXHQjaW5jbHVkZSA8dHJhbnNtaXNzaW9uX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSB0b3RhbERpZmZ1c2UgKyB0b3RhbFNwZWN1bGFyICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0ZmxvYXQgc2hlZW5FbmVyZ3lDb21wID0gMS4wIC0gMC4xNTcgKiBtYXgzKCBtYXRlcmlhbC5zaGVlbkNvbG9yICk7XG5cdFx0b3V0Z29pbmdMaWdodCA9IG91dGdvaW5nTGlnaHQgKiBzaGVlbkVuZXJneUNvbXAgKyBzaGVlblNwZWN1bGFyRGlyZWN0ICsgc2hlZW5TcGVjdWxhckluZGlyZWN0O1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0XHRmbG9hdCBkb3ROVmNjID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGdlb21ldHJ5Vmlld0RpciApICk7XG5cdFx0dmVjMyBGY2MgPSBGX1NjaGxpY2soIG1hdGVyaWFsLmNsZWFyY29hdEYwLCBtYXRlcmlhbC5jbGVhcmNvYXRGOTAsIGRvdE5WY2MgKTtcblx0XHRvdXRnb2luZ0xpZ2h0ID0gb3V0Z29pbmdMaWdodCAqICggMS4wIC0gbWF0ZXJpYWwuY2xlYXJjb2F0ICogRmNjICkgKyAoIGNsZWFyY29hdFNwZWN1bGFyRGlyZWN0ICsgY2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCApICogbWF0ZXJpYWwuY2xlYXJjb2F0O1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQ0ID0gIiNkZWZpbmUgVE9PTlxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKY29uc3QgZnJhZ21lbnQkNCA9ICIjZGVmaW5lIFRPT05cbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSB2ZWMzIGVtaXNzaXZlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3Rvb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX3Rvb25fZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQzID0gInVuaWZvcm0gZmxvYXQgc2l6ZTtcbnVuaWZvcm0gZmxvYXQgc2NhbGU7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG4jaWZkZWYgVVNFX1BPSU5UU19VVlxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuXHR1bmlmb3JtIG1hdDMgdXZUcmFuc2Zvcm07XG4jZW5kaWZcbnZvaWQgbWFpbigpIHtcblx0I2lmZGVmIFVTRV9QT0lOVFNfVVZcblx0XHR2VXYgPSAoIHV2VHJhbnNmb3JtICogdmVjMyggdXYsIDEgKSApLnh5O1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoY29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdGdsX1BvaW50U2l6ZSA9IHNpemU7XG5cdCNpZmRlZiBVU0VfU0laRUFUVEVOVUFUSU9OXG5cdFx0Ym9vbCBpc1BlcnNwZWN0aXZlID0gaXNQZXJzcGVjdGl2ZU1hdHJpeCggcHJvamVjdGlvbk1hdHJpeCApO1xuXHRcdGlmICggaXNQZXJzcGVjdGl2ZSApIGdsX1BvaW50U2l6ZSAqPSAoIHNjYWxlIC8gLSBtdlBvc2l0aW9uLnogKTtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKY29uc3QgZnJhZ21lbnQkMyA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSB2ZWMzKCAwLjAgKTtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9wYXJ0aWNsZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHRvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYjtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQyID0gIiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7Cgpjb25zdCBmcmFnbWVudCQyID0gInVuaWZvcm0gdmVjMyBjb2xvcjtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hc2tfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHRnbF9GcmFnQ29sb3IgPSB2ZWM0KCBjb2xvciwgb3BhY2l0eSAqICggMS4wIC0gZ2V0U2hhZG93TWFzaygpICkgKTtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbn0iOwoKY29uc3QgdmVydGV4JDEgPSAidW5pZm9ybSBmbG9hdCByb3RhdGlvbjtcbnVuaWZvcm0gdmVjMiBjZW50ZXI7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdHZlYzQgbXZQb3NpdGlvbiA9IG1vZGVsVmlld01hdHJpeCAqIHZlYzQoIDAuMCwgMC4wLCAwLjAsIDEuMCApO1xuXHR2ZWMyIHNjYWxlO1xuXHRzY2FsZS54ID0gbGVuZ3RoKCB2ZWMzKCBtb2RlbE1hdHJpeFsgMCBdLngsIG1vZGVsTWF0cml4WyAwIF0ueSwgbW9kZWxNYXRyaXhbIDAgXS56ICkgKTtcblx0c2NhbGUueSA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDEgXS54LCBtb2RlbE1hdHJpeFsgMSBdLnksIG1vZGVsTWF0cml4WyAxIF0ueiApICk7XG5cdCNpZm5kZWYgVVNFX1NJWkVBVFRFTlVBVElPTlxuXHRcdGJvb2wgaXNQZXJzcGVjdGl2ZSA9IGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKTtcblx0XHRpZiAoIGlzUGVyc3BlY3RpdmUgKSBzY2FsZSAqPSAtIG12UG9zaXRpb24uejtcblx0I2VuZGlmXG5cdHZlYzIgYWxpZ25lZFBvc2l0aW9uID0gKCBwb3NpdGlvbi54eSAtICggY2VudGVyIC0gdmVjMiggMC41ICkgKSApICogc2NhbGU7XG5cdHZlYzIgcm90YXRlZFBvc2l0aW9uO1xuXHRyb3RhdGVkUG9zaXRpb24ueCA9IGNvcyggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi54IC0gc2luKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnk7XG5cdHJvdGF0ZWRQb3NpdGlvbi55ID0gc2luKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnggKyBjb3MoIHJvdGF0aW9uICkgKiBhbGlnbmVkUG9zaXRpb24ueTtcblx0bXZQb3NpdGlvbi54eSArPSByb3RhdGVkUG9zaXRpb247XG5cdGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG12UG9zaXRpb247XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKY29uc3QgZnJhZ21lbnQkMSA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdG91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxufSI7Cgpjb25zdCBTaGFkZXJDaHVuayA9IHsKCWFscGhhaGFzaF9mcmFnbWVudDogYWxwaGFoYXNoX2ZyYWdtZW50LAoJYWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ6IGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50LAoJYWxwaGFtYXBfZnJhZ21lbnQ6IGFscGhhbWFwX2ZyYWdtZW50LAoJYWxwaGFtYXBfcGFyc19mcmFnbWVudDogYWxwaGFtYXBfcGFyc19mcmFnbWVudCwKCWFscGhhdGVzdF9mcmFnbWVudDogYWxwaGF0ZXN0X2ZyYWdtZW50LAoJYWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ6IGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50LAoJYW9tYXBfZnJhZ21lbnQ6IGFvbWFwX2ZyYWdtZW50LAoJYW9tYXBfcGFyc19mcmFnbWVudDogYW9tYXBfcGFyc19mcmFnbWVudCwKCWJhdGNoaW5nX3BhcnNfdmVydGV4OiBiYXRjaGluZ19wYXJzX3ZlcnRleCwKCWJhdGNoaW5nX3ZlcnRleDogYmF0Y2hpbmdfdmVydGV4LAoJYmVnaW5fdmVydGV4OiBiZWdpbl92ZXJ0ZXgsCgliZWdpbm5vcm1hbF92ZXJ0ZXg6IGJlZ2lubm9ybWFsX3ZlcnRleCwKCWJzZGZzOiBic2RmcywKCWlyaWRlc2NlbmNlX2ZyYWdtZW50OiBpcmlkZXNjZW5jZV9mcmFnbWVudCwKCWJ1bXBtYXBfcGFyc19mcmFnbWVudDogYnVtcG1hcF9wYXJzX2ZyYWdtZW50LAoJY2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50OiBjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQsCgljbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudDogY2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQsCgljbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg6IGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleCwKCWNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg6IGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXgsCgljb2xvcl9mcmFnbWVudDogY29sb3JfZnJhZ21lbnQsCgljb2xvcl9wYXJzX2ZyYWdtZW50OiBjb2xvcl9wYXJzX2ZyYWdtZW50LAoJY29sb3JfcGFyc192ZXJ0ZXg6IGNvbG9yX3BhcnNfdmVydGV4LAoJY29sb3JfdmVydGV4OiBjb2xvcl92ZXJ0ZXgsCgljb21tb246IGNvbW1vbiwKCWN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudDogY3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50LAoJZGVmYXVsdG5vcm1hbF92ZXJ0ZXg6IGRlZmF1bHRub3JtYWxfdmVydGV4LAoJZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4OiBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXgsCglkaXNwbGFjZW1lbnRtYXBfdmVydGV4OiBkaXNwbGFjZW1lbnRtYXBfdmVydGV4LAoJZW1pc3NpdmVtYXBfZnJhZ21lbnQ6IGVtaXNzaXZlbWFwX2ZyYWdtZW50LAoJZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudDogZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudCwKCWNvbG9yc3BhY2VfZnJhZ21lbnQ6IGNvbG9yc3BhY2VfZnJhZ21lbnQsCgljb2xvcnNwYWNlX3BhcnNfZnJhZ21lbnQ6IGNvbG9yc3BhY2VfcGFyc19mcmFnbWVudCwKCWVudm1hcF9mcmFnbWVudDogZW52bWFwX2ZyYWdtZW50LAoJZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50OiBlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQsCgllbnZtYXBfcGFyc19mcmFnbWVudDogZW52bWFwX3BhcnNfZnJhZ21lbnQsCgllbnZtYXBfcGFyc192ZXJ0ZXg6IGVudm1hcF9wYXJzX3ZlcnRleCwKCWVudm1hcF9waHlzaWNhbF9wYXJzX2ZyYWdtZW50OiBlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudCwKCWVudm1hcF92ZXJ0ZXg6IGVudm1hcF92ZXJ0ZXgsCglmb2dfdmVydGV4OiBmb2dfdmVydGV4LAoJZm9nX3BhcnNfdmVydGV4OiBmb2dfcGFyc192ZXJ0ZXgsCglmb2dfZnJhZ21lbnQ6IGZvZ19mcmFnbWVudCwKCWZvZ19wYXJzX2ZyYWdtZW50OiBmb2dfcGFyc19mcmFnbWVudCwKCWdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQ6IGdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQsCglsaWdodG1hcF9mcmFnbWVudDogbGlnaHRtYXBfZnJhZ21lbnQsCglsaWdodG1hcF9wYXJzX2ZyYWdtZW50OiBsaWdodG1hcF9wYXJzX2ZyYWdtZW50LAoJbGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQ6IGxpZ2h0c19sYW1iZXJ0X2ZyYWdtZW50LAoJbGlnaHRzX2xhbWJlcnRfcGFyc19mcmFnbWVudDogbGlnaHRzX2xhbWJlcnRfcGFyc19mcmFnbWVudCwKCWxpZ2h0c19wYXJzX2JlZ2luOiBsaWdodHNfcGFyc19iZWdpbiwKCWxpZ2h0c190b29uX2ZyYWdtZW50OiBsaWdodHNfdG9vbl9mcmFnbWVudCwKCWxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQsCglsaWdodHNfcGhvbmdfZnJhZ21lbnQ6IGxpZ2h0c19waG9uZ19mcmFnbWVudCwKCWxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50OiBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCwKCWxpZ2h0c19waHlzaWNhbF9mcmFnbWVudDogbGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50LAoJbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0c19waHlzaWNhbF9wYXJzX2ZyYWdtZW50LAoJbGlnaHRzX2ZyYWdtZW50X2JlZ2luOiBsaWdodHNfZnJhZ21lbnRfYmVnaW4sCglsaWdodHNfZnJhZ21lbnRfbWFwczogbGlnaHRzX2ZyYWdtZW50X21hcHMsCglsaWdodHNfZnJhZ21lbnRfZW5kOiBsaWdodHNfZnJhZ21lbnRfZW5kLAoJbG9nZGVwdGhidWZfZnJhZ21lbnQ6IGxvZ2RlcHRoYnVmX2ZyYWdtZW50LAoJbG9nZGVwdGhidWZfcGFyc19mcmFnbWVudDogbG9nZGVwdGhidWZfcGFyc19mcmFnbWVudCwKCWxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4OiBsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleCwKCWxvZ2RlcHRoYnVmX3ZlcnRleDogbG9nZGVwdGhidWZfdmVydGV4LAoJbWFwX2ZyYWdtZW50OiBtYXBfZnJhZ21lbnQsCgltYXBfcGFyc19mcmFnbWVudDogbWFwX3BhcnNfZnJhZ21lbnQsCgltYXBfcGFydGljbGVfZnJhZ21lbnQ6IG1hcF9wYXJ0aWNsZV9mcmFnbWVudCwKCW1hcF9wYXJ0aWNsZV9wYXJzX2ZyYWdtZW50OiBtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudCwKCW1ldGFsbmVzc21hcF9mcmFnbWVudDogbWV0YWxuZXNzbWFwX2ZyYWdtZW50LAoJbWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQ6IG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50LAoJbW9ycGhjb2xvcl92ZXJ0ZXg6IG1vcnBoY29sb3JfdmVydGV4LAoJbW9ycGhub3JtYWxfdmVydGV4OiBtb3JwaG5vcm1hbF92ZXJ0ZXgsCgltb3JwaHRhcmdldF9wYXJzX3ZlcnRleDogbW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXgsCgltb3JwaHRhcmdldF92ZXJ0ZXg6IG1vcnBodGFyZ2V0X3ZlcnRleCwKCW5vcm1hbF9mcmFnbWVudF9iZWdpbjogbm9ybWFsX2ZyYWdtZW50X2JlZ2luLAoJbm9ybWFsX2ZyYWdtZW50X21hcHM6IG5vcm1hbF9mcmFnbWVudF9tYXBzLAoJbm9ybWFsX3BhcnNfZnJhZ21lbnQ6IG5vcm1hbF9wYXJzX2ZyYWdtZW50LAoJbm9ybWFsX3BhcnNfdmVydGV4OiBub3JtYWxfcGFyc192ZXJ0ZXgsCglub3JtYWxfdmVydGV4OiBub3JtYWxfdmVydGV4LAoJbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ6IG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50LAoJY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbjogY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbiwKCWNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwczogY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9tYXBzLAoJY2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQ6IGNsZWFyY29hdF9wYXJzX2ZyYWdtZW50LAoJaXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudDogaXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudCwKCW9wYXF1ZV9mcmFnbWVudDogb3BhcXVlX2ZyYWdtZW50LAoJcGFja2luZzogcGFja2luZywKCXByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ6IHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQsCglwcm9qZWN0X3ZlcnRleDogcHJvamVjdF92ZXJ0ZXgsCglkaXRoZXJpbmdfZnJhZ21lbnQ6IGRpdGhlcmluZ19mcmFnbWVudCwKCWRpdGhlcmluZ19wYXJzX2ZyYWdtZW50OiBkaXRoZXJpbmdfcGFyc19mcmFnbWVudCwKCXJvdWdobmVzc21hcF9mcmFnbWVudDogcm91Z2huZXNzbWFwX2ZyYWdtZW50LAoJcm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQ6IHJvdWdobmVzc21hcF9wYXJzX2ZyYWdtZW50LAoJc2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ6IHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50LAoJc2hhZG93bWFwX3BhcnNfdmVydGV4OiBzaGFkb3dtYXBfcGFyc192ZXJ0ZXgsCglzaGFkb3dtYXBfdmVydGV4OiBzaGFkb3dtYXBfdmVydGV4LAoJc2hhZG93bWFza19wYXJzX2ZyYWdtZW50OiBzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQsCglza2luYmFzZV92ZXJ0ZXg6IHNraW5iYXNlX3ZlcnRleCwKCXNraW5uaW5nX3BhcnNfdmVydGV4OiBza2lubmluZ19wYXJzX3ZlcnRleCwKCXNraW5uaW5nX3ZlcnRleDogc2tpbm5pbmdfdmVydGV4LAoJc2tpbm5vcm1hbF92ZXJ0ZXg6IHNraW5ub3JtYWxfdmVydGV4LAoJc3BlY3VsYXJtYXBfZnJhZ21lbnQ6IHNwZWN1bGFybWFwX2ZyYWdtZW50LAoJc3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudDogc3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudCwKCXRvbmVtYXBwaW5nX2ZyYWdtZW50OiB0b25lbWFwcGluZ19mcmFnbWVudCwKCXRvbmVtYXBwaW5nX3BhcnNfZnJhZ21lbnQ6IHRvbmVtYXBwaW5nX3BhcnNfZnJhZ21lbnQsCgl0cmFuc21pc3Npb25fZnJhZ21lbnQ6IHRyYW5zbWlzc2lvbl9mcmFnbWVudCwKCXRyYW5zbWlzc2lvbl9wYXJzX2ZyYWdtZW50OiB0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudCwKCXV2X3BhcnNfZnJhZ21lbnQ6IHV2X3BhcnNfZnJhZ21lbnQsCgl1dl9wYXJzX3ZlcnRleDogdXZfcGFyc192ZXJ0ZXgsCgl1dl92ZXJ0ZXg6IHV2X3ZlcnRleCwKCXdvcmxkcG9zX3ZlcnRleDogd29ybGRwb3NfdmVydGV4LAoKCWJhY2tncm91bmRfdmVydDogdmVydGV4JGgsCgliYWNrZ3JvdW5kX2ZyYWc6IGZyYWdtZW50JGgsCgliYWNrZ3JvdW5kQ3ViZV92ZXJ0OiB2ZXJ0ZXgkZywKCWJhY2tncm91bmRDdWJlX2ZyYWc6IGZyYWdtZW50JGcsCgljdWJlX3ZlcnQ6IHZlcnRleCRmLAoJY3ViZV9mcmFnOiBmcmFnbWVudCRmLAoJZGVwdGhfdmVydDogdmVydGV4JGUsCglkZXB0aF9mcmFnOiBmcmFnbWVudCRlLAoJZGlzdGFuY2VSR0JBX3ZlcnQ6IHZlcnRleCRkLAoJZGlzdGFuY2VSR0JBX2ZyYWc6IGZyYWdtZW50JGQsCgllcXVpcmVjdF92ZXJ0OiB2ZXJ0ZXgkYywKCWVxdWlyZWN0X2ZyYWc6IGZyYWdtZW50JGMsCglsaW5lZGFzaGVkX3ZlcnQ6IHZlcnRleCRiLAoJbGluZWRhc2hlZF9mcmFnOiBmcmFnbWVudCRiLAoJbWVzaGJhc2ljX3ZlcnQ6IHZlcnRleCRhLAoJbWVzaGJhc2ljX2ZyYWc6IGZyYWdtZW50JGEsCgltZXNobGFtYmVydF92ZXJ0OiB2ZXJ0ZXgkOSwKCW1lc2hsYW1iZXJ0X2ZyYWc6IGZyYWdtZW50JDksCgltZXNobWF0Y2FwX3ZlcnQ6IHZlcnRleCQ4LAoJbWVzaG1hdGNhcF9mcmFnOiBmcmFnbWVudCQ4LAoJbWVzaG5vcm1hbF92ZXJ0OiB2ZXJ0ZXgkNywKCW1lc2hub3JtYWxfZnJhZzogZnJhZ21lbnQkNywKCW1lc2hwaG9uZ192ZXJ0OiB2ZXJ0ZXgkNiwKCW1lc2hwaG9uZ19mcmFnOiBmcmFnbWVudCQ2LAoJbWVzaHBoeXNpY2FsX3ZlcnQ6IHZlcnRleCQ1LAoJbWVzaHBoeXNpY2FsX2ZyYWc6IGZyYWdtZW50JDUsCgltZXNodG9vbl92ZXJ0OiB2ZXJ0ZXgkNCwKCW1lc2h0b29uX2ZyYWc6IGZyYWdtZW50JDQsCglwb2ludHNfdmVydDogdmVydGV4JDMsCglwb2ludHNfZnJhZzogZnJhZ21lbnQkMywKCXNoYWRvd192ZXJ0OiB2ZXJ0ZXgkMiwKCXNoYWRvd19mcmFnOiBmcmFnbWVudCQyLAoJc3ByaXRlX3ZlcnQ6IHZlcnRleCQxLAoJc3ByaXRlX2ZyYWc6IGZyYWdtZW50JDEKfTsKCi8qKgogKiBVbmlmb3JtcyBsaWJyYXJ5IGZvciBzaGFyZWQgd2ViZ2wgc2hhZGVycwogKi8KCmNvbnN0IFVuaWZvcm1zTGliID0gewoKCWNvbW1vbjogewoKCQlkaWZmdXNlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHhmZmZmZmYgKSB9LAoJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoKCQltYXA6IHsgdmFsdWU6IG51bGwgfSwKCQltYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoKCQlhbHBoYU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCWFscGhhTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCgkJYWxwaGFUZXN0OiB7IHZhbHVlOiAwIH0KCgl9LAoKCXNwZWN1bGFybWFwOiB7CgoJCXNwZWN1bGFyTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJc3BlY3VsYXJNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJfSwKCgllbnZtYXA6IHsKCgkJZW52TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJZmxpcEVudk1hcDogeyB2YWx1ZTogLSAxIH0sCgkJcmVmbGVjdGl2aXR5OiB7IHZhbHVlOiAxLjAgfSwgLy8gYmFzaWMsIGxhbWJlcnQsIHBob25nCgkJaW9yOiB7IHZhbHVlOiAxLjUgfSwgLy8gcGh5c2ljYWwKCQlyZWZyYWN0aW9uUmF0aW86IHsgdmFsdWU6IDAuOTggfSwgLy8gYmFzaWMsIGxhbWJlcnQsIHBob25nCgoJfSwKCglhb21hcDogewoKCQlhb01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCWFvTWFwSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0sCgkJYW9NYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJfSwKCglsaWdodG1hcDogewoKCQlsaWdodE1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCWxpZ2h0TWFwSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0sCgkJbGlnaHRNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJfSwKCglidW1wbWFwOiB7CgoJCWJ1bXBNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQlidW1wTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQlidW1wU2NhbGU6IHsgdmFsdWU6IDEgfQoKCX0sCgoJbm9ybWFsbWFwOiB7CgoJCW5vcm1hbE1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCW5vcm1hbE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJbm9ybWFsU2NhbGU6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoIDEsIDEgKSB9CgoJfSwKCglkaXNwbGFjZW1lbnRtYXA6IHsKCgkJZGlzcGxhY2VtZW50TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJZGlzcGxhY2VtZW50TWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQlkaXNwbGFjZW1lbnRTY2FsZTogeyB2YWx1ZTogMSB9LAoJCWRpc3BsYWNlbWVudEJpYXM6IHsgdmFsdWU6IDAgfQoKCX0sCgoJZW1pc3NpdmVtYXA6IHsKCgkJZW1pc3NpdmVNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQllbWlzc2l2ZU1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCgl9LAoKCW1ldGFsbmVzc21hcDogewoKCQltZXRhbG5lc3NNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQltZXRhbG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJfSwKCglyb3VnaG5lc3NtYXA6IHsKCgkJcm91Z2huZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJcm91Z2huZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKCX0sCgoJZ3JhZGllbnRtYXA6IHsKCgkJZ3JhZGllbnRNYXA6IHsgdmFsdWU6IG51bGwgfQoKCX0sCgoJZm9nOiB7CgoJCWZvZ0RlbnNpdHk6IHsgdmFsdWU6IDAuMDAwMjUgfSwKCQlmb2dOZWFyOiB7IHZhbHVlOiAxIH0sCgkJZm9nRmFyOiB7IHZhbHVlOiAyMDAwIH0sCgkJZm9nQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0KCgl9LAoKCWxpZ2h0czogewoKCQlhbWJpZW50TGlnaHRDb2xvcjogeyB2YWx1ZTogW10gfSwKCgkJbGlnaHRQcm9iZTogeyB2YWx1ZTogW10gfSwKCgkJZGlyZWN0aW9uYWxMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCWRpcmVjdGlvbjoge30sCgkJCWNvbG9yOiB7fQoJCX0gfSwKCgkJZGlyZWN0aW9uYWxMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCXNoYWRvd0JpYXM6IHt9LAoJCQlzaGFkb3dOb3JtYWxCaWFzOiB7fSwKCQkJc2hhZG93UmFkaXVzOiB7fSwKCQkJc2hhZG93TWFwU2l6ZToge30KCQl9IH0sCgoJCWRpcmVjdGlvbmFsU2hhZG93TWFwOiB7IHZhbHVlOiBbXSB9LAoJCWRpcmVjdGlvbmFsU2hhZG93TWF0cml4OiB7IHZhbHVlOiBbXSB9LAoKCQlzcG90TGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQljb2xvcjoge30sCgkJCXBvc2l0aW9uOiB7fSwKCQkJZGlyZWN0aW9uOiB7fSwKCQkJZGlzdGFuY2U6IHt9LAoJCQljb25lQ29zOiB7fSwKCQkJcGVudW1icmFDb3M6IHt9LAoJCQlkZWNheToge30KCQl9IH0sCgoJCXNwb3RMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCXNoYWRvd0JpYXM6IHt9LAoJCQlzaGFkb3dOb3JtYWxCaWFzOiB7fSwKCQkJc2hhZG93UmFkaXVzOiB7fSwKCQkJc2hhZG93TWFwU2l6ZToge30KCQl9IH0sCgoJCXNwb3RMaWdodE1hcDogeyB2YWx1ZTogW10gfSwKCQlzcG90U2hhZG93TWFwOiB7IHZhbHVlOiBbXSB9LAoJCXNwb3RMaWdodE1hdHJpeDogeyB2YWx1ZTogW10gfSwKCgkJcG9pbnRMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCWNvbG9yOiB7fSwKCQkJcG9zaXRpb246IHt9LAoJCQlkZWNheToge30sCgkJCWRpc3RhbmNlOiB7fQoJCX0gfSwKCgkJcG9pbnRMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCXNoYWRvd0JpYXM6IHt9LAoJCQlzaGFkb3dOb3JtYWxCaWFzOiB7fSwKCQkJc2hhZG93UmFkaXVzOiB7fSwKCQkJc2hhZG93TWFwU2l6ZToge30sCgkJCXNoYWRvd0NhbWVyYU5lYXI6IHt9LAoJCQlzaGFkb3dDYW1lcmFGYXI6IHt9CgkJfSB9LAoKCQlwb2ludFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKCQlwb2ludFNoYWRvd01hdHJpeDogeyB2YWx1ZTogW10gfSwKCgkJaGVtaXNwaGVyZUxpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKCQkJZGlyZWN0aW9uOiB7fSwKCQkJc2t5Q29sb3I6IHt9LAoJCQlncm91bmRDb2xvcjoge30KCQl9IH0sCgoJCS8vIFRPRE8gKGFiZWxuYXRpb24pOiBSZWN0QXJlYUxpZ2h0IEJSREYgZGF0YSBuZWVkcyB0byBiZSBtb3ZlZCBmcm9tIGV4YW1wbGUgdG8gbWFpbiBzcmMKCQlyZWN0QXJlYUxpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKCQkJY29sb3I6IHt9LAoJCQlwb3NpdGlvbjoge30sCgkJCXdpZHRoOiB7fSwKCQkJaGVpZ2h0OiB7fQoJCX0gfSwKCgkJbHRjXzE6IHsgdmFsdWU6IG51bGwgfSwKCQlsdGNfMjogeyB2YWx1ZTogbnVsbCB9CgoJfSwKCglwb2ludHM6IHsKCgkJZGlmZnVzZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4ZmZmZmZmICkgfSwKCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfSwKCQlzaXplOiB7IHZhbHVlOiAxLjAgfSwKCQlzY2FsZTogeyB2YWx1ZTogMS4wIH0sCgkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJYWxwaGFNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQlhbHBoYU1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJYWxwaGFUZXN0OiB7IHZhbHVlOiAwIH0sCgkJdXZUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJfSwKCglzcHJpdGU6IHsKCgkJZGlmZnVzZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4ZmZmZmZmICkgfSwKCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfSwKCQljZW50ZXI6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoIDAuNSwgMC41ICkgfSwKCQlyb3RhdGlvbjogeyB2YWx1ZTogMC4wIH0sCgkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJbWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQlhbHBoYU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCWFscGhhTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfQoKCX0KCn07Cgpjb25zdCBTaGFkZXJMaWIgPSB7CgoJYmFzaWM6IHsKCgkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCVVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAoJCQlVbmlmb3Jtc0xpYi5lbnZtYXAsCgkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJVW5pZm9ybXNMaWIuZm9nCgkJXSApLAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hiYXNpY192ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNoYmFzaWNfZnJhZwoKCX0sCgoJbGFtYmVydDogewoKCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJVW5pZm9ybXNMaWIuc3BlY3VsYXJtYXAsCgkJCVVuaWZvcm1zTGliLmVudm1hcCwKCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCVVuaWZvcm1zTGliLmxpZ2h0bWFwLAoJCQlVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJVW5pZm9ybXNMaWIubm9ybWFsbWFwLAoJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCVVuaWZvcm1zTGliLmZvZywKCQkJVW5pZm9ybXNMaWIubGlnaHRzLAoJCQl7CgkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfQoJCQl9CgkJXSApLAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hsYW1iZXJ0X3ZlcnQsCgkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hsYW1iZXJ0X2ZyYWcKCgl9LAoKCXBob25nOiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQlVbmlmb3Jtc0xpYi5zcGVjdWxhcm1hcCwKCQkJVW5pZm9ybXNMaWIuZW52bWFwLAoJCQlVbmlmb3Jtc0xpYi5hb21hcCwKCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCgkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAoJCQlVbmlmb3Jtc0xpYi5idW1wbWFwLAoJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJVW5pZm9ybXNMaWIuZm9nLAoJCQlVbmlmb3Jtc0xpYi5saWdodHMsCgkJCXsKCQkJCWVtaXNzaXZlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHgwMDAwMDAgKSB9LAoJCQkJc3BlY3VsYXI6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDExMTExMSApIH0sCgkJCQlzaGluaW5lc3M6IHsgdmFsdWU6IDMwIH0KCQkJfQoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGhvbmdfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBob25nX2ZyYWcKCgl9LAoKCXN0YW5kYXJkOiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQlVbmlmb3Jtc0xpYi5lbnZtYXAsCgkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJVW5pZm9ybXNMaWIuZW1pc3NpdmVtYXAsCgkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQlVbmlmb3Jtc0xpYi5yb3VnaG5lc3NtYXAsCgkJCVVuaWZvcm1zTGliLm1ldGFsbmVzc21hcCwKCQkJVW5pZm9ybXNMaWIuZm9nLAoJCQlVbmlmb3Jtc0xpYi5saWdodHMsCgkJCXsKCQkJCWVtaXNzaXZlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHgwMDAwMDAgKSB9LAoJCQkJcm91Z2huZXNzOiB7IHZhbHVlOiAxLjAgfSwKCQkJCW1ldGFsbmVzczogeyB2YWx1ZTogMC4wIH0sCgkJCQllbnZNYXBJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfSAvLyB0ZW1wb3JhcnkKCQkJfQoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBoeXNpY2FsX2ZyYWcKCgl9LAoKCXRvb246IHsKCgkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJVW5pZm9ybXNMaWIuZW1pc3NpdmVtYXAsCgkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQlVbmlmb3Jtc0xpYi5ncmFkaWVudG1hcCwKCQkJVW5pZm9ybXNMaWIuZm9nLAoJCQlVbmlmb3Jtc0xpYi5saWdodHMsCgkJCXsKCQkJCWVtaXNzaXZlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHgwMDAwMDAgKSB9CgkJCX0KCQldICksCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHRvb25fdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHRvb25fZnJhZwoKCX0sCgoJbWF0Y2FwOiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQlVbmlmb3Jtc0xpYi5idW1wbWFwLAoJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJVW5pZm9ybXNMaWIuZm9nLAoJCQl7CgkJCQltYXRjYXA6IHsgdmFsdWU6IG51bGwgfQoJCQl9CgkJXSApLAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2htYXRjYXBfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaG1hdGNhcF9mcmFnCgoJfSwKCglwb2ludHM6IHsKCgkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQlVbmlmb3Jtc0xpYi5wb2ludHMsCgkJCVVuaWZvcm1zTGliLmZvZwoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5wb2ludHNfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsucG9pbnRzX2ZyYWcKCgl9LAoKCWRhc2hlZDogewoKCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJVW5pZm9ybXNMaWIuZm9nLAoJCQl7CgkJCQlzY2FsZTogeyB2YWx1ZTogMSB9LAoJCQkJZGFzaFNpemU6IHsgdmFsdWU6IDEgfSwKCQkJCXRvdGFsU2l6ZTogeyB2YWx1ZTogMiB9CgkJCX0KCQldICksCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubGluZWRhc2hlZF92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5saW5lZGFzaGVkX2ZyYWcKCgl9LAoKCWRlcHRoOiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAKCQldICksCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuZGVwdGhfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZGVwdGhfZnJhZwoKCX0sCgoJbm9ybWFsOiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQlVbmlmb3Jtc0xpYi5idW1wbWFwLAoJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJewoJCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KCQkJfQoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobm9ybWFsX3ZlcnQsCgkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hub3JtYWxfZnJhZwoKCX0sCgoJc3ByaXRlOiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIuc3ByaXRlLAoJCQlVbmlmb3Jtc0xpYi5mb2cKCQldICksCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuc3ByaXRlX3ZlcnQsCgkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLnNwcml0ZV9mcmFnCgoJfSwKCgliYWNrZ3JvdW5kOiB7CgoJCXVuaWZvcm1zOiB7CgkJCXV2VHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJdDJEOiB7IHZhbHVlOiBudWxsIH0sCgkJCWJhY2tncm91bmRJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfQoJCX0sCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuYmFja2dyb3VuZF92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kX2ZyYWcKCgl9LAoKCWJhY2tncm91bmRDdWJlOiB7CgoJCXVuaWZvcm1zOiB7CgkJCWVudk1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlmbGlwRW52TWFwOiB7IHZhbHVlOiAtIDEgfSwKCQkJYmFja2dyb3VuZEJsdXJyaW5lc3M6IHsgdmFsdWU6IDAgfSwKCQkJYmFja2dyb3VuZEludGVuc2l0eTogeyB2YWx1ZTogMSB9CgkJfSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kQ3ViZV92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kQ3ViZV9mcmFnCgoJfSwKCgljdWJlOiB7CgoJCXVuaWZvcm1zOiB7CgkJCXRDdWJlOiB7IHZhbHVlOiBudWxsIH0sCgkJCXRGbGlwOiB7IHZhbHVlOiAtIDEgfSwKCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KCQl9LAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmN1YmVfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuY3ViZV9mcmFnCgoJfSwKCgllcXVpcmVjdDogewoKCQl1bmlmb3JtczogewoJCQl0RXF1aXJlY3Q6IHsgdmFsdWU6IG51bGwgfSwKCQl9LAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmVxdWlyZWN0X3ZlcnQsCgkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmVxdWlyZWN0X2ZyYWcKCgl9LAoKCWRpc3RhbmNlUkdCQTogewoKCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQl7CgkJCQlyZWZlcmVuY2VQb3NpdGlvbjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpIH0sCgkJCQluZWFyRGlzdGFuY2U6IHsgdmFsdWU6IDEgfSwKCQkJCWZhckRpc3RhbmNlOiB7IHZhbHVlOiAxMDAwIH0KCQkJfQoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5kaXN0YW5jZVJHQkFfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZGlzdGFuY2VSR0JBX2ZyYWcKCgl9LAoKCXNoYWRvdzogewoKCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJVW5pZm9ybXNMaWIuZm9nLAoJCQl7CgkJCQljb2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAgKSB9LAoJCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KCQkJfSwKCQldICksCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuc2hhZG93X3ZlcnQsCgkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLnNoYWRvd19mcmFnCgoJfQoKfTsKClNoYWRlckxpYi5waHlzaWNhbCA9IHsKCgl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJU2hhZGVyTGliLnN0YW5kYXJkLnVuaWZvcm1zLAoJCXsKCQkJY2xlYXJjb2F0OiB7IHZhbHVlOiAwIH0sCgkJCWNsZWFyY29hdE1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQljbGVhcmNvYXRNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQljbGVhcmNvYXROb3JtYWxNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJY2xlYXJjb2F0Tm9ybWFsTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJY2xlYXJjb2F0Tm9ybWFsU2NhbGU6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoIDEsIDEgKSB9LAoJCQljbGVhcmNvYXRSb3VnaG5lc3M6IHsgdmFsdWU6IDAgfSwKCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWNsZWFyY29hdFJvdWdobmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCWlyaWRlc2NlbmNlOiB7IHZhbHVlOiAwIH0sCgkJCWlyaWRlc2NlbmNlTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWlyaWRlc2NlbmNlTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJaXJpZGVzY2VuY2VJT1I6IHsgdmFsdWU6IDEuMyB9LAoJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW06IHsgdmFsdWU6IDEwMCB9LAoJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW06IHsgdmFsdWU6IDQwMCB9LAoJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCXNoZWVuOiB7IHZhbHVlOiAwIH0sCgkJCXNoZWVuQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCXNoZWVuQ29sb3JNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJc2hlZW5Db2xvck1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCXNoZWVuUm91Z2huZXNzOiB7IHZhbHVlOiAxIH0sCgkJCXNoZWVuUm91Z2huZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCXNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJdHJhbnNtaXNzaW9uOiB7IHZhbHVlOiAwIH0sCgkJCXRyYW5zbWlzc2lvbk1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQl0cmFuc21pc3Npb25NYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQl0cmFuc21pc3Npb25TYW1wbGVyU2l6ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpIH0sCgkJCXRyYW5zbWlzc2lvblNhbXBsZXJNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJdGhpY2tuZXNzOiB7IHZhbHVlOiAwIH0sCgkJCXRoaWNrbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQl0aGlja25lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQlhdHRlbnVhdGlvbkRpc3RhbmNlOiB7IHZhbHVlOiAwIH0sCgkJCWF0dGVudWF0aW9uQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCXNwZWN1bGFyQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAxLCAxLCAxICkgfSwKCQkJc3BlY3VsYXJDb2xvck1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJc3BlY3VsYXJJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfSwKCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQlhbmlzb3Ryb3B5VmVjdG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCkgfSwKCQkJYW5pc290cm9weU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQl9CgldICksCgoJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfdmVydCwKCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfZnJhZwoKfTsKCmNvbnN0IF9yZ2IgPSB7IHI6IDAsIGI6IDAsIGc6IDAgfTsKCmZ1bmN0aW9uIFdlYkdMQmFja2dyb3VuZCggcmVuZGVyZXIsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBzdGF0ZSwgb2JqZWN0cywgYWxwaGEsIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCgljb25zdCBjbGVhckNvbG9yID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwoJbGV0IGNsZWFyQWxwaGEgPSBhbHBoYSA9PT0gdHJ1ZSA/IDAgOiAxOwoKCWxldCBwbGFuZU1lc2g7CglsZXQgYm94TWVzaDsKCglsZXQgY3VycmVudEJhY2tncm91bmQgPSBudWxsOwoJbGV0IGN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IDA7CglsZXQgY3VycmVudFRvbmVtYXBwaW5nID0gbnVsbDsKCglmdW5jdGlvbiByZW5kZXIoIHJlbmRlckxpc3QsIHNjZW5lICkgewoKCQlsZXQgZm9yY2VDbGVhciA9IGZhbHNlOwoJCWxldCBiYWNrZ3JvdW5kID0gc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSA/IHNjZW5lLmJhY2tncm91bmQgOiBudWxsOwoKCQlpZiAoIGJhY2tncm91bmQgJiYgYmFja2dyb3VuZC5pc1RleHR1cmUgKSB7CgoJCQljb25zdCB1c2VQTVJFTSA9IHNjZW5lLmJhY2tncm91bmRCbHVycmluZXNzID4gMDsgLy8gdXNlIFBNUkVNIGlmIHRoZSB1c2VyIHdhbnRzIHRvIGJsdXIgdGhlIGJhY2tncm91bmQKCQkJYmFja2dyb3VuZCA9ICggdXNlUE1SRU0gPyBjdWJldXZtYXBzIDogY3ViZW1hcHMgKS5nZXQoIGJhY2tncm91bmQgKTsKCgkJfQoKCQlpZiAoIGJhY2tncm91bmQgPT09IG51bGwgKSB7CgoJCQlzZXRDbGVhciggY2xlYXJDb2xvciwgY2xlYXJBbHBoYSApOwoKCQl9IGVsc2UgaWYgKCBiYWNrZ3JvdW5kICYmIGJhY2tncm91bmQuaXNDb2xvciApIHsKCgkJCXNldENsZWFyKCBiYWNrZ3JvdW5kLCAxICk7CgkJCWZvcmNlQ2xlYXIgPSB0cnVlOwoKCQl9CgoJCWNvbnN0IGVudmlyb25tZW50QmxlbmRNb2RlID0gcmVuZGVyZXIueHIuZ2V0RW52aXJvbm1lbnRCbGVuZE1vZGUoKTsKCgkJaWYgKCBlbnZpcm9ubWVudEJsZW5kTW9kZSA9PT0gJ2FkZGl0aXZlJyApIHsKCgkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0Q2xlYXIoIDAsIDAsIDAsIDEsIHByZW11bHRpcGxpZWRBbHBoYSApOwoKCQl9IGVsc2UgaWYgKCBlbnZpcm9ubWVudEJsZW5kTW9kZSA9PT0gJ2FscGhhLWJsZW5kJyApIHsKCgkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0Q2xlYXIoIDAsIDAsIDAsIDAsIHByZW11bHRpcGxpZWRBbHBoYSApOwoKCQl9CgoJCWlmICggcmVuZGVyZXIuYXV0b0NsZWFyIHx8IGZvcmNlQ2xlYXIgKSB7CgoJCQlyZW5kZXJlci5jbGVhciggcmVuZGVyZXIuYXV0b0NsZWFyQ29sb3IsIHJlbmRlcmVyLmF1dG9DbGVhckRlcHRoLCByZW5kZXJlci5hdXRvQ2xlYXJTdGVuY2lsICk7CgoJCX0KCgkJaWYgKCBiYWNrZ3JvdW5kICYmICggYmFja2dyb3VuZC5pc0N1YmVUZXh0dXJlIHx8IGJhY2tncm91bmQubWFwcGluZyA9PT0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgKSApIHsKCgkJCWlmICggYm94TWVzaCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWJveE1lc2ggPSBuZXcgTWVzaCgKCQkJCQluZXcgQm94R2VvbWV0cnkoIDEsIDEsIDEgKSwKCQkJCQluZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCQkJCQkJbmFtZTogJ0JhY2tncm91bmRDdWJlTWF0ZXJpYWwnLAoJCQkJCQl1bmlmb3JtczogY2xvbmVVbmlmb3JtcyggU2hhZGVyTGliLmJhY2tncm91bmRDdWJlLnVuaWZvcm1zICksCgkJCQkJCXZlcnRleFNoYWRlcjogU2hhZGVyTGliLmJhY2tncm91bmRDdWJlLnZlcnRleFNoYWRlciwKCQkJCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckxpYi5iYWNrZ3JvdW5kQ3ViZS5mcmFnbWVudFNoYWRlciwKCQkJCQkJc2lkZTogQmFja1NpZGUsCgkJCQkJCWRlcHRoVGVzdDogZmFsc2UsCgkJCQkJCWRlcHRoV3JpdGU6IGZhbHNlLAoJCQkJCQlmb2c6IGZhbHNlCgkJCQkJfSApCgkJCQkpOwoKCQkJCWJveE1lc2guZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAnbm9ybWFsJyApOwoJCQkJYm94TWVzaC5nZW9tZXRyeS5kZWxldGVBdHRyaWJ1dGUoICd1dicgKTsKCgkJCQlib3hNZXNoLm9uQmVmb3JlUmVuZGVyID0gZnVuY3Rpb24gKCByZW5kZXJlciwgc2NlbmUsIGNhbWVyYSApIHsKCgkJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5UG9zaXRpb24oIGNhbWVyYS5tYXRyaXhXb3JsZCApOwoKCQkJCX07CgoJCQkJLy8gYWRkICJlbnZNYXAiIG1hdGVyaWFsIHByb3BlcnR5IHNvIHRoZSByZW5kZXJlciBjYW4gZXZhbHVhdGUgaXQgbGlrZSBmb3IgYnVpbHQtaW4gbWF0ZXJpYWxzCgkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIGJveE1lc2gubWF0ZXJpYWwsICdlbnZNYXAnLCB7CgoJCQkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCQkJcmV0dXJuIHRoaXMudW5pZm9ybXMuZW52TWFwLnZhbHVlOwoKCQkJCQl9CgoJCQkJfSApOwoKCQkJCW9iamVjdHMudXBkYXRlKCBib3hNZXNoICk7CgoJCQl9CgoJCQlib3hNZXNoLm1hdGVyaWFsLnVuaWZvcm1zLmVudk1hcC52YWx1ZSA9IGJhY2tncm91bmQ7CgkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9ICggYmFja2dyb3VuZC5pc0N1YmVUZXh0dXJlICYmIGJhY2tncm91bmQuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLSAxIDogMTsKCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcy52YWx1ZSA9IHNjZW5lLmJhY2tncm91bmRCbHVycmluZXNzOwoJCQlib3hNZXNoLm1hdGVyaWFsLnVuaWZvcm1zLmJhY2tncm91bmRJbnRlbnNpdHkudmFsdWUgPSBzY2VuZS5iYWNrZ3JvdW5kSW50ZW5zaXR5OwoJCQlib3hNZXNoLm1hdGVyaWFsLnRvbmVNYXBwZWQgPSBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIGJhY2tncm91bmQuY29sb3JTcGFjZSApICE9PSBTUkdCVHJhbnNmZXI7CgoJCQlpZiAoIGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8CgkJCQljdXJyZW50QmFja2dyb3VuZFZlcnNpb24gIT09IGJhY2tncm91bmQudmVyc2lvbiB8fAoJCQkJY3VycmVudFRvbmVtYXBwaW5nICE9PSByZW5kZXJlci50b25lTWFwcGluZyApIHsKCgkJCQlib3hNZXNoLm1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQljdXJyZW50QmFja2dyb3VuZCA9IGJhY2tncm91bmQ7CgkJCQljdXJyZW50QmFja2dyb3VuZFZlcnNpb24gPSBiYWNrZ3JvdW5kLnZlcnNpb247CgkJCQljdXJyZW50VG9uZW1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCgkJCX0KCgkJCWJveE1lc2gubGF5ZXJzLmVuYWJsZUFsbCgpOwoKCQkJLy8gcHVzaCB0byB0aGUgcHJlLXNvcnRlZCBvcGFxdWUgcmVuZGVyIGxpc3QKCQkJcmVuZGVyTGlzdC51bnNoaWZ0KCBib3hNZXNoLCBib3hNZXNoLmdlb21ldHJ5LCBib3hNZXNoLm1hdGVyaWFsLCAwLCAwLCBudWxsICk7CgoJCX0gZWxzZSBpZiAoIGJhY2tncm91bmQgJiYgYmFja2dyb3VuZC5pc1RleHR1cmUgKSB7CgoJCQlpZiAoIHBsYW5lTWVzaCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCXBsYW5lTWVzaCA9IG5ldyBNZXNoKAoJCQkJCW5ldyBQbGFuZUdlb21ldHJ5KCAyLCAyICksCgkJCQkJbmV3IFNoYWRlck1hdGVyaWFsKCB7CgkJCQkJCW5hbWU6ICdCYWNrZ3JvdW5kTWF0ZXJpYWwnLAoJCQkJCQl1bmlmb3JtczogY2xvbmVVbmlmb3JtcyggU2hhZGVyTGliLmJhY2tncm91bmQudW5pZm9ybXMgKSwKCQkJCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZC52ZXJ0ZXhTaGFkZXIsCgkJCQkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZC5mcmFnbWVudFNoYWRlciwKCQkJCQkJc2lkZTogRnJvbnRTaWRlLAoJCQkJCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCQkJCQlkZXB0aFdyaXRlOiBmYWxzZSwKCQkJCQkJZm9nOiBmYWxzZQoJCQkJCX0gKQoJCQkJKTsKCgkJCQlwbGFuZU1lc2guZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAnbm9ybWFsJyApOwoKCQkJCS8vIGFkZCAibWFwIiBtYXRlcmlhbCBwcm9wZXJ0eSBzbyB0aGUgcmVuZGVyZXIgY2FuIGV2YWx1YXRlIGl0IGxpa2UgZm9yIGJ1aWx0LWluIG1hdGVyaWFscwoJCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCBwbGFuZU1lc2gubWF0ZXJpYWwsICdtYXAnLCB7CgoJCQkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCQkJcmV0dXJuIHRoaXMudW5pZm9ybXMudDJELnZhbHVlOwoKCQkJCQl9CgoJCQkJfSApOwoKCQkJCW9iamVjdHMudXBkYXRlKCBwbGFuZU1lc2ggKTsKCgkJCX0KCgkJCXBsYW5lTWVzaC5tYXRlcmlhbC51bmlmb3Jtcy50MkQudmFsdWUgPSBiYWNrZ3JvdW5kOwoJCQlwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMuYmFja2dyb3VuZEludGVuc2l0eS52YWx1ZSA9IHNjZW5lLmJhY2tncm91bmRJbnRlbnNpdHk7CgkJCXBsYW5lTWVzaC5tYXRlcmlhbC50b25lTWFwcGVkID0gQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBiYWNrZ3JvdW5kLmNvbG9yU3BhY2UgKSAhPT0gU1JHQlRyYW5zZmVyOwoKCQkJaWYgKCBiYWNrZ3JvdW5kLm1hdHJpeEF1dG9VcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJYmFja2dyb3VuZC51cGRhdGVNYXRyaXgoKTsKCgkJCX0KCgkJCXBsYW5lTWVzaC5tYXRlcmlhbC51bmlmb3Jtcy51dlRyYW5zZm9ybS52YWx1ZS5jb3B5KCBiYWNrZ3JvdW5kLm1hdHJpeCApOwoKCQkJaWYgKCBjdXJyZW50QmFja2dyb3VuZCAhPT0gYmFja2dyb3VuZCB8fAoJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uICE9PSBiYWNrZ3JvdW5kLnZlcnNpb24gfHwKCQkJCWN1cnJlbnRUb25lbWFwcGluZyAhPT0gcmVuZGVyZXIudG9uZU1hcHBpbmcgKSB7CgoJCQkJcGxhbmVNZXNoLm1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQljdXJyZW50QmFja2dyb3VuZCA9IGJhY2tncm91bmQ7CgkJCQljdXJyZW50QmFja2dyb3VuZFZlcnNpb24gPSBiYWNrZ3JvdW5kLnZlcnNpb247CgkJCQljdXJyZW50VG9uZW1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCgkJCX0KCgkJCXBsYW5lTWVzaC5sYXllcnMuZW5hYmxlQWxsKCk7CgoJCQkvLyBwdXNoIHRvIHRoZSBwcmUtc29ydGVkIG9wYXF1ZSByZW5kZXIgbGlzdAoJCQlyZW5kZXJMaXN0LnVuc2hpZnQoIHBsYW5lTWVzaCwgcGxhbmVNZXNoLmdlb21ldHJ5LCBwbGFuZU1lc2gubWF0ZXJpYWwsIDAsIDAsIG51bGwgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRDbGVhciggY29sb3IsIGFscGhhICkgewoKCQljb2xvci5nZXRSR0IoIF9yZ2IsIGdldFVubGl0VW5pZm9ybUNvbG9yU3BhY2UoIHJlbmRlcmVyICkgKTsKCgkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhciggX3JnYi5yLCBfcmdiLmcsIF9yZ2IuYiwgYWxwaGEsIHByZW11bHRpcGxpZWRBbHBoYSApOwoKCX0KCglyZXR1cm4gewoKCQlnZXRDbGVhckNvbG9yOiBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gY2xlYXJDb2xvcjsKCgkJfSwKCQlzZXRDbGVhckNvbG9yOiBmdW5jdGlvbiAoIGNvbG9yLCBhbHBoYSA9IDEgKSB7CgoJCQljbGVhckNvbG9yLnNldCggY29sb3IgKTsKCQkJY2xlYXJBbHBoYSA9IGFscGhhOwoJCQlzZXRDbGVhciggY2xlYXJDb2xvciwgY2xlYXJBbHBoYSApOwoKCQl9LAoJCWdldENsZWFyQWxwaGE6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBjbGVhckFscGhhOwoKCQl9LAoJCXNldENsZWFyQWxwaGE6IGZ1bmN0aW9uICggYWxwaGEgKSB7CgoJCQljbGVhckFscGhhID0gYWxwaGE7CgkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgoJCX0sCgkJcmVuZGVyOiByZW5kZXIKCgl9OwoKfQoKZnVuY3Rpb24gV2ViR0xCaW5kaW5nU3RhdGVzKCBnbCwgZXh0ZW5zaW9ucywgYXR0cmlidXRlcywgY2FwYWJpbGl0aWVzICkgewoKCWNvbnN0IG1heFZlcnRleEF0dHJpYnV0ZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfQVRUUklCUyApOwoKCWNvbnN0IGV4dGVuc2lvbiA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMiA/IG51bGwgOiBleHRlbnNpb25zLmdldCggJ09FU192ZXJ0ZXhfYXJyYXlfb2JqZWN0JyApOwoJY29uc3QgdmFvQXZhaWxhYmxlID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyIHx8IGV4dGVuc2lvbiAhPT0gbnVsbDsKCgljb25zdCBiaW5kaW5nU3RhdGVzID0ge307CgoJY29uc3QgZGVmYXVsdFN0YXRlID0gY3JlYXRlQmluZGluZ1N0YXRlKCBudWxsICk7CglsZXQgY3VycmVudFN0YXRlID0gZGVmYXVsdFN0YXRlOwoJbGV0IGZvcmNlVXBkYXRlID0gZmFsc2U7CgoJZnVuY3Rpb24gc2V0dXAoIG9iamVjdCwgbWF0ZXJpYWwsIHByb2dyYW0sIGdlb21ldHJ5LCBpbmRleCApIHsKCgkJbGV0IHVwZGF0ZUJ1ZmZlcnMgPSBmYWxzZTsKCgkJaWYgKCB2YW9BdmFpbGFibGUgKSB7CgoJCQljb25zdCBzdGF0ZSA9IGdldEJpbmRpbmdTdGF0ZSggZ2VvbWV0cnksIHByb2dyYW0sIG1hdGVyaWFsICk7CgoJCQlpZiAoIGN1cnJlbnRTdGF0ZSAhPT0gc3RhdGUgKSB7CgoJCQkJY3VycmVudFN0YXRlID0gc3RhdGU7CgkJCQliaW5kVmVydGV4QXJyYXlPYmplY3QoIGN1cnJlbnRTdGF0ZS5vYmplY3QgKTsKCgkJCX0KCgkJCXVwZGF0ZUJ1ZmZlcnMgPSBuZWVkc1VwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKTsKCgkJCWlmICggdXBkYXRlQnVmZmVycyApIHNhdmVDYWNoZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKTsKCgkJfSBlbHNlIHsKCgkJCWNvbnN0IHdpcmVmcmFtZSA9ICggbWF0ZXJpYWwud2lyZWZyYW1lID09PSB0cnVlICk7CgoJCQlpZiAoIGN1cnJlbnRTdGF0ZS5nZW9tZXRyeSAhPT0gZ2VvbWV0cnkuaWQgfHwKCQkJCWN1cnJlbnRTdGF0ZS5wcm9ncmFtICE9PSBwcm9ncmFtLmlkIHx8CgkJCQljdXJyZW50U3RhdGUud2lyZWZyYW1lICE9PSB3aXJlZnJhbWUgKSB7CgoJCQkJY3VycmVudFN0YXRlLmdlb21ldHJ5ID0gZ2VvbWV0cnkuaWQ7CgkJCQljdXJyZW50U3RhdGUucHJvZ3JhbSA9IHByb2dyYW0uaWQ7CgkJCQljdXJyZW50U3RhdGUud2lyZWZyYW1lID0gd2lyZWZyYW1lOwoKCQkJCXVwZGF0ZUJ1ZmZlcnMgPSB0cnVlOwoKCQkJfQoKCQl9CgoJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggaW5kZXgsIGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSICk7CgoJCX0KCgkJaWYgKCB1cGRhdGVCdWZmZXJzIHx8IGZvcmNlVXBkYXRlICkgewoKCQkJZm9yY2VVcGRhdGUgPSBmYWxzZTsKCgkJCXNldHVwVmVydGV4QXR0cmlidXRlcyggb2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnkgKTsKCgkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkJZ2wuYmluZEJ1ZmZlciggZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApLmJ1ZmZlciApOwoKCQkJfQoKCQl9CgoJfQoKCWZ1bmN0aW9uIGNyZWF0ZVZlcnRleEFycmF5T2JqZWN0KCkgewoKCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHJldHVybiBnbC5jcmVhdGVWZXJ0ZXhBcnJheSgpOwoKCQlyZXR1cm4gZXh0ZW5zaW9uLmNyZWF0ZVZlcnRleEFycmF5T0VTKCk7CgoJfQoKCWZ1bmN0aW9uIGJpbmRWZXJ0ZXhBcnJheU9iamVjdCggdmFvICkgewoKCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHJldHVybiBnbC5iaW5kVmVydGV4QXJyYXkoIHZhbyApOwoKCQlyZXR1cm4gZXh0ZW5zaW9uLmJpbmRWZXJ0ZXhBcnJheU9FUyggdmFvICk7CgoJfQoKCWZ1bmN0aW9uIGRlbGV0ZVZlcnRleEFycmF5T2JqZWN0KCB2YW8gKSB7CgoJCWlmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyICkgcmV0dXJuIGdsLmRlbGV0ZVZlcnRleEFycmF5KCB2YW8gKTsKCgkJcmV0dXJuIGV4dGVuc2lvbi5kZWxldGVWZXJ0ZXhBcnJheU9FUyggdmFvICk7CgoJfQoKCWZ1bmN0aW9uIGdldEJpbmRpbmdTdGF0ZSggZ2VvbWV0cnksIHByb2dyYW0sIG1hdGVyaWFsICkgewoKCQljb25zdCB3aXJlZnJhbWUgPSAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApOwoKCQlsZXQgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgoJCWlmICggcHJvZ3JhbU1hcCA9PT0gdW5kZWZpbmVkICkgewoKCQkJcHJvZ3JhbU1hcCA9IHt9OwoJCQliaW5kaW5nU3RhdGVzWyBnZW9tZXRyeS5pZCBdID0gcHJvZ3JhbU1hcDsKCgkJfQoKCQlsZXQgc3RhdGVNYXAgPSBwcm9ncmFtTWFwWyBwcm9ncmFtLmlkIF07CgoJCWlmICggc3RhdGVNYXAgPT09IHVuZGVmaW5lZCApIHsKCgkJCXN0YXRlTWFwID0ge307CgkJCXByb2dyYW1NYXBbIHByb2dyYW0uaWQgXSA9IHN0YXRlTWFwOwoKCQl9CgoJCWxldCBzdGF0ZSA9IHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCgkJaWYgKCBzdGF0ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJc3RhdGUgPSBjcmVhdGVCaW5kaW5nU3RhdGUoIGNyZWF0ZVZlcnRleEFycmF5T2JqZWN0KCkgKTsKCQkJc3RhdGVNYXBbIHdpcmVmcmFtZSBdID0gc3RhdGU7CgoJCX0KCgkJcmV0dXJuIHN0YXRlOwoKCX0KCglmdW5jdGlvbiBjcmVhdGVCaW5kaW5nU3RhdGUoIHZhbyApIHsKCgkJY29uc3QgbmV3QXR0cmlidXRlcyA9IFtdOwoJCWNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gW107CgkJY29uc3QgYXR0cmlidXRlRGl2aXNvcnMgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgbWF4VmVydGV4QXR0cmlidXRlczsgaSArKyApIHsKCgkJCW5ld0F0dHJpYnV0ZXNbIGkgXSA9IDA7CgkJCWVuYWJsZWRBdHRyaWJ1dGVzWyBpIF0gPSAwOwoJCQlhdHRyaWJ1dGVEaXZpc29yc1sgaSBdID0gMDsKCgkJfQoKCQlyZXR1cm4gewoKCQkJLy8gZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgb24gbm9uLVZBTyBzdXBwb3J0IGJyb3dzZXIKCQkJZ2VvbWV0cnk6IG51bGwsCgkJCXByb2dyYW06IG51bGwsCgkJCXdpcmVmcmFtZTogZmFsc2UsCgoJCQluZXdBdHRyaWJ1dGVzOiBuZXdBdHRyaWJ1dGVzLAoJCQllbmFibGVkQXR0cmlidXRlczogZW5hYmxlZEF0dHJpYnV0ZXMsCgkJCWF0dHJpYnV0ZURpdmlzb3JzOiBhdHRyaWJ1dGVEaXZpc29ycywKCQkJb2JqZWN0OiB2YW8sCgkJCWF0dHJpYnV0ZXM6IHt9LAoJCQlpbmRleDogbnVsbAoKCQl9OwoKCX0KCglmdW5jdGlvbiBuZWVkc1VwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKSB7CgoJCWNvbnN0IGNhY2hlZEF0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUuYXR0cmlidXRlczsKCQljb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQlsZXQgYXR0cmlidXRlc051bSA9IDA7CgoJCWNvbnN0IHByb2dyYW1BdHRyaWJ1dGVzID0gcHJvZ3JhbS5nZXRBdHRyaWJ1dGVzKCk7CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gcHJvZ3JhbUF0dHJpYnV0ZXMgKSB7CgoJCQljb25zdCBwcm9ncmFtQXR0cmlidXRlID0gcHJvZ3JhbUF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCWlmICggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiA+PSAwICkgewoKCQkJCWNvbnN0IGNhY2hlZEF0dHJpYnV0ZSA9IGNhY2hlZEF0dHJpYnV0ZXNbIG5hbWUgXTsKCQkJCWxldCBnZW9tZXRyeUF0dHJpYnV0ZSA9IGdlb21ldHJ5QXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJaWYgKCBuYW1lID09PSAnaW5zdGFuY2VNYXRyaXgnICYmIG9iamVjdC5pbnN0YW5jZU1hdHJpeCApIGdlb21ldHJ5QXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlTWF0cml4OwoJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlQ29sb3InICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VDb2xvcjsKCgkJCQl9CgoJCQkJaWYgKCBjYWNoZWRBdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIHJldHVybiB0cnVlOwoKCQkJCWlmICggY2FjaGVkQXR0cmlidXRlLmF0dHJpYnV0ZSAhPT0gZ2VvbWV0cnlBdHRyaWJ1dGUgKSByZXR1cm4gdHJ1ZTsKCgkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlICYmIGNhY2hlZEF0dHJpYnV0ZS5kYXRhICE9PSBnZW9tZXRyeUF0dHJpYnV0ZS5kYXRhICkgcmV0dXJuIHRydWU7CgoJCQkJYXR0cmlidXRlc051bSArKzsKCgkJCX0KCgkJfQoKCQlpZiAoIGN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVzTnVtICE9PSBhdHRyaWJ1dGVzTnVtICkgcmV0dXJuIHRydWU7CgoJCWlmICggY3VycmVudFN0YXRlLmluZGV4ICE9PSBpbmRleCApIHJldHVybiB0cnVlOwoKCQlyZXR1cm4gZmFsc2U7CgoJfQoKCWZ1bmN0aW9uIHNhdmVDYWNoZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKSB7CgoJCWNvbnN0IGNhY2hlID0ge307CgkJY29uc3QgYXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CgkJbGV0IGF0dHJpYnV0ZXNOdW0gPSAwOwoKCQljb25zdCBwcm9ncmFtQXR0cmlidXRlcyA9IHByb2dyYW0uZ2V0QXR0cmlidXRlcygpOwoKCQlmb3IgKCBjb25zdCBuYW1lIGluIHByb2dyYW1BdHRyaWJ1dGVzICkgewoKCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZSA9IHByb2dyYW1BdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQlpZiAoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gPj0gMCApIHsKCgkJCQlsZXQgYXR0cmlidXRlID0gYXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJCWlmICggYXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlTWF0cml4JyAmJiBvYmplY3QuaW5zdGFuY2VNYXRyaXggKSBhdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VNYXRyaXg7CgkJCQkJaWYgKCBuYW1lID09PSAnaW5zdGFuY2VDb2xvcicgJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgKSBhdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VDb2xvcjsKCgkJCQl9CgoJCQkJY29uc3QgZGF0YSA9IHt9OwoJCQkJZGF0YS5hdHRyaWJ1dGUgPSBhdHRyaWJ1dGU7CgoJCQkJaWYgKCBhdHRyaWJ1dGUgJiYgYXR0cmlidXRlLmRhdGEgKSB7CgoJCQkJCWRhdGEuZGF0YSA9IGF0dHJpYnV0ZS5kYXRhOwoKCQkJCX0KCgkJCQljYWNoZVsgbmFtZSBdID0gZGF0YTsKCgkJCQlhdHRyaWJ1dGVzTnVtICsrOwoKCQkJfQoKCQl9CgoJCWN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVzID0gY2FjaGU7CgkJY3VycmVudFN0YXRlLmF0dHJpYnV0ZXNOdW0gPSBhdHRyaWJ1dGVzTnVtOwoKCQljdXJyZW50U3RhdGUuaW5kZXggPSBpbmRleDsKCgl9CgoJZnVuY3Rpb24gaW5pdEF0dHJpYnV0ZXMoKSB7CgoJCWNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG5ld0F0dHJpYnV0ZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQluZXdBdHRyaWJ1dGVzWyBpIF0gPSAwOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIGVuYWJsZUF0dHJpYnV0ZSggYXR0cmlidXRlICkgewoKCQllbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBhdHRyaWJ1dGUsIDAgKTsKCgl9CgoJZnVuY3Rpb24gZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvciggYXR0cmlidXRlLCBtZXNoUGVyQXR0cmlidXRlICkgewoKCQljb25zdCBuZXdBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLm5ld0F0dHJpYnV0ZXM7CgkJY29uc3QgZW5hYmxlZEF0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUuZW5hYmxlZEF0dHJpYnV0ZXM7CgkJY29uc3QgYXR0cmlidXRlRGl2aXNvcnMgPSBjdXJyZW50U3RhdGUuYXR0cmlidXRlRGl2aXNvcnM7CgoJCW5ld0F0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID0gMTsKCgkJaWYgKCBlbmFibGVkQXR0cmlidXRlc1sgYXR0cmlidXRlIF0gPT09IDAgKSB7CgoJCQlnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSggYXR0cmlidXRlICk7CgkJCWVuYWJsZWRBdHRyaWJ1dGVzWyBhdHRyaWJ1dGUgXSA9IDE7CgoJCX0KCgkJaWYgKCBhdHRyaWJ1dGVEaXZpc29yc1sgYXR0cmlidXRlIF0gIT09IG1lc2hQZXJBdHRyaWJ1dGUgKSB7CgoJCQljb25zdCBleHRlbnNpb24gPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPyBnbCA6IGV4dGVuc2lvbnMuZ2V0KCAnQU5HTEVfaW5zdGFuY2VkX2FycmF5cycgKTsKCgkJCWV4dGVuc2lvblsgY2FwYWJpbGl0aWVzLmlzV2ViR0wyID8gJ3ZlcnRleEF0dHJpYkRpdmlzb3InIDogJ3ZlcnRleEF0dHJpYkRpdmlzb3JBTkdMRScgXSggYXR0cmlidXRlLCBtZXNoUGVyQXR0cmlidXRlICk7CgkJCWF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSA9IG1lc2hQZXJBdHRyaWJ1dGU7CgoJCX0KCgl9CgoJZnVuY3Rpb24gZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMoKSB7CgoJCWNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKCQljb25zdCBlbmFibGVkQXR0cmlidXRlcyA9IGN1cnJlbnRTdGF0ZS5lbmFibGVkQXR0cmlidXRlczsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGVuYWJsZWRBdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJaWYgKCBlbmFibGVkQXR0cmlidXRlc1sgaSBdICE9PSBuZXdBdHRyaWJ1dGVzWyBpIF0gKSB7CgoJCQkJZ2wuZGlzYWJsZVZlcnRleEF0dHJpYkFycmF5KCBpICk7CgkJCQllbmFibGVkQXR0cmlidXRlc1sgaSBdID0gMDsKCgkJCX0KCgkJfQoKCX0KCglmdW5jdGlvbiB2ZXJ0ZXhBdHRyaWJQb2ludGVyKCBpbmRleCwgc2l6ZSwgdHlwZSwgbm9ybWFsaXplZCwgc3RyaWRlLCBvZmZzZXQsIGludGVnZXIgKSB7CgoJCWlmICggaW50ZWdlciA9PT0gdHJ1ZSApIHsKCgkJCWdsLnZlcnRleEF0dHJpYklQb2ludGVyKCBpbmRleCwgc2l6ZSwgdHlwZSwgc3RyaWRlLCBvZmZzZXQgKTsKCgkJfSBlbHNlIHsKCgkJCWdsLnZlcnRleEF0dHJpYlBvaW50ZXIoIGluZGV4LCBzaXplLCB0eXBlLCBub3JtYWxpemVkLCBzdHJpZGUsIG9mZnNldCApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldHVwVmVydGV4QXR0cmlidXRlcyggb2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnkgKSB7CgoJCWlmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyID09PSBmYWxzZSAmJiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggfHwgZ2VvbWV0cnkuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSApICkgewoKCQkJaWYgKCBleHRlbnNpb25zLmdldCggJ0FOR0xFX2luc3RhbmNlZF9hcnJheXMnICkgPT09IG51bGwgKSByZXR1cm47CgoJCX0KCgkJaW5pdEF0dHJpYnV0ZXMoKTsKCgkJY29uc3QgZ2VvbWV0cnlBdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKCgkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKCgkJY29uc3QgbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzID0gbWF0ZXJpYWwuZGVmYXVsdEF0dHJpYnV0ZVZhbHVlczsKCgkJZm9yICggY29uc3QgbmFtZSBpbiBwcm9ncmFtQXR0cmlidXRlcyApIHsKCgkJCWNvbnN0IHByb2dyYW1BdHRyaWJ1dGUgPSBwcm9ncmFtQXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJaWYgKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uID49IDAgKSB7CgoJCQkJbGV0IGdlb21ldHJ5QXR0cmlidXRlID0gZ2VvbWV0cnlBdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZU1hdHJpeCcgJiYgb2JqZWN0Lmluc3RhbmNlTWF0cml4ICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VNYXRyaXg7CgkJCQkJaWYgKCBuYW1lID09PSAnaW5zdGFuY2VDb2xvcicgJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgKSBnZW9tZXRyeUF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZUNvbG9yOwoKCQkJCX0KCgkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnN0IG5vcm1hbGl6ZWQgPSBnZW9tZXRyeUF0dHJpYnV0ZS5ub3JtYWxpemVkOwoJCQkJCWNvbnN0IHNpemUgPSBnZW9tZXRyeUF0dHJpYnV0ZS5pdGVtU2l6ZTsKCgkJCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5QXR0cmlidXRlICk7CgoJCQkJCS8vIFRPRE8gQXR0cmlidXRlIG1heSBub3QgYmUgYXZhaWxhYmxlIG9uIGNvbnRleHQgcmVzdG9yZQoKCQkJCQlpZiAoIGF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgY29udGludWU7CgoJCQkJCWNvbnN0IGJ1ZmZlciA9IGF0dHJpYnV0ZS5idWZmZXI7CgkJCQkJY29uc3QgdHlwZSA9IGF0dHJpYnV0ZS50eXBlOwoJCQkJCWNvbnN0IGJ5dGVzUGVyRWxlbWVudCA9IGF0dHJpYnV0ZS5ieXRlc1BlckVsZW1lbnQ7CgoJCQkJCS8vIGNoZWNrIGZvciBpbnRlZ2VyIGF0dHJpYnV0ZXMgKFdlYkdMIDIgb25seSkKCgkJCQkJY29uc3QgaW50ZWdlciA9ICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyID09PSB0cnVlICYmICggdHlwZSA9PT0gZ2wuSU5UIHx8IHR5cGUgPT09IGdsLlVOU0lHTkVEX0lOVCB8fCBnZW9tZXRyeUF0dHJpYnV0ZS5ncHVUeXBlID09PSBJbnRUeXBlICkgKTsKCgkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlICkgewoKCQkJCQkJY29uc3QgZGF0YSA9IGdlb21ldHJ5QXR0cmlidXRlLmRhdGE7CgkJCQkJCWNvbnN0IHN0cmlkZSA9IGRhdGEuc3RyaWRlOwoJCQkJCQljb25zdCBvZmZzZXQgPSBnZW9tZXRyeUF0dHJpYnV0ZS5vZmZzZXQ7CgoJCQkJCQlpZiAoIGRhdGEuaXNJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciApIHsKCgkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCgkJCQkJCQkJZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvciggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksIGRhdGEubWVzaFBlckF0dHJpYnV0ZSApOwoKCQkJCQkJCX0KCgkJCQkJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggIT09IHRydWUgJiYgZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkJZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPSBkYXRhLm1lc2hQZXJBdHRyaWJ1dGUgKiBkYXRhLmNvdW50OwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgoJCQkJCQkJCWVuYWJsZUF0dHJpYnV0ZSggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGkgKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCQlnbC5iaW5kQnVmZmVyKCBnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlciApOwoKCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgoJCQkJCQkJdmVydGV4QXR0cmliUG9pbnRlcigKCQkJCQkJCQlwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uICsgaSwKCQkJCQkJCQlzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUsCgkJCQkJCQkJdHlwZSwKCQkJCQkJCQlub3JtYWxpemVkLAoJCQkJCQkJCXN0cmlkZSAqIGJ5dGVzUGVyRWxlbWVudCwKCQkJCQkJCQkoIG9mZnNldCArICggc2l6ZSAvIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplICkgKiBpICkgKiBieXRlc1BlckVsZW1lbnQsCgkJCQkJCQkJaW50ZWdlcgoJCQkJCQkJKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgoJCQkJCQkJCWVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpLCBnZW9tZXRyeUF0dHJpYnV0ZS5tZXNoUGVyQXR0cmlidXRlICk7CgoJCQkJCQkJfQoKCQkJCQkJCWlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAhPT0gdHJ1ZSAmJiBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCQlnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA9IGdlb21ldHJ5QXR0cmlidXRlLm1lc2hQZXJBdHRyaWJ1dGUgKiBnZW9tZXRyeUF0dHJpYnV0ZS5jb3VudDsKCgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKCQkJCQkJCQllbmFibGVBdHRyaWJ1dGUoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQkJZ2wuYmluZEJ1ZmZlciggZ2wuQVJSQVlfQlVGRkVSLCBidWZmZXIgKTsKCgkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKCQkJCQkJCXZlcnRleEF0dHJpYlBvaW50ZXIoCgkJCQkJCQkJcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksCgkJCQkJCQkJc2l6ZSAvIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplLAoJCQkJCQkJCXR5cGUsCgkJCQkJCQkJbm9ybWFsaXplZCwKCQkJCQkJCQlzaXplICogYnl0ZXNQZXJFbGVtZW50LAoJCQkJCQkJCSggc2l6ZSAvIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplICkgKiBpICogYnl0ZXNQZXJFbGVtZW50LAoJCQkJCQkJCWludGVnZXIKCQkJCQkJCSk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbERlZmF1bHRBdHRyaWJ1dGVWYWx1ZXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc3QgdmFsdWUgPSBtYXRlcmlhbERlZmF1bHRBdHRyaWJ1dGVWYWx1ZXNbIG5hbWUgXTsKCgkJCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJc3dpdGNoICggdmFsdWUubGVuZ3RoICkgewoKCQkJCQkJCWNhc2UgMjoKCQkJCQkJCQlnbC52ZXJ0ZXhBdHRyaWIyZnYoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24sIHZhbHVlICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSAzOgoJCQkJCQkJCWdsLnZlcnRleEF0dHJpYjNmdiggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiwgdmFsdWUgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIDQ6CgkJCQkJCQkJZ2wudmVydGV4QXR0cmliNGZ2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWRlZmF1bHQ6CgkJCQkJCQkJZ2wudmVydGV4QXR0cmliMWZ2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzKCk7CgoJfQoKCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCXJlc2V0KCk7CgoJCWZvciAoIGNvbnN0IGdlb21ldHJ5SWQgaW4gYmluZGluZ1N0YXRlcyApIHsKCgkJCWNvbnN0IHByb2dyYW1NYXAgPSBiaW5kaW5nU3RhdGVzWyBnZW9tZXRyeUlkIF07CgoJCQlmb3IgKCBjb25zdCBwcm9ncmFtSWQgaW4gcHJvZ3JhbU1hcCApIHsKCgkJCQljb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQkJCWZvciAoIGNvbnN0IHdpcmVmcmFtZSBpbiBzdGF0ZU1hcCApIHsKCgkJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCgkJCQkJZGVsZXRlIHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCgkJCQl9CgoJCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQkJfQoKCQkJZGVsZXRlIGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5SWQgXTsKCgkJfQoKCX0KCglmdW5jdGlvbiByZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeSggZ2VvbWV0cnkgKSB7CgoJCWlmICggYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQljb25zdCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXTsKCgkJZm9yICggY29uc3QgcHJvZ3JhbUlkIGluIHByb2dyYW1NYXAgKSB7CgoJCQljb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQkJZm9yICggY29uc3Qgd2lyZWZyYW1lIGluIHN0YXRlTWFwICkgewoKCQkJCWRlbGV0ZVZlcnRleEFycmF5T2JqZWN0KCBzdGF0ZU1hcFsgd2lyZWZyYW1lIF0ub2JqZWN0ICk7CgoJCQkJZGVsZXRlIHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCgkJCX0KCgkJCWRlbGV0ZSBwcm9ncmFtTWFwWyBwcm9ncmFtSWQgXTsKCgkJfQoKCQlkZWxldGUgYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXTsKCgl9CgoJZnVuY3Rpb24gcmVsZWFzZVN0YXRlc09mUHJvZ3JhbSggcHJvZ3JhbSApIHsKCgkJZm9yICggY29uc3QgZ2VvbWV0cnlJZCBpbiBiaW5kaW5nU3RhdGVzICkgewoKCQkJY29uc3QgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5SWQgXTsKCgkJCWlmICggcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdID09PSB1bmRlZmluZWQgKSBjb250aW51ZTsKCgkJCWNvbnN0IHN0YXRlTWFwID0gcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdOwoKCQkJZm9yICggY29uc3Qgd2lyZWZyYW1lIGluIHN0YXRlTWFwICkgewoKCQkJCWRlbGV0ZVZlcnRleEFycmF5T2JqZWN0KCBzdGF0ZU1hcFsgd2lyZWZyYW1lIF0ub2JqZWN0ICk7CgoJCQkJZGVsZXRlIHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCgkJCX0KCgkJCWRlbGV0ZSBwcm9ncmFtTWFwWyBwcm9ncmFtLmlkIF07CgoJCX0KCgl9CgoJZnVuY3Rpb24gcmVzZXQoKSB7CgoJCXJlc2V0RGVmYXVsdFN0YXRlKCk7CgkJZm9yY2VVcGRhdGUgPSB0cnVlOwoKCQlpZiAoIGN1cnJlbnRTdGF0ZSA9PT0gZGVmYXVsdFN0YXRlICkgcmV0dXJuOwoKCQljdXJyZW50U3RhdGUgPSBkZWZhdWx0U3RhdGU7CgkJYmluZFZlcnRleEFycmF5T2JqZWN0KCBjdXJyZW50U3RhdGUub2JqZWN0ICk7CgoJfQoKCS8vIGZvciBiYWNrd2FyZC1jb21wYXRpYmlsaXR5CgoJZnVuY3Rpb24gcmVzZXREZWZhdWx0U3RhdGUoKSB7CgoJCWRlZmF1bHRTdGF0ZS5nZW9tZXRyeSA9IG51bGw7CgkJZGVmYXVsdFN0YXRlLnByb2dyYW0gPSBudWxsOwoJCWRlZmF1bHRTdGF0ZS53aXJlZnJhbWUgPSBmYWxzZTsKCgl9CgoJcmV0dXJuIHsKCgkJc2V0dXA6IHNldHVwLAoJCXJlc2V0OiByZXNldCwKCQlyZXNldERlZmF1bHRTdGF0ZTogcmVzZXREZWZhdWx0U3RhdGUsCgkJZGlzcG9zZTogZGlzcG9zZSwKCQlyZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeTogcmVsZWFzZVN0YXRlc09mR2VvbWV0cnksCgkJcmVsZWFzZVN0YXRlc09mUHJvZ3JhbTogcmVsZWFzZVN0YXRlc09mUHJvZ3JhbSwKCgkJaW5pdEF0dHJpYnV0ZXM6IGluaXRBdHRyaWJ1dGVzLAoJCWVuYWJsZUF0dHJpYnV0ZTogZW5hYmxlQXR0cmlidXRlLAoJCWRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzOiBkaXNhYmxlVW51c2VkQXR0cmlidXRlcwoKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTEJ1ZmZlclJlbmRlcmVyKCBnbCwgZXh0ZW5zaW9ucywgaW5mbywgY2FwYWJpbGl0aWVzICkgewoKCWNvbnN0IGlzV2ViR0wyID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyOwoKCWxldCBtb2RlOwoKCWZ1bmN0aW9uIHNldE1vZGUoIHZhbHVlICkgewoKCQltb2RlID0gdmFsdWU7CgoJfQoKCWZ1bmN0aW9uIHJlbmRlciggc3RhcnQsIGNvdW50ICkgewoKCQlnbC5kcmF3QXJyYXlzKCBtb2RlLCBzdGFydCwgY291bnQgKTsKCgkJaW5mby51cGRhdGUoIGNvdW50LCBtb2RlLCAxICk7CgoJfQoKCWZ1bmN0aW9uIHJlbmRlckluc3RhbmNlcyggc3RhcnQsIGNvdW50LCBwcmltY291bnQgKSB7CgoJCWlmICggcHJpbWNvdW50ID09PSAwICkgcmV0dXJuOwoKCQlsZXQgZXh0ZW5zaW9uLCBtZXRob2ROYW1lOwoKCQlpZiAoIGlzV2ViR0wyICkgewoKCQkJZXh0ZW5zaW9uID0gZ2w7CgkJCW1ldGhvZE5hbWUgPSAnZHJhd0FycmF5c0luc3RhbmNlZCc7CgoJCX0gZWxzZSB7CgoJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ0FOR0xFX2luc3RhbmNlZF9hcnJheXMnICk7CgkJCW1ldGhvZE5hbWUgPSAnZHJhd0FycmF5c0luc3RhbmNlZEFOR0xFJzsKCgkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTEJ1ZmZlclJlbmRlcmVyOiB1c2luZyBUSFJFRS5JbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSBidXQgaGFyZHdhcmUgZG9lcyBub3Qgc3VwcG9ydCBleHRlbnNpb24gQU5HTEVfaW5zdGFuY2VkX2FycmF5cy4nICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCX0KCgkJZXh0ZW5zaW9uWyBtZXRob2ROYW1lIF0oIG1vZGUsIHN0YXJ0LCBjb3VudCwgcHJpbWNvdW50ICk7CgoJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgcHJpbWNvdW50ICk7CgoJfQoKCWZ1bmN0aW9uIHJlbmRlck11bHRpRHJhdyggc3RhcnRzLCBjb3VudHMsIGRyYXdDb3VudCApIHsKCgkJaWYgKCBkcmF3Q291bnQgPT09IDAgKSByZXR1cm47CgoJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKTsKCQlpZiAoIGV4dGVuc2lvbiA9PT0gbnVsbCApIHsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRyYXdDb3VudDsgaSArKyApIHsKCgkJCQl0aGlzLnJlbmRlciggc3RhcnRzWyBpIF0sIGNvdW50c1sgaSBdICk7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlleHRlbnNpb24ubXVsdGlEcmF3QXJyYXlzV0VCR0woIG1vZGUsIHN0YXJ0cywgMCwgY291bnRzLCAwLCBkcmF3Q291bnQgKTsKCgkJCWxldCBlbGVtZW50Q291bnQgPSAwOwoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkcmF3Q291bnQ7IGkgKysgKSB7CgoJCQkJZWxlbWVudENvdW50ICs9IGNvdW50c1sgaSBdOwoKCQkJfQoKCQkJaW5mby51cGRhdGUoIGVsZW1lbnRDb3VudCwgbW9kZSwgMSApOwoKCQl9CgoJfQoKCS8vCgoJdGhpcy5zZXRNb2RlID0gc2V0TW9kZTsKCXRoaXMucmVuZGVyID0gcmVuZGVyOwoJdGhpcy5yZW5kZXJJbnN0YW5jZXMgPSByZW5kZXJJbnN0YW5jZXM7Cgl0aGlzLnJlbmRlck11bHRpRHJhdyA9IHJlbmRlck11bHRpRHJhdzsKCn0KCmZ1bmN0aW9uIFdlYkdMQ2FwYWJpbGl0aWVzKCBnbCwgZXh0ZW5zaW9ucywgcGFyYW1ldGVycyApIHsKCglsZXQgbWF4QW5pc290cm9weTsKCglmdW5jdGlvbiBnZXRNYXhBbmlzb3Ryb3B5KCkgewoKCQlpZiAoIG1heEFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCApIHJldHVybiBtYXhBbmlzb3Ryb3B5OwoKCQlpZiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApID09PSB0cnVlICkgewoKCQkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICk7CgoJCQltYXhBbmlzb3Ryb3B5ID0gZ2wuZ2V0UGFyYW1ldGVyKCBleHRlbnNpb24uTUFYX1RFWFRVUkVfTUFYX0FOSVNPVFJPUFlfRVhUICk7CgoJCX0gZWxzZSB7CgoJCQltYXhBbmlzb3Ryb3B5ID0gMDsKCgkJfQoKCQlyZXR1cm4gbWF4QW5pc290cm9weTsKCgl9CgoJZnVuY3Rpb24gZ2V0TWF4UHJlY2lzaW9uKCBwcmVjaXNpb24gKSB7CgoJCWlmICggcHJlY2lzaW9uID09PSAnaGlnaHAnICkgewoKCQkJaWYgKCBnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLlZFUlRFWF9TSEFERVIsIGdsLkhJR0hfRkxPQVQgKS5wcmVjaXNpb24gPiAwICYmCgkJCQlnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLkZSQUdNRU5UX1NIQURFUiwgZ2wuSElHSF9GTE9BVCApLnByZWNpc2lvbiA+IDAgKSB7CgoJCQkJcmV0dXJuICdoaWdocCc7CgoJCQl9CgoJCQlwcmVjaXNpb24gPSAnbWVkaXVtcCc7CgoJCX0KCgkJaWYgKCBwcmVjaXNpb24gPT09ICdtZWRpdW1wJyApIHsKCgkJCWlmICggZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCBnbC5WRVJURVhfU0hBREVSLCBnbC5NRURJVU1fRkxPQVQgKS5wcmVjaXNpb24gPiAwICYmCgkJCQlnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLkZSQUdNRU5UX1NIQURFUiwgZ2wuTUVESVVNX0ZMT0FUICkucHJlY2lzaW9uID4gMCApIHsKCgkJCQlyZXR1cm4gJ21lZGl1bXAnOwoKCQkJfQoKCQl9CgoJCXJldHVybiAnbG93cCc7CgoJfQoKCWNvbnN0IGlzV2ViR0wyID0gdHlwZW9mIFdlYkdMMlJlbmRlcmluZ0NvbnRleHQgIT09ICd1bmRlZmluZWQnICYmIGdsLmNvbnN0cnVjdG9yLm5hbWUgPT09ICdXZWJHTDJSZW5kZXJpbmdDb250ZXh0JzsKCglsZXQgcHJlY2lzaW9uID0gcGFyYW1ldGVycy5wcmVjaXNpb24gIT09IHVuZGVmaW5lZCA/IHBhcmFtZXRlcnMucHJlY2lzaW9uIDogJ2hpZ2hwJzsKCWNvbnN0IG1heFByZWNpc2lvbiA9IGdldE1heFByZWNpc2lvbiggcHJlY2lzaW9uICk7CgoJaWYgKCBtYXhQcmVjaXNpb24gIT09IHByZWNpc2lvbiApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjonLCBwcmVjaXNpb24sICdub3Qgc3VwcG9ydGVkLCB1c2luZycsIG1heFByZWNpc2lvbiwgJ2luc3RlYWQuJyApOwoJCXByZWNpc2lvbiA9IG1heFByZWNpc2lvbjsKCgl9CgoJY29uc3QgZHJhd0J1ZmZlcnMgPSBpc1dlYkdMMiB8fCBleHRlbnNpb25zLmhhcyggJ1dFQkdMX2RyYXdfYnVmZmVycycgKTsKCgljb25zdCBsb2dhcml0aG1pY0RlcHRoQnVmZmVyID0gcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID09PSB0cnVlOwoKCWNvbnN0IG1heFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVEVYVFVSRV9JTUFHRV9VTklUUyApOwoJY29uc3QgbWF4VmVydGV4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfVEVYVFVSRV9JTUFHRV9VTklUUyApOwoJY29uc3QgbWF4VGV4dHVyZVNpemUgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9URVhUVVJFX1NJWkUgKTsKCWNvbnN0IG1heEN1YmVtYXBTaXplID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfQ1VCRV9NQVBfVEVYVFVSRV9TSVpFICk7CgoJY29uc3QgbWF4QXR0cmlidXRlcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1ZFUlRFWF9BVFRSSUJTICk7Cgljb25zdCBtYXhWZXJ0ZXhVbmlmb3JtcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1ZFUlRFWF9VTklGT1JNX1ZFQ1RPUlMgKTsKCWNvbnN0IG1heFZhcnlpbmdzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkFSWUlOR19WRUNUT1JTICk7Cgljb25zdCBtYXhGcmFnbWVudFVuaWZvcm1zID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfRlJBR01FTlRfVU5JRk9STV9WRUNUT1JTICk7CgoJY29uc3QgdmVydGV4VGV4dHVyZXMgPSBtYXhWZXJ0ZXhUZXh0dXJlcyA+IDA7Cgljb25zdCBmbG9hdEZyYWdtZW50VGV4dHVyZXMgPSBpc1dlYkdMMiB8fCBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2Zsb2F0JyApOwoJY29uc3QgZmxvYXRWZXJ0ZXhUZXh0dXJlcyA9IHZlcnRleFRleHR1cmVzICYmIGZsb2F0RnJhZ21lbnRUZXh0dXJlczsKCgljb25zdCBtYXhTYW1wbGVzID0gaXNXZWJHTDIgPyBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9TQU1QTEVTICkgOiAwOwoKCXJldHVybiB7CgoJCWlzV2ViR0wyOiBpc1dlYkdMMiwKCgkJZHJhd0J1ZmZlcnM6IGRyYXdCdWZmZXJzLAoKCQlnZXRNYXhBbmlzb3Ryb3B5OiBnZXRNYXhBbmlzb3Ryb3B5LAoJCWdldE1heFByZWNpc2lvbjogZ2V0TWF4UHJlY2lzaW9uLAoKCQlwcmVjaXNpb246IHByZWNpc2lvbiwKCQlsb2dhcml0aG1pY0RlcHRoQnVmZmVyOiBsb2dhcml0aG1pY0RlcHRoQnVmZmVyLAoKCQltYXhUZXh0dXJlczogbWF4VGV4dHVyZXMsCgkJbWF4VmVydGV4VGV4dHVyZXM6IG1heFZlcnRleFRleHR1cmVzLAoJCW1heFRleHR1cmVTaXplOiBtYXhUZXh0dXJlU2l6ZSwKCQltYXhDdWJlbWFwU2l6ZTogbWF4Q3ViZW1hcFNpemUsCgoJCW1heEF0dHJpYnV0ZXM6IG1heEF0dHJpYnV0ZXMsCgkJbWF4VmVydGV4VW5pZm9ybXM6IG1heFZlcnRleFVuaWZvcm1zLAoJCW1heFZhcnlpbmdzOiBtYXhWYXJ5aW5ncywKCQltYXhGcmFnbWVudFVuaWZvcm1zOiBtYXhGcmFnbWVudFVuaWZvcm1zLAoKCQl2ZXJ0ZXhUZXh0dXJlczogdmVydGV4VGV4dHVyZXMsCgkJZmxvYXRGcmFnbWVudFRleHR1cmVzOiBmbG9hdEZyYWdtZW50VGV4dHVyZXMsCgkJZmxvYXRWZXJ0ZXhUZXh0dXJlczogZmxvYXRWZXJ0ZXhUZXh0dXJlcywKCgkJbWF4U2FtcGxlczogbWF4U2FtcGxlcwoKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTENsaXBwaW5nKCBwcm9wZXJ0aWVzICkgewoKCWNvbnN0IHNjb3BlID0gdGhpczsKCglsZXQgZ2xvYmFsU3RhdGUgPSBudWxsLAoJCW51bUdsb2JhbFBsYW5lcyA9IDAsCgkJbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBmYWxzZSwKCQlyZW5kZXJpbmdTaGFkb3dzID0gZmFsc2U7CgoJY29uc3QgcGxhbmUgPSBuZXcgUGxhbmUoKSwKCQl2aWV3Tm9ybWFsTWF0cml4ID0gbmV3IE1hdHJpeDMoKSwKCgkJdW5pZm9ybSA9IHsgdmFsdWU6IG51bGwsIG5lZWRzVXBkYXRlOiBmYWxzZSB9OwoKCXRoaXMudW5pZm9ybSA9IHVuaWZvcm07Cgl0aGlzLm51bVBsYW5lcyA9IDA7Cgl0aGlzLm51bUludGVyc2VjdGlvbiA9IDA7CgoJdGhpcy5pbml0ID0gZnVuY3Rpb24gKCBwbGFuZXMsIGVuYWJsZUxvY2FsQ2xpcHBpbmcgKSB7CgoJCWNvbnN0IGVuYWJsZWQgPQoJCQlwbGFuZXMubGVuZ3RoICE9PSAwIHx8CgkJCWVuYWJsZUxvY2FsQ2xpcHBpbmcgfHwKCQkJLy8gZW5hYmxlIHN0YXRlIG9mIHByZXZpb3VzIGZyYW1lIC0gdGhlIGNsaXBwaW5nIGNvZGUgaGFzIHRvCgkJCS8vIHJ1biBhbm90aGVyIGZyYW1lIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBzdGF0ZToKCQkJbnVtR2xvYmFsUGxhbmVzICE9PSAwIHx8CgkJCWxvY2FsQ2xpcHBpbmdFbmFibGVkOwoKCQlsb2NhbENsaXBwaW5nRW5hYmxlZCA9IGVuYWJsZUxvY2FsQ2xpcHBpbmc7CgoJCW51bUdsb2JhbFBsYW5lcyA9IHBsYW5lcy5sZW5ndGg7CgoJCXJldHVybiBlbmFibGVkOwoKCX07CgoJdGhpcy5iZWdpblNoYWRvd3MgPSBmdW5jdGlvbiAoKSB7CgoJCXJlbmRlcmluZ1NoYWRvd3MgPSB0cnVlOwoJCXByb2plY3RQbGFuZXMoIG51bGwgKTsKCgl9OwoKCXRoaXMuZW5kU2hhZG93cyA9IGZ1bmN0aW9uICgpIHsKCgkJcmVuZGVyaW5nU2hhZG93cyA9IGZhbHNlOwoKCX07CgoJdGhpcy5zZXRHbG9iYWxTdGF0ZSA9IGZ1bmN0aW9uICggcGxhbmVzLCBjYW1lcmEgKSB7CgoJCWdsb2JhbFN0YXRlID0gcHJvamVjdFBsYW5lcyggcGxhbmVzLCBjYW1lcmEsIDAgKTsKCgl9OwoKCXRoaXMuc2V0U3RhdGUgPSBmdW5jdGlvbiAoIG1hdGVyaWFsLCBjYW1lcmEsIHVzZUNhY2hlICkgewoKCQljb25zdCBwbGFuZXMgPSBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lcywKCQkJY2xpcEludGVyc2VjdGlvbiA9IG1hdGVyaWFsLmNsaXBJbnRlcnNlY3Rpb24sCgkJCWNsaXBTaGFkb3dzID0gbWF0ZXJpYWwuY2xpcFNoYWRvd3M7CgoJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoKCQlpZiAoICEgbG9jYWxDbGlwcGluZ0VuYWJsZWQgfHwgcGxhbmVzID09PSBudWxsIHx8IHBsYW5lcy5sZW5ndGggPT09IDAgfHwgcmVuZGVyaW5nU2hhZG93cyAmJiAhIGNsaXBTaGFkb3dzICkgewoKCQkJLy8gdGhlcmUncyBubyBsb2NhbCBjbGlwcGluZwoKCQkJaWYgKCByZW5kZXJpbmdTaGFkb3dzICkgewoKCQkJCS8vIHRoZXJlJ3Mgbm8gZ2xvYmFsIGNsaXBwaW5nCgoJCQkJcHJvamVjdFBsYW5lcyggbnVsbCApOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXNldEdsb2JhbFN0YXRlKCk7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQljb25zdCBuR2xvYmFsID0gcmVuZGVyaW5nU2hhZG93cyA/IDAgOiBudW1HbG9iYWxQbGFuZXMsCgkJCQlsR2xvYmFsID0gbkdsb2JhbCAqIDQ7CgoJCQlsZXQgZHN0QXJyYXkgPSBtYXRlcmlhbFByb3BlcnRpZXMuY2xpcHBpbmdTdGF0ZSB8fCBudWxsOwoKCQkJdW5pZm9ybS52YWx1ZSA9IGRzdEFycmF5OyAvLyBlbnN1cmUgdW5pcXVlIHN0YXRlCgoJCQlkc3RBcnJheSA9IHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCBsR2xvYmFsLCB1c2VDYWNoZSApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBsR2xvYmFsOyArKyBpICkgewoKCQkJCWRzdEFycmF5WyBpIF0gPSBnbG9iYWxTdGF0ZVsgaSBdOwoKCQkJfQoKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmNsaXBwaW5nU3RhdGUgPSBkc3RBcnJheTsKCQkJdGhpcy5udW1JbnRlcnNlY3Rpb24gPSBjbGlwSW50ZXJzZWN0aW9uID8gdGhpcy5udW1QbGFuZXMgOiAwOwoJCQl0aGlzLm51bVBsYW5lcyArPSBuR2xvYmFsOwoKCQl9CgoKCX07CgoJZnVuY3Rpb24gcmVzZXRHbG9iYWxTdGF0ZSgpIHsKCgkJaWYgKCB1bmlmb3JtLnZhbHVlICE9PSBnbG9iYWxTdGF0ZSApIHsKCgkJCXVuaWZvcm0udmFsdWUgPSBnbG9iYWxTdGF0ZTsKCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IG51bUdsb2JhbFBsYW5lcyA+IDA7CgoJCX0KCgkJc2NvcGUubnVtUGxhbmVzID0gbnVtR2xvYmFsUGxhbmVzOwoJCXNjb3BlLm51bUludGVyc2VjdGlvbiA9IDA7CgoJfQoKCWZ1bmN0aW9uIHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCBkc3RPZmZzZXQsIHNraXBUcmFuc2Zvcm0gKSB7CgoJCWNvbnN0IG5QbGFuZXMgPSBwbGFuZXMgIT09IG51bGwgPyBwbGFuZXMubGVuZ3RoIDogMDsKCQlsZXQgZHN0QXJyYXkgPSBudWxsOwoKCQlpZiAoIG5QbGFuZXMgIT09IDAgKSB7CgoJCQlkc3RBcnJheSA9IHVuaWZvcm0udmFsdWU7CgoJCQlpZiAoIHNraXBUcmFuc2Zvcm0gIT09IHRydWUgfHwgZHN0QXJyYXkgPT09IG51bGwgKSB7CgoJCQkJY29uc3QgZmxhdFNpemUgPSBkc3RPZmZzZXQgKyBuUGxhbmVzICogNCwKCQkJCQl2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKCgkJCQl2aWV3Tm9ybWFsTWF0cml4LmdldE5vcm1hbE1hdHJpeCggdmlld01hdHJpeCApOwoKCQkJCWlmICggZHN0QXJyYXkgPT09IG51bGwgfHwgZHN0QXJyYXkubGVuZ3RoIDwgZmxhdFNpemUgKSB7CgoJCQkJCWRzdEFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggZmxhdFNpemUgKTsKCgkJCQl9CgoJCQkJZm9yICggbGV0IGkgPSAwLCBpNCA9IGRzdE9mZnNldDsgaSAhPT0gblBsYW5lczsgKysgaSwgaTQgKz0gNCApIHsKCgkJCQkJcGxhbmUuY29weSggcGxhbmVzWyBpIF0gKS5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXgsIHZpZXdOb3JtYWxNYXRyaXggKTsKCgkJCQkJcGxhbmUubm9ybWFsLnRvQXJyYXkoIGRzdEFycmF5LCBpNCApOwoJCQkJCWRzdEFycmF5WyBpNCArIDMgXSA9IHBsYW5lLmNvbnN0YW50OwoKCQkJCX0KCgkJCX0KCgkJCXVuaWZvcm0udmFsdWUgPSBkc3RBcnJheTsKCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJc2NvcGUubnVtUGxhbmVzID0gblBsYW5lczsKCQlzY29wZS5udW1JbnRlcnNlY3Rpb24gPSAwOwoKCQlyZXR1cm4gZHN0QXJyYXk7CgoJfQoKfQoKZnVuY3Rpb24gV2ViR0xDdWJlTWFwcyggcmVuZGVyZXIgKSB7CgoJbGV0IGN1YmVtYXBzID0gbmV3IFdlYWtNYXAoKTsKCglmdW5jdGlvbiBtYXBUZXh0dXJlTWFwcGluZyggdGV4dHVyZSwgbWFwcGluZyApIHsKCgkJaWYgKCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyApIHsKCgkJCXRleHR1cmUubWFwcGluZyA9IEN1YmVSZWZsZWN0aW9uTWFwcGluZzsKCgkJfSBlbHNlIGlmICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgKSB7CgoJCQl0ZXh0dXJlLm1hcHBpbmcgPSBDdWJlUmVmcmFjdGlvbk1hcHBpbmc7CgoJCX0KCgkJcmV0dXJuIHRleHR1cmU7CgoJfQoKCWZ1bmN0aW9uIGdldCggdGV4dHVyZSApIHsKCgkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlICkgewoKCQkJY29uc3QgbWFwcGluZyA9IHRleHR1cmUubWFwcGluZzsKCgkJCWlmICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgfHwgbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgKSB7CgoJCQkJaWYgKCBjdWJlbWFwcy5oYXMoIHRleHR1cmUgKSApIHsKCgkJCQkJY29uc3QgY3ViZW1hcCA9IGN1YmVtYXBzLmdldCggdGV4dHVyZSApLnRleHR1cmU7CgkJCQkJcmV0dXJuIG1hcFRleHR1cmVNYXBwaW5nKCBjdWJlbWFwLCB0ZXh0dXJlLm1hcHBpbmcgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zdCBpbWFnZSA9IHRleHR1cmUuaW1hZ2U7CgoJCQkJCWlmICggaW1hZ2UgJiYgaW1hZ2UuaGVpZ2h0ID4gMCApIHsKCgkJCQkJCWNvbnN0IHJlbmRlclRhcmdldCA9IG5ldyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQoIGltYWdlLmhlaWdodCAvIDIgKTsKCQkJCQkJcmVuZGVyVGFyZ2V0LmZyb21FcXVpcmVjdGFuZ3VsYXJUZXh0dXJlKCByZW5kZXJlciwgdGV4dHVyZSApOwoJCQkJCQljdWJlbWFwcy5zZXQoIHRleHR1cmUsIHJlbmRlclRhcmdldCApOwoKCQkJCQkJdGV4dHVyZS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCQkJCXJldHVybiBtYXBUZXh0dXJlTWFwcGluZyggcmVuZGVyVGFyZ2V0LnRleHR1cmUsIHRleHR1cmUubWFwcGluZyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJLy8gaW1hZ2Ugbm90IHlldCByZWFkeS4gdHJ5IHRoZSBjb252ZXJzaW9uIG5leHQgZnJhbWUKCgkJCQkJCXJldHVybiBudWxsOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXJldHVybiB0ZXh0dXJlOwoKCX0KCglmdW5jdGlvbiBvblRleHR1cmVEaXNwb3NlKCBldmVudCApIHsKCgkJY29uc3QgdGV4dHVyZSA9IGV2ZW50LnRhcmdldDsKCgkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJY29uc3QgY3ViZW1hcCA9IGN1YmVtYXBzLmdldCggdGV4dHVyZSApOwoKCQlpZiAoIGN1YmVtYXAgIT09IHVuZGVmaW5lZCApIHsKCgkJCWN1YmVtYXBzLmRlbGV0ZSggdGV4dHVyZSApOwoJCQljdWJlbWFwLmRpc3Bvc2UoKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQljdWJlbWFwcyA9IG5ldyBXZWFrTWFwKCk7CgoJfQoKCXJldHVybiB7CgkJZ2V0OiBnZXQsCgkJZGlzcG9zZTogZGlzcG9zZQoJfTsKCn0KCmNsYXNzIE9ydGhvZ3JhcGhpY0NhbWVyYSBleHRlbmRzIENhbWVyYSB7CgoJY29uc3RydWN0b3IoIGxlZnQgPSAtIDEsIHJpZ2h0ID0gMSwgdG9wID0gMSwgYm90dG9tID0gLSAxLCBuZWFyID0gMC4xLCBmYXIgPSAyMDAwICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzT3J0aG9ncmFwaGljQ2FtZXJhID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ09ydGhvZ3JhcGhpY0NhbWVyYSc7CgoJCXRoaXMuem9vbSA9IDE7CgkJdGhpcy52aWV3ID0gbnVsbDsKCgkJdGhpcy5sZWZ0ID0gbGVmdDsKCQl0aGlzLnJpZ2h0ID0gcmlnaHQ7CgkJdGhpcy50b3AgPSB0b3A7CgkJdGhpcy5ib3R0b20gPSBib3R0b207CgoJCXRoaXMubmVhciA9IG5lYXI7CgkJdGhpcy5mYXIgPSBmYXI7CgoJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJdGhpcy5sZWZ0ID0gc291cmNlLmxlZnQ7CgkJdGhpcy5yaWdodCA9IHNvdXJjZS5yaWdodDsKCQl0aGlzLnRvcCA9IHNvdXJjZS50b3A7CgkJdGhpcy5ib3R0b20gPSBzb3VyY2UuYm90dG9tOwoJCXRoaXMubmVhciA9IHNvdXJjZS5uZWFyOwoJCXRoaXMuZmFyID0gc291cmNlLmZhcjsKCgkJdGhpcy56b29tID0gc291cmNlLnpvb207CgkJdGhpcy52aWV3ID0gc291cmNlLnZpZXcgPT09IG51bGwgPyBudWxsIDogT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS52aWV3ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCWlmICggdGhpcy52aWV3ID09PSBudWxsICkgewoKCQkJdGhpcy52aWV3ID0gewoJCQkJZW5hYmxlZDogdHJ1ZSwKCQkJCWZ1bGxXaWR0aDogMSwKCQkJCWZ1bGxIZWlnaHQ6IDEsCgkJCQlvZmZzZXRYOiAwLAoJCQkJb2Zmc2V0WTogMCwKCQkJCXdpZHRoOiAxLAoJCQkJaGVpZ2h0OiAxCgkJCX07CgoJCX0KCgkJdGhpcy52aWV3LmVuYWJsZWQgPSB0cnVlOwoJCXRoaXMudmlldy5mdWxsV2lkdGggPSBmdWxsV2lkdGg7CgkJdGhpcy52aWV3LmZ1bGxIZWlnaHQgPSBmdWxsSGVpZ2h0OwoJCXRoaXMudmlldy5vZmZzZXRYID0geDsKCQl0aGlzLnZpZXcub2Zmc2V0WSA9IHk7CgkJdGhpcy52aWV3LndpZHRoID0gd2lkdGg7CgkJdGhpcy52aWV3LmhlaWdodCA9IGhlaWdodDsKCgkJdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgoJfQoKCWNsZWFyVmlld09mZnNldCgpIHsKCgkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgKSB7CgoJCQl0aGlzLnZpZXcuZW5hYmxlZCA9IGZhbHNlOwoKCQl9CgoJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCX0KCgl1cGRhdGVQcm9qZWN0aW9uTWF0cml4KCkgewoKCQljb25zdCBkeCA9ICggdGhpcy5yaWdodCAtIHRoaXMubGVmdCApIC8gKCAyICogdGhpcy56b29tICk7CgkJY29uc3QgZHkgPSAoIHRoaXMudG9wIC0gdGhpcy5ib3R0b20gKSAvICggMiAqIHRoaXMuem9vbSApOwoJCWNvbnN0IGN4ID0gKCB0aGlzLnJpZ2h0ICsgdGhpcy5sZWZ0ICkgLyAyOwoJCWNvbnN0IGN5ID0gKCB0aGlzLnRvcCArIHRoaXMuYm90dG9tICkgLyAyOwoKCQlsZXQgbGVmdCA9IGN4IC0gZHg7CgkJbGV0IHJpZ2h0ID0gY3ggKyBkeDsKCQlsZXQgdG9wID0gY3kgKyBkeTsKCQlsZXQgYm90dG9tID0gY3kgLSBkeTsKCgkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgJiYgdGhpcy52aWV3LmVuYWJsZWQgKSB7CgoJCQljb25zdCBzY2FsZVcgPSAoIHRoaXMucmlnaHQgLSB0aGlzLmxlZnQgKSAvIHRoaXMudmlldy5mdWxsV2lkdGggLyB0aGlzLnpvb207CgkJCWNvbnN0IHNjYWxlSCA9ICggdGhpcy50b3AgLSB0aGlzLmJvdHRvbSApIC8gdGhpcy52aWV3LmZ1bGxIZWlnaHQgLyB0aGlzLnpvb207CgoJCQlsZWZ0ICs9IHNjYWxlVyAqIHRoaXMudmlldy5vZmZzZXRYOwoJCQlyaWdodCA9IGxlZnQgKyBzY2FsZVcgKiB0aGlzLnZpZXcud2lkdGg7CgkJCXRvcCAtPSBzY2FsZUggKiB0aGlzLnZpZXcub2Zmc2V0WTsKCQkJYm90dG9tID0gdG9wIC0gc2NhbGVIICogdGhpcy52aWV3LmhlaWdodDsKCgkJfQoKCQl0aGlzLnByb2plY3Rpb25NYXRyaXgubWFrZU9ydGhvZ3JhcGhpYyggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCB0aGlzLm5lYXIsIHRoaXMuZmFyLCB0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gKTsKCgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCB0aGlzLnByb2plY3Rpb25NYXRyaXggKS5pbnZlcnQoKTsKCgl9CgoJdG9KU09OKCBtZXRhICkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCBtZXRhICk7CgoJCWRhdGEub2JqZWN0Lnpvb20gPSB0aGlzLnpvb207CgkJZGF0YS5vYmplY3QubGVmdCA9IHRoaXMubGVmdDsKCQlkYXRhLm9iamVjdC5yaWdodCA9IHRoaXMucmlnaHQ7CgkJZGF0YS5vYmplY3QudG9wID0gdGhpcy50b3A7CgkJZGF0YS5vYmplY3QuYm90dG9tID0gdGhpcy5ib3R0b207CgkJZGF0YS5vYmplY3QubmVhciA9IHRoaXMubmVhcjsKCQlkYXRhLm9iamVjdC5mYXIgPSB0aGlzLmZhcjsKCgkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgKSBkYXRhLm9iamVjdC52aWV3ID0gT2JqZWN0LmFzc2lnbigge30sIHRoaXMudmlldyApOwoKCQlyZXR1cm4gZGF0YTsKCgl9Cgp9Cgpjb25zdCBMT0RfTUlOID0gNDsKCi8vIFRoZSBzdGFuZGFyZCBkZXZpYXRpb25zIChyYWRpYW5zKSBhc3NvY2lhdGVkIHdpdGggdGhlIGV4dHJhIG1pcHMuIFRoZXNlIGFyZQovLyBjaG9zZW4gdG8gYXBwcm94aW1hdGUgYSBUcm93YnJpZGdlLVJlaXR6IGRpc3RyaWJ1dGlvbiBmdW5jdGlvbiB0aW1lcyB0aGUKLy8gZ2VvbWV0cmljIHNoYWRvd2luZyBmdW5jdGlvbi4gVGhlc2Ugc2lnbWEgdmFsdWVzIHNxdWFyZWQgbXVzdCBtYXRjaCB0aGUKLy8gdmFyaWFuY2UgI2RlZmluZXMgaW4gY3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50Lmdsc2wuanMuCmNvbnN0IEVYVFJBX0xPRF9TSUdNQSA9IFsgMC4xMjUsIDAuMjE1LCAwLjM1LCAwLjQ0NiwgMC41MjYsIDAuNTgyIF07CgovLyBUaGUgbWF4aW11bSBsZW5ndGggb2YgdGhlIGJsdXIgZm9yIGxvb3AuIFNtYWxsZXIgc2lnbWFzIHdpbGwgdXNlIGZld2VyCi8vIHNhbXBsZXMgYW5kIGV4aXQgZWFybHksIGJ1dCBub3QgcmVjb21waWxlIHRoZSBzaGFkZXIuCmNvbnN0IE1BWF9TQU1QTEVTID0gMjA7Cgpjb25zdCBfZmxhdENhbWVyYSA9IC8qQF9fUFVSRV9fKi8gbmV3IE9ydGhvZ3JhcGhpY0NhbWVyYSgpOwpjb25zdCBfY2xlYXJDb2xvciA9IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCk7CmxldCBfb2xkVGFyZ2V0ID0gbnVsbDsKbGV0IF9vbGRBY3RpdmVDdWJlRmFjZSA9IDA7CmxldCBfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwoKLy8gR29sZGVuIFJhdGlvCmNvbnN0IFBISSA9ICggMSArIE1hdGguc3FydCggNSApICkgLyAyOwpjb25zdCBJTlZfUEhJID0gMSAvIFBISTsKCi8vIFZlcnRpY2VzIG9mIGEgZG9kZWNhaGVkcm9uIChleGNlcHQgdGhlIG9wcG9zaXRlcywgd2hpY2ggcmVwcmVzZW50IHRoZQovLyBzYW1lIGF4aXMpLCB1c2VkIGFzIGF4aXMgZGlyZWN0aW9ucyBldmVubHkgc3ByZWFkIG9uIGEgc3BoZXJlLgpjb25zdCBfYXhpc0RpcmVjdGlvbnMgPSBbCgkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAxLCAxLCAxICksCgkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAtIDEsIDEsIDEgKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDEsIC0gMSApLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLSAxLCAxLCAtIDEgKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIFBISSwgSU5WX1BISSApLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgUEhJLCAtIElOVl9QSEkgKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIElOVl9QSEksIDAsIFBISSApLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLSBJTlZfUEhJLCAwLCBQSEkgKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIFBISSwgSU5WX1BISSwgMCApLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLSBQSEksIElOVl9QSEksIDAgKSBdOwoKLyoqCiAqIFRoaXMgY2xhc3MgZ2VuZXJhdGVzIGEgUHJlZmlsdGVyZWQsIE1pcG1hcHBlZCBSYWRpYW5jZSBFbnZpcm9ubWVudCBNYXAKICogKFBNUkVNKSBmcm9tIGEgY3ViZU1hcCBlbnZpcm9ubWVudCB0ZXh0dXJlLiBUaGlzIGFsbG93cyBkaWZmZXJlbnQgbGV2ZWxzIG9mCiAqIGJsdXIgdG8gYmUgcXVpY2tseSBhY2Nlc3NlZCBiYXNlZCBvbiBtYXRlcmlhbCByb3VnaG5lc3MuIEl0IGlzIHBhY2tlZCBpbnRvIGEKICogc3BlY2lhbCBDdWJlVVYgZm9ybWF0IHRoYXQgYWxsb3dzIHVzIHRvIHBlcmZvcm0gY3VzdG9tIGludGVycG9sYXRpb24gc28gdGhhdAogKiB3ZSBjYW4gc3VwcG9ydCBub25saW5lYXIgZm9ybWF0cyBzdWNoIGFzIFJHQkUuIFVubGlrZSBhIHRyYWRpdGlvbmFsIG1pcG1hcAogKiBjaGFpbiwgaXQgb25seSBnb2VzIGRvd24gdG8gdGhlIExPRF9NSU4gbGV2ZWwgKGFib3ZlKSwgYW5kIHRoZW4gY3JlYXRlcyBleHRyYQogKiBldmVuIG1vcmUgZmlsdGVyZWQgJ21pcHMnIGF0IHRoZSBzYW1lIExPRF9NSU4gcmVzb2x1dGlvbiwgYXNzb2NpYXRlZCB3aXRoCiAqIGhpZ2hlciByb3VnaG5lc3MgbGV2ZWxzLiBJbiB0aGlzIHdheSB3ZSBtYWludGFpbiByZXNvbHV0aW9uIHRvIHNtb290aGx5CiAqIGludGVycG9sYXRlIGRpZmZ1c2UgbGlnaHRpbmcgd2hpbGUgbGltaXRpbmcgc2FtcGxpbmcgY29tcHV0YXRpb24uCiAqCiAqIFBhcGVyOiBGYXN0LCBBY2N1cmF0ZSBJbWFnZS1CYXNlZCBMaWdodGluZwogKiBodHRwczovL2RyaXZlLmdvb2dsZS5jb20vZmlsZS9kLzE1eThyX1VwS2xVOVN2VjRJTGIwQzNxQ1BlY1M4cHZMei92aWV3CiovCgpjbGFzcyBQTVJFTUdlbmVyYXRvciB7CgoJY29uc3RydWN0b3IoIHJlbmRlcmVyICkgewoKCQl0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyOwoJCXRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJdGhpcy5fbG9kTWF4ID0gMDsKCQl0aGlzLl9jdWJlU2l6ZSA9IDA7CgkJdGhpcy5fbG9kUGxhbmVzID0gW107CgkJdGhpcy5fc2l6ZUxvZHMgPSBbXTsKCQl0aGlzLl9zaWdtYXMgPSBbXTsKCgkJdGhpcy5fYmx1ck1hdGVyaWFsID0gbnVsbDsKCQl0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgPSBudWxsOwoJCXRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgPSBudWxsOwoKCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2JsdXJNYXRlcmlhbCApOwoKCX0KCgkvKioKCSAqIEdlbmVyYXRlcyBhIFBNUkVNIGZyb20gYSBzdXBwbGllZCBTY2VuZSwgd2hpY2ggY2FuIGJlIGZhc3RlciB0aGFuIHVzaW5nIGFuCgkgKiBpbWFnZSBpZiBuZXR3b3JraW5nIGJhbmR3aWR0aCBpcyBsb3cuIE9wdGlvbmFsIHNpZ21hIHNwZWNpZmllcyBhIGJsdXIgcmFkaXVzCgkgKiBpbiByYWRpYW5zIHRvIGJlIGFwcGxpZWQgdG8gdGhlIHNjZW5lIGJlZm9yZSBQTVJFTSBnZW5lcmF0aW9uLiBPcHRpb25hbCBuZWFyCgkgKiBhbmQgZmFyIHBsYW5lcyBlbnN1cmUgdGhlIHNjZW5lIGlzIHJlbmRlcmVkIGluIGl0cyBlbnRpcmV0eSAodGhlIGN1YmVDYW1lcmEKCSAqIGlzIHBsYWNlZCBhdCB0aGUgb3JpZ2luKS4KCSAqLwoJZnJvbVNjZW5lKCBzY2VuZSwgc2lnbWEgPSAwLCBuZWFyID0gMC4xLCBmYXIgPSAxMDAgKSB7CgoJCV9vbGRUYXJnZXQgPSB0aGlzLl9yZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCQlfb2xkQWN0aXZlQ3ViZUZhY2UgPSB0aGlzLl9yZW5kZXJlci5nZXRBY3RpdmVDdWJlRmFjZSgpOwoJCV9vbGRBY3RpdmVNaXBtYXBMZXZlbCA9IHRoaXMuX3JlbmRlcmVyLmdldEFjdGl2ZU1pcG1hcExldmVsKCk7CgoJCXRoaXMuX3NldFNpemUoIDI1NiApOwoKCQljb25zdCBjdWJlVVZSZW5kZXJUYXJnZXQgPSB0aGlzLl9hbGxvY2F0ZVRhcmdldHMoKTsKCQljdWJlVVZSZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgPSB0cnVlOwoKCQl0aGlzLl9zY2VuZVRvQ3ViZVVWKCBzY2VuZSwgbmVhciwgZmFyLCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCgkJaWYgKCBzaWdtYSA+IDAgKSB7CgoJCQl0aGlzLl9ibHVyKCBjdWJlVVZSZW5kZXJUYXJnZXQsIDAsIDAsIHNpZ21hICk7CgoJCX0KCgkJdGhpcy5fYXBwbHlQTVJFTSggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CgkJdGhpcy5fY2xlYW51cCggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CgoJCXJldHVybiBjdWJlVVZSZW5kZXJUYXJnZXQ7CgoJfQoKCS8qKgoJICogR2VuZXJhdGVzIGEgUE1SRU0gZnJvbSBhbiBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZSwgd2hpY2ggY2FuIGJlIGVpdGhlciBMRFIKCSAqIG9yIEhEUi4gVGhlIGlkZWFsIGlucHV0IGltYWdlIHNpemUgaXMgMWsgKDEwMjQgeCA1MTIpLAoJICogYXMgdGhpcyBtYXRjaGVzIGJlc3Qgd2l0aCB0aGUgMjU2IHggMjU2IGN1YmVtYXAgb3V0cHV0LgoJICovCglmcm9tRXF1aXJlY3Rhbmd1bGFyKCBlcXVpcmVjdGFuZ3VsYXIsIHJlbmRlclRhcmdldCA9IG51bGwgKSB7CgoJCXJldHVybiB0aGlzLl9mcm9tVGV4dHVyZSggZXF1aXJlY3Rhbmd1bGFyLCByZW5kZXJUYXJnZXQgKTsKCgl9CgoJLyoqCgkgKiBHZW5lcmF0ZXMgYSBQTVJFTSBmcm9tIGFuIGN1YmVtYXAgdGV4dHVyZSwgd2hpY2ggY2FuIGJlIGVpdGhlciBMRFIKCSAqIG9yIEhEUi4gVGhlIGlkZWFsIGlucHV0IGN1YmUgc2l6ZSBpcyAyNTYgeCAyNTYsCgkgKiBhcyB0aGlzIG1hdGNoZXMgYmVzdCB3aXRoIHRoZSAyNTYgeCAyNTYgY3ViZW1hcCBvdXRwdXQuCgkgKi8KCWZyb21DdWJlbWFwKCBjdWJlbWFwLCByZW5kZXJUYXJnZXQgPSBudWxsICkgewoKCQlyZXR1cm4gdGhpcy5fZnJvbVRleHR1cmUoIGN1YmVtYXAsIHJlbmRlclRhcmdldCApOwoKCX0KCgkvKioKCSAqIFByZS1jb21waWxlcyB0aGUgY3ViZW1hcCBzaGFkZXIuIFlvdSBjYW4gZ2V0IGZhc3RlciBzdGFydC11cCBieSBpbnZva2luZyB0aGlzIG1ldGhvZCBkdXJpbmcKCSAqIHlvdXIgdGV4dHVyZSdzIG5ldHdvcmsgZmV0Y2ggZm9yIGluY3JlYXNlZCBjb25jdXJyZW5jeS4KCSAqLwoJY29tcGlsZUN1YmVtYXBTaGFkZXIoKSB7CgoJCWlmICggdGhpcy5fY3ViZW1hcE1hdGVyaWFsID09PSBudWxsICkgewoKCQkJdGhpcy5fY3ViZW1hcE1hdGVyaWFsID0gX2dldEN1YmVtYXBNYXRlcmlhbCgpOwoJCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCApOwoKCQl9CgoJfQoKCS8qKgoJICogUHJlLWNvbXBpbGVzIHRoZSBlcXVpcmVjdGFuZ3VsYXIgc2hhZGVyLiBZb3UgY2FuIGdldCBmYXN0ZXIgc3RhcnQtdXAgYnkgaW52b2tpbmcgdGhpcyBtZXRob2QgZHVyaW5nCgkgKiB5b3VyIHRleHR1cmUncyBuZXR3b3JrIGZldGNoIGZvciBpbmNyZWFzZWQgY29uY3VycmVuY3kuCgkgKi8KCWNvbXBpbGVFcXVpcmVjdGFuZ3VsYXJTaGFkZXIoKSB7CgoJCWlmICggdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9PT0gbnVsbCApIHsKCgkJCXRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgPSBfZ2V0RXF1aXJlY3RNYXRlcmlhbCgpOwoJCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgKTsKCgkJfQoKCX0KCgkvKioKCSAqIERpc3Bvc2VzIG9mIHRoZSBQTVJFTUdlbmVyYXRvcidzIGludGVybmFsIG1lbW9yeS4gTm90ZSB0aGF0IFBNUkVNR2VuZXJhdG9yIGlzIGEgc3RhdGljIGNsYXNzLAoJICogc28geW91IHNob3VsZCBub3QgbmVlZCBtb3JlIHRoYW4gb25lIFBNUkVNR2VuZXJhdG9yIG9iamVjdC4gSWYgeW91IGRvLCBjYWxsaW5nIGRpc3Bvc2UoKSBvbgoJICogb25lIG9mIHRoZW0gd2lsbCBjYXVzZSBhbnkgb3RoZXJzIHRvIGFsc28gYmVjb21lIHVudXNhYmxlLgoJICovCglkaXNwb3NlKCkgewoKCQl0aGlzLl9kaXNwb3NlKCk7CgoJCWlmICggdGhpcy5fY3ViZW1hcE1hdGVyaWFsICE9PSBudWxsICkgdGhpcy5fY3ViZW1hcE1hdGVyaWFsLmRpc3Bvc2UoKTsKCQlpZiAoIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9CgoJLy8gcHJpdmF0ZSBpbnRlcmZhY2UKCglfc2V0U2l6ZSggY3ViZVNpemUgKSB7CgoJCXRoaXMuX2xvZE1heCA9IE1hdGguZmxvb3IoIE1hdGgubG9nMiggY3ViZVNpemUgKSApOwoJCXRoaXMuX2N1YmVTaXplID0gTWF0aC5wb3coIDIsIHRoaXMuX2xvZE1heCApOwoKCX0KCglfZGlzcG9zZSgpIHsKCgkJaWYgKCB0aGlzLl9ibHVyTWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLl9ibHVyTWF0ZXJpYWwuZGlzcG9zZSgpOwoKCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQuZGlzcG9zZSgpOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLl9sb2RQbGFuZXMubGVuZ3RoOyBpICsrICkgewoKCQkJdGhpcy5fbG9kUGxhbmVzWyBpIF0uZGlzcG9zZSgpOwoKCQl9CgoJfQoKCV9jbGVhbnVwKCBvdXRwdXRUYXJnZXQgKSB7CgoJCXRoaXMuX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldCggX29sZFRhcmdldCwgX29sZEFjdGl2ZUN1YmVGYWNlLCBfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlvdXRwdXRUYXJnZXQuc2Npc3NvclRlc3QgPSBmYWxzZTsKCQlfc2V0Vmlld3BvcnQoIG91dHB1dFRhcmdldCwgMCwgMCwgb3V0cHV0VGFyZ2V0LndpZHRoLCBvdXRwdXRUYXJnZXQuaGVpZ2h0ICk7CgoJfQoKCV9mcm9tVGV4dHVyZSggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICkgewoKCQlpZiAoIHRleHR1cmUubWFwcGluZyA9PT0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nIHx8IHRleHR1cmUubWFwcGluZyA9PT0gQ3ViZVJlZnJhY3Rpb25NYXBwaW5nICkgewoKCQkJdGhpcy5fc2V0U2l6ZSggdGV4dHVyZS5pbWFnZS5sZW5ndGggPT09IDAgPyAxNiA6ICggdGV4dHVyZS5pbWFnZVsgMCBdLndpZHRoIHx8IHRleHR1cmUuaW1hZ2VbIDAgXS5pbWFnZS53aWR0aCApICk7CgoJCX0gZWxzZSB7IC8vIEVxdWlyZWN0YW5ndWxhcgoKCQkJdGhpcy5fc2V0U2l6ZSggdGV4dHVyZS5pbWFnZS53aWR0aCAvIDQgKTsKCgkJfQoKCQlfb2xkVGFyZ2V0ID0gdGhpcy5fcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgkJX29sZEFjdGl2ZUN1YmVGYWNlID0gdGhpcy5fcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKCQlfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgPSB0aGlzLl9yZW5kZXJlci5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwoKCQljb25zdCBjdWJlVVZSZW5kZXJUYXJnZXQgPSByZW5kZXJUYXJnZXQgfHwgdGhpcy5fYWxsb2NhdGVUYXJnZXRzKCk7CgkJdGhpcy5fdGV4dHVyZVRvQ3ViZVVWKCB0ZXh0dXJlLCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCQl0aGlzLl9hcHBseVBNUkVNKCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCQl0aGlzLl9jbGVhbnVwKCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCgkJcmV0dXJuIGN1YmVVVlJlbmRlclRhcmdldDsKCgl9CgoJX2FsbG9jYXRlVGFyZ2V0cygpIHsKCgkJY29uc3Qgd2lkdGggPSAzICogTWF0aC5tYXgoIHRoaXMuX2N1YmVTaXplLCAxNiAqIDcgKTsKCQljb25zdCBoZWlnaHQgPSA0ICogdGhpcy5fY3ViZVNpemU7CgoJCWNvbnN0IHBhcmFtcyA9IHsKCQkJbWFnRmlsdGVyOiBMaW5lYXJGaWx0ZXIsCgkJCW1pbkZpbHRlcjogTGluZWFyRmlsdGVyLAoJCQlnZW5lcmF0ZU1pcG1hcHM6IGZhbHNlLAoJCQl0eXBlOiBIYWxmRmxvYXRUeXBlLAoJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCgkJCWNvbG9yU3BhY2U6IExpbmVhclNSR0JDb2xvclNwYWNlLAoJCQlkZXB0aEJ1ZmZlcjogZmFsc2UKCQl9OwoKCQljb25zdCBjdWJlVVZSZW5kZXJUYXJnZXQgPSBfY3JlYXRlUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKTsKCgkJaWYgKCB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldCA9PT0gbnVsbCB8fCB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldC53aWR0aCAhPT0gd2lkdGggfHwgdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQuaGVpZ2h0ICE9PSBoZWlnaHQgKSB7CgoJCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgewoKCQkJCXRoaXMuX2Rpc3Bvc2UoKTsKCgkJCX0KCgkJCXRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID0gX2NyZWF0ZVJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgoJCQljb25zdCB7IF9sb2RNYXggfSA9IHRoaXM7CgkJCSggeyBzaXplTG9kczogdGhpcy5fc2l6ZUxvZHMsIGxvZFBsYW5lczogdGhpcy5fbG9kUGxhbmVzLCBzaWdtYXM6IHRoaXMuX3NpZ21hcyB9ID0gX2NyZWF0ZVBsYW5lcyggX2xvZE1heCApICk7CgoJCQl0aGlzLl9ibHVyTWF0ZXJpYWwgPSBfZ2V0Qmx1clNoYWRlciggX2xvZE1heCwgd2lkdGgsIGhlaWdodCApOwoKCQl9CgoJCXJldHVybiBjdWJlVVZSZW5kZXJUYXJnZXQ7CgoJfQoKCV9jb21waWxlTWF0ZXJpYWwoIG1hdGVyaWFsICkgewoKCQljb25zdCB0bXBNZXNoID0gbmV3IE1lc2goIHRoaXMuX2xvZFBsYW5lc1sgMCBdLCBtYXRlcmlhbCApOwoJCXRoaXMuX3JlbmRlcmVyLmNvbXBpbGUoIHRtcE1lc2gsIF9mbGF0Q2FtZXJhICk7CgoJfQoKCV9zY2VuZVRvQ3ViZVVWKCBzY2VuZSwgbmVhciwgZmFyLCBjdWJlVVZSZW5kZXJUYXJnZXQgKSB7CgoJCWNvbnN0IGZvdiA9IDkwOwoJCWNvbnN0IGFzcGVjdCA9IDE7CgkJY29uc3QgY3ViZUNhbWVyYSA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggZm92LCBhc3BlY3QsIG5lYXIsIGZhciApOwoJCWNvbnN0IHVwU2lnbiA9IFsgMSwgLSAxLCAxLCAxLCAxLCAxIF07CgkJY29uc3QgZm9yd2FyZFNpZ24gPSBbIDEsIDEsIDEsIC0gMSwgLSAxLCAtIDEgXTsKCQljb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwoKCQljb25zdCBvcmlnaW5hbEF1dG9DbGVhciA9IHJlbmRlcmVyLmF1dG9DbGVhcjsKCQljb25zdCB0b25lTWFwcGluZyA9IHJlbmRlcmVyLnRvbmVNYXBwaW5nOwoJCXJlbmRlcmVyLmdldENsZWFyQ29sb3IoIF9jbGVhckNvbG9yICk7CgoJCXJlbmRlcmVyLnRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCQlyZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTsKCgkJY29uc3QgYmFja2dyb3VuZE1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7CgkJCW5hbWU6ICdQTVJFTS5CYWNrZ3JvdW5kJywKCQkJc2lkZTogQmFja1NpZGUsCgkJCWRlcHRoV3JpdGU6IGZhbHNlLAoJCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCX0gKTsKCgkJY29uc3QgYmFja2dyb3VuZEJveCA9IG5ldyBNZXNoKCBuZXcgQm94R2VvbWV0cnkoKSwgYmFja2dyb3VuZE1hdGVyaWFsICk7CgoJCWxldCB1c2VTb2xpZENvbG9yID0gZmFsc2U7CgkJY29uc3QgYmFja2dyb3VuZCA9IHNjZW5lLmJhY2tncm91bmQ7CgoJCWlmICggYmFja2dyb3VuZCApIHsKCgkJCWlmICggYmFja2dyb3VuZC5pc0NvbG9yICkgewoKCQkJCWJhY2tncm91bmRNYXRlcmlhbC5jb2xvci5jb3B5KCBiYWNrZ3JvdW5kICk7CgkJCQlzY2VuZS5iYWNrZ3JvdW5kID0gbnVsbDsKCQkJCXVzZVNvbGlkQ29sb3IgPSB0cnVlOwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJYmFja2dyb3VuZE1hdGVyaWFsLmNvbG9yLmNvcHkoIF9jbGVhckNvbG9yICk7CgkJCXVzZVNvbGlkQ29sb3IgPSB0cnVlOwoKCQl9CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQljb25zdCBjb2wgPSBpICUgMzsKCgkJCWlmICggY29sID09PSAwICkgewoKCQkJCWN1YmVDYW1lcmEudXAuc2V0KCAwLCB1cFNpZ25bIGkgXSwgMCApOwoJCQkJY3ViZUNhbWVyYS5sb29rQXQoIGZvcndhcmRTaWduWyBpIF0sIDAsIDAgKTsKCgkJCX0gZWxzZSBpZiAoIGNvbCA9PT0gMSApIHsKCgkJCQljdWJlQ2FtZXJhLnVwLnNldCggMCwgMCwgdXBTaWduWyBpIF0gKTsKCQkJCWN1YmVDYW1lcmEubG9va0F0KCAwLCBmb3J3YXJkU2lnblsgaSBdLCAwICk7CgoJCQl9IGVsc2UgewoKCQkJCWN1YmVDYW1lcmEudXAuc2V0KCAwLCB1cFNpZ25bIGkgXSwgMCApOwoJCQkJY3ViZUNhbWVyYS5sb29rQXQoIDAsIDAsIGZvcndhcmRTaWduWyBpIF0gKTsKCgkJCX0KCgkJCWNvbnN0IHNpemUgPSB0aGlzLl9jdWJlU2l6ZTsKCgkJCV9zZXRWaWV3cG9ydCggY3ViZVVWUmVuZGVyVGFyZ2V0LCBjb2wgKiBzaXplLCBpID4gMiA/IHNpemUgOiAwLCBzaXplLCBzaXplICk7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1YmVVVlJlbmRlclRhcmdldCApOwoKCQkJaWYgKCB1c2VTb2xpZENvbG9yICkgewoKCQkJCXJlbmRlcmVyLnJlbmRlciggYmFja2dyb3VuZEJveCwgY3ViZUNhbWVyYSApOwoKCQkJfQoKCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY3ViZUNhbWVyYSApOwoKCQl9CgoJCWJhY2tncm91bmRCb3guZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCWJhY2tncm91bmRCb3gubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCQlyZW5kZXJlci50b25lTWFwcGluZyA9IHRvbmVNYXBwaW5nOwoJCXJlbmRlcmVyLmF1dG9DbGVhciA9IG9yaWdpbmFsQXV0b0NsZWFyOwoJCXNjZW5lLmJhY2tncm91bmQgPSBiYWNrZ3JvdW5kOwoKCX0KCglfdGV4dHVyZVRvQ3ViZVVWKCB0ZXh0dXJlLCBjdWJlVVZSZW5kZXJUYXJnZXQgKSB7CgoJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CgoJCWNvbnN0IGlzQ3ViZVRleHR1cmUgPSAoIHRleHR1cmUubWFwcGluZyA9PT0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nIHx8IHRleHR1cmUubWFwcGluZyA9PT0gQ3ViZVJlZnJhY3Rpb25NYXBwaW5nICk7CgoJCWlmICggaXNDdWJlVGV4dHVyZSApIHsKCgkJCWlmICggdGhpcy5fY3ViZW1hcE1hdGVyaWFsID09PSBudWxsICkgewoKCQkJCXRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9IF9nZXRDdWJlbWFwTWF0ZXJpYWwoKTsKCgkJCX0KCgkJCXRoaXMuX2N1YmVtYXBNYXRlcmlhbC51bmlmb3Jtcy5mbGlwRW52TWFwLnZhbHVlID0gKCB0ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgKSA/IC0gMSA6IDE7CgoJCX0gZWxzZSB7CgoJCQlpZiAoIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgPT09IG51bGwgKSB7CgoJCQkJdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9IF9nZXRFcXVpcmVjdE1hdGVyaWFsKCk7CgoJCQl9CgoJCX0KCgkJY29uc3QgbWF0ZXJpYWwgPSBpc0N1YmVUZXh0dXJlID8gdGhpcy5fY3ViZW1hcE1hdGVyaWFsIDogdGhpcy5fZXF1aXJlY3RNYXRlcmlhbDsKCQljb25zdCBtZXNoID0gbmV3IE1lc2goIHRoaXMuX2xvZFBsYW5lc1sgMCBdLCBtYXRlcmlhbCApOwoKCQljb25zdCB1bmlmb3JtcyA9IG1hdGVyaWFsLnVuaWZvcm1zOwoKCQl1bmlmb3Jtc1sgJ2Vudk1hcCcgXS52YWx1ZSA9IHRleHR1cmU7CgoJCWNvbnN0IHNpemUgPSB0aGlzLl9jdWJlU2l6ZTsKCgkJX3NldFZpZXdwb3J0KCBjdWJlVVZSZW5kZXJUYXJnZXQsIDAsIDAsIDMgKiBzaXplLCAyICogc2l6ZSApOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCXJlbmRlcmVyLnJlbmRlciggbWVzaCwgX2ZsYXRDYW1lcmEgKTsKCgl9CgoJX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApIHsKCgkJY29uc3QgcmVuZGVyZXIgPSB0aGlzLl9yZW5kZXJlcjsKCQljb25zdCBhdXRvQ2xlYXIgPSByZW5kZXJlci5hdXRvQ2xlYXI7CgkJcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7CgoJCWZvciAoIGxldCBpID0gMTsgaSA8IHRoaXMuX2xvZFBsYW5lcy5sZW5ndGg7IGkgKysgKSB7CgoJCQljb25zdCBzaWdtYSA9IE1hdGguc3FydCggdGhpcy5fc2lnbWFzWyBpIF0gKiB0aGlzLl9zaWdtYXNbIGkgXSAtIHRoaXMuX3NpZ21hc1sgaSAtIDEgXSAqIHRoaXMuX3NpZ21hc1sgaSAtIDEgXSApOwoKCQkJY29uc3QgcG9sZUF4aXMgPSBfYXhpc0RpcmVjdGlvbnNbICggaSAtIDEgKSAlIF9heGlzRGlyZWN0aW9ucy5sZW5ndGggXTsKCgkJCXRoaXMuX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgaSAtIDEsIGksIHNpZ21hLCBwb2xlQXhpcyApOwoKCQl9CgoJCXJlbmRlcmVyLmF1dG9DbGVhciA9IGF1dG9DbGVhcjsKCgl9CgoJLyoqCgkgKiBUaGlzIGlzIGEgdHdvLXBhc3MgR2F1c3NpYW4gYmx1ciBmb3IgYSBjdWJlbWFwLiBOb3JtYWxseSB0aGlzIGlzIGRvbmUKCSAqIHZlcnRpY2FsbHkgYW5kIGhvcml6b250YWxseSwgYnV0IHRoaXMgYnJlYWtzIGRvd24gb24gYSBjdWJlLiBIZXJlIHdlIGFwcGx5CgkgKiB0aGUgYmx1ciBsYXRpdHVkaW5hbGx5IChhcm91bmQgdGhlIHBvbGVzKSwgYW5kIHRoZW4gbG9uZ2l0dWRpbmFsbHkgKHRvd2FyZHMKCSAqIHRoZSBwb2xlcykgdG8gYXBwcm94aW1hdGUgdGhlIG9ydGhvZ29uYWxseS1zZXBhcmFibGUgYmx1ci4gSXQgaXMgbGVhc3QKCSAqIGFjY3VyYXRlIGF0IHRoZSBwb2xlcywgYnV0IHN0aWxsIGRvZXMgYSBkZWNlbnQgam9iLgoJICovCglfYmx1ciggY3ViZVVWUmVuZGVyVGFyZ2V0LCBsb2RJbiwgbG9kT3V0LCBzaWdtYSwgcG9sZUF4aXMgKSB7CgoJCWNvbnN0IHBpbmdQb25nUmVuZGVyVGFyZ2V0ID0gdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQ7CgoJCXRoaXMuX2hhbGZCbHVyKAoJCQljdWJlVVZSZW5kZXJUYXJnZXQsCgkJCXBpbmdQb25nUmVuZGVyVGFyZ2V0LAoJCQlsb2RJbiwKCQkJbG9kT3V0LAoJCQlzaWdtYSwKCQkJJ2xhdGl0dWRpbmFsJywKCQkJcG9sZUF4aXMgKTsKCgkJdGhpcy5faGFsZkJsdXIoCgkJCXBpbmdQb25nUmVuZGVyVGFyZ2V0LAoJCQljdWJlVVZSZW5kZXJUYXJnZXQsCgkJCWxvZE91dCwKCQkJbG9kT3V0LAoJCQlzaWdtYSwKCQkJJ2xvbmdpdHVkaW5hbCcsCgkJCXBvbGVBeGlzICk7CgoJfQoKCV9oYWxmQmx1ciggdGFyZ2V0SW4sIHRhcmdldE91dCwgbG9kSW4sIGxvZE91dCwgc2lnbWFSYWRpYW5zLCBkaXJlY3Rpb24sIHBvbGVBeGlzICkgewoKCQljb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwoJCWNvbnN0IGJsdXJNYXRlcmlhbCA9IHRoaXMuX2JsdXJNYXRlcmlhbDsKCgkJaWYgKCBkaXJlY3Rpb24gIT09ICdsYXRpdHVkaW5hbCcgJiYgZGlyZWN0aW9uICE9PSAnbG9uZ2l0dWRpbmFsJyApIHsKCgkJCWNvbnNvbGUuZXJyb3IoCgkJCQknYmx1ciBkaXJlY3Rpb24gbXVzdCBiZSBlaXRoZXIgbGF0aXR1ZGluYWwgb3IgbG9uZ2l0dWRpbmFsIScgKTsKCgkJfQoKCQkvLyBOdW1iZXIgb2Ygc3RhbmRhcmQgZGV2aWF0aW9ucyBhdCB3aGljaCB0byBjdXQgb2ZmIHRoZSBkaXNjcmV0ZSBhcHByb3hpbWF0aW9uLgoJCWNvbnN0IFNUQU5EQVJEX0RFVklBVElPTlMgPSAzOwoKCQljb25zdCBibHVyTWVzaCA9IG5ldyBNZXNoKCB0aGlzLl9sb2RQbGFuZXNbIGxvZE91dCBdLCBibHVyTWF0ZXJpYWwgKTsKCQljb25zdCBibHVyVW5pZm9ybXMgPSBibHVyTWF0ZXJpYWwudW5pZm9ybXM7CgoJCWNvbnN0IHBpeGVscyA9IHRoaXMuX3NpemVMb2RzWyBsb2RJbiBdIC0gMTsKCQljb25zdCByYWRpYW5zUGVyUGl4ZWwgPSBpc0Zpbml0ZSggc2lnbWFSYWRpYW5zICkgPyBNYXRoLlBJIC8gKCAyICogcGl4ZWxzICkgOiAyICogTWF0aC5QSSAvICggMiAqIE1BWF9TQU1QTEVTIC0gMSApOwoJCWNvbnN0IHNpZ21hUGl4ZWxzID0gc2lnbWFSYWRpYW5zIC8gcmFkaWFuc1BlclBpeGVsOwoJCWNvbnN0IHNhbXBsZXMgPSBpc0Zpbml0ZSggc2lnbWFSYWRpYW5zICkgPyAxICsgTWF0aC5mbG9vciggU1RBTkRBUkRfREVWSUFUSU9OUyAqIHNpZ21hUGl4ZWxzICkgOiBNQVhfU0FNUExFUzsKCgkJaWYgKCBzYW1wbGVzID4gTUFYX1NBTVBMRVMgKSB7CgoJCQljb25zb2xlLndhcm4oIGBzaWdtYVJhZGlhbnMsICR7CgkJCQlzaWdtYVJhZGlhbnN9LCBpcyB0b28gbGFyZ2UgYW5kIHdpbGwgY2xpcCwgYXMgaXQgcmVxdWVzdGVkICR7CgkJCQlzYW1wbGVzfSBzYW1wbGVzIHdoZW4gdGhlIG1heGltdW0gaXMgc2V0IHRvICR7TUFYX1NBTVBMRVN9YCApOwoKCQl9CgoJCWNvbnN0IHdlaWdodHMgPSBbXTsKCQlsZXQgc3VtID0gMDsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgTUFYX1NBTVBMRVM7ICsrIGkgKSB7CgoJCQljb25zdCB4ID0gaSAvIHNpZ21hUGl4ZWxzOwoJCQljb25zdCB3ZWlnaHQgPSBNYXRoLmV4cCggLSB4ICogeCAvIDIgKTsKCQkJd2VpZ2h0cy5wdXNoKCB3ZWlnaHQgKTsKCgkJCWlmICggaSA9PT0gMCApIHsKCgkJCQlzdW0gKz0gd2VpZ2h0OwoKCQkJfSBlbHNlIGlmICggaSA8IHNhbXBsZXMgKSB7CgoJCQkJc3VtICs9IDIgKiB3ZWlnaHQ7CgoJCQl9CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgd2VpZ2h0cy5sZW5ndGg7IGkgKysgKSB7CgoJCQl3ZWlnaHRzWyBpIF0gPSB3ZWlnaHRzWyBpIF0gLyBzdW07CgoJCX0KCgkJYmx1clVuaWZvcm1zWyAnZW52TWFwJyBdLnZhbHVlID0gdGFyZ2V0SW4udGV4dHVyZTsKCQlibHVyVW5pZm9ybXNbICdzYW1wbGVzJyBdLnZhbHVlID0gc2FtcGxlczsKCQlibHVyVW5pZm9ybXNbICd3ZWlnaHRzJyBdLnZhbHVlID0gd2VpZ2h0czsKCQlibHVyVW5pZm9ybXNbICdsYXRpdHVkaW5hbCcgXS52YWx1ZSA9IGRpcmVjdGlvbiA9PT0gJ2xhdGl0dWRpbmFsJzsKCgkJaWYgKCBwb2xlQXhpcyApIHsKCgkJCWJsdXJVbmlmb3Jtc1sgJ3BvbGVBeGlzJyBdLnZhbHVlID0gcG9sZUF4aXM7CgoJCX0KCgkJY29uc3QgeyBfbG9kTWF4IH0gPSB0aGlzOwoJCWJsdXJVbmlmb3Jtc1sgJ2RUaGV0YScgXS52YWx1ZSA9IHJhZGlhbnNQZXJQaXhlbDsKCQlibHVyVW5pZm9ybXNbICdtaXBJbnQnIF0udmFsdWUgPSBfbG9kTWF4IC0gbG9kSW47CgoJCWNvbnN0IG91dHB1dFNpemUgPSB0aGlzLl9zaXplTG9kc1sgbG9kT3V0IF07CgkJY29uc3QgeCA9IDMgKiBvdXRwdXRTaXplICogKCBsb2RPdXQgPiBfbG9kTWF4IC0gTE9EX01JTiA/IGxvZE91dCAtIF9sb2RNYXggKyBMT0RfTUlOIDogMCApOwoJCWNvbnN0IHkgPSA0ICogKCB0aGlzLl9jdWJlU2l6ZSAtIG91dHB1dFNpemUgKTsKCgkJX3NldFZpZXdwb3J0KCB0YXJnZXRPdXQsIHgsIHksIDMgKiBvdXRwdXRTaXplLCAyICogb3V0cHV0U2l6ZSApOwoJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggdGFyZ2V0T3V0ICk7CgkJcmVuZGVyZXIucmVuZGVyKCBibHVyTWVzaCwgX2ZsYXRDYW1lcmEgKTsKCgl9Cgp9CgoKCmZ1bmN0aW9uIF9jcmVhdGVQbGFuZXMoIGxvZE1heCApIHsKCgljb25zdCBsb2RQbGFuZXMgPSBbXTsKCWNvbnN0IHNpemVMb2RzID0gW107Cgljb25zdCBzaWdtYXMgPSBbXTsKCglsZXQgbG9kID0gbG9kTWF4OwoKCWNvbnN0IHRvdGFsTG9kcyA9IGxvZE1heCAtIExPRF9NSU4gKyAxICsgRVhUUkFfTE9EX1NJR01BLmxlbmd0aDsKCglmb3IgKCBsZXQgaSA9IDA7IGkgPCB0b3RhbExvZHM7IGkgKysgKSB7CgoJCWNvbnN0IHNpemVMb2QgPSBNYXRoLnBvdyggMiwgbG9kICk7CgkJc2l6ZUxvZHMucHVzaCggc2l6ZUxvZCApOwoJCWxldCBzaWdtYSA9IDEuMCAvIHNpemVMb2Q7CgoJCWlmICggaSA+IGxvZE1heCAtIExPRF9NSU4gKSB7CgoJCQlzaWdtYSA9IEVYVFJBX0xPRF9TSUdNQVsgaSAtIGxvZE1heCArIExPRF9NSU4gLSAxIF07CgoJCX0gZWxzZSBpZiAoIGkgPT09IDAgKSB7CgoJCQlzaWdtYSA9IDA7CgoJCX0KCgkJc2lnbWFzLnB1c2goIHNpZ21hICk7CgoJCWNvbnN0IHRleGVsU2l6ZSA9IDEuMCAvICggc2l6ZUxvZCAtIDIgKTsKCQljb25zdCBtaW4gPSAtIHRleGVsU2l6ZTsKCQljb25zdCBtYXggPSAxICsgdGV4ZWxTaXplOwoJCWNvbnN0IHV2MSA9IFsgbWluLCBtaW4sIG1heCwgbWluLCBtYXgsIG1heCwgbWluLCBtaW4sIG1heCwgbWF4LCBtaW4sIG1heCBdOwoKCQljb25zdCBjdWJlRmFjZXMgPSA2OwoJCWNvbnN0IHZlcnRpY2VzID0gNjsKCQljb25zdCBwb3NpdGlvblNpemUgPSAzOwoJCWNvbnN0IHV2U2l6ZSA9IDI7CgkJY29uc3QgZmFjZUluZGV4U2l6ZSA9IDE7CgoJCWNvbnN0IHBvc2l0aW9uID0gbmV3IEZsb2F0MzJBcnJheSggcG9zaXRpb25TaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMgKTsKCQljb25zdCB1diA9IG5ldyBGbG9hdDMyQXJyYXkoIHV2U2l6ZSAqIHZlcnRpY2VzICogY3ViZUZhY2VzICk7CgkJY29uc3QgZmFjZUluZGV4ID0gbmV3IEZsb2F0MzJBcnJheSggZmFjZUluZGV4U2l6ZSAqIHZlcnRpY2VzICogY3ViZUZhY2VzICk7CgoJCWZvciAoIGxldCBmYWNlID0gMDsgZmFjZSA8IGN1YmVGYWNlczsgZmFjZSArKyApIHsKCgkJCWNvbnN0IHggPSAoIGZhY2UgJSAzICkgKiAyIC8gMyAtIDE7CgkJCWNvbnN0IHkgPSBmYWNlID4gMiA/IDAgOiAtIDE7CgkJCWNvbnN0IGNvb3JkaW5hdGVzID0gWwoJCQkJeCwgeSwgMCwKCQkJCXggKyAyIC8gMywgeSwgMCwKCQkJCXggKyAyIC8gMywgeSArIDEsIDAsCgkJCQl4LCB5LCAwLAoJCQkJeCArIDIgLyAzLCB5ICsgMSwgMCwKCQkJCXgsIHkgKyAxLCAwCgkJCV07CgkJCXBvc2l0aW9uLnNldCggY29vcmRpbmF0ZXMsIHBvc2l0aW9uU2l6ZSAqIHZlcnRpY2VzICogZmFjZSApOwoJCQl1di5zZXQoIHV2MSwgdXZTaXplICogdmVydGljZXMgKiBmYWNlICk7CgkJCWNvbnN0IGZpbGwgPSBbIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UgXTsKCQkJZmFjZUluZGV4LnNldCggZmlsbCwgZmFjZUluZGV4U2l6ZSAqIHZlcnRpY2VzICogZmFjZSApOwoKCQl9CgoJCWNvbnN0IHBsYW5lcyA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCXBsYW5lcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBwb3NpdGlvblNpemUgKSApOwoJCXBsYW5lcy5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIHV2LCB1dlNpemUgKSApOwoJCXBsYW5lcy5zZXRBdHRyaWJ1dGUoICdmYWNlSW5kZXgnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBmYWNlSW5kZXgsIGZhY2VJbmRleFNpemUgKSApOwoJCWxvZFBsYW5lcy5wdXNoKCBwbGFuZXMgKTsKCgkJaWYgKCBsb2QgPiBMT0RfTUlOICkgewoKCQkJbG9kIC0tOwoKCQl9CgoJfQoKCXJldHVybiB7IGxvZFBsYW5lcywgc2l6ZUxvZHMsIHNpZ21hcyB9OwoKfQoKZnVuY3Rpb24gX2NyZWF0ZVJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICkgewoKCWNvbnN0IGN1YmVVVlJlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgljdWJlVVZSZW5kZXJUYXJnZXQudGV4dHVyZS5tYXBwaW5nID0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmc7CgljdWJlVVZSZW5kZXJUYXJnZXQudGV4dHVyZS5uYW1lID0gJ1BNUkVNLmN1YmVVdic7CgljdWJlVVZSZW5kZXJUYXJnZXQuc2Npc3NvclRlc3QgPSB0cnVlOwoJcmV0dXJuIGN1YmVVVlJlbmRlclRhcmdldDsKCn0KCmZ1bmN0aW9uIF9zZXRWaWV3cG9ydCggdGFyZ2V0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKCXRhcmdldC52aWV3cG9ydC5zZXQoIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCXRhcmdldC5zY2lzc29yLnNldCggeCwgeSwgd2lkdGgsIGhlaWdodCApOwoKfQoKZnVuY3Rpb24gX2dldEJsdXJTaGFkZXIoIGxvZE1heCwgd2lkdGgsIGhlaWdodCApIHsKCgljb25zdCB3ZWlnaHRzID0gbmV3IEZsb2F0MzJBcnJheSggTUFYX1NBTVBMRVMgKTsKCWNvbnN0IHBvbGVBeGlzID0gbmV3IFZlY3RvcjMoIDAsIDEsIDAgKTsKCWNvbnN0IHNoYWRlck1hdGVyaWFsID0gbmV3IFNoYWRlck1hdGVyaWFsKCB7CgoJCW5hbWU6ICdTcGhlcmljYWxHYXVzc2lhbkJsdXInLAoKCQlkZWZpbmVzOiB7CgkJCSduJzogTUFYX1NBTVBMRVMsCgkJCSdDVUJFVVZfVEVYRUxfV0lEVEgnOiAxLjAgLyB3aWR0aCwKCQkJJ0NVQkVVVl9URVhFTF9IRUlHSFQnOiAxLjAgLyBoZWlnaHQsCgkJCSdDVUJFVVZfTUFYX01JUCc6IGAke2xvZE1heH0uMGAsCgkJfSwKCgkJdW5pZm9ybXM6IHsKCQkJJ2Vudk1hcCc6IHsgdmFsdWU6IG51bGwgfSwKCQkJJ3NhbXBsZXMnOiB7IHZhbHVlOiAxIH0sCgkJCSd3ZWlnaHRzJzogeyB2YWx1ZTogd2VpZ2h0cyB9LAoJCQknbGF0aXR1ZGluYWwnOiB7IHZhbHVlOiBmYWxzZSB9LAoJCQknZFRoZXRhJzogeyB2YWx1ZTogMCB9LAoJCQknbWlwSW50JzogeyB2YWx1ZTogMCB9LAoJCQkncG9sZUF4aXMnOiB7IHZhbHVlOiBwb2xlQXhpcyB9CgkJfSwKCgkJdmVydGV4U2hhZGVyOiBfZ2V0Q29tbW9uVmVydGV4U2hhZGVyKCksCgoJCWZyYWdtZW50U2hhZGVyOiAvKiBnbHNsICovYAoKCQkJcHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7CgkJCXByZWNpc2lvbiBtZWRpdW1wIGludDsKCgkJCXZhcnlpbmcgdmVjMyB2T3V0cHV0RGlyZWN0aW9uOwoKCQkJdW5pZm9ybSBzYW1wbGVyMkQgZW52TWFwOwoJCQl1bmlmb3JtIGludCBzYW1wbGVzOwoJCQl1bmlmb3JtIGZsb2F0IHdlaWdodHNbIG4gXTsKCQkJdW5pZm9ybSBib29sIGxhdGl0dWRpbmFsOwoJCQl1bmlmb3JtIGZsb2F0IGRUaGV0YTsKCQkJdW5pZm9ybSBmbG9hdCBtaXBJbnQ7CgkJCXVuaWZvcm0gdmVjMyBwb2xlQXhpczsKCgkJCSNkZWZpbmUgRU5WTUFQX1RZUEVfQ1VCRV9VVgoJCQkjaW5jbHVkZSA8Y3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50PgoKCQkJdmVjMyBnZXRTYW1wbGUoIGZsb2F0IHRoZXRhLCB2ZWMzIGF4aXMgKSB7CgoJCQkJZmxvYXQgY29zVGhldGEgPSBjb3MoIHRoZXRhICk7CgkJCQkvLyBSb2RyaWd1ZXMnIGF4aXMtYW5nbGUgcm90YXRpb24KCQkJCXZlYzMgc2FtcGxlRGlyZWN0aW9uID0gdk91dHB1dERpcmVjdGlvbiAqIGNvc1RoZXRhCgkJCQkJKyBjcm9zcyggYXhpcywgdk91dHB1dERpcmVjdGlvbiApICogc2luKCB0aGV0YSApCgkJCQkJKyBheGlzICogZG90KCBheGlzLCB2T3V0cHV0RGlyZWN0aW9uICkgKiAoIDEuMCAtIGNvc1RoZXRhICk7CgoJCQkJcmV0dXJuIGJpbGluZWFyQ3ViZVVWKCBlbnZNYXAsIHNhbXBsZURpcmVjdGlvbiwgbWlwSW50ICk7CgoJCQl9CgoJCQl2b2lkIG1haW4oKSB7CgoJCQkJdmVjMyBheGlzID0gbGF0aXR1ZGluYWwgPyBwb2xlQXhpcyA6IGNyb3NzKCBwb2xlQXhpcywgdk91dHB1dERpcmVjdGlvbiApOwoKCQkJCWlmICggYWxsKCBlcXVhbCggYXhpcywgdmVjMyggMC4wICkgKSApICkgewoKCQkJCQlheGlzID0gdmVjMyggdk91dHB1dERpcmVjdGlvbi56LCAwLjAsIC0gdk91dHB1dERpcmVjdGlvbi54ICk7CgoJCQkJfQoKCQkJCWF4aXMgPSBub3JtYWxpemUoIGF4aXMgKTsKCgkJCQlnbF9GcmFnQ29sb3IgPSB2ZWM0KCAwLjAsIDAuMCwgMC4wLCAxLjAgKTsKCQkJCWdsX0ZyYWdDb2xvci5yZ2IgKz0gd2VpZ2h0c1sgMCBdICogZ2V0U2FtcGxlKCAwLjAsIGF4aXMgKTsKCgkJCQlmb3IgKCBpbnQgaSA9IDE7IGkgPCBuOyBpKysgKSB7CgoJCQkJCWlmICggaSA+PSBzYW1wbGVzICkgewoKCQkJCQkJYnJlYWs7CgoJCQkJCX0KCgkJCQkJZmxvYXQgdGhldGEgPSBkVGhldGEgKiBmbG9hdCggaSApOwoJCQkJCWdsX0ZyYWdDb2xvci5yZ2IgKz0gd2VpZ2h0c1sgaSBdICogZ2V0U2FtcGxlKCAtMS4wICogdGhldGEsIGF4aXMgKTsKCQkJCQlnbF9GcmFnQ29sb3IucmdiICs9IHdlaWdodHNbIGkgXSAqIGdldFNhbXBsZSggdGhldGEsIGF4aXMgKTsKCgkJCQl9CgoJCQl9CgkJYCwKCgkJYmxlbmRpbmc6IE5vQmxlbmRpbmcsCgkJZGVwdGhUZXN0OiBmYWxzZSwKCQlkZXB0aFdyaXRlOiBmYWxzZQoKCX0gKTsKCglyZXR1cm4gc2hhZGVyTWF0ZXJpYWw7Cgp9CgpmdW5jdGlvbiBfZ2V0RXF1aXJlY3RNYXRlcmlhbCgpIHsKCglyZXR1cm4gbmV3IFNoYWRlck1hdGVyaWFsKCB7CgoJCW5hbWU6ICdFcXVpcmVjdGFuZ3VsYXJUb0N1YmVVVicsCgoJCXVuaWZvcm1zOiB7CgkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0KCQl9LAoKCQl2ZXJ0ZXhTaGFkZXI6IF9nZXRDb21tb25WZXJ0ZXhTaGFkZXIoKSwKCgkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQlwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCQkJcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKCQkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCQl1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7CgoJCQkjaW5jbHVkZSA8Y29tbW9uPgoKCQkJdm9pZCBtYWluKCkgewoKCQkJCXZlYzMgb3V0cHV0RGlyZWN0aW9uID0gbm9ybWFsaXplKCB2T3V0cHV0RGlyZWN0aW9uICk7CgkJCQl2ZWMyIHV2ID0gZXF1aXJlY3RVdiggb3V0cHV0RGlyZWN0aW9uICk7CgoJCQkJZ2xfRnJhZ0NvbG9yID0gdmVjNCggdGV4dHVyZTJEICggZW52TWFwLCB1diApLnJnYiwgMS4wICk7CgoJCQl9CgkJYCwKCgkJYmxlbmRpbmc6IE5vQmxlbmRpbmcsCgkJZGVwdGhUZXN0OiBmYWxzZSwKCQlkZXB0aFdyaXRlOiBmYWxzZQoKCX0gKTsKCn0KCmZ1bmN0aW9uIF9nZXRDdWJlbWFwTWF0ZXJpYWwoKSB7CgoJcmV0dXJuIG5ldyBTaGFkZXJNYXRlcmlhbCggewoKCQluYW1lOiAnQ3ViZW1hcFRvQ3ViZVVWJywKCgkJdW5pZm9ybXM6IHsKCQkJJ2Vudk1hcCc6IHsgdmFsdWU6IG51bGwgfSwKCQkJJ2ZsaXBFbnZNYXAnOiB7IHZhbHVlOiAtIDEgfQoJCX0sCgoJCXZlcnRleFNoYWRlcjogX2dldENvbW1vblZlcnRleFNoYWRlcigpLAoKCQlmcmFnbWVudFNoYWRlcjogLyogZ2xzbCAqL2AKCgkJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCQlwcmVjaXNpb24gbWVkaXVtcCBpbnQ7CgoJCQl1bmlmb3JtIGZsb2F0IGZsaXBFbnZNYXA7CgoJCQl2YXJ5aW5nIHZlYzMgdk91dHB1dERpcmVjdGlvbjsKCgkJCXVuaWZvcm0gc2FtcGxlckN1YmUgZW52TWFwOwoKCQkJdm9pZCBtYWluKCkgewoKCQkJCWdsX0ZyYWdDb2xvciA9IHRleHR1cmVDdWJlKCBlbnZNYXAsIHZlYzMoIGZsaXBFbnZNYXAgKiB2T3V0cHV0RGlyZWN0aW9uLngsIHZPdXRwdXREaXJlY3Rpb24ueXogKSApOwoKCQkJfQoJCWAsCgoJCWJsZW5kaW5nOiBOb0JsZW5kaW5nLAoJCWRlcHRoVGVzdDogZmFsc2UsCgkJZGVwdGhXcml0ZTogZmFsc2UKCgl9ICk7Cgp9CgpmdW5jdGlvbiBfZ2V0Q29tbW9uVmVydGV4U2hhZGVyKCkgewoKCXJldHVybiAvKiBnbHNsICovYAoKCQlwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCQlwcmVjaXNpb24gbWVkaXVtcCBpbnQ7CgoJCWF0dHJpYnV0ZSBmbG9hdCBmYWNlSW5kZXg7CgoJCXZhcnlpbmcgdmVjMyB2T3V0cHV0RGlyZWN0aW9uOwoKCQkvLyBSSCBjb29yZGluYXRlIHN5c3RlbTsgUE1SRU0gZmFjZS1pbmRleGluZyBjb252ZW50aW9uCgkJdmVjMyBnZXREaXJlY3Rpb24oIHZlYzIgdXYsIGZsb2F0IGZhY2UgKSB7CgoJCQl1diA9IDIuMCAqIHV2IC0gMS4wOwoKCQkJdmVjMyBkaXJlY3Rpb24gPSB2ZWMzKCB1diwgMS4wICk7CgoJCQlpZiAoIGZhY2UgPT0gMC4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi56eXg7IC8vICggMSwgdiwgdSApIHBvcyB4CgoJCQl9IGVsc2UgaWYgKCBmYWNlID09IDEuMCApIHsKCgkJCQlkaXJlY3Rpb24gPSBkaXJlY3Rpb24ueHp5OwoJCQkJZGlyZWN0aW9uLnh6ICo9IC0xLjA7IC8vICggLXUsIDEsIC12ICkgcG9zIHkKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gMi4wICkgewoKCQkJCWRpcmVjdGlvbi54ICo9IC0xLjA7IC8vICggLXUsIHYsIDEgKSBwb3MgegoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSAzLjAgKSB7CgoJCQkJZGlyZWN0aW9uID0gZGlyZWN0aW9uLnp5eDsKCQkJCWRpcmVjdGlvbi54eiAqPSAtMS4wOyAvLyAoIC0xLCB2LCAtdSApIG5lZyB4CgoJCQl9IGVsc2UgaWYgKCBmYWNlID09IDQuMCApIHsKCgkJCQlkaXJlY3Rpb24gPSBkaXJlY3Rpb24ueHp5OwoJCQkJZGlyZWN0aW9uLnh5ICo9IC0xLjA7IC8vICggLXUsIC0xLCB2ICkgbmVnIHkKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gNS4wICkgewoKCQkJCWRpcmVjdGlvbi56ICo9IC0xLjA7IC8vICggdSwgdiwgLTEgKSBuZWcgegoKCQkJfQoKCQkJcmV0dXJuIGRpcmVjdGlvbjsKCgkJfQoKCQl2b2lkIG1haW4oKSB7CgoJCQl2T3V0cHV0RGlyZWN0aW9uID0gZ2V0RGlyZWN0aW9uKCB1diwgZmFjZUluZGV4ICk7CgkJCWdsX1Bvc2l0aW9uID0gdmVjNCggcG9zaXRpb24sIDEuMCApOwoKCQl9CglgOwoKfQoKZnVuY3Rpb24gV2ViR0xDdWJlVVZNYXBzKCByZW5kZXJlciApIHsKCglsZXQgY3ViZVVWbWFwcyA9IG5ldyBXZWFrTWFwKCk7CgoJbGV0IHBtcmVtR2VuZXJhdG9yID0gbnVsbDsKCglmdW5jdGlvbiBnZXQoIHRleHR1cmUgKSB7CgoJCWlmICggdGV4dHVyZSAmJiB0ZXh0dXJlLmlzVGV4dHVyZSApIHsKCgkJCWNvbnN0IG1hcHBpbmcgPSB0ZXh0dXJlLm1hcHBpbmc7CgoJCQljb25zdCBpc0VxdWlyZWN0TWFwID0gKCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyB8fCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZyApOwoJCQljb25zdCBpc0N1YmVNYXAgPSAoIG1hcHBpbmcgPT09IEN1YmVSZWZsZWN0aW9uTWFwcGluZyB8fCBtYXBwaW5nID09PSBDdWJlUmVmcmFjdGlvbk1hcHBpbmcgKTsKCgkJCS8vIGVxdWlyZWN0L2N1YmUgbWFwIHRvIGN1YmVVViBjb252ZXJzaW9uCgoJCQlpZiAoIGlzRXF1aXJlY3RNYXAgfHwgaXNDdWJlTWFwICkgewoKCQkJCWlmICggdGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgJiYgdGV4dHVyZS5uZWVkc1BNUkVNVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQl0ZXh0dXJlLm5lZWRzUE1SRU1VcGRhdGUgPSBmYWxzZTsKCgkJCQkJbGV0IHJlbmRlclRhcmdldCA9IGN1YmVVVm1hcHMuZ2V0KCB0ZXh0dXJlICk7CgoJCQkJCWlmICggcG1yZW1HZW5lcmF0b3IgPT09IG51bGwgKSBwbXJlbUdlbmVyYXRvciA9IG5ldyBQTVJFTUdlbmVyYXRvciggcmVuZGVyZXIgKTsKCgkJCQkJcmVuZGVyVGFyZ2V0ID0gaXNFcXVpcmVjdE1hcCA/IHBtcmVtR2VuZXJhdG9yLmZyb21FcXVpcmVjdGFuZ3VsYXIoIHRleHR1cmUsIHJlbmRlclRhcmdldCApIDogcG1yZW1HZW5lcmF0b3IuZnJvbUN1YmVtYXAoIHRleHR1cmUsIHJlbmRlclRhcmdldCApOwoJCQkJCWN1YmVVVm1hcHMuc2V0KCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKTsKCgkJCQkJcmV0dXJuIHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggY3ViZVVWbWFwcy5oYXMoIHRleHR1cmUgKSApIHsKCgkJCQkJCXJldHVybiBjdWJlVVZtYXBzLmdldCggdGV4dHVyZSApLnRleHR1cmU7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQljb25zdCBpbWFnZSA9IHRleHR1cmUuaW1hZ2U7CgoJCQkJCQlpZiAoICggaXNFcXVpcmVjdE1hcCAmJiBpbWFnZSAmJiBpbWFnZS5oZWlnaHQgPiAwICkgfHwgKCBpc0N1YmVNYXAgJiYgaW1hZ2UgJiYgaXNDdWJlVGV4dHVyZUNvbXBsZXRlKCBpbWFnZSApICkgKSB7CgoJCQkJCQkJaWYgKCBwbXJlbUdlbmVyYXRvciA9PT0gbnVsbCApIHBtcmVtR2VuZXJhdG9yID0gbmV3IFBNUkVNR2VuZXJhdG9yKCByZW5kZXJlciApOwoKCQkJCQkJCWNvbnN0IHJlbmRlclRhcmdldCA9IGlzRXF1aXJlY3RNYXAgPyBwbXJlbUdlbmVyYXRvci5mcm9tRXF1aXJlY3Rhbmd1bGFyKCB0ZXh0dXJlICkgOiBwbXJlbUdlbmVyYXRvci5mcm9tQ3ViZW1hcCggdGV4dHVyZSApOwoJCQkJCQkJY3ViZVVWbWFwcy5zZXQoIHRleHR1cmUsIHJlbmRlclRhcmdldCApOwoKCQkJCQkJCXRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblRleHR1cmVEaXNwb3NlICk7CgoJCQkJCQkJcmV0dXJuIHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkvLyBpbWFnZSBub3QgeWV0IHJlYWR5LiB0cnkgdGhlIGNvbnZlcnNpb24gbmV4dCBmcmFtZQoKCQkJCQkJCXJldHVybiBudWxsOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXJldHVybiB0ZXh0dXJlOwoKCX0KCglmdW5jdGlvbiBpc0N1YmVUZXh0dXJlQ29tcGxldGUoIGltYWdlICkgewoKCQlsZXQgY291bnQgPSAwOwoJCWNvbnN0IGxlbmd0aCA9IDY7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSArKyApIHsKCgkJCWlmICggaW1hZ2VbIGkgXSAhPT0gdW5kZWZpbmVkICkgY291bnQgKys7CgoJCX0KCgkJcmV0dXJuIGNvdW50ID09PSBsZW5ndGg7CgoKCX0KCglmdW5jdGlvbiBvblRleHR1cmVEaXNwb3NlKCBldmVudCApIHsKCgkJY29uc3QgdGV4dHVyZSA9IGV2ZW50LnRhcmdldDsKCgkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJY29uc3QgY3ViZW1hcFVWID0gY3ViZVVWbWFwcy5nZXQoIHRleHR1cmUgKTsKCgkJaWYgKCBjdWJlbWFwVVYgIT09IHVuZGVmaW5lZCApIHsKCgkJCWN1YmVVVm1hcHMuZGVsZXRlKCB0ZXh0dXJlICk7CgkJCWN1YmVtYXBVVi5kaXNwb3NlKCk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJY3ViZVVWbWFwcyA9IG5ldyBXZWFrTWFwKCk7CgoJCWlmICggcG1yZW1HZW5lcmF0b3IgIT09IG51bGwgKSB7CgoJCQlwbXJlbUdlbmVyYXRvci5kaXNwb3NlKCk7CgkJCXBtcmVtR2VuZXJhdG9yID0gbnVsbDsKCgkJfQoKCX0KCglyZXR1cm4gewoJCWdldDogZ2V0LAoJCWRpc3Bvc2U6IGRpc3Bvc2UKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTEV4dGVuc2lvbnMoIGdsICkgewoKCWNvbnN0IGV4dGVuc2lvbnMgPSB7fTsKCglmdW5jdGlvbiBnZXRFeHRlbnNpb24oIG5hbWUgKSB7CgoJCWlmICggZXh0ZW5zaW9uc1sgbmFtZSBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQlyZXR1cm4gZXh0ZW5zaW9uc1sgbmFtZSBdOwoKCQl9CgoJCWxldCBleHRlbnNpb247CgoJCXN3aXRjaCAoIG5hbWUgKSB7CgoJCQljYXNlICdXRUJHTF9kZXB0aF90ZXh0dXJlJzoKCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2RlcHRoX3RleHR1cmUnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnTU9aX1dFQkdMX2RlcHRoX3RleHR1cmUnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCS0lUX1dFQkdMX2RlcHRoX3RleHR1cmUnICk7CgkJCQlicmVhazsKCgkJCWNhc2UgJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYyc6CgkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnTU9aX0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdXRUJLSVRfRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApOwoJCQkJYnJlYWs7CgoJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0Yyc6CgkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdNT1pfV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCS0lUX1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJyApOwoJCQkJYnJlYWs7CgoJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnOgoJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnICk7CgkJCQlicmVhazsKCgkJCWRlZmF1bHQ6CgkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oIG5hbWUgKTsKCgkJfQoKCQlleHRlbnNpb25zWyBuYW1lIF0gPSBleHRlbnNpb247CgoJCXJldHVybiBleHRlbnNpb247CgoJfQoKCXJldHVybiB7CgoJCWhhczogZnVuY3Rpb24gKCBuYW1lICkgewoKCQkJcmV0dXJuIGdldEV4dGVuc2lvbiggbmFtZSApICE9PSBudWxsOwoKCQl9LAoKCQlpbml0OiBmdW5jdGlvbiAoIGNhcGFiaWxpdGllcyApIHsKCgkJCWlmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyICkgewoKCQkJCWdldEV4dGVuc2lvbiggJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnICk7CgkJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9jbGlwX2N1bGxfZGlzdGFuY2UnICk7CgoJCQl9IGVsc2UgewoKCQkJCWdldEV4dGVuc2lvbiggJ1dFQkdMX2RlcHRoX3RleHR1cmUnICk7CgkJCQlnZXRFeHRlbnNpb24oICdPRVNfdGV4dHVyZV9mbG9hdCcgKTsKCQkJCWdldEV4dGVuc2lvbiggJ09FU190ZXh0dXJlX2hhbGZfZmxvYXQnICk7CgkJCQlnZXRFeHRlbnNpb24oICdPRVNfdGV4dHVyZV9oYWxmX2Zsb2F0X2xpbmVhcicgKTsKCQkJCWdldEV4dGVuc2lvbiggJ09FU19zdGFuZGFyZF9kZXJpdmF0aXZlcycgKTsKCQkJCWdldEV4dGVuc2lvbiggJ09FU19lbGVtZW50X2luZGV4X3VpbnQnICk7CgkJCQlnZXRFeHRlbnNpb24oICdPRVNfdmVydGV4X2FycmF5X29iamVjdCcgKTsKCQkJCWdldEV4dGVuc2lvbiggJ0FOR0xFX2luc3RhbmNlZF9hcnJheXMnICk7CgoJCQl9CgoJCQlnZXRFeHRlbnNpb24oICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICk7CgkJCWdldEV4dGVuc2lvbiggJ0VYVF9jb2xvcl9idWZmZXJfaGFsZl9mbG9hdCcgKTsKCQkJZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfbXVsdGlzYW1wbGVkX3JlbmRlcl90b190ZXh0dXJlJyApOwoKCQl9LAoKCQlnZXQ6IGZ1bmN0aW9uICggbmFtZSApIHsKCgkJCWNvbnN0IGV4dGVuc2lvbiA9IGdldEV4dGVuc2lvbiggbmFtZSApOwoKCQkJaWYgKCBleHRlbnNpb24gPT09IG51bGwgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogJyArIG5hbWUgKyAnIGV4dGVuc2lvbiBub3Qgc3VwcG9ydGVkLicgKTsKCgkJCX0KCgkJCXJldHVybiBleHRlbnNpb247CgoJCX0KCgl9OwoKfQoKZnVuY3Rpb24gV2ViR0xHZW9tZXRyaWVzKCBnbCwgYXR0cmlidXRlcywgaW5mbywgYmluZGluZ1N0YXRlcyApIHsKCgljb25zdCBnZW9tZXRyaWVzID0ge307Cgljb25zdCB3aXJlZnJhbWVBdHRyaWJ1dGVzID0gbmV3IFdlYWtNYXAoKTsKCglmdW5jdGlvbiBvbkdlb21ldHJ5RGlzcG9zZSggZXZlbnQgKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gZXZlbnQudGFyZ2V0OwoKCQlpZiAoIGdlb21ldHJ5LmluZGV4ICE9PSBudWxsICkgewoKCQkJYXR0cmlidXRlcy5yZW1vdmUoIGdlb21ldHJ5LmluZGV4ICk7CgoJCX0KCgkJZm9yICggY29uc3QgbmFtZSBpbiBnZW9tZXRyeS5hdHRyaWJ1dGVzICkgewoKCQkJYXR0cmlidXRlcy5yZW1vdmUoIGdlb21ldHJ5LmF0dHJpYnV0ZXNbIG5hbWUgXSApOwoKCQl9CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzICkgewoKCQkJY29uc3QgYXJyYXkgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJYXR0cmlidXRlcy5yZW1vdmUoIGFycmF5WyBpIF0gKTsKCgkJCX0KCgkJfQoKCQlnZW9tZXRyeS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uR2VvbWV0cnlEaXNwb3NlICk7CgoJCWRlbGV0ZSBnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdOwoKCQljb25zdCBhdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnkgKTsKCgkJaWYgKCBhdHRyaWJ1dGUgKSB7CgoJCQlhdHRyaWJ1dGVzLnJlbW92ZSggYXR0cmlidXRlICk7CgkJCXdpcmVmcmFtZUF0dHJpYnV0ZXMuZGVsZXRlKCBnZW9tZXRyeSApOwoKCQl9CgoJCWJpbmRpbmdTdGF0ZXMucmVsZWFzZVN0YXRlc09mR2VvbWV0cnkoIGdlb21ldHJ5ICk7CgoJCWlmICggZ2VvbWV0cnkuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSA9PT0gdHJ1ZSApIHsKCgkJCWRlbGV0ZSBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudDsKCgkJfQoKCQkvLwoKCQlpbmZvLm1lbW9yeS5nZW9tZXRyaWVzIC0tOwoKCX0KCglmdW5jdGlvbiBnZXQoIG9iamVjdCwgZ2VvbWV0cnkgKSB7CgoJCWlmICggZ2VvbWV0cmllc1sgZ2VvbWV0cnkuaWQgXSA9PT0gdHJ1ZSApIHJldHVybiBnZW9tZXRyeTsKCgkJZ2VvbWV0cnkuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkdlb21ldHJ5RGlzcG9zZSApOwoKCQlnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdID0gdHJ1ZTsKCgkJaW5mby5tZW1vcnkuZ2VvbWV0cmllcyArKzsKCgkJcmV0dXJuIGdlb21ldHJ5OwoKCX0KCglmdW5jdGlvbiB1cGRhdGUoIGdlb21ldHJ5ICkgewoKCQljb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQkvLyBVcGRhdGluZyBpbmRleCBidWZmZXIgaW4gVkFPIG5vdy4gU2VlIFdlYkdMQmluZGluZ1N0YXRlcy4KCgkJZm9yICggY29uc3QgbmFtZSBpbiBnZW9tZXRyeUF0dHJpYnV0ZXMgKSB7CgoJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggZ2VvbWV0cnlBdHRyaWJ1dGVzWyBuYW1lIF0sIGdsLkFSUkFZX0JVRkZFUiApOwoKCQl9CgoJCS8vIG1vcnBoIHRhcmdldHMKCgkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwoKCQlmb3IgKCBjb25zdCBuYW1lIGluIG1vcnBoQXR0cmlidXRlcyApIHsKCgkJCWNvbnN0IGFycmF5ID0gbW9ycGhBdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWF0dHJpYnV0ZXMudXBkYXRlKCBhcnJheVsgaSBdLCBnbC5BUlJBWV9CVUZGRVIgKTsKCgkJCX0KCgkJfQoKCX0KCglmdW5jdGlvbiB1cGRhdGVXaXJlZnJhbWVBdHRyaWJ1dGUoIGdlb21ldHJ5ICkgewoKCQljb25zdCBpbmRpY2VzID0gW107CgoJCWNvbnN0IGdlb21ldHJ5SW5kZXggPSBnZW9tZXRyeS5pbmRleDsKCQljb25zdCBnZW9tZXRyeVBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQlsZXQgdmVyc2lvbiA9IDA7CgoJCWlmICggZ2VvbWV0cnlJbmRleCAhPT0gbnVsbCApIHsKCgkJCWNvbnN0IGFycmF5ID0gZ2VvbWV0cnlJbmRleC5hcnJheTsKCQkJdmVyc2lvbiA9IGdlb21ldHJ5SW5kZXgudmVyc2lvbjsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKz0gMyApIHsKCgkJCQljb25zdCBhID0gYXJyYXlbIGkgKyAwIF07CgkJCQljb25zdCBiID0gYXJyYXlbIGkgKyAxIF07CgkJCQljb25zdCBjID0gYXJyYXlbIGkgKyAyIF07CgoJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBiLCBjLCBjLCBhICk7CgoJCQl9CgoJCX0gZWxzZSBpZiAoIGdlb21ldHJ5UG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IGFycmF5ID0gZ2VvbWV0cnlQb3NpdGlvbi5hcnJheTsKCQkJdmVyc2lvbiA9IGdlb21ldHJ5UG9zaXRpb24udmVyc2lvbjsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9ICggYXJyYXkubGVuZ3RoIC8gMyApIC0gMTsgaSA8IGw7IGkgKz0gMyApIHsKCgkJCQljb25zdCBhID0gaSArIDA7CgkJCQljb25zdCBiID0gaSArIDE7CgkJCQljb25zdCBjID0gaSArIDI7CgoJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBiLCBjLCBjLCBhICk7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlyZXR1cm47CgoJCX0KCgkJY29uc3QgYXR0cmlidXRlID0gbmV3ICggYXJyYXlOZWVkc1VpbnQzMiggaW5kaWNlcyApID8gVWludDMyQnVmZmVyQXR0cmlidXRlIDogVWludDE2QnVmZmVyQXR0cmlidXRlICkoIGluZGljZXMsIDEgKTsKCQlhdHRyaWJ1dGUudmVyc2lvbiA9IHZlcnNpb247CgoJCS8vIFVwZGF0aW5nIGluZGV4IGJ1ZmZlciBpbiBWQU8gbm93LiBTZWUgV2ViR0xCaW5kaW5nU3RhdGVzCgoJCS8vCgoJCWNvbnN0IHByZXZpb3VzQXR0cmlidXRlID0gd2lyZWZyYW1lQXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5ICk7CgoJCWlmICggcHJldmlvdXNBdHRyaWJ1dGUgKSBhdHRyaWJ1dGVzLnJlbW92ZSggcHJldmlvdXNBdHRyaWJ1dGUgKTsKCgkJLy8KCgkJd2lyZWZyYW1lQXR0cmlidXRlcy5zZXQoIGdlb21ldHJ5LCBhdHRyaWJ1dGUgKTsKCgl9CgoJZnVuY3Rpb24gZ2V0V2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApIHsKCgkJY29uc3QgY3VycmVudEF0dHJpYnV0ZSA9IHdpcmVmcmFtZUF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeSApOwoKCQlpZiAoIGN1cnJlbnRBdHRyaWJ1dGUgKSB7CgoJCQljb25zdCBnZW9tZXRyeUluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CgoJCQlpZiAoIGdlb21ldHJ5SW5kZXggIT09IG51bGwgKSB7CgoJCQkJLy8gaWYgdGhlIGF0dHJpYnV0ZSBpcyBvYnNvbGV0ZSwgY3JlYXRlIGEgbmV3IG9uZQoKCQkJCWlmICggY3VycmVudEF0dHJpYnV0ZS52ZXJzaW9uIDwgZ2VvbWV0cnlJbmRleC52ZXJzaW9uICkgewoKCQkJCQl1cGRhdGVXaXJlZnJhbWVBdHRyaWJ1dGUoIGdlb21ldHJ5ICk7CgoJCQkJfQoKCQkJfQoKCQl9IGVsc2UgewoKCQkJdXBkYXRlV2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApOwoKCQl9CgoJCXJldHVybiB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnkgKTsKCgl9CgoJcmV0dXJuIHsKCgkJZ2V0OiBnZXQsCgkJdXBkYXRlOiB1cGRhdGUsCgoJCWdldFdpcmVmcmFtZUF0dHJpYnV0ZTogZ2V0V2lyZWZyYW1lQXR0cmlidXRlCgoJfTsKCn0KCmZ1bmN0aW9uIFdlYkdMSW5kZXhlZEJ1ZmZlclJlbmRlcmVyKCBnbCwgZXh0ZW5zaW9ucywgaW5mbywgY2FwYWJpbGl0aWVzICkgewoKCWNvbnN0IGlzV2ViR0wyID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyOwoKCWxldCBtb2RlOwoKCWZ1bmN0aW9uIHNldE1vZGUoIHZhbHVlICkgewoKCQltb2RlID0gdmFsdWU7CgoJfQoKCWxldCB0eXBlLCBieXRlc1BlckVsZW1lbnQ7CgoJZnVuY3Rpb24gc2V0SW5kZXgoIHZhbHVlICkgewoKCQl0eXBlID0gdmFsdWUudHlwZTsKCQlieXRlc1BlckVsZW1lbnQgPSB2YWx1ZS5ieXRlc1BlckVsZW1lbnQ7CgoJfQoKCWZ1bmN0aW9uIHJlbmRlciggc3RhcnQsIGNvdW50ICkgewoKCQlnbC5kcmF3RWxlbWVudHMoIG1vZGUsIGNvdW50LCB0eXBlLCBzdGFydCAqIGJ5dGVzUGVyRWxlbWVudCApOwoKCQlpbmZvLnVwZGF0ZSggY291bnQsIG1vZGUsIDEgKTsKCgl9CgoJZnVuY3Rpb24gcmVuZGVySW5zdGFuY2VzKCBzdGFydCwgY291bnQsIHByaW1jb3VudCApIHsKCgkJaWYgKCBwcmltY291bnQgPT09IDAgKSByZXR1cm47CgoJCWxldCBleHRlbnNpb24sIG1ldGhvZE5hbWU7CgoJCWlmICggaXNXZWJHTDIgKSB7CgoJCQlleHRlbnNpb24gPSBnbDsKCQkJbWV0aG9kTmFtZSA9ICdkcmF3RWxlbWVudHNJbnN0YW5jZWQnOwoKCQl9IGVsc2UgewoKCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdBTkdMRV9pbnN0YW5jZWRfYXJyYXlzJyApOwoJCQltZXRob2ROYW1lID0gJ2RyYXdFbGVtZW50c0luc3RhbmNlZEFOR0xFJzsKCgkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTEluZGV4ZWRCdWZmZXJSZW5kZXJlcjogdXNpbmcgVEhSRUUuSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgYnV0IGhhcmR3YXJlIGRvZXMgbm90IHN1cHBvcnQgZXh0ZW5zaW9uIEFOR0xFX2luc3RhbmNlZF9hcnJheXMuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQl9CgoJCWV4dGVuc2lvblsgbWV0aG9kTmFtZSBdKCBtb2RlLCBjb3VudCwgdHlwZSwgc3RhcnQgKiBieXRlc1BlckVsZW1lbnQsIHByaW1jb3VudCApOwoKCQlpbmZvLnVwZGF0ZSggY291bnQsIG1vZGUsIHByaW1jb3VudCApOwoKCX0KCglmdW5jdGlvbiByZW5kZXJNdWx0aURyYXcoIHN0YXJ0cywgY291bnRzLCBkcmF3Q291bnQgKSB7CgoJCWlmICggZHJhd0NvdW50ID09PSAwICkgcmV0dXJuOwoKCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICk7CgkJaWYgKCBleHRlbnNpb24gPT09IG51bGwgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkcmF3Q291bnQ7IGkgKysgKSB7CgoJCQkJdGhpcy5yZW5kZXIoIHN0YXJ0c1sgaSBdIC8gYnl0ZXNQZXJFbGVtZW50LCBjb3VudHNbIGkgXSApOwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJZXh0ZW5zaW9uLm11bHRpRHJhd0VsZW1lbnRzV0VCR0woIG1vZGUsIGNvdW50cywgMCwgdHlwZSwgc3RhcnRzLCAwLCBkcmF3Q291bnQgKTsKCgkJCWxldCBlbGVtZW50Q291bnQgPSAwOwoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkcmF3Q291bnQ7IGkgKysgKSB7CgoJCQkJZWxlbWVudENvdW50ICs9IGNvdW50c1sgaSBdOwoKCQkJfQoKCQkJaW5mby51cGRhdGUoIGVsZW1lbnRDb3VudCwgbW9kZSwgMSApOwoKCQl9CgoJfQoKCS8vCgoJdGhpcy5zZXRNb2RlID0gc2V0TW9kZTsKCXRoaXMuc2V0SW5kZXggPSBzZXRJbmRleDsKCXRoaXMucmVuZGVyID0gcmVuZGVyOwoJdGhpcy5yZW5kZXJJbnN0YW5jZXMgPSByZW5kZXJJbnN0YW5jZXM7Cgl0aGlzLnJlbmRlck11bHRpRHJhdyA9IHJlbmRlck11bHRpRHJhdzsKCn0KCmZ1bmN0aW9uIFdlYkdMSW5mbyggZ2wgKSB7CgoJY29uc3QgbWVtb3J5ID0gewoJCWdlb21ldHJpZXM6IDAsCgkJdGV4dHVyZXM6IDAKCX07CgoJY29uc3QgcmVuZGVyID0gewoJCWZyYW1lOiAwLAoJCWNhbGxzOiAwLAoJCXRyaWFuZ2xlczogMCwKCQlwb2ludHM6IDAsCgkJbGluZXM6IDAKCX07CgoJZnVuY3Rpb24gdXBkYXRlKCBjb3VudCwgbW9kZSwgaW5zdGFuY2VDb3VudCApIHsKCgkJcmVuZGVyLmNhbGxzICsrOwoKCQlzd2l0Y2ggKCBtb2RlICkgewoKCQkJY2FzZSBnbC5UUklBTkdMRVM6CgkJCQlyZW5kZXIudHJpYW5nbGVzICs9IGluc3RhbmNlQ291bnQgKiAoIGNvdW50IC8gMyApOwoJCQkJYnJlYWs7CgoJCQljYXNlIGdsLkxJTkVTOgoJCQkJcmVuZGVyLmxpbmVzICs9IGluc3RhbmNlQ291bnQgKiAoIGNvdW50IC8gMiApOwoJCQkJYnJlYWs7CgoJCQljYXNlIGdsLkxJTkVfU1RSSVA6CgkJCQlyZW5kZXIubGluZXMgKz0gaW5zdGFuY2VDb3VudCAqICggY291bnQgLSAxICk7CgkJCQlicmVhazsKCgkJCWNhc2UgZ2wuTElORV9MT09QOgoJCQkJcmVuZGVyLmxpbmVzICs9IGluc3RhbmNlQ291bnQgKiBjb3VudDsKCQkJCWJyZWFrOwoKCQkJY2FzZSBnbC5QT0lOVFM6CgkJCQlyZW5kZXIucG9pbnRzICs9IGluc3RhbmNlQ291bnQgKiBjb3VudDsKCQkJCWJyZWFrOwoKCQkJZGVmYXVsdDoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTEluZm86IFVua25vd24gZHJhdyBtb2RlOicsIG1vZGUgKTsKCQkJCWJyZWFrOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHJlc2V0KCkgewoKCQlyZW5kZXIuY2FsbHMgPSAwOwoJCXJlbmRlci50cmlhbmdsZXMgPSAwOwoJCXJlbmRlci5wb2ludHMgPSAwOwoJCXJlbmRlci5saW5lcyA9IDA7CgoJfQoKCXJldHVybiB7CgkJbWVtb3J5OiBtZW1vcnksCgkJcmVuZGVyOiByZW5kZXIsCgkJcHJvZ3JhbXM6IG51bGwsCgkJYXV0b1Jlc2V0OiB0cnVlLAoJCXJlc2V0OiByZXNldCwKCQl1cGRhdGU6IHVwZGF0ZQoJfTsKCn0KCmZ1bmN0aW9uIG51bWVyaWNhbFNvcnQoIGEsIGIgKSB7CgoJcmV0dXJuIGFbIDAgXSAtIGJbIDAgXTsKCn0KCmZ1bmN0aW9uIGFic051bWVyaWNhbFNvcnQoIGEsIGIgKSB7CgoJcmV0dXJuIE1hdGguYWJzKCBiWyAxIF0gKSAtIE1hdGguYWJzKCBhWyAxIF0gKTsKCn0KCmZ1bmN0aW9uIFdlYkdMTW9ycGh0YXJnZXRzKCBnbCwgY2FwYWJpbGl0aWVzLCB0ZXh0dXJlcyApIHsKCgljb25zdCBpbmZsdWVuY2VzTGlzdCA9IHt9OwoJY29uc3QgbW9ycGhJbmZsdWVuY2VzID0gbmV3IEZsb2F0MzJBcnJheSggOCApOwoJY29uc3QgbW9ycGhUZXh0dXJlcyA9IG5ldyBXZWFrTWFwKCk7Cgljb25zdCBtb3JwaCA9IG5ldyBWZWN0b3I0KCk7CgoJY29uc3Qgd29ya0luZmx1ZW5jZXMgPSBbXTsKCglmb3IgKCBsZXQgaSA9IDA7IGkgPCA4OyBpICsrICkgewoKCQl3b3JrSW5mbHVlbmNlc1sgaSBdID0gWyBpLCAwIF07CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSApIHsKCgkJY29uc3Qgb2JqZWN0SW5mbHVlbmNlcyA9IG9iamVjdC5tb3JwaFRhcmdldEluZmx1ZW5jZXM7CgoJCWlmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyID09PSB0cnVlICkgewoKCQkJLy8gaW5zdGVhZCBvZiB1c2luZyBhdHRyaWJ1dGVzLCB0aGUgV2ViR0wgMiBjb2RlIHBhdGggZW5jb2RlcyBtb3JwaCB0YXJnZXRzCgkJCS8vIGludG8gYW4gYXJyYXkgb2YgZGF0YSB0ZXh0dXJlcy4gRWFjaCBsYXllciByZXByZXNlbnRzIGEgc2luZ2xlIG1vcnBoIHRhcmdldC4KCgkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoJCQljb25zdCBtb3JwaFRhcmdldHNDb3VudCA9ICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApID8gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoIDogMDsKCgkJCWxldCBlbnRyeSA9IG1vcnBoVGV4dHVyZXMuZ2V0KCBnZW9tZXRyeSApOwoKCQkJaWYgKCBlbnRyeSA9PT0gdW5kZWZpbmVkIHx8IGVudHJ5LmNvdW50ICE9PSBtb3JwaFRhcmdldHNDb3VudCApIHsKCgkJCQlpZiAoIGVudHJ5ICE9PSB1bmRlZmluZWQgKSBlbnRyeS50ZXh0dXJlLmRpc3Bvc2UoKTsKCgkJCQljb25zdCBoYXNNb3JwaFBvc2l0aW9uID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQ7CgkJCQljb25zdCBoYXNNb3JwaE5vcm1hbHMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsICE9PSB1bmRlZmluZWQ7CgkJCQljb25zdCBoYXNNb3JwaENvbG9ycyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciAhPT0gdW5kZWZpbmVkOwoKCQkJCWNvbnN0IG1vcnBoVGFyZ2V0cyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiB8fCBbXTsKCQkJCWNvbnN0IG1vcnBoTm9ybWFscyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgW107CgkJCQljb25zdCBtb3JwaENvbG9ycyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciB8fCBbXTsKCgkJCQlsZXQgdmVydGV4RGF0YUNvdW50ID0gMDsKCgkJCQlpZiAoIGhhc01vcnBoUG9zaXRpb24gPT09IHRydWUgKSB2ZXJ0ZXhEYXRhQ291bnQgPSAxOwoJCQkJaWYgKCBoYXNNb3JwaE5vcm1hbHMgPT09IHRydWUgKSB2ZXJ0ZXhEYXRhQ291bnQgPSAyOwoJCQkJaWYgKCBoYXNNb3JwaENvbG9ycyA9PT0gdHJ1ZSApIHZlcnRleERhdGFDb3VudCA9IDM7CgoJCQkJbGV0IHdpZHRoID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5jb3VudCAqIHZlcnRleERhdGFDb3VudDsKCQkJCWxldCBoZWlnaHQgPSAxOwoKCQkJCWlmICggd2lkdGggPiBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKSB7CgoJCQkJCWhlaWdodCA9IE1hdGguY2VpbCggd2lkdGggLyBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKTsKCQkJCQl3aWR0aCA9IGNhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZTsKCgkJCQl9CgoJCQkJY29uc3QgYnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheSggd2lkdGggKiBoZWlnaHQgKiA0ICogbW9ycGhUYXJnZXRzQ291bnQgKTsKCgkJCQljb25zdCB0ZXh0dXJlID0gbmV3IERhdGFBcnJheVRleHR1cmUoIGJ1ZmZlciwgd2lkdGgsIGhlaWdodCwgbW9ycGhUYXJnZXRzQ291bnQgKTsKCQkJCXRleHR1cmUudHlwZSA9IEZsb2F0VHlwZTsKCQkJCXRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCS8vIGZpbGwgYnVmZmVyCgoJCQkJY29uc3QgdmVydGV4RGF0YVN0cmlkZSA9IHZlcnRleERhdGFDb3VudCAqIDQ7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbW9ycGhUYXJnZXRzQ291bnQ7IGkgKysgKSB7CgoJCQkJCWNvbnN0IG1vcnBoVGFyZ2V0ID0gbW9ycGhUYXJnZXRzWyBpIF07CgkJCQkJY29uc3QgbW9ycGhOb3JtYWwgPSBtb3JwaE5vcm1hbHNbIGkgXTsKCQkJCQljb25zdCBtb3JwaENvbG9yID0gbW9ycGhDb2xvcnNbIGkgXTsKCgkJCQkJY29uc3Qgb2Zmc2V0ID0gd2lkdGggKiBoZWlnaHQgKiA0ICogaTsKCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgbW9ycGhUYXJnZXQuY291bnQ7IGogKysgKSB7CgoJCQkJCQljb25zdCBzdHJpZGUgPSBqICogdmVydGV4RGF0YVN0cmlkZTsKCgkJCQkJCWlmICggaGFzTW9ycGhQb3NpdGlvbiA9PT0gdHJ1ZSApIHsKCgkJCQkJCQltb3JwaC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaFRhcmdldCwgaiApOwoKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMCBdID0gbW9ycGgueDsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMSBdID0gbW9ycGgueTsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMiBdID0gbW9ycGguejsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMyBdID0gMDsKCgkJCQkJCX0KCgkJCQkJCWlmICggaGFzTW9ycGhOb3JtYWxzID09PSB0cnVlICkgewoKCQkJCQkJCW1vcnBoLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoTm9ybWFsLCBqICk7CgoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA0IF0gPSBtb3JwaC54OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA1IF0gPSBtb3JwaC55OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA2IF0gPSBtb3JwaC56OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA3IF0gPSAwOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBoYXNNb3JwaENvbG9ycyA9PT0gdHJ1ZSApIHsKCgkJCQkJCQltb3JwaC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaENvbG9yLCBqICk7CgoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA4IF0gPSBtb3JwaC54OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA5IF0gPSBtb3JwaC55OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyAxMCBdID0gbW9ycGguejsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMTEgXSA9ICggbW9ycGhDb2xvci5pdGVtU2l6ZSA9PT0gNCApID8gbW9ycGgudyA6IDE7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJZW50cnkgPSB7CgkJCQkJY291bnQ6IG1vcnBoVGFyZ2V0c0NvdW50LAoJCQkJCXRleHR1cmU6IHRleHR1cmUsCgkJCQkJc2l6ZTogbmV3IFZlY3RvcjIoIHdpZHRoLCBoZWlnaHQgKQoJCQkJfTsKCgkJCQltb3JwaFRleHR1cmVzLnNldCggZ2VvbWV0cnksIGVudHJ5ICk7CgoJCQkJZnVuY3Rpb24gZGlzcG9zZVRleHR1cmUoKSB7CgoJCQkJCXRleHR1cmUuZGlzcG9zZSgpOwoKCQkJCQltb3JwaFRleHR1cmVzLmRlbGV0ZSggZ2VvbWV0cnkgKTsKCgkJCQkJZ2VvbWV0cnkucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBkaXNwb3NlVGV4dHVyZSApOwoKCQkJCX0KCgkJCQlnZW9tZXRyeS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIGRpc3Bvc2VUZXh0dXJlICk7CgoJCQl9CgoJCQkvLwoKCQkJbGV0IG1vcnBoSW5mbHVlbmNlc1N1bSA9IDA7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBvYmplY3RJbmZsdWVuY2VzLmxlbmd0aDsgaSArKyApIHsKCgkJCQltb3JwaEluZmx1ZW5jZXNTdW0gKz0gb2JqZWN0SW5mbHVlbmNlc1sgaSBdOwoKCQkJfQoKCQkJY29uc3QgbW9ycGhCYXNlSW5mbHVlbmNlID0gZ2VvbWV0cnkubW9ycGhUYXJnZXRzUmVsYXRpdmUgPyAxIDogMSAtIG1vcnBoSW5mbHVlbmNlc1N1bTsKCgkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2UnLCBtb3JwaEJhc2VJbmZsdWVuY2UgKTsKCQkJcHJvZ3JhbS5nZXRVbmlmb3JtcygpLnNldFZhbHVlKCBnbCwgJ21vcnBoVGFyZ2V0SW5mbHVlbmNlcycsIG9iamVjdEluZmx1ZW5jZXMgKTsKCgkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldHNUZXh0dXJlJywgZW50cnkudGV4dHVyZSwgdGV4dHVyZXMgKTsKCQkJcHJvZ3JhbS5nZXRVbmlmb3JtcygpLnNldFZhbHVlKCBnbCwgJ21vcnBoVGFyZ2V0c1RleHR1cmVTaXplJywgZW50cnkuc2l6ZSApOwoKCgkJfSBlbHNlIHsKCgkJCS8vIFdoZW4gb2JqZWN0IGRvZXNuJ3QgaGF2ZSBtb3JwaCB0YXJnZXQgaW5mbHVlbmNlcyBkZWZpbmVkLCB3ZSB0cmVhdCBpdCBhcyBhIDAtbGVuZ3RoIGFycmF5CgkJCS8vIFRoaXMgaXMgaW1wb3J0YW50IHRvIG1ha2Ugc3VyZSB3ZSBzZXQgdXAgbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlIC8gbW9ycGhUYXJnZXRJbmZsdWVuY2VzCgoJCQljb25zdCBsZW5ndGggPSBvYmplY3RJbmZsdWVuY2VzID09PSB1bmRlZmluZWQgPyAwIDogb2JqZWN0SW5mbHVlbmNlcy5sZW5ndGg7CgoJCQlsZXQgaW5mbHVlbmNlcyA9IGluZmx1ZW5jZXNMaXN0WyBnZW9tZXRyeS5pZCBdOwoKCQkJaWYgKCBpbmZsdWVuY2VzID09PSB1bmRlZmluZWQgfHwgaW5mbHVlbmNlcy5sZW5ndGggIT09IGxlbmd0aCApIHsKCgkJCQkvLyBpbml0aWFsaXNlIGxpc3QKCgkJCQlpbmZsdWVuY2VzID0gW107CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrICkgewoKCQkJCQlpbmZsdWVuY2VzWyBpIF0gPSBbIGksIDAgXTsKCgkJCQl9CgoJCQkJaW5mbHVlbmNlc0xpc3RbIGdlb21ldHJ5LmlkIF0gPSBpbmZsdWVuY2VzOwoKCQkJfQoKCQkJLy8gQ29sbGVjdCBpbmZsdWVuY2VzCgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKysgKSB7CgoJCQkJY29uc3QgaW5mbHVlbmNlID0gaW5mbHVlbmNlc1sgaSBdOwoKCQkJCWluZmx1ZW5jZVsgMCBdID0gaTsKCQkJCWluZmx1ZW5jZVsgMSBdID0gb2JqZWN0SW5mbHVlbmNlc1sgaSBdOwoKCQkJfQoKCQkJaW5mbHVlbmNlcy5zb3J0KCBhYnNOdW1lcmljYWxTb3J0ICk7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA4OyBpICsrICkgewoKCQkJCWlmICggaSA8IGxlbmd0aCAmJiBpbmZsdWVuY2VzWyBpIF1bIDEgXSApIHsKCgkJCQkJd29ya0luZmx1ZW5jZXNbIGkgXVsgMCBdID0gaW5mbHVlbmNlc1sgaSBdWyAwIF07CgkJCQkJd29ya0luZmx1ZW5jZXNbIGkgXVsgMSBdID0gaW5mbHVlbmNlc1sgaSBdWyAxIF07CgoJCQkJfSBlbHNlIHsKCgkJCQkJd29ya0luZmx1ZW5jZXNbIGkgXVsgMCBdID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkJCQkJd29ya0luZmx1ZW5jZXNbIGkgXVsgMSBdID0gMDsKCgkJCQl9CgoJCQl9CgoJCQl3b3JrSW5mbHVlbmNlcy5zb3J0KCBudW1lcmljYWxTb3J0ICk7CgoJCQljb25zdCBtb3JwaFRhcmdldHMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CgkJCWNvbnN0IG1vcnBoTm9ybWFscyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWw7CgoJCQlsZXQgbW9ycGhJbmZsdWVuY2VzU3VtID0gMDsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDg7IGkgKysgKSB7CgoJCQkJY29uc3QgaW5mbHVlbmNlID0gd29ya0luZmx1ZW5jZXNbIGkgXTsKCQkJCWNvbnN0IGluZGV4ID0gaW5mbHVlbmNlWyAwIF07CgkJCQljb25zdCB2YWx1ZSA9IGluZmx1ZW5jZVsgMSBdOwoKCQkJCWlmICggaW5kZXggIT09IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSICYmIHZhbHVlICkgewoKCQkJCQlpZiAoIG1vcnBoVGFyZ2V0cyAmJiBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdtb3JwaFRhcmdldCcgKyBpICkgIT09IG1vcnBoVGFyZ2V0c1sgaW5kZXggXSApIHsKCgkJCQkJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ21vcnBoVGFyZ2V0JyArIGksIG1vcnBoVGFyZ2V0c1sgaW5kZXggXSApOwoKCQkJCQl9CgoJCQkJCWlmICggbW9ycGhOb3JtYWxzICYmIGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ21vcnBoTm9ybWFsJyArIGkgKSAhPT0gbW9ycGhOb3JtYWxzWyBpbmRleCBdICkgewoKCQkJCQkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAnbW9ycGhOb3JtYWwnICsgaSwgbW9ycGhOb3JtYWxzWyBpbmRleCBdICk7CgoJCQkJCX0KCgkJCQkJbW9ycGhJbmZsdWVuY2VzWyBpIF0gPSB2YWx1ZTsKCQkJCQltb3JwaEluZmx1ZW5jZXNTdW0gKz0gdmFsdWU7CgoJCQkJfSBlbHNlIHsKCgkJCQkJaWYgKCBtb3JwaFRhcmdldHMgJiYgZ2VvbWV0cnkuaGFzQXR0cmlidXRlKCAnbW9ycGhUYXJnZXQnICsgaSApID09PSB0cnVlICkgewoKCQkJCQkJZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAnbW9ycGhUYXJnZXQnICsgaSApOwoKCQkJCQl9CgoJCQkJCWlmICggbW9ycGhOb3JtYWxzICYmIGdlb21ldHJ5Lmhhc0F0dHJpYnV0ZSggJ21vcnBoTm9ybWFsJyArIGkgKSA9PT0gdHJ1ZSApIHsKCgkJCQkJCWdlb21ldHJ5LmRlbGV0ZUF0dHJpYnV0ZSggJ21vcnBoTm9ybWFsJyArIGkgKTsKCgkJCQkJfQoKCQkJCQltb3JwaEluZmx1ZW5jZXNbIGkgXSA9IDA7CgoJCQkJfQoKCQkJfQoKCQkJLy8gR0xTTCBzaGFkZXIgdXNlcyBmb3JtdWxhIGJhc2VpbmZsdWVuY2UgKiBiYXNlICsgc3VtKHRhcmdldCAqIGluZmx1ZW5jZSkKCQkJLy8gVGhpcyBhbGxvd3MgdXMgdG8gc3dpdGNoIGJldHdlZW4gYWJzb2x1dGUgbW9ycGhzIGFuZCByZWxhdGl2ZSBtb3JwaHMgd2l0aG91dCBjaGFuZ2luZyBzaGFkZXIgY29kZQoJCQkvLyBXaGVuIGJhc2VpbmZsdWVuY2UgPSAxIC0gc3VtKGluZmx1ZW5jZSksIHRoZSBhYm92ZSBpcyBlcXVpdmFsZW50IHRvIHN1bSgodGFyZ2V0IC0gYmFzZSkgKiBpbmZsdWVuY2UpCgkJCWNvbnN0IG1vcnBoQmFzZUluZmx1ZW5jZSA9IGdlb21ldHJ5Lm1vcnBoVGFyZ2V0c1JlbGF0aXZlID8gMSA6IDEgLSBtb3JwaEluZmx1ZW5jZXNTdW07CgoJCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlJywgbW9ycGhCYXNlSW5mbHVlbmNlICk7CgkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEluZmx1ZW5jZXMnLCBtb3JwaEluZmx1ZW5jZXMgKTsKCgkJfQoKCX0KCglyZXR1cm4gewoKCQl1cGRhdGU6IHVwZGF0ZQoKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTE9iamVjdHMoIGdsLCBnZW9tZXRyaWVzLCBhdHRyaWJ1dGVzLCBpbmZvICkgewoKCWxldCB1cGRhdGVNYXAgPSBuZXcgV2Vha01hcCgpOwoKCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0ICkgewoKCQljb25zdCBmcmFtZSA9IGluZm8ucmVuZGVyLmZyYW1lOwoKCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdC5nZW9tZXRyeTsKCQljb25zdCBidWZmZXJnZW9tZXRyeSA9IGdlb21ldHJpZXMuZ2V0KCBvYmplY3QsIGdlb21ldHJ5ICk7CgoJCS8vIFVwZGF0ZSBvbmNlIHBlciBmcmFtZQoKCQlpZiAoIHVwZGF0ZU1hcC5nZXQoIGJ1ZmZlcmdlb21ldHJ5ICkgIT09IGZyYW1lICkgewoKCQkJZ2VvbWV0cmllcy51cGRhdGUoIGJ1ZmZlcmdlb21ldHJ5ICk7CgoJCQl1cGRhdGVNYXAuc2V0KCBidWZmZXJnZW9tZXRyeSwgZnJhbWUgKTsKCgkJfQoKCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggKSB7CgoJCQlpZiAoIG9iamVjdC5oYXNFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uSW5zdGFuY2VkTWVzaERpc3Bvc2UgKSA9PT0gZmFsc2UgKSB7CgoJCQkJb2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25JbnN0YW5jZWRNZXNoRGlzcG9zZSApOwoKCQkJfQoKCQkJaWYgKCB1cGRhdGVNYXAuZ2V0KCBvYmplY3QgKSAhPT0gZnJhbWUgKSB7CgoJCQkJYXR0cmlidXRlcy51cGRhdGUoIG9iamVjdC5pbnN0YW5jZU1hdHJpeCwgZ2wuQVJSQVlfQlVGRkVSICk7CgoJCQkJaWYgKCBvYmplY3QuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCApIHsKCgkJCQkJYXR0cmlidXRlcy51cGRhdGUoIG9iamVjdC5pbnN0YW5jZUNvbG9yLCBnbC5BUlJBWV9CVUZGRVIgKTsKCgkJCQl9CgoJCQkJdXBkYXRlTWFwLnNldCggb2JqZWN0LCBmcmFtZSApOwoKCQkJfQoKCQl9CgoJCWlmICggb2JqZWN0LmlzU2tpbm5lZE1lc2ggKSB7CgoJCQljb25zdCBza2VsZXRvbiA9IG9iamVjdC5za2VsZXRvbjsKCgkJCWlmICggdXBkYXRlTWFwLmdldCggc2tlbGV0b24gKSAhPT0gZnJhbWUgKSB7CgoJCQkJc2tlbGV0b24udXBkYXRlKCk7CgoJCQkJdXBkYXRlTWFwLnNldCggc2tlbGV0b24sIGZyYW1lICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIGJ1ZmZlcmdlb21ldHJ5OwoKCX0KCglmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQl1cGRhdGVNYXAgPSBuZXcgV2Vha01hcCgpOwoKCX0KCglmdW5jdGlvbiBvbkluc3RhbmNlZE1lc2hEaXNwb3NlKCBldmVudCApIHsKCgkJY29uc3QgaW5zdGFuY2VkTWVzaCA9IGV2ZW50LnRhcmdldDsKCgkJaW5zdGFuY2VkTWVzaC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uSW5zdGFuY2VkTWVzaERpc3Bvc2UgKTsKCgkJYXR0cmlidXRlcy5yZW1vdmUoIGluc3RhbmNlZE1lc2guaW5zdGFuY2VNYXRyaXggKTsKCgkJaWYgKCBpbnN0YW5jZWRNZXNoLmluc3RhbmNlQ29sb3IgIT09IG51bGwgKSBhdHRyaWJ1dGVzLnJlbW92ZSggaW5zdGFuY2VkTWVzaC5pbnN0YW5jZUNvbG9yICk7CgoJfQoKCXJldHVybiB7CgoJCXVwZGF0ZTogdXBkYXRlLAoJCWRpc3Bvc2U6IGRpc3Bvc2UKCgl9OwoKfQoKY2xhc3MgRGVwdGhUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIHdpZHRoLCBoZWlnaHQsIHR5cGUsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGFuaXNvdHJvcHksIGZvcm1hdCApIHsKCgkJZm9ybWF0ID0gZm9ybWF0ICE9PSB1bmRlZmluZWQgPyBmb3JtYXQgOiBEZXB0aEZvcm1hdDsKCgkJaWYgKCBmb3JtYXQgIT09IERlcHRoRm9ybWF0ICYmIGZvcm1hdCAhPT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnRGVwdGhUZXh0dXJlIGZvcm1hdCBtdXN0IGJlIGVpdGhlciBUSFJFRS5EZXB0aEZvcm1hdCBvciBUSFJFRS5EZXB0aFN0ZW5jaWxGb3JtYXQnICk7CgoJCX0KCgkJaWYgKCB0eXBlID09PSB1bmRlZmluZWQgJiYgZm9ybWF0ID09PSBEZXB0aEZvcm1hdCApIHR5cGUgPSBVbnNpZ25lZEludFR5cGU7CgkJaWYgKCB0eXBlID09PSB1bmRlZmluZWQgJiYgZm9ybWF0ID09PSBEZXB0aFN0ZW5jaWxGb3JtYXQgKSB0eXBlID0gVW5zaWduZWRJbnQyNDhUeXBlOwoKCQlzdXBlciggbnVsbCwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICk7CgoJCXRoaXMuaXNEZXB0aFRleHR1cmUgPSB0cnVlOwoKCQl0aGlzLmltYWdlID0geyB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0IH07CgoJCXRoaXMubWFnRmlsdGVyID0gbWFnRmlsdGVyICE9PSB1bmRlZmluZWQgPyBtYWdGaWx0ZXIgOiBOZWFyZXN0RmlsdGVyOwoJCXRoaXMubWluRmlsdGVyID0gbWluRmlsdGVyICE9PSB1bmRlZmluZWQgPyBtaW5GaWx0ZXIgOiBOZWFyZXN0RmlsdGVyOwoKCQl0aGlzLmZsaXBZID0gZmFsc2U7CgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgkJdGhpcy5jb21wYXJlRnVuY3Rpb24gPSBudWxsOwoKCX0KCgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5jb21wYXJlRnVuY3Rpb24gPSBzb3VyY2UuY29tcGFyZUZ1bmN0aW9uOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCBtZXRhICkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCBtZXRhICk7CgoJCWlmICggdGhpcy5jb21wYXJlRnVuY3Rpb24gIT09IG51bGwgKSBkYXRhLmNvbXBhcmVGdW5jdGlvbiA9IHRoaXMuY29tcGFyZUZ1bmN0aW9uOwoKCQlyZXR1cm4gZGF0YTsKCgl9Cgp9CgovKioKICogVW5pZm9ybXMgb2YgYSBwcm9ncmFtLgogKiBUaG9zZSBmb3JtIGEgdHJlZSBzdHJ1Y3R1cmUgd2l0aCBhIHNwZWNpYWwgdG9wLWxldmVsIGNvbnRhaW5lciBmb3IgdGhlIHJvb3QsCiAqIHdoaWNoIHlvdSBnZXQgYnkgY2FsbGluZyAnbmV3IFdlYkdMVW5pZm9ybXMoIGdsLCBwcm9ncmFtICknLgogKgogKgogKiBQcm9wZXJ0aWVzIG9mIGlubmVyIG5vZGVzIGluY2x1ZGluZyB0aGUgdG9wLWxldmVsIGNvbnRhaW5lcjoKICoKICogLnNlcSAtIGFycmF5IG9mIG5lc3RlZCB1bmlmb3JtcwogKiAubWFwIC0gbmVzdGVkIHVuaWZvcm1zIGJ5IG5hbWUKICoKICoKICogTWV0aG9kcyBvZiBhbGwgbm9kZXMgZXhjZXB0IHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyOgogKgogKiAuc2V0VmFsdWUoIGdsLCB2YWx1ZSwgW3RleHR1cmVzXSApCiAqCiAqIAkJdXBsb2FkcyBhIHVuaWZvcm0gdmFsdWUocykKICogIAl0aGUgJ3RleHR1cmVzJyBwYXJhbWV0ZXIgaXMgbmVlZGVkIGZvciBzYW1wbGVyIHVuaWZvcm1zCiAqCiAqCiAqIFN0YXRpYyBtZXRob2RzIG9mIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyICh0ZXh0dXJlcyBmYWN0b3JpemF0aW9ucyk6CiAqCiAqIC51cGxvYWQoIGdsLCBzZXEsIHZhbHVlcywgdGV4dHVyZXMgKQogKgogKiAJCXNldHMgdW5pZm9ybXMgaW4gJ3NlcScgdG8gJ3ZhbHVlc1tpZF0udmFsdWUnCiAqCiAqIC5zZXFXaXRoVmFsdWUoIHNlcSwgdmFsdWVzICkgOiBmaWx0ZXJlZFNlcQogKgogKiAJCWZpbHRlcnMgJ3NlcScgZW50cmllcyB3aXRoIGNvcnJlc3BvbmRpbmcgZW50cnkgaW4gdmFsdWVzCiAqCiAqCiAqIE1ldGhvZHMgb2YgdGhlIHRvcC1sZXZlbCBjb250YWluZXIgKHRleHR1cmVzIGZhY3Rvcml6YXRpb25zKToKICoKICogLnNldFZhbHVlKCBnbCwgbmFtZSwgdmFsdWUsIHRleHR1cmVzICkKICoKICogCQlzZXRzIHVuaWZvcm0gd2l0aCAgbmFtZSAnbmFtZScgdG8gJ3ZhbHVlJwogKgogKiAuc2V0T3B0aW9uYWwoIGdsLCBvYmosIHByb3AgKQogKgogKiAJCWxpa2UgLnNldCBmb3IgYW4gb3B0aW9uYWwgcHJvcGVydHkgb2YgdGhlIG9iamVjdAogKgogKi8KCgpjb25zdCBlbXB0eVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBUZXh0dXJlKCk7Cgpjb25zdCBlbXB0eVNoYWRvd1RleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBEZXB0aFRleHR1cmUoIDEsIDEgKTsKZW1wdHlTaGFkb3dUZXh0dXJlLmNvbXBhcmVGdW5jdGlvbiA9IExlc3NFcXVhbENvbXBhcmU7Cgpjb25zdCBlbXB0eUFycmF5VGV4dHVyZSA9IC8qQF9fUFVSRV9fKi8gbmV3IERhdGFBcnJheVRleHR1cmUoKTsKY29uc3QgZW1wdHkzZFRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBEYXRhM0RUZXh0dXJlKCk7CmNvbnN0IGVtcHR5Q3ViZVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBDdWJlVGV4dHVyZSgpOwoKLy8gLS0tIFV0aWxpdGllcyAtLS0KCi8vIEFycmF5IENhY2hlcyAocHJvdmlkZSB0eXBlZCBhcnJheXMgZm9yIHRlbXBvcmFyeSBieSBzaXplKQoKY29uc3QgYXJyYXlDYWNoZUYzMiA9IFtdOwpjb25zdCBhcnJheUNhY2hlSTMyID0gW107CgovLyBGbG9hdDMyQXJyYXkgY2FjaGVzIHVzZWQgZm9yIHVwbG9hZGluZyBNYXRyaXggdW5pZm9ybXMKCmNvbnN0IG1hdDRhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIDE2ICk7CmNvbnN0IG1hdDNhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIDkgKTsKY29uc3QgbWF0MmFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggNCApOwoKLy8gRmxhdHRlbmluZyBmb3IgYXJyYXlzIG9mIHZlY3RvcnMgYW5kIG1hdHJpY2VzCgpmdW5jdGlvbiBmbGF0dGVuKCBhcnJheSwgbkJsb2NrcywgYmxvY2tTaXplICkgewoKCWNvbnN0IGZpcnN0RWxlbSA9IGFycmF5WyAwIF07CgoJaWYgKCBmaXJzdEVsZW0gPD0gMCB8fCBmaXJzdEVsZW0gPiAwICkgcmV0dXJuIGFycmF5OwoJLy8gdW5vcHRpbWl6ZWQ6ICEgaXNOYU4oIGZpcnN0RWxlbSApCgkvLyBzZWUgaHR0cDovL2phY2tzb25kdW5zdGFuLmNvbS9hcnRpY2xlcy85ODMKCgljb25zdCBuID0gbkJsb2NrcyAqIGJsb2NrU2l6ZTsKCWxldCByID0gYXJyYXlDYWNoZUYzMlsgbiBdOwoKCWlmICggciA9PT0gdW5kZWZpbmVkICkgewoKCQlyID0gbmV3IEZsb2F0MzJBcnJheSggbiApOwoJCWFycmF5Q2FjaGVGMzJbIG4gXSA9IHI7CgoJfQoKCWlmICggbkJsb2NrcyAhPT0gMCApIHsKCgkJZmlyc3RFbGVtLnRvQXJyYXkoIHIsIDAgKTsKCgkJZm9yICggbGV0IGkgPSAxLCBvZmZzZXQgPSAwOyBpICE9PSBuQmxvY2tzOyArKyBpICkgewoKCQkJb2Zmc2V0ICs9IGJsb2NrU2l6ZTsKCQkJYXJyYXlbIGkgXS50b0FycmF5KCByLCBvZmZzZXQgKTsKCgkJfQoKCX0KCglyZXR1cm4gcjsKCn0KCmZ1bmN0aW9uIGFycmF5c0VxdWFsKCBhLCBiICkgewoKCWlmICggYS5sZW5ndGggIT09IGIubGVuZ3RoICkgcmV0dXJuIGZhbHNlOwoKCWZvciAoIGxldCBpID0gMCwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJaWYgKCBhWyBpIF0gIT09IGJbIGkgXSApIHJldHVybiBmYWxzZTsKCgl9CgoJcmV0dXJuIHRydWU7Cgp9CgpmdW5jdGlvbiBjb3B5QXJyYXkoIGEsIGIgKSB7CgoJZm9yICggbGV0IGkgPSAwLCBsID0gYi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQlhWyBpIF0gPSBiWyBpIF07CgoJfQoKfQoKLy8gVGV4dHVyZSB1bml0IGFsbG9jYXRpb24KCmZ1bmN0aW9uIGFsbG9jVGV4VW5pdHMoIHRleHR1cmVzLCBuICkgewoKCWxldCByID0gYXJyYXlDYWNoZUkzMlsgbiBdOwoKCWlmICggciA9PT0gdW5kZWZpbmVkICkgewoKCQlyID0gbmV3IEludDMyQXJyYXkoIG4gKTsKCQlhcnJheUNhY2hlSTMyWyBuIF0gPSByOwoKCX0KCglmb3IgKCBsZXQgaSA9IDA7IGkgIT09IG47ICsrIGkgKSB7CgoJCXJbIGkgXSA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCgl9CgoJcmV0dXJuIHI7Cgp9CgovLyAtLS0gU2V0dGVycyAtLS0KCi8vIE5vdGU6IERlZmluaW5nIHRoZXNlIG1ldGhvZHMgZXh0ZXJuYWxseSwgYmVjYXVzZSB0aGV5IGNvbWUgaW4gYSBidW5jaAovLyBhbmQgdGhpcyB3YXkgdGhlaXIgbmFtZXMgbWluaWZ5LgoKLy8gU2luZ2xlIHNjYWxhcgoKZnVuY3Rpb24gc2V0VmFsdWVWMWYoIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCglpZiAoIGNhY2hlWyAwIF0gPT09IHYgKSByZXR1cm47CgoJZ2wudW5pZm9ybTFmKCB0aGlzLmFkZHIsIHYgKTsKCgljYWNoZVsgMCBdID0gdjsKCn0KCi8vIFNpbmdsZSBmbG9hdCB2ZWN0b3IgKGZyb20gZmxhdCBhcnJheSBvciBUSFJFRS5WZWN0b3JOKQoKZnVuY3Rpb24gc2V0VmFsdWVWMmYoIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCglpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgKSB7CgoJCQlnbC51bmlmb3JtMmYoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCWNhY2hlWyAwIF0gPSB2Lng7CgkJCWNhY2hlWyAxIF0gPSB2Lnk7CgoJCX0KCgl9IGVsc2UgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtMmZ2KCB0aGlzLmFkZHIsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0KCn0KCmZ1bmN0aW9uIHNldFZhbHVlVjNmKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiApIHsKCgkJCWdsLnVuaWZvcm0zZiggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56ICk7CgoJCQljYWNoZVsgMCBdID0gdi54OwoJCQljYWNoZVsgMSBdID0gdi55OwoJCQljYWNoZVsgMiBdID0gdi56OwoKCQl9CgoJfSBlbHNlIGlmICggdi5yICE9PSB1bmRlZmluZWQgKSB7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdi5yIHx8IGNhY2hlWyAxIF0gIT09IHYuZyB8fCBjYWNoZVsgMiBdICE9PSB2LmIgKSB7CgoJCQlnbC51bmlmb3JtM2YoIHRoaXMuYWRkciwgdi5yLCB2LmcsIHYuYiApOwoKCQkJY2FjaGVbIDAgXSA9IHYucjsKCQkJY2FjaGVbIDEgXSA9IHYuZzsKCQkJY2FjaGVbIDIgXSA9IHYuYjsKCgkJfQoKCX0gZWxzZSB7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm0zZnYoIHRoaXMuYWRkciwgdiApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJfQoKfQoKZnVuY3Rpb24gc2V0VmFsdWVWNGYoIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCglpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgfHwgY2FjaGVbIDIgXSAhPT0gdi56IHx8IGNhY2hlWyAzIF0gIT09IHYudyApIHsKCgkJCWdsLnVuaWZvcm00ZiggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56LCB2LncgKTsKCgkJCWNhY2hlWyAwIF0gPSB2Lng7CgkJCWNhY2hlWyAxIF0gPSB2Lnk7CgkJCWNhY2hlWyAyIF0gPSB2Lno7CgkJCWNhY2hlWyAzIF0gPSB2Lnc7CgoJCX0KCgl9IGVsc2UgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtNGZ2KCB0aGlzLmFkZHIsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0KCn0KCi8vIFNpbmdsZSBtYXRyaXggKGZyb20gZmxhdCBhcnJheSBvciBUSFJFRS5NYXRyaXhOKQoKZnVuY3Rpb24gc2V0VmFsdWVNMiggZ2wsIHYgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKCWlmICggZWxlbWVudHMgPT09IHVuZGVmaW5lZCApIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJfSBlbHNlIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgoJCW1hdDJhcnJheS5zZXQoIGVsZW1lbnRzICk7CgoJCWdsLnVuaWZvcm1NYXRyaXgyZnYoIHRoaXMuYWRkciwgZmFsc2UsIG1hdDJhcnJheSApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKCX0KCn0KCmZ1bmN0aW9uIHNldFZhbHVlTTMoIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCWNvbnN0IGVsZW1lbnRzID0gdi5lbGVtZW50czsKCglpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm1NYXRyaXgzZnYoIHRoaXMuYWRkciwgZmFsc2UsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0gZWxzZSB7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCBlbGVtZW50cyApICkgcmV0dXJuOwoKCQltYXQzYXJyYXkuc2V0KCBlbGVtZW50cyApOwoKCQlnbC51bmlmb3JtTWF0cml4M2Z2KCB0aGlzLmFkZHIsIGZhbHNlLCBtYXQzYXJyYXkgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgZWxlbWVudHMgKTsKCgl9Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZU00KCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7Cgljb25zdCBlbGVtZW50cyA9IHYuZWxlbWVudHM7CgoJaWYgKCBlbGVtZW50cyA9PT0gdW5kZWZpbmVkICkgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtTWF0cml4NGZ2KCB0aGlzLmFkZHIsIGZhbHNlLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9IGVsc2UgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgZWxlbWVudHMgKSApIHJldHVybjsKCgkJbWF0NGFycmF5LnNldCggZWxlbWVudHMgKTsKCgkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0NGFycmF5ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIGVsZW1lbnRzICk7CgoJfQoKfQoKLy8gU2luZ2xlIGludGVnZXIgLyBib29sZWFuCgpmdW5jdGlvbiBzZXRWYWx1ZVYxaSggZ2wsIHYgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCWlmICggY2FjaGVbIDAgXSA9PT0gdiApIHJldHVybjsKCglnbC51bmlmb3JtMWkoIHRoaXMuYWRkciwgdiApOwoKCWNhY2hlWyAwIF0gPSB2OwoKfQoKLy8gU2luZ2xlIGludGVnZXIgLyBib29sZWFuIHZlY3RvciAoZnJvbSBmbGF0IGFycmF5IG9yIFRIUkVFLlZlY3Rvck4pCgpmdW5jdGlvbiBzZXRWYWx1ZVYyaSggZ2wsIHYgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSApIHsKCgkJCWdsLnVuaWZvcm0yaSggdGhpcy5hZGRyLCB2LngsIHYueSApOwoKCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJY2FjaGVbIDEgXSA9IHYueTsKCgkJfQoKCX0gZWxzZSB7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm0yaXYoIHRoaXMuYWRkciwgdiApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJfQoKfQoKZnVuY3Rpb24gc2V0VmFsdWVWM2koIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCglpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgfHwgY2FjaGVbIDIgXSAhPT0gdi56ICkgewoKCQkJZ2wudW5pZm9ybTNpKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCgkJCWNhY2hlWyAwIF0gPSB2Lng7CgkJCWNhY2hlWyAxIF0gPSB2Lnk7CgkJCWNhY2hlWyAyIF0gPSB2Lno7CgoJCX0KCgl9IGVsc2UgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtM2l2KCB0aGlzLmFkZHIsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0KCn0KCmZ1bmN0aW9uIHNldFZhbHVlVjRpKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiB8fCBjYWNoZVsgMyBdICE9PSB2LncgKSB7CgoJCQlnbC51bmlmb3JtNGkoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiwgdi53ICk7CgoJCQljYWNoZVsgMCBdID0gdi54OwoJCQljYWNoZVsgMSBdID0gdi55OwoJCQljYWNoZVsgMiBdID0gdi56OwoJCQljYWNoZVsgMyBdID0gdi53OwoKCQl9CgoJfSBlbHNlIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybTRpdiggdGhpcy5hZGRyLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9Cgp9CgovLyBTaW5nbGUgdW5zaWduZWQgaW50ZWdlcgoKZnVuY3Rpb24gc2V0VmFsdWVWMXVpKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJaWYgKCBjYWNoZVsgMCBdID09PSB2ICkgcmV0dXJuOwoKCWdsLnVuaWZvcm0xdWkoIHRoaXMuYWRkciwgdiApOwoKCWNhY2hlWyAwIF0gPSB2OwoKfQoKLy8gU2luZ2xlIHVuc2lnbmVkIGludGVnZXIgdmVjdG9yIChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuVmVjdG9yTikKCmZ1bmN0aW9uIHNldFZhbHVlVjJ1aSggZ2wsIHYgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSApIHsKCgkJCWdsLnVuaWZvcm0ydWkoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCWNhY2hlWyAwIF0gPSB2Lng7CgkJCWNhY2hlWyAxIF0gPSB2Lnk7CgoJCX0KCgl9IGVsc2UgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtMnVpdiggdGhpcy5hZGRyLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVYzdWkoIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCglpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgfHwgY2FjaGVbIDIgXSAhPT0gdi56ICkgewoKCQkJZ2wudW5pZm9ybTN1aSggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56ICk7CgoJCQljYWNoZVsgMCBdID0gdi54OwoJCQljYWNoZVsgMSBdID0gdi55OwoJCQljYWNoZVsgMiBdID0gdi56OwoKCQl9CgoJfSBlbHNlIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybTN1aXYoIHRoaXMuYWRkciwgdiApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJfQoKfQoKZnVuY3Rpb24gc2V0VmFsdWVWNHVpKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiB8fCBjYWNoZVsgMyBdICE9PSB2LncgKSB7CgoJCQlnbC51bmlmb3JtNHVpKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnosIHYudyApOwoKCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJY2FjaGVbIDIgXSA9IHYuejsKCQkJY2FjaGVbIDMgXSA9IHYudzsKCgkJfQoKCX0gZWxzZSB7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm00dWl2KCB0aGlzLmFkZHIsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0KCn0KCgovLyBTaW5nbGUgdGV4dHVyZSAoMkQgLyBDdWJlKQoKZnVuY3Rpb24gc2V0VmFsdWVUMSggZ2wsIHYsIHRleHR1cmVzICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQlnbC51bmlmb3JtMWkoIHRoaXMuYWRkciwgdW5pdCApOwoJCWNhY2hlWyAwIF0gPSB1bml0OwoKCX0KCgljb25zdCBlbXB0eVRleHR1cmUyRCA9ICggdGhpcy50eXBlID09PSBnbC5TQU1QTEVSXzJEX1NIQURPVyApID8gZW1wdHlTaGFkb3dUZXh0dXJlIDogZW1wdHlUZXh0dXJlOwoKCXRleHR1cmVzLnNldFRleHR1cmUyRCggdiB8fCBlbXB0eVRleHR1cmUyRCwgdW5pdCApOwoKfQoKZnVuY3Rpb24gc2V0VmFsdWVUM0QxKCBnbCwgdiwgdGV4dHVyZXMgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCglpZiAoIGNhY2hlWyAwIF0gIT09IHVuaXQgKSB7CgoJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB1bml0ICk7CgkJY2FjaGVbIDAgXSA9IHVuaXQ7CgoJfQoKCXRleHR1cmVzLnNldFRleHR1cmUzRCggdiB8fCBlbXB0eTNkVGV4dHVyZSwgdW5pdCApOwoKfQoKZnVuY3Rpb24gc2V0VmFsdWVUNiggZ2wsIHYsIHRleHR1cmVzICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQlnbC51bmlmb3JtMWkoIHRoaXMuYWRkciwgdW5pdCApOwoJCWNhY2hlWyAwIF0gPSB1bml0OwoKCX0KCgl0ZXh0dXJlcy5zZXRUZXh0dXJlQ3ViZSggdiB8fCBlbXB0eUN1YmVUZXh0dXJlLCB1bml0ICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVQyREFycmF5MSggZ2wsIHYsIHRleHR1cmVzICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQlnbC51bmlmb3JtMWkoIHRoaXMuYWRkciwgdW5pdCApOwoJCWNhY2hlWyAwIF0gPSB1bml0OwoKCX0KCgl0ZXh0dXJlcy5zZXRUZXh0dXJlMkRBcnJheSggdiB8fCBlbXB0eUFycmF5VGV4dHVyZSwgdW5pdCApOwoKfQoKLy8gSGVscGVyIHRvIHBpY2sgdGhlIHJpZ2h0IHNldHRlciBmb3IgdGhlIHNpbmd1bGFyIGNhc2UKCmZ1bmN0aW9uIGdldFNpbmd1bGFyU2V0dGVyKCB0eXBlICkgewoKCXN3aXRjaCAoIHR5cGUgKSB7CgoJCWNhc2UgMHgxNDA2OiByZXR1cm4gc2V0VmFsdWVWMWY7IC8vIEZMT0FUCgkJY2FzZSAweDhiNTA6IHJldHVybiBzZXRWYWx1ZVYyZjsgLy8gX1ZFQzIKCQljYXNlIDB4OGI1MTogcmV0dXJuIHNldFZhbHVlVjNmOyAvLyBfVkVDMwoJCWNhc2UgMHg4YjUyOiByZXR1cm4gc2V0VmFsdWVWNGY7IC8vIF9WRUM0CgoJCWNhc2UgMHg4YjVhOiByZXR1cm4gc2V0VmFsdWVNMjsgLy8gX01BVDIKCQljYXNlIDB4OGI1YjogcmV0dXJuIHNldFZhbHVlTTM7IC8vIF9NQVQzCgkJY2FzZSAweDhiNWM6IHJldHVybiBzZXRWYWx1ZU00OyAvLyBfTUFUNAoKCQljYXNlIDB4MTQwNDogY2FzZSAweDhiNTY6IHJldHVybiBzZXRWYWx1ZVYxaTsgLy8gSU5ULCBCT09MCgkJY2FzZSAweDhiNTM6IGNhc2UgMHg4YjU3OiByZXR1cm4gc2V0VmFsdWVWMmk7IC8vIF9WRUMyCgkJY2FzZSAweDhiNTQ6IGNhc2UgMHg4YjU4OiByZXR1cm4gc2V0VmFsdWVWM2k7IC8vIF9WRUMzCgkJY2FzZSAweDhiNTU6IGNhc2UgMHg4YjU5OiByZXR1cm4gc2V0VmFsdWVWNGk7IC8vIF9WRUM0CgoJCWNhc2UgMHgxNDA1OiByZXR1cm4gc2V0VmFsdWVWMXVpOyAvLyBVSU5UCgkJY2FzZSAweDhkYzY6IHJldHVybiBzZXRWYWx1ZVYydWk7IC8vIF9WRUMyCgkJY2FzZSAweDhkYzc6IHJldHVybiBzZXRWYWx1ZVYzdWk7IC8vIF9WRUMzCgkJY2FzZSAweDhkYzg6IHJldHVybiBzZXRWYWx1ZVY0dWk7IC8vIF9WRUM0CgoJCWNhc2UgMHg4YjVlOiAvLyBTQU1QTEVSXzJECgkJY2FzZSAweDhkNjY6IC8vIFNBTVBMRVJfRVhURVJOQUxfT0VTCgkJY2FzZSAweDhkY2E6IC8vIElOVF9TQU1QTEVSXzJECgkJY2FzZSAweDhkZDI6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSXzJECgkJY2FzZSAweDhiNjI6IC8vIFNBTVBMRVJfMkRfU0hBRE9XCgkJCXJldHVybiBzZXRWYWx1ZVQxOwoKCQljYXNlIDB4OGI1ZjogLy8gU0FNUExFUl8zRAoJCWNhc2UgMHg4ZGNiOiAvLyBJTlRfU0FNUExFUl8zRAoJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAoJCQlyZXR1cm4gc2V0VmFsdWVUM0QxOwoKCQljYXNlIDB4OGI2MDogLy8gU0FNUExFUl9DVUJFCgkJY2FzZSAweDhkY2M6IC8vIElOVF9TQU1QTEVSX0NVQkUKCQljYXNlIDB4OGRkNDogLy8gVU5TSUdORURfSU5UX1NBTVBMRVJfQ1VCRQoJCWNhc2UgMHg4ZGM1OiAvLyBTQU1QTEVSX0NVQkVfU0hBRE9XCgkJCXJldHVybiBzZXRWYWx1ZVQ2OwoKCQljYXNlIDB4OGRjMTogLy8gU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGNmOiAvLyBJTlRfU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGM0OiAvLyBTQU1QTEVSXzJEX0FSUkFZX1NIQURPVwoJCQlyZXR1cm4gc2V0VmFsdWVUMkRBcnJheTE7CgoJfQoKfQoKCi8vIEFycmF5IG9mIHNjYWxhcnMKCmZ1bmN0aW9uIHNldFZhbHVlVjFmQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm0xZnYoIHRoaXMuYWRkciwgdiApOwoKfQoKLy8gQXJyYXkgb2YgdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5IG9yIGFycmF5IG9mIFRIUkVFLlZlY3Rvck4pCgpmdW5jdGlvbiBzZXRWYWx1ZVYyZkFycmF5KCBnbCwgdiApIHsKCgljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCAyICk7CgoJZ2wudW5pZm9ybTJmdiggdGhpcy5hZGRyLCBkYXRhICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVYzZkFycmF5KCBnbCwgdiApIHsKCgljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCAzICk7CgoJZ2wudW5pZm9ybTNmdiggdGhpcy5hZGRyLCBkYXRhICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVY0ZkFycmF5KCBnbCwgdiApIHsKCgljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCA0ICk7CgoJZ2wudW5pZm9ybTRmdiggdGhpcy5hZGRyLCBkYXRhICk7Cgp9CgovLyBBcnJheSBvZiBtYXRyaWNlcyAoZnJvbSBmbGF0IGFycmF5IG9yIGFycmF5IG9mIFRIUkVFLk1hdHJpeE4pCgpmdW5jdGlvbiBzZXRWYWx1ZU0yQXJyYXkoIGdsLCB2ICkgewoKCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDQgKTsKCglnbC51bmlmb3JtTWF0cml4MmZ2KCB0aGlzLmFkZHIsIGZhbHNlLCBkYXRhICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZU0zQXJyYXkoIGdsLCB2ICkgewoKCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDkgKTsKCglnbC51bmlmb3JtTWF0cml4M2Z2KCB0aGlzLmFkZHIsIGZhbHNlLCBkYXRhICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZU00QXJyYXkoIGdsLCB2ICkgewoKCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDE2ICk7CgoJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKfQoKLy8gQXJyYXkgb2YgaW50ZWdlciAvIGJvb2xlYW4KCmZ1bmN0aW9uIHNldFZhbHVlVjFpQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdiApOwoKfQoKLy8gQXJyYXkgb2YgaW50ZWdlciAvIGJvb2xlYW4gdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5KQoKZnVuY3Rpb24gc2V0VmFsdWVWMmlBcnJheSggZ2wsIHYgKSB7CgoJZ2wudW5pZm9ybTJpdiggdGhpcy5hZGRyLCB2ICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVYzaUFycmF5KCBnbCwgdiApIHsKCglnbC51bmlmb3JtM2l2KCB0aGlzLmFkZHIsIHYgKTsKCn0KCmZ1bmN0aW9uIHNldFZhbHVlVjRpQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm00aXYoIHRoaXMuYWRkciwgdiApOwoKfQoKLy8gQXJyYXkgb2YgdW5zaWduZWQgaW50ZWdlcgoKZnVuY3Rpb24gc2V0VmFsdWVWMXVpQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm0xdWl2KCB0aGlzLmFkZHIsIHYgKTsKCn0KCi8vIEFycmF5IG9mIHVuc2lnbmVkIGludGVnZXIgdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5KQoKZnVuY3Rpb24gc2V0VmFsdWVWMnVpQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm0ydWl2KCB0aGlzLmFkZHIsIHYgKTsKCn0KCmZ1bmN0aW9uIHNldFZhbHVlVjN1aUFycmF5KCBnbCwgdiApIHsKCglnbC51bmlmb3JtM3VpdiggdGhpcy5hZGRyLCB2ICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVY0dWlBcnJheSggZ2wsIHYgKSB7CgoJZ2wudW5pZm9ybTR1aXYoIHRoaXMuYWRkciwgdiApOwoKfQoKCi8vIEFycmF5IG9mIHRleHR1cmVzICgyRCAvIDNEIC8gQ3ViZSAvIDJEQXJyYXkpCgpmdW5jdGlvbiBzZXRWYWx1ZVQxQXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJY29uc3QgbiA9IHYubGVuZ3RoOwoKCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCglpZiAoICEgYXJyYXlzRXF1YWwoIGNhY2hlLCB1bml0cyApICkgewoKCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJfQoKCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCgkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB2WyBpIF0gfHwgZW1wdHlUZXh0dXJlLCB1bml0c1sgaSBdICk7CgoJfQoKfQoKZnVuY3Rpb24gc2V0VmFsdWVUM0RBcnJheSggZ2wsIHYsIHRleHR1cmVzICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgljb25zdCBuID0gdi5sZW5ndGg7CgoJY29uc3QgdW5pdHMgPSBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApOwoKCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgoJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdW5pdHMgKTsKCgl9CgoJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQl0ZXh0dXJlcy5zZXRUZXh0dXJlM0QoIHZbIGkgXSB8fCBlbXB0eTNkVGV4dHVyZSwgdW5pdHNbIGkgXSApOwoKCX0KCn0KCmZ1bmN0aW9uIHNldFZhbHVlVDZBcnJheSggZ2wsIHYsIHRleHR1cmVzICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgljb25zdCBuID0gdi5sZW5ndGg7CgoJY29uc3QgdW5pdHMgPSBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApOwoKCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgoJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdW5pdHMgKTsKCgl9CgoJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQl0ZXh0dXJlcy5zZXRUZXh0dXJlQ3ViZSggdlsgaSBdIHx8IGVtcHR5Q3ViZVRleHR1cmUsIHVuaXRzWyBpIF0gKTsKCgl9Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVQyREFycmF5QXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJY29uc3QgbiA9IHYubGVuZ3RoOwoKCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCglpZiAoICEgYXJyYXlzRXF1YWwoIGNhY2hlLCB1bml0cyApICkgewoKCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJfQoKCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCgkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEQXJyYXkoIHZbIGkgXSB8fCBlbXB0eUFycmF5VGV4dHVyZSwgdW5pdHNbIGkgXSApOwoKCX0KCn0KCgovLyBIZWxwZXIgdG8gcGljayB0aGUgcmlnaHQgc2V0dGVyIGZvciBhIHB1cmUgKGJvdHRvbS1sZXZlbCkgYXJyYXkKCmZ1bmN0aW9uIGdldFB1cmVBcnJheVNldHRlciggdHlwZSApIHsKCglzd2l0Y2ggKCB0eXBlICkgewoKCQljYXNlIDB4MTQwNjogcmV0dXJuIHNldFZhbHVlVjFmQXJyYXk7IC8vIEZMT0FUCgkJY2FzZSAweDhiNTA6IHJldHVybiBzZXRWYWx1ZVYyZkFycmF5OyAvLyBfVkVDMgoJCWNhc2UgMHg4YjUxOiByZXR1cm4gc2V0VmFsdWVWM2ZBcnJheTsgLy8gX1ZFQzMKCQljYXNlIDB4OGI1MjogcmV0dXJuIHNldFZhbHVlVjRmQXJyYXk7IC8vIF9WRUM0CgoJCWNhc2UgMHg4YjVhOiByZXR1cm4gc2V0VmFsdWVNMkFycmF5OyAvLyBfTUFUMgoJCWNhc2UgMHg4YjViOiByZXR1cm4gc2V0VmFsdWVNM0FycmF5OyAvLyBfTUFUMwoJCWNhc2UgMHg4YjVjOiByZXR1cm4gc2V0VmFsdWVNNEFycmF5OyAvLyBfTUFUNAoKCQljYXNlIDB4MTQwNDogY2FzZSAweDhiNTY6IHJldHVybiBzZXRWYWx1ZVYxaUFycmF5OyAvLyBJTlQsIEJPT0wKCQljYXNlIDB4OGI1MzogY2FzZSAweDhiNTc6IHJldHVybiBzZXRWYWx1ZVYyaUFycmF5OyAvLyBfVkVDMgoJCWNhc2UgMHg4YjU0OiBjYXNlIDB4OGI1ODogcmV0dXJuIHNldFZhbHVlVjNpQXJyYXk7IC8vIF9WRUMzCgkJY2FzZSAweDhiNTU6IGNhc2UgMHg4YjU5OiByZXR1cm4gc2V0VmFsdWVWNGlBcnJheTsgLy8gX1ZFQzQKCgkJY2FzZSAweDE0MDU6IHJldHVybiBzZXRWYWx1ZVYxdWlBcnJheTsgLy8gVUlOVAoJCWNhc2UgMHg4ZGM2OiByZXR1cm4gc2V0VmFsdWVWMnVpQXJyYXk7IC8vIF9WRUMyCgkJY2FzZSAweDhkYzc6IHJldHVybiBzZXRWYWx1ZVYzdWlBcnJheTsgLy8gX1ZFQzMKCQljYXNlIDB4OGRjODogcmV0dXJuIHNldFZhbHVlVjR1aUFycmF5OyAvLyBfVkVDNAoKCQljYXNlIDB4OGI1ZTogLy8gU0FNUExFUl8yRAoJCWNhc2UgMHg4ZDY2OiAvLyBTQU1QTEVSX0VYVEVSTkFMX09FUwoJCWNhc2UgMHg4ZGNhOiAvLyBJTlRfU0FNUExFUl8yRAoJCWNhc2UgMHg4ZGQyOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRAoJCWNhc2UgMHg4YjYyOiAvLyBTQU1QTEVSXzJEX1NIQURPVwoJCQlyZXR1cm4gc2V0VmFsdWVUMUFycmF5OwoKCQljYXNlIDB4OGI1ZjogLy8gU0FNUExFUl8zRAoJCWNhc2UgMHg4ZGNiOiAvLyBJTlRfU0FNUExFUl8zRAoJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAoJCQlyZXR1cm4gc2V0VmFsdWVUM0RBcnJheTsKCgkJY2FzZSAweDhiNjA6IC8vIFNBTVBMRVJfQ1VCRQoJCWNhc2UgMHg4ZGNjOiAvLyBJTlRfU0FNUExFUl9DVUJFCgkJY2FzZSAweDhkZDQ6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSX0NVQkUKCQljYXNlIDB4OGRjNTogLy8gU0FNUExFUl9DVUJFX1NIQURPVwoJCQlyZXR1cm4gc2V0VmFsdWVUNkFycmF5OwoKCQljYXNlIDB4OGRjMTogLy8gU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGNmOiAvLyBJTlRfU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGM0OiAvLyBTQU1QTEVSXzJEX0FSUkFZX1NIQURPVwoJCQlyZXR1cm4gc2V0VmFsdWVUMkRBcnJheUFycmF5OwoKCX0KCn0KCi8vIC0tLSBVbmlmb3JtIENsYXNzZXMgLS0tCgpjbGFzcyBTaW5nbGVVbmlmb3JtIHsKCgljb25zdHJ1Y3RvciggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSB7CgoJCXRoaXMuaWQgPSBpZDsKCQl0aGlzLmFkZHIgPSBhZGRyOwoJCXRoaXMuY2FjaGUgPSBbXTsKCQl0aGlzLnR5cGUgPSBhY3RpdmVJbmZvLnR5cGU7CgkJdGhpcy5zZXRWYWx1ZSA9IGdldFNpbmd1bGFyU2V0dGVyKCBhY3RpdmVJbmZvLnR5cGUgKTsKCgkJLy8gdGhpcy5wYXRoID0gYWN0aXZlSW5mby5uYW1lOyAvLyBERUJVRwoKCX0KCn0KCmNsYXNzIFB1cmVBcnJheVVuaWZvcm0gewoKCWNvbnN0cnVjdG9yKCBpZCwgYWN0aXZlSW5mbywgYWRkciApIHsKCgkJdGhpcy5pZCA9IGlkOwoJCXRoaXMuYWRkciA9IGFkZHI7CgkJdGhpcy5jYWNoZSA9IFtdOwoJCXRoaXMudHlwZSA9IGFjdGl2ZUluZm8udHlwZTsKCQl0aGlzLnNpemUgPSBhY3RpdmVJbmZvLnNpemU7CgkJdGhpcy5zZXRWYWx1ZSA9IGdldFB1cmVBcnJheVNldHRlciggYWN0aXZlSW5mby50eXBlICk7CgoJCS8vIHRoaXMucGF0aCA9IGFjdGl2ZUluZm8ubmFtZTsgLy8gREVCVUcKCgl9Cgp9CgpjbGFzcyBTdHJ1Y3R1cmVkVW5pZm9ybSB7CgoJY29uc3RydWN0b3IoIGlkICkgewoKCQl0aGlzLmlkID0gaWQ7CgoJCXRoaXMuc2VxID0gW107CgkJdGhpcy5tYXAgPSB7fTsKCgl9CgoJc2V0VmFsdWUoIGdsLCB2YWx1ZSwgdGV4dHVyZXMgKSB7CgoJCWNvbnN0IHNlcSA9IHRoaXMuc2VxOwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBzZXEubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJY29uc3QgdSA9IHNlcVsgaSBdOwoJCQl1LnNldFZhbHVlKCBnbCwgdmFsdWVbIHUuaWQgXSwgdGV4dHVyZXMgKTsKCgkJfQoKCX0KCn0KCi8vIC0tLSBUb3AtbGV2ZWwgLS0tCgovLyBQYXJzZXIgLSBidWlsZHMgdXAgdGhlIHByb3BlcnR5IHRyZWUgZnJvbSB0aGUgcGF0aCBzdHJpbmdzCgpjb25zdCBSZVBhdGhQYXJ0ID0gLyhcdyspKFxdKT8oXFt8XC4pPy9nOwoKLy8gZXh0cmFjdHMKLy8gCS0gdGhlIGlkZW50aWZpZXIgKG1lbWJlciBuYW1lIG9yIGFycmF5IGluZGV4KQovLyAgLSBmb2xsb3dlZCBieSBhbiBvcHRpb25hbCByaWdodCBicmFja2V0IChmb3VuZCB3aGVuIGFycmF5IGluZGV4KQovLyAgLSBmb2xsb3dlZCBieSBhbiBvcHRpb25hbCBsZWZ0IGJyYWNrZXQgb3IgZG90ICh0eXBlIG9mIHN1YnNjcmlwdCkKLy8KLy8gTm90ZTogVGhlc2UgcG9ydGlvbnMgY2FuIGJlIHJlYWQgaW4gYSBub24tb3ZlcmxhcHBpbmcgZmFzaGlvbiBhbmQKLy8gYWxsb3cgc3RyYWlnaHRmb3J3YXJkIHBhcnNpbmcgb2YgdGhlIGhpZXJhcmNoeSB0aGF0IFdlYkdMIGVuY29kZXMKLy8gaW4gdGhlIHVuaWZvcm0gbmFtZXMuCgpmdW5jdGlvbiBhZGRVbmlmb3JtKCBjb250YWluZXIsIHVuaWZvcm1PYmplY3QgKSB7CgoJY29udGFpbmVyLnNlcS5wdXNoKCB1bmlmb3JtT2JqZWN0ICk7Cgljb250YWluZXIubWFwWyB1bmlmb3JtT2JqZWN0LmlkIF0gPSB1bmlmb3JtT2JqZWN0OwoKfQoKZnVuY3Rpb24gcGFyc2VVbmlmb3JtKCBhY3RpdmVJbmZvLCBhZGRyLCBjb250YWluZXIgKSB7CgoJY29uc3QgcGF0aCA9IGFjdGl2ZUluZm8ubmFtZSwKCQlwYXRoTGVuZ3RoID0gcGF0aC5sZW5ndGg7CgoJLy8gcmVzZXQgUmVnRXhwIG9iamVjdCwgYmVjYXVzZSBvZiB0aGUgZWFybHkgZXhpdCBvZiBhIHByZXZpb3VzIHJ1bgoJUmVQYXRoUGFydC5sYXN0SW5kZXggPSAwOwoKCXdoaWxlICggdHJ1ZSApIHsKCgkJY29uc3QgbWF0Y2ggPSBSZVBhdGhQYXJ0LmV4ZWMoIHBhdGggKSwKCQkJbWF0Y2hFbmQgPSBSZVBhdGhQYXJ0Lmxhc3RJbmRleDsKCgkJbGV0IGlkID0gbWF0Y2hbIDEgXTsKCQljb25zdCBpZElzSW5kZXggPSBtYXRjaFsgMiBdID09PSAnXScsCgkJCXN1YnNjcmlwdCA9IG1hdGNoWyAzIF07CgoJCWlmICggaWRJc0luZGV4ICkgaWQgPSBpZCB8IDA7IC8vIGNvbnZlcnQgdG8gaW50ZWdlcgoKCQlpZiAoIHN1YnNjcmlwdCA9PT0gdW5kZWZpbmVkIHx8IHN1YnNjcmlwdCA9PT0gJ1snICYmIG1hdGNoRW5kICsgMiA9PT0gcGF0aExlbmd0aCApIHsKCgkJCS8vIGJhcmUgbmFtZSBvciAicHVyZSIgYm90dG9tLWxldmVsIGFycmF5ICJbMF0iIHN1ZmZpeAoKCQkJYWRkVW5pZm9ybSggY29udGFpbmVyLCBzdWJzY3JpcHQgPT09IHVuZGVmaW5lZCA/CgkJCQluZXcgU2luZ2xlVW5pZm9ybSggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSA6CgkJCQluZXcgUHVyZUFycmF5VW5pZm9ybSggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSApOwoKCQkJYnJlYWs7CgoJCX0gZWxzZSB7CgoJCQkvLyBzdGVwIGludG8gaW5uZXIgbm9kZSAvIGNyZWF0ZSBpdCBpbiBjYXNlIGl0IGRvZXNuJ3QgZXhpc3QKCgkJCWNvbnN0IG1hcCA9IGNvbnRhaW5lci5tYXA7CgkJCWxldCBuZXh0ID0gbWFwWyBpZCBdOwoKCQkJaWYgKCBuZXh0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJbmV4dCA9IG5ldyBTdHJ1Y3R1cmVkVW5pZm9ybSggaWQgKTsKCQkJCWFkZFVuaWZvcm0oIGNvbnRhaW5lciwgbmV4dCApOwoKCQkJfQoKCQkJY29udGFpbmVyID0gbmV4dDsKCgkJfQoKCX0KCn0KCi8vIFJvb3QgQ29udGFpbmVyCgpjbGFzcyBXZWJHTFVuaWZvcm1zIHsKCgljb25zdHJ1Y3RvciggZ2wsIHByb2dyYW0gKSB7CgoJCXRoaXMuc2VxID0gW107CgkJdGhpcy5tYXAgPSB7fTsKCgkJY29uc3QgbiA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIoIHByb2dyYW0sIGdsLkFDVElWRV9VTklGT1JNUyApOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBuOyArKyBpICkgewoKCQkJY29uc3QgaW5mbyA9IGdsLmdldEFjdGl2ZVVuaWZvcm0oIHByb2dyYW0sIGkgKSwKCQkJCWFkZHIgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oIHByb2dyYW0sIGluZm8ubmFtZSApOwoKCQkJcGFyc2VVbmlmb3JtKCBpbmZvLCBhZGRyLCB0aGlzICk7CgoJCX0KCgl9CgoJc2V0VmFsdWUoIGdsLCBuYW1lLCB2YWx1ZSwgdGV4dHVyZXMgKSB7CgoJCWNvbnN0IHUgPSB0aGlzLm1hcFsgbmFtZSBdOwoKCQlpZiAoIHUgIT09IHVuZGVmaW5lZCApIHUuc2V0VmFsdWUoIGdsLCB2YWx1ZSwgdGV4dHVyZXMgKTsKCgl9CgoJc2V0T3B0aW9uYWwoIGdsLCBvYmplY3QsIG5hbWUgKSB7CgoJCWNvbnN0IHYgPSBvYmplY3RbIG5hbWUgXTsKCgkJaWYgKCB2ICE9PSB1bmRlZmluZWQgKSB0aGlzLnNldFZhbHVlKCBnbCwgbmFtZSwgdiApOwoKCX0KCglzdGF0aWMgdXBsb2FkKCBnbCwgc2VxLCB2YWx1ZXMsIHRleHR1cmVzICkgewoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBzZXEubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJY29uc3QgdSA9IHNlcVsgaSBdLAoJCQkJdiA9IHZhbHVlc1sgdS5pZCBdOwoKCQkJaWYgKCB2Lm5lZWRzVXBkYXRlICE9PSBmYWxzZSApIHsKCgkJCQkvLyBub3RlOiBhbHdheXMgdXBkYXRpbmcgd2hlbiAubmVlZHNVcGRhdGUgaXMgdW5kZWZpbmVkCgkJCQl1LnNldFZhbHVlKCBnbCwgdi52YWx1ZSwgdGV4dHVyZXMgKTsKCgkJCX0KCgkJfQoKCX0KCglzdGF0aWMgc2VxV2l0aFZhbHVlKCBzZXEsIHZhbHVlcyApIHsKCgkJY29uc3QgciA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBzZXEubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJY29uc3QgdSA9IHNlcVsgaSBdOwoJCQlpZiAoIHUuaWQgaW4gdmFsdWVzICkgci5wdXNoKCB1ICk7CgoJCX0KCgkJcmV0dXJuIHI7CgoJfQoKfQoKZnVuY3Rpb24gV2ViR0xTaGFkZXIoIGdsLCB0eXBlLCBzdHJpbmcgKSB7CgoJY29uc3Qgc2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKCB0eXBlICk7CgoJZ2wuc2hhZGVyU291cmNlKCBzaGFkZXIsIHN0cmluZyApOwoJZ2wuY29tcGlsZVNoYWRlciggc2hhZGVyICk7CgoJcmV0dXJuIHNoYWRlcjsKCn0KCi8vIEZyb20gaHR0cHM6Ly93d3cua2hyb25vcy5vcmcvcmVnaXN0cnkvd2ViZ2wvZXh0ZW5zaW9ucy9LSFJfcGFyYWxsZWxfc2hhZGVyX2NvbXBpbGUvCmNvbnN0IENPTVBMRVRJT05fU1RBVFVTX0tIUiA9IDB4OTFCMTsKCmxldCBwcm9ncmFtSWRDb3VudCA9IDA7CgpmdW5jdGlvbiBoYW5kbGVTb3VyY2UoIHN0cmluZywgZXJyb3JMaW5lICkgewoKCWNvbnN0IGxpbmVzID0gc3RyaW5nLnNwbGl0KCAnXG4nICk7Cgljb25zdCBsaW5lczIgPSBbXTsKCgljb25zdCBmcm9tID0gTWF0aC5tYXgoIGVycm9yTGluZSAtIDYsIDAgKTsKCWNvbnN0IHRvID0gTWF0aC5taW4oIGVycm9yTGluZSArIDYsIGxpbmVzLmxlbmd0aCApOwoKCWZvciAoIGxldCBpID0gZnJvbTsgaSA8IHRvOyBpICsrICkgewoKCQljb25zdCBsaW5lID0gaSArIDE7CgkJbGluZXMyLnB1c2goIGAke2xpbmUgPT09IGVycm9yTGluZSA/ICc+JyA6ICcgJ30gJHtsaW5lfTogJHtsaW5lc1sgaSBdfWAgKTsKCgl9CgoJcmV0dXJuIGxpbmVzMi5qb2luKCAnXG4nICk7Cgp9CgpmdW5jdGlvbiBnZXRFbmNvZGluZ0NvbXBvbmVudHMoIGNvbG9yU3BhY2UgKSB7CgoJY29uc3Qgd29ya2luZ1ByaW1hcmllcyA9IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApOwoJY29uc3QgZW5jb2RpbmdQcmltYXJpZXMgPSBDb2xvck1hbmFnZW1lbnQuZ2V0UHJpbWFyaWVzKCBjb2xvclNwYWNlICk7CgoJbGV0IGdhbXV0TWFwcGluZzsKCglpZiAoIHdvcmtpbmdQcmltYXJpZXMgPT09IGVuY29kaW5nUHJpbWFyaWVzICkgewoKCQlnYW11dE1hcHBpbmcgPSAnJzsKCgl9IGVsc2UgaWYgKCB3b3JraW5nUHJpbWFyaWVzID09PSBQM1ByaW1hcmllcyAmJiBlbmNvZGluZ1ByaW1hcmllcyA9PT0gUmVjNzA5UHJpbWFyaWVzICkgewoKCQlnYW11dE1hcHBpbmcgPSAnTGluZWFyRGlzcGxheVAzVG9MaW5lYXJTUkdCJzsKCgl9IGVsc2UgaWYgKCB3b3JraW5nUHJpbWFyaWVzID09PSBSZWM3MDlQcmltYXJpZXMgJiYgZW5jb2RpbmdQcmltYXJpZXMgPT09IFAzUHJpbWFyaWVzICkgewoKCQlnYW11dE1hcHBpbmcgPSAnTGluZWFyU1JHQlRvTGluZWFyRGlzcGxheVAzJzsKCgl9CgoJc3dpdGNoICggY29sb3JTcGFjZSApIHsKCgkJY2FzZSBMaW5lYXJTUkdCQ29sb3JTcGFjZToKCQljYXNlIExpbmVhckRpc3BsYXlQM0NvbG9yU3BhY2U6CgkJCXJldHVybiBbIGdhbXV0TWFwcGluZywgJ0xpbmVhclRyYW5zZmVyT0VURicgXTsKCgkJY2FzZSBTUkdCQ29sb3JTcGFjZToKCQljYXNlIERpc3BsYXlQM0NvbG9yU3BhY2U6CgkJCXJldHVybiBbIGdhbXV0TWFwcGluZywgJ3NSR0JUcmFuc2Zlck9FVEYnIF07CgoJCWRlZmF1bHQ6CgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbTogVW5zdXBwb3J0ZWQgY29sb3Igc3BhY2U6JywgY29sb3JTcGFjZSApOwoJCQlyZXR1cm4gWyBnYW11dE1hcHBpbmcsICdMaW5lYXJUcmFuc2Zlck9FVEYnIF07CgoJfQoKfQoKZnVuY3Rpb24gZ2V0U2hhZGVyRXJyb3JzKCBnbCwgc2hhZGVyLCB0eXBlICkgewoKCWNvbnN0IHN0YXR1cyA9IGdsLmdldFNoYWRlclBhcmFtZXRlciggc2hhZGVyLCBnbC5DT01QSUxFX1NUQVRVUyApOwoJY29uc3QgZXJyb3JzID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyggc2hhZGVyICkudHJpbSgpOwoKCWlmICggc3RhdHVzICYmIGVycm9ycyA9PT0gJycgKSByZXR1cm4gJyc7CgoJY29uc3QgZXJyb3JNYXRjaGVzID0gL0VSUk9SOiAwOihcZCspLy5leGVjKCBlcnJvcnMgKTsKCWlmICggZXJyb3JNYXRjaGVzICkgewoKCQkvLyAtLWVuYWJsZS1wcml2aWxlZ2VkLXdlYmdsLWV4dGVuc2lvbgoJCS8vIGNvbnNvbGUubG9nKCAnKionICsgdHlwZSArICcqKicsIGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2RlYnVnX3NoYWRlcnMnICkuZ2V0VHJhbnNsYXRlZFNoYWRlclNvdXJjZSggc2hhZGVyICkgKTsKCgkJY29uc3QgZXJyb3JMaW5lID0gcGFyc2VJbnQoIGVycm9yTWF0Y2hlc1sgMSBdICk7CgkJcmV0dXJuIHR5cGUudG9VcHBlckNhc2UoKSArICdcblxuJyArIGVycm9ycyArICdcblxuJyArIGhhbmRsZVNvdXJjZSggZ2wuZ2V0U2hhZGVyU291cmNlKCBzaGFkZXIgKSwgZXJyb3JMaW5lICk7CgoJfSBlbHNlIHsKCgkJcmV0dXJuIGVycm9yczsKCgl9Cgp9CgpmdW5jdGlvbiBnZXRUZXhlbEVuY29kaW5nRnVuY3Rpb24oIGZ1bmN0aW9uTmFtZSwgY29sb3JTcGFjZSApIHsKCgljb25zdCBjb21wb25lbnRzID0gZ2V0RW5jb2RpbmdDb21wb25lbnRzKCBjb2xvclNwYWNlICk7CglyZXR1cm4gYHZlYzQgJHtmdW5jdGlvbk5hbWV9KCB2ZWM0IHZhbHVlICkgeyByZXR1cm4gJHtjb21wb25lbnRzWyAwIF19KCAke2NvbXBvbmVudHNbIDEgXX0oIHZhbHVlICkgKTsgfWA7Cgp9CgpmdW5jdGlvbiBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIHRvbmVNYXBwaW5nICkgewoKCWxldCB0b25lTWFwcGluZ05hbWU7CgoJc3dpdGNoICggdG9uZU1hcHBpbmcgKSB7CgoJCWNhc2UgTGluZWFyVG9uZU1hcHBpbmc6CgkJCXRvbmVNYXBwaW5nTmFtZSA9ICdMaW5lYXInOwoJCQlicmVhazsKCgkJY2FzZSBSZWluaGFyZFRvbmVNYXBwaW5nOgoJCQl0b25lTWFwcGluZ05hbWUgPSAnUmVpbmhhcmQnOwoJCQlicmVhazsKCgkJY2FzZSBDaW5lb25Ub25lTWFwcGluZzoKCQkJdG9uZU1hcHBpbmdOYW1lID0gJ09wdGltaXplZENpbmVvbic7CgkJCWJyZWFrOwoKCQljYXNlIEFDRVNGaWxtaWNUb25lTWFwcGluZzoKCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0FDRVNGaWxtaWMnOwoJCQlicmVhazsKCgkJY2FzZSBBZ1hUb25lTWFwcGluZzoKCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0FnWCc7CgkJCWJyZWFrOwoKCQljYXNlIEN1c3RvbVRvbmVNYXBwaW5nOgoJCQl0b25lTWFwcGluZ05hbWUgPSAnQ3VzdG9tJzsKCQkJYnJlYWs7CgoJCWRlZmF1bHQ6CgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbTogVW5zdXBwb3J0ZWQgdG9uZU1hcHBpbmc6JywgdG9uZU1hcHBpbmcgKTsKCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0xpbmVhcic7CgoJfQoKCXJldHVybiAndmVjMyAnICsgZnVuY3Rpb25OYW1lICsgJyggdmVjMyBjb2xvciApIHsgcmV0dXJuICcgKyB0b25lTWFwcGluZ05hbWUgKyAnVG9uZU1hcHBpbmcoIGNvbG9yICk7IH0nOwoKfQoKZnVuY3Rpb24gZ2VuZXJhdGVFeHRlbnNpb25zKCBwYXJhbWV0ZXJzICkgewoKCWNvbnN0IGNodW5rcyA9IFsKCQkoIHBhcmFtZXRlcnMuZXh0ZW5zaW9uRGVyaXZhdGl2ZXMgfHwgISEgcGFyYW1ldGVycy5lbnZNYXBDdWJlVVZIZWlnaHQgfHwgcGFyYW1ldGVycy5idW1wTWFwIHx8IHBhcmFtZXRlcnMubm9ybWFsTWFwVGFuZ2VudFNwYWNlIHx8IHBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwIHx8IHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgfHwgcGFyYW1ldGVycy5zaGFkZXJJRCA9PT0gJ3BoeXNpY2FsJyApID8gJyNleHRlbnNpb24gR0xfT0VTX3N0YW5kYXJkX2Rlcml2YXRpdmVzIDogZW5hYmxlJyA6ICcnLAoJCSggcGFyYW1ldGVycy5leHRlbnNpb25GcmFnRGVwdGggfHwgcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICkgJiYgcGFyYW1ldGVycy5yZW5kZXJlckV4dGVuc2lvbkZyYWdEZXB0aCA/ICcjZXh0ZW5zaW9uIEdMX0VYVF9mcmFnX2RlcHRoIDogZW5hYmxlJyA6ICcnLAoJCSggcGFyYW1ldGVycy5leHRlbnNpb25EcmF3QnVmZmVycyAmJiBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uRHJhd0J1ZmZlcnMgKSA/ICcjZXh0ZW5zaW9uIEdMX0VYVF9kcmF3X2J1ZmZlcnMgOiByZXF1aXJlJyA6ICcnLAoJCSggcGFyYW1ldGVycy5leHRlbnNpb25TaGFkZXJUZXh0dXJlTE9EIHx8IHBhcmFtZXRlcnMuZW52TWFwIHx8IHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uICkgJiYgcGFyYW1ldGVycy5yZW5kZXJlckV4dGVuc2lvblNoYWRlclRleHR1cmVMb2QgPyAnI2V4dGVuc2lvbiBHTF9FWFRfc2hhZGVyX3RleHR1cmVfbG9kIDogZW5hYmxlJyA6ICcnCgldOwoKCXJldHVybiBjaHVua3MuZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7Cgp9CgpmdW5jdGlvbiBnZW5lcmF0ZVZlcnRleEV4dGVuc2lvbnMoIHBhcmFtZXRlcnMgKSB7CgoJY29uc3QgY2h1bmtzID0gWwoJCXBhcmFtZXRlcnMuZXh0ZW5zaW9uQ2xpcEN1bGxEaXN0YW5jZSA/ICcjZXh0ZW5zaW9uIEdMX0FOR0xFX2NsaXBfY3VsbF9kaXN0YW5jZSA6IHJlcXVpcmUnIDogJycKCV07CgoJcmV0dXJuIGNodW5rcy5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCn0KCmZ1bmN0aW9uIGdlbmVyYXRlRGVmaW5lcyggZGVmaW5lcyApIHsKCgljb25zdCBjaHVua3MgPSBbXTsKCglmb3IgKCBjb25zdCBuYW1lIGluIGRlZmluZXMgKSB7CgoJCWNvbnN0IHZhbHVlID0gZGVmaW5lc1sgbmFtZSBdOwoKCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIGNvbnRpbnVlOwoKCQljaHVua3MucHVzaCggJyNkZWZpbmUgJyArIG5hbWUgKyAnICcgKyB2YWx1ZSApOwoKCX0KCglyZXR1cm4gY2h1bmtzLmpvaW4oICdcbicgKTsKCn0KCmZ1bmN0aW9uIGZldGNoQXR0cmlidXRlTG9jYXRpb25zKCBnbCwgcHJvZ3JhbSApIHsKCgljb25zdCBhdHRyaWJ1dGVzID0ge307CgoJY29uc3QgbiA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIoIHByb2dyYW0sIGdsLkFDVElWRV9BVFRSSUJVVEVTICk7CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgbjsgaSArKyApIHsKCgkJY29uc3QgaW5mbyA9IGdsLmdldEFjdGl2ZUF0dHJpYiggcHJvZ3JhbSwgaSApOwoJCWNvbnN0IG5hbWUgPSBpbmZvLm5hbWU7CgoJCWxldCBsb2NhdGlvblNpemUgPSAxOwoJCWlmICggaW5mby50eXBlID09PSBnbC5GTE9BVF9NQVQyICkgbG9jYXRpb25TaXplID0gMjsKCQlpZiAoIGluZm8udHlwZSA9PT0gZ2wuRkxPQVRfTUFUMyApIGxvY2F0aW9uU2l6ZSA9IDM7CgkJaWYgKCBpbmZvLnR5cGUgPT09IGdsLkZMT0FUX01BVDQgKSBsb2NhdGlvblNpemUgPSA0OwoKCQkvLyBjb25zb2xlLmxvZyggJ1RIUkVFLldlYkdMUHJvZ3JhbTogQUNUSVZFIFZFUlRFWCBBVFRSSUJVVEU6JywgbmFtZSwgaSApOwoKCQlhdHRyaWJ1dGVzWyBuYW1lIF0gPSB7CgkJCXR5cGU6IGluZm8udHlwZSwKCQkJbG9jYXRpb246IGdsLmdldEF0dHJpYkxvY2F0aW9uKCBwcm9ncmFtLCBuYW1lICksCgkJCWxvY2F0aW9uU2l6ZTogbG9jYXRpb25TaXplCgkJfTsKCgl9CgoJcmV0dXJuIGF0dHJpYnV0ZXM7Cgp9CgpmdW5jdGlvbiBmaWx0ZXJFbXB0eUxpbmUoIHN0cmluZyApIHsKCglyZXR1cm4gc3RyaW5nICE9PSAnJzsKCn0KCmZ1bmN0aW9uIHJlcGxhY2VMaWdodE51bXMoIHN0cmluZywgcGFyYW1ldGVycyApIHsKCgljb25zdCBudW1TcG90TGlnaHRDb29yZHMgPSBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3MgKyBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodE1hcHMgLSBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwczsKCglyZXR1cm4gc3RyaW5nCgkJLnJlcGxhY2UoIC9OVU1fRElSX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0cyApCgkJLnJlcGxhY2UoIC9OVU1fU1BPVF9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRzICkKCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRNYXBzICkKCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX0NPT1JEUy9nLCBudW1TcG90TGlnaHRDb29yZHMgKQoJCS5yZXBsYWNlKCAvTlVNX1JFQ1RfQVJFQV9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1SZWN0QXJlYUxpZ2h0cyApCgkJLnJlcGxhY2UoIC9OVU1fUE9JTlRfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtUG9pbnRMaWdodHMgKQoJCS5yZXBsYWNlKCAvTlVNX0hFTUlfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtSGVtaUxpZ2h0cyApCgkJLnJlcGxhY2UoIC9OVU1fRElSX0xJR0hUX1NIQURPV1MvZywgcGFyYW1ldGVycy5udW1EaXJMaWdodFNoYWRvd3MgKQoJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRfU0hBRE9XU19XSVRIX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHMgKQoJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRfU0hBRE9XUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3MgKQoJCS5yZXBsYWNlKCAvTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MvZywgcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0U2hhZG93cyApOwoKfQoKZnVuY3Rpb24gcmVwbGFjZUNsaXBwaW5nUGxhbmVOdW1zKCBzdHJpbmcsIHBhcmFtZXRlcnMgKSB7CgoJcmV0dXJuIHN0cmluZwoJCS5yZXBsYWNlKCAvTlVNX0NMSVBQSU5HX1BMQU5FUy9nLCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICkKCQkucmVwbGFjZSggL1VOSU9OX0NMSVBQSU5HX1BMQU5FUy9nLCAoIHBhcmFtZXRlcnMubnVtQ2xpcHBpbmdQbGFuZXMgLSBwYXJhbWV0ZXJzLm51bUNsaXBJbnRlcnNlY3Rpb24gKSApOwoKfQoKLy8gUmVzb2x2ZSBJbmNsdWRlcwoKY29uc3QgaW5jbHVkZVBhdHRlcm4gPSAvXlsgXHRdKiNpbmNsdWRlICs8KFtcd1xkLi9dKyk+L2dtOwoKZnVuY3Rpb24gcmVzb2x2ZUluY2x1ZGVzKCBzdHJpbmcgKSB7CgoJcmV0dXJuIHN0cmluZy5yZXBsYWNlKCBpbmNsdWRlUGF0dGVybiwgaW5jbHVkZVJlcGxhY2VyICk7Cgp9Cgpjb25zdCBzaGFkZXJDaHVua01hcCA9IG5ldyBNYXAoIFsKCVsgJ2VuY29kaW5nc19mcmFnbWVudCcsICdjb2xvcnNwYWNlX2ZyYWdtZW50JyBdLCAvLyBAZGVwcmVjYXRlZCwgcjE1NAoJWyAnZW5jb2RpbmdzX3BhcnNfZnJhZ21lbnQnLCAnY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50JyBdLCAvLyBAZGVwcmVjYXRlZCwgcjE1NAoJWyAnb3V0cHV0X2ZyYWdtZW50JywgJ29wYXF1ZV9mcmFnbWVudCcgXSwgLy8gQGRlcHJlY2F0ZWQsIHIxNTQKXSApOwoKZnVuY3Rpb24gaW5jbHVkZVJlcGxhY2VyKCBtYXRjaCwgaW5jbHVkZSApIHsKCglsZXQgc3RyaW5nID0gU2hhZGVyQ2h1bmtbIGluY2x1ZGUgXTsKCglpZiAoIHN0cmluZyA9PT0gdW5kZWZpbmVkICkgewoKCQljb25zdCBuZXdJbmNsdWRlID0gc2hhZGVyQ2h1bmtNYXAuZ2V0KCBpbmNsdWRlICk7CgoJCWlmICggbmV3SW5jbHVkZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJc3RyaW5nID0gU2hhZGVyQ2h1bmtbIG5ld0luY2x1ZGUgXTsKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogU2hhZGVyIGNodW5rICIlcyIgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlICIlcyIgaW5zdGVhZC4nLCBpbmNsdWRlLCBuZXdJbmNsdWRlICk7CgoJCX0gZWxzZSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdDYW4gbm90IHJlc29sdmUgI2luY2x1ZGUgPCcgKyBpbmNsdWRlICsgJz4nICk7CgoJCX0KCgl9CgoJcmV0dXJuIHJlc29sdmVJbmNsdWRlcyggc3RyaW5nICk7Cgp9CgovLyBVbnJvbGwgTG9vcHMKCmNvbnN0IHVucm9sbExvb3BQYXR0ZXJuID0gLyNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRccytmb3JccypcKFxzKmludFxzK2lccyo9XHMqKFxkKylccyo7XHMqaVxzKjxccyooXGQrKVxzKjtccyppXHMqXCtcK1xzKlwpXHMqeyhbXHNcU10rPyl9XHMrI3ByYWdtYSB1bnJvbGxfbG9vcF9lbmQvZzsKCmZ1bmN0aW9uIHVucm9sbExvb3BzKCBzdHJpbmcgKSB7CgoJcmV0dXJuIHN0cmluZy5yZXBsYWNlKCB1bnJvbGxMb29wUGF0dGVybiwgbG9vcFJlcGxhY2VyICk7Cgp9CgpmdW5jdGlvbiBsb29wUmVwbGFjZXIoIG1hdGNoLCBzdGFydCwgZW5kLCBzbmlwcGV0ICkgewoKCWxldCBzdHJpbmcgPSAnJzsKCglmb3IgKCBsZXQgaSA9IHBhcnNlSW50KCBzdGFydCApOyBpIDwgcGFyc2VJbnQoIGVuZCApOyBpICsrICkgewoKCQlzdHJpbmcgKz0gc25pcHBldAoJCQkucmVwbGFjZSggL1xbXHMqaVxzKlxdL2csICdbICcgKyBpICsgJyBdJyApCgkJCS5yZXBsYWNlKCAvVU5ST0xMRURfTE9PUF9JTkRFWC9nLCBpICk7CgoJfQoKCXJldHVybiBzdHJpbmc7Cgp9CgovLwoKZnVuY3Rpb24gZ2VuZXJhdGVQcmVjaXNpb24oIHBhcmFtZXRlcnMgKSB7CgoJbGV0IHByZWNpc2lvbnN0cmluZyA9ICdwcmVjaXNpb24gJyArIHBhcmFtZXRlcnMucHJlY2lzaW9uICsgJyBmbG9hdDtcbnByZWNpc2lvbiAnICsgcGFyYW1ldGVycy5wcmVjaXNpb24gKyAnIGludDsnOwoKCWlmICggcGFyYW1ldGVycy5wcmVjaXNpb24gPT09ICdoaWdocCcgKSB7CgoJCXByZWNpc2lvbnN0cmluZyArPSAnXG4jZGVmaW5lIEhJR0hfUFJFQ0lTSU9OJzsKCgl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ21lZGl1bXAnICkgewoKCQlwcmVjaXNpb25zdHJpbmcgKz0gJ1xuI2RlZmluZSBNRURJVU1fUFJFQ0lTSU9OJzsKCgl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ2xvd3AnICkgewoKCQlwcmVjaXNpb25zdHJpbmcgKz0gJ1xuI2RlZmluZSBMT1dfUFJFQ0lTSU9OJzsKCgl9CgoJcmV0dXJuIHByZWNpc2lvbnN0cmluZzsKCn0KCmZ1bmN0aW9uIGdlbmVyYXRlU2hhZG93TWFwVHlwZURlZmluZSggcGFyYW1ldGVycyApIHsKCglsZXQgc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9CQVNJQyc7CgoJaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgPT09IFBDRlNoYWRvd01hcCApIHsKCgkJc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9QQ0YnOwoKCX0gZWxzZSBpZiAoIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSA9PT0gUENGU29mdFNoYWRvd01hcCApIHsKCgkJc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCc7CgoJfSBlbHNlIGlmICggcGFyYW1ldGVycy5zaGFkb3dNYXBUeXBlID09PSBWU01TaGFkb3dNYXAgKSB7CgoJCXNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfVlNNJzsKCgl9CgoJcmV0dXJuIHNoYWRvd01hcFR5cGVEZWZpbmU7Cgp9CgpmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKSB7CgoJbGV0IGVudk1hcFR5cGVEZWZpbmUgPSAnRU5WTUFQX1RZUEVfQ1VCRSc7CgoJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApIHsKCgkJc3dpdGNoICggcGFyYW1ldGVycy5lbnZNYXBNb2RlICkgewoKCQkJY2FzZSBDdWJlUmVmbGVjdGlvbk1hcHBpbmc6CgkJCWNhc2UgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOgoJCQkJZW52TWFwVHlwZURlZmluZSA9ICdFTlZNQVBfVFlQRV9DVUJFJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZzoKCQkJCWVudk1hcFR5cGVEZWZpbmUgPSAnRU5WTUFQX1RZUEVfQ1VCRV9VVic7CgkJCQlicmVhazsKCgkJfQoKCX0KCglyZXR1cm4gZW52TWFwVHlwZURlZmluZTsKCn0KCmZ1bmN0aW9uIGdlbmVyYXRlRW52TWFwTW9kZURlZmluZSggcGFyYW1ldGVycyApIHsKCglsZXQgZW52TWFwTW9kZURlZmluZSA9ICdFTlZNQVBfTU9ERV9SRUZMRUNUSU9OJzsKCglpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkgewoKCQlzd2l0Y2ggKCBwYXJhbWV0ZXJzLmVudk1hcE1vZGUgKSB7CgoJCQljYXNlIEN1YmVSZWZyYWN0aW9uTWFwcGluZzoKCgkJCQllbnZNYXBNb2RlRGVmaW5lID0gJ0VOVk1BUF9NT0RFX1JFRlJBQ1RJT04nOwoJCQkJYnJlYWs7CgoJCX0KCgl9CgoJcmV0dXJuIGVudk1hcE1vZGVEZWZpbmU7Cgp9CgpmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcEJsZW5kaW5nRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKCWxldCBlbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfTk9ORSc7CgoJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApIHsKCgkJc3dpdGNoICggcGFyYW1ldGVycy5jb21iaW5lICkgewoKCQkJY2FzZSBNdWx0aXBseU9wZXJhdGlvbjoKCQkJCWVudk1hcEJsZW5kaW5nRGVmaW5lID0gJ0VOVk1BUF9CTEVORElOR19NVUxUSVBMWSc7CgkJCQlicmVhazsKCgkJCWNhc2UgTWl4T3BlcmF0aW9uOgoJCQkJZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX01JWCc7CgkJCQlicmVhazsKCgkJCWNhc2UgQWRkT3BlcmF0aW9uOgoJCQkJZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX0FERCc7CgkJCQlicmVhazsKCgkJfQoKCX0KCglyZXR1cm4gZW52TWFwQmxlbmRpbmdEZWZpbmU7Cgp9CgpmdW5jdGlvbiBnZW5lcmF0ZUN1YmVVVlNpemUoIHBhcmFtZXRlcnMgKSB7CgoJY29uc3QgaW1hZ2VIZWlnaHQgPSBwYXJhbWV0ZXJzLmVudk1hcEN1YmVVVkhlaWdodDsKCglpZiAoIGltYWdlSGVpZ2h0ID09PSBudWxsICkgcmV0dXJuIG51bGw7CgoJY29uc3QgbWF4TWlwID0gTWF0aC5sb2cyKCBpbWFnZUhlaWdodCApIC0gMjsKCgljb25zdCB0ZXhlbEhlaWdodCA9IDEuMCAvIGltYWdlSGVpZ2h0OwoKCWNvbnN0IHRleGVsV2lkdGggPSAxLjAgLyAoIDMgKiBNYXRoLm1heCggTWF0aC5wb3coIDIsIG1heE1pcCApLCA3ICogMTYgKSApOwoKCXJldHVybiB7IHRleGVsV2lkdGgsIHRleGVsSGVpZ2h0LCBtYXhNaXAgfTsKCn0KCmZ1bmN0aW9uIFdlYkdMUHJvZ3JhbSggcmVuZGVyZXIsIGNhY2hlS2V5LCBwYXJhbWV0ZXJzLCBiaW5kaW5nU3RhdGVzICkgewoKCS8vIFRPRE8gU2VuZCB0aGlzIGV2ZW50IHRvIFRocmVlLmpzIERldlRvb2xzCgkvLyBjb25zb2xlLmxvZyggJ1dlYkdMUHJvZ3JhbScsIGNhY2hlS2V5ICk7CgoJY29uc3QgZ2wgPSByZW5kZXJlci5nZXRDb250ZXh0KCk7CgoJY29uc3QgZGVmaW5lcyA9IHBhcmFtZXRlcnMuZGVmaW5lczsKCglsZXQgdmVydGV4U2hhZGVyID0gcGFyYW1ldGVycy52ZXJ0ZXhTaGFkZXI7CglsZXQgZnJhZ21lbnRTaGFkZXIgPSBwYXJhbWV0ZXJzLmZyYWdtZW50U2hhZGVyOwoKCWNvbnN0IHNoYWRvd01hcFR5cGVEZWZpbmUgPSBnZW5lcmF0ZVNoYWRvd01hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKCWNvbnN0IGVudk1hcFR5cGVEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKCWNvbnN0IGVudk1hcE1vZGVEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcE1vZGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKCWNvbnN0IGVudk1hcEJsZW5kaW5nRGVmaW5lID0gZ2VuZXJhdGVFbnZNYXBCbGVuZGluZ0RlZmluZSggcGFyYW1ldGVycyApOwoJY29uc3QgZW52TWFwQ3ViZVVWU2l6ZSA9IGdlbmVyYXRlQ3ViZVVWU2l6ZSggcGFyYW1ldGVycyApOwoKCWNvbnN0IGN1c3RvbUV4dGVuc2lvbnMgPSBwYXJhbWV0ZXJzLmlzV2ViR0wyID8gJycgOiBnZW5lcmF0ZUV4dGVuc2lvbnMoIHBhcmFtZXRlcnMgKTsKCgljb25zdCBjdXN0b21WZXJ0ZXhFeHRlbnNpb25zID0gZ2VuZXJhdGVWZXJ0ZXhFeHRlbnNpb25zKCBwYXJhbWV0ZXJzICk7CgoJY29uc3QgY3VzdG9tRGVmaW5lcyA9IGdlbmVyYXRlRGVmaW5lcyggZGVmaW5lcyApOwoKCWNvbnN0IHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7CgoJbGV0IHByZWZpeFZlcnRleCwgcHJlZml4RnJhZ21lbnQ7CglsZXQgdmVyc2lvblN0cmluZyA9IHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gPyAnI3ZlcnNpb24gJyArIHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gKyAnXG4nIDogJyc7CgoJaWYgKCBwYXJhbWV0ZXJzLmlzUmF3U2hhZGVyTWF0ZXJpYWwgKSB7CgoJCXByZWZpeFZlcnRleCA9IFsKCgkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCScjZGVmaW5lIFNIQURFUl9OQU1FICcgKyBwYXJhbWV0ZXJzLnNoYWRlck5hbWUsCgoJCQljdXN0b21EZWZpbmVzCgoJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJCWlmICggcHJlZml4VmVydGV4Lmxlbmd0aCA+IDAgKSB7CgoJCQlwcmVmaXhWZXJ0ZXggKz0gJ1xuJzsKCgkJfQoKCQlwcmVmaXhGcmFnbWVudCA9IFsKCgkJCWN1c3RvbUV4dGVuc2lvbnMsCgoJCQknI2RlZmluZSBTSEFERVJfVFlQRSAnICsgcGFyYW1ldGVycy5zaGFkZXJUeXBlLAoJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKCQkJY3VzdG9tRGVmaW5lcwoKCQldLmZpbHRlciggZmlsdGVyRW1wdHlMaW5lICkuam9pbiggJ1xuJyApOwoKCQlpZiAoIHByZWZpeEZyYWdtZW50Lmxlbmd0aCA+IDAgKSB7CgoJCQlwcmVmaXhGcmFnbWVudCArPSAnXG4nOwoKCQl9CgoJfSBlbHNlIHsKCgkJcHJlZml4VmVydGV4ID0gWwoKCQkJZ2VuZXJhdGVQcmVjaXNpb24oIHBhcmFtZXRlcnMgKSwKCgkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCScjZGVmaW5lIFNIQURFUl9OQU1FICcgKyBwYXJhbWV0ZXJzLnNoYWRlck5hbWUsCgoJCQljdXN0b21EZWZpbmVzLAoKCQkJcGFyYW1ldGVycy5leHRlbnNpb25DbGlwQ3VsbERpc3RhbmNlID8gJyNkZWZpbmUgVVNFX0NMSVBfRElTVEFOQ0UnIDogJycsCgkJCXBhcmFtZXRlcnMuYmF0Y2hpbmcgPyAnI2RlZmluZSBVU0VfQkFUQ0hJTkcnIDogJycsCgkJCXBhcmFtZXRlcnMuaW5zdGFuY2luZyA/ICcjZGVmaW5lIFVTRV9JTlNUQU5DSU5HJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvciA/ICcjZGVmaW5lIFVTRV9JTlNUQU5DSU5HX0NPTE9SJyA6ICcnLAoKCQkJcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2cgPyAnI2RlZmluZSBVU0VfRk9HJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZ0V4cDIgPyAnI2RlZmluZSBGT0dfRVhQMicgOiAnJywKCgkJCXBhcmFtZXRlcnMubWFwID8gJyNkZWZpbmUgVVNFX01BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5lbnZNYXAgPyAnI2RlZmluZSBVU0VfRU5WTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lICcgKyBlbnZNYXBNb2RlRGVmaW5lIDogJycsCgkJCXBhcmFtZXRlcnMubGlnaHRNYXAgPyAnI2RlZmluZSBVU0VfTElHSFRNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuYW9NYXAgPyAnI2RlZmluZSBVU0VfQU9NQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuYnVtcE1hcCA/ICcjZGVmaW5lIFVTRV9CVU1QTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcCA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMubm9ybWFsTWFwT2JqZWN0U3BhY2UgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQX09CSkVDVFNQQUNFJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcFRhbmdlbnRTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcCA/ICcjZGVmaW5lIFVTRV9ESVNQTEFDRU1FTlRNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyAnI2RlZmluZSBVU0VfRU1JU1NJVkVNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHkgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWScgOiAnJywKCQkJcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwID8gJyNkZWZpbmUgVVNFX0FOSVNPVFJPUFlNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlTWFwID8gJyNkZWZpbmUgVVNFX0lSSURFU0NFTkNFTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID8gJyNkZWZpbmUgVVNFX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuc3BlY3VsYXJNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcCA/ICcjZGVmaW5lIFVTRV9TUEVDVUxBUl9DT0xPUk1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5zcGVjdWxhckludGVuc2l0eU1hcCA/ICcjZGVmaW5lIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9ST1VHSE5FU1NNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMubWV0YWxuZXNzTWFwID8gJyNkZWZpbmUgVVNFX01FVEFMTkVTU01BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5hbHBoYU1hcCA/ICcjZGVmaW5lIFVTRV9BTFBIQU1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5hbHBoYUhhc2ggPyAnI2RlZmluZSBVU0VfQUxQSEFIQVNIJyA6ICcnLAoKCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb24gPyAnI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcCA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT05NQVAnIDogJycsCgkJCXBhcmFtZXRlcnMudGhpY2tuZXNzTWFwID8gJyNkZWZpbmUgVVNFX1RISUNLTkVTU01BUCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9DT0xPUk1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVAnIDogJycsCgoJCQkvLwoKCQkJcGFyYW1ldGVycy5tYXBVdiA/ICcjZGVmaW5lIE1BUF9VViAnICsgcGFyYW1ldGVycy5tYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLmFscGhhTWFwVXYgPyAnI2RlZmluZSBBTFBIQU1BUF9VViAnICsgcGFyYW1ldGVycy5hbHBoYU1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMubGlnaHRNYXBVdiA/ICcjZGVmaW5lIExJR0hUTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmxpZ2h0TWFwVXYgOiAnJywKCQkJcGFyYW1ldGVycy5hb01hcFV2ID8gJyNkZWZpbmUgQU9NQVBfVVYgJyArIHBhcmFtZXRlcnMuYW9NYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLmVtaXNzaXZlTWFwVXYgPyAnI2RlZmluZSBFTUlTU0lWRU1BUF9VViAnICsgcGFyYW1ldGVycy5lbWlzc2l2ZU1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMuYnVtcE1hcFV2ID8gJyNkZWZpbmUgQlVNUE1BUF9VViAnICsgcGFyYW1ldGVycy5idW1wTWFwVXYgOiAnJywKCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBVdiA/ICcjZGVmaW5lIE5PUk1BTE1BUF9VViAnICsgcGFyYW1ldGVycy5ub3JtYWxNYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2ID8gJyNkZWZpbmUgRElTUExBQ0VNRU5UTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2IDogJycsCgoJCQlwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcFV2ID8gJyNkZWZpbmUgTUVUQUxORVNTTUFQX1VWICcgKyBwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMucm91Z2huZXNzTWFwVXYgPyAnI2RlZmluZSBST1VHSE5FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMucm91Z2huZXNzTWFwVXYgOiAnJywKCgkJCXBhcmFtZXRlcnMuYW5pc290cm9weU1hcFV2ID8gJyNkZWZpbmUgQU5JU09UUk9QWU1BUF9VViAnICsgcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwVXYgOiAnJywKCgkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwVXYgPyAnI2RlZmluZSBDTEVBUkNPQVRNQVBfVVYgJyArIHBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwVXYgOiAnJywKCQkJcGFyYW1ldGVycy5jbGVhcmNvYXROb3JtYWxNYXBVdiA/ICcjZGVmaW5lIENMRUFSQ09BVF9OT1JNQUxNQVBfVVYgJyArIHBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwVXYgOiAnJywKCQkJcGFyYW1ldGVycy5jbGVhcmNvYXRSb3VnaG5lc3NNYXBVdiA/ICcjZGVmaW5lIENMRUFSQ09BVF9ST1VHSE5FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgOiAnJywKCgkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VNYXBVdiA/ICcjZGVmaW5lIElSSURFU0NFTkNFTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlTWFwVXYgOiAnJywKCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2ID8gJyNkZWZpbmUgSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgOiAnJywKCgkJCXBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcFV2ID8gJyNkZWZpbmUgU0hFRU5fQ09MT1JNQVBfVVYgJyArIHBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMuc2hlZW5Sb3VnaG5lc3NNYXBVdiA/ICcjZGVmaW5lIFNIRUVOX1JPVUdITkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcFV2IDogJycsCgoJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwVXYgPyAnI2RlZmluZSBTUEVDVUxBUk1BUF9VViAnICsgcGFyYW1ldGVycy5zcGVjdWxhck1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2ID8gJyNkZWZpbmUgU1BFQ1VMQVJfQ09MT1JNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiA/ICcjZGVmaW5lIFNQRUNVTEFSX0lOVEVOU0lUWU1BUF9VViAnICsgcGFyYW1ldGVycy5zcGVjdWxhckludGVuc2l0eU1hcFV2IDogJycsCgoJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcFV2ID8gJyNkZWZpbmUgVFJBTlNNSVNTSU9OTUFQX1VWICcgKyBwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgPyAnI2RlZmluZSBUSElDS05FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgOiAnJywKCgkJCS8vCgoJCQlwYXJhbWV0ZXJzLnZlcnRleFRhbmdlbnRzICYmIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPT09IGZhbHNlID8gJyNkZWZpbmUgVVNFX1RBTkdFTlQnIDogJycsCgkJCXBhcmFtZXRlcnMudmVydGV4Q29sb3JzID8gJyNkZWZpbmUgVVNFX0NPTE9SJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnZlcnRleEFscGhhcyA/ICcjZGVmaW5lIFVTRV9DT0xPUl9BTFBIQScgOiAnJywKCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjFzID8gJyNkZWZpbmUgVVNFX1VWMScgOiAnJywKCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjJzID8gJyNkZWZpbmUgVVNFX1VWMicgOiAnJywKCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjNzID8gJyNkZWZpbmUgVVNFX1VWMycgOiAnJywKCgkJCXBhcmFtZXRlcnMucG9pbnRzVXZzID8gJyNkZWZpbmUgVVNFX1BPSU5UU19VVicgOiAnJywKCgkJCXBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAnI2RlZmluZSBGTEFUX1NIQURFRCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuc2tpbm5pbmcgPyAnI2RlZmluZSBVU0VfU0tJTk5JTkcnIDogJycsCgoJCQlwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0cyA/ICcjZGVmaW5lIFVTRV9NT1JQSFRBUkdFVFMnIDogJycsCgkJCXBhcmFtZXRlcnMubW9ycGhOb3JtYWxzICYmIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPT09IGZhbHNlID8gJyNkZWZpbmUgVVNFX01PUlBITk9STUFMUycgOiAnJywKCQkJKCBwYXJhbWV0ZXJzLm1vcnBoQ29sb3JzICYmIHBhcmFtZXRlcnMuaXNXZWJHTDIgKSA/ICcjZGVmaW5lIFVTRV9NT1JQSENPTE9SUycgOiAnJywKCQkJKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ID4gMCAmJiBwYXJhbWV0ZXJzLmlzV2ViR0wyICkgPyAnI2RlZmluZSBNT1JQSFRBUkdFVFNfVEVYVFVSRScgOiAnJywKCQkJKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ID4gMCAmJiBwYXJhbWV0ZXJzLmlzV2ViR0wyICkgPyAnI2RlZmluZSBNT1JQSFRBUkdFVFNfVEVYVFVSRV9TVFJJREUgJyArIHBhcmFtZXRlcnMubW9ycGhUZXh0dXJlU3RyaWRlIDogJycsCgkJCSggcGFyYW1ldGVycy5tb3JwaFRhcmdldHNDb3VudCA+IDAgJiYgcGFyYW1ldGVycy5pc1dlYkdMMiApID8gJyNkZWZpbmUgTU9SUEhUQVJHRVRTX0NPVU5UICcgKyBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50IDogJycsCgkJCXBhcmFtZXRlcnMuZG91YmxlU2lkZWQgPyAnI2RlZmluZSBET1VCTEVfU0lERUQnIDogJycsCgkJCXBhcmFtZXRlcnMuZmxpcFNpZGVkID8gJyNkZWZpbmUgRkxJUF9TSURFRCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lIFVTRV9TSEFET1dNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lICcgKyBzaGFkb3dNYXBUeXBlRGVmaW5lIDogJycsCgoJCQlwYXJhbWV0ZXJzLnNpemVBdHRlbnVhdGlvbiA/ICcjZGVmaW5lIFVTRV9TSVpFQVRURU5VQVRJT04nIDogJycsCgoJCQlwYXJhbWV0ZXJzLm51bUxpZ2h0UHJvYmVzID4gMCA/ICcjZGVmaW5lIFVTRV9MSUdIVF9QUk9CRVMnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnVzZUxlZ2FjeUxpZ2h0cyA/ICcjZGVmaW5lIExFR0FDWV9MSUdIVFMnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPyAnI2RlZmluZSBVU0VfTE9HREVQVEhCVUYnIDogJycsCgkJCSggcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICYmIHBhcmFtZXRlcnMucmVuZGVyZXJFeHRlbnNpb25GcmFnRGVwdGggKSA/ICcjZGVmaW5lIFVTRV9MT0dERVBUSEJVRl9FWFQnIDogJycsCgoJCQkndW5pZm9ybSBtYXQ0IG1vZGVsTWF0cml4OycsCgkJCSd1bmlmb3JtIG1hdDQgbW9kZWxWaWV3TWF0cml4OycsCgkJCSd1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsnLAoJCQkndW5pZm9ybSBtYXQ0IHZpZXdNYXRyaXg7JywKCQkJJ3VuaWZvcm0gbWF0MyBub3JtYWxNYXRyaXg7JywKCQkJJ3VuaWZvcm0gdmVjMyBjYW1lcmFQb3NpdGlvbjsnLAoJCQkndW5pZm9ybSBib29sIGlzT3J0aG9ncmFwaGljOycsCgoJCQknI2lmZGVmIFVTRV9JTlNUQU5DSU5HJywKCgkJCScJYXR0cmlidXRlIG1hdDQgaW5zdGFuY2VNYXRyaXg7JywKCgkJCScjZW5kaWYnLAoKCQkJJyNpZmRlZiBVU0VfSU5TVEFOQ0lOR19DT0xPUicsCgoJCQknCWF0dHJpYnV0ZSB2ZWMzIGluc3RhbmNlQ29sb3I7JywKCgkJCScjZW5kaWYnLAoKCQkJJ2F0dHJpYnV0ZSB2ZWMzIHBvc2l0aW9uOycsCgkJCSdhdHRyaWJ1dGUgdmVjMyBub3JtYWw7JywKCQkJJ2F0dHJpYnV0ZSB2ZWMyIHV2OycsCgoJCQknI2lmZGVmIFVTRV9VVjEnLAoKCQkJJwlhdHRyaWJ1dGUgdmVjMiB1djE7JywKCgkJCScjZW5kaWYnLAoKCQkJJyNpZmRlZiBVU0VfVVYyJywKCgkJCScJYXR0cmlidXRlIHZlYzIgdXYyOycsCgoJCQknI2VuZGlmJywKCgkJCScjaWZkZWYgVVNFX1VWMycsCgoJCQknCWF0dHJpYnV0ZSB2ZWMyIHV2MzsnLAoKCQkJJyNlbmRpZicsCgoJCQknI2lmZGVmIFVTRV9UQU5HRU5UJywKCgkJCScJYXR0cmlidXRlIHZlYzQgdGFuZ2VudDsnLAoKCQkJJyNlbmRpZicsCgoJCQknI2lmIGRlZmluZWQoIFVTRV9DT0xPUl9BTFBIQSApJywKCgkJCScJYXR0cmlidXRlIHZlYzQgY29sb3I7JywKCgkJCScjZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKScsCgoJCQknCWF0dHJpYnV0ZSB2ZWMzIGNvbG9yOycsCgoJCQknI2VuZGlmJywKCgkJCScjaWYgKCBkZWZpbmVkKCBVU0VfTU9SUEhUQVJHRVRTICkgJiYgISBkZWZpbmVkKCBNT1JQSFRBUkdFVFNfVEVYVFVSRSApICknLAoKCQkJJwlhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDA7JywKCQkJJwlhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDE7JywKCQkJJwlhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDI7JywKCQkJJwlhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDM7JywKCgkJCScJI2lmZGVmIFVTRV9NT1JQSE5PUk1BTFMnLAoKCQkJJwkJYXR0cmlidXRlIHZlYzMgbW9ycGhOb3JtYWwwOycsCgkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoTm9ybWFsMTsnLAoJCQknCQlhdHRyaWJ1dGUgdmVjMyBtb3JwaE5vcm1hbDI7JywKCQkJJwkJYXR0cmlidXRlIHZlYzMgbW9ycGhOb3JtYWwzOycsCgoJCQknCSNlbHNlJywKCgkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0NDsnLAoJCQknCQlhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDU7JywKCQkJJwkJYXR0cmlidXRlIHZlYzMgbW9ycGhUYXJnZXQ2OycsCgkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0NzsnLAoKCQkJJwkjZW5kaWYnLAoKCQkJJyNlbmRpZicsCgoJCQknI2lmZGVmIFVTRV9TS0lOTklORycsCgoJCQknCWF0dHJpYnV0ZSB2ZWM0IHNraW5JbmRleDsnLAoJCQknCWF0dHJpYnV0ZSB2ZWM0IHNraW5XZWlnaHQ7JywKCgkJCScjZW5kaWYnLAoKCQkJJ1xuJwoKCQldLmZpbHRlciggZmlsdGVyRW1wdHlMaW5lICkuam9pbiggJ1xuJyApOwoKCQlwcmVmaXhGcmFnbWVudCA9IFsKCgkJCWN1c3RvbUV4dGVuc2lvbnMsCgoJCQlnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApLAoKCQkJJyNkZWZpbmUgU0hBREVSX1RZUEUgJyArIHBhcmFtZXRlcnMuc2hhZGVyVHlwZSwKCQkJJyNkZWZpbmUgU0hBREVSX05BTUUgJyArIHBhcmFtZXRlcnMuc2hhZGVyTmFtZSwKCgkJCWN1c3RvbURlZmluZXMsCgoJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZyA/ICcjZGVmaW5lIFVTRV9GT0cnIDogJycsCgkJCXBhcmFtZXRlcnMudXNlRm9nICYmIHBhcmFtZXRlcnMuZm9nRXhwMiA/ICcjZGVmaW5lIEZPR19FWFAyJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5tYXAgPyAnI2RlZmluZSBVU0VfTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLm1hdGNhcCA/ICcjZGVmaW5lIFVTRV9NQVRDQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgVVNFX0VOVk1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5lbnZNYXAgPyAnI2RlZmluZSAnICsgZW52TWFwVHlwZURlZmluZSA6ICcnLAoJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lICcgKyBlbnZNYXBNb2RlRGVmaW5lIDogJycsCgkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcEJsZW5kaW5nRGVmaW5lIDogJycsCgkJCWVudk1hcEN1YmVVVlNpemUgPyAnI2RlZmluZSBDVUJFVVZfVEVYRUxfV0lEVEggJyArIGVudk1hcEN1YmVVVlNpemUudGV4ZWxXaWR0aCA6ICcnLAoJCQllbnZNYXBDdWJlVVZTaXplID8gJyNkZWZpbmUgQ1VCRVVWX1RFWEVMX0hFSUdIVCAnICsgZW52TWFwQ3ViZVVWU2l6ZS50ZXhlbEhlaWdodCA6ICcnLAoJCQllbnZNYXBDdWJlVVZTaXplID8gJyNkZWZpbmUgQ1VCRVVWX01BWF9NSVAgJyArIGVudk1hcEN1YmVVVlNpemUubWF4TWlwICsgJy4wJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwID8gJyNkZWZpbmUgVVNFX0xJR0hUTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmFvTWFwID8gJyNkZWZpbmUgVVNFX0FPTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmJ1bXBNYXAgPyAnI2RlZmluZSBVU0VfQlVNUE1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5ub3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcE9iamVjdFNwYWNlID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUF9PQkpFQ1RTUEFDRScgOiAnJywKCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBUYW5nZW50U3BhY2UgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRScgOiAnJywKCQkJcGFyYW1ldGVycy5lbWlzc2l2ZU1hcCA/ICcjZGVmaW5lIFVTRV9FTUlTU0lWRU1BUCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuYW5pc290cm9weSA/ICcjZGVmaW5lIFVTRV9BTklTT1RST1BZJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHlNYXAgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWU1BUCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0ID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVCcgOiAnJywKCQkJcGFyYW1ldGVycy5jbGVhcmNvYXRNYXAgPyAnI2RlZmluZSBVU0VfQ0xFQVJDT0FUTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZSA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRScgOiAnJywKCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcCA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRU1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJfQ09MT1JNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJfSU5URU5TSVRZTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5yb3VnaG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfUk9VR0hORVNTTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9NRVRBTE5FU1NNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmFscGhhTWFwID8gJyNkZWZpbmUgVVNFX0FMUEhBTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmFscGhhVGVzdCA/ICcjZGVmaW5lIFVTRV9BTFBIQVRFU1QnIDogJycsCgkJCXBhcmFtZXRlcnMuYWxwaGFIYXNoID8gJyNkZWZpbmUgVVNFX0FMUEhBSEFTSCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuc2hlZW4gPyAnI2RlZmluZSBVU0VfU0hFRU4nIDogJycsCgkJCXBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9DT0xPUk1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT04nIDogJycsCgkJCXBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwID8gJyNkZWZpbmUgVVNFX1RSQU5TTUlTU0lPTk1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy50aGlja25lc3NNYXAgPyAnI2RlZmluZSBVU0VfVEhJQ0tORVNTTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyAmJiBwYXJhbWV0ZXJzLmZsYXRTaGFkaW5nID09PSBmYWxzZSA/ICcjZGVmaW5lIFVTRV9UQU5HRU5UJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnZlcnRleENvbG9ycyB8fCBwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvciA/ICcjZGVmaW5lIFVTRV9DT0xPUicgOiAnJywKCQkJcGFyYW1ldGVycy52ZXJ0ZXhBbHBoYXMgPyAnI2RlZmluZSBVU0VfQ09MT1JfQUxQSEEnIDogJycsCgkJCXBhcmFtZXRlcnMudmVydGV4VXYxcyA/ICcjZGVmaW5lIFVTRV9VVjEnIDogJycsCgkJCXBhcmFtZXRlcnMudmVydGV4VXYycyA/ICcjZGVmaW5lIFVTRV9VVjInIDogJycsCgkJCXBhcmFtZXRlcnMudmVydGV4VXYzcyA/ICcjZGVmaW5lIFVTRV9VVjMnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnBvaW50c1V2cyA/ICcjZGVmaW5lIFVTRV9QT0lOVFNfVVYnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmdyYWRpZW50TWFwID8gJyNkZWZpbmUgVVNFX0dSQURJRU5UTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5mbGF0U2hhZGluZyA/ICcjZGVmaW5lIEZMQVRfU0hBREVEJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5kb3VibGVTaWRlZCA/ICcjZGVmaW5lIERPVUJMRV9TSURFRCcgOiAnJywKCQkJcGFyYW1ldGVycy5mbGlwU2lkZWQgPyAnI2RlZmluZSBGTElQX1NJREVEJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkID8gJyNkZWZpbmUgVVNFX1NIQURPV01BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkID8gJyNkZWZpbmUgJyArIHNoYWRvd01hcFR5cGVEZWZpbmUgOiAnJywKCgkJCXBhcmFtZXRlcnMucHJlbXVsdGlwbGllZEFscGhhID8gJyNkZWZpbmUgUFJFTVVMVElQTElFRF9BTFBIQScgOiAnJywKCgkJCXBhcmFtZXRlcnMubnVtTGlnaHRQcm9iZXMgPiAwID8gJyNkZWZpbmUgVVNFX0xJR0hUX1BST0JFUycgOiAnJywKCgkJCXBhcmFtZXRlcnMudXNlTGVnYWN5TGlnaHRzID8gJyNkZWZpbmUgTEVHQUNZX0xJR0hUUycgOiAnJywKCgkJCXBhcmFtZXRlcnMuZGVjb2RlVmlkZW9UZXh0dXJlID8gJyNkZWZpbmUgREVDT0RFX1ZJREVPX1RFWFRVUkUnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPyAnI2RlZmluZSBVU0VfTE9HREVQVEhCVUYnIDogJycsCgkJCSggcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICYmIHBhcmFtZXRlcnMucmVuZGVyZXJFeHRlbnNpb25GcmFnRGVwdGggKSA/ICcjZGVmaW5lIFVTRV9MT0dERVBUSEJVRl9FWFQnIDogJycsCgoJCQkndW5pZm9ybSBtYXQ0IHZpZXdNYXRyaXg7JywKCQkJJ3VuaWZvcm0gdmVjMyBjYW1lcmFQb3NpdGlvbjsnLAoJCQkndW5pZm9ybSBib29sIGlzT3J0aG9ncmFwaGljOycsCgoJCQkoIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgIT09IE5vVG9uZU1hcHBpbmcgKSA/ICcjZGVmaW5lIFRPTkVfTUFQUElORycgOiAnJywKCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyBTaGFkZXJDaHVua1sgJ3RvbmVtYXBwaW5nX3BhcnNfZnJhZ21lbnQnIF0gOiAnJywgLy8gdGhpcyBjb2RlIGlzIHJlcXVpcmVkIGhlcmUgYmVjYXVzZSBpdCBpcyB1c2VkIGJ5IHRoZSB0b25lTWFwcGluZygpIGZ1bmN0aW9uIGRlZmluZWQgYmVsb3cKCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKCAndG9uZU1hcHBpbmcnLCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICkgOiAnJywKCgkJCXBhcmFtZXRlcnMuZGl0aGVyaW5nID8gJyNkZWZpbmUgRElUSEVSSU5HJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLm9wYXF1ZSA/ICcjZGVmaW5lIE9QQVFVRScgOiAnJywKCgkJCVNoYWRlckNodW5rWyAnY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50JyBdLCAvLyB0aGlzIGNvZGUgaXMgcmVxdWlyZWQgaGVyZSBiZWNhdXNlIGl0IGlzIHVzZWQgYnkgdGhlIHZhcmlvdXMgZW5jb2RpbmcvZGVjb2RpbmcgZnVuY3Rpb24gZGVmaW5lZCBiZWxvdwoJCQlnZXRUZXhlbEVuY29kaW5nRnVuY3Rpb24oICdsaW5lYXJUb091dHB1dFRleGVsJywgcGFyYW1ldGVycy5vdXRwdXRDb2xvclNwYWNlICksCgoJCQlwYXJhbWV0ZXJzLnVzZURlcHRoUGFja2luZyA/ICcjZGVmaW5lIERFUFRIX1BBQ0tJTkcgJyArIHBhcmFtZXRlcnMuZGVwdGhQYWNraW5nIDogJycsCgoJCQknXG4nCgoJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJfQoKCXZlcnRleFNoYWRlciA9IHJlc29sdmVJbmNsdWRlcyggdmVydGV4U2hhZGVyICk7Cgl2ZXJ0ZXhTaGFkZXIgPSByZXBsYWNlTGlnaHROdW1zKCB2ZXJ0ZXhTaGFkZXIsIHBhcmFtZXRlcnMgKTsKCXZlcnRleFNoYWRlciA9IHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggdmVydGV4U2hhZGVyLCBwYXJhbWV0ZXJzICk7CgoJZnJhZ21lbnRTaGFkZXIgPSByZXNvbHZlSW5jbHVkZXMoIGZyYWdtZW50U2hhZGVyICk7CglmcmFnbWVudFNoYWRlciA9IHJlcGxhY2VMaWdodE51bXMoIGZyYWdtZW50U2hhZGVyLCBwYXJhbWV0ZXJzICk7CglmcmFnbWVudFNoYWRlciA9IHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggZnJhZ21lbnRTaGFkZXIsIHBhcmFtZXRlcnMgKTsKCgl2ZXJ0ZXhTaGFkZXIgPSB1bnJvbGxMb29wcyggdmVydGV4U2hhZGVyICk7CglmcmFnbWVudFNoYWRlciA9IHVucm9sbExvb3BzKCBmcmFnbWVudFNoYWRlciApOwoKCWlmICggcGFyYW1ldGVycy5pc1dlYkdMMiAmJiBwYXJhbWV0ZXJzLmlzUmF3U2hhZGVyTWF0ZXJpYWwgIT09IHRydWUgKSB7CgoJCS8vIEdMU0wgMy4wIGNvbnZlcnNpb24gZm9yIGJ1aWx0LWluIG1hdGVyaWFscyBhbmQgU2hhZGVyTWF0ZXJpYWwKCgkJdmVyc2lvblN0cmluZyA9ICcjdmVyc2lvbiAzMDAgZXNcbic7CgoJCXByZWZpeFZlcnRleCA9IFsKCQkJY3VzdG9tVmVydGV4RXh0ZW5zaW9ucywKCQkJJ3ByZWNpc2lvbiBtZWRpdW1wIHNhbXBsZXIyREFycmF5OycsCgkJCScjZGVmaW5lIGF0dHJpYnV0ZSBpbicsCgkJCScjZGVmaW5lIHZhcnlpbmcgb3V0JywKCQkJJyNkZWZpbmUgdGV4dHVyZTJEIHRleHR1cmUnCgkJXS5qb2luKCAnXG4nICkgKyAnXG4nICsgcHJlZml4VmVydGV4OwoKCQlwcmVmaXhGcmFnbWVudCA9IFsKCQkJJ3ByZWNpc2lvbiBtZWRpdW1wIHNhbXBsZXIyREFycmF5OycsCgkJCScjZGVmaW5lIHZhcnlpbmcgaW4nLAoJCQkoIHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gPT09IEdMU0wzICkgPyAnJyA6ICdsYXlvdXQobG9jYXRpb24gPSAwKSBvdXQgaGlnaHAgdmVjNCBwY19mcmFnQ29sb3I7JywKCQkJKCBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID09PSBHTFNMMyApID8gJycgOiAnI2RlZmluZSBnbF9GcmFnQ29sb3IgcGNfZnJhZ0NvbG9yJywKCQkJJyNkZWZpbmUgZ2xfRnJhZ0RlcHRoRVhUIGdsX0ZyYWdEZXB0aCcsCgkJCScjZGVmaW5lIHRleHR1cmUyRCB0ZXh0dXJlJywKCQkJJyNkZWZpbmUgdGV4dHVyZUN1YmUgdGV4dHVyZScsCgkJCScjZGVmaW5lIHRleHR1cmUyRFByb2ogdGV4dHVyZVByb2onLAoJCQknI2RlZmluZSB0ZXh0dXJlMkRMb2RFWFQgdGV4dHVyZUxvZCcsCgkJCScjZGVmaW5lIHRleHR1cmUyRFByb2pMb2RFWFQgdGV4dHVyZVByb2pMb2QnLAoJCQknI2RlZmluZSB0ZXh0dXJlQ3ViZUxvZEVYVCB0ZXh0dXJlTG9kJywKCQkJJyNkZWZpbmUgdGV4dHVyZTJER3JhZEVYVCB0ZXh0dXJlR3JhZCcsCgkJCScjZGVmaW5lIHRleHR1cmUyRFByb2pHcmFkRVhUIHRleHR1cmVQcm9qR3JhZCcsCgkJCScjZGVmaW5lIHRleHR1cmVDdWJlR3JhZEVYVCB0ZXh0dXJlR3JhZCcKCQldLmpvaW4oICdcbicgKSArICdcbicgKyBwcmVmaXhGcmFnbWVudDsKCgl9CgoJY29uc3QgdmVydGV4R2xzbCA9IHZlcnNpb25TdHJpbmcgKyBwcmVmaXhWZXJ0ZXggKyB2ZXJ0ZXhTaGFkZXI7Cgljb25zdCBmcmFnbWVudEdsc2wgPSB2ZXJzaW9uU3RyaW5nICsgcHJlZml4RnJhZ21lbnQgKyBmcmFnbWVudFNoYWRlcjsKCgkvLyBjb25zb2xlLmxvZyggJypWRVJURVgqJywgdmVydGV4R2xzbCApOwoJLy8gY29uc29sZS5sb2coICcqRlJBR01FTlQqJywgZnJhZ21lbnRHbHNsICk7CgoJY29uc3QgZ2xWZXJ0ZXhTaGFkZXIgPSBXZWJHTFNoYWRlciggZ2wsIGdsLlZFUlRFWF9TSEFERVIsIHZlcnRleEdsc2wgKTsKCWNvbnN0IGdsRnJhZ21lbnRTaGFkZXIgPSBXZWJHTFNoYWRlciggZ2wsIGdsLkZSQUdNRU5UX1NIQURFUiwgZnJhZ21lbnRHbHNsICk7CgoJZ2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwoJZ2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbEZyYWdtZW50U2hhZGVyICk7CgoJLy8gRm9yY2UgYSBwYXJ0aWN1bGFyIGF0dHJpYnV0ZSB0byBpbmRleCAwLgoKCWlmICggcGFyYW1ldGVycy5pbmRleDBBdHRyaWJ1dGVOYW1lICE9PSB1bmRlZmluZWQgKSB7CgoJCWdsLmJpbmRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgMCwgcGFyYW1ldGVycy5pbmRleDBBdHRyaWJ1dGVOYW1lICk7CgoJfSBlbHNlIGlmICggcGFyYW1ldGVycy5tb3JwaFRhcmdldHMgPT09IHRydWUgKSB7CgoJCS8vIHByb2dyYW1zIHdpdGggbW9ycGhUYXJnZXRzIGRpc3BsYWNlIHBvc2l0aW9uIG91dCBvZiBhdHRyaWJ1dGUgMAoJCWdsLmJpbmRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgMCwgJ3Bvc2l0aW9uJyApOwoKCX0KCglnbC5saW5rUHJvZ3JhbSggcHJvZ3JhbSApOwoKCWZ1bmN0aW9uIG9uRmlyc3RVc2UoIHNlbGYgKSB7CgoJCS8vIGNoZWNrIGZvciBsaW5rIGVycm9ycwoJCWlmICggcmVuZGVyZXIuZGVidWcuY2hlY2tTaGFkZXJFcnJvcnMgKSB7CgoJCQljb25zdCBwcm9ncmFtTG9nID0gZ2wuZ2V0UHJvZ3JhbUluZm9Mb2coIHByb2dyYW0gKS50cmltKCk7CgkJCWNvbnN0IHZlcnRleExvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coIGdsVmVydGV4U2hhZGVyICkudHJpbSgpOwoJCQljb25zdCBmcmFnbWVudExvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coIGdsRnJhZ21lbnRTaGFkZXIgKS50cmltKCk7CgoJCQlsZXQgcnVubmFibGUgPSB0cnVlOwoJCQlsZXQgaGF2ZURpYWdub3N0aWNzID0gdHJ1ZTsKCgkJCWlmICggZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMgKSA9PT0gZmFsc2UgKSB7CgoJCQkJcnVubmFibGUgPSBmYWxzZTsKCgkJCQlpZiAoIHR5cGVvZiByZW5kZXJlci5kZWJ1Zy5vblNoYWRlckVycm9yID09PSAnZnVuY3Rpb24nICkgewoKCQkJCQlyZW5kZXJlci5kZWJ1Zy5vblNoYWRlckVycm9yKCBnbCwgcHJvZ3JhbSwgZ2xWZXJ0ZXhTaGFkZXIsIGdsRnJhZ21lbnRTaGFkZXIgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBkZWZhdWx0IGVycm9yIHJlcG9ydGluZwoKCQkJCQljb25zdCB2ZXJ0ZXhFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoIGdsLCBnbFZlcnRleFNoYWRlciwgJ3ZlcnRleCcgKTsKCQkJCQljb25zdCBmcmFnbWVudEVycm9ycyA9IGdldFNoYWRlckVycm9ycyggZ2wsIGdsRnJhZ21lbnRTaGFkZXIsICdmcmFnbWVudCcgKTsKCgkJCQkJY29uc29sZS5lcnJvcigKCQkJCQkJJ1RIUkVFLldlYkdMUHJvZ3JhbTogU2hhZGVyIEVycm9yICcgKyBnbC5nZXRFcnJvcigpICsgJyAtICcgKwoJCQkJCQknVkFMSURBVEVfU1RBVFVTICcgKyBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBnbC5WQUxJREFURV9TVEFUVVMgKSArICdcblxuJyArCgkJCQkJCSdQcm9ncmFtIEluZm8gTG9nOiAnICsgcHJvZ3JhbUxvZyArICdcbicgKwoJCQkJCQl2ZXJ0ZXhFcnJvcnMgKyAnXG4nICsKCQkJCQkJZnJhZ21lbnRFcnJvcnMKCQkJCQkpOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHByb2dyYW1Mb2cgIT09ICcnICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbTogUHJvZ3JhbSBJbmZvIExvZzonLCBwcm9ncmFtTG9nICk7CgoJCQl9IGVsc2UgaWYgKCB2ZXJ0ZXhMb2cgPT09ICcnIHx8IGZyYWdtZW50TG9nID09PSAnJyApIHsKCgkJCQloYXZlRGlhZ25vc3RpY3MgPSBmYWxzZTsKCgkJCX0KCgkJCWlmICggaGF2ZURpYWdub3N0aWNzICkgewoKCQkJCXNlbGYuZGlhZ25vc3RpY3MgPSB7CgoJCQkJCXJ1bm5hYmxlOiBydW5uYWJsZSwKCgkJCQkJcHJvZ3JhbUxvZzogcHJvZ3JhbUxvZywKCgkJCQkJdmVydGV4U2hhZGVyOiB7CgoJCQkJCQlsb2c6IHZlcnRleExvZywKCQkJCQkJcHJlZml4OiBwcmVmaXhWZXJ0ZXgKCgkJCQkJfSwKCgkJCQkJZnJhZ21lbnRTaGFkZXI6IHsKCgkJCQkJCWxvZzogZnJhZ21lbnRMb2csCgkJCQkJCXByZWZpeDogcHJlZml4RnJhZ21lbnQKCgkJCQkJfQoKCQkJCX07CgoJCQl9CgoJCX0KCgkJLy8gQ2xlYW4gdXAKCgkJLy8gQ3Jhc2hlcyBpbiBpT1M5IGFuZCBpT1MxMC4gIzE4NDAyCgkJLy8gZ2wuZGV0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwoJCS8vIGdsLmRldGFjaFNoYWRlciggcHJvZ3JhbSwgZ2xGcmFnbWVudFNoYWRlciApOwoKCQlnbC5kZWxldGVTaGFkZXIoIGdsVmVydGV4U2hhZGVyICk7CgkJZ2wuZGVsZXRlU2hhZGVyKCBnbEZyYWdtZW50U2hhZGVyICk7CgoJCWNhY2hlZFVuaWZvcm1zID0gbmV3IFdlYkdMVW5pZm9ybXMoIGdsLCBwcm9ncmFtICk7CgkJY2FjaGVkQXR0cmlidXRlcyA9IGZldGNoQXR0cmlidXRlTG9jYXRpb25zKCBnbCwgcHJvZ3JhbSApOwoKCX0KCgkvLyBzZXQgdXAgY2FjaGluZyBmb3IgdW5pZm9ybSBsb2NhdGlvbnMKCglsZXQgY2FjaGVkVW5pZm9ybXM7CgoJdGhpcy5nZXRVbmlmb3JtcyA9IGZ1bmN0aW9uICgpIHsKCgkJaWYgKCBjYWNoZWRVbmlmb3JtcyA9PT0gdW5kZWZpbmVkICkgewoKCQkJLy8gUG9wdWxhdGVzIGNhY2hlZFVuaWZvcm1zIGFuZCBjYWNoZWRBdHRyaWJ1dGVzCgkJCW9uRmlyc3RVc2UoIHRoaXMgKTsKCgkJfQoKCQlyZXR1cm4gY2FjaGVkVW5pZm9ybXM7CgoJfTsKCgkvLyBzZXQgdXAgY2FjaGluZyBmb3IgYXR0cmlidXRlIGxvY2F0aW9ucwoKCWxldCBjYWNoZWRBdHRyaWJ1dGVzOwoKCXRoaXMuZ2V0QXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHsKCgkJaWYgKCBjYWNoZWRBdHRyaWJ1dGVzID09PSB1bmRlZmluZWQgKSB7CgoJCQkvLyBQb3B1bGF0ZXMgY2FjaGVkQXR0cmlidXRlcyBhbmQgY2FjaGVkVW5pZm9ybXMKCQkJb25GaXJzdFVzZSggdGhpcyApOwoKCQl9CgoJCXJldHVybiBjYWNoZWRBdHRyaWJ1dGVzOwoKCX07CgoJLy8gaW5kaWNhdGUgd2hlbiB0aGUgcHJvZ3JhbSBpcyByZWFkeSB0byBiZSB1c2VkLiBpZiB0aGUgS0hSX3BhcmFsbGVsX3NoYWRlcl9jb21waWxlIGV4dGVuc2lvbiBpc24ndCBzdXBwb3J0ZWQsCgkvLyBmbGFnIHRoZSBwcm9ncmFtIGFzIHJlYWR5IGltbWVkaWF0ZWx5LiBJdCBtYXkgY2F1c2UgYSBzdGFsbCB3aGVuIGl0J3MgZmlyc3QgdXNlZC4KCglsZXQgcHJvZ3JhbVJlYWR5ID0gKCBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uUGFyYWxsZWxTaGFkZXJDb21waWxlID09PSBmYWxzZSApOwoKCXRoaXMuaXNSZWFkeSA9IGZ1bmN0aW9uICgpIHsKCgkJaWYgKCBwcm9ncmFtUmVhZHkgPT09IGZhbHNlICkgewoKCQkJcHJvZ3JhbVJlYWR5ID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgQ09NUExFVElPTl9TVEFUVVNfS0hSICk7CgoJCX0KCgkJcmV0dXJuIHByb2dyYW1SZWFkeTsKCgl9OwoKCS8vIGZyZWUgcmVzb3VyY2UKCgl0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CgoJCWJpbmRpbmdTdGF0ZXMucmVsZWFzZVN0YXRlc09mUHJvZ3JhbSggdGhpcyApOwoKCQlnbC5kZWxldGVQcm9ncmFtKCBwcm9ncmFtICk7CgkJdGhpcy5wcm9ncmFtID0gdW5kZWZpbmVkOwoKCX07CgoJLy8KCgl0aGlzLnR5cGUgPSBwYXJhbWV0ZXJzLnNoYWRlclR5cGU7Cgl0aGlzLm5hbWUgPSBwYXJhbWV0ZXJzLnNoYWRlck5hbWU7Cgl0aGlzLmlkID0gcHJvZ3JhbUlkQ291bnQgKys7Cgl0aGlzLmNhY2hlS2V5ID0gY2FjaGVLZXk7Cgl0aGlzLnVzZWRUaW1lcyA9IDE7Cgl0aGlzLnByb2dyYW0gPSBwcm9ncmFtOwoJdGhpcy52ZXJ0ZXhTaGFkZXIgPSBnbFZlcnRleFNoYWRlcjsKCXRoaXMuZnJhZ21lbnRTaGFkZXIgPSBnbEZyYWdtZW50U2hhZGVyOwoKCXJldHVybiB0aGlzOwoKfQoKbGV0IF9pZCQxID0gMDsKCmNsYXNzIFdlYkdMU2hhZGVyQ2FjaGUgewoKCWNvbnN0cnVjdG9yKCkgewoKCQl0aGlzLnNoYWRlckNhY2hlID0gbmV3IE1hcCgpOwoJCXRoaXMubWF0ZXJpYWxDYWNoZSA9IG5ldyBNYXAoKTsKCgl9CgoJdXBkYXRlKCBtYXRlcmlhbCApIHsKCgkJY29uc3QgdmVydGV4U2hhZGVyID0gbWF0ZXJpYWwudmVydGV4U2hhZGVyOwoJCWNvbnN0IGZyYWdtZW50U2hhZGVyID0gbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXI7CgoJCWNvbnN0IHZlcnRleFNoYWRlclN0YWdlID0gdGhpcy5fZ2V0U2hhZGVyU3RhZ2UoIHZlcnRleFNoYWRlciApOwoJCWNvbnN0IGZyYWdtZW50U2hhZGVyU3RhZ2UgPSB0aGlzLl9nZXRTaGFkZXJTdGFnZSggZnJhZ21lbnRTaGFkZXIgKTsKCgkJY29uc3QgbWF0ZXJpYWxTaGFkZXJzID0gdGhpcy5fZ2V0U2hhZGVyQ2FjaGVGb3JNYXRlcmlhbCggbWF0ZXJpYWwgKTsKCgkJaWYgKCBtYXRlcmlhbFNoYWRlcnMuaGFzKCB2ZXJ0ZXhTaGFkZXJTdGFnZSApID09PSBmYWxzZSApIHsKCgkJCW1hdGVyaWFsU2hhZGVycy5hZGQoIHZlcnRleFNoYWRlclN0YWdlICk7CgkJCXZlcnRleFNoYWRlclN0YWdlLnVzZWRUaW1lcyArKzsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsU2hhZGVycy5oYXMoIGZyYWdtZW50U2hhZGVyU3RhZ2UgKSA9PT0gZmFsc2UgKSB7CgoJCQltYXRlcmlhbFNoYWRlcnMuYWRkKCBmcmFnbWVudFNoYWRlclN0YWdlICk7CgkJCWZyYWdtZW50U2hhZGVyU3RhZ2UudXNlZFRpbWVzICsrOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglyZW1vdmUoIG1hdGVyaWFsICkgewoKCQljb25zdCBtYXRlcmlhbFNoYWRlcnMgPSB0aGlzLm1hdGVyaWFsQ2FjaGUuZ2V0KCBtYXRlcmlhbCApOwoKCQlmb3IgKCBjb25zdCBzaGFkZXJTdGFnZSBvZiBtYXRlcmlhbFNoYWRlcnMgKSB7CgoJCQlzaGFkZXJTdGFnZS51c2VkVGltZXMgLS07CgoJCQlpZiAoIHNoYWRlclN0YWdlLnVzZWRUaW1lcyA9PT0gMCApIHRoaXMuc2hhZGVyQ2FjaGUuZGVsZXRlKCBzaGFkZXJTdGFnZS5jb2RlICk7CgoJCX0KCgkJdGhpcy5tYXRlcmlhbENhY2hlLmRlbGV0ZSggbWF0ZXJpYWwgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldFZlcnRleFNoYWRlcklEKCBtYXRlcmlhbCApIHsKCgkJcmV0dXJuIHRoaXMuX2dldFNoYWRlclN0YWdlKCBtYXRlcmlhbC52ZXJ0ZXhTaGFkZXIgKS5pZDsKCgl9CgoJZ2V0RnJhZ21lbnRTaGFkZXJJRCggbWF0ZXJpYWwgKSB7CgoJCXJldHVybiB0aGlzLl9nZXRTaGFkZXJTdGFnZSggbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXIgKS5pZDsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5zaGFkZXJDYWNoZS5jbGVhcigpOwoJCXRoaXMubWF0ZXJpYWxDYWNoZS5jbGVhcigpOwoKCX0KCglfZ2V0U2hhZGVyQ2FjaGVGb3JNYXRlcmlhbCggbWF0ZXJpYWwgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5tYXRlcmlhbENhY2hlOwoJCWxldCBzZXQgPSBjYWNoZS5nZXQoIG1hdGVyaWFsICk7CgoJCWlmICggc2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQlzZXQgPSBuZXcgU2V0KCk7CgkJCWNhY2hlLnNldCggbWF0ZXJpYWwsIHNldCApOwoKCQl9CgoJCXJldHVybiBzZXQ7CgoJfQoKCV9nZXRTaGFkZXJTdGFnZSggY29kZSApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLnNoYWRlckNhY2hlOwoJCWxldCBzdGFnZSA9IGNhY2hlLmdldCggY29kZSApOwoKCQlpZiAoIHN0YWdlID09PSB1bmRlZmluZWQgKSB7CgoJCQlzdGFnZSA9IG5ldyBXZWJHTFNoYWRlclN0YWdlKCBjb2RlICk7CgkJCWNhY2hlLnNldCggY29kZSwgc3RhZ2UgKTsKCgkJfQoKCQlyZXR1cm4gc3RhZ2U7CgoJfQoKfQoKY2xhc3MgV2ViR0xTaGFkZXJTdGFnZSB7CgoJY29uc3RydWN0b3IoIGNvZGUgKSB7CgoJCXRoaXMuaWQgPSBfaWQkMSArKzsKCgkJdGhpcy5jb2RlID0gY29kZTsKCQl0aGlzLnVzZWRUaW1lcyA9IDA7CgoJfQoKfQoKZnVuY3Rpb24gV2ViR0xQcm9ncmFtcyggcmVuZGVyZXIsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMsIGJpbmRpbmdTdGF0ZXMsIGNsaXBwaW5nICkgewoKCWNvbnN0IF9wcm9ncmFtTGF5ZXJzID0gbmV3IExheWVycygpOwoJY29uc3QgX2N1c3RvbVNoYWRlcnMgPSBuZXcgV2ViR0xTaGFkZXJDYWNoZSgpOwoJY29uc3QgcHJvZ3JhbXMgPSBbXTsKCgljb25zdCBJU19XRUJHTDIgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDI7Cgljb25zdCBsb2dhcml0aG1pY0RlcHRoQnVmZmVyID0gY2FwYWJpbGl0aWVzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXI7Cgljb25zdCBTVVBQT1JUU19WRVJURVhfVEVYVFVSRVMgPSBjYXBhYmlsaXRpZXMudmVydGV4VGV4dHVyZXM7CgoJbGV0IHByZWNpc2lvbiA9IGNhcGFiaWxpdGllcy5wcmVjaXNpb247CgoJY29uc3Qgc2hhZGVySURzID0gewoJCU1lc2hEZXB0aE1hdGVyaWFsOiAnZGVwdGgnLAoJCU1lc2hEaXN0YW5jZU1hdGVyaWFsOiAnZGlzdGFuY2VSR0JBJywKCQlNZXNoTm9ybWFsTWF0ZXJpYWw6ICdub3JtYWwnLAoJCU1lc2hCYXNpY01hdGVyaWFsOiAnYmFzaWMnLAoJCU1lc2hMYW1iZXJ0TWF0ZXJpYWw6ICdsYW1iZXJ0JywKCQlNZXNoUGhvbmdNYXRlcmlhbDogJ3Bob25nJywKCQlNZXNoVG9vbk1hdGVyaWFsOiAndG9vbicsCgkJTWVzaFN0YW5kYXJkTWF0ZXJpYWw6ICdwaHlzaWNhbCcsCgkJTWVzaFBoeXNpY2FsTWF0ZXJpYWw6ICdwaHlzaWNhbCcsCgkJTWVzaE1hdGNhcE1hdGVyaWFsOiAnbWF0Y2FwJywKCQlMaW5lQmFzaWNNYXRlcmlhbDogJ2Jhc2ljJywKCQlMaW5lRGFzaGVkTWF0ZXJpYWw6ICdkYXNoZWQnLAoJCVBvaW50c01hdGVyaWFsOiAncG9pbnRzJywKCQlTaGFkb3dNYXRlcmlhbDogJ3NoYWRvdycsCgkJU3ByaXRlTWF0ZXJpYWw6ICdzcHJpdGUnCgl9OwoKCWZ1bmN0aW9uIGdldENoYW5uZWwoIHZhbHVlICkgewoKCQlpZiAoIHZhbHVlID09PSAwICkgcmV0dXJuICd1dic7CgoJCXJldHVybiBgdXYkeyB2YWx1ZSB9YDsKCgl9CgoJZnVuY3Rpb24gZ2V0UGFyYW1ldGVycyggbWF0ZXJpYWwsIGxpZ2h0cywgc2hhZG93cywgc2NlbmUsIG9iamVjdCApIHsKCgkJY29uc3QgZm9nID0gc2NlbmUuZm9nOwoJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwoJCWNvbnN0IGVudmlyb25tZW50ID0gbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IHNjZW5lLmVudmlyb25tZW50IDogbnVsbDsKCgkJY29uc3QgZW52TWFwID0gKCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gY3ViZXV2bWFwcyA6IGN1YmVtYXBzICkuZ2V0KCBtYXRlcmlhbC5lbnZNYXAgfHwgZW52aXJvbm1lbnQgKTsKCQljb25zdCBlbnZNYXBDdWJlVVZIZWlnaHQgPSAoICEhIGVudk1hcCApICYmICggZW52TWFwLm1hcHBpbmcgPT09IEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nICkgPyBlbnZNYXAuaW1hZ2UuaGVpZ2h0IDogbnVsbDsKCgkJY29uc3Qgc2hhZGVySUQgPSBzaGFkZXJJRHNbIG1hdGVyaWFsLnR5cGUgXTsKCgkJLy8gaGV1cmlzdGljcyB0byBjcmVhdGUgc2hhZGVyIHBhcmFtZXRlcnMgYWNjb3JkaW5nIHRvIGxpZ2h0cyBpbiB0aGUgc2NlbmUKCQkvLyAobm90IHRvIGJsb3cgb3ZlciBtYXhMaWdodHMgYnVkZ2V0KQoKCQlpZiAoIG1hdGVyaWFsLnByZWNpc2lvbiAhPT0gbnVsbCApIHsKCgkJCXByZWNpc2lvbiA9IGNhcGFiaWxpdGllcy5nZXRNYXhQcmVjaXNpb24oIG1hdGVyaWFsLnByZWNpc2lvbiApOwoKCQkJaWYgKCBwcmVjaXNpb24gIT09IG1hdGVyaWFsLnByZWNpc2lvbiApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW0uZ2V0UGFyYW1ldGVyczonLCBtYXRlcmlhbC5wcmVjaXNpb24sICdub3Qgc3VwcG9ydGVkLCB1c2luZycsIHByZWNpc2lvbiwgJ2luc3RlYWQuJyApOwoKCQkJfQoKCQl9CgoJCS8vCgoJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoJCWNvbnN0IG1vcnBoVGFyZ2V0c0NvdW50ID0gKCBtb3JwaEF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgPyBtb3JwaEF0dHJpYnV0ZS5sZW5ndGggOiAwOwoKCQlsZXQgbW9ycGhUZXh0dXJlU3RyaWRlID0gMDsKCgkJaWYgKCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gIT09IHVuZGVmaW5lZCApIG1vcnBoVGV4dHVyZVN0cmlkZSA9IDE7CgkJaWYgKCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsICE9PSB1bmRlZmluZWQgKSBtb3JwaFRleHR1cmVTdHJpZGUgPSAyOwoJCWlmICggZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yICE9PSB1bmRlZmluZWQgKSBtb3JwaFRleHR1cmVTdHJpZGUgPSAzOwoKCQkvLwoKCQlsZXQgdmVydGV4U2hhZGVyLCBmcmFnbWVudFNoYWRlcjsKCQlsZXQgY3VzdG9tVmVydGV4U2hhZGVySUQsIGN1c3RvbUZyYWdtZW50U2hhZGVySUQ7CgoJCWlmICggc2hhZGVySUQgKSB7CgoJCQljb25zdCBzaGFkZXIgPSBTaGFkZXJMaWJbIHNoYWRlcklEIF07CgoJCQl2ZXJ0ZXhTaGFkZXIgPSBzaGFkZXIudmVydGV4U2hhZGVyOwoJCQlmcmFnbWVudFNoYWRlciA9IHNoYWRlci5mcmFnbWVudFNoYWRlcjsKCgkJfSBlbHNlIHsKCgkJCXZlcnRleFNoYWRlciA9IG1hdGVyaWFsLnZlcnRleFNoYWRlcjsKCQkJZnJhZ21lbnRTaGFkZXIgPSBtYXRlcmlhbC5mcmFnbWVudFNoYWRlcjsKCgkJCV9jdXN0b21TaGFkZXJzLnVwZGF0ZSggbWF0ZXJpYWwgKTsKCgkJCWN1c3RvbVZlcnRleFNoYWRlcklEID0gX2N1c3RvbVNoYWRlcnMuZ2V0VmVydGV4U2hhZGVySUQoIG1hdGVyaWFsICk7CgkJCWN1c3RvbUZyYWdtZW50U2hhZGVySUQgPSBfY3VzdG9tU2hhZGVycy5nZXRGcmFnbWVudFNoYWRlcklEKCBtYXRlcmlhbCApOwoKCQl9CgoJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCgkJY29uc3QgSVNfSU5TVEFOQ0VETUVTSCA9IG9iamVjdC5pc0luc3RhbmNlZE1lc2ggPT09IHRydWU7CgkJY29uc3QgSVNfQkFUQ0hFRE1FU0ggPSBvYmplY3QuaXNCYXRjaGVkTWVzaCA9PT0gdHJ1ZTsKCgkJY29uc3QgSEFTX01BUCA9ICEhIG1hdGVyaWFsLm1hcDsKCQljb25zdCBIQVNfTUFUQ0FQID0gISEgbWF0ZXJpYWwubWF0Y2FwOwoJCWNvbnN0IEhBU19FTlZNQVAgPSAhISBlbnZNYXA7CgkJY29uc3QgSEFTX0FPTUFQID0gISEgbWF0ZXJpYWwuYW9NYXA7CgkJY29uc3QgSEFTX0xJR0hUTUFQID0gISEgbWF0ZXJpYWwubGlnaHRNYXA7CgkJY29uc3QgSEFTX0JVTVBNQVAgPSAhISBtYXRlcmlhbC5idW1wTWFwOwoJCWNvbnN0IEhBU19OT1JNQUxNQVAgPSAhISBtYXRlcmlhbC5ub3JtYWxNYXA7CgkJY29uc3QgSEFTX0RJU1BMQUNFTUVOVE1BUCA9ICEhIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCQljb25zdCBIQVNfRU1JU1NJVkVNQVAgPSAhISBtYXRlcmlhbC5lbWlzc2l2ZU1hcDsKCgkJY29uc3QgSEFTX01FVEFMTkVTU01BUCA9ICEhIG1hdGVyaWFsLm1ldGFsbmVzc01hcDsKCQljb25zdCBIQVNfUk9VR0hORVNTTUFQID0gISEgbWF0ZXJpYWwucm91Z2huZXNzTWFwOwoKCQljb25zdCBIQVNfQU5JU09UUk9QWSA9IG1hdGVyaWFsLmFuaXNvdHJvcHkgPiAwOwoJCWNvbnN0IEhBU19DTEVBUkNPQVQgPSBtYXRlcmlhbC5jbGVhcmNvYXQgPiAwOwoJCWNvbnN0IEhBU19JUklERVNDRU5DRSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlID4gMDsKCQljb25zdCBIQVNfU0hFRU4gPSBtYXRlcmlhbC5zaGVlbiA+IDA7CgkJY29uc3QgSEFTX1RSQU5TTUlTU0lPTiA9IG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA+IDA7CgoJCWNvbnN0IEhBU19BTklTT1RST1BZTUFQID0gSEFTX0FOSVNPVFJPUFkgJiYgISEgbWF0ZXJpYWwuYW5pc290cm9weU1hcDsKCgkJY29uc3QgSEFTX0NMRUFSQ09BVE1BUCA9IEhBU19DTEVBUkNPQVQgJiYgISEgbWF0ZXJpYWwuY2xlYXJjb2F0TWFwOwoJCWNvbnN0IEhBU19DTEVBUkNPQVRfTk9STUFMTUFQID0gSEFTX0NMRUFSQ09BVCAmJiAhISBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXA7CgkJY29uc3QgSEFTX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcDsKCgkJY29uc3QgSEFTX0lSSURFU0NFTkNFTUFQID0gSEFTX0lSSURFU0NFTkNFICYmICEhIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwOwoJCWNvbnN0IEhBU19JUklERVNDRU5DRV9USElDS05FU1NNQVAgPSBIQVNfSVJJREVTQ0VOQ0UgJiYgISEgbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXA7CgoJCWNvbnN0IEhBU19TSEVFTl9DT0xPUk1BUCA9IEhBU19TSEVFTiAmJiAhISBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwOwoJCWNvbnN0IEhBU19TSEVFTl9ST1VHSE5FU1NNQVAgPSBIQVNfU0hFRU4gJiYgISEgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXA7CgoJCWNvbnN0IEhBU19TUEVDVUxBUk1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFyTWFwOwoJCWNvbnN0IEhBU19TUEVDVUxBUl9DT0xPUk1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXA7CgkJY29uc3QgSEFTX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwOwoKCQljb25zdCBIQVNfVFJBTlNNSVNTSU9OTUFQID0gSEFTX1RSQU5TTUlTU0lPTiAmJiAhISBtYXRlcmlhbC50cmFuc21pc3Npb25NYXA7CgkJY29uc3QgSEFTX1RISUNLTkVTU01BUCA9IEhBU19UUkFOU01JU1NJT04gJiYgISEgbWF0ZXJpYWwudGhpY2tuZXNzTWFwOwoKCQljb25zdCBIQVNfR1JBRElFTlRNQVAgPSAhISBtYXRlcmlhbC5ncmFkaWVudE1hcDsKCgkJY29uc3QgSEFTX0FMUEhBTUFQID0gISEgbWF0ZXJpYWwuYWxwaGFNYXA7CgoJCWNvbnN0IEhBU19BTFBIQVRFU1QgPSBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwOwoKCQljb25zdCBIQVNfQUxQSEFIQVNIID0gISEgbWF0ZXJpYWwuYWxwaGFIYXNoOwoKCQljb25zdCBIQVNfRVhURU5TSU9OUyA9ICEhIG1hdGVyaWFsLmV4dGVuc2lvbnM7CgoJCWNvbnN0IEhBU19BVFRSSUJVVEVfVVYxID0gISEgZ2VvbWV0cnkuYXR0cmlidXRlcy51djE7CgkJY29uc3QgSEFTX0FUVFJJQlVURV9VVjIgPSAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2MjsKCQljb25zdCBIQVNfQVRUUklCVVRFX1VWMyA9ICEhIGdlb21ldHJ5LmF0dHJpYnV0ZXMudXYzOwoKCQlsZXQgdG9uZU1hcHBpbmcgPSBOb1RvbmVNYXBwaW5nOwoKCQlpZiAoIG1hdGVyaWFsLnRvbmVNYXBwZWQgKSB7CgoJCQlpZiAoIGN1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgfHwgY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlICkgewoKCQkJCXRvbmVNYXBwaW5nID0gcmVuZGVyZXIudG9uZU1hcHBpbmc7CgoJCQl9CgoJCX0KCgkJY29uc3QgcGFyYW1ldGVycyA9IHsKCgkJCWlzV2ViR0wyOiBJU19XRUJHTDIsCgoJCQlzaGFkZXJJRDogc2hhZGVySUQsCgkJCXNoYWRlclR5cGU6IG1hdGVyaWFsLnR5cGUsCgkJCXNoYWRlck5hbWU6IG1hdGVyaWFsLm5hbWUsCgoJCQl2ZXJ0ZXhTaGFkZXI6IHZlcnRleFNoYWRlciwKCQkJZnJhZ21lbnRTaGFkZXI6IGZyYWdtZW50U2hhZGVyLAoJCQlkZWZpbmVzOiBtYXRlcmlhbC5kZWZpbmVzLAoKCQkJY3VzdG9tVmVydGV4U2hhZGVySUQ6IGN1c3RvbVZlcnRleFNoYWRlcklELAoJCQljdXN0b21GcmFnbWVudFNoYWRlcklEOiBjdXN0b21GcmFnbWVudFNoYWRlcklELAoKCQkJaXNSYXdTaGFkZXJNYXRlcmlhbDogbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCA9PT0gdHJ1ZSwKCQkJZ2xzbFZlcnNpb246IG1hdGVyaWFsLmdsc2xWZXJzaW9uLAoKCQkJcHJlY2lzaW9uOiBwcmVjaXNpb24sCgoJCQliYXRjaGluZzogSVNfQkFUQ0hFRE1FU0gsCgkJCWluc3RhbmNpbmc6IElTX0lOU1RBTkNFRE1FU0gsCgkJCWluc3RhbmNpbmdDb2xvcjogSVNfSU5TVEFOQ0VETUVTSCAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCwKCgkJCXN1cHBvcnRzVmVydGV4VGV4dHVyZXM6IFNVUFBPUlRTX1ZFUlRFWF9URVhUVVJFUywKCQkJb3V0cHV0Q29sb3JTcGFjZTogKCBjdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsICkgPyByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlIDogKCBjdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgPyBjdXJyZW50UmVuZGVyVGFyZ2V0LnRleHR1cmUuY29sb3JTcGFjZSA6IExpbmVhclNSR0JDb2xvclNwYWNlICksCgoJCQltYXA6IEhBU19NQVAsCgkJCW1hdGNhcDogSEFTX01BVENBUCwKCQkJZW52TWFwOiBIQVNfRU5WTUFQLAoJCQllbnZNYXBNb2RlOiBIQVNfRU5WTUFQICYmIGVudk1hcC5tYXBwaW5nLAoJCQllbnZNYXBDdWJlVVZIZWlnaHQ6IGVudk1hcEN1YmVVVkhlaWdodCwKCQkJYW9NYXA6IEhBU19BT01BUCwKCQkJbGlnaHRNYXA6IEhBU19MSUdIVE1BUCwKCQkJYnVtcE1hcDogSEFTX0JVTVBNQVAsCgkJCW5vcm1hbE1hcDogSEFTX05PUk1BTE1BUCwKCQkJZGlzcGxhY2VtZW50TWFwOiBTVVBQT1JUU19WRVJURVhfVEVYVFVSRVMgJiYgSEFTX0RJU1BMQUNFTUVOVE1BUCwKCQkJZW1pc3NpdmVNYXA6IEhBU19FTUlTU0lWRU1BUCwKCgkJCW5vcm1hbE1hcE9iamVjdFNwYWNlOiBIQVNfTk9STUFMTUFQICYmIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IE9iamVjdFNwYWNlTm9ybWFsTWFwLAoJCQlub3JtYWxNYXBUYW5nZW50U3BhY2U6IEhBU19OT1JNQUxNQVAgJiYgbWF0ZXJpYWwubm9ybWFsTWFwVHlwZSA9PT0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwLAoKCQkJbWV0YWxuZXNzTWFwOiBIQVNfTUVUQUxORVNTTUFQLAoJCQlyb3VnaG5lc3NNYXA6IEhBU19ST1VHSE5FU1NNQVAsCgoJCQlhbmlzb3Ryb3B5OiBIQVNfQU5JU09UUk9QWSwKCQkJYW5pc290cm9weU1hcDogSEFTX0FOSVNPVFJPUFlNQVAsCgoJCQljbGVhcmNvYXQ6IEhBU19DTEVBUkNPQVQsCgkJCWNsZWFyY29hdE1hcDogSEFTX0NMRUFSQ09BVE1BUCwKCQkJY2xlYXJjb2F0Tm9ybWFsTWFwOiBIQVNfQ0xFQVJDT0FUX05PUk1BTE1BUCwKCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwOiBIQVNfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCwKCgkJCWlyaWRlc2NlbmNlOiBIQVNfSVJJREVTQ0VOQ0UsCgkJCWlyaWRlc2NlbmNlTWFwOiBIQVNfSVJJREVTQ0VOQ0VNQVAsCgkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOiBIQVNfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQLAoKCQkJc2hlZW46IEhBU19TSEVFTiwKCQkJc2hlZW5Db2xvck1hcDogSEFTX1NIRUVOX0NPTE9STUFQLAoJCQlzaGVlblJvdWdobmVzc01hcDogSEFTX1NIRUVOX1JPVUdITkVTU01BUCwKCgkJCXNwZWN1bGFyTWFwOiBIQVNfU1BFQ1VMQVJNQVAsCgkJCXNwZWN1bGFyQ29sb3JNYXA6IEhBU19TUEVDVUxBUl9DT0xPUk1BUCwKCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXA6IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAsCgoJCQl0cmFuc21pc3Npb246IEhBU19UUkFOU01JU1NJT04sCgkJCXRyYW5zbWlzc2lvbk1hcDogSEFTX1RSQU5TTUlTU0lPTk1BUCwKCQkJdGhpY2tuZXNzTWFwOiBIQVNfVEhJQ0tORVNTTUFQLAoKCQkJZ3JhZGllbnRNYXA6IEhBU19HUkFESUVOVE1BUCwKCgkJCW9wYXF1ZTogbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IGZhbHNlICYmIG1hdGVyaWFsLmJsZW5kaW5nID09PSBOb3JtYWxCbGVuZGluZywKCgkJCWFscGhhTWFwOiBIQVNfQUxQSEFNQVAsCgkJCWFscGhhVGVzdDogSEFTX0FMUEhBVEVTVCwKCQkJYWxwaGFIYXNoOiBIQVNfQUxQSEFIQVNILAoKCQkJY29tYmluZTogbWF0ZXJpYWwuY29tYmluZSwKCgkJCS8vCgoJCQltYXBVdjogSEFTX01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5tYXAuY2hhbm5lbCApLAoJCQlhb01hcFV2OiBIQVNfQU9NQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuYW9NYXAuY2hhbm5lbCApLAoJCQlsaWdodE1hcFV2OiBIQVNfTElHSFRNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubGlnaHRNYXAuY2hhbm5lbCApLAoJCQlidW1wTWFwVXY6IEhBU19CVU1QTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmJ1bXBNYXAuY2hhbm5lbCApLAoJCQlub3JtYWxNYXBVdjogSEFTX05PUk1BTE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5ub3JtYWxNYXAuY2hhbm5lbCApLAoJCQlkaXNwbGFjZW1lbnRNYXBVdjogSEFTX0RJU1BMQUNFTUVOVE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAuY2hhbm5lbCApLAoJCQllbWlzc2l2ZU1hcFV2OiBIQVNfRU1JU1NJVkVNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuZW1pc3NpdmVNYXAuY2hhbm5lbCApLAoKCQkJbWV0YWxuZXNzTWFwVXY6IEhBU19NRVRBTE5FU1NNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubWV0YWxuZXNzTWFwLmNoYW5uZWwgKSwKCQkJcm91Z2huZXNzTWFwVXY6IEhBU19ST1VHSE5FU1NNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwucm91Z2huZXNzTWFwLmNoYW5uZWwgKSwKCgkJCWFuaXNvdHJvcHlNYXBVdjogSEFTX0FOSVNPVFJPUFlNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuYW5pc290cm9weU1hcC5jaGFubmVsICksCgoJCQljbGVhcmNvYXRNYXBVdjogSEFTX0NMRUFSQ09BVE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5jbGVhcmNvYXRNYXAuY2hhbm5lbCApLAoJCQljbGVhcmNvYXROb3JtYWxNYXBVdjogSEFTX0NMRUFSQ09BVF9OT1JNQUxNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwLmNoYW5uZWwgKSwKCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwVXY6IEhBU19DTEVBUkNPQVRfUk9VR0hORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcC5jaGFubmVsICksCgoJCQlpcmlkZXNjZW5jZU1hcFV2OiBIQVNfSVJJREVTQ0VOQ0VNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuaXJpZGVzY2VuY2VNYXAuY2hhbm5lbCApLAoJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2OiBIQVNfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLmNoYW5uZWwgKSwKCgkJCXNoZWVuQ29sb3JNYXBVdjogSEFTX1NIRUVOX0NPTE9STUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnNoZWVuQ29sb3JNYXAuY2hhbm5lbCApLAoJCQlzaGVlblJvdWdobmVzc01hcFV2OiBIQVNfU0hFRU5fUk9VR0hORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwLmNoYW5uZWwgKSwKCgkJCXNwZWN1bGFyTWFwVXY6IEhBU19TUEVDVUxBUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhck1hcC5jaGFubmVsICksCgkJCXNwZWN1bGFyQ29sb3JNYXBVdjogSEFTX1NQRUNVTEFSX0NPTE9STUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXAuY2hhbm5lbCApLAoJCQlzcGVjdWxhckludGVuc2l0eU1hcFV2OiBIQVNfU1BFQ1VMQVJfSU5URU5TSVRZTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwLmNoYW5uZWwgKSwKCgkJCXRyYW5zbWlzc2lvbk1hcFV2OiBIQVNfVFJBTlNNSVNTSU9OTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcC5jaGFubmVsICksCgkJCXRoaWNrbmVzc01hcFV2OiBIQVNfVEhJQ0tORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnRoaWNrbmVzc01hcC5jaGFubmVsICksCgoJCQlhbHBoYU1hcFV2OiBIQVNfQUxQSEFNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuYWxwaGFNYXAuY2hhbm5lbCApLAoKCQkJLy8KCgkJCXZlcnRleFRhbmdlbnRzOiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLnRhbmdlbnQgJiYgKCBIQVNfTk9STUFMTUFQIHx8IEhBU19BTklTT1RST1BZICksCgkJCXZlcnRleENvbG9yczogbWF0ZXJpYWwudmVydGV4Q29sb3JzLAoJCQl2ZXJ0ZXhBbHBoYXM6IG1hdGVyaWFsLnZlcnRleENvbG9ycyA9PT0gdHJ1ZSAmJiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICYmIGdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IuaXRlbVNpemUgPT09IDQsCgkJCXZlcnRleFV2MXM6IEhBU19BVFRSSUJVVEVfVVYxLAoJCQl2ZXJ0ZXhVdjJzOiBIQVNfQVRUUklCVVRFX1VWMiwKCQkJdmVydGV4VXYzczogSEFTX0FUVFJJQlVURV9VVjMsCgoJCQlwb2ludHNVdnM6IG9iamVjdC5pc1BvaW50cyA9PT0gdHJ1ZSAmJiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2ICYmICggSEFTX01BUCB8fCBIQVNfQUxQSEFNQVAgKSwKCgkJCWZvZzogISEgZm9nLAoJCQl1c2VGb2c6IG1hdGVyaWFsLmZvZyA9PT0gdHJ1ZSwKCQkJZm9nRXhwMjogKCBmb2cgJiYgZm9nLmlzRm9nRXhwMiApLAoKCQkJZmxhdFNoYWRpbmc6IG1hdGVyaWFsLmZsYXRTaGFkaW5nID09PSB0cnVlLAoKCQkJc2l6ZUF0dGVudWF0aW9uOiBtYXRlcmlhbC5zaXplQXR0ZW51YXRpb24gPT09IHRydWUsCgkJCWxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIsCgoJCQlza2lubmluZzogb2JqZWN0LmlzU2tpbm5lZE1lc2ggPT09IHRydWUsCgoJCQltb3JwaFRhcmdldHM6IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkLAoJCQltb3JwaE5vcm1hbHM6IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCwKCQkJbW9ycGhDb2xvcnM6IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciAhPT0gdW5kZWZpbmVkLAoJCQltb3JwaFRhcmdldHNDb3VudDogbW9ycGhUYXJnZXRzQ291bnQsCgkJCW1vcnBoVGV4dHVyZVN0cmlkZTogbW9ycGhUZXh0dXJlU3RyaWRlLAoKCQkJbnVtRGlyTGlnaHRzOiBsaWdodHMuZGlyZWN0aW9uYWwubGVuZ3RoLAoJCQludW1Qb2ludExpZ2h0czogbGlnaHRzLnBvaW50Lmxlbmd0aCwKCQkJbnVtU3BvdExpZ2h0czogbGlnaHRzLnNwb3QubGVuZ3RoLAoJCQludW1TcG90TGlnaHRNYXBzOiBsaWdodHMuc3BvdExpZ2h0TWFwLmxlbmd0aCwKCQkJbnVtUmVjdEFyZWFMaWdodHM6IGxpZ2h0cy5yZWN0QXJlYS5sZW5ndGgsCgkJCW51bUhlbWlMaWdodHM6IGxpZ2h0cy5oZW1pLmxlbmd0aCwKCgkJCW51bURpckxpZ2h0U2hhZG93czogbGlnaHRzLmRpcmVjdGlvbmFsU2hhZG93TWFwLmxlbmd0aCwKCQkJbnVtUG9pbnRMaWdodFNoYWRvd3M6IGxpZ2h0cy5wb2ludFNoYWRvd01hcC5sZW5ndGgsCgkJCW51bVNwb3RMaWdodFNoYWRvd3M6IGxpZ2h0cy5zcG90U2hhZG93TWFwLmxlbmd0aCwKCQkJbnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzOiBsaWdodHMubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzLAoKCQkJbnVtTGlnaHRQcm9iZXM6IGxpZ2h0cy5udW1MaWdodFByb2JlcywKCgkJCW51bUNsaXBwaW5nUGxhbmVzOiBjbGlwcGluZy5udW1QbGFuZXMsCgkJCW51bUNsaXBJbnRlcnNlY3Rpb246IGNsaXBwaW5nLm51bUludGVyc2VjdGlvbiwKCgkJCWRpdGhlcmluZzogbWF0ZXJpYWwuZGl0aGVyaW5nLAoKCQkJc2hhZG93TWFwRW5hYmxlZDogcmVuZGVyZXIuc2hhZG93TWFwLmVuYWJsZWQgJiYgc2hhZG93cy5sZW5ndGggPiAwLAoJCQlzaGFkb3dNYXBUeXBlOiByZW5kZXJlci5zaGFkb3dNYXAudHlwZSwKCgkJCXRvbmVNYXBwaW5nOiB0b25lTWFwcGluZywKCQkJdXNlTGVnYWN5TGlnaHRzOiByZW5kZXJlci5fdXNlTGVnYWN5TGlnaHRzLAoKCQkJZGVjb2RlVmlkZW9UZXh0dXJlOiBIQVNfTUFQICYmICggbWF0ZXJpYWwubWFwLmlzVmlkZW9UZXh0dXJlID09PSB0cnVlICkgJiYgKCBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIG1hdGVyaWFsLm1hcC5jb2xvclNwYWNlICkgPT09IFNSR0JUcmFuc2ZlciApLAoKCQkJcHJlbXVsdGlwbGllZEFscGhhOiBtYXRlcmlhbC5wcmVtdWx0aXBsaWVkQWxwaGEsCgoJCQlkb3VibGVTaWRlZDogbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZSwKCQkJZmxpcFNpZGVkOiBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSwKCgkJCXVzZURlcHRoUGFja2luZzogbWF0ZXJpYWwuZGVwdGhQYWNraW5nID49IDAsCgkJCWRlcHRoUGFja2luZzogbWF0ZXJpYWwuZGVwdGhQYWNraW5nIHx8IDAsCgoJCQlpbmRleDBBdHRyaWJ1dGVOYW1lOiBtYXRlcmlhbC5pbmRleDBBdHRyaWJ1dGVOYW1lLAoKCQkJZXh0ZW5zaW9uRGVyaXZhdGl2ZXM6IEhBU19FWFRFTlNJT05TICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMuZGVyaXZhdGl2ZXMgPT09IHRydWUsCgkJCWV4dGVuc2lvbkZyYWdEZXB0aDogSEFTX0VYVEVOU0lPTlMgJiYgbWF0ZXJpYWwuZXh0ZW5zaW9ucy5mcmFnRGVwdGggPT09IHRydWUsCgkJCWV4dGVuc2lvbkRyYXdCdWZmZXJzOiBIQVNfRVhURU5TSU9OUyAmJiBtYXRlcmlhbC5leHRlbnNpb25zLmRyYXdCdWZmZXJzID09PSB0cnVlLAoJCQlleHRlbnNpb25TaGFkZXJUZXh0dXJlTE9EOiBIQVNfRVhURU5TSU9OUyAmJiBtYXRlcmlhbC5leHRlbnNpb25zLnNoYWRlclRleHR1cmVMT0QgPT09IHRydWUsCgkJCWV4dGVuc2lvbkNsaXBDdWxsRGlzdGFuY2U6IEhBU19FWFRFTlNJT05TICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMuY2xpcEN1bGxEaXN0YW5jZSAmJiBleHRlbnNpb25zLmhhcyggJ1dFQkdMX2NsaXBfY3VsbF9kaXN0YW5jZScgKSwKCgkJCXJlbmRlcmVyRXh0ZW5zaW9uRnJhZ0RlcHRoOiBJU19XRUJHTDIgfHwgZXh0ZW5zaW9ucy5oYXMoICdFWFRfZnJhZ19kZXB0aCcgKSwKCQkJcmVuZGVyZXJFeHRlbnNpb25EcmF3QnVmZmVyczogSVNfV0VCR0wyIHx8IGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfZHJhd19idWZmZXJzJyApLAoJCQlyZW5kZXJlckV4dGVuc2lvblNoYWRlclRleHR1cmVMb2Q6IElTX1dFQkdMMiB8fCBleHRlbnNpb25zLmhhcyggJ0VYVF9zaGFkZXJfdGV4dHVyZV9sb2QnICksCgkJCXJlbmRlcmVyRXh0ZW5zaW9uUGFyYWxsZWxTaGFkZXJDb21waWxlOiBleHRlbnNpb25zLmhhcyggJ0tIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZScgKSwKCgkJCWN1c3RvbVByb2dyYW1DYWNoZUtleTogbWF0ZXJpYWwuY3VzdG9tUHJvZ3JhbUNhY2hlS2V5KCkKCgkJfTsKCgkJcmV0dXJuIHBhcmFtZXRlcnM7CgoJfQoKCWZ1bmN0aW9uIGdldFByb2dyYW1DYWNoZUtleSggcGFyYW1ldGVycyApIHsKCgkJY29uc3QgYXJyYXkgPSBbXTsKCgkJaWYgKCBwYXJhbWV0ZXJzLnNoYWRlcklEICkgewoKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zaGFkZXJJRCApOwoKCQl9IGVsc2UgewoKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21WZXJ0ZXhTaGFkZXJJRCApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmN1c3RvbUZyYWdtZW50U2hhZGVySUQgKTsKCgkJfQoKCQlpZiAoIHBhcmFtZXRlcnMuZGVmaW5lcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBwYXJhbWV0ZXJzLmRlZmluZXMgKSB7CgoJCQkJYXJyYXkucHVzaCggbmFtZSApOwoJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5kZWZpbmVzWyBuYW1lIF0gKTsKCgkJCX0KCgkJfQoKCQlpZiAoIHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCA9PT0gZmFsc2UgKSB7CgoJCQlnZXRQcm9ncmFtQ2FjaGVLZXlQYXJhbWV0ZXJzKCBhcnJheSwgcGFyYW1ldGVycyApOwoJCQlnZXRQcm9ncmFtQ2FjaGVLZXlCb29sZWFucyggYXJyYXksIHBhcmFtZXRlcnMgKTsKCQkJYXJyYXkucHVzaCggcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSApOwoKCQl9CgoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuY3VzdG9tUHJvZ3JhbUNhY2hlS2V5ICk7CgoJCXJldHVybiBhcnJheS5qb2luKCk7CgoJfQoKCWZ1bmN0aW9uIGdldFByb2dyYW1DYWNoZUtleVBhcmFtZXRlcnMoIGFycmF5LCBwYXJhbWV0ZXJzICkgewoKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMub3V0cHV0Q29sb3JTcGFjZSApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW52TWFwTW9kZSApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW52TWFwQ3ViZVVWSGVpZ2h0ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5tYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuYWxwaGFNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubGlnaHRNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuYW9NYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuYnVtcE1hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5ub3JtYWxNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZGlzcGxhY2VtZW50TWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmVtaXNzaXZlTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5yb3VnaG5lc3NNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuYW5pc290cm9weU1hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jbGVhcmNvYXRNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnRoaWNrbmVzc01hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jb21iaW5lICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5mb2dFeHAyICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zaXplQXR0ZW51YXRpb24gKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5tb3JwaEF0dHJpYnV0ZUNvdW50ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1EaXJMaWdodHMgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVBvaW50TGlnaHRzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1TcG90TGlnaHRzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1TcG90TGlnaHRNYXBzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1IZW1pTGlnaHRzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1SZWN0QXJlYUxpZ2h0cyApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtRGlyTGlnaHRTaGFkb3dzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0U2hhZG93cyApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93cyApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1MaWdodFByb2JlcyApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1DbGlwSW50ZXJzZWN0aW9uICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5kZXB0aFBhY2tpbmcgKTsKCgl9CgoJZnVuY3Rpb24gZ2V0UHJvZ3JhbUNhY2hlS2V5Qm9vbGVhbnMoIGFycmF5LCBwYXJhbWV0ZXJzICkgewoKCQlfcHJvZ3JhbUxheWVycy5kaXNhYmxlQWxsKCk7CgoJCWlmICggcGFyYW1ldGVycy5pc1dlYkdMMiApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwoJCWlmICggcGFyYW1ldGVycy5zdXBwb3J0c1ZlcnRleFRleHR1cmVzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxICk7CgkJaWYgKCBwYXJhbWV0ZXJzLmluc3RhbmNpbmcgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIgKTsKCQlpZiAoIHBhcmFtZXRlcnMuaW5zdGFuY2luZ0NvbG9yICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAzICk7CgkJaWYgKCBwYXJhbWV0ZXJzLm1hdGNhcCApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNCApOwoJCWlmICggcGFyYW1ldGVycy5lbnZNYXAgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDUgKTsKCQlpZiAoIHBhcmFtZXRlcnMubm9ybWFsTWFwT2JqZWN0U3BhY2UgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDYgKTsKCQlpZiAoIHBhcmFtZXRlcnMubm9ybWFsTWFwVGFuZ2VudFNwYWNlICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA3ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLmNsZWFyY29hdCApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOCApOwoJCWlmICggcGFyYW1ldGVycy5pcmlkZXNjZW5jZSApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOSApOwoJCWlmICggcGFyYW1ldGVycy5hbHBoYVRlc3QgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEwICk7CgkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleENvbG9ycyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTEgKTsKCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4QWxwaGFzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMiApOwoJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjFzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMyApOwoJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjJzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNCApOwoJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjNzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNSApOwoJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTYgKTsKCQlpZiAoIHBhcmFtZXRlcnMuYW5pc290cm9weSApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTcgKTsKCQlpZiAoIHBhcmFtZXRlcnMuYWxwaGFIYXNoICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxOCApOwoJCWlmICggcGFyYW1ldGVycy5iYXRjaGluZyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTkgKTsKCgkJYXJyYXkucHVzaCggX3Byb2dyYW1MYXllcnMubWFzayApOwoJCV9wcm9ncmFtTGF5ZXJzLmRpc2FibGVBbGwoKTsKCgkJaWYgKCBwYXJhbWV0ZXJzLmZvZyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwoJCWlmICggcGFyYW1ldGVycy51c2VGb2cgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEgKTsKCQlpZiAoIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIgKTsKCQlpZiAoIHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMyApOwoJCWlmICggcGFyYW1ldGVycy5za2lubmluZyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNCApOwoJCWlmICggcGFyYW1ldGVycy5tb3JwaFRhcmdldHMgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDUgKTsKCQlpZiAoIHBhcmFtZXRlcnMubW9ycGhOb3JtYWxzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA2ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLm1vcnBoQ29sb3JzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA3ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLnByZW11bHRpcGxpZWRBbHBoYSApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOCApOwoJCWlmICggcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA5ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLnVzZUxlZ2FjeUxpZ2h0cyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTAgKTsKCQlpZiAoIHBhcmFtZXRlcnMuZG91YmxlU2lkZWQgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDExICk7CgkJaWYgKCBwYXJhbWV0ZXJzLmZsaXBTaWRlZCApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTIgKTsKCQlpZiAoIHBhcmFtZXRlcnMudXNlRGVwdGhQYWNraW5nICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMyApOwoJCWlmICggcGFyYW1ldGVycy5kaXRoZXJpbmcgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE0ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTUgKTsKCQlpZiAoIHBhcmFtZXRlcnMuc2hlZW4gKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE2ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLm9wYXF1ZSApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTcgKTsKCQlpZiAoIHBhcmFtZXRlcnMucG9pbnRzVXZzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxOCApOwoJCWlmICggcGFyYW1ldGVycy5kZWNvZGVWaWRlb1RleHR1cmUgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE5ICk7CgoJCWFycmF5LnB1c2goIF9wcm9ncmFtTGF5ZXJzLm1hc2sgKTsKCgl9CgoJZnVuY3Rpb24gZ2V0VW5pZm9ybXMoIG1hdGVyaWFsICkgewoKCQljb25zdCBzaGFkZXJJRCA9IHNoYWRlcklEc1sgbWF0ZXJpYWwudHlwZSBdOwoJCWxldCB1bmlmb3JtczsKCgkJaWYgKCBzaGFkZXJJRCApIHsKCgkJCWNvbnN0IHNoYWRlciA9IFNoYWRlckxpYlsgc2hhZGVySUQgXTsKCQkJdW5pZm9ybXMgPSBVbmlmb3Jtc1V0aWxzLmNsb25lKCBzaGFkZXIudW5pZm9ybXMgKTsKCgkJfSBlbHNlIHsKCgkJCXVuaWZvcm1zID0gbWF0ZXJpYWwudW5pZm9ybXM7CgoJCX0KCgkJcmV0dXJuIHVuaWZvcm1zOwoKCX0KCglmdW5jdGlvbiBhY3F1aXJlUHJvZ3JhbSggcGFyYW1ldGVycywgY2FjaGVLZXkgKSB7CgoJCWxldCBwcm9ncmFtOwoKCQkvLyBDaGVjayBpZiBjb2RlIGhhcyBiZWVuIGFscmVhZHkgY29tcGlsZWQKCQlmb3IgKCBsZXQgcCA9IDAsIHBsID0gcHJvZ3JhbXMubGVuZ3RoOyBwIDwgcGw7IHAgKysgKSB7CgoJCQljb25zdCBwcmVleGlzdGluZ1Byb2dyYW0gPSBwcm9ncmFtc1sgcCBdOwoKCQkJaWYgKCBwcmVleGlzdGluZ1Byb2dyYW0uY2FjaGVLZXkgPT09IGNhY2hlS2V5ICkgewoKCQkJCXByb2dyYW0gPSBwcmVleGlzdGluZ1Byb2dyYW07CgkJCQkrKyBwcm9ncmFtLnVzZWRUaW1lczsKCgkJCQlicmVhazsKCgkJCX0KCgkJfQoKCQlpZiAoIHByb2dyYW0gPT09IHVuZGVmaW5lZCApIHsKCgkJCXByb2dyYW0gPSBuZXcgV2ViR0xQcm9ncmFtKCByZW5kZXJlciwgY2FjaGVLZXksIHBhcmFtZXRlcnMsIGJpbmRpbmdTdGF0ZXMgKTsKCQkJcHJvZ3JhbXMucHVzaCggcHJvZ3JhbSApOwoKCQl9CgoJCXJldHVybiBwcm9ncmFtOwoKCX0KCglmdW5jdGlvbiByZWxlYXNlUHJvZ3JhbSggcHJvZ3JhbSApIHsKCgkJaWYgKCAtLSBwcm9ncmFtLnVzZWRUaW1lcyA9PT0gMCApIHsKCgkJCS8vIFJlbW92ZSBmcm9tIHVub3JkZXJlZCBzZXQKCQkJY29uc3QgaSA9IHByb2dyYW1zLmluZGV4T2YoIHByb2dyYW0gKTsKCQkJcHJvZ3JhbXNbIGkgXSA9IHByb2dyYW1zWyBwcm9ncmFtcy5sZW5ndGggLSAxIF07CgkJCXByb2dyYW1zLnBvcCgpOwoKCQkJLy8gRnJlZSBXZWJHTCByZXNvdXJjZXMKCQkJcHJvZ3JhbS5kZXN0cm95KCk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gcmVsZWFzZVNoYWRlckNhY2hlKCBtYXRlcmlhbCApIHsKCgkJX2N1c3RvbVNoYWRlcnMucmVtb3ZlKCBtYXRlcmlhbCApOwoKCX0KCglmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQlfY3VzdG9tU2hhZGVycy5kaXNwb3NlKCk7CgoJfQoKCXJldHVybiB7CgkJZ2V0UGFyYW1ldGVyczogZ2V0UGFyYW1ldGVycywKCQlnZXRQcm9ncmFtQ2FjaGVLZXk6IGdldFByb2dyYW1DYWNoZUtleSwKCQlnZXRVbmlmb3JtczogZ2V0VW5pZm9ybXMsCgkJYWNxdWlyZVByb2dyYW06IGFjcXVpcmVQcm9ncmFtLAoJCXJlbGVhc2VQcm9ncmFtOiByZWxlYXNlUHJvZ3JhbSwKCQlyZWxlYXNlU2hhZGVyQ2FjaGU6IHJlbGVhc2VTaGFkZXJDYWNoZSwKCQkvLyBFeHBvc2VkIGZvciByZXNvdXJjZSBtb25pdG9yaW5nICYgZXJyb3IgZmVlZGJhY2sgdmlhIHJlbmRlcmVyLmluZm86CgkJcHJvZ3JhbXM6IHByb2dyYW1zLAoJCWRpc3Bvc2U6IGRpc3Bvc2UKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTFByb3BlcnRpZXMoKSB7CgoJbGV0IHByb3BlcnRpZXMgPSBuZXcgV2Vha01hcCgpOwoKCWZ1bmN0aW9uIGdldCggb2JqZWN0ICkgewoKCQlsZXQgbWFwID0gcHJvcGVydGllcy5nZXQoIG9iamVjdCApOwoKCQlpZiAoIG1hcCA9PT0gdW5kZWZpbmVkICkgewoKCQkJbWFwID0ge307CgkJCXByb3BlcnRpZXMuc2V0KCBvYmplY3QsIG1hcCApOwoKCQl9CgoJCXJldHVybiBtYXA7CgoJfQoKCWZ1bmN0aW9uIHJlbW92ZSggb2JqZWN0ICkgewoKCQlwcm9wZXJ0aWVzLmRlbGV0ZSggb2JqZWN0ICk7CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0LCBrZXksIHZhbHVlICkgewoKCQlwcm9wZXJ0aWVzLmdldCggb2JqZWN0IClbIGtleSBdID0gdmFsdWU7CgoJfQoKCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCXByb3BlcnRpZXMgPSBuZXcgV2Vha01hcCgpOwoKCX0KCglyZXR1cm4gewoJCWdldDogZ2V0LAoJCXJlbW92ZTogcmVtb3ZlLAoJCXVwZGF0ZTogdXBkYXRlLAoJCWRpc3Bvc2U6IGRpc3Bvc2UKCX07Cgp9CgpmdW5jdGlvbiBwYWludGVyU29ydFN0YWJsZSggYSwgYiApIHsKCglpZiAoIGEuZ3JvdXBPcmRlciAhPT0gYi5ncm91cE9yZGVyICkgewoKCQlyZXR1cm4gYS5ncm91cE9yZGVyIC0gYi5ncm91cE9yZGVyOwoKCX0gZWxzZSBpZiAoIGEucmVuZGVyT3JkZXIgIT09IGIucmVuZGVyT3JkZXIgKSB7CgoJCXJldHVybiBhLnJlbmRlck9yZGVyIC0gYi5yZW5kZXJPcmRlcjsKCgl9IGVsc2UgaWYgKCBhLm1hdGVyaWFsLmlkICE9PSBiLm1hdGVyaWFsLmlkICkgewoKCQlyZXR1cm4gYS5tYXRlcmlhbC5pZCAtIGIubWF0ZXJpYWwuaWQ7CgoJfSBlbHNlIGlmICggYS56ICE9PSBiLnogKSB7CgoJCXJldHVybiBhLnogLSBiLno7CgoJfSBlbHNlIHsKCgkJcmV0dXJuIGEuaWQgLSBiLmlkOwoKCX0KCn0KCmZ1bmN0aW9uIHJldmVyc2VQYWludGVyU29ydFN0YWJsZSggYSwgYiApIHsKCglpZiAoIGEuZ3JvdXBPcmRlciAhPT0gYi5ncm91cE9yZGVyICkgewoKCQlyZXR1cm4gYS5ncm91cE9yZGVyIC0gYi5ncm91cE9yZGVyOwoKCX0gZWxzZSBpZiAoIGEucmVuZGVyT3JkZXIgIT09IGIucmVuZGVyT3JkZXIgKSB7CgoJCXJldHVybiBhLnJlbmRlck9yZGVyIC0gYi5yZW5kZXJPcmRlcjsKCgl9IGVsc2UgaWYgKCBhLnogIT09IGIueiApIHsKCgkJcmV0dXJuIGIueiAtIGEuejsKCgl9IGVsc2UgewoKCQlyZXR1cm4gYS5pZCAtIGIuaWQ7CgoJfQoKfQoKCmZ1bmN0aW9uIFdlYkdMUmVuZGVyTGlzdCgpIHsKCgljb25zdCByZW5kZXJJdGVtcyA9IFtdOwoJbGV0IHJlbmRlckl0ZW1zSW5kZXggPSAwOwoKCWNvbnN0IG9wYXF1ZSA9IFtdOwoJY29uc3QgdHJhbnNtaXNzaXZlID0gW107Cgljb25zdCB0cmFuc3BhcmVudCA9IFtdOwoKCWZ1bmN0aW9uIGluaXQoKSB7CgoJCXJlbmRlckl0ZW1zSW5kZXggPSAwOwoKCQlvcGFxdWUubGVuZ3RoID0gMDsKCQl0cmFuc21pc3NpdmUubGVuZ3RoID0gMDsKCQl0cmFuc3BhcmVudC5sZW5ndGggPSAwOwoKCX0KCglmdW5jdGlvbiBnZXROZXh0UmVuZGVySXRlbSggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQlsZXQgcmVuZGVySXRlbSA9IHJlbmRlckl0ZW1zWyByZW5kZXJJdGVtc0luZGV4IF07CgoJCWlmICggcmVuZGVySXRlbSA9PT0gdW5kZWZpbmVkICkgewoKCQkJcmVuZGVySXRlbSA9IHsKCQkJCWlkOiBvYmplY3QuaWQsCgkJCQlvYmplY3Q6IG9iamVjdCwKCQkJCWdlb21ldHJ5OiBnZW9tZXRyeSwKCQkJCW1hdGVyaWFsOiBtYXRlcmlhbCwKCQkJCWdyb3VwT3JkZXI6IGdyb3VwT3JkZXIsCgkJCQlyZW5kZXJPcmRlcjogb2JqZWN0LnJlbmRlck9yZGVyLAoJCQkJejogeiwKCQkJCWdyb3VwOiBncm91cAoJCQl9OwoKCQkJcmVuZGVySXRlbXNbIHJlbmRlckl0ZW1zSW5kZXggXSA9IHJlbmRlckl0ZW07CgoJCX0gZWxzZSB7CgoJCQlyZW5kZXJJdGVtLmlkID0gb2JqZWN0LmlkOwoJCQlyZW5kZXJJdGVtLm9iamVjdCA9IG9iamVjdDsKCQkJcmVuZGVySXRlbS5nZW9tZXRyeSA9IGdlb21ldHJ5OwoJCQlyZW5kZXJJdGVtLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgkJCXJlbmRlckl0ZW0uZ3JvdXBPcmRlciA9IGdyb3VwT3JkZXI7CgkJCXJlbmRlckl0ZW0ucmVuZGVyT3JkZXIgPSBvYmplY3QucmVuZGVyT3JkZXI7CgkJCXJlbmRlckl0ZW0ueiA9IHo7CgkJCXJlbmRlckl0ZW0uZ3JvdXAgPSBncm91cDsKCgkJfQoKCQlyZW5kZXJJdGVtc0luZGV4ICsrOwoKCQlyZXR1cm4gcmVuZGVySXRlbTsKCgl9CgoJZnVuY3Rpb24gcHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQljb25zdCByZW5kZXJJdGVtID0gZ2V0TmV4dFJlbmRlckl0ZW0oIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCApOwoKCQlpZiAoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA+IDAuMCApIHsKCgkJCXRyYW5zbWlzc2l2ZS5wdXNoKCByZW5kZXJJdGVtICk7CgoJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSB0cnVlICkgewoKCQkJdHJhbnNwYXJlbnQucHVzaCggcmVuZGVySXRlbSApOwoKCQl9IGVsc2UgewoKCQkJb3BhcXVlLnB1c2goIHJlbmRlckl0ZW0gKTsKCgkJfQoKCX0KCglmdW5jdGlvbiB1bnNoaWZ0KCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKSB7CgoJCWNvbnN0IHJlbmRlckl0ZW0gPSBnZXROZXh0UmVuZGVySXRlbSggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICk7CgoJCWlmICggbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMC4wICkgewoKCQkJdHJhbnNtaXNzaXZlLnVuc2hpZnQoIHJlbmRlckl0ZW0gKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IHRydWUgKSB7CgoJCQl0cmFuc3BhcmVudC51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgoJCX0gZWxzZSB7CgoJCQlvcGFxdWUudW5zaGlmdCggcmVuZGVySXRlbSApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNvcnQoIGN1c3RvbU9wYXF1ZVNvcnQsIGN1c3RvbVRyYW5zcGFyZW50U29ydCApIHsKCgkJaWYgKCBvcGFxdWUubGVuZ3RoID4gMSApIG9wYXF1ZS5zb3J0KCBjdXN0b21PcGFxdWVTb3J0IHx8IHBhaW50ZXJTb3J0U3RhYmxlICk7CgkJaWYgKCB0cmFuc21pc3NpdmUubGVuZ3RoID4gMSApIHRyYW5zbWlzc2l2ZS5zb3J0KCBjdXN0b21UcmFuc3BhcmVudFNvcnQgfHwgcmV2ZXJzZVBhaW50ZXJTb3J0U3RhYmxlICk7CgkJaWYgKCB0cmFuc3BhcmVudC5sZW5ndGggPiAxICkgdHJhbnNwYXJlbnQuc29ydCggY3VzdG9tVHJhbnNwYXJlbnRTb3J0IHx8IHJldmVyc2VQYWludGVyU29ydFN0YWJsZSApOwoKCX0KCglmdW5jdGlvbiBmaW5pc2goKSB7CgoJCS8vIENsZWFyIHJlZmVyZW5jZXMgZnJvbSBpbmFjdGl2ZSByZW5kZXJJdGVtcyBpbiB0aGUgbGlzdAoKCQlmb3IgKCBsZXQgaSA9IHJlbmRlckl0ZW1zSW5kZXgsIGlsID0gcmVuZGVySXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCByZW5kZXJJdGVtID0gcmVuZGVySXRlbXNbIGkgXTsKCgkJCWlmICggcmVuZGVySXRlbS5pZCA9PT0gbnVsbCApIGJyZWFrOwoKCQkJcmVuZGVySXRlbS5pZCA9IG51bGw7CgkJCXJlbmRlckl0ZW0ub2JqZWN0ID0gbnVsbDsKCQkJcmVuZGVySXRlbS5nZW9tZXRyeSA9IG51bGw7CgkJCXJlbmRlckl0ZW0ubWF0ZXJpYWwgPSBudWxsOwoJCQlyZW5kZXJJdGVtLmdyb3VwID0gbnVsbDsKCgkJfQoKCX0KCglyZXR1cm4gewoKCQlvcGFxdWU6IG9wYXF1ZSwKCQl0cmFuc21pc3NpdmU6IHRyYW5zbWlzc2l2ZSwKCQl0cmFuc3BhcmVudDogdHJhbnNwYXJlbnQsCgoJCWluaXQ6IGluaXQsCgkJcHVzaDogcHVzaCwKCQl1bnNoaWZ0OiB1bnNoaWZ0LAoJCWZpbmlzaDogZmluaXNoLAoKCQlzb3J0OiBzb3J0Cgl9OwoKfQoKZnVuY3Rpb24gV2ViR0xSZW5kZXJMaXN0cygpIHsKCglsZXQgbGlzdHMgPSBuZXcgV2Vha01hcCgpOwoKCWZ1bmN0aW9uIGdldCggc2NlbmUsIHJlbmRlckNhbGxEZXB0aCApIHsKCgkJY29uc3QgbGlzdEFycmF5ID0gbGlzdHMuZ2V0KCBzY2VuZSApOwoJCWxldCBsaXN0OwoKCQlpZiAoIGxpc3RBcnJheSA9PT0gdW5kZWZpbmVkICkgewoKCQkJbGlzdCA9IG5ldyBXZWJHTFJlbmRlckxpc3QoKTsKCQkJbGlzdHMuc2V0KCBzY2VuZSwgWyBsaXN0IF0gKTsKCgkJfSBlbHNlIHsKCgkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IGxpc3RBcnJheS5sZW5ndGggKSB7CgoJCQkJbGlzdCA9IG5ldyBXZWJHTFJlbmRlckxpc3QoKTsKCQkJCWxpc3RBcnJheS5wdXNoKCBsaXN0ICk7CgoJCQl9IGVsc2UgewoKCQkJCWxpc3QgPSBsaXN0QXJyYXlbIHJlbmRlckNhbGxEZXB0aCBdOwoKCQkJfQoKCQl9CgoJCXJldHVybiBsaXN0OwoKCX0KCglmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQlsaXN0cyA9IG5ldyBXZWFrTWFwKCk7CgoJfQoKCXJldHVybiB7CgkJZ2V0OiBnZXQsCgkJZGlzcG9zZTogZGlzcG9zZQoJfTsKCn0KCmZ1bmN0aW9uIFVuaWZvcm1zQ2FjaGUoKSB7CgoJY29uc3QgbGlnaHRzID0ge307CgoJcmV0dXJuIHsKCgkJZ2V0OiBmdW5jdGlvbiAoIGxpZ2h0ICkgewoKCQkJaWYgKCBsaWdodHNbIGxpZ2h0LmlkIF0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQlyZXR1cm4gbGlnaHRzWyBsaWdodC5pZCBdOwoKCQkJfQoKCQkJbGV0IHVuaWZvcm1zOwoKCQkJc3dpdGNoICggbGlnaHQudHlwZSApIHsKCgkJCQljYXNlICdEaXJlY3Rpb25hbExpZ2h0JzoKCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJZGlyZWN0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQljb2xvcjogbmV3IENvbG9yKCkKCQkJCQl9OwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1Nwb3RMaWdodCc6CgkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQlkaXJlY3Rpb246IG5ldyBWZWN0b3IzKCksCgkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJZGlzdGFuY2U6IDAsCgkJCQkJCWNvbmVDb3M6IDAsCgkJCQkJCXBlbnVtYnJhQ29zOiAwLAoJCQkJCQlkZWNheTogMAoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnUG9pbnRMaWdodCc6CgkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQljb2xvcjogbmV3IENvbG9yKCksCgkJCQkJCWRpc3RhbmNlOiAwLAoJCQkJCQlkZWNheTogMAoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnSGVtaXNwaGVyZUxpZ2h0JzoKCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJZGlyZWN0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQlza3lDb2xvcjogbmV3IENvbG9yKCksCgkJCQkJCWdyb3VuZENvbG9yOiBuZXcgQ29sb3IoKQoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnUmVjdEFyZWFMaWdodCc6CgkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJcG9zaXRpb246IG5ldyBWZWN0b3IzKCksCgkJCQkJCWhhbGZXaWR0aDogbmV3IFZlY3RvcjMoKSwKCQkJCQkJaGFsZkhlaWdodDogbmV3IFZlY3RvcjMoKQoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQl9CgoJCQlsaWdodHNbIGxpZ2h0LmlkIF0gPSB1bmlmb3JtczsKCgkJCXJldHVybiB1bmlmb3JtczsKCgkJfQoKCX07Cgp9CgpmdW5jdGlvbiBTaGFkb3dVbmlmb3Jtc0NhY2hlKCkgewoKCWNvbnN0IGxpZ2h0cyA9IHt9OwoKCXJldHVybiB7CgoJCWdldDogZnVuY3Rpb24gKCBsaWdodCApIHsKCgkJCWlmICggbGlnaHRzWyBsaWdodC5pZCBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcmV0dXJuIGxpZ2h0c1sgbGlnaHQuaWQgXTsKCgkJCX0KCgkJCWxldCB1bmlmb3JtczsKCgkJCXN3aXRjaCAoIGxpZ2h0LnR5cGUgKSB7CgoJCQkJY2FzZSAnRGlyZWN0aW9uYWxMaWdodCc6CgkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCXNoYWRvd0JpYXM6IDAsCgkJCQkJCXNoYWRvd05vcm1hbEJpYXM6IDAsCgkJCQkJCXNoYWRvd1JhZGl1czogMSwKCQkJCQkJc2hhZG93TWFwU2l6ZTogbmV3IFZlY3RvcjIoKQoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnU3BvdExpZ2h0JzoKCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJc2hhZG93QmlhczogMCwKCQkJCQkJc2hhZG93Tm9ybWFsQmlhczogMCwKCQkJCQkJc2hhZG93UmFkaXVzOiAxLAoJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpCgkJCQkJfTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdQb2ludExpZ2h0JzoKCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJc2hhZG93QmlhczogMCwKCQkJCQkJc2hhZG93Tm9ybWFsQmlhczogMCwKCQkJCQkJc2hhZG93UmFkaXVzOiAxLAoJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpLAoJCQkJCQlzaGFkb3dDYW1lcmFOZWFyOiAxLAoJCQkJCQlzaGFkb3dDYW1lcmFGYXI6IDEwMDAKCQkJCQl9OwoJCQkJCWJyZWFrOwoKCQkJCS8vIFRPRE8gKGFiZWxuYXRpb24pOiBzZXQgUmVjdEFyZWFMaWdodCBzaGFkb3cgdW5pZm9ybXMKCgkJCX0KCgkJCWxpZ2h0c1sgbGlnaHQuaWQgXSA9IHVuaWZvcm1zOwoKCQkJcmV0dXJuIHVuaWZvcm1zOwoKCQl9CgoJfTsKCn0KCgoKbGV0IG5leHRWZXJzaW9uID0gMDsKCmZ1bmN0aW9uIHNoYWRvd0Nhc3RpbmdBbmRUZXh0dXJpbmdMaWdodHNGaXJzdCggbGlnaHRBLCBsaWdodEIgKSB7CgoJcmV0dXJuICggbGlnaHRCLmNhc3RTaGFkb3cgPyAyIDogMCApIC0gKCBsaWdodEEuY2FzdFNoYWRvdyA/IDIgOiAwICkgKyAoIGxpZ2h0Qi5tYXAgPyAxIDogMCApIC0gKCBsaWdodEEubWFwID8gMSA6IDAgKTsKCn0KCmZ1bmN0aW9uIFdlYkdMTGlnaHRzKCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMgKSB7CgoJY29uc3QgY2FjaGUgPSBuZXcgVW5pZm9ybXNDYWNoZSgpOwoKCWNvbnN0IHNoYWRvd0NhY2hlID0gU2hhZG93VW5pZm9ybXNDYWNoZSgpOwoKCWNvbnN0IHN0YXRlID0gewoKCQl2ZXJzaW9uOiAwLAoKCQloYXNoOiB7CgkJCWRpcmVjdGlvbmFsTGVuZ3RoOiAtIDEsCgkJCXBvaW50TGVuZ3RoOiAtIDEsCgkJCXNwb3RMZW5ndGg6IC0gMSwKCQkJcmVjdEFyZWFMZW5ndGg6IC0gMSwKCQkJaGVtaUxlbmd0aDogLSAxLAoKCQkJbnVtRGlyZWN0aW9uYWxTaGFkb3dzOiAtIDEsCgkJCW51bVBvaW50U2hhZG93czogLSAxLAoJCQludW1TcG90U2hhZG93czogLSAxLAoJCQludW1TcG90TWFwczogLSAxLAoKCQkJbnVtTGlnaHRQcm9iZXM6IC0gMQoJCX0sCgoJCWFtYmllbnQ6IFsgMCwgMCwgMCBdLAoJCXByb2JlOiBbXSwKCQlkaXJlY3Rpb25hbDogW10sCgkJZGlyZWN0aW9uYWxTaGFkb3c6IFtdLAoJCWRpcmVjdGlvbmFsU2hhZG93TWFwOiBbXSwKCQlkaXJlY3Rpb25hbFNoYWRvd01hdHJpeDogW10sCgkJc3BvdDogW10sCgkJc3BvdExpZ2h0TWFwOiBbXSwKCQlzcG90U2hhZG93OiBbXSwKCQlzcG90U2hhZG93TWFwOiBbXSwKCQlzcG90TGlnaHRNYXRyaXg6IFtdLAoJCXJlY3RBcmVhOiBbXSwKCQlyZWN0QXJlYUxUQzE6IG51bGwsCgkJcmVjdEFyZWFMVEMyOiBudWxsLAoJCXBvaW50OiBbXSwKCQlwb2ludFNoYWRvdzogW10sCgkJcG9pbnRTaGFkb3dNYXA6IFtdLAoJCXBvaW50U2hhZG93TWF0cml4OiBbXSwKCQloZW1pOiBbXSwKCQludW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHM6IDAsCgkJbnVtTGlnaHRQcm9iZXM6IDAKCgl9OwoKCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSBzdGF0ZS5wcm9iZS5wdXNoKCBuZXcgVmVjdG9yMygpICk7CgoJY29uc3QgdmVjdG9yMyA9IG5ldyBWZWN0b3IzKCk7Cgljb25zdCBtYXRyaXg0ID0gbmV3IE1hdHJpeDQoKTsKCWNvbnN0IG1hdHJpeDQyID0gbmV3IE1hdHJpeDQoKTsKCglmdW5jdGlvbiBzZXR1cCggbGlnaHRzLCB1c2VMZWdhY3lMaWdodHMgKSB7CgoJCWxldCByID0gMCwgZyA9IDAsIGIgPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgc3RhdGUucHJvYmVbIGkgXS5zZXQoIDAsIDAsIDAgKTsKCgkJbGV0IGRpcmVjdGlvbmFsTGVuZ3RoID0gMDsKCQlsZXQgcG9pbnRMZW5ndGggPSAwOwoJCWxldCBzcG90TGVuZ3RoID0gMDsKCQlsZXQgcmVjdEFyZWFMZW5ndGggPSAwOwoJCWxldCBoZW1pTGVuZ3RoID0gMDsKCgkJbGV0IG51bURpcmVjdGlvbmFsU2hhZG93cyA9IDA7CgkJbGV0IG51bVBvaW50U2hhZG93cyA9IDA7CgkJbGV0IG51bVNwb3RTaGFkb3dzID0gMDsKCQlsZXQgbnVtU3BvdE1hcHMgPSAwOwoJCWxldCBudW1TcG90U2hhZG93c1dpdGhNYXBzID0gMDsKCgkJbGV0IG51bUxpZ2h0UHJvYmVzID0gMDsKCgkJLy8gb3JkZXJpbmcgOiBbc2hhZG93IGNhc3RpbmcgKyBtYXAgdGV4dHVyaW5nLCBtYXAgdGV4dHVyaW5nLCBzaGFkb3cgY2FzdGluZywgbm9uZSBdCgkJbGlnaHRzLnNvcnQoIHNoYWRvd0Nhc3RpbmdBbmRUZXh0dXJpbmdMaWdodHNGaXJzdCApOwoKCQkvLyBhcnRpc3QtZnJpZW5kbHkgbGlnaHQgaW50ZW5zaXR5IHNjYWxpbmcgZmFjdG9yCgkJY29uc3Qgc2NhbGVGYWN0b3IgPSAoIHVzZUxlZ2FjeUxpZ2h0cyA9PT0gdHJ1ZSApID8gTWF0aC5QSSA6IDE7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgbGlnaHQgPSBsaWdodHNbIGkgXTsKCgkJCWNvbnN0IGNvbG9yID0gbGlnaHQuY29sb3I7CgkJCWNvbnN0IGludGVuc2l0eSA9IGxpZ2h0LmludGVuc2l0eTsKCQkJY29uc3QgZGlzdGFuY2UgPSBsaWdodC5kaXN0YW5jZTsKCgkJCWNvbnN0IHNoYWRvd01hcCA9ICggbGlnaHQuc2hhZG93ICYmIGxpZ2h0LnNoYWRvdy5tYXAgKSA/IGxpZ2h0LnNoYWRvdy5tYXAudGV4dHVyZSA6IG51bGw7CgoJCQlpZiAoIGxpZ2h0LmlzQW1iaWVudExpZ2h0ICkgewoKCQkJCXIgKz0gY29sb3IuciAqIGludGVuc2l0eSAqIHNjYWxlRmFjdG9yOwoJCQkJZyArPSBjb2xvci5nICogaW50ZW5zaXR5ICogc2NhbGVGYWN0b3I7CgkJCQliICs9IGNvbG9yLmIgKiBpbnRlbnNpdHkgKiBzY2FsZUZhY3RvcjsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzTGlnaHRQcm9iZSApIHsKCgkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCA5OyBqICsrICkgewoKCQkJCQlzdGF0ZS5wcm9iZVsgaiBdLmFkZFNjYWxlZFZlY3RvciggbGlnaHQuc2guY29lZmZpY2llbnRzWyBqIF0sIGludGVuc2l0eSApOwoKCQkJCX0KCgkJCQludW1MaWdodFByb2JlcyArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzRGlyZWN0aW9uYWxMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBsaWdodC5pbnRlbnNpdHkgKiBzY2FsZUZhY3RvciApOwoKCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCgkJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCQljb25zdCBzaGFkb3dVbmlmb3JtcyA9IHNoYWRvd0NhY2hlLmdldCggbGlnaHQgKTsKCgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd05vcm1hbEJpYXMgPSBzaGFkb3cubm9ybWFsQmlhczsKCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dSYWRpdXMgPSBzaGFkb3cucmFkaXVzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCgkJCQkJc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSBzaGFkb3dVbmlmb3JtczsKCQkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hcFsgZGlyZWN0aW9uYWxMZW5ndGggXSA9IHNoYWRvd01hcDsKCQkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgZGlyZWN0aW9uYWxMZW5ndGggXSA9IGxpZ2h0LnNoYWRvdy5tYXRyaXg7CgoJCQkJCW51bURpcmVjdGlvbmFsU2hhZG93cyArKzsKCgkJCQl9CgoJCQkJc3RhdGUuZGlyZWN0aW9uYWxbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQlkaXJlY3Rpb25hbExlbmd0aCArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzU3BvdExpZ2h0ICkgewoKCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCgkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBjb2xvciApLm11bHRpcGx5U2NhbGFyKCBpbnRlbnNpdHkgKiBzY2FsZUZhY3RvciApOwoJCQkJdW5pZm9ybXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKCgkJCQl1bmlmb3Jtcy5jb25lQ29zID0gTWF0aC5jb3MoIGxpZ2h0LmFuZ2xlICk7CgkJCQl1bmlmb3Jtcy5wZW51bWJyYUNvcyA9IE1hdGguY29zKCBsaWdodC5hbmdsZSAqICggMSAtIGxpZ2h0LnBlbnVtYnJhICkgKTsKCQkJCXVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CgoJCQkJc3RhdGUuc3BvdFsgc3BvdExlbmd0aCBdID0gdW5pZm9ybXM7CgoJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCWlmICggbGlnaHQubWFwICkgewoKCQkJCQlzdGF0ZS5zcG90TGlnaHRNYXBbIG51bVNwb3RNYXBzIF0gPSBsaWdodC5tYXA7CgkJCQkJbnVtU3BvdE1hcHMgKys7CgoJCQkJCS8vIG1ha2Ugc3VyZSB0aGUgbGlnaHRNYXRyaXggaXMgdXAgdG8gZGF0ZQoJCQkJCS8vIFRPRE8gOiBkbyBpdCBpZiByZXF1aXJlZCBvbmx5CgkJCQkJc2hhZG93LnVwZGF0ZU1hdHJpY2VzKCBsaWdodCApOwoKCQkJCQlpZiAoIGxpZ2h0LmNhc3RTaGFkb3cgKSBudW1TcG90U2hhZG93c1dpdGhNYXBzICsrOwoKCQkJCX0KCgkJCQlzdGF0ZS5zcG90TGlnaHRNYXRyaXhbIHNwb3RMZW5ndGggXSA9IHNoYWRvdy5tYXRyaXg7CgoJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgewoKCQkJCQljb25zdCBzaGFkb3dVbmlmb3JtcyA9IHNoYWRvd0NhY2hlLmdldCggbGlnaHQgKTsKCgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd05vcm1hbEJpYXMgPSBzaGFkb3cubm9ybWFsQmlhczsKCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dSYWRpdXMgPSBzaGFkb3cucmFkaXVzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCgkJCQkJc3RhdGUuc3BvdFNoYWRvd1sgc3BvdExlbmd0aCBdID0gc2hhZG93VW5pZm9ybXM7CgkJCQkJc3RhdGUuc3BvdFNoYWRvd01hcFsgc3BvdExlbmd0aCBdID0gc2hhZG93TWFwOwoKCQkJCQludW1TcG90U2hhZG93cyArKzsKCgkJCQl9CgoJCQkJc3BvdExlbmd0aCArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUmVjdEFyZWFMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBjb2xvciApLm11bHRpcGx5U2NhbGFyKCBpbnRlbnNpdHkgKTsKCgkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguc2V0KCBsaWdodC53aWR0aCAqIDAuNSwgMC4wLCAwLjAgKTsKCQkJCXVuaWZvcm1zLmhhbGZIZWlnaHQuc2V0KCAwLjAsIGxpZ2h0LmhlaWdodCAqIDAuNSwgMC4wICk7CgoJCQkJc3RhdGUucmVjdEFyZWFbIHJlY3RBcmVhTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUG9pbnRMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBsaWdodC5pbnRlbnNpdHkgKiBzY2FsZUZhY3RvciApOwoJCQkJdW5pZm9ybXMuZGlzdGFuY2UgPSBsaWdodC5kaXN0YW5jZTsKCQkJCXVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CgoJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgewoKCQkJCQljb25zdCBzaGFkb3cgPSBsaWdodC5zaGFkb3c7CgoJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dCaWFzID0gc2hhZG93LmJpYXM7CgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Tm9ybWFsQmlhcyA9IHNoYWRvdy5ub3JtYWxCaWFzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93TWFwU2l6ZSA9IHNoYWRvdy5tYXBTaXplOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd0NhbWVyYU5lYXIgPSBzaGFkb3cuY2FtZXJhLm5lYXI7CgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhRmFyID0gc2hhZG93LmNhbWVyYS5mYXI7CgoJCQkJCXN0YXRlLnBvaW50U2hhZG93WyBwb2ludExlbmd0aCBdID0gc2hhZG93VW5pZm9ybXM7CgkJCQkJc3RhdGUucG9pbnRTaGFkb3dNYXBbIHBvaW50TGVuZ3RoIF0gPSBzaGFkb3dNYXA7CgkJCQkJc3RhdGUucG9pbnRTaGFkb3dNYXRyaXhbIHBvaW50TGVuZ3RoIF0gPSBsaWdodC5zaGFkb3cubWF0cml4OwoKCQkJCQludW1Qb2ludFNoYWRvd3MgKys7CgoJCQkJfQoKCQkJCXN0YXRlLnBvaW50WyBwb2ludExlbmd0aCBdID0gdW5pZm9ybXM7CgoJCQkJcG9pbnRMZW5ndGggKys7CgoJCQl9IGVsc2UgaWYgKCBsaWdodC5pc0hlbWlzcGhlcmVMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQl1bmlmb3Jtcy5za3lDb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBpbnRlbnNpdHkgKiBzY2FsZUZhY3RvciApOwoJCQkJdW5pZm9ybXMuZ3JvdW5kQ29sb3IuY29weSggbGlnaHQuZ3JvdW5kQ29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICogc2NhbGVGYWN0b3IgKTsKCgkJCQlzdGF0ZS5oZW1pWyBoZW1pTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQloZW1pTGVuZ3RoICsrOwoKCQkJfQoKCQl9CgoJCWlmICggcmVjdEFyZWFMZW5ndGggPiAwICkgewoKCQkJaWYgKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgKSB7CgoJCQkJLy8gV2ViR0wgMgoKCQkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IHRydWUgKSB7CgoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19GTE9BVF8xOwoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMiA9IFVuaWZvcm1zTGliLkxUQ19GTE9BVF8yOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19IQUxGXzE7CgkJCQkJc3RhdGUucmVjdEFyZWFMVEMyID0gVW5pZm9ybXNMaWIuTFRDX0hBTEZfMjsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCS8vIFdlYkdMIDEKCgkJCQlpZiAoIGV4dGVuc2lvbnMuaGFzKCAnT0VTX3RleHR1cmVfZmxvYXRfbGluZWFyJyApID09PSB0cnVlICkgewoKCQkJCQlzdGF0ZS5yZWN0QXJlYUxUQzEgPSBVbmlmb3Jtc0xpYi5MVENfRkxPQVRfMTsKCQkJCQlzdGF0ZS5yZWN0QXJlYUxUQzIgPSBVbmlmb3Jtc0xpYi5MVENfRkxPQVRfMjsKCgkJCQl9IGVsc2UgaWYgKCBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2hhbGZfZmxvYXRfbGluZWFyJyApID09PSB0cnVlICkgewoKCQkJCQlzdGF0ZS5yZWN0QXJlYUxUQzEgPSBVbmlmb3Jtc0xpYi5MVENfSEFMRl8xOwoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMiA9IFVuaWZvcm1zTGliLkxUQ19IQUxGXzI7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFVuYWJsZSB0byB1c2UgUmVjdEFyZWFMaWdodC4gTWlzc2luZyBXZWJHTCBleHRlbnNpb25zLicgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJc3RhdGUuYW1iaWVudFsgMCBdID0gcjsKCQlzdGF0ZS5hbWJpZW50WyAxIF0gPSBnOwoJCXN0YXRlLmFtYmllbnRbIDIgXSA9IGI7CgoJCWNvbnN0IGhhc2ggPSBzdGF0ZS5oYXNoOwoKCQlpZiAoIGhhc2guZGlyZWN0aW9uYWxMZW5ndGggIT09IGRpcmVjdGlvbmFsTGVuZ3RoIHx8CgkJCWhhc2gucG9pbnRMZW5ndGggIT09IHBvaW50TGVuZ3RoIHx8CgkJCWhhc2guc3BvdExlbmd0aCAhPT0gc3BvdExlbmd0aCB8fAoJCQloYXNoLnJlY3RBcmVhTGVuZ3RoICE9PSByZWN0QXJlYUxlbmd0aCB8fAoJCQloYXNoLmhlbWlMZW5ndGggIT09IGhlbWlMZW5ndGggfHwKCQkJaGFzaC5udW1EaXJlY3Rpb25hbFNoYWRvd3MgIT09IG51bURpcmVjdGlvbmFsU2hhZG93cyB8fAoJCQloYXNoLm51bVBvaW50U2hhZG93cyAhPT0gbnVtUG9pbnRTaGFkb3dzIHx8CgkJCWhhc2gubnVtU3BvdFNoYWRvd3MgIT09IG51bVNwb3RTaGFkb3dzIHx8CgkJCWhhc2gubnVtU3BvdE1hcHMgIT09IG51bVNwb3RNYXBzIHx8CgkJCWhhc2gubnVtTGlnaHRQcm9iZXMgIT09IG51bUxpZ2h0UHJvYmVzICkgewoKCQkJc3RhdGUuZGlyZWN0aW9uYWwubGVuZ3RoID0gZGlyZWN0aW9uYWxMZW5ndGg7CgkJCXN0YXRlLnNwb3QubGVuZ3RoID0gc3BvdExlbmd0aDsKCQkJc3RhdGUucmVjdEFyZWEubGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CgkJCXN0YXRlLnBvaW50Lmxlbmd0aCA9IHBvaW50TGVuZ3RoOwoJCQlzdGF0ZS5oZW1pLmxlbmd0aCA9IGhlbWlMZW5ndGg7CgoJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvdy5sZW5ndGggPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CgkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwLmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKCQkJc3RhdGUucG9pbnRTaGFkb3cubGVuZ3RoID0gbnVtUG9pbnRTaGFkb3dzOwoJCQlzdGF0ZS5wb2ludFNoYWRvd01hcC5sZW5ndGggPSBudW1Qb2ludFNoYWRvd3M7CgkJCXN0YXRlLnNwb3RTaGFkb3cubGVuZ3RoID0gbnVtU3BvdFNoYWRvd3M7CgkJCXN0YXRlLnNwb3RTaGFkb3dNYXAubGVuZ3RoID0gbnVtU3BvdFNoYWRvd3M7CgkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4Lmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKCQkJc3RhdGUucG9pbnRTaGFkb3dNYXRyaXgubGVuZ3RoID0gbnVtUG9pbnRTaGFkb3dzOwoJCQlzdGF0ZS5zcG90TGlnaHRNYXRyaXgubGVuZ3RoID0gbnVtU3BvdFNoYWRvd3MgKyBudW1TcG90TWFwcyAtIG51bVNwb3RTaGFkb3dzV2l0aE1hcHM7CgkJCXN0YXRlLnNwb3RMaWdodE1hcC5sZW5ndGggPSBudW1TcG90TWFwczsKCQkJc3RhdGUubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzID0gbnVtU3BvdFNoYWRvd3NXaXRoTWFwczsKCQkJc3RhdGUubnVtTGlnaHRQcm9iZXMgPSBudW1MaWdodFByb2JlczsKCgkJCWhhc2guZGlyZWN0aW9uYWxMZW5ndGggPSBkaXJlY3Rpb25hbExlbmd0aDsKCQkJaGFzaC5wb2ludExlbmd0aCA9IHBvaW50TGVuZ3RoOwoJCQloYXNoLnNwb3RMZW5ndGggPSBzcG90TGVuZ3RoOwoJCQloYXNoLnJlY3RBcmVhTGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CgkJCWhhc2guaGVtaUxlbmd0aCA9IGhlbWlMZW5ndGg7CgoJCQloYXNoLm51bURpcmVjdGlvbmFsU2hhZG93cyA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKCQkJaGFzaC5udW1Qb2ludFNoYWRvd3MgPSBudW1Qb2ludFNoYWRvd3M7CgkJCWhhc2gubnVtU3BvdFNoYWRvd3MgPSBudW1TcG90U2hhZG93czsKCQkJaGFzaC5udW1TcG90TWFwcyA9IG51bVNwb3RNYXBzOwoKCQkJaGFzaC5udW1MaWdodFByb2JlcyA9IG51bUxpZ2h0UHJvYmVzOwoKCQkJc3RhdGUudmVyc2lvbiA9IG5leHRWZXJzaW9uICsrOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldHVwVmlldyggbGlnaHRzLCBjYW1lcmEgKSB7CgoJCWxldCBkaXJlY3Rpb25hbExlbmd0aCA9IDA7CgkJbGV0IHBvaW50TGVuZ3RoID0gMDsKCQlsZXQgc3BvdExlbmd0aCA9IDA7CgkJbGV0IHJlY3RBcmVhTGVuZ3RoID0gMDsKCQlsZXQgaGVtaUxlbmd0aCA9IDA7CgoJCWNvbnN0IHZpZXdNYXRyaXggPSBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBsaWdodHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGxpZ2h0ID0gbGlnaHRzWyBpIF07CgoJCQlpZiAoIGxpZ2h0LmlzRGlyZWN0aW9uYWxMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLmRpcmVjdGlvbmFsWyBkaXJlY3Rpb25hbExlbmd0aCBdOwoKCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQl2ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQudGFyZ2V0Lm1hdHJpeFdvcmxkICk7CgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc3ViKCB2ZWN0b3IzICk7CgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKCB2aWV3TWF0cml4ICk7CgoJCQkJZGlyZWN0aW9uYWxMZW5ndGggKys7CgoJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1Nwb3RMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLnNwb3RbIHNwb3RMZW5ndGggXTsKCgkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJdmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnN1YiggdmVjdG9yMyApOwoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggdmlld01hdHJpeCApOwoKCQkJCXNwb3RMZW5ndGggKys7CgoJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1JlY3RBcmVhTGlnaHQgKSB7CgoJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5yZWN0QXJlYVsgcmVjdEFyZWFMZW5ndGggXTsKCgkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCgkJCQkvLyBleHRyYWN0IGxvY2FsIHJvdGF0aW9uIG9mIGxpZ2h0IHRvIGRlcml2ZSB3aWR0aC9oZWlnaHQgaGFsZiB2ZWN0b3JzCgkJCQltYXRyaXg0Mi5pZGVudGl0eSgpOwoJCQkJbWF0cml4NC5jb3B5KCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJbWF0cml4NC5wcmVtdWx0aXBseSggdmlld01hdHJpeCApOwoJCQkJbWF0cml4NDIuZXh0cmFjdFJvdGF0aW9uKCBtYXRyaXg0ICk7CgoJCQkJdW5pZm9ybXMuaGFsZldpZHRoLnNldCggbGlnaHQud2lkdGggKiAwLjUsIDAuMCwgMC4wICk7CgkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LnNldCggMC4wLCBsaWdodC5oZWlnaHQgKiAwLjUsIDAuMCApOwoKCQkJCXVuaWZvcm1zLmhhbGZXaWR0aC5hcHBseU1hdHJpeDQoIG1hdHJpeDQyICk7CgkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LmFwcGx5TWF0cml4NCggbWF0cml4NDIgKTsKCgkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUG9pbnRMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLnBvaW50WyBwb2ludExlbmd0aCBdOwoKCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCXVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCApOwoKCQkJCXBvaW50TGVuZ3RoICsrOwoKCQkJfSBlbHNlIGlmICggbGlnaHQuaXNIZW1pc3BoZXJlTGlnaHQgKSB7CgoJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5oZW1pWyBoZW1pTGVuZ3RoIF07CgoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi50cmFuc2Zvcm1EaXJlY3Rpb24oIHZpZXdNYXRyaXggKTsKCgkJCQloZW1pTGVuZ3RoICsrOwoKCQkJfQoKCQl9CgoJfQoKCXJldHVybiB7CgkJc2V0dXA6IHNldHVwLAoJCXNldHVwVmlldzogc2V0dXBWaWV3LAoJCXN0YXRlOiBzdGF0ZQoJfTsKCn0KCmZ1bmN0aW9uIFdlYkdMUmVuZGVyU3RhdGUoIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApIHsKCgljb25zdCBsaWdodHMgPSBuZXcgV2ViR0xMaWdodHMoIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApOwoKCWNvbnN0IGxpZ2h0c0FycmF5ID0gW107Cgljb25zdCBzaGFkb3dzQXJyYXkgPSBbXTsKCglmdW5jdGlvbiBpbml0KCkgewoKCQlsaWdodHNBcnJheS5sZW5ndGggPSAwOwoJCXNoYWRvd3NBcnJheS5sZW5ndGggPSAwOwoKCX0KCglmdW5jdGlvbiBwdXNoTGlnaHQoIGxpZ2h0ICkgewoKCQlsaWdodHNBcnJheS5wdXNoKCBsaWdodCApOwoKCX0KCglmdW5jdGlvbiBwdXNoU2hhZG93KCBzaGFkb3dMaWdodCApIHsKCgkJc2hhZG93c0FycmF5LnB1c2goIHNoYWRvd0xpZ2h0ICk7CgoJfQoKCWZ1bmN0aW9uIHNldHVwTGlnaHRzKCB1c2VMZWdhY3lMaWdodHMgKSB7CgoJCWxpZ2h0cy5zZXR1cCggbGlnaHRzQXJyYXksIHVzZUxlZ2FjeUxpZ2h0cyApOwoKCX0KCglmdW5jdGlvbiBzZXR1cExpZ2h0c1ZpZXcoIGNhbWVyYSApIHsKCgkJbGlnaHRzLnNldHVwVmlldyggbGlnaHRzQXJyYXksIGNhbWVyYSApOwoKCX0KCgljb25zdCBzdGF0ZSA9IHsKCQlsaWdodHNBcnJheTogbGlnaHRzQXJyYXksCgkJc2hhZG93c0FycmF5OiBzaGFkb3dzQXJyYXksCgoJCWxpZ2h0czogbGlnaHRzCgl9OwoKCXJldHVybiB7CgkJaW5pdDogaW5pdCwKCQlzdGF0ZTogc3RhdGUsCgkJc2V0dXBMaWdodHM6IHNldHVwTGlnaHRzLAoJCXNldHVwTGlnaHRzVmlldzogc2V0dXBMaWdodHNWaWV3LAoKCQlwdXNoTGlnaHQ6IHB1c2hMaWdodCwKCQlwdXNoU2hhZG93OiBwdXNoU2hhZG93Cgl9OwoKfQoKZnVuY3Rpb24gV2ViR0xSZW5kZXJTdGF0ZXMoIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApIHsKCglsZXQgcmVuZGVyU3RhdGVzID0gbmV3IFdlYWtNYXAoKTsKCglmdW5jdGlvbiBnZXQoIHNjZW5lLCByZW5kZXJDYWxsRGVwdGggPSAwICkgewoKCQljb25zdCByZW5kZXJTdGF0ZUFycmF5ID0gcmVuZGVyU3RhdGVzLmdldCggc2NlbmUgKTsKCQlsZXQgcmVuZGVyU3RhdGU7CgoJCWlmICggcmVuZGVyU3RhdGVBcnJheSA9PT0gdW5kZWZpbmVkICkgewoKCQkJcmVuZGVyU3RhdGUgPSBuZXcgV2ViR0xSZW5kZXJTdGF0ZSggZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzICk7CgkJCXJlbmRlclN0YXRlcy5zZXQoIHNjZW5lLCBbIHJlbmRlclN0YXRlIF0gKTsKCgkJfSBlbHNlIHsKCgkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IHJlbmRlclN0YXRlQXJyYXkubGVuZ3RoICkgewoKCQkJCXJlbmRlclN0YXRlID0gbmV3IFdlYkdMUmVuZGVyU3RhdGUoIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApOwoJCQkJcmVuZGVyU3RhdGVBcnJheS5wdXNoKCByZW5kZXJTdGF0ZSApOwoKCQkJfSBlbHNlIHsKCgkJCQlyZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlQXJyYXlbIHJlbmRlckNhbGxEZXB0aCBdOwoKCQkJfQoKCQl9CgoJCXJldHVybiByZW5kZXJTdGF0ZTsKCgl9CgoJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJcmVuZGVyU3RhdGVzID0gbmV3IFdlYWtNYXAoKTsKCgl9CgoJcmV0dXJuIHsKCQlnZXQ6IGdldCwKCQlkaXNwb3NlOiBkaXNwb3NlCgl9OwoKfQoKY2xhc3MgTWVzaERlcHRoTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgoJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNNZXNoRGVwdGhNYXRlcmlhbCA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdNZXNoRGVwdGhNYXRlcmlhbCc7CgoJCXRoaXMuZGVwdGhQYWNraW5nID0gQmFzaWNEZXB0aFBhY2tpbmc7CgoJCXRoaXMubWFwID0gbnVsbDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gbnVsbDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gMTsKCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSAwOwoKCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5kZXB0aFBhY2tpbmcgPSBzb3VyY2UuZGVwdGhQYWNraW5nOwoKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBNZXNoRGlzdGFuY2VNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc01lc2hEaXN0YW5jZU1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hEaXN0YW5jZU1hdGVyaWFsJzsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmFscGhhTWFwID0gbnVsbDsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNvbnN0IHZlcnRleCA9ICJ2b2lkIG1haW4oKSB7XG5cdGdsX1Bvc2l0aW9uID0gdmVjNCggcG9zaXRpb24sIDEuMCApO1xufSI7Cgpjb25zdCBmcmFnbWVudCA9ICJ1bmlmb3JtIHNhbXBsZXIyRCBzaGFkb3dfcGFzcztcbnVuaWZvcm0gdmVjMiByZXNvbHV0aW9uO1xudW5pZm9ybSBmbG9hdCByYWRpdXM7XG4jaW5jbHVkZSA8cGFja2luZz5cbnZvaWQgbWFpbigpIHtcblx0Y29uc3QgZmxvYXQgc2FtcGxlcyA9IGZsb2F0KCBWU01fU0FNUExFUyApO1xuXHRmbG9hdCBtZWFuID0gMC4wO1xuXHRmbG9hdCBzcXVhcmVkX21lYW4gPSAwLjA7XG5cdGZsb2F0IHV2U3RyaWRlID0gc2FtcGxlcyA8PSAxLjAgPyAwLjAgOiAyLjAgLyAoIHNhbXBsZXMgLSAxLjAgKTtcblx0ZmxvYXQgdXZTdGFydCA9IHNhbXBsZXMgPD0gMS4wID8gMC4wIDogLSAxLjA7XG5cdGZvciAoIGZsb2F0IGkgPSAwLjA7IGkgPCBzYW1wbGVzOyBpICsrICkge1xuXHRcdGZsb2F0IHV2T2Zmc2V0ID0gdXZTdGFydCArIGkgKiB1dlN0cmlkZTtcblx0XHQjaWZkZWYgSE9SSVpPTlRBTF9QQVNTXG5cdFx0XHR2ZWMyIGRpc3RyaWJ1dGlvbiA9IHVucGFja1JHQkFUbzJIYWxmKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIHV2T2Zmc2V0LCAwLjAgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRpc3RyaWJ1dGlvbi54O1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRpc3RyaWJ1dGlvbi55ICogZGlzdHJpYnV0aW9uLnkgKyBkaXN0cmlidXRpb24ueCAqIGRpc3RyaWJ1dGlvbi54O1xuXHRcdCNlbHNlXG5cdFx0XHRmbG9hdCBkZXB0aCA9IHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIDAuMCwgdXZPZmZzZXQgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRlcHRoO1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRlcHRoICogZGVwdGg7XG5cdFx0I2VuZGlmXG5cdH1cblx0bWVhbiA9IG1lYW4gLyBzYW1wbGVzO1xuXHRzcXVhcmVkX21lYW4gPSBzcXVhcmVkX21lYW4gLyBzYW1wbGVzO1xuXHRmbG9hdCBzdGRfZGV2ID0gc3FydCggc3F1YXJlZF9tZWFuIC0gbWVhbiAqIG1lYW4gKTtcblx0Z2xfRnJhZ0NvbG9yID0gcGFjazJIYWxmVG9SR0JBKCB2ZWMyKCBtZWFuLCBzdGRfZGV2ICkgKTtcbn0iOwoKZnVuY3Rpb24gV2ViR0xTaGFkb3dNYXAoIF9yZW5kZXJlciwgX29iamVjdHMsIF9jYXBhYmlsaXRpZXMgKSB7CgoJbGV0IF9mcnVzdHVtID0gbmV3IEZydXN0dW0oKTsKCgljb25zdCBfc2hhZG93TWFwU2l6ZSA9IG5ldyBWZWN0b3IyKCksCgkJX3ZpZXdwb3J0U2l6ZSA9IG5ldyBWZWN0b3IyKCksCgoJCV92aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCksCgoJCV9kZXB0aE1hdGVyaWFsID0gbmV3IE1lc2hEZXB0aE1hdGVyaWFsKCB7IGRlcHRoUGFja2luZzogUkdCQURlcHRoUGFja2luZyB9ICksCgkJX2Rpc3RhbmNlTWF0ZXJpYWwgPSBuZXcgTWVzaERpc3RhbmNlTWF0ZXJpYWwoKSwKCgkJX21hdGVyaWFsQ2FjaGUgPSB7fSwKCgkJX21heFRleHR1cmVTaXplID0gX2NhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZTsKCgljb25zdCBzaGFkb3dTaWRlID0geyBbIEZyb250U2lkZSBdOiBCYWNrU2lkZSwgWyBCYWNrU2lkZSBdOiBGcm9udFNpZGUsIFsgRG91YmxlU2lkZSBdOiBEb3VibGVTaWRlIH07CgoJY29uc3Qgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCggewoJCWRlZmluZXM6IHsKCQkJVlNNX1NBTVBMRVM6IDgKCQl9LAoJCXVuaWZvcm1zOiB7CgkJCXNoYWRvd19wYXNzOiB7IHZhbHVlOiBudWxsIH0sCgkJCXJlc29sdXRpb246IHsgdmFsdWU6IG5ldyBWZWN0b3IyKCkgfSwKCQkJcmFkaXVzOiB7IHZhbHVlOiA0LjAgfQoJCX0sCgoJCXZlcnRleFNoYWRlcjogdmVydGV4LAoJCWZyYWdtZW50U2hhZGVyOiBmcmFnbWVudAoKCX0gKTsKCgljb25zdCBzaGFkb3dNYXRlcmlhbEhvcml6b250YWwgPSBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLmNsb25lKCk7CglzaGFkb3dNYXRlcmlhbEhvcml6b250YWwuZGVmaW5lcy5IT1JJWk9OVEFMX1BBU1MgPSAxOwoKCWNvbnN0IGZ1bGxTY3JlZW5UcmkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCWZ1bGxTY3JlZW5Ucmkuc2V0QXR0cmlidXRlKAoJCSdwb3NpdGlvbicsCgkJbmV3IEJ1ZmZlckF0dHJpYnV0ZSgKCQkJbmV3IEZsb2F0MzJBcnJheSggWyAtIDEsIC0gMSwgMC41LCAzLCAtIDEsIDAuNSwgLSAxLCAzLCAwLjUgXSApLAoJCQkzCgkJKQoJKTsKCgljb25zdCBmdWxsU2NyZWVuTWVzaCA9IG5ldyBNZXNoKCBmdWxsU2NyZWVuVHJpLCBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsICk7CgoJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCXRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKCXRoaXMuYXV0b1VwZGF0ZSA9IHRydWU7Cgl0aGlzLm5lZWRzVXBkYXRlID0gZmFsc2U7CgoJdGhpcy50eXBlID0gUENGU2hhZG93TWFwOwoJbGV0IF9wcmV2aW91c1R5cGUgPSB0aGlzLnR5cGU7CgoJdGhpcy5yZW5kZXIgPSBmdW5jdGlvbiAoIGxpZ2h0cywgc2NlbmUsIGNhbWVyYSApIHsKCgkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCQlpZiAoIHNjb3BlLmF1dG9VcGRhdGUgPT09IGZhbHNlICYmIHNjb3BlLm5lZWRzVXBkYXRlID09PSBmYWxzZSApIHJldHVybjsKCgkJaWYgKCBsaWdodHMubGVuZ3RoID09PSAwICkgcmV0dXJuOwoKCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gX3JlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwoJCWNvbnN0IGFjdGl2ZUN1YmVGYWNlID0gX3JlbmRlcmVyLmdldEFjdGl2ZUN1YmVGYWNlKCk7CgkJY29uc3QgYWN0aXZlTWlwbWFwTGV2ZWwgPSBfcmVuZGVyZXIuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKTsKCgkJY29uc3QgX3N0YXRlID0gX3JlbmRlcmVyLnN0YXRlOwoKCQkvLyBTZXQgR0wgc3RhdGUgZm9yIGRlcHRoIG1hcC4KCQlfc3RhdGUuc2V0QmxlbmRpbmcoIE5vQmxlbmRpbmcgKTsKCQlfc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhciggMSwgMSwgMSwgMSApOwoJCV9zdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKCQlfc3RhdGUuc2V0U2Npc3NvclRlc3QoIGZhbHNlICk7CgoJCS8vIGNoZWNrIGZvciBzaGFkb3cgbWFwIHR5cGUgY2hhbmdlcwoKCQljb25zdCB0b1ZTTSA9ICggX3ByZXZpb3VzVHlwZSAhPT0gVlNNU2hhZG93TWFwICYmIHRoaXMudHlwZSA9PT0gVlNNU2hhZG93TWFwICk7CgkJY29uc3QgZnJvbVZTTSA9ICggX3ByZXZpb3VzVHlwZSA9PT0gVlNNU2hhZG93TWFwICYmIHRoaXMudHlwZSAhPT0gVlNNU2hhZG93TWFwICk7CgoJCS8vIHJlbmRlciBkZXB0aCBtYXAKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCWNvbnN0IGxpZ2h0ID0gbGlnaHRzWyBpIF07CgkJCWNvbnN0IHNoYWRvdyA9IGxpZ2h0LnNoYWRvdzsKCgkJCWlmICggc2hhZG93ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xTaGFkb3dNYXA6JywgbGlnaHQsICdoYXMgbm8gc2hhZG93LicgKTsKCQkJCWNvbnRpbnVlOwoKCQkJfQoKCQkJaWYgKCBzaGFkb3cuYXV0b1VwZGF0ZSA9PT0gZmFsc2UgJiYgc2hhZG93Lm5lZWRzVXBkYXRlID09PSBmYWxzZSApIGNvbnRpbnVlOwoKCQkJX3NoYWRvd01hcFNpemUuY29weSggc2hhZG93Lm1hcFNpemUgKTsKCgkJCWNvbnN0IHNoYWRvd0ZyYW1lRXh0ZW50cyA9IHNoYWRvdy5nZXRGcmFtZUV4dGVudHMoKTsKCgkJCV9zaGFkb3dNYXBTaXplLm11bHRpcGx5KCBzaGFkb3dGcmFtZUV4dGVudHMgKTsKCgkJCV92aWV3cG9ydFNpemUuY29weSggc2hhZG93Lm1hcFNpemUgKTsKCgkJCWlmICggX3NoYWRvd01hcFNpemUueCA+IF9tYXhUZXh0dXJlU2l6ZSB8fCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKCQkJCWlmICggX3NoYWRvd01hcFNpemUueCA+IF9tYXhUZXh0dXJlU2l6ZSApIHsKCgkJCQkJX3ZpZXdwb3J0U2l6ZS54ID0gTWF0aC5mbG9vciggX21heFRleHR1cmVTaXplIC8gc2hhZG93RnJhbWVFeHRlbnRzLnggKTsKCQkJCQlfc2hhZG93TWFwU2l6ZS54ID0gX3ZpZXdwb3J0U2l6ZS54ICogc2hhZG93RnJhbWVFeHRlbnRzLng7CgkJCQkJc2hhZG93Lm1hcFNpemUueCA9IF92aWV3cG9ydFNpemUueDsKCgkJCQl9CgoJCQkJaWYgKCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKCQkJCQlfdmlld3BvcnRTaXplLnkgPSBNYXRoLmZsb29yKCBfbWF4VGV4dHVyZVNpemUgLyBzaGFkb3dGcmFtZUV4dGVudHMueSApOwoJCQkJCV9zaGFkb3dNYXBTaXplLnkgPSBfdmlld3BvcnRTaXplLnkgKiBzaGFkb3dGcmFtZUV4dGVudHMueTsKCQkJCQlzaGFkb3cubWFwU2l6ZS55ID0gX3ZpZXdwb3J0U2l6ZS55OwoKCQkJCX0KCgkJCX0KCgkJCWlmICggc2hhZG93Lm1hcCA9PT0gbnVsbCB8fCB0b1ZTTSA9PT0gdHJ1ZSB8fCBmcm9tVlNNID09PSB0cnVlICkgewoKCQkJCWNvbnN0IHBhcnMgPSAoIHRoaXMudHlwZSAhPT0gVlNNU2hhZG93TWFwICkgPyB7IG1pbkZpbHRlcjogTmVhcmVzdEZpbHRlciwgbWFnRmlsdGVyOiBOZWFyZXN0RmlsdGVyIH0gOiB7fTsKCgkJCQlpZiAoIHNoYWRvdy5tYXAgIT09IG51bGwgKSB7CgoJCQkJCXNoYWRvdy5tYXAuZGlzcG9zZSgpOwoKCQkJCX0KCgkJCQlzaGFkb3cubWFwID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KCBfc2hhZG93TWFwU2l6ZS54LCBfc2hhZG93TWFwU2l6ZS55LCBwYXJzICk7CgkJCQlzaGFkb3cubWFwLnRleHR1cmUubmFtZSA9IGxpZ2h0Lm5hbWUgKyAnLnNoYWRvd01hcCc7CgoJCQkJc2hhZG93LmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgoJCQl9CgoJCQlfcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBzaGFkb3cubWFwICk7CgkJCV9yZW5kZXJlci5jbGVhcigpOwoKCQkJY29uc3Qgdmlld3BvcnRDb3VudCA9IHNoYWRvdy5nZXRWaWV3cG9ydENvdW50KCk7CgoJCQlmb3IgKCBsZXQgdnAgPSAwOyB2cCA8IHZpZXdwb3J0Q291bnQ7IHZwICsrICkgewoKCQkJCWNvbnN0IHZpZXdwb3J0ID0gc2hhZG93LmdldFZpZXdwb3J0KCB2cCApOwoKCQkJCV92aWV3cG9ydC5zZXQoCgkJCQkJX3ZpZXdwb3J0U2l6ZS54ICogdmlld3BvcnQueCwKCQkJCQlfdmlld3BvcnRTaXplLnkgKiB2aWV3cG9ydC55LAoJCQkJCV92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LnosCgkJCQkJX3ZpZXdwb3J0U2l6ZS55ICogdmlld3BvcnQudwoJCQkJKTsKCgkJCQlfc3RhdGUudmlld3BvcnQoIF92aWV3cG9ydCApOwoKCQkJCXNoYWRvdy51cGRhdGVNYXRyaWNlcyggbGlnaHQsIHZwICk7CgoJCQkJX2ZydXN0dW0gPSBzaGFkb3cuZ2V0RnJ1c3R1bSgpOwoKCQkJCXJlbmRlck9iamVjdCggc2NlbmUsIGNhbWVyYSwgc2hhZG93LmNhbWVyYSwgbGlnaHQsIHRoaXMudHlwZSApOwoKCQkJfQoKCQkJLy8gZG8gYmx1ciBwYXNzIGZvciBWU00KCgkJCWlmICggc2hhZG93LmlzUG9pbnRMaWdodFNoYWRvdyAhPT0gdHJ1ZSAmJiB0aGlzLnR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCgkJCQlWU01QYXNzKCBzaGFkb3csIGNhbWVyYSApOwoKCQkJfQoKCQkJc2hhZG93Lm5lZWRzVXBkYXRlID0gZmFsc2U7CgoJCX0KCgkJX3ByZXZpb3VzVHlwZSA9IHRoaXMudHlwZTsKCgkJc2NvcGUubmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgYWN0aXZlQ3ViZUZhY2UsIGFjdGl2ZU1pcG1hcExldmVsICk7CgoJfTsKCglmdW5jdGlvbiBWU01QYXNzKCBzaGFkb3csIGNhbWVyYSApIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSBfb2JqZWN0cy51cGRhdGUoIGZ1bGxTY3JlZW5NZXNoICk7CgoJCWlmICggc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5kZWZpbmVzLlZTTV9TQU1QTEVTICE9PSBzaGFkb3cuYmx1clNhbXBsZXMgKSB7CgoJCQlzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLmRlZmluZXMuVlNNX1NBTVBMRVMgPSBzaGFkb3cuYmx1clNhbXBsZXM7CgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC5kZWZpbmVzLlZTTV9TQU1QTEVTID0gc2hhZG93LmJsdXJTYW1wbGVzOwoKCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJaWYgKCBzaGFkb3cubWFwUGFzcyA9PT0gbnVsbCApIHsKCgkJCXNoYWRvdy5tYXBQYXNzID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KCBfc2hhZG93TWFwU2l6ZS54LCBfc2hhZG93TWFwU2l6ZS55ICk7CgoJCX0KCgkJLy8gdmVydGljYWwgcGFzcwoKCQlzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLnVuaWZvcm1zLnNoYWRvd19wYXNzLnZhbHVlID0gc2hhZG93Lm1hcC50ZXh0dXJlOwoJCXNoYWRvd01hdGVyaWFsVmVydGljYWwudW5pZm9ybXMucmVzb2x1dGlvbi52YWx1ZSA9IHNoYWRvdy5tYXBTaXplOwoJCXNoYWRvd01hdGVyaWFsVmVydGljYWwudW5pZm9ybXMucmFkaXVzLnZhbHVlID0gc2hhZG93LnJhZGl1czsKCQlfcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBzaGFkb3cubWFwUGFzcyApOwoJCV9yZW5kZXJlci5jbGVhcigpOwoJCV9yZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgbnVsbCwgZ2VvbWV0cnksIHNoYWRvd01hdGVyaWFsVmVydGljYWwsIGZ1bGxTY3JlZW5NZXNoLCBudWxsICk7CgoJCS8vIGhvcml6b250YWwgcGFzcwoKCQlzaGFkb3dNYXRlcmlhbEhvcml6b250YWwudW5pZm9ybXMuc2hhZG93X3Bhc3MudmFsdWUgPSBzaGFkb3cubWFwUGFzcy50ZXh0dXJlOwoJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5yZXNvbHV0aW9uLnZhbHVlID0gc2hhZG93Lm1hcFNpemU7CgkJc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLnVuaWZvcm1zLnJhZGl1cy52YWx1ZSA9IHNoYWRvdy5yYWRpdXM7CgkJX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldCggc2hhZG93Lm1hcCApOwoJCV9yZW5kZXJlci5jbGVhcigpOwoJCV9yZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgbnVsbCwgZ2VvbWV0cnksIHNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbCwgZnVsbFNjcmVlbk1lc2gsIG51bGwgKTsKCgl9CgoJZnVuY3Rpb24gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBtYXRlcmlhbCwgbGlnaHQsIHR5cGUgKSB7CgoJCWxldCByZXN1bHQgPSBudWxsOwoKCQljb25zdCBjdXN0b21NYXRlcmlhbCA9ICggbGlnaHQuaXNQb2ludExpZ2h0ID09PSB0cnVlICkgPyBvYmplY3QuY3VzdG9tRGlzdGFuY2VNYXRlcmlhbCA6IG9iamVjdC5jdXN0b21EZXB0aE1hdGVyaWFsOwoKCQlpZiAoIGN1c3RvbU1hdGVyaWFsICE9PSB1bmRlZmluZWQgKSB7CgoJCQlyZXN1bHQgPSBjdXN0b21NYXRlcmlhbDsKCgkJfSBlbHNlIHsKCgkJCXJlc3VsdCA9ICggbGlnaHQuaXNQb2ludExpZ2h0ID09PSB0cnVlICkgPyBfZGlzdGFuY2VNYXRlcmlhbCA6IF9kZXB0aE1hdGVyaWFsOwoKCQkJaWYgKCAoIF9yZW5kZXJlci5sb2NhbENsaXBwaW5nRW5hYmxlZCAmJiBtYXRlcmlhbC5jbGlwU2hhZG93cyA9PT0gdHJ1ZSAmJiBBcnJheS5pc0FycmF5KCBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lcyApICYmIG1hdGVyaWFsLmNsaXBwaW5nUGxhbmVzLmxlbmd0aCAhPT0gMCApIHx8CgkJCQkoIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCAmJiBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZSAhPT0gMCApIHx8CgkJCQkoIG1hdGVyaWFsLmFscGhhTWFwICYmIG1hdGVyaWFsLmFscGhhVGVzdCA+IDAgKSB8fAoJCQkJKCBtYXRlcmlhbC5tYXAgJiYgbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApICkgewoKCQkJCS8vIGluIHRoaXMgY2FzZSB3ZSBuZWVkIGEgdW5pcXVlIG1hdGVyaWFsIGluc3RhbmNlIHJlZmxlY3RpbmcgdGhlCgkJCQkvLyBhcHByb3ByaWF0ZSBzdGF0ZQoKCQkJCWNvbnN0IGtleUEgPSByZXN1bHQudXVpZCwga2V5QiA9IG1hdGVyaWFsLnV1aWQ7CgoJCQkJbGV0IG1hdGVyaWFsc0ZvclZhcmlhbnQgPSBfbWF0ZXJpYWxDYWNoZVsga2V5QSBdOwoKCQkJCWlmICggbWF0ZXJpYWxzRm9yVmFyaWFudCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQltYXRlcmlhbHNGb3JWYXJpYW50ID0ge307CgkJCQkJX21hdGVyaWFsQ2FjaGVbIGtleUEgXSA9IG1hdGVyaWFsc0ZvclZhcmlhbnQ7CgoJCQkJfQoKCQkJCWxldCBjYWNoZWRNYXRlcmlhbCA9IG1hdGVyaWFsc0ZvclZhcmlhbnRbIGtleUIgXTsKCgkJCQlpZiAoIGNhY2hlZE1hdGVyaWFsID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNhY2hlZE1hdGVyaWFsID0gcmVzdWx0LmNsb25lKCk7CgkJCQkJbWF0ZXJpYWxzRm9yVmFyaWFudFsga2V5QiBdID0gY2FjaGVkTWF0ZXJpYWw7CgkJCQkJbWF0ZXJpYWwuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbk1hdGVyaWFsRGlzcG9zZSApOwoKCQkJCX0KCgkJCQlyZXN1bHQgPSBjYWNoZWRNYXRlcmlhbDsKCgkJCX0KCgkJfQoKCQlyZXN1bHQudmlzaWJsZSA9IG1hdGVyaWFsLnZpc2libGU7CgkJcmVzdWx0LndpcmVmcmFtZSA9IG1hdGVyaWFsLndpcmVmcmFtZTsKCgkJaWYgKCB0eXBlID09PSBWU01TaGFkb3dNYXAgKSB7CgoJCQlyZXN1bHQuc2lkZSA9ICggbWF0ZXJpYWwuc2hhZG93U2lkZSAhPT0gbnVsbCApID8gbWF0ZXJpYWwuc2hhZG93U2lkZSA6IG1hdGVyaWFsLnNpZGU7CgoJCX0gZWxzZSB7CgoJCQlyZXN1bHQuc2lkZSA9ICggbWF0ZXJpYWwuc2hhZG93U2lkZSAhPT0gbnVsbCApID8gbWF0ZXJpYWwuc2hhZG93U2lkZSA6IHNoYWRvd1NpZGVbIG1hdGVyaWFsLnNpZGUgXTsKCgkJfQoKCQlyZXN1bHQuYWxwaGFNYXAgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCQlyZXN1bHQuYWxwaGFUZXN0ID0gbWF0ZXJpYWwuYWxwaGFUZXN0OwoJCXJlc3VsdC5tYXAgPSBtYXRlcmlhbC5tYXA7CgoJCXJlc3VsdC5jbGlwU2hhZG93cyA9IG1hdGVyaWFsLmNsaXBTaGFkb3dzOwoJCXJlc3VsdC5jbGlwcGluZ1BsYW5lcyA9IG1hdGVyaWFsLmNsaXBwaW5nUGxhbmVzOwoJCXJlc3VsdC5jbGlwSW50ZXJzZWN0aW9uID0gbWF0ZXJpYWwuY2xpcEludGVyc2VjdGlvbjsKCgkJcmVzdWx0LmRpc3BsYWNlbWVudE1hcCA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCQlyZXN1bHQuZGlzcGxhY2VtZW50U2NhbGUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZTsKCQlyZXN1bHQuZGlzcGxhY2VtZW50QmlhcyA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgoJCXJlc3VsdC53aXJlZnJhbWVMaW5ld2lkdGggPSBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGg7CgkJcmVzdWx0LmxpbmV3aWR0aCA9IG1hdGVyaWFsLmxpbmV3aWR0aDsKCgkJaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgPT09IHRydWUgJiYgcmVzdWx0LmlzTWVzaERpc3RhbmNlTWF0ZXJpYWwgPT09IHRydWUgKSB7CgoJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBfcmVuZGVyZXIucHJvcGVydGllcy5nZXQoIHJlc3VsdCApOwoJCQltYXRlcmlhbFByb3BlcnRpZXMubGlnaHQgPSBsaWdodDsKCgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoKCX0KCglmdW5jdGlvbiByZW5kZXJPYmplY3QoIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGxpZ2h0LCB0eXBlICkgewoKCQlpZiAoIG9iamVjdC52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCgkJY29uc3QgdmlzaWJsZSA9IG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApOwoKCQlpZiAoIHZpc2libGUgJiYgKCBvYmplY3QuaXNNZXNoIHx8IG9iamVjdC5pc0xpbmUgfHwgb2JqZWN0LmlzUG9pbnRzICkgKSB7CgoJCQlpZiAoICggb2JqZWN0LmNhc3RTaGFkb3cgfHwgKCBvYmplY3QucmVjZWl2ZVNoYWRvdyAmJiB0eXBlID09PSBWU01TaGFkb3dNYXAgKSApICYmICggISBvYmplY3QuZnJ1c3R1bUN1bGxlZCB8fCBfZnJ1c3R1bS5pbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSApICkgewoKCQkJCW9iamVjdC5tb2RlbFZpZXdNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggc2hhZG93Q2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSwgb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgoJCQkJY29uc3QgZ2VvbWV0cnkgPSBfb2JqZWN0cy51cGRhdGUoIG9iamVjdCApOwoJCQkJY29uc3QgbWF0ZXJpYWwgPSBvYmplY3QubWF0ZXJpYWw7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQljb25zdCBncm91cHMgPSBnZW9tZXRyeS5ncm91cHM7CgoJCQkJCWZvciAoIGxldCBrID0gMCwga2wgPSBncm91cHMubGVuZ3RoOyBrIDwga2w7IGsgKysgKSB7CgoJCQkJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgayBdOwoJCQkJCQljb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbIGdyb3VwLm1hdGVyaWFsSW5kZXggXTsKCgkJCQkJCWlmICggZ3JvdXBNYXRlcmlhbCAmJiBncm91cE1hdGVyaWFsLnZpc2libGUgKSB7CgoJCQkJCQkJY29uc3QgZGVwdGhNYXRlcmlhbCA9IGdldERlcHRoTWF0ZXJpYWwoIG9iamVjdCwgZ3JvdXBNYXRlcmlhbCwgbGlnaHQsIHR5cGUgKTsKCgkJCQkJCQlvYmplY3Qub25CZWZvcmVTaGFkb3coIF9yZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIGdyb3VwICk7CgoJCQkJCQkJX3JlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdCggc2hhZG93Q2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKCQkJCQkJCW9iamVjdC5vbkFmdGVyU2hhZG93KCBfcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJY29uc3QgZGVwdGhNYXRlcmlhbCA9IGdldERlcHRoTWF0ZXJpYWwoIG9iamVjdCwgbWF0ZXJpYWwsIGxpZ2h0LCB0eXBlICk7CgoJCQkJCW9iamVjdC5vbkJlZm9yZVNoYWRvdyggX3JlbmRlcmVyLCBvYmplY3QsIGNhbWVyYSwgc2hhZG93Q2FtZXJhLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgbnVsbCApOwoKCQkJCQlfcmVuZGVyZXIucmVuZGVyQnVmZmVyRGlyZWN0KCBzaGFkb3dDYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBvYmplY3QsIG51bGwgKTsKCgkJCQkJb2JqZWN0Lm9uQWZ0ZXJTaGFkb3coIF9yZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIG51bGwgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJY29uc3QgY2hpbGRyZW4gPSBvYmplY3QuY2hpbGRyZW47CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQlyZW5kZXJPYmplY3QoIGNoaWxkcmVuWyBpIF0sIGNhbWVyYSwgc2hhZG93Q2FtZXJhLCBsaWdodCwgdHlwZSApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIG9uTWF0ZXJpYWxEaXNwb3NlKCBldmVudCApIHsKCgkJY29uc3QgbWF0ZXJpYWwgPSBldmVudC50YXJnZXQ7CgoJCW1hdGVyaWFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCgkJLy8gbWFrZSBzdXJlIHRvIHJlbW92ZSB0aGUgdW5pcXVlIGRpc3RhbmNlL2RlcHRoIG1hdGVyaWFscyB1c2VkIGZvciBzaGFkb3cgbWFwIHJlbmRlcmluZwoKCQlmb3IgKCBjb25zdCBpZCBpbiBfbWF0ZXJpYWxDYWNoZSApIHsKCgkJCWNvbnN0IGNhY2hlID0gX21hdGVyaWFsQ2FjaGVbIGlkIF07CgoJCQljb25zdCB1dWlkID0gZXZlbnQudGFyZ2V0LnV1aWQ7CgoJCQlpZiAoIHV1aWQgaW4gY2FjaGUgKSB7CgoJCQkJY29uc3Qgc2hhZG93TWF0ZXJpYWwgPSBjYWNoZVsgdXVpZCBdOwoJCQkJc2hhZG93TWF0ZXJpYWwuZGlzcG9zZSgpOwoJCQkJZGVsZXRlIGNhY2hlWyB1dWlkIF07CgoJCQl9CgoJCX0KCgl9Cgp9CgpmdW5jdGlvbiBXZWJHTFN0YXRlKCBnbCwgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzICkgewoKCWNvbnN0IGlzV2ViR0wyID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyOwoKCWZ1bmN0aW9uIENvbG9yQnVmZmVyKCkgewoKCQlsZXQgbG9ja2VkID0gZmFsc2U7CgoJCWNvbnN0IGNvbG9yID0gbmV3IFZlY3RvcjQoKTsKCQlsZXQgY3VycmVudENvbG9yTWFzayA9IG51bGw7CgkJY29uc3QgY3VycmVudENvbG9yQ2xlYXIgPSBuZXcgVmVjdG9yNCggMCwgMCwgMCwgMCApOwoKCQlyZXR1cm4gewoKCQkJc2V0TWFzazogZnVuY3Rpb24gKCBjb2xvck1hc2sgKSB7CgoJCQkJaWYgKCBjdXJyZW50Q29sb3JNYXNrICE9PSBjb2xvck1hc2sgJiYgISBsb2NrZWQgKSB7CgoJCQkJCWdsLmNvbG9yTWFzayggY29sb3JNYXNrLCBjb2xvck1hc2ssIGNvbG9yTWFzaywgY29sb3JNYXNrICk7CgkJCQkJY3VycmVudENvbG9yTWFzayA9IGNvbG9yTWFzazsKCgkJCQl9CgoJCQl9LAoKCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJbG9ja2VkID0gbG9jazsKCgkJCX0sCgoJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCByLCBnLCBiLCBhLCBwcmVtdWx0aXBsaWVkQWxwaGEgKSB7CgoJCQkJaWYgKCBwcmVtdWx0aXBsaWVkQWxwaGEgPT09IHRydWUgKSB7CgoJCQkJCXIgKj0gYTsgZyAqPSBhOyBiICo9IGE7CgoJCQkJfQoKCQkJCWNvbG9yLnNldCggciwgZywgYiwgYSApOwoKCQkJCWlmICggY3VycmVudENvbG9yQ2xlYXIuZXF1YWxzKCBjb2xvciApID09PSBmYWxzZSApIHsKCgkJCQkJZ2wuY2xlYXJDb2xvciggciwgZywgYiwgYSApOwoJCQkJCWN1cnJlbnRDb2xvckNsZWFyLmNvcHkoIGNvbG9yICk7CgoJCQkJfQoKCQkJfSwKCgkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJbG9ja2VkID0gZmFsc2U7CgoJCQkJY3VycmVudENvbG9yTWFzayA9IG51bGw7CgkJCQljdXJyZW50Q29sb3JDbGVhci5zZXQoIC0gMSwgMCwgMCwgMCApOyAvLyBzZXQgdG8gaW52YWxpZCBzdGF0ZQoKCQkJfQoKCQl9OwoKCX0KCglmdW5jdGlvbiBEZXB0aEJ1ZmZlcigpIHsKCgkJbGV0IGxvY2tlZCA9IGZhbHNlOwoKCQlsZXQgY3VycmVudERlcHRoTWFzayA9IG51bGw7CgkJbGV0IGN1cnJlbnREZXB0aEZ1bmMgPSBudWxsOwoJCWxldCBjdXJyZW50RGVwdGhDbGVhciA9IG51bGw7CgoJCXJldHVybiB7CgoJCQlzZXRUZXN0OiBmdW5jdGlvbiAoIGRlcHRoVGVzdCApIHsKCgkJCQlpZiAoIGRlcHRoVGVzdCApIHsKCgkJCQkJZW5hYmxlKCBnbC5ERVBUSF9URVNUICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJZGlzYWJsZSggZ2wuREVQVEhfVEVTVCApOwoKCQkJCX0KCgkJCX0sCgoJCQlzZXRNYXNrOiBmdW5jdGlvbiAoIGRlcHRoTWFzayApIHsKCgkJCQlpZiAoIGN1cnJlbnREZXB0aE1hc2sgIT09IGRlcHRoTWFzayAmJiAhIGxvY2tlZCApIHsKCgkJCQkJZ2wuZGVwdGhNYXNrKCBkZXB0aE1hc2sgKTsKCQkJCQljdXJyZW50RGVwdGhNYXNrID0gZGVwdGhNYXNrOwoKCQkJCX0KCgkJCX0sCgoJCQlzZXRGdW5jOiBmdW5jdGlvbiAoIGRlcHRoRnVuYyApIHsKCgkJCQlpZiAoIGN1cnJlbnREZXB0aEZ1bmMgIT09IGRlcHRoRnVuYyApIHsKCgkJCQkJc3dpdGNoICggZGVwdGhGdW5jICkgewoKCQkJCQkJY2FzZSBOZXZlckRlcHRoOgoKCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuTkVWRVIgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBBbHdheXNEZXB0aDoKCgkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkFMV0FZUyApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIExlc3NEZXB0aDoKCgkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFU1MgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBMZXNzRXF1YWxEZXB0aDoKCgkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFUVVBTCApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIEVxdWFsRGVwdGg6CgoJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5FUVVBTCApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIEdyZWF0ZXJFcXVhbERlcHRoOgoKCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuR0VRVUFMICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgR3JlYXRlckRlcHRoOgoKCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuR1JFQVRFUiApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIE5vdEVxdWFsRGVwdGg6CgoJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5OT1RFUVVBTCApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQlkZWZhdWx0OgoKCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuTEVRVUFMICk7CgoJCQkJCX0KCgkJCQkJY3VycmVudERlcHRoRnVuYyA9IGRlcHRoRnVuYzsKCgkJCQl9CgoJCQl9LAoKCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJbG9ja2VkID0gbG9jazsKCgkJCX0sCgoJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCBkZXB0aCApIHsKCgkJCQlpZiAoIGN1cnJlbnREZXB0aENsZWFyICE9PSBkZXB0aCApIHsKCgkJCQkJZ2wuY2xlYXJEZXB0aCggZGVwdGggKTsKCQkJCQljdXJyZW50RGVwdGhDbGVhciA9IGRlcHRoOwoKCQkJCX0KCgkJCX0sCgoJCQlyZXNldDogZnVuY3Rpb24gKCkgewoKCQkJCWxvY2tlZCA9IGZhbHNlOwoKCQkJCWN1cnJlbnREZXB0aE1hc2sgPSBudWxsOwoJCQkJY3VycmVudERlcHRoRnVuYyA9IG51bGw7CgkJCQljdXJyZW50RGVwdGhDbGVhciA9IG51bGw7CgoJCQl9CgoJCX07CgoJfQoKCWZ1bmN0aW9uIFN0ZW5jaWxCdWZmZXIoKSB7CgoJCWxldCBsb2NrZWQgPSBmYWxzZTsKCgkJbGV0IGN1cnJlbnRTdGVuY2lsTWFzayA9IG51bGw7CgkJbGV0IGN1cnJlbnRTdGVuY2lsRnVuYyA9IG51bGw7CgkJbGV0IGN1cnJlbnRTdGVuY2lsUmVmID0gbnVsbDsKCQlsZXQgY3VycmVudFN0ZW5jaWxGdW5jTWFzayA9IG51bGw7CgkJbGV0IGN1cnJlbnRTdGVuY2lsRmFpbCA9IG51bGw7CgkJbGV0IGN1cnJlbnRTdGVuY2lsWkZhaWwgPSBudWxsOwoJCWxldCBjdXJyZW50U3RlbmNpbFpQYXNzID0gbnVsbDsKCQlsZXQgY3VycmVudFN0ZW5jaWxDbGVhciA9IG51bGw7CgoJCXJldHVybiB7CgoJCQlzZXRUZXN0OiBmdW5jdGlvbiAoIHN0ZW5jaWxUZXN0ICkgewoKCQkJCWlmICggISBsb2NrZWQgKSB7CgoJCQkJCWlmICggc3RlbmNpbFRlc3QgKSB7CgoJCQkJCQllbmFibGUoIGdsLlNURU5DSUxfVEVTVCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZGlzYWJsZSggZ2wuU1RFTkNJTF9URVNUICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9LAoKCQkJc2V0TWFzazogZnVuY3Rpb24gKCBzdGVuY2lsTWFzayApIHsKCgkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsTWFzayAhPT0gc3RlbmNpbE1hc2sgJiYgISBsb2NrZWQgKSB7CgoJCQkJCWdsLnN0ZW5jaWxNYXNrKCBzdGVuY2lsTWFzayApOwoJCQkJCWN1cnJlbnRTdGVuY2lsTWFzayA9IHN0ZW5jaWxNYXNrOwoKCQkJCX0KCgkJCX0sCgoJCQlzZXRGdW5jOiBmdW5jdGlvbiAoIHN0ZW5jaWxGdW5jLCBzdGVuY2lsUmVmLCBzdGVuY2lsTWFzayApIHsKCgkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsRnVuYyAhPT0gc3RlbmNpbEZ1bmMgfHwKCQkJCSAgICAgY3VycmVudFN0ZW5jaWxSZWYgIT09IHN0ZW5jaWxSZWYgfHwKCQkJCSAgICAgY3VycmVudFN0ZW5jaWxGdW5jTWFzayAhPT0gc3RlbmNpbE1hc2sgKSB7CgoJCQkJCWdsLnN0ZW5jaWxGdW5jKCBzdGVuY2lsRnVuYywgc3RlbmNpbFJlZiwgc3RlbmNpbE1hc2sgKTsKCgkJCQkJY3VycmVudFN0ZW5jaWxGdW5jID0gc3RlbmNpbEZ1bmM7CgkJCQkJY3VycmVudFN0ZW5jaWxSZWYgPSBzdGVuY2lsUmVmOwoJCQkJCWN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBzdGVuY2lsTWFzazsKCgkJCQl9CgoJCQl9LAoKCQkJc2V0T3A6IGZ1bmN0aW9uICggc3RlbmNpbEZhaWwsIHN0ZW5jaWxaRmFpbCwgc3RlbmNpbFpQYXNzICkgewoKCQkJCWlmICggY3VycmVudFN0ZW5jaWxGYWlsICE9PSBzdGVuY2lsRmFpbCB8fAoJCQkJICAgICBjdXJyZW50U3RlbmNpbFpGYWlsICE9PSBzdGVuY2lsWkZhaWwgfHwKCQkJCSAgICAgY3VycmVudFN0ZW5jaWxaUGFzcyAhPT0gc3RlbmNpbFpQYXNzICkgewoKCQkJCQlnbC5zdGVuY2lsT3AoIHN0ZW5jaWxGYWlsLCBzdGVuY2lsWkZhaWwsIHN0ZW5jaWxaUGFzcyApOwoKCQkJCQljdXJyZW50U3RlbmNpbEZhaWwgPSBzdGVuY2lsRmFpbDsKCQkJCQljdXJyZW50U3RlbmNpbFpGYWlsID0gc3RlbmNpbFpGYWlsOwoJCQkJCWN1cnJlbnRTdGVuY2lsWlBhc3MgPSBzdGVuY2lsWlBhc3M7CgoJCQkJfQoKCQkJfSwKCgkJCXNldExvY2tlZDogZnVuY3Rpb24gKCBsb2NrICkgewoKCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQl9LAoKCQkJc2V0Q2xlYXI6IGZ1bmN0aW9uICggc3RlbmNpbCApIHsKCgkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsQ2xlYXIgIT09IHN0ZW5jaWwgKSB7CgoJCQkJCWdsLmNsZWFyU3RlbmNpbCggc3RlbmNpbCApOwoJCQkJCWN1cnJlbnRTdGVuY2lsQ2xlYXIgPSBzdGVuY2lsOwoKCQkJCX0KCgkJCX0sCgoJCQlyZXNldDogZnVuY3Rpb24gKCkgewoKCQkJCWxvY2tlZCA9IGZhbHNlOwoKCQkJCWN1cnJlbnRTdGVuY2lsTWFzayA9IG51bGw7CgkJCQljdXJyZW50U3RlbmNpbEZ1bmMgPSBudWxsOwoJCQkJY3VycmVudFN0ZW5jaWxSZWYgPSBudWxsOwoJCQkJY3VycmVudFN0ZW5jaWxGdW5jTWFzayA9IG51bGw7CgkJCQljdXJyZW50U3RlbmNpbEZhaWwgPSBudWxsOwoJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IG51bGw7CgkJCQljdXJyZW50U3RlbmNpbFpQYXNzID0gbnVsbDsKCQkJCWN1cnJlbnRTdGVuY2lsQ2xlYXIgPSBudWxsOwoKCQkJfQoKCQl9OwoKCX0KCgkvLwoKCWNvbnN0IGNvbG9yQnVmZmVyID0gbmV3IENvbG9yQnVmZmVyKCk7Cgljb25zdCBkZXB0aEJ1ZmZlciA9IG5ldyBEZXB0aEJ1ZmZlcigpOwoJY29uc3Qgc3RlbmNpbEJ1ZmZlciA9IG5ldyBTdGVuY2lsQnVmZmVyKCk7CgoJY29uc3QgdWJvQmluZGluZ3MgPSBuZXcgV2Vha01hcCgpOwoJY29uc3QgdWJvUHJvZ3JhbU1hcCA9IG5ldyBXZWFrTWFwKCk7CgoJbGV0IGVuYWJsZWRDYXBhYmlsaXRpZXMgPSB7fTsKCglsZXQgY3VycmVudEJvdW5kRnJhbWVidWZmZXJzID0ge307CglsZXQgY3VycmVudERyYXdidWZmZXJzID0gbmV3IFdlYWtNYXAoKTsKCWxldCBkZWZhdWx0RHJhd2J1ZmZlcnMgPSBbXTsKCglsZXQgY3VycmVudFByb2dyYW0gPSBudWxsOwoKCWxldCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID0gZmFsc2U7CglsZXQgY3VycmVudEJsZW5kaW5nID0gbnVsbDsKCWxldCBjdXJyZW50QmxlbmRFcXVhdGlvbiA9IG51bGw7CglsZXQgY3VycmVudEJsZW5kU3JjID0gbnVsbDsKCWxldCBjdXJyZW50QmxlbmREc3QgPSBudWxsOwoJbGV0IGN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgPSBudWxsOwoJbGV0IGN1cnJlbnRCbGVuZFNyY0FscGhhID0gbnVsbDsKCWxldCBjdXJyZW50QmxlbmREc3RBbHBoYSA9IG51bGw7CglsZXQgY3VycmVudEJsZW5kQ29sb3IgPSBuZXcgQ29sb3IoIDAsIDAsIDAgKTsKCWxldCBjdXJyZW50QmxlbmRBbHBoYSA9IDA7CglsZXQgY3VycmVudFByZW11bHRpcGxlZEFscGhhID0gZmFsc2U7CgoJbGV0IGN1cnJlbnRGbGlwU2lkZWQgPSBudWxsOwoJbGV0IGN1cnJlbnRDdWxsRmFjZSA9IG51bGw7CgoJbGV0IGN1cnJlbnRMaW5lV2lkdGggPSBudWxsOwoKCWxldCBjdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IG51bGw7CglsZXQgY3VycmVudFBvbHlnb25PZmZzZXRVbml0cyA9IG51bGw7CgoJY29uc3QgbWF4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9DT01CSU5FRF9URVhUVVJFX0lNQUdFX1VOSVRTICk7CgoJbGV0IGxpbmVXaWR0aEF2YWlsYWJsZSA9IGZhbHNlOwoJbGV0IHZlcnNpb24gPSAwOwoJY29uc3QgZ2xWZXJzaW9uID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5WRVJTSU9OICk7CgoJaWYgKCBnbFZlcnNpb24uaW5kZXhPZiggJ1dlYkdMJyApICE9PSAtIDEgKSB7CgoJCXZlcnNpb24gPSBwYXJzZUZsb2F0KCAvXldlYkdMIChcZCkvLmV4ZWMoIGdsVmVyc2lvbiApWyAxIF0gKTsKCQlsaW5lV2lkdGhBdmFpbGFibGUgPSAoIHZlcnNpb24gPj0gMS4wICk7CgoJfSBlbHNlIGlmICggZ2xWZXJzaW9uLmluZGV4T2YoICdPcGVuR0wgRVMnICkgIT09IC0gMSApIHsKCgkJdmVyc2lvbiA9IHBhcnNlRmxvYXQoIC9eT3BlbkdMIEVTIChcZCkvLmV4ZWMoIGdsVmVyc2lvbiApWyAxIF0gKTsKCQlsaW5lV2lkdGhBdmFpbGFibGUgPSAoIHZlcnNpb24gPj0gMi4wICk7CgoJfQoKCWxldCBjdXJyZW50VGV4dHVyZVNsb3QgPSBudWxsOwoJbGV0IGN1cnJlbnRCb3VuZFRleHR1cmVzID0ge307CgoJY29uc3Qgc2Npc3NvclBhcmFtID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5TQ0lTU09SX0JPWCApOwoJY29uc3Qgdmlld3BvcnRQYXJhbSA9IGdsLmdldFBhcmFtZXRlciggZ2wuVklFV1BPUlQgKTsKCgljb25zdCBjdXJyZW50U2Npc3NvciA9IG5ldyBWZWN0b3I0KCkuZnJvbUFycmF5KCBzY2lzc29yUGFyYW0gKTsKCWNvbnN0IGN1cnJlbnRWaWV3cG9ydCA9IG5ldyBWZWN0b3I0KCkuZnJvbUFycmF5KCB2aWV3cG9ydFBhcmFtICk7CgoJZnVuY3Rpb24gY3JlYXRlVGV4dHVyZSggdHlwZSwgdGFyZ2V0LCBjb3VudCwgZGltZW5zaW9ucyApIHsKCgkJY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KCA0ICk7IC8vIDQgaXMgcmVxdWlyZWQgdG8gbWF0Y2ggZGVmYXVsdCB1bnBhY2sgYWxpZ25tZW50IG9mIDQuCgkJY29uc3QgdGV4dHVyZSA9IGdsLmNyZWF0ZVRleHR1cmUoKTsKCgkJZ2wuYmluZFRleHR1cmUoIHR5cGUsIHRleHR1cmUgKTsKCQlnbC50ZXhQYXJhbWV0ZXJpKCB0eXBlLCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QgKTsKCQlnbC50ZXhQYXJhbWV0ZXJpKCB0eXBlLCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLk5FQVJFU1QgKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKysgKSB7CgoJCQlpZiAoIGlzV2ViR0wyICYmICggdHlwZSA9PT0gZ2wuVEVYVFVSRV8zRCB8fCB0eXBlID09PSBnbC5URVhUVVJFXzJEX0FSUkFZICkgKSB7CgoJCQkJZ2wudGV4SW1hZ2UzRCggdGFyZ2V0LCAwLCBnbC5SR0JBLCAxLCAxLCBkaW1lbnNpb25zLCAwLCBnbC5SR0JBLCBnbC5VTlNJR05FRF9CWVRFLCBkYXRhICk7CgoJCQl9IGVsc2UgewoKCQkJCWdsLnRleEltYWdlMkQoIHRhcmdldCArIGksIDAsIGdsLlJHQkEsIDEsIDEsIDAsIGdsLlJHQkEsIGdsLlVOU0lHTkVEX0JZVEUsIGRhdGEgKTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdGV4dHVyZTsKCgl9CgoJY29uc3QgZW1wdHlUZXh0dXJlcyA9IHt9OwoJZW1wdHlUZXh0dXJlc1sgZ2wuVEVYVFVSRV8yRCBdID0gY3JlYXRlVGV4dHVyZSggZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV8yRCwgMSApOwoJZW1wdHlUZXh0dXJlc1sgZ2wuVEVYVFVSRV9DVUJFX01BUCBdID0gY3JlYXRlVGV4dHVyZSggZ2wuVEVYVFVSRV9DVUJFX01BUCwgZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YLCA2ICk7CgoJaWYgKCBpc1dlYkdMMiApIHsKCgkJZW1wdHlUZXh0dXJlc1sgZ2wuVEVYVFVSRV8yRF9BUlJBWSBdID0gY3JlYXRlVGV4dHVyZSggZ2wuVEVYVFVSRV8yRF9BUlJBWSwgZ2wuVEVYVFVSRV8yRF9BUlJBWSwgMSwgMSApOwoJCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfM0QgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfM0QsIGdsLlRFWFRVUkVfM0QsIDEsIDEgKTsKCgl9CgoJLy8gaW5pdAoKCWNvbG9yQnVmZmVyLnNldENsZWFyKCAwLCAwLCAwLCAxICk7CglkZXB0aEJ1ZmZlci5zZXRDbGVhciggMSApOwoJc3RlbmNpbEJ1ZmZlci5zZXRDbGVhciggMCApOwoKCWVuYWJsZSggZ2wuREVQVEhfVEVTVCApOwoJZGVwdGhCdWZmZXIuc2V0RnVuYyggTGVzc0VxdWFsRGVwdGggKTsKCglzZXRGbGlwU2lkZWQoIGZhbHNlICk7CglzZXRDdWxsRmFjZSggQ3VsbEZhY2VCYWNrICk7CgllbmFibGUoIGdsLkNVTExfRkFDRSApOwoKCXNldEJsZW5kaW5nKCBOb0JsZW5kaW5nICk7CgoJLy8KCglmdW5jdGlvbiBlbmFibGUoIGlkICkgewoKCQlpZiAoIGVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gIT09IHRydWUgKSB7CgoJCQlnbC5lbmFibGUoIGlkICk7CgkJCWVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gPSB0cnVlOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIGRpc2FibGUoIGlkICkgewoKCQlpZiAoIGVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gIT09IGZhbHNlICkgewoKCQkJZ2wuZGlzYWJsZSggaWQgKTsKCQkJZW5hYmxlZENhcGFiaWxpdGllc1sgaWQgXSA9IGZhbHNlOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIGJpbmRGcmFtZWJ1ZmZlciggdGFyZ2V0LCBmcmFtZWJ1ZmZlciApIHsKCgkJaWYgKCBjdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbIHRhcmdldCBdICE9PSBmcmFtZWJ1ZmZlciApIHsKCgkJCWdsLmJpbmRGcmFtZWJ1ZmZlciggdGFyZ2V0LCBmcmFtZWJ1ZmZlciApOwoKCQkJY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyB0YXJnZXQgXSA9IGZyYW1lYnVmZmVyOwoKCQkJaWYgKCBpc1dlYkdMMiApIHsKCgkJCQkvLyBnbC5EUkFXX0ZSQU1FQlVGRkVSIGlzIGVxdWl2YWxlbnQgdG8gZ2wuRlJBTUVCVUZGRVIKCgkJCQlpZiAoIHRhcmdldCA9PT0gZ2wuRFJBV19GUkFNRUJVRkZFUiApIHsKCgkJCQkJY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyBnbC5GUkFNRUJVRkZFUiBdID0gZnJhbWVidWZmZXI7CgoJCQkJfQoKCQkJCWlmICggdGFyZ2V0ID09PSBnbC5GUkFNRUJVRkZFUiApIHsKCgkJCQkJY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyBnbC5EUkFXX0ZSQU1FQlVGRkVSIF0gPSBmcmFtZWJ1ZmZlcjsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfQoKCQlyZXR1cm4gZmFsc2U7CgoJfQoKCWZ1bmN0aW9uIGRyYXdCdWZmZXJzKCByZW5kZXJUYXJnZXQsIGZyYW1lYnVmZmVyICkgewoKCQlsZXQgZHJhd0J1ZmZlcnMgPSBkZWZhdWx0RHJhd2J1ZmZlcnM7CgoJCWxldCBuZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQlpZiAoIHJlbmRlclRhcmdldCApIHsKCgkJCWRyYXdCdWZmZXJzID0gY3VycmVudERyYXdidWZmZXJzLmdldCggZnJhbWVidWZmZXIgKTsKCgkJCWlmICggZHJhd0J1ZmZlcnMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlkcmF3QnVmZmVycyA9IFtdOwoJCQkJY3VycmVudERyYXdidWZmZXJzLnNldCggZnJhbWVidWZmZXIsIGRyYXdCdWZmZXJzICk7CgoJCQl9CgoJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKCQkJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQkJaWYgKCBkcmF3QnVmZmVycy5sZW5ndGggIT09IHRleHR1cmVzLmxlbmd0aCB8fCBkcmF3QnVmZmVyc1sgMCBdICE9PSBnbC5DT0xPUl9BVFRBQ0hNRU5UMCApIHsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJZHJhd0J1ZmZlcnNbIGkgXSA9IGdsLkNPTE9SX0FUVEFDSE1FTlQwICsgaTsKCgkJCQkJfQoKCQkJCQlkcmF3QnVmZmVycy5sZW5ndGggPSB0ZXh0dXJlcy5sZW5ndGg7CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWlmICggZHJhd0J1ZmZlcnNbIDAgXSAhPT0gZ2wuQ09MT1JfQVRUQUNITUVOVDAgKSB7CgoJCQkJCWRyYXdCdWZmZXJzWyAwIF0gPSBnbC5DT0xPUl9BVFRBQ0hNRU5UMDsKCgkJCQkJbmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggZHJhd0J1ZmZlcnNbIDAgXSAhPT0gZ2wuQkFDSyApIHsKCgkJCQlkcmF3QnVmZmVyc1sgMCBdID0gZ2wuQkFDSzsKCgkJCQluZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCX0KCgkJaWYgKCBuZWVkc1VwZGF0ZSApIHsKCgkJCWlmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyICkgewoKCQkJCWdsLmRyYXdCdWZmZXJzKCBkcmF3QnVmZmVycyApOwoKCQkJfSBlbHNlIHsKCgkJCQlleHRlbnNpb25zLmdldCggJ1dFQkdMX2RyYXdfYnVmZmVycycgKS5kcmF3QnVmZmVyc1dFQkdMKCBkcmF3QnVmZmVycyApOwoKCQkJfQoKCQl9CgoKCX0KCglmdW5jdGlvbiB1c2VQcm9ncmFtKCBwcm9ncmFtICkgewoKCQlpZiAoIGN1cnJlbnRQcm9ncmFtICE9PSBwcm9ncmFtICkgewoKCQkJZ2wudXNlUHJvZ3JhbSggcHJvZ3JhbSApOwoKCQkJY3VycmVudFByb2dyYW0gPSBwcm9ncmFtOwoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJcmV0dXJuIGZhbHNlOwoKCX0KCgljb25zdCBlcXVhdGlvblRvR0wgPSB7CgkJWyBBZGRFcXVhdGlvbiBdOiBnbC5GVU5DX0FERCwKCQlbIFN1YnRyYWN0RXF1YXRpb24gXTogZ2wuRlVOQ19TVUJUUkFDVCwKCQlbIFJldmVyc2VTdWJ0cmFjdEVxdWF0aW9uIF06IGdsLkZVTkNfUkVWRVJTRV9TVUJUUkFDVAoJfTsKCglpZiAoIGlzV2ViR0wyICkgewoKCQllcXVhdGlvblRvR0xbIE1pbkVxdWF0aW9uIF0gPSBnbC5NSU47CgkJZXF1YXRpb25Ub0dMWyBNYXhFcXVhdGlvbiBdID0gZ2wuTUFYOwoKCX0gZWxzZSB7CgoJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX2JsZW5kX21pbm1heCcgKTsKCgkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQllcXVhdGlvblRvR0xbIE1pbkVxdWF0aW9uIF0gPSBleHRlbnNpb24uTUlOX0VYVDsKCQkJZXF1YXRpb25Ub0dMWyBNYXhFcXVhdGlvbiBdID0gZXh0ZW5zaW9uLk1BWF9FWFQ7CgoJCX0KCgl9CgoJY29uc3QgZmFjdG9yVG9HTCA9IHsKCQlbIFplcm9GYWN0b3IgXTogZ2wuWkVSTywKCQlbIE9uZUZhY3RvciBdOiBnbC5PTkUsCgkJWyBTcmNDb2xvckZhY3RvciBdOiBnbC5TUkNfQ09MT1IsCgkJWyBTcmNBbHBoYUZhY3RvciBdOiBnbC5TUkNfQUxQSEEsCgkJWyBTcmNBbHBoYVNhdHVyYXRlRmFjdG9yIF06IGdsLlNSQ19BTFBIQV9TQVRVUkFURSwKCQlbIERzdENvbG9yRmFjdG9yIF06IGdsLkRTVF9DT0xPUiwKCQlbIERzdEFscGhhRmFjdG9yIF06IGdsLkRTVF9BTFBIQSwKCQlbIE9uZU1pbnVzU3JjQ29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX1NSQ19DT0xPUiwKCQlbIE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IgXTogZ2wuT05FX01JTlVTX1NSQ19BTFBIQSwKCQlbIE9uZU1pbnVzRHN0Q29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX0RTVF9DT0xPUiwKCQlbIE9uZU1pbnVzRHN0QWxwaGFGYWN0b3IgXTogZ2wuT05FX01JTlVTX0RTVF9BTFBIQSwKCQlbIENvbnN0YW50Q29sb3JGYWN0b3IgXTogZ2wuQ09OU1RBTlRfQ09MT1IsCgkJWyBPbmVNaW51c0NvbnN0YW50Q29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX0NPTlNUQU5UX0NPTE9SLAoJCVsgQ29uc3RhbnRBbHBoYUZhY3RvciBdOiBnbC5DT05TVEFOVF9BTFBIQSwKCQlbIE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3RvciBdOiBnbC5PTkVfTUlOVVNfQ09OU1RBTlRfQUxQSEEKCX07CgoJZnVuY3Rpb24gc2V0QmxlbmRpbmcoIGJsZW5kaW5nLCBibGVuZEVxdWF0aW9uLCBibGVuZFNyYywgYmxlbmREc3QsIGJsZW5kRXF1YXRpb25BbHBoYSwgYmxlbmRTcmNBbHBoYSwgYmxlbmREc3RBbHBoYSwgYmxlbmRDb2xvciwgYmxlbmRBbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICkgewoKCQlpZiAoIGJsZW5kaW5nID09PSBOb0JsZW5kaW5nICkgewoKCQkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSB0cnVlICkgewoKCQkJCWRpc2FibGUoIGdsLkJMRU5EICk7CgkJCQljdXJyZW50QmxlbmRpbmdFbmFibGVkID0gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm47CgoJCX0KCgkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSBmYWxzZSApIHsKCgkJCWVuYWJsZSggZ2wuQkxFTkQgKTsKCQkJY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IHRydWU7CgoJCX0KCgkJaWYgKCBibGVuZGluZyAhPT0gQ3VzdG9tQmxlbmRpbmcgKSB7CgoJCQlpZiAoIGJsZW5kaW5nICE9PSBjdXJyZW50QmxlbmRpbmcgfHwgcHJlbXVsdGlwbGllZEFscGhhICE9PSBjdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgKSB7CgoJCQkJaWYgKCBjdXJyZW50QmxlbmRFcXVhdGlvbiAhPT0gQWRkRXF1YXRpb24gfHwgY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSAhPT0gQWRkRXF1YXRpb24gKSB7CgoJCQkJCWdsLmJsZW5kRXF1YXRpb24oIGdsLkZVTkNfQUREICk7CgoJCQkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uID0gQWRkRXF1YXRpb247CgkJCQkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IEFkZEVxdWF0aW9uOwoKCQkJCX0KCgkJCQlpZiAoIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCgkJCQkJc3dpdGNoICggYmxlbmRpbmcgKSB7CgoJCQkJCQljYXNlIE5vcm1hbEJsZW5kaW5nOgoJCQkJCQkJZ2wuYmxlbmRGdW5jU2VwYXJhdGUoIGdsLk9ORSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSwgZ2wuT05FLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgQWRkaXRpdmVCbGVuZGluZzoKCQkJCQkJCWdsLmJsZW5kRnVuYyggZ2wuT05FLCBnbC5PTkUgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBTdWJ0cmFjdGl2ZUJsZW5kaW5nOgoJCQkJCQkJZ2wuYmxlbmRGdW5jU2VwYXJhdGUoIGdsLlpFUk8sIGdsLk9ORV9NSU5VU19TUkNfQ09MT1IsIGdsLlpFUk8sIGdsLk9ORSApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIE11bHRpcGx5QmxlbmRpbmc6CgkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuWkVSTywgZ2wuU1JDX0NPTE9SLCBnbC5aRVJPLCBnbC5TUkNfQUxQSEEgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJZGVmYXVsdDoKCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBJbnZhbGlkIGJsZW5kaW5nOiAnLCBibGVuZGluZyApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlzd2l0Y2ggKCBibGVuZGluZyApIHsKCgkJCQkJCWNhc2UgTm9ybWFsQmxlbmRpbmc6CgkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuU1JDX0FMUEhBLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBLCBnbC5PTkUsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBBZGRpdGl2ZUJsZW5kaW5nOgoJCQkJCQkJZ2wuYmxlbmRGdW5jKCBnbC5TUkNfQUxQSEEsIGdsLk9ORSApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIFN1YnRyYWN0aXZlQmxlbmRpbmc6CgkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuWkVSTywgZ2wuT05FX01JTlVTX1NSQ19DT0xPUiwgZ2wuWkVSTywgZ2wuT05FICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgTXVsdGlwbHlCbGVuZGluZzoKCQkJCQkJCWdsLmJsZW5kRnVuYyggZ2wuWkVSTywgZ2wuU1JDX0NPTE9SICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWRlZmF1bHQ6CgkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTogSW52YWxpZCBibGVuZGluZzogJywgYmxlbmRpbmcgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CgkJCQljdXJyZW50QmxlbmREc3QgPSBudWxsOwoJCQkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwoJCQkJY3VycmVudEJsZW5kRHN0QWxwaGEgPSBudWxsOwoJCQkJY3VycmVudEJsZW5kQ29sb3Iuc2V0KCAwLCAwLCAwICk7CgkJCQljdXJyZW50QmxlbmRBbHBoYSA9IDA7CgoJCQkJY3VycmVudEJsZW5kaW5nID0gYmxlbmRpbmc7CgkJCQljdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBwcmVtdWx0aXBsaWVkQWxwaGE7CgoJCQl9CgoJCQlyZXR1cm47CgoJCX0KCgkJLy8gY3VzdG9tIGJsZW5kaW5nCgoJCWJsZW5kRXF1YXRpb25BbHBoYSA9IGJsZW5kRXF1YXRpb25BbHBoYSB8fCBibGVuZEVxdWF0aW9uOwoJCWJsZW5kU3JjQWxwaGEgPSBibGVuZFNyY0FscGhhIHx8IGJsZW5kU3JjOwoJCWJsZW5kRHN0QWxwaGEgPSBibGVuZERzdEFscGhhIHx8IGJsZW5kRHN0OwoKCQlpZiAoIGJsZW5kRXF1YXRpb24gIT09IGN1cnJlbnRCbGVuZEVxdWF0aW9uIHx8IGJsZW5kRXF1YXRpb25BbHBoYSAhPT0gY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSApIHsKCgkJCWdsLmJsZW5kRXF1YXRpb25TZXBhcmF0ZSggZXF1YXRpb25Ub0dMWyBibGVuZEVxdWF0aW9uIF0sIGVxdWF0aW9uVG9HTFsgYmxlbmRFcXVhdGlvbkFscGhhIF0gKTsKCgkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uID0gYmxlbmRFcXVhdGlvbjsKCQkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IGJsZW5kRXF1YXRpb25BbHBoYTsKCgkJfQoKCQlpZiAoIGJsZW5kU3JjICE9PSBjdXJyZW50QmxlbmRTcmMgfHwgYmxlbmREc3QgIT09IGN1cnJlbnRCbGVuZERzdCB8fCBibGVuZFNyY0FscGhhICE9PSBjdXJyZW50QmxlbmRTcmNBbHBoYSB8fCBibGVuZERzdEFscGhhICE9PSBjdXJyZW50QmxlbmREc3RBbHBoYSApIHsKCgkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBmYWN0b3JUb0dMWyBibGVuZFNyYyBdLCBmYWN0b3JUb0dMWyBibGVuZERzdCBdLCBmYWN0b3JUb0dMWyBibGVuZFNyY0FscGhhIF0sIGZhY3RvclRvR0xbIGJsZW5kRHN0QWxwaGEgXSApOwoKCQkJY3VycmVudEJsZW5kU3JjID0gYmxlbmRTcmM7CgkJCWN1cnJlbnRCbGVuZERzdCA9IGJsZW5kRHN0OwoJCQljdXJyZW50QmxlbmRTcmNBbHBoYSA9IGJsZW5kU3JjQWxwaGE7CgkJCWN1cnJlbnRCbGVuZERzdEFscGhhID0gYmxlbmREc3RBbHBoYTsKCgkJfQoKCQlpZiAoIGJsZW5kQ29sb3IuZXF1YWxzKCBjdXJyZW50QmxlbmRDb2xvciApID09PSBmYWxzZSB8fCBibGVuZEFscGhhICE9PSBjdXJyZW50QmxlbmRBbHBoYSApIHsKCgkJCWdsLmJsZW5kQ29sb3IoIGJsZW5kQ29sb3IuciwgYmxlbmRDb2xvci5nLCBibGVuZENvbG9yLmIsIGJsZW5kQWxwaGEgKTsKCgkJCWN1cnJlbnRCbGVuZENvbG9yLmNvcHkoIGJsZW5kQ29sb3IgKTsKCQkJY3VycmVudEJsZW5kQWxwaGEgPSBibGVuZEFscGhhOwoKCQl9CgoJCWN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwoJCWN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IGZhbHNlOwoKCX0KCglmdW5jdGlvbiBzZXRNYXRlcmlhbCggbWF0ZXJpYWwsIGZyb250RmFjZUNXICkgewoKCQltYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlCgkJCT8gZGlzYWJsZSggZ2wuQ1VMTF9GQUNFICkKCQkJOiBlbmFibGUoIGdsLkNVTExfRkFDRSApOwoKCQlsZXQgZmxpcFNpZGVkID0gKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApOwoJCWlmICggZnJvbnRGYWNlQ1cgKSBmbGlwU2lkZWQgPSAhIGZsaXBTaWRlZDsKCgkJc2V0RmxpcFNpZGVkKCBmbGlwU2lkZWQgKTsKCgkJKCBtYXRlcmlhbC5ibGVuZGluZyA9PT0gTm9ybWFsQmxlbmRpbmcgJiYgbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IGZhbHNlICkKCQkJPyBzZXRCbGVuZGluZyggTm9CbGVuZGluZyApCgkJCTogc2V0QmxlbmRpbmcoIG1hdGVyaWFsLmJsZW5kaW5nLCBtYXRlcmlhbC5ibGVuZEVxdWF0aW9uLCBtYXRlcmlhbC5ibGVuZFNyYywgbWF0ZXJpYWwuYmxlbmREc3QsIG1hdGVyaWFsLmJsZW5kRXF1YXRpb25BbHBoYSwgbWF0ZXJpYWwuYmxlbmRTcmNBbHBoYSwgbWF0ZXJpYWwuYmxlbmREc3RBbHBoYSwgbWF0ZXJpYWwuYmxlbmRDb2xvciwgbWF0ZXJpYWwuYmxlbmRBbHBoYSwgbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhICk7CgoJCWRlcHRoQnVmZmVyLnNldEZ1bmMoIG1hdGVyaWFsLmRlcHRoRnVuYyApOwoJCWRlcHRoQnVmZmVyLnNldFRlc3QoIG1hdGVyaWFsLmRlcHRoVGVzdCApOwoJCWRlcHRoQnVmZmVyLnNldE1hc2soIG1hdGVyaWFsLmRlcHRoV3JpdGUgKTsKCQljb2xvckJ1ZmZlci5zZXRNYXNrKCBtYXRlcmlhbC5jb2xvcldyaXRlICk7CgoJCWNvbnN0IHN0ZW5jaWxXcml0ZSA9IG1hdGVyaWFsLnN0ZW5jaWxXcml0ZTsKCQlzdGVuY2lsQnVmZmVyLnNldFRlc3QoIHN0ZW5jaWxXcml0ZSApOwoJCWlmICggc3RlbmNpbFdyaXRlICkgewoKCQkJc3RlbmNpbEJ1ZmZlci5zZXRNYXNrKCBtYXRlcmlhbC5zdGVuY2lsV3JpdGVNYXNrICk7CgkJCXN0ZW5jaWxCdWZmZXIuc2V0RnVuYyggbWF0ZXJpYWwuc3RlbmNpbEZ1bmMsIG1hdGVyaWFsLnN0ZW5jaWxSZWYsIG1hdGVyaWFsLnN0ZW5jaWxGdW5jTWFzayApOwoJCQlzdGVuY2lsQnVmZmVyLnNldE9wKCBtYXRlcmlhbC5zdGVuY2lsRmFpbCwgbWF0ZXJpYWwuc3RlbmNpbFpGYWlsLCBtYXRlcmlhbC5zdGVuY2lsWlBhc3MgKTsKCgkJfQoKCQlzZXRQb2x5Z29uT2Zmc2V0KCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0LCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0RmFjdG9yLCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0VW5pdHMgKTsKCgkJbWF0ZXJpYWwuYWxwaGFUb0NvdmVyYWdlID09PSB0cnVlCgkJCT8gZW5hYmxlKCBnbC5TQU1QTEVfQUxQSEFfVE9fQ09WRVJBR0UgKQoJCQk6IGRpc2FibGUoIGdsLlNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRSApOwoKCX0KCgkvLwoKCWZ1bmN0aW9uIHNldEZsaXBTaWRlZCggZmxpcFNpZGVkICkgewoKCQlpZiAoIGN1cnJlbnRGbGlwU2lkZWQgIT09IGZsaXBTaWRlZCApIHsKCgkJCWlmICggZmxpcFNpZGVkICkgewoKCQkJCWdsLmZyb250RmFjZSggZ2wuQ1cgKTsKCgkJCX0gZWxzZSB7CgoJCQkJZ2wuZnJvbnRGYWNlKCBnbC5DQ1cgKTsKCgkJCX0KCgkJCWN1cnJlbnRGbGlwU2lkZWQgPSBmbGlwU2lkZWQ7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0Q3VsbEZhY2UoIGN1bGxGYWNlICkgewoKCQlpZiAoIGN1bGxGYWNlICE9PSBDdWxsRmFjZU5vbmUgKSB7CgoJCQllbmFibGUoIGdsLkNVTExfRkFDRSApOwoKCQkJaWYgKCBjdWxsRmFjZSAhPT0gY3VycmVudEN1bGxGYWNlICkgewoKCQkJCWlmICggY3VsbEZhY2UgPT09IEN1bGxGYWNlQmFjayApIHsKCgkJCQkJZ2wuY3VsbEZhY2UoIGdsLkJBQ0sgKTsKCgkJCQl9IGVsc2UgaWYgKCBjdWxsRmFjZSA9PT0gQ3VsbEZhY2VGcm9udCApIHsKCgkJCQkJZ2wuY3VsbEZhY2UoIGdsLkZST05UICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJZ2wuY3VsbEZhY2UoIGdsLkZST05UX0FORF9CQUNLICk7CgoJCQkJfQoKCQkJfQoKCQl9IGVsc2UgewoKCQkJZGlzYWJsZSggZ2wuQ1VMTF9GQUNFICk7CgoJCX0KCgkJY3VycmVudEN1bGxGYWNlID0gY3VsbEZhY2U7CgoJfQoKCWZ1bmN0aW9uIHNldExpbmVXaWR0aCggd2lkdGggKSB7CgoJCWlmICggd2lkdGggIT09IGN1cnJlbnRMaW5lV2lkdGggKSB7CgoJCQlpZiAoIGxpbmVXaWR0aEF2YWlsYWJsZSApIGdsLmxpbmVXaWR0aCggd2lkdGggKTsKCgkJCWN1cnJlbnRMaW5lV2lkdGggPSB3aWR0aDsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRQb2x5Z29uT2Zmc2V0KCBwb2x5Z29uT2Zmc2V0LCBmYWN0b3IsIHVuaXRzICkgewoKCQlpZiAoIHBvbHlnb25PZmZzZXQgKSB7CgoJCQllbmFibGUoIGdsLlBPTFlHT05fT0ZGU0VUX0ZJTEwgKTsKCgkJCWlmICggY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgIT09IGZhY3RvciB8fCBjdXJyZW50UG9seWdvbk9mZnNldFVuaXRzICE9PSB1bml0cyApIHsKCgkJCQlnbC5wb2x5Z29uT2Zmc2V0KCBmYWN0b3IsIHVuaXRzICk7CgoJCQkJY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgPSBmYWN0b3I7CgkJCQljdXJyZW50UG9seWdvbk9mZnNldFVuaXRzID0gdW5pdHM7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlkaXNhYmxlKCBnbC5QT0xZR09OX09GRlNFVF9GSUxMICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0U2Npc3NvclRlc3QoIHNjaXNzb3JUZXN0ICkgewoKCQlpZiAoIHNjaXNzb3JUZXN0ICkgewoKCQkJZW5hYmxlKCBnbC5TQ0lTU09SX1RFU1QgKTsKCgkJfSBlbHNlIHsKCgkJCWRpc2FibGUoIGdsLlNDSVNTT1JfVEVTVCApOwoKCQl9CgoJfQoKCS8vIHRleHR1cmUKCglmdW5jdGlvbiBhY3RpdmVUZXh0dXJlKCB3ZWJnbFNsb3QgKSB7CgoJCWlmICggd2ViZ2xTbG90ID09PSB1bmRlZmluZWQgKSB3ZWJnbFNsb3QgPSBnbC5URVhUVVJFMCArIG1heFRleHR1cmVzIC0gMTsKCgkJaWYgKCBjdXJyZW50VGV4dHVyZVNsb3QgIT09IHdlYmdsU2xvdCApIHsKCgkJCWdsLmFjdGl2ZVRleHR1cmUoIHdlYmdsU2xvdCApOwoJCQljdXJyZW50VGV4dHVyZVNsb3QgPSB3ZWJnbFNsb3Q7CgoJCX0KCgl9CgoJZnVuY3Rpb24gYmluZFRleHR1cmUoIHdlYmdsVHlwZSwgd2ViZ2xUZXh0dXJlLCB3ZWJnbFNsb3QgKSB7CgoJCWlmICggd2ViZ2xTbG90ID09PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGN1cnJlbnRUZXh0dXJlU2xvdCA9PT0gbnVsbCApIHsKCgkJCQl3ZWJnbFNsb3QgPSBnbC5URVhUVVJFMCArIG1heFRleHR1cmVzIC0gMTsKCgkJCX0gZWxzZSB7CgoJCQkJd2ViZ2xTbG90ID0gY3VycmVudFRleHR1cmVTbG90OwoKCQkJfQoKCQl9CgoJCWxldCBib3VuZFRleHR1cmUgPSBjdXJyZW50Qm91bmRUZXh0dXJlc1sgd2ViZ2xTbG90IF07CgoJCWlmICggYm91bmRUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgoJCQlib3VuZFRleHR1cmUgPSB7IHR5cGU6IHVuZGVmaW5lZCwgdGV4dHVyZTogdW5kZWZpbmVkIH07CgkJCWN1cnJlbnRCb3VuZFRleHR1cmVzWyB3ZWJnbFNsb3QgXSA9IGJvdW5kVGV4dHVyZTsKCgkJfQoKCQlpZiAoIGJvdW5kVGV4dHVyZS50eXBlICE9PSB3ZWJnbFR5cGUgfHwgYm91bmRUZXh0dXJlLnRleHR1cmUgIT09IHdlYmdsVGV4dHVyZSApIHsKCgkJCWlmICggY3VycmVudFRleHR1cmVTbG90ICE9PSB3ZWJnbFNsb3QgKSB7CgoJCQkJZ2wuYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICk7CgkJCQljdXJyZW50VGV4dHVyZVNsb3QgPSB3ZWJnbFNsb3Q7CgoJCQl9CgoJCQlnbC5iaW5kVGV4dHVyZSggd2ViZ2xUeXBlLCB3ZWJnbFRleHR1cmUgfHwgZW1wdHlUZXh0dXJlc1sgd2ViZ2xUeXBlIF0gKTsKCgkJCWJvdW5kVGV4dHVyZS50eXBlID0gd2ViZ2xUeXBlOwoJCQlib3VuZFRleHR1cmUudGV4dHVyZSA9IHdlYmdsVGV4dHVyZTsKCgkJfQoKCX0KCglmdW5jdGlvbiB1bmJpbmRUZXh0dXJlKCkgewoKCQljb25zdCBib3VuZFRleHR1cmUgPSBjdXJyZW50Qm91bmRUZXh0dXJlc1sgY3VycmVudFRleHR1cmVTbG90IF07CgoJCWlmICggYm91bmRUZXh0dXJlICE9PSB1bmRlZmluZWQgJiYgYm91bmRUZXh0dXJlLnR5cGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCWdsLmJpbmRUZXh0dXJlKCBib3VuZFRleHR1cmUudHlwZSwgbnVsbCApOwoKCQkJYm91bmRUZXh0dXJlLnR5cGUgPSB1bmRlZmluZWQ7CgkJCWJvdW5kVGV4dHVyZS50ZXh0dXJlID0gdW5kZWZpbmVkOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIGNvbXByZXNzZWRUZXhJbWFnZTJEKCkgewoKCQl0cnkgewoKCQkJZ2wuY29tcHJlc3NlZFRleEltYWdlMkQuYXBwbHkoIGdsLCBhcmd1bWVudHMgKTsKCgkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBjb21wcmVzc2VkVGV4SW1hZ2UzRCgpIHsKCgkJdHJ5IHsKCgkJCWdsLmNvbXByZXNzZWRUZXhJbWFnZTNELmFwcGx5KCBnbCwgYXJndW1lbnRzICk7CgoJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gdGV4U3ViSW1hZ2UyRCgpIHsKCgkJdHJ5IHsKCgkJCWdsLnRleFN1YkltYWdlMkQuYXBwbHkoIGdsLCBhcmd1bWVudHMgKTsKCgkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiB0ZXhTdWJJbWFnZTNEKCkgewoKCQl0cnkgewoKCQkJZ2wudGV4U3ViSW1hZ2UzRC5hcHBseSggZ2wsIGFyZ3VtZW50cyApOwoKCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIGNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKCkgewoKCQl0cnkgewoKCQkJZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQuYXBwbHkoIGdsLCBhcmd1bWVudHMgKTsKCgkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCgpIHsKCgkJdHJ5IHsKCgkJCWdsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNELmFwcGx5KCBnbCwgYXJndW1lbnRzICk7CgoJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gdGV4U3RvcmFnZTJEKCkgewoKCQl0cnkgewoKCQkJZ2wudGV4U3RvcmFnZTJELmFwcGx5KCBnbCwgYXJndW1lbnRzICk7CgoJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gdGV4U3RvcmFnZTNEKCkgewoKCQl0cnkgewoKCQkJZ2wudGV4U3RvcmFnZTNELmFwcGx5KCBnbCwgYXJndW1lbnRzICk7CgoJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gdGV4SW1hZ2UyRCgpIHsKCgkJdHJ5IHsKCgkJCWdsLnRleEltYWdlMkQuYXBwbHkoIGdsLCBhcmd1bWVudHMgKTsKCgkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiB0ZXhJbWFnZTNEKCkgewoKCQl0cnkgewoKCQkJZ2wudGV4SW1hZ2UzRC5hcHBseSggZ2wsIGFyZ3VtZW50cyApOwoKCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQl9CgoJfQoKCS8vCgoJZnVuY3Rpb24gc2Npc3Nvciggc2Npc3NvciApIHsKCgkJaWYgKCBjdXJyZW50U2Npc3Nvci5lcXVhbHMoIHNjaXNzb3IgKSA9PT0gZmFsc2UgKSB7CgoJCQlnbC5zY2lzc29yKCBzY2lzc29yLngsIHNjaXNzb3IueSwgc2Npc3Nvci56LCBzY2lzc29yLncgKTsKCQkJY3VycmVudFNjaXNzb3IuY29weSggc2Npc3NvciApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHZpZXdwb3J0KCB2aWV3cG9ydCApIHsKCgkJaWYgKCBjdXJyZW50Vmlld3BvcnQuZXF1YWxzKCB2aWV3cG9ydCApID09PSBmYWxzZSApIHsKCgkJCWdsLnZpZXdwb3J0KCB2aWV3cG9ydC54LCB2aWV3cG9ydC55LCB2aWV3cG9ydC56LCB2aWV3cG9ydC53ICk7CgkJCWN1cnJlbnRWaWV3cG9ydC5jb3B5KCB2aWV3cG9ydCApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZVVCT01hcHBpbmcoIHVuaWZvcm1zR3JvdXAsIHByb2dyYW0gKSB7CgoJCWxldCBtYXBwaW5nID0gdWJvUHJvZ3JhbU1hcC5nZXQoIHByb2dyYW0gKTsKCgkJaWYgKCBtYXBwaW5nID09PSB1bmRlZmluZWQgKSB7CgoJCQltYXBwaW5nID0gbmV3IFdlYWtNYXAoKTsKCgkJCXVib1Byb2dyYW1NYXAuc2V0KCBwcm9ncmFtLCBtYXBwaW5nICk7CgoJCX0KCgkJbGV0IGJsb2NrSW5kZXggPSBtYXBwaW5nLmdldCggdW5pZm9ybXNHcm91cCApOwoKCQlpZiAoIGJsb2NrSW5kZXggPT09IHVuZGVmaW5lZCApIHsKCgkJCWJsb2NrSW5kZXggPSBnbC5nZXRVbmlmb3JtQmxvY2tJbmRleCggcHJvZ3JhbSwgdW5pZm9ybXNHcm91cC5uYW1lICk7CgoJCQltYXBwaW5nLnNldCggdW5pZm9ybXNHcm91cCwgYmxvY2tJbmRleCApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHVuaWZvcm1CbG9ja0JpbmRpbmcoIHVuaWZvcm1zR3JvdXAsIHByb2dyYW0gKSB7CgoJCWNvbnN0IG1hcHBpbmcgPSB1Ym9Qcm9ncmFtTWFwLmdldCggcHJvZ3JhbSApOwoJCWNvbnN0IGJsb2NrSW5kZXggPSBtYXBwaW5nLmdldCggdW5pZm9ybXNHcm91cCApOwoKCQlpZiAoIHVib0JpbmRpbmdzLmdldCggcHJvZ3JhbSApICE9PSBibG9ja0luZGV4ICkgewoKCQkJLy8gYmluZCBzaGFkZXIgc3BlY2lmaWMgYmxvY2sgaW5kZXggdG8gZ2xvYmFsIGJsb2NrIHBvaW50CgkJCWdsLnVuaWZvcm1CbG9ja0JpbmRpbmcoIHByb2dyYW0sIGJsb2NrSW5kZXgsIHVuaWZvcm1zR3JvdXAuX19iaW5kaW5nUG9pbnRJbmRleCApOwoKCQkJdWJvQmluZGluZ3Muc2V0KCBwcm9ncmFtLCBibG9ja0luZGV4ICk7CgoJCX0KCgl9CgoJLy8KCglmdW5jdGlvbiByZXNldCgpIHsKCgkJLy8gcmVzZXQgc3RhdGUKCgkJZ2wuZGlzYWJsZSggZ2wuQkxFTkQgKTsKCQlnbC5kaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKTsKCQlnbC5kaXNhYmxlKCBnbC5ERVBUSF9URVNUICk7CgkJZ2wuZGlzYWJsZSggZ2wuUE9MWUdPTl9PRkZTRVRfRklMTCApOwoJCWdsLmRpc2FibGUoIGdsLlNDSVNTT1JfVEVTVCApOwoJCWdsLmRpc2FibGUoIGdsLlNURU5DSUxfVEVTVCApOwoJCWdsLmRpc2FibGUoIGdsLlNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRSApOwoKCQlnbC5ibGVuZEVxdWF0aW9uKCBnbC5GVU5DX0FERCApOwoJCWdsLmJsZW5kRnVuYyggZ2wuT05FLCBnbC5aRVJPICk7CgkJZ2wuYmxlbmRGdW5jU2VwYXJhdGUoIGdsLk9ORSwgZ2wuWkVSTywgZ2wuT05FLCBnbC5aRVJPICk7CgkJZ2wuYmxlbmRDb2xvciggMCwgMCwgMCwgMCApOwoKCQlnbC5jb2xvck1hc2soIHRydWUsIHRydWUsIHRydWUsIHRydWUgKTsKCQlnbC5jbGVhckNvbG9yKCAwLCAwLCAwLCAwICk7CgoJCWdsLmRlcHRoTWFzayggdHJ1ZSApOwoJCWdsLmRlcHRoRnVuYyggZ2wuTEVTUyApOwoJCWdsLmNsZWFyRGVwdGgoIDEgKTsKCgkJZ2wuc3RlbmNpbE1hc2soIDB4ZmZmZmZmZmYgKTsKCQlnbC5zdGVuY2lsRnVuYyggZ2wuQUxXQVlTLCAwLCAweGZmZmZmZmZmICk7CgkJZ2wuc3RlbmNpbE9wKCBnbC5LRUVQLCBnbC5LRUVQLCBnbC5LRUVQICk7CgkJZ2wuY2xlYXJTdGVuY2lsKCAwICk7CgoJCWdsLmN1bGxGYWNlKCBnbC5CQUNLICk7CgkJZ2wuZnJvbnRGYWNlKCBnbC5DQ1cgKTsKCgkJZ2wucG9seWdvbk9mZnNldCggMCwgMCApOwoKCQlnbC5hY3RpdmVUZXh0dXJlKCBnbC5URVhUVVJFMCApOwoKCQlnbC5iaW5kRnJhbWVidWZmZXIoIGdsLkZSQU1FQlVGRkVSLCBudWxsICk7CgoJCWlmICggaXNXZWJHTDIgPT09IHRydWUgKSB7CgoJCQlnbC5iaW5kRnJhbWVidWZmZXIoIGdsLkRSQVdfRlJBTUVCVUZGRVIsIG51bGwgKTsKCQkJZ2wuYmluZEZyYW1lYnVmZmVyKCBnbC5SRUFEX0ZSQU1FQlVGRkVSLCBudWxsICk7CgoJCX0KCgkJZ2wudXNlUHJvZ3JhbSggbnVsbCApOwoKCQlnbC5saW5lV2lkdGgoIDEgKTsKCgkJZ2wuc2Npc3NvciggMCwgMCwgZ2wuY2FudmFzLndpZHRoLCBnbC5jYW52YXMuaGVpZ2h0ICk7CgkJZ2wudmlld3BvcnQoIDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCApOwoKCQkvLyByZXNldCBpbnRlcm5hbHMKCgkJZW5hYmxlZENhcGFiaWxpdGllcyA9IHt9OwoKCQljdXJyZW50VGV4dHVyZVNsb3QgPSBudWxsOwoJCWN1cnJlbnRCb3VuZFRleHR1cmVzID0ge307CgoJCWN1cnJlbnRCb3VuZEZyYW1lYnVmZmVycyA9IHt9OwoJCWN1cnJlbnREcmF3YnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CgkJZGVmYXVsdERyYXdidWZmZXJzID0gW107CgoJCWN1cnJlbnRQcm9ncmFtID0gbnVsbDsKCgkJY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IGZhbHNlOwoJCWN1cnJlbnRCbGVuZGluZyA9IG51bGw7CgkJY3VycmVudEJsZW5kRXF1YXRpb24gPSBudWxsOwoJCWN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CgkJY3VycmVudEJsZW5kRHN0ID0gbnVsbDsKCQljdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKCQljdXJyZW50QmxlbmRTcmNBbHBoYSA9IG51bGw7CgkJY3VycmVudEJsZW5kRHN0QWxwaGEgPSBudWxsOwoJCWN1cnJlbnRCbGVuZENvbG9yID0gbmV3IENvbG9yKCAwLCAwLCAwICk7CgkJY3VycmVudEJsZW5kQWxwaGEgPSAwOwoJCWN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IGZhbHNlOwoKCQljdXJyZW50RmxpcFNpZGVkID0gbnVsbDsKCQljdXJyZW50Q3VsbEZhY2UgPSBudWxsOwoKCQljdXJyZW50TGluZVdpZHRoID0gbnVsbDsKCgkJY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgPSBudWxsOwoJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSBudWxsOwoKCQljdXJyZW50U2Npc3Nvci5zZXQoIDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCApOwoJCWN1cnJlbnRWaWV3cG9ydC5zZXQoIDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCApOwoKCQljb2xvckJ1ZmZlci5yZXNldCgpOwoJCWRlcHRoQnVmZmVyLnJlc2V0KCk7CgkJc3RlbmNpbEJ1ZmZlci5yZXNldCgpOwoKCX0KCglyZXR1cm4gewoKCQlidWZmZXJzOiB7CgkJCWNvbG9yOiBjb2xvckJ1ZmZlciwKCQkJZGVwdGg6IGRlcHRoQnVmZmVyLAoJCQlzdGVuY2lsOiBzdGVuY2lsQnVmZmVyCgkJfSwKCgkJZW5hYmxlOiBlbmFibGUsCgkJZGlzYWJsZTogZGlzYWJsZSwKCgkJYmluZEZyYW1lYnVmZmVyOiBiaW5kRnJhbWVidWZmZXIsCgkJZHJhd0J1ZmZlcnM6IGRyYXdCdWZmZXJzLAoKCQl1c2VQcm9ncmFtOiB1c2VQcm9ncmFtLAoKCQlzZXRCbGVuZGluZzogc2V0QmxlbmRpbmcsCgkJc2V0TWF0ZXJpYWw6IHNldE1hdGVyaWFsLAoKCQlzZXRGbGlwU2lkZWQ6IHNldEZsaXBTaWRlZCwKCQlzZXRDdWxsRmFjZTogc2V0Q3VsbEZhY2UsCgoJCXNldExpbmVXaWR0aDogc2V0TGluZVdpZHRoLAoJCXNldFBvbHlnb25PZmZzZXQ6IHNldFBvbHlnb25PZmZzZXQsCgoJCXNldFNjaXNzb3JUZXN0OiBzZXRTY2lzc29yVGVzdCwKCgkJYWN0aXZlVGV4dHVyZTogYWN0aXZlVGV4dHVyZSwKCQliaW5kVGV4dHVyZTogYmluZFRleHR1cmUsCgkJdW5iaW5kVGV4dHVyZTogdW5iaW5kVGV4dHVyZSwKCQljb21wcmVzc2VkVGV4SW1hZ2UyRDogY29tcHJlc3NlZFRleEltYWdlMkQsCgkJY29tcHJlc3NlZFRleEltYWdlM0Q6IGNvbXByZXNzZWRUZXhJbWFnZTNELAoJCXRleEltYWdlMkQ6IHRleEltYWdlMkQsCgkJdGV4SW1hZ2UzRDogdGV4SW1hZ2UzRCwKCgkJdXBkYXRlVUJPTWFwcGluZzogdXBkYXRlVUJPTWFwcGluZywKCQl1bmlmb3JtQmxvY2tCaW5kaW5nOiB1bmlmb3JtQmxvY2tCaW5kaW5nLAoKCQl0ZXhTdG9yYWdlMkQ6IHRleFN0b3JhZ2UyRCwKCQl0ZXhTdG9yYWdlM0Q6IHRleFN0b3JhZ2UzRCwKCQl0ZXhTdWJJbWFnZTJEOiB0ZXhTdWJJbWFnZTJELAoJCXRleFN1YkltYWdlM0Q6IHRleFN1YkltYWdlM0QsCgkJY29tcHJlc3NlZFRleFN1YkltYWdlMkQ6IGNvbXByZXNzZWRUZXhTdWJJbWFnZTJELAoJCWNvbXByZXNzZWRUZXhTdWJJbWFnZTNEOiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCwKCgkJc2Npc3Nvcjogc2Npc3NvciwKCQl2aWV3cG9ydDogdmlld3BvcnQsCgoJCXJlc2V0OiByZXNldAoKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTFRleHR1cmVzKCBfZ2wsIGV4dGVuc2lvbnMsIHN0YXRlLCBwcm9wZXJ0aWVzLCBjYXBhYmlsaXRpZXMsIHV0aWxzLCBpbmZvICkgewoKCWNvbnN0IGlzV2ViR0wyID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyOwoJY29uc3QgbXVsdGlzYW1wbGVkUlRURXh0ID0gZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgPyBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpc2FtcGxlZF9yZW5kZXJfdG9fdGV4dHVyZScgKSA6IG51bGw7Cgljb25zdCBzdXBwb3J0c0ludmFsaWRhdGVGcmFtZWJ1ZmZlciA9IHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnID8gZmFsc2UgOiAvT2N1bHVzQnJvd3Nlci9nLnRlc3QoIG5hdmlnYXRvci51c2VyQWdlbnQgKTsKCgljb25zdCBfdmlkZW9UZXh0dXJlcyA9IG5ldyBXZWFrTWFwKCk7CglsZXQgX2NhbnZhczsKCgljb25zdCBfc291cmNlcyA9IG5ldyBXZWFrTWFwKCk7IC8vIG1hcHMgV2ViZ2xUZXh0dXJlIG9iamVjdHMgdG8gaW5zdGFuY2VzIG9mIFNvdXJjZQoKCS8vIGNvcmRvdmEgaU9TIChhcyBvZiA1LjApIHN0aWxsIHVzZXMgVUlXZWJWaWV3LCB3aGljaCBwcm92aWRlcyBPZmZzY3JlZW5DYW52YXMsCgkvLyBhbHNvIE9mZnNjcmVlbkNhbnZhcy5nZXRDb250ZXh0KCJ3ZWJnbCIpLCBidXQgbm90IE9mZnNjcmVlbkNhbnZhcy5nZXRDb250ZXh0KCIyZCIpIQoJLy8gU29tZSBpbXBsZW1lbnRhdGlvbnMgbWF5IG9ubHkgaW1wbGVtZW50IE9mZnNjcmVlbkNhbnZhcyBwYXJ0aWFsbHkgKGUuZy4gbGFja2luZyAyZCkuCgoJbGV0IHVzZU9mZnNjcmVlbkNhbnZhcyA9IGZhbHNlOwoKCXRyeSB7CgoJCXVzZU9mZnNjcmVlbkNhbnZhcyA9IHR5cGVvZiBPZmZzY3JlZW5DYW52YXMgIT09ICd1bmRlZmluZWQnCgkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wYXQvY29tcGF0CgkJCSYmICggbmV3IE9mZnNjcmVlbkNhbnZhcyggMSwgMSApLmdldENvbnRleHQoICcyZCcgKSApICE9PSBudWxsOwoKCX0gY2F0Y2ggKCBlcnIgKSB7CgoJCS8vIElnbm9yZSBhbnkgZXJyb3JzCgoJfQoKCWZ1bmN0aW9uIGNyZWF0ZUNhbnZhcyggd2lkdGgsIGhlaWdodCApIHsKCgkJLy8gVXNlIE9mZnNjcmVlbkNhbnZhcyB3aGVuIGF2YWlsYWJsZS4gU3BlY2lhbGx5IG5lZWRlZCBpbiB3ZWIgd29ya2VycwoKCQlyZXR1cm4gdXNlT2Zmc2NyZWVuQ2FudmFzID8KCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBhdC9jb21wYXQKCQkJbmV3IE9mZnNjcmVlbkNhbnZhcyggd2lkdGgsIGhlaWdodCApIDogY3JlYXRlRWxlbWVudE5TKCAnY2FudmFzJyApOwoKCX0KCglmdW5jdGlvbiByZXNpemVJbWFnZSggaW1hZ2UsIG5lZWRzUG93ZXJPZlR3bywgbmVlZHNOZXdDYW52YXMsIG1heFNpemUgKSB7CgoJCWxldCBzY2FsZSA9IDE7CgoJCS8vIGhhbmRsZSBjYXNlIGlmIHRleHR1cmUgZXhjZWVkcyBtYXggc2l6ZQoKCQlpZiAoIGltYWdlLndpZHRoID4gbWF4U2l6ZSB8fCBpbWFnZS5oZWlnaHQgPiBtYXhTaXplICkgewoKCQkJc2NhbGUgPSBtYXhTaXplIC8gTWF0aC5tYXgoIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCgkJfQoKCQkvLyBvbmx5IHBlcmZvcm0gcmVzaXplIGlmIG5lY2Vzc2FyeQoKCQlpZiAoIHNjYWxlIDwgMSB8fCBuZWVkc1Bvd2VyT2ZUd28gPT09IHRydWUgKSB7CgoJCQkvLyBvbmx5IHBlcmZvcm0gcmVzaXplIGZvciBjZXJ0YWluIGltYWdlIHR5cGVzCgoJCQlpZiAoICggdHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHx8CgkJCQkoIHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCApIHx8CgkJCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApICkgewoKCQkJCWNvbnN0IGZsb29yID0gbmVlZHNQb3dlck9mVHdvID8gZmxvb3JQb3dlck9mVHdvIDogTWF0aC5mbG9vcjsKCgkJCQljb25zdCB3aWR0aCA9IGZsb29yKCBzY2FsZSAqIGltYWdlLndpZHRoICk7CgkJCQljb25zdCBoZWlnaHQgPSBmbG9vciggc2NhbGUgKiBpbWFnZS5oZWlnaHQgKTsKCgkJCQlpZiAoIF9jYW52YXMgPT09IHVuZGVmaW5lZCApIF9jYW52YXMgPSBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQkvLyBjdWJlIHRleHR1cmVzIGNhbid0IHJldXNlIHRoZSBzYW1lIGNhbnZhcwoKCQkJCWNvbnN0IGNhbnZhcyA9IG5lZWRzTmV3Q2FudmFzID8gY3JlYXRlQ2FudmFzKCB3aWR0aCwgaGVpZ2h0ICkgOiBfY2FudmFzOwoKCQkJCWNhbnZhcy53aWR0aCA9IHdpZHRoOwoJCQkJY2FudmFzLmhlaWdodCA9IGhlaWdodDsKCgkJCQljb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoICcyZCcgKTsKCQkJCWNvbnRleHQuZHJhd0ltYWdlKCBpbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFRleHR1cmUgaGFzIGJlZW4gcmVzaXplZCBmcm9tICgnICsgaW1hZ2Uud2lkdGggKyAneCcgKyBpbWFnZS5oZWlnaHQgKyAnKSB0byAoJyArIHdpZHRoICsgJ3gnICsgaGVpZ2h0ICsgJykuJyApOwoKCQkJCXJldHVybiBjYW52YXM7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggJ2RhdGEnIGluIGltYWdlICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBJbWFnZSBpbiBEYXRhVGV4dHVyZSBpcyB0b28gYmlnICgnICsgaW1hZ2Uud2lkdGggKyAneCcgKyBpbWFnZS5oZWlnaHQgKyAnKS4nICk7CgoJCQkJfQoKCQkJCXJldHVybiBpbWFnZTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gaW1hZ2U7CgoJfQoKCWZ1bmN0aW9uIGlzUG93ZXJPZlR3byQxKCBpbWFnZSApIHsKCgkJcmV0dXJuIGlzUG93ZXJPZlR3byggaW1hZ2Uud2lkdGggKSAmJiBpc1Bvd2VyT2ZUd28oIGltYWdlLmhlaWdodCApOwoKCX0KCglmdW5jdGlvbiB0ZXh0dXJlTmVlZHNQb3dlck9mVHdvKCB0ZXh0dXJlICkgewoKCQlpZiAoIGlzV2ViR0wyICkgcmV0dXJuIGZhbHNlOwoKCQlyZXR1cm4gKCB0ZXh0dXJlLndyYXBTICE9PSBDbGFtcFRvRWRnZVdyYXBwaW5nIHx8IHRleHR1cmUud3JhcFQgIT09IENsYW1wVG9FZGdlV3JhcHBpbmcgKSB8fAoJCQkoIHRleHR1cmUubWluRmlsdGVyICE9PSBOZWFyZXN0RmlsdGVyICYmIHRleHR1cmUubWluRmlsdGVyICE9PSBMaW5lYXJGaWx0ZXIgKTsKCgl9CgoJZnVuY3Rpb24gdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKSB7CgoJCXJldHVybiB0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyAmJiBzdXBwb3J0c01pcHMgJiYKCQkJdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhckZpbHRlcjsKCgl9CgoJZnVuY3Rpb24gZ2VuZXJhdGVNaXBtYXAoIHRhcmdldCApIHsKCgkJX2dsLmdlbmVyYXRlTWlwbWFwKCB0YXJnZXQgKTsKCgl9CgoJZnVuY3Rpb24gZ2V0SW50ZXJuYWxGb3JtYXQoIGludGVybmFsRm9ybWF0TmFtZSwgZ2xGb3JtYXQsIGdsVHlwZSwgY29sb3JTcGFjZSwgZm9yY2VMaW5lYXJUcmFuc2ZlciA9IGZhbHNlICkgewoKCQlpZiAoIGlzV2ViR0wyID09PSBmYWxzZSApIHJldHVybiBnbEZvcm1hdDsKCgkJaWYgKCBpbnRlcm5hbEZvcm1hdE5hbWUgIT09IG51bGwgKSB7CgoJCQlpZiAoIF9nbFsgaW50ZXJuYWxGb3JtYXROYW1lIF0gIT09IHVuZGVmaW5lZCApIHJldHVybiBfZ2xbIGludGVybmFsRm9ybWF0TmFtZSBdOwoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQXR0ZW1wdCB0byB1c2Ugbm9uLWV4aXN0aW5nIFdlYkdMIGludGVybmFsIGZvcm1hdCBcJycgKyBpbnRlcm5hbEZvcm1hdE5hbWUgKyAnXCcnICk7CgoJCX0KCgkJbGV0IGludGVybmFsRm9ybWF0ID0gZ2xGb3JtYXQ7CgoJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SRUQgKSB7CgoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjMyRjsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5IQUxGX0ZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjE2RjsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjg7CgoJCX0KCgkJaWYgKCBnbEZvcm1hdCA9PT0gX2dsLlJFRF9JTlRFR0VSICkgewoKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjhVSTsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9TSE9SVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIxNlVJOwoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMlVJOwoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkJZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SOEk7CgkJCWlmICggZ2xUeXBlID09PSBfZ2wuU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SMTZJOwoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMkk7CgoJCX0KCgkJaWYgKCBnbEZvcm1hdCA9PT0gX2dsLlJHICkgewoKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJGOwoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkhBTEZfRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzE2RjsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkc4OwoKCQl9CgoJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SR0JBICkgewoKCQkJY29uc3QgdHJhbnNmZXIgPSBmb3JjZUxpbmVhclRyYW5zZmVyID8gTGluZWFyVHJhbnNmZXIgOiBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIGNvbG9yU3BhY2UgKTsKCgkJCWlmICggZ2xUeXBlID09PSBfZ2wuRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBMzJGOwoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkhBTEZfRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBMTZGOwoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0JZVEUgKSBpbnRlcm5hbEZvcm1hdCA9ICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gX2dsLlNSR0I4X0FMUEhBOCA6IF9nbC5SR0JBODsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9TSE9SVF80XzRfNF80ICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTQ7CgkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlRfNV81XzVfMSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjVfQTE7CgoJCX0KCgkJaWYgKCBpbnRlcm5hbEZvcm1hdCA9PT0gX2dsLlIxNkYgfHwgaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SMzJGIHx8CgkJCWludGVybmFsRm9ybWF0ID09PSBfZ2wuUkcxNkYgfHwgaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SRzMyRiB8fAoJCQlpbnRlcm5hbEZvcm1hdCA9PT0gX2dsLlJHQkExNkYgfHwgaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SR0JBMzJGICkgewoKCQkJZXh0ZW5zaW9ucy5nZXQoICdFWFRfY29sb3JfYnVmZmVyX2Zsb2F0JyApOwoKCQl9CgoJCXJldHVybiBpbnRlcm5hbEZvcm1hdDsKCgl9CgoJZnVuY3Rpb24gZ2V0TWlwTGV2ZWxzKCB0ZXh0dXJlLCBpbWFnZSwgc3VwcG9ydHNNaXBzICkgewoKCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgPT09IHRydWUgfHwgKCB0ZXh0dXJlLmlzRnJhbWVidWZmZXJUZXh0dXJlICYmIHRleHR1cmUubWluRmlsdGVyICE9PSBOZWFyZXN0RmlsdGVyICYmIHRleHR1cmUubWluRmlsdGVyICE9PSBMaW5lYXJGaWx0ZXIgKSApIHsKCgkJCXJldHVybiBNYXRoLmxvZzIoIE1hdGgubWF4KCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICkgKSArIDE7CgoJCX0gZWxzZSBpZiAoIHRleHR1cmUubWlwbWFwcyAhPT0gdW5kZWZpbmVkICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKCQkJLy8gdXNlci1kZWZpbmVkIG1pcG1hcHMKCgkJCXJldHVybiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOwoKCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgJiYgQXJyYXkuaXNBcnJheSggdGV4dHVyZS5pbWFnZSApICkgewoKCQkJcmV0dXJuIGltYWdlLm1pcG1hcHMubGVuZ3RoOwoKCQl9IGVsc2UgewoKCQkJLy8gdGV4dHVyZSB3aXRob3V0IG1pcG1hcHMgKG9ubHkgYmFzZSBsZXZlbCkKCgkJCXJldHVybiAxOwoKCQl9CgoJfQoKCS8vIEZhbGxiYWNrIGZpbHRlcnMgZm9yIG5vbi1wb3dlci1vZi0yIHRleHR1cmVzCgoJZnVuY3Rpb24gZmlsdGVyRmFsbGJhY2soIGYgKSB7CgoJCWlmICggZiA9PT0gTmVhcmVzdEZpbHRlciB8fCBmID09PSBOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlciB8fCBmID09PSBOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyICkgewoKCQkJcmV0dXJuIF9nbC5ORUFSRVNUOwoKCQl9CgoJCXJldHVybiBfZ2wuTElORUFSOwoKCX0KCgkvLwoKCWZ1bmN0aW9uIG9uVGV4dHVyZURpc3Bvc2UoIGV2ZW50ICkgewoKCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKCQl0ZXh0dXJlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKCQlkZWFsbG9jYXRlVGV4dHVyZSggdGV4dHVyZSApOwoKCQlpZiAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgKSB7CgoJCQlfdmlkZW9UZXh0dXJlcy5kZWxldGUoIHRleHR1cmUgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBvblJlbmRlclRhcmdldERpc3Bvc2UoIGV2ZW50ICkgewoKCQljb25zdCByZW5kZXJUYXJnZXQgPSBldmVudC50YXJnZXQ7CgoJCXJlbmRlclRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uUmVuZGVyVGFyZ2V0RGlzcG9zZSApOwoKCQlkZWFsbG9jYXRlUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgl9CgoJLy8KCglmdW5jdGlvbiBkZWFsbG9jYXRlVGV4dHVyZSggdGV4dHVyZSApIHsKCgkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCS8vIGNoZWNrIGlmIGl0J3MgbmVjZXNzYXJ5IHRvIHJlbW92ZSB0aGUgV2ViR0xUZXh0dXJlIG9iamVjdAoKCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCQljb25zdCB3ZWJnbFRleHR1cmVzID0gX3NvdXJjZXMuZ2V0KCBzb3VyY2UgKTsKCgkJaWYgKCB3ZWJnbFRleHR1cmVzICkgewoKCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSBdOwoJCQl3ZWJnbFRleHR1cmUudXNlZFRpbWVzIC0tOwoKCQkJLy8gdGhlIFdlYkdMVGV4dHVyZSBvYmplY3QgaXMgbm90IHVzZWQgYW55bW9yZSwgcmVtb3ZlIGl0CgoJCQlpZiAoIHdlYmdsVGV4dHVyZS51c2VkVGltZXMgPT09IDAgKSB7CgoJCQkJZGVsZXRlVGV4dHVyZSggdGV4dHVyZSApOwoKCQkJfQoKCQkJLy8gcmVtb3ZlIHRoZSB3ZWFrIG1hcCBlbnRyeSBpZiBubyBXZWJHTFRleHR1cmUgdXNlcyB0aGUgc291cmNlIGFueW1vcmUKCgkJCWlmICggT2JqZWN0LmtleXMoIHdlYmdsVGV4dHVyZXMgKS5sZW5ndGggPT09IDAgKSB7CgoJCQkJX3NvdXJjZXMuZGVsZXRlKCBzb3VyY2UgKTsKCgkJCX0KCgkJfQoKCQlwcm9wZXJ0aWVzLnJlbW92ZSggdGV4dHVyZSApOwoKCX0KCglmdW5jdGlvbiBkZWxldGVUZXh0dXJlKCB0ZXh0dXJlICkgewoKCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgkJX2dsLmRlbGV0ZVRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CgoJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwoJCWNvbnN0IHdlYmdsVGV4dHVyZXMgPSBfc291cmNlcy5nZXQoIHNvdXJjZSApOwoJCWRlbGV0ZSB3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5IF07CgoJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKCX0KCglmdW5jdGlvbiBkZWFsbG9jYXRlUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgoJCWNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKCgkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCWlmICggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgIT09IHVuZGVmaW5lZCApIHsKCgkJCV9nbC5kZWxldGVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoKCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgLS07CgoJCX0KCgkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICkgewoKCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5kaXNwb3NlKCk7CgoJCX0KCgkJaWYgKCByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCWlmICggQXJyYXkuaXNBcnJheSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApICkgewoKCQkJCQlmb3IgKCBsZXQgbGV2ZWwgPSAwOyBsZXZlbCA8IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0ubGVuZ3RoOyBsZXZlbCArKyApIF9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCV9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApOwoKCQkJCX0KCgkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyICkgX2dsLmRlbGV0ZVJlbmRlcmJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXJbIGkgXSApOwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApICkgewoKCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIubGVuZ3RoOyBsZXZlbCArKyApIF9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGxldmVsIF0gKTsKCgkJCX0gZWxzZSB7CgoJCQkJX2dsLmRlbGV0ZUZyYW1lYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoKCQkJfQoKCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyICk7CgkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKSBfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CgoJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICkgX2dsLmRlbGV0ZVJlbmRlcmJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhSZW5kZXJidWZmZXIgKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciApOwoKCQl9CgoJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQljb25zdCBhdHRhY2htZW50UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlWyBpIF0gKTsKCgkJCQlpZiAoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICkgewoKCQkJCQlfZ2wuZGVsZXRlVGV4dHVyZSggYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCgkJCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgLS07CgoJCQkJfQoKCQkJCXByb3BlcnRpZXMucmVtb3ZlKCB0ZXh0dXJlWyBpIF0gKTsKCgkJCX0KCgkJfQoKCQlwcm9wZXJ0aWVzLnJlbW92ZSggdGV4dHVyZSApOwoJCXByb3BlcnRpZXMucmVtb3ZlKCByZW5kZXJUYXJnZXQgKTsKCgl9CgoJLy8KCglsZXQgdGV4dHVyZVVuaXRzID0gMDsKCglmdW5jdGlvbiByZXNldFRleHR1cmVVbml0cygpIHsKCgkJdGV4dHVyZVVuaXRzID0gMDsKCgl9CgoJZnVuY3Rpb24gYWxsb2NhdGVUZXh0dXJlVW5pdCgpIHsKCgkJY29uc3QgdGV4dHVyZVVuaXQgPSB0ZXh0dXJlVW5pdHM7CgoJCWlmICggdGV4dHVyZVVuaXQgPj0gY2FwYWJpbGl0aWVzLm1heFRleHR1cmVzICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogVHJ5aW5nIHRvIHVzZSAnICsgdGV4dHVyZVVuaXQgKyAnIHRleHR1cmUgdW5pdHMgd2hpbGUgdGhpcyBHUFUgc3VwcG9ydHMgb25seSAnICsgY2FwYWJpbGl0aWVzLm1heFRleHR1cmVzICk7CgoJCX0KCgkJdGV4dHVyZVVuaXRzICs9IDE7CgoJCXJldHVybiB0ZXh0dXJlVW5pdDsKCgl9CgoJZnVuY3Rpb24gZ2V0VGV4dHVyZUNhY2hlS2V5KCB0ZXh0dXJlICkgewoKCQljb25zdCBhcnJheSA9IFtdOwoKCQlhcnJheS5wdXNoKCB0ZXh0dXJlLndyYXBTICk7CgkJYXJyYXkucHVzaCggdGV4dHVyZS53cmFwVCApOwoJCWFycmF5LnB1c2goIHRleHR1cmUud3JhcFIgfHwgMCApOwoJCWFycmF5LnB1c2goIHRleHR1cmUubWFnRmlsdGVyICk7CgkJYXJyYXkucHVzaCggdGV4dHVyZS5taW5GaWx0ZXIgKTsKCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmFuaXNvdHJvcHkgKTsKCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmludGVybmFsRm9ybWF0ICk7CgkJYXJyYXkucHVzaCggdGV4dHVyZS5mb3JtYXQgKTsKCQlhcnJheS5wdXNoKCB0ZXh0dXJlLnR5cGUgKTsKCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyApOwoJCWFycmF5LnB1c2goIHRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSApOwoJCWFycmF5LnB1c2goIHRleHR1cmUuZmxpcFkgKTsKCQlhcnJheS5wdXNoKCB0ZXh0dXJlLnVucGFja0FsaWdubWVudCApOwoJCWFycmF5LnB1c2goIHRleHR1cmUuY29sb3JTcGFjZSApOwoKCQlyZXR1cm4gYXJyYXkuam9pbigpOwoKCX0KCgkvLwoKCWZ1bmN0aW9uIHNldFRleHR1cmUyRCggdGV4dHVyZSwgc2xvdCApIHsKCgkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKCQlpZiAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgKSB1cGRhdGVWaWRlb1RleHR1cmUoIHRleHR1cmUgKTsKCgkJaWYgKCB0ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgJiYgdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCWNvbnN0IGltYWdlID0gdGV4dHVyZS5pbWFnZTsKCgkJCWlmICggaW1hZ2UgPT09IG51bGwgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBtYXJrZWQgZm9yIHVwZGF0ZSBidXQgbm8gaW1hZ2UgZGF0YSBmb3VuZC4nICk7CgoJCQl9IGVsc2UgaWYgKCBpbWFnZS5jb21wbGV0ZSA9PT0gZmFsc2UgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBtYXJrZWQgZm9yIHVwZGF0ZSBidXQgaW1hZ2UgaXMgaW5jb21wbGV0ZScgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdXBsb2FkVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJfQoKCQlzdGF0ZS5iaW5kVGV4dHVyZSggX2dsLlRFWFRVUkVfMkQsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFRleHR1cmUyREFycmF5KCB0ZXh0dXJlLCBzbG90ICkgewoKCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCXVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICk7CgkJCXJldHVybjsKCgkJfQoKCQlzdGF0ZS5iaW5kVGV4dHVyZSggX2dsLlRFWFRVUkVfMkRfQVJSQVksIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFRleHR1cmUzRCggdGV4dHVyZSwgc2xvdCApIHsKCgkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKCQlpZiAoIHRleHR1cmUudmVyc2lvbiA+IDAgJiYgdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uICE9PSB0ZXh0dXJlLnZlcnNpb24gKSB7CgoJCQl1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQlyZXR1cm47CgoJCX0KCgkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzNELCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCX0KCglmdW5jdGlvbiBzZXRUZXh0dXJlQ3ViZSggdGV4dHVyZSwgc2xvdCApIHsKCgkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKCQlpZiAoIHRleHR1cmUudmVyc2lvbiA+IDAgJiYgdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uICE9PSB0ZXh0dXJlLnZlcnNpb24gKSB7CgoJCQl1cGxvYWRDdWJlVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgl9CgoJY29uc3Qgd3JhcHBpbmdUb0dMID0gewoJCVsgUmVwZWF0V3JhcHBpbmcgXTogX2dsLlJFUEVBVCwKCQlbIENsYW1wVG9FZGdlV3JhcHBpbmcgXTogX2dsLkNMQU1QX1RPX0VER0UsCgkJWyBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nIF06IF9nbC5NSVJST1JFRF9SRVBFQVQKCX07CgoJY29uc3QgZmlsdGVyVG9HTCA9IHsKCQlbIE5lYXJlc3RGaWx0ZXIgXTogX2dsLk5FQVJFU1QsCgkJWyBOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlciBdOiBfZ2wuTkVBUkVTVF9NSVBNQVBfTkVBUkVTVCwKCQlbIE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgXTogX2dsLk5FQVJFU1RfTUlQTUFQX0xJTkVBUiwKCgkJWyBMaW5lYXJGaWx0ZXIgXTogX2dsLkxJTkVBUiwKCQlbIExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXIgXTogX2dsLkxJTkVBUl9NSVBNQVBfTkVBUkVTVCwKCQlbIExpbmVhck1pcG1hcExpbmVhckZpbHRlciBdOiBfZ2wuTElORUFSX01JUE1BUF9MSU5FQVIKCX07CgoJY29uc3QgY29tcGFyZVRvR0wgPSB7CgkJWyBOZXZlckNvbXBhcmUgXTogX2dsLk5FVkVSLAoJCVsgQWx3YXlzQ29tcGFyZSBdOiBfZ2wuQUxXQVlTLAoJCVsgTGVzc0NvbXBhcmUgXTogX2dsLkxFU1MsCgkJWyBMZXNzRXF1YWxDb21wYXJlIF06IF9nbC5MRVFVQUwsCgkJWyBFcXVhbENvbXBhcmUgXTogX2dsLkVRVUFMLAoJCVsgR3JlYXRlckVxdWFsQ29tcGFyZSBdOiBfZ2wuR0VRVUFMLAoJCVsgR3JlYXRlckNvbXBhcmUgXTogX2dsLkdSRUFURVIsCgkJWyBOb3RFcXVhbENvbXBhcmUgXTogX2dsLk5PVEVRVUFMCgl9OwoKCWZ1bmN0aW9uIHNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgewoKCQlpZiAoIHN1cHBvcnRzTWlwcyApIHsKCgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9TLCB3cmFwcGluZ1RvR0xbIHRleHR1cmUud3JhcFMgXSApOwoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfVCwgd3JhcHBpbmdUb0dMWyB0ZXh0dXJlLndyYXBUIF0gKTsKCgkJCWlmICggdGV4dHVyZVR5cGUgPT09IF9nbC5URVhUVVJFXzNEIHx8IHRleHR1cmVUeXBlID09PSBfZ2wuVEVYVFVSRV8yRF9BUlJBWSApIHsKCgkJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfUiwgd3JhcHBpbmdUb0dMWyB0ZXh0dXJlLndyYXBSIF0gKTsKCgkJCX0KCgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZmlsdGVyVG9HTFsgdGV4dHVyZS5tYWdGaWx0ZXIgXSApOwoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX01JTl9GSUxURVIsIGZpbHRlclRvR0xbIHRleHR1cmUubWluRmlsdGVyIF0gKTsKCgkJfSBlbHNlIHsKCgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9TLCBfZ2wuQ0xBTVBfVE9fRURHRSApOwoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfVCwgX2dsLkNMQU1QX1RPX0VER0UgKTsKCgkJCWlmICggdGV4dHVyZVR5cGUgPT09IF9nbC5URVhUVVJFXzNEIHx8IHRleHR1cmVUeXBlID09PSBfZ2wuVEVYVFVSRV8yRF9BUlJBWSApIHsKCgkJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfUiwgX2dsLkNMQU1QX1RPX0VER0UgKTsKCgkJCX0KCgkJCWlmICggdGV4dHVyZS53cmFwUyAhPT0gQ2xhbXBUb0VkZ2VXcmFwcGluZyB8fCB0ZXh0dXJlLndyYXBUICE9PSBDbGFtcFRvRWRnZVdyYXBwaW5nICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFRleHR1cmUgaXMgbm90IHBvd2VyIG9mIHR3by4gVGV4dHVyZS53cmFwUyBhbmQgVGV4dHVyZS53cmFwVCBzaG91bGQgYmUgc2V0IHRvIFRIUkVFLkNsYW1wVG9FZGdlV3JhcHBpbmcuJyApOwoKCQkJfQoKCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBmaWx0ZXJGYWxsYmFjayggdGV4dHVyZS5tYWdGaWx0ZXIgKSApOwoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX01JTl9GSUxURVIsIGZpbHRlckZhbGxiYWNrKCB0ZXh0dXJlLm1pbkZpbHRlciApICk7CgoJCQlpZiAoIHRleHR1cmUubWluRmlsdGVyICE9PSBOZWFyZXN0RmlsdGVyICYmIHRleHR1cmUubWluRmlsdGVyICE9PSBMaW5lYXJGaWx0ZXIgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBpcyBub3QgcG93ZXIgb2YgdHdvLiBUZXh0dXJlLm1pbkZpbHRlciBzaG91bGQgYmUgc2V0IHRvIFRIUkVFLk5lYXJlc3RGaWx0ZXIgb3IgVEhSRUUuTGluZWFyRmlsdGVyLicgKTsKCgkJCX0KCgkJfQoKCQlpZiAoIHRleHR1cmUuY29tcGFyZUZ1bmN0aW9uICkgewoKCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9DT01QQVJFX01PREUsIF9nbC5DT01QQVJFX1JFRl9UT19URVhUVVJFICk7CgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfQ09NUEFSRV9GVU5DLCBjb21wYXJlVG9HTFsgdGV4dHVyZS5jb21wYXJlRnVuY3Rpb24gXSApOwoKCQl9CgoJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgPT09IHRydWUgKSB7CgoJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKTsKCgkJCWlmICggdGV4dHVyZS5tYWdGaWx0ZXIgPT09IE5lYXJlc3RGaWx0ZXIgKSByZXR1cm47CgkJCWlmICggdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciApIHJldHVybjsKCQkJaWYgKCB0ZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSAmJiBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2Zsb2F0X2xpbmVhcicgKSA9PT0gZmFsc2UgKSByZXR1cm47IC8vIHZlcmlmeSBleHRlbnNpb24gZm9yIFdlYkdMIDEgYW5kIFdlYkdMIDIKCQkJaWYgKCBpc1dlYkdMMiA9PT0gZmFsc2UgJiYgKCB0ZXh0dXJlLnR5cGUgPT09IEhhbGZGbG9hdFR5cGUgJiYgZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9oYWxmX2Zsb2F0X2xpbmVhcicgKSA9PT0gZmFsc2UgKSApIHJldHVybjsgLy8gdmVyaWZ5IGV4dGVuc2lvbiBmb3IgV2ViR0wgMSBvbmx5CgoJCQlpZiAoIHRleHR1cmUuYW5pc290cm9weSA+IDEgfHwgcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX2N1cnJlbnRBbmlzb3Ryb3B5ICkgewoKCQkJCV9nbC50ZXhQYXJhbWV0ZXJmKCB0ZXh0dXJlVHlwZSwgZXh0ZW5zaW9uLlRFWFRVUkVfTUFYX0FOSVNPVFJPUFlfRVhULCBNYXRoLm1pbiggdGV4dHVyZS5hbmlzb3Ryb3B5LCBjYXBhYmlsaXRpZXMuZ2V0TWF4QW5pc290cm9weSgpICkgKTsKCQkJCXByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX19jdXJyZW50QW5pc290cm9weSA9IHRleHR1cmUuYW5pc290cm9weTsKCgkJCX0KCgkJfQoKCX0KCglmdW5jdGlvbiBpbml0VGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUgKSB7CgoJCWxldCBmb3JjZVVwbG9hZCA9IGZhbHNlOwoKCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID09PSB1bmRlZmluZWQgKSB7CgoJCQl0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsSW5pdCA9IHRydWU7CgoJCQl0ZXh0dXJlLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKCQl9CgoJCS8vIGNyZWF0ZSBTb3VyY2UgPC0+IFdlYkdMVGV4dHVyZXMgbWFwcGluZyBpZiBuZWNlc3NhcnkKCgkJY29uc3Qgc291cmNlID0gdGV4dHVyZS5zb3VyY2U7CgkJbGV0IHdlYmdsVGV4dHVyZXMgPSBfc291cmNlcy5nZXQoIHNvdXJjZSApOwoKCQlpZiAoIHdlYmdsVGV4dHVyZXMgPT09IHVuZGVmaW5lZCApIHsKCgkJCXdlYmdsVGV4dHVyZXMgPSB7fTsKCQkJX3NvdXJjZXMuc2V0KCBzb3VyY2UsIHdlYmdsVGV4dHVyZXMgKTsKCgkJfQoKCQkvLyBjaGVjayBpZiB0aGVyZSBpcyBhbHJlYWR5IGEgV2ViR0xUZXh0dXJlIG9iamVjdCBmb3IgdGhlIGdpdmVuIHRleHR1cmUgcGFyYW1ldGVycwoKCQljb25zdCB0ZXh0dXJlQ2FjaGVLZXkgPSBnZXRUZXh0dXJlQ2FjaGVLZXkoIHRleHR1cmUgKTsKCgkJaWYgKCB0ZXh0dXJlQ2FjaGVLZXkgIT09IHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgKSB7CgoJCQkvLyBpZiBub3QsIGNyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBXZWJHTFRleHR1cmUKCgkJCWlmICggd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZUNhY2hlS2V5IF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBjcmVhdGUgbmV3IGVudHJ5CgoJCQkJd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZUNhY2hlS2V5IF0gPSB7CgkJCQkJdGV4dHVyZTogX2dsLmNyZWF0ZVRleHR1cmUoKSwKCQkJCQl1c2VkVGltZXM6IDAKCQkJCX07CgoJCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgKys7CgoJCQkJLy8gd2hlbiBhIG5ldyBpbnN0YW5jZSBvZiBXZWJHTFRleHR1cmUgd2FzIGNyZWF0ZWQsIGEgdGV4dHVyZSB1cGxvYWQgaXMgcmVxdWlyZWQKCQkJCS8vIGV2ZW4gaWYgdGhlIGltYWdlIGNvbnRlbnRzIGFyZSBpZGVudGljYWwKCgkJCQlmb3JjZVVwbG9hZCA9IHRydWU7CgoJCQl9CgoJCQl3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlQ2FjaGVLZXkgXS51c2VkVGltZXMgKys7CgoJCQkvLyBldmVyeSB0aW1lIHRoZSB0ZXh0dXJlIGNhY2hlIGtleSBjaGFuZ2VzLCBpdCdzIG5lY2Vzc2FyeSB0byBjaGVjayBpZiBhbiBpbnN0YW5jZSBvZgoJCQkvLyBXZWJHTFRleHR1cmUgY2FuIGJlIGRlbGV0ZWQgaW4gb3JkZXIgdG8gYXZvaWQgYSBtZW1vcnkgbGVhay4KCgkJCWNvbnN0IHdlYmdsVGV4dHVyZSA9IHdlYmdsVGV4dHVyZXNbIHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgXTsKCgkJCWlmICggd2ViZ2xUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSBdLnVzZWRUaW1lcyAtLTsKCgkJCQlpZiAoIHdlYmdsVGV4dHVyZS51c2VkVGltZXMgPT09IDAgKSB7CgoJCQkJCWRlbGV0ZVRleHR1cmUoIHRleHR1cmUgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBzdG9yZSByZWZlcmVuY2VzIHRvIGNhY2hlIGtleSBhbmQgV2ViR0xUZXh0dXJlIG9iamVjdAoKCQkJdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSA9IHRleHR1cmVDYWNoZUtleTsKCQkJdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPSB3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlQ2FjaGVLZXkgXS50ZXh0dXJlOwoKCQl9CgoJCXJldHVybiBmb3JjZVVwbG9hZDsKCgl9CgoJZnVuY3Rpb24gdXBsb2FkVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QgKSB7CgoJCWxldCB0ZXh0dXJlVHlwZSA9IF9nbC5URVhUVVJFXzJEOwoKCQlpZiAoIHRleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlIHx8IHRleHR1cmUuaXNDb21wcmVzc2VkQXJyYXlUZXh0dXJlICkgdGV4dHVyZVR5cGUgPSBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKCQlpZiAoIHRleHR1cmUuaXNEYXRhM0RUZXh0dXJlICkgdGV4dHVyZVR5cGUgPSBfZ2wuVEVYVFVSRV8zRDsKCgkJY29uc3QgZm9yY2VVcGxvYWQgPSBpbml0VGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUgKTsKCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCgkJc3RhdGUuYmluZFRleHR1cmUoIHRleHR1cmVUeXBlLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCQljb25zdCBzb3VyY2VQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHNvdXJjZSApOwoKCQlpZiAoIHNvdXJjZS52ZXJzaW9uICE9PSBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiB8fCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApIHsKCgkJCXN0YXRlLmFjdGl2ZVRleHR1cmUoIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgkJCWNvbnN0IHdvcmtpbmdQcmltYXJpZXMgPSBDb2xvck1hbmFnZW1lbnQuZ2V0UHJpbWFyaWVzKCBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgKTsKCQkJY29uc3QgdGV4dHVyZVByaW1hcmllcyA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlID8gbnVsbCA6IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCQljb25zdCB1bnBhY2tDb252ZXJzaW9uID0gdGV4dHVyZS5jb2xvclNwYWNlID09PSBOb0NvbG9yU3BhY2UgfHwgd29ya2luZ1ByaW1hcmllcyA9PT0gdGV4dHVyZVByaW1hcmllcyA/IF9nbC5OT05FIDogX2dsLkJST1dTRVJfREVGQVVMVF9XRUJHTDsKCgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19GTElQX1lfV0VCR0wsIHRleHR1cmUuZmxpcFkgKTsKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0FMSUdOTUVOVCwgdGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0NPTE9SU1BBQ0VfQ09OVkVSU0lPTl9XRUJHTCwgdW5wYWNrQ29udmVyc2lvbiApOwoKCQkJY29uc3QgbmVlZHNQb3dlck9mVHdvID0gdGV4dHVyZU5lZWRzUG93ZXJPZlR3byggdGV4dHVyZSApICYmIGlzUG93ZXJPZlR3byQxKCB0ZXh0dXJlLmltYWdlICkgPT09IGZhbHNlOwoJCQlsZXQgaW1hZ2UgPSByZXNpemVJbWFnZSggdGV4dHVyZS5pbWFnZSwgbmVlZHNQb3dlck9mVHdvLCBmYWxzZSwgY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplICk7CgkJCWltYWdlID0gdmVyaWZ5Q29sb3JTcGFjZSggdGV4dHVyZSwgaW1hZ2UgKTsKCgkJCWNvbnN0IHN1cHBvcnRzTWlwcyA9IGlzUG93ZXJPZlR3byQxKCBpbWFnZSApIHx8IGlzV2ViR0wyLAoJCQkJZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgoJCQlsZXQgZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICksCgkJCQlnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSwgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApOwoKCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIHRleHR1cmVUeXBlLCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKTsKCgkJCWxldCBtaXBtYXA7CgkJCWNvbnN0IG1pcG1hcHMgPSB0ZXh0dXJlLm1pcG1hcHM7CgoJCQljb25zdCB1c2VUZXhTdG9yYWdlID0gKCBpc1dlYkdMMiAmJiB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlICE9PSB0cnVlICYmIGdsSW50ZXJuYWxGb3JtYXQgIT09IFJHQl9FVEMxX0Zvcm1hdCApOwoJCQljb25zdCBhbGxvY2F0ZU1lbW9yeSA9ICggc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gPT09IHVuZGVmaW5lZCApIHx8ICggZm9yY2VVcGxvYWQgPT09IHRydWUgKTsKCQkJY29uc3QgbGV2ZWxzID0gZ2V0TWlwTGV2ZWxzKCB0ZXh0dXJlLCBpbWFnZSwgc3VwcG9ydHNNaXBzICk7CgoJCQlpZiAoIHRleHR1cmUuaXNEZXB0aFRleHR1cmUgKSB7CgoJCQkJLy8gcG9wdWxhdGUgZGVwdGggdGV4dHVyZSB3aXRoIGR1bW15IGRhdGEKCgkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIX0NPTVBPTkVOVDsKCgkJCQlpZiAoIGlzV2ViR0wyICkgewoKCQkJCQlpZiAoIHRleHR1cmUudHlwZSA9PT0gRmxvYXRUeXBlICkgewoKCQkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQzMkY7CgoJCQkJCX0gZWxzZSBpZiAoIHRleHR1cmUudHlwZSA9PT0gVW5zaWduZWRJbnRUeXBlICkgewoKCQkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQyNDsKCgkJCQkJfSBlbHNlIGlmICggdGV4dHVyZS50eXBlID09PSBVbnNpZ25lZEludDI0OFR5cGUgKSB7CgoJCQkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIMjRfU1RFTkNJTDg7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIX0NPTVBPTkVOVDE2OyAvLyBXZWJHTDIgcmVxdWlyZXMgc2l6ZWQgaW50ZXJuYWxmb3JtYXQgZm9yIGdsVGV4SW1hZ2UyRAoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJaWYgKCB0ZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSApIHsKCgkJCQkJCWNvbnNvbGUuZXJyb3IoICdXZWJHTFJlbmRlcmVyOiBGbG9hdGluZyBwb2ludCBkZXB0aCB0ZXh0dXJlIHJlcXVpcmVzIFdlYkdMMi4nICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gdmFsaWRhdGlvbiBjaGVja3MgZm9yIFdlYkdMIDEKCgkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ID09PSBEZXB0aEZvcm1hdCAmJiBnbEludGVybmFsRm9ybWF0ID09PSBfZ2wuREVQVEhfQ09NUE9ORU5UICkgewoKCQkJCQkvLyBUaGUgZXJyb3IgSU5WQUxJRF9PUEVSQVRJT04gaXMgZ2VuZXJhdGVkIGJ5IHRleEltYWdlMkQgaWYgZm9ybWF0IGFuZCBpbnRlcm5hbGZvcm1hdCBhcmUKCQkJCQkvLyBERVBUSF9DT01QT05FTlQgYW5kIHR5cGUgaXMgbm90IFVOU0lHTkVEX1NIT1JUIG9yIFVOU0lHTkVEX0lOVAoJCQkJCS8vIChodHRwczovL3d3dy5raHJvbm9zLm9yZy9yZWdpc3RyeS93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2RlcHRoX3RleHR1cmUvKQoJCQkJCWlmICggdGV4dHVyZS50eXBlICE9PSBVbnNpZ25lZFNob3J0VHlwZSAmJiB0ZXh0dXJlLnR5cGUgIT09IFVuc2lnbmVkSW50VHlwZSApIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFVzZSBVbnNpZ25lZFNob3J0VHlwZSBvciBVbnNpZ25lZEludFR5cGUgZm9yIERlcHRoRm9ybWF0IERlcHRoVGV4dHVyZS4nICk7CgoJCQkJCQl0ZXh0dXJlLnR5cGUgPSBVbnNpZ25lZEludFR5cGU7CgkJCQkJCWdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgPT09IERlcHRoU3RlbmNpbEZvcm1hdCAmJiBnbEludGVybmFsRm9ybWF0ID09PSBfZ2wuREVQVEhfQ09NUE9ORU5UICkgewoKCQkJCQkvLyBEZXB0aCBzdGVuY2lsIHRleHR1cmVzIG5lZWQgdGhlIERFUFRIX1NURU5DSUwgaW50ZXJuYWwgZm9ybWF0CgkJCQkJLy8gKGh0dHBzOi8vd3d3Lmtocm9ub3Mub3JnL3JlZ2lzdHJ5L3dlYmdsL2V4dGVuc2lvbnMvV0VCR0xfZGVwdGhfdGV4dHVyZS8pCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9TVEVOQ0lMOwoKCQkJCQkvLyBUaGUgZXJyb3IgSU5WQUxJRF9PUEVSQVRJT04gaXMgZ2VuZXJhdGVkIGJ5IHRleEltYWdlMkQgaWYgZm9ybWF0IGFuZCBpbnRlcm5hbGZvcm1hdCBhcmUKCQkJCQkvLyBERVBUSF9TVEVOQ0lMIGFuZCB0eXBlIGlzIG5vdCBVTlNJR05FRF9JTlRfMjRfOF9XRUJHTC4KCQkJCQkvLyAoaHR0cHM6Ly93d3cua2hyb25vcy5vcmcvcmVnaXN0cnkvd2ViZ2wvZXh0ZW5zaW9ucy9XRUJHTF9kZXB0aF90ZXh0dXJlLykKCQkJCQlpZiAoIHRleHR1cmUudHlwZSAhPT0gVW5zaWduZWRJbnQyNDhUeXBlICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVXNlIFVuc2lnbmVkSW50MjQ4VHlwZSBmb3IgRGVwdGhTdGVuY2lsRm9ybWF0IERlcHRoVGV4dHVyZS4nICk7CgoJCQkJCQl0ZXh0dXJlLnR5cGUgPSBVbnNpZ25lZEludDI0OFR5cGU7CgkJCQkJCWdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vCgoJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMSwgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNEYXRhVGV4dHVyZSApIHsKCgkJCQkvLyB1c2UgbWFudWFsbHkgY3JlYXRlZCBtaXBtYXBzIGlmIGF2YWlsYWJsZQoJCQkJLy8gaWYgdGhlcmUgYXJlIG5vIG1hbnVhbCBtaXBtYXBzCgkJCQkvLyBzZXQgMCBsZXZlbCBtaXBtYXAgYW5kIHRoZW4gdXNlIEdMIHRvIGdlbmVyYXRlIG90aGVyIG1pcG1hcCBsZXZlbHMKCgkJCQlpZiAoIG1pcG1hcHMubGVuZ3RoID4gMCAmJiBzdXBwb3J0c01pcHMgKSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQl0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJCQl9CgoJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSApIHsKCgkJCQlpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkQXJyYXlUZXh0dXJlICkgewoKCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcHNbIDAgXS53aWR0aCwgbWlwbWFwc1sgMCBdLmhlaWdodCwgaW1hZ2UuZGVwdGggKTsKCgkJCQkJfQoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbWlwbWFwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCgkJCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgIT09IFJHQkFGb3JtYXQgKSB7CgoJCQkJCQkJaWYgKCBnbEZvcm1hdCAhPT0gbnVsbCApIHsKCgkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleFN1YkltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBpLCAwLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgbWlwbWFwLmRhdGEsIDAsIDAgKTsKCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgbWlwbWFwLmRhdGEsIDAsIDAgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gbG9hZCB1bnN1cHBvcnRlZCBjb21wcmVzc2VkIHRleHR1cmUgZm9ybWF0IGluIC51cGxvYWRUZXh0dXJlKCknICk7CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBpLCAwLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLnRleEltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBpLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGltYWdlLmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgoJCQkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ICE9PSBSR0JBRm9ybWF0ICkgewoKCQkJCQkJCWlmICggZ2xGb3JtYXQgIT09IG51bGwgKSB7CgoJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgMCwgMCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBnbEZvcm1hdCwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQXR0ZW1wdCB0byBsb2FkIHVuc3VwcG9ydGVkIGNvbXByZXNzZWQgdGV4dHVyZSBmb3JtYXQgaW4gLnVwbG9hZFRleHR1cmUoKScgKTsKCgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlICkgewoKCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCXN0YXRlLnRleFN0b3JhZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGggKTsKCgkJCQkJfQoKCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgMCwgMCwgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGgsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGgsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCgkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlM0QoIF9nbC5URVhUVVJFXzNELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoICk7CgoJCQkJCX0KCgkJCQkJc3RhdGUudGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfM0QsIDAsIDAsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc3RhdGUudGV4SW1hZ2UzRCggX2dsLlRFWFRVUkVfM0QsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0ZyYW1lYnVmZmVyVGV4dHVyZSApIHsKCgkJCQlpZiAoIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWxldCB3aWR0aCA9IGltYWdlLndpZHRoLCBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBsZXZlbHM7IGkgKysgKSB7CgoJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIGdsSW50ZXJuYWxGb3JtYXQsIHdpZHRoLCBoZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCgkJCQkJCQl3aWR0aCA+Pj0gMTsKCQkJCQkJCWhlaWdodCA+Pj0gMTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJLy8gcmVndWxhciBUZXh0dXJlIChpbWFnZSwgdmlkZW8sIGNhbnZhcykKCgkJCQkvLyB1c2UgbWFudWFsbHkgY3JlYXRlZCBtaXBtYXBzIGlmIGF2YWlsYWJsZQoJCQkJLy8gaWYgdGhlcmUgYXJlIG5vIG1hbnVhbCBtaXBtYXBzCgkJCQkvLyBzZXQgMCBsZXZlbCBtaXBtYXAgYW5kIHRoZW4gdXNlIEdMIHRvIGdlbmVyYXRlIG90aGVyIG1pcG1hcCBsZXZlbHMKCgkJCQlpZiAoIG1pcG1hcHMubGVuZ3RoID4gMCAmJiBzdXBwb3J0c01pcHMgKSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQlpZiAoIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKCQkJCQkJfQoKCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKSApIHsKCgkJCQlnZW5lcmF0ZU1pcG1hcCggdGV4dHVyZVR5cGUgKTsKCgkJCX0KCgkJCXNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uID0gc291cmNlLnZlcnNpb247CgoJCQlpZiAoIHRleHR1cmUub25VcGRhdGUgKSB0ZXh0dXJlLm9uVXBkYXRlKCB0ZXh0dXJlICk7CgoJCX0KCgkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKCX0KCglmdW5jdGlvbiB1cGxvYWRDdWJlVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QgKSB7CgoJCWlmICggdGV4dHVyZS5pbWFnZS5sZW5ndGggIT09IDYgKSByZXR1cm47CgoJCWNvbnN0IGZvcmNlVXBsb2FkID0gaW5pdFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlICk7CgkJY29uc3Qgc291cmNlID0gdGV4dHVyZS5zb3VyY2U7CgoJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgkJY29uc3Qgc291cmNlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBzb3VyY2UgKTsKCgkJaWYgKCBzb3VyY2UudmVyc2lvbiAhPT0gc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gfHwgZm9yY2VVcGxvYWQgPT09IHRydWUgKSB7CgoJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJCQljb25zdCB3b3JraW5nUHJpbWFyaWVzID0gQ29sb3JNYW5hZ2VtZW50LmdldFByaW1hcmllcyggQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICk7CgkJCWNvbnN0IHRleHR1cmVQcmltYXJpZXMgPSB0ZXh0dXJlLmNvbG9yU3BhY2UgPT09IE5vQ29sb3JTcGFjZSA/IG51bGwgOiBDb2xvck1hbmFnZW1lbnQuZ2V0UHJpbWFyaWVzKCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCQkJY29uc3QgdW5wYWNrQ29udmVyc2lvbiA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlIHx8IHdvcmtpbmdQcmltYXJpZXMgPT09IHRleHR1cmVQcmltYXJpZXMgPyBfZ2wuTk9ORSA6IF9nbC5CUk9XU0VSX0RFRkFVTFRfV0VCR0w7CgoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCB0ZXh0dXJlLmZsaXBZICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgdGV4dHVyZS5wcmVtdWx0aXBseUFscGhhICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19BTElHTk1FTlQsIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19DT0xPUlNQQUNFX0NPTlZFUlNJT05fV0VCR0wsIHVucGFja0NvbnZlcnNpb24gKTsKCgkJCWNvbnN0IGlzQ29tcHJlc3NlZCA9ICggdGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlIHx8IHRleHR1cmUuaW1hZ2VbIDAgXS5pc0NvbXByZXNzZWRUZXh0dXJlICk7CgkJCWNvbnN0IGlzRGF0YVRleHR1cmUgPSAoIHRleHR1cmUuaW1hZ2VbIDAgXSAmJiB0ZXh0dXJlLmltYWdlWyAwIF0uaXNEYXRhVGV4dHVyZSApOwoKCQkJY29uc3QgY3ViZUltYWdlID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCWlmICggISBpc0NvbXByZXNzZWQgJiYgISBpc0RhdGFUZXh0dXJlICkgewoKCQkJCQljdWJlSW1hZ2VbIGkgXSA9IHJlc2l6ZUltYWdlKCB0ZXh0dXJlLmltYWdlWyBpIF0sIGZhbHNlLCB0cnVlLCBjYXBhYmlsaXRpZXMubWF4Q3ViZW1hcFNpemUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljdWJlSW1hZ2VbIGkgXSA9IGlzRGF0YVRleHR1cmUgPyB0ZXh0dXJlLmltYWdlWyBpIF0uaW1hZ2UgOiB0ZXh0dXJlLmltYWdlWyBpIF07CgoJCQkJfQoKCQkJCWN1YmVJbWFnZVsgaSBdID0gdmVyaWZ5Q29sb3JTcGFjZSggdGV4dHVyZSwgY3ViZUltYWdlWyBpIF0gKTsKCgkJCX0KCgkJCWNvbnN0IGltYWdlID0gY3ViZUltYWdlWyAwIF0sCgkJCQlzdXBwb3J0c01pcHMgPSBpc1Bvd2VyT2ZUd28kMSggaW1hZ2UgKSB8fCBpc1dlYkdMMiwKCQkJCWdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUuY29sb3JTcGFjZSApLAoJCQkJZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICksCgkJCQlnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSApOwoKCQkJY29uc3QgdXNlVGV4U3RvcmFnZSA9ICggaXNXZWJHTDIgJiYgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSAhPT0gdHJ1ZSApOwoJCQljb25zdCBhbGxvY2F0ZU1lbW9yeSA9ICggc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gPT09IHVuZGVmaW5lZCApIHx8ICggZm9yY2VVcGxvYWQgPT09IHRydWUgKTsKCQkJbGV0IGxldmVscyA9IGdldE1pcExldmVscyggdGV4dHVyZSwgaW1hZ2UsIHN1cHBvcnRzTWlwcyApOwoKCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKTsKCgkJCWxldCBtaXBtYXBzOwoKCQkJaWYgKCBpc0NvbXByZXNzZWQgKSB7CgoJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCgkJCQl9CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQkJbWlwbWFwcyA9IGN1YmVJbWFnZVsgaSBdLm1pcG1hcHM7CgoJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJY29uc3QgbWlwbWFwID0gbWlwbWFwc1sgaiBdOwoKCQkJCQkJaWYgKCB0ZXh0dXJlLmZvcm1hdCAhPT0gUkdCQUZvcm1hdCApIHsKCgkJCQkJCQlpZiAoIGdsRm9ybWF0ICE9PSBudWxsICkgewoKCQkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGosIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgZ2xGb3JtYXQsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGosIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgMCwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gbG9hZCB1bnN1cHBvcnRlZCBjb21wcmVzc2VkIHRleHR1cmUgZm9ybWF0IGluIC5zZXRUZXh0dXJlQ3ViZSgpJyApOwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiwgMCwgMCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQltaXBtYXBzID0gdGV4dHVyZS5taXBtYXBzOwoKCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJLy8gVE9ETzogVW5pZm9ybWx5IGhhbmRsZSBtaXBtYXAgZGVmaW5pdGlvbnMKCQkJCQkvLyBOb3JtYWwgdGV4dHVyZXMgYW5kIGNvbXByZXNzZWQgY3ViZSB0ZXh0dXJlcyBkZWZpbmUgYmFzZSBsZXZlbCArIG1pcHMgd2l0aCB0aGVpciBtaXBtYXAgYXJyYXkKCQkJCQkvLyBVbmNvbXByZXNzZWQgY3ViZSB0ZXh0dXJlcyB1c2UgdGhlaXIgbWlwbWFwIGFycmF5IG9ubHkgZm9yIG1pcHMgKG5vIGJhc2UgbGV2ZWwpCgoJCQkJCWlmICggbWlwbWFwcy5sZW5ndGggPiAwICkgbGV2ZWxzICsrOwoKCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGN1YmVJbWFnZVsgMCBdLndpZHRoLCBjdWJlSW1hZ2VbIDAgXS5oZWlnaHQgKTsKCgkJCQl9CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQkJaWYgKCBpc0RhdGFUZXh0dXJlICkgewoKCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCAwLCAwLCBjdWJlSW1hZ2VbIGkgXS53aWR0aCwgY3ViZUltYWdlWyBpIF0uaGVpZ2h0LCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXS5kYXRhICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCBnbEludGVybmFsRm9ybWF0LCBjdWJlSW1hZ2VbIGkgXS53aWR0aCwgY3ViZUltYWdlWyBpIF0uaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXS5kYXRhICk7CgoJCQkJCQl9CgoJCQkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCBtaXBtYXBzLmxlbmd0aDsgaiArKyApIHsKCgkJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgkJCQkJCQljb25zdCBtaXBtYXBJbWFnZSA9IG1pcG1hcC5pbWFnZVsgaSBdLmltYWdlOwoKCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGogKyAxLCAwLCAwLCBtaXBtYXBJbWFnZS53aWR0aCwgbWlwbWFwSW1hZ2UuaGVpZ2h0LCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXBJbWFnZS5kYXRhICk7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGogKyAxLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXBJbWFnZS53aWR0aCwgbWlwbWFwSW1hZ2UuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXBJbWFnZS5kYXRhICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCAwLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgY3ViZUltYWdlWyBpIF0gKTsKCgkJCQkJCX0KCgkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJCWNvbnN0IG1pcG1hcCA9IG1pcG1hcHNbIGogXTsKCgkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqICsgMSwgMCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmltYWdlWyBpIF0gKTsKCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiArIDEsIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5pbWFnZVsgaSBdICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUsIHN1cHBvcnRzTWlwcyApICkgewoKCQkJCS8vIFdlIGFzc3VtZSBpbWFnZXMgZm9yIGN1YmUgbWFwIGhhdmUgdGhlIHNhbWUgc2l6ZS4KCQkJCWdlbmVyYXRlTWlwbWFwKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCApOwoKCQkJfQoKCQkJc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gPSBzb3VyY2UudmVyc2lvbjsKCgkJCWlmICggdGV4dHVyZS5vblVwZGF0ZSApIHRleHR1cmUub25VcGRhdGUoIHRleHR1cmUgKTsKCgkJfQoKCQl0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gPSB0ZXh0dXJlLnZlcnNpb247CgoJfQoKCS8vIFJlbmRlciB0YXJnZXRzCgoJLy8gU2V0dXAgc3RvcmFnZSBmb3IgdGFyZ2V0IHRleHR1cmUgYW5kIGJpbmQgaXQgdG8gY29ycmVjdCBmcmFtZWJ1ZmZlcgoJZnVuY3Rpb24gc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUoIGZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQsIHRleHR1cmUsIGF0dGFjaG1lbnQsIHRleHR1cmVUYXJnZXQsIGxldmVsICkgewoKCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCQljb25zdCBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKTsKCQljb25zdCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCWlmICggISByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9faGFzRXh0ZXJuYWxUZXh0dXJlcyApIHsKCgkJCWNvbnN0IHdpZHRoID0gTWF0aC5tYXgoIDEsIHJlbmRlclRhcmdldC53aWR0aCA+PiBsZXZlbCApOwoJCQljb25zdCBoZWlnaHQgPSBNYXRoLm1heCggMSwgcmVuZGVyVGFyZ2V0LmhlaWdodCA+PiBsZXZlbCApOwoKCQkJaWYgKCB0ZXh0dXJlVGFyZ2V0ID09PSBfZ2wuVEVYVFVSRV8zRCB8fCB0ZXh0dXJlVGFyZ2V0ID09PSBfZ2wuVEVYVFVSRV8yRF9BUlJBWSApIHsKCgkJCQlzdGF0ZS50ZXhJbWFnZTNEKCB0ZXh0dXJlVGFyZ2V0LCBsZXZlbCwgZ2xJbnRlcm5hbEZvcm1hdCwgd2lkdGgsIGhlaWdodCwgcmVuZGVyVGFyZ2V0LmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgoJCQl9IGVsc2UgewoKCQkJCXN0YXRlLnRleEltYWdlMkQoIHRleHR1cmVUYXJnZXQsIGxldmVsLCBnbEludGVybmFsRm9ybWF0LCB3aWR0aCwgaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgoJCQl9CgoJCX0KCgkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyICk7CgoJCWlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCgkJCW11bHRpc2FtcGxlZFJUVEV4dC5mcmFtZWJ1ZmZlclRleHR1cmUyRE11bHRpc2FtcGxlRVhUKCBfZ2wuRlJBTUVCVUZGRVIsIGF0dGFjaG1lbnQsIHRleHR1cmVUYXJnZXQsIHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX193ZWJnbFRleHR1cmUsIDAsIGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApICk7CgoJCX0gZWxzZSBpZiAoIHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzJEIHx8ICggdGV4dHVyZVRhcmdldCA+PSBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICYmIHRleHR1cmVUYXJnZXQgPD0gX2dsLlRFWFRVUkVfQ1VCRV9NQVBfTkVHQVRJVkVfWiApICkgeyAvLyBzZWUgIzI0NzUzCgoJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCwgcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSwgbGV2ZWwgKTsKCgkJfQoKCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgbnVsbCApOwoKCX0KCgoJLy8gU2V0dXAgc3RvcmFnZSBmb3IgaW50ZXJuYWwgZGVwdGgvc3RlbmNpbCBidWZmZXJzIGFuZCBiaW5kIHRvIGNvcnJlY3QgZnJhbWVidWZmZXIKCWZ1bmN0aW9uIHNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyYnVmZmVyLCByZW5kZXJUYXJnZXQsIGlzTXVsdGlzYW1wbGUgKSB7CgoJCV9nbC5iaW5kUmVuZGVyYnVmZmVyKCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJidWZmZXIgKTsKCgkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgJiYgISByZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlciApIHsKCgkJCWxldCBnbEludGVybmFsRm9ybWF0ID0gKCBpc1dlYkdMMiA9PT0gdHJ1ZSApID8gX2dsLkRFUFRIX0NPTVBPTkVOVDI0IDogX2dsLkRFUFRIX0NPTVBPTkVOVDE2OwoKCQkJaWYgKCBpc011bHRpc2FtcGxlIHx8IHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgKSB7CgoJCQkJY29uc3QgZGVwdGhUZXh0dXJlID0gcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZTsKCgkJCQlpZiAoIGRlcHRoVGV4dHVyZSAmJiBkZXB0aFRleHR1cmUuaXNEZXB0aFRleHR1cmUgKSB7CgoJCQkJCWlmICggZGVwdGhUZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSApIHsKCgkJCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBfZ2wuREVQVEhfQ09NUE9ORU5UMzJGOwoKCQkJCQl9IGVsc2UgaWYgKCBkZXB0aFRleHR1cmUudHlwZSA9PT0gVW5zaWduZWRJbnRUeXBlICkgewoKCQkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQyNDsKCgkJCQkJfQoKCQkJCX0KCgkJCQljb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKCQkJCQltdWx0aXNhbXBsZWRSVFRFeHQucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlRVhUKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlKCBfZ2wuUkVOREVSQlVGRkVSLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCX0KCgkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuREVQVEhfQVRUQUNITUVOVCwgX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgoJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciAmJiByZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlciApIHsKCgkJCWNvbnN0IHNhbXBsZXMgPSBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKTsKCgkJCWlmICggaXNNdWx0aXNhbXBsZSAmJiB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApID09PSBmYWxzZSApIHsKCgkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBfZ2wuREVQVEgyNF9TVEVOQ0lMOCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQl9IGVsc2UgaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKCQkJCW11bHRpc2FtcGxlZFJUVEV4dC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGVFWFQoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIF9nbC5ERVBUSDI0X1NURU5DSUw4LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoIF9nbC5SRU5ERVJCVUZGRVIsIF9nbC5ERVBUSF9TVEVOQ0lMLCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCX0KCgoJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgoJCX0gZWxzZSB7CgoJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzID09PSB0cnVlID8gcmVuZGVyVGFyZ2V0LnRleHR1cmUgOiBbIHJlbmRlclRhcmdldC50ZXh0dXJlIF07CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgoJCQkJY29uc3QgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJCQljb25zdCBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKTsKCQkJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJCQljb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJaWYgKCBpc011bHRpc2FtcGxlICYmIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgPT09IGZhbHNlICkgewoKCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQl9IGVsc2UgaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKCQkJCQltdWx0aXNhbXBsZWRSVFRFeHQucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlRVhUKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZSggX2dsLlJFTkRFUkJVRkZFUiwgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCV9nbC5iaW5kUmVuZGVyYnVmZmVyKCBfZ2wuUkVOREVSQlVGRkVSLCBudWxsICk7CgoJfQoKCS8vIFNldHVwIHJlc291cmNlcyBmb3IgYSBEZXB0aCBUZXh0dXJlIGZvciBhIEZCTyAobmVlZHMgYW4gZXh0ZW5zaW9uKQoJZnVuY3Rpb24gc2V0dXBEZXB0aFRleHR1cmUoIGZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQgKSB7CgoJCWNvbnN0IGlzQ3ViZSA9ICggcmVuZGVyVGFyZ2V0ICYmIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCApOwoJCWlmICggaXNDdWJlICkgdGhyb3cgbmV3IEVycm9yKCAnRGVwdGggVGV4dHVyZSB3aXRoIGN1YmUgcmVuZGVyIHRhcmdldHMgaXMgbm90IHN1cHBvcnRlZCcgKTsKCgkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyICk7CgoJCWlmICggISAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgJiYgcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pc0RlcHRoVGV4dHVyZSApICkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAncmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIFRIUkVFLkRlcHRoVGV4dHVyZScgKTsKCgkJfQoKCQkvLyB1cGxvYWQgYW4gZW1wdHkgZGVwdGggdGV4dHVyZSB3aXRoIGZyYW1lYnVmZmVyIHNpemUKCQlpZiAoICEgcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSB8fAoJCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pbWFnZS53aWR0aCAhPT0gcmVuZGVyVGFyZ2V0LndpZHRoIHx8CgkJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmltYWdlLmhlaWdodCAhPT0gcmVuZGVyVGFyZ2V0LmhlaWdodCApIHsKCgkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggPSByZW5kZXJUYXJnZXQud2lkdGg7CgkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2UuaGVpZ2h0ID0gcmVuZGVyVGFyZ2V0LmhlaWdodDsKCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJc2V0VGV4dHVyZTJEKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLCAwICk7CgoJCWNvbnN0IHdlYmdsRGVwdGhUZXh0dXJlID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZTsKCQljb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICk7CgoJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5mb3JtYXQgPT09IERlcHRoRm9ybWF0ICkgewoKCQkJaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKCQkJCW11bHRpc2FtcGxlZFJUVEV4dC5mcmFtZWJ1ZmZlclRleHR1cmUyRE11bHRpc2FtcGxlRVhUKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9BVFRBQ0hNRU5ULCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xEZXB0aFRleHR1cmUsIDAsIHNhbXBsZXMgKTsKCgkJCX0gZWxzZSB7CgoJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9BVFRBQ0hNRU5ULCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xEZXB0aFRleHR1cmUsIDAgKTsKCgkJCX0KCgkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5mb3JtYXQgPT09IERlcHRoU3RlbmNpbEZvcm1hdCApIHsKCgkJCWlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCgkJCQltdWx0aXNhbXBsZWRSVFRFeHQuZnJhbWVidWZmZXJUZXh0dXJlMkRNdWx0aXNhbXBsZUVYVCggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5ULCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xEZXB0aFRleHR1cmUsIDAsIHNhbXBsZXMgKTsKCgkJCX0gZWxzZSB7CgoJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIF9nbC5URVhUVVJFXzJELCB3ZWJnbERlcHRoVGV4dHVyZSwgMCApOwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnVW5rbm93biBkZXB0aFRleHR1cmUgZm9ybWF0JyApOwoKCQl9CgoJfQoKCS8vIFNldHVwIEdMIHJlc291cmNlcyBmb3IgYSBub24tdGV4dHVyZSBkZXB0aCBidWZmZXIKCWZ1bmN0aW9uIHNldHVwRGVwdGhSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldCApIHsKCgkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCQljb25zdCBpc0N1YmUgPSAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCA9PT0gdHJ1ZSApOwoKCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgJiYgISByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYXV0b0FsbG9jYXRlRGVwdGhCdWZmZXIgKSB7CgoJCQlpZiAoIGlzQ3ViZSApIHRocm93IG5ldyBFcnJvciggJ3RhcmdldC5kZXB0aFRleHR1cmUgbm90IHN1cHBvcnRlZCBpbiBDdWJlIHJlbmRlciB0YXJnZXRzJyApOwoKCQkJc2V0dXBEZXB0aFRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQgKTsKCgkJfSBlbHNlIHsKCgkJCWlmICggaXNDdWJlICkgewoKCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyID0gW107CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gKTsKCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdID0gX2dsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwoJCQkJCXNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXJbIGkgXSwgcmVuZGVyVGFyZ2V0LCBmYWxzZSApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciA9IF9nbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKCQkJCXNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIsIHJlbmRlclRhcmdldCwgZmFsc2UgKTsKCgkJCX0KCgkJfQoKCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgbnVsbCApOwoKCX0KCgkvLyByZWJpbmQgZnJhbWVidWZmZXIgd2l0aCBleHRlcm5hbCB0ZXh0dXJlcwoJZnVuY3Rpb24gcmViaW5kVGV4dHVyZXMoIHJlbmRlclRhcmdldCwgY29sb3JUZXh0dXJlLCBkZXB0aFRleHR1cmUgKSB7CgoJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCWlmICggY29sb3JUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgcmVuZGVyVGFyZ2V0LnRleHR1cmUsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfMkQsIDAgKTsKCgkJfQoKCQlpZiAoIGRlcHRoVGV4dHVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlciggcmVuZGVyVGFyZ2V0ICk7CgoJCX0KCgl9CgoJLy8gU2V0IHVwIEdMIHJlc291cmNlcyBmb3IgdGhlIHJlbmRlciB0YXJnZXQKCWZ1bmN0aW9uIHNldHVwUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgoJCWNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKCgkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCXJlbmRlclRhcmdldC5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uUmVuZGVyVGFyZ2V0RGlzcG9zZSApOwoKCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzICE9PSB0cnVlICkgewoKCQkJaWYgKCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID0gX2dsLmNyZWF0ZVRleHR1cmUoKTsKCgkJCX0KCgkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9IHRleHR1cmUudmVyc2lvbjsKCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgKys7CgoJCX0KCgkJY29uc3QgaXNDdWJlID0gKCByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgPT09IHRydWUgKTsKCQljb25zdCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyA9ICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMgPT09IHRydWUgKTsKCQljb25zdCBzdXBwb3J0c01pcHMgPSBpc1Bvd2VyT2ZUd28kMSggcmVuZGVyVGFyZ2V0ICkgfHwgaXNXZWJHTDI7CgoJCS8vIFNldHVwIGZyYW1lYnVmZmVyCgoJCWlmICggaXNDdWJlICkgewoKCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBbXTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJaWYgKCBpc1dlYkdMMiAmJiB0ZXh0dXJlLm1pcG1hcHMgJiYgdGV4dHVyZS5taXBtYXBzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gPSBbXTsKCgkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF1bIGxldmVsIF0gPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCgkJCQl9CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGlzV2ViR0wyICYmIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IFtdOwoKCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgdGV4dHVyZS5taXBtYXBzLmxlbmd0aDsgbGV2ZWwgKysgKSB7CgoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBsZXZlbCBdID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJfQoKCQkJaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQlpZiAoIGNhcGFiaWxpdGllcy5kcmF3QnVmZmVycyApIHsKCgkJCQkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJY29uc3QgYXR0YWNobWVudFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZXNbIGkgXSApOwoKCQkJCQkJaWYgKCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCWF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID0gX2dsLmNyZWF0ZVRleHR1cmUoKTsKCgkJCQkJCQlpbmZvLm1lbW9yeS50ZXh0dXJlcyArKzsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFdlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCBXZWJHTDIgb3IgV0VCR0xfZHJhd19idWZmZXJzIGV4dGVuc2lvbi4nICk7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCAoIGlzV2ViR0wyICYmIHJlbmRlclRhcmdldC5zYW1wbGVzID4gMCApICYmIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgPT09IGZhbHNlICkgewoKCQkJCWNvbnN0IHRleHR1cmVzID0gaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgPyB0ZXh0dXJlIDogWyB0ZXh0dXJlIF07CgoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyID0gW107CgoJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQljb25zdCB0ZXh0dXJlID0gdGV4dHVyZXNbIGkgXTsKCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdID0gX2dsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwoKCQkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApOwoKCQkJCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCQkJCQljb25zdCBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKTsKCQkJCQljb25zdCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSwgcmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgKTsKCQkJCQljb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICk7CgkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZSggX2dsLlJFTkRFUkJVRkZFUiwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJfQoKCQkJCV9nbC5iaW5kUmVuZGVyYnVmZmVyKCBfZ2wuUkVOREVSQlVGRkVSLCBudWxsICk7CgoJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSB7CgoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyID0gX2dsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwoJCQkJCXNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhSZW5kZXJidWZmZXIsIHJlbmRlclRhcmdldCwgdHJ1ZSApOwoKCQkJCX0KCgkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgbnVsbCApOwoKCQkJfQoKCQl9CgoJCS8vIFNldHVwIGNvbG9yIGJ1ZmZlcgoKCQlpZiAoIGlzQ3ViZSApIHsKCgkJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJaWYgKCBpc1dlYkdMMiAmJiB0ZXh0dXJlLm1pcG1hcHMgJiYgdGV4dHVyZS5taXBtYXBzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgdGV4dHVyZS5taXBtYXBzLmxlbmd0aDsgbGV2ZWwgKysgKSB7CgoJCQkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBsZXZlbCApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0sIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgMCApOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKSApIHsKCgkJCQlnZW5lcmF0ZU1pcG1hcCggX2dsLlRFWFRVUkVfQ1VCRV9NQVAgKTsKCgkJCX0KCgkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJfSBlbHNlIGlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgoJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCWNvbnN0IGF0dGFjaG1lbnQgPSB0ZXh0dXJlc1sgaSBdOwoJCQkJY29uc3QgYXR0YWNobWVudFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggYXR0YWNobWVudCApOwoKCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV8yRCwgYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV8yRCwgYXR0YWNobWVudCwgc3VwcG9ydHNNaXBzICk7CgkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgYXR0YWNobWVudCwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlRFWFRVUkVfMkQsIDAgKTsKCgkJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggYXR0YWNobWVudCwgc3VwcG9ydHNNaXBzICkgKSB7CgoJCQkJCWdlbmVyYXRlTWlwbWFwKCBfZ2wuVEVYVFVSRV8yRCApOwoKCQkJCX0KCgkJCX0KCgkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJfSBlbHNlIHsKCgkJCWxldCBnbFRleHR1cmVUeXBlID0gX2dsLlRFWFRVUkVfMkQ7CgoJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMM0RSZW5kZXJUYXJnZXQgfHwgcmVuZGVyVGFyZ2V0LmlzV2ViR0xBcnJheVJlbmRlclRhcmdldCApIHsKCgkJCQlpZiAoIGlzV2ViR0wyICkgewoKCQkJCQlnbFRleHR1cmVUeXBlID0gcmVuZGVyVGFyZ2V0LmlzV2ViR0wzRFJlbmRlclRhcmdldCA/IF9nbC5URVhUVVJFXzNEIDogX2dsLlRFWFRVUkVfMkRfQVJSQVk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMVGV4dHVyZXM6IFRIUkVFLkRhdGEzRFRleHR1cmUgYW5kIFRIUkVFLkRhdGFBcnJheVRleHR1cmUgb25seSBzdXBwb3J0ZWQgd2l0aCBXZWJHTDIuJyApOwoKCQkJCX0KCgkJCX0KCgkJCXN0YXRlLmJpbmRUZXh0dXJlKCBnbFRleHR1cmVUeXBlLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoJCQlzZXRUZXh0dXJlUGFyYW1ldGVycyggZ2xUZXh0dXJlVHlwZSwgdGV4dHVyZSwgc3VwcG9ydHNNaXBzICk7CgoJCQlpZiAoIGlzV2ViR0wyICYmIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQlmb3IgKCBsZXQgbGV2ZWwgPSAwOyBsZXZlbCA8IHRleHR1cmUubWlwbWFwcy5sZW5ndGg7IGxldmVsICsrICkgewoKCQkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGxldmVsIF0sIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbFRleHR1cmVUeXBlLCBsZXZlbCApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQsIHRleHR1cmUsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZ2xUZXh0dXJlVHlwZSwgMCApOwoKCQkJfQoKCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUsIHN1cHBvcnRzTWlwcyApICkgewoKCQkJCWdlbmVyYXRlTWlwbWFwKCBnbFRleHR1cmVUeXBlICk7CgoJCQl9CgoJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCX0KCgkJLy8gU2V0dXAgZGVwdGggYW5kIHN0ZW5jaWwgYnVmZmVycwoKCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciApIHsKCgkJCXNldHVwRGVwdGhSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldCApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCggcmVuZGVyVGFyZ2V0ICkgewoKCQljb25zdCBzdXBwb3J0c01pcHMgPSBpc1Bvd2VyT2ZUd28kMSggcmVuZGVyVGFyZ2V0ICkgfHwgaXNXZWJHTDI7CgoJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LmlzV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMgPT09IHRydWUgPyByZW5kZXJUYXJnZXQudGV4dHVyZSA6IFsgcmVuZGVyVGFyZ2V0LnRleHR1cmUgXTsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgoJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgKSB7CgoJCQkJY29uc3QgdGFyZ2V0ID0gcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ID8gX2dsLlRFWFRVUkVfQ1VCRV9NQVAgOiBfZ2wuVEVYVFVSRV8yRDsKCQkJCWNvbnN0IHdlYmdsVGV4dHVyZSA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX193ZWJnbFRleHR1cmU7CgoJCQkJc3RhdGUuYmluZFRleHR1cmUoIHRhcmdldCwgd2ViZ2xUZXh0dXJlICk7CgkJCQlnZW5lcmF0ZU1pcG1hcCggdGFyZ2V0ICk7CgkJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCQl9CgoJCX0KCgl9CgoJZnVuY3Rpb24gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApIHsKCgkJaWYgKCAoIGlzV2ViR0wyICYmIHJlbmRlclRhcmdldC5zYW1wbGVzID4gMCApICYmIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgPT09IGZhbHNlICkgewoKCQkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQuaXNXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cyA/IHJlbmRlclRhcmdldC50ZXh0dXJlIDogWyByZW5kZXJUYXJnZXQudGV4dHVyZSBdOwoJCQljb25zdCB3aWR0aCA9IHJlbmRlclRhcmdldC53aWR0aDsKCQkJY29uc3QgaGVpZ2h0ID0gcmVuZGVyVGFyZ2V0LmhlaWdodDsKCQkJbGV0IG1hc2sgPSBfZ2wuQ09MT1JfQlVGRkVSX0JJVDsKCQkJY29uc3QgaW52YWxpZGF0aW9uQXJyYXkgPSBbXTsKCQkJY29uc3QgZGVwdGhTdHlsZSA9IHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyID8gX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCA6IF9nbC5ERVBUSF9BVFRBQ0hNRU5UOwoJCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoJCQljb25zdCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyA9ICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMgPT09IHRydWUgKTsKCgkJCS8vIElmIE1SVCB3ZSBuZWVkIHRvIHJlbW92ZSBGQk8gYXR0YWNobWVudHMKCQkJaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuUkVOREVSQlVGRkVSLCBudWxsICk7CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGksIF9nbC5URVhUVVJFXzJELCBudWxsLCAwICk7CgoJCQkJfQoKCQkJfQoKCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRleHR1cmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCQlpbnZhbGlkYXRpb25BcnJheS5wdXNoKCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpICk7CgoJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSB7CgoJCQkJCWludmFsaWRhdGlvbkFycmF5LnB1c2goIGRlcHRoU3R5bGUgKTsKCgkJCQl9CgoJCQkJY29uc3QgaWdub3JlRGVwdGhWYWx1ZXMgPSAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19pZ25vcmVEZXB0aFZhbHVlcyAhPT0gdW5kZWZpbmVkICkgPyByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9faWdub3JlRGVwdGhWYWx1ZXMgOiBmYWxzZTsKCgkJCQlpZiAoIGlnbm9yZURlcHRoVmFsdWVzID09PSBmYWxzZSApIHsKCgkJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSBtYXNrIHw9IF9nbC5ERVBUSF9CVUZGRVJfQklUOwoJCQkJCWlmICggcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgKSBtYXNrIHw9IF9nbC5TVEVOQ0lMX0JVRkZFUl9CSVQ7CgoJCQkJfQoKCQkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgoJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApOwoKCQkJCX0KCgkJCQlpZiAoIGlnbm9yZURlcHRoVmFsdWVzID09PSB0cnVlICkgewoKCQkJCQlfZ2wuaW52YWxpZGF0ZUZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgWyBkZXB0aFN0eWxlIF0gKTsKCQkJCQlfZ2wuaW52YWxpZGF0ZUZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgWyBkZXB0aFN0eWxlIF0gKTsKCgkJCQl9CgoJCQkJaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmVzWyBpIF0gKS5fX3dlYmdsVGV4dHVyZTsKCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFXzJELCB3ZWJnbFRleHR1cmUsIDAgKTsKCgkJCQl9CgoJCQkJX2dsLmJsaXRGcmFtZWJ1ZmZlciggMCwgMCwgd2lkdGgsIGhlaWdodCwgMCwgMCwgd2lkdGgsIGhlaWdodCwgbWFzaywgX2dsLk5FQVJFU1QgKTsKCgkJCQlpZiAoIHN1cHBvcnRzSW52YWxpZGF0ZUZyYW1lYnVmZmVyICkgewoKCQkJCQlfZ2wuaW52YWxpZGF0ZUZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgaW52YWxpZGF0aW9uQXJyYXkgKTsKCgkJCQl9CgoKCQkJfQoKCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwoJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgoJCQkvLyBJZiBNUlQgc2luY2UgcHJlLWJsaXQgd2UgcmVtb3ZlZCB0aGUgRkJPIHdlIG5lZWQgdG8gcmVjb25zdHJ1Y3QgdGhlIGF0dGFjaG1lbnRzCgkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCQkJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApOwoKCQkJCQljb25zdCB3ZWJnbFRleHR1cmUgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZXNbIGkgXSApLl9fd2ViZ2xUZXh0dXJlOwoKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKTsKCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xUZXh0dXJlLCAwICk7CgoJCQkJfQoKCQkJfQoKCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKSB7CgoJCXJldHVybiBNYXRoLm1pbiggY2FwYWJpbGl0aWVzLm1heFNhbXBsZXMsIHJlbmRlclRhcmdldC5zYW1wbGVzICk7CgoJfQoKCWZ1bmN0aW9uIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgewoKCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoKCQlyZXR1cm4gaXNXZWJHTDIgJiYgcmVuZGVyVGFyZ2V0LnNhbXBsZXMgPiAwICYmIGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfbXVsdGlzYW1wbGVkX3JlbmRlcl90b190ZXh0dXJlJyApID09PSB0cnVlICYmIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX191c2VSZW5kZXJUb1RleHR1cmUgIT09IGZhbHNlOwoKCX0KCglmdW5jdGlvbiB1cGRhdGVWaWRlb1RleHR1cmUoIHRleHR1cmUgKSB7CgoJCWNvbnN0IGZyYW1lID0gaW5mby5yZW5kZXIuZnJhbWU7CgoJCS8vIENoZWNrIHRoZSBsYXN0IGZyYW1lIHdlIHVwZGF0ZWQgdGhlIFZpZGVvVGV4dHVyZQoKCQlpZiAoIF92aWRlb1RleHR1cmVzLmdldCggdGV4dHVyZSApICE9PSBmcmFtZSApIHsKCgkJCV92aWRlb1RleHR1cmVzLnNldCggdGV4dHVyZSwgZnJhbWUgKTsKCQkJdGV4dHVyZS51cGRhdGUoKTsKCgkJfQoKCX0KCglmdW5jdGlvbiB2ZXJpZnlDb2xvclNwYWNlKCB0ZXh0dXJlLCBpbWFnZSApIHsKCgkJY29uc3QgY29sb3JTcGFjZSA9IHRleHR1cmUuY29sb3JTcGFjZTsKCQljb25zdCBmb3JtYXQgPSB0ZXh0dXJlLmZvcm1hdDsKCQljb25zdCB0eXBlID0gdGV4dHVyZS50eXBlOwoKCQlpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSA9PT0gdHJ1ZSB8fCB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlID09PSB0cnVlIHx8IHRleHR1cmUuZm9ybWF0ID09PSBfU1JHQkFGb3JtYXQgKSByZXR1cm4gaW1hZ2U7CgoJCWlmICggY29sb3JTcGFjZSAhPT0gTGluZWFyU1JHQkNvbG9yU3BhY2UgJiYgY29sb3JTcGFjZSAhPT0gTm9Db2xvclNwYWNlICkgewoKCQkJLy8gc1JHQgoKCQkJaWYgKCBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIGNvbG9yU3BhY2UgKSA9PT0gU1JHQlRyYW5zZmVyICkgewoKCQkJCWlmICggaXNXZWJHTDIgPT09IGZhbHNlICkgewoKCQkJCQkvLyBpbiBXZWJHTCAxLCB0cnkgdG8gdXNlIEVYVF9zUkdCIGV4dGVuc2lvbiBhbmQgdW5zaXplZCBmb3JtYXRzCgoJCQkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdFWFRfc1JHQicgKSA9PT0gdHJ1ZSAmJiBmb3JtYXQgPT09IFJHQkFGb3JtYXQgKSB7CgoJCQkJCQl0ZXh0dXJlLmZvcm1hdCA9IF9TUkdCQUZvcm1hdDsKCgkJCQkJCS8vIGl0J3Mgbm90IHBvc3NpYmxlIHRvIGdlbmVyYXRlIG1pcHMgaW4gV2ViR0wgMSB3aXRoIHRoaXMgZXh0ZW5zaW9uCgoJCQkJCQl0ZXh0dXJlLm1pbkZpbHRlciA9IExpbmVhckZpbHRlcjsKCQkJCQkJdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIHNsb3cgZmFsbGJhY2sgKENQVSBkZWNvZGUpCgoJCQkJCQlpbWFnZSA9IEltYWdlVXRpbHMuc1JHQlRvTGluZWFyKCBpbWFnZSApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gaW4gV2ViR0wgMiB1bmNvbXByZXNzZWQgdGV4dHVyZXMgY2FuIG9ubHkgYmUgc1JHQiBlbmNvZGVkIGlmIHRoZXkgaGF2ZSB0aGUgUkdCQTggZm9ybWF0CgoJCQkJCWlmICggZm9ybWF0ICE9PSBSR0JBRm9ybWF0IHx8IHR5cGUgIT09IFVuc2lnbmVkQnl0ZVR5cGUgKSB7CgoJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFRleHR1cmVzOiBzUkdCIGVuY29kZWQgdGV4dHVyZXMgaGF2ZSB0byB1c2UgUkdCQUZvcm1hdCBhbmQgVW5zaWduZWRCeXRlVHlwZS4nICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFRleHR1cmVzOiBVbnN1cHBvcnRlZCB0ZXh0dXJlIGNvbG9yIHNwYWNlOicsIGNvbG9yU3BhY2UgKTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gaW1hZ2U7CgoJfQoKCS8vCgoJdGhpcy5hbGxvY2F0ZVRleHR1cmVVbml0ID0gYWxsb2NhdGVUZXh0dXJlVW5pdDsKCXRoaXMucmVzZXRUZXh0dXJlVW5pdHMgPSByZXNldFRleHR1cmVVbml0czsKCgl0aGlzLnNldFRleHR1cmUyRCA9IHNldFRleHR1cmUyRDsKCXRoaXMuc2V0VGV4dHVyZTJEQXJyYXkgPSBzZXRUZXh0dXJlMkRBcnJheTsKCXRoaXMuc2V0VGV4dHVyZTNEID0gc2V0VGV4dHVyZTNEOwoJdGhpcy5zZXRUZXh0dXJlQ3ViZSA9IHNldFRleHR1cmVDdWJlOwoJdGhpcy5yZWJpbmRUZXh0dXJlcyA9IHJlYmluZFRleHR1cmVzOwoJdGhpcy5zZXR1cFJlbmRlclRhcmdldCA9IHNldHVwUmVuZGVyVGFyZ2V0OwoJdGhpcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAgPSB1cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXA7Cgl0aGlzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0ID0gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQ7Cgl0aGlzLnNldHVwRGVwdGhSZW5kZXJidWZmZXIgPSBzZXR1cERlcHRoUmVuZGVyYnVmZmVyOwoJdGhpcy5zZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSA9IHNldHVwRnJhbWVCdWZmZXJUZXh0dXJlOwoJdGhpcy51c2VNdWx0aXNhbXBsZWRSVFQgPSB1c2VNdWx0aXNhbXBsZWRSVFQ7Cgp9CgpmdW5jdGlvbiBXZWJHTFV0aWxzKCBnbCwgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzICkgewoKCWNvbnN0IGlzV2ViR0wyID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyOwoKCWZ1bmN0aW9uIGNvbnZlcnQoIHAsIGNvbG9yU3BhY2UgPSBOb0NvbG9yU3BhY2UgKSB7CgoJCWxldCBleHRlbnNpb247CgoJCWNvbnN0IHRyYW5zZmVyID0gQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICk7CgoJCWlmICggcCA9PT0gVW5zaWduZWRCeXRlVHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9CWVRFOwoJCWlmICggcCA9PT0gVW5zaWduZWRTaG9ydDQ0NDRUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX1NIT1JUXzRfNF80XzQ7CgkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0NTU1MVR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlRfNV81XzVfMTsKCgkJaWYgKCBwID09PSBCeXRlVHlwZSApIHJldHVybiBnbC5CWVRFOwoJCWlmICggcCA9PT0gU2hvcnRUeXBlICkgcmV0dXJuIGdsLlNIT1JUOwoJCWlmICggcCA9PT0gVW5zaWduZWRTaG9ydFR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlQ7CgkJaWYgKCBwID09PSBJbnRUeXBlICkgcmV0dXJuIGdsLklOVDsKCQlpZiAoIHAgPT09IFVuc2lnbmVkSW50VHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9JTlQ7CgkJaWYgKCBwID09PSBGbG9hdFR5cGUgKSByZXR1cm4gZ2wuRkxPQVQ7CgoJCWlmICggcCA9PT0gSGFsZkZsb2F0VHlwZSApIHsKCgkJCWlmICggaXNXZWJHTDIgKSByZXR1cm4gZ2wuSEFMRl9GTE9BVDsKCgkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnT0VTX3RleHR1cmVfaGFsZl9mbG9hdCcgKTsKCgkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCXJldHVybiBleHRlbnNpb24uSEFMRl9GTE9BVF9PRVM7CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQl9CgoJCWlmICggcCA9PT0gQWxwaGFGb3JtYXQgKSByZXR1cm4gZ2wuQUxQSEE7CgkJaWYgKCBwID09PSBSR0JBRm9ybWF0ICkgcmV0dXJuIGdsLlJHQkE7CgkJaWYgKCBwID09PSBMdW1pbmFuY2VGb3JtYXQgKSByZXR1cm4gZ2wuTFVNSU5BTkNFOwoJCWlmICggcCA9PT0gTHVtaW5hbmNlQWxwaGFGb3JtYXQgKSByZXR1cm4gZ2wuTFVNSU5BTkNFX0FMUEhBOwoJCWlmICggcCA9PT0gRGVwdGhGb3JtYXQgKSByZXR1cm4gZ2wuREVQVEhfQ09NUE9ORU5UOwoJCWlmICggcCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgcmV0dXJuIGdsLkRFUFRIX1NURU5DSUw7CgoJCS8vIFdlYkdMIDEgc1JHQiBmYWxsYmFjawoKCQlpZiAoIHAgPT09IF9TUkdCQUZvcm1hdCApIHsKCgkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3NSR0InICk7CgoJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlyZXR1cm4gZXh0ZW5zaW9uLlNSR0JfQUxQSEFfRVhUOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJfQoKCQkvLyBXZWJHTDIgZm9ybWF0cy4KCgkJaWYgKCBwID09PSBSZWRGb3JtYXQgKSByZXR1cm4gZ2wuUkVEOwoJCWlmICggcCA9PT0gUmVkSW50ZWdlckZvcm1hdCApIHJldHVybiBnbC5SRURfSU5URUdFUjsKCQlpZiAoIHAgPT09IFJHRm9ybWF0ICkgcmV0dXJuIGdsLlJHOwoJCWlmICggcCA9PT0gUkdJbnRlZ2VyRm9ybWF0ICkgcmV0dXJuIGdsLlJHX0lOVEVHRVI7CgkJaWYgKCBwID09PSBSR0JBSW50ZWdlckZvcm1hdCApIHJldHVybiBnbC5SR0JBX0lOVEVHRVI7CgoJCS8vIFMzVEMKCgkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCB8fCBwID09PSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9TM1RDX0RYVDNfRm9ybWF0IHx8IHAgPT09IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCApIHsKCgkJCWlmICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApIHsKCgkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjX3NyZ2InICk7CgoJCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJCWlmICggcCA9PT0gUkdCX1MzVENfRFhUMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9TM1RDX0RYVDFfRVhUOwoJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0JfQUxQSEFfUzNUQ19EWFQxX0VYVDsKCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX0FMUEhBX1MzVENfRFhUM19FWFQ7CgkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9TM1RDX0RYVDVfRVhUOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJldHVybiBudWxsOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUzNUQ19EWFQxX0VYVDsKCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1MzVENfRFhUMV9FWFQ7CgkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUM19Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDNfRVhUOwoJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDVfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUzNUQ19EWFQ1X0VYVDsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJLy8gUFZSVEMKCgkJaWYgKCBwID09PSBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCB8fCBwID09PSBSR0JfUFZSVENfMkJQUFYxX0Zvcm1hdCB8fCBwID09PSBSR0JBX1BWUlRDXzRCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0ICkgewoKCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnICk7CgoJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlpZiAoIHAgPT09IFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9QVlJUQ180QlBQVjFfSU1HOwoJCQkJaWYgKCBwID09PSBSR0JfUFZSVENfMkJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUFZSVENfMkJQUFYxX0lNRzsKCQkJCWlmICggcCA9PT0gUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUFZSVENfNEJQUFYxX0lNRzsKCQkJCWlmICggcCA9PT0gUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUFZSVENfMkJQUFYxX0lNRzsKCgkJCX0gZWxzZSB7CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCX0KCgkJLy8gRVRDMQoKCQlpZiAoIHAgPT09IFJHQl9FVEMxX0Zvcm1hdCApIHsKCgkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX2V0YzEnICk7CgoJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlyZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX0VUQzFfV0VCR0w7CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQl9CgoJCS8vIEVUQzIKCgkJaWYgKCBwID09PSBSR0JfRVRDMl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9FVEMyX0VBQ19Gb3JtYXQgKSB7CgoJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGMnICk7CgoJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlpZiAoIHAgPT09IFJHQl9FVEMyX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0VUQzIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0I4X0VUQzI7CgkJCQlpZiAoIHAgPT09IFJHQkFfRVRDMl9FQUNfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0VUQzJfRUFDIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQThfRVRDMl9FQUM7CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQl9CgoJCS8vIEFTVEMKCgkJaWYgKCBwID09PSBSR0JBX0FTVENfNHg0X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNXg0X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNXg1X0Zvcm1hdCB8fAoJCQlwID09PSBSR0JBX0FTVENfNng1X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNng2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfOHg1X0Zvcm1hdCB8fAoJCQlwID09PSBSR0JBX0FTVENfOHg2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfOHg4X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfMTB4NV9Gb3JtYXQgfHwKCQkJcCA9PT0gUkdCQV9BU1RDXzEweDZfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMHg4X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfMTB4MTBfRm9ybWF0IHx8CgkJCXAgPT09IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCApIHsKCgkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX2FzdGMnICk7CgoJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ180eDRfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNHg0X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ180eDRfS0hSOwoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNXg0X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzV4NF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfNXg0X0tIUjsKCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzV4NV9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ181eDVfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzV4NV9LSFI7CgkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ182eDVfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNng1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ182eDVfS0hSOwoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNng2X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzZ4Nl9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfNng2X0tIUjsKCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzh4NV9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ184eDVfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzh4NV9LSFI7CgkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ184eDZfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfOHg2X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ184eDZfS0hSOwoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfOHg4X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzh4OF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfOHg4X0tIUjsKCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEweDVfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTB4NV9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTB4NV9LSFI7CgkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMHg2X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEweDZfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEweDZfS0hSOwoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTB4OF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMHg4X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMHg4X0tIUjsKCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEweDEwX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEweDEwX0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMHgxMF9LSFI7CgkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMngxMF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTJ4MTBfS0hSOwoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTJ4MTJfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTJ4MTJfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEyeDEyX0tIUjsKCgkJCX0gZWxzZSB7CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCX0KCgkJLy8gQlBUQwoKCQlpZiAoIHAgPT09IFJHQkFfQlBUQ19Gb3JtYXQgfHwgcCA9PT0gUkdCX0JQVENfU0lHTkVEX0Zvcm1hdCB8fCBwID09PSBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgKSB7CgoJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ0VYVF90ZXh0dXJlX2NvbXByZXNzaW9uX2JwdGMnICk7CgoJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlpZiAoIHAgPT09IFJHQkFfQlBUQ19Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX0FMUEhBX0JQVENfVU5PUk1fRVhUIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9CUFRDX1VOT1JNX0VYVDsKCQkJCWlmICggcCA9PT0gUkdCX0JQVENfU0lHTkVEX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfQlBUQ19TSUdORURfRkxPQVRfRVhUOwoJCQkJaWYgKCBwID09PSBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX0JQVENfVU5TSUdORURfRkxPQVRfRVhUOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJfQoKCQkvLyBSR1RDCgoJCWlmICggcCA9PT0gUkVEX1JHVEMxX0Zvcm1hdCB8fCBwID09PSBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCB8fCBwID09PSBSRURfR1JFRU5fUkdUQzJfRm9ybWF0IHx8IHAgPT09IFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0ICkgewoKCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9jb21wcmVzc2lvbl9yZ3RjJyApOwoKCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JFRF9SR1RDMV9FWFQ7CgkJCQlpZiAoIHAgPT09IFNJR05FRF9SRURfUkdUQzFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NJR05FRF9SRURfUkdUQzFfRVhUOwoJCQkJaWYgKCBwID09PSBSRURfR1JFRU5fUkdUQzJfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JFRF9HUkVFTl9SR1RDMl9FWFQ7CgkJCQlpZiAoIHAgPT09IFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NJR05FRF9SRURfR1JFRU5fUkdUQzJfRVhUOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJfQoKCQkvLwoKCQlpZiAoIHAgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHsKCgkJCWlmICggaXNXZWJHTDIgKSByZXR1cm4gZ2wuVU5TSUdORURfSU5UXzI0Xzg7CgoJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2RlcHRoX3RleHR1cmUnICk7CgoJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlyZXR1cm4gZXh0ZW5zaW9uLlVOU0lHTkVEX0lOVF8yNF84X1dFQkdMOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJfQoKCQkvLyBpZiAicCIgY2FuJ3QgYmUgcmVzb2x2ZWQsIGFzc3VtZSB0aGUgdXNlciBkZWZpbmVzIGEgV2ViR0wgY29uc3RhbnQgYXMgYSBzdHJpbmcgKGZhbGxiYWNrL3dvcmthcm91bmQgZm9yIHBhY2tlZCBSR0IgZm9ybWF0cykKCgkJcmV0dXJuICggZ2xbIHAgXSAhPT0gdW5kZWZpbmVkICkgPyBnbFsgcCBdIDogbnVsbDsKCgl9CgoJcmV0dXJuIHsgY29udmVydDogY29udmVydCB9OwoKfQoKY2xhc3MgQXJyYXlDYW1lcmEgZXh0ZW5kcyBQZXJzcGVjdGl2ZUNhbWVyYSB7CgoJY29uc3RydWN0b3IoIGFycmF5ID0gW10gKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNBcnJheUNhbWVyYSA9IHRydWU7CgoJCXRoaXMuY2FtZXJhcyA9IGFycmF5OwoKCX0KCn0KCmNsYXNzIEdyb3VwIGV4dGVuZHMgT2JqZWN0M0QgewoKCWNvbnN0cnVjdG9yKCkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzR3JvdXAgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnR3JvdXAnOwoKCX0KCn0KCmNvbnN0IF9tb3ZlRXZlbnQgPSB7IHR5cGU6ICdtb3ZlJyB9OwoKY2xhc3MgV2ViWFJDb250cm9sbGVyIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJdGhpcy5fdGFyZ2V0UmF5ID0gbnVsbDsKCQl0aGlzLl9ncmlwID0gbnVsbDsKCQl0aGlzLl9oYW5kID0gbnVsbDsKCgl9CgoJZ2V0SGFuZFNwYWNlKCkgewoKCQlpZiAoIHRoaXMuX2hhbmQgPT09IG51bGwgKSB7CgoJCQl0aGlzLl9oYW5kID0gbmV3IEdyb3VwKCk7CgkJCXRoaXMuX2hhbmQubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoJCQl0aGlzLl9oYW5kLnZpc2libGUgPSBmYWxzZTsKCgkJCXRoaXMuX2hhbmQuam9pbnRzID0ge307CgkJCXRoaXMuX2hhbmQuaW5wdXRTdGF0ZSA9IHsgcGluY2hpbmc6IGZhbHNlIH07CgoJCX0KCgkJcmV0dXJuIHRoaXMuX2hhbmQ7CgoJfQoKCWdldFRhcmdldFJheVNwYWNlKCkgewoKCQlpZiAoIHRoaXMuX3RhcmdldFJheSA9PT0gbnVsbCApIHsKCgkJCXRoaXMuX3RhcmdldFJheSA9IG5ldyBHcm91cCgpOwoJCQl0aGlzLl90YXJnZXRSYXkubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoJCQl0aGlzLl90YXJnZXRSYXkudmlzaWJsZSA9IGZhbHNlOwoJCQl0aGlzLl90YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCQkJdGhpcy5fdGFyZ2V0UmF5LmxpbmVhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKCQkJdGhpcy5fdGFyZ2V0UmF5Lmhhc0FuZ3VsYXJWZWxvY2l0eSA9IGZhbHNlOwoJCQl0aGlzLl90YXJnZXRSYXkuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKCgkJfQoKCQlyZXR1cm4gdGhpcy5fdGFyZ2V0UmF5OwoKCX0KCglnZXRHcmlwU3BhY2UoKSB7CgoJCWlmICggdGhpcy5fZ3JpcCA9PT0gbnVsbCApIHsKCgkJCXRoaXMuX2dyaXAgPSBuZXcgR3JvdXAoKTsKCQkJdGhpcy5fZ3JpcC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgkJCXRoaXMuX2dyaXAudmlzaWJsZSA9IGZhbHNlOwoJCQl0aGlzLl9ncmlwLmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CgkJCXRoaXMuX2dyaXAubGluZWFyVmVsb2NpdHkgPSBuZXcgVmVjdG9yMygpOwoJCQl0aGlzLl9ncmlwLmhhc0FuZ3VsYXJWZWxvY2l0eSA9IGZhbHNlOwoJCQl0aGlzLl9ncmlwLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CgoJCX0KCgkJcmV0dXJuIHRoaXMuX2dyaXA7CgoJfQoKCWRpc3BhdGNoRXZlbnQoIGV2ZW50ICkgewoKCQlpZiAoIHRoaXMuX3RhcmdldFJheSAhPT0gbnVsbCApIHsKCgkJCXRoaXMuX3RhcmdldFJheS5kaXNwYXRjaEV2ZW50KCBldmVudCApOwoKCQl9CgoJCWlmICggdGhpcy5fZ3JpcCAhPT0gbnVsbCApIHsKCgkJCXRoaXMuX2dyaXAuZGlzcGF0Y2hFdmVudCggZXZlbnQgKTsKCgkJfQoKCQlpZiAoIHRoaXMuX2hhbmQgIT09IG51bGwgKSB7CgoJCQl0aGlzLl9oYW5kLmRpc3BhdGNoRXZlbnQoIGV2ZW50ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvbm5lY3QoIGlucHV0U291cmNlICkgewoKCQlpZiAoIGlucHV0U291cmNlICYmIGlucHV0U291cmNlLmhhbmQgKSB7CgoJCQljb25zdCBoYW5kID0gdGhpcy5faGFuZDsKCgkJCWlmICggaGFuZCApIHsKCgkJCQlmb3IgKCBjb25zdCBpbnB1dGpvaW50IG9mIGlucHV0U291cmNlLmhhbmQudmFsdWVzKCkgKSB7CgoJCQkJCS8vIEluaXRpYWxpemUgaGFuZCB3aXRoIGpvaW50cyB3aGVuIGNvbm5lY3RlZAoJCQkJCXRoaXMuX2dldEhhbmRKb2ludCggaGFuZCwgaW5wdXRqb2ludCApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Nvbm5lY3RlZCcsIGRhdGE6IGlucHV0U291cmNlIH0gKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpc2Nvbm5lY3QoIGlucHV0U291cmNlICkgewoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc2Nvbm5lY3RlZCcsIGRhdGE6IGlucHV0U291cmNlIH0gKTsKCgkJaWYgKCB0aGlzLl90YXJnZXRSYXkgIT09IG51bGwgKSB7CgoJCQl0aGlzLl90YXJnZXRSYXkudmlzaWJsZSA9IGZhbHNlOwoKCQl9CgoJCWlmICggdGhpcy5fZ3JpcCAhPT0gbnVsbCApIHsKCgkJCXRoaXMuX2dyaXAudmlzaWJsZSA9IGZhbHNlOwoKCQl9CgoJCWlmICggdGhpcy5faGFuZCAhPT0gbnVsbCApIHsKCgkJCXRoaXMuX2hhbmQudmlzaWJsZSA9IGZhbHNlOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgl1cGRhdGUoIGlucHV0U291cmNlLCBmcmFtZSwgcmVmZXJlbmNlU3BhY2UgKSB7CgoJCWxldCBpbnB1dFBvc2UgPSBudWxsOwoJCWxldCBncmlwUG9zZSA9IG51bGw7CgkJbGV0IGhhbmRQb3NlID0gbnVsbDsKCgkJY29uc3QgdGFyZ2V0UmF5ID0gdGhpcy5fdGFyZ2V0UmF5OwoJCWNvbnN0IGdyaXAgPSB0aGlzLl9ncmlwOwoJCWNvbnN0IGhhbmQgPSB0aGlzLl9oYW5kOwoKCQlpZiAoIGlucHV0U291cmNlICYmIGZyYW1lLnNlc3Npb24udmlzaWJpbGl0eVN0YXRlICE9PSAndmlzaWJsZS1ibHVycmVkJyApIHsKCgkJCWlmICggaGFuZCAmJiBpbnB1dFNvdXJjZS5oYW5kICkgewoKCQkJCWhhbmRQb3NlID0gdHJ1ZTsKCgkJCQlmb3IgKCBjb25zdCBpbnB1dGpvaW50IG9mIGlucHV0U291cmNlLmhhbmQudmFsdWVzKCkgKSB7CgoJCQkJCS8vIFVwZGF0ZSB0aGUgam9pbnRzIGdyb3VwcyB3aXRoIHRoZSBYUkpvaW50IHBvc2VzCgkJCQkJY29uc3Qgam9pbnRQb3NlID0gZnJhbWUuZ2V0Sm9pbnRQb3NlKCBpbnB1dGpvaW50LCByZWZlcmVuY2VTcGFjZSApOwoKCQkJCQkvLyBUaGUgdHJhbnNmb3JtIG9mIHRoaXMgam9pbnQgd2lsbCBiZSB1cGRhdGVkIHdpdGggdGhlIGpvaW50IHBvc2Ugb24gZWFjaCBmcmFtZQoJCQkJCWNvbnN0IGpvaW50ID0gdGhpcy5fZ2V0SGFuZEpvaW50KCBoYW5kLCBpbnB1dGpvaW50ICk7CgoJCQkJCWlmICggam9pbnRQb3NlICE9PSBudWxsICkgewoKCQkJCQkJam9pbnQubWF0cml4LmZyb21BcnJheSggam9pbnRQb3NlLnRyYW5zZm9ybS5tYXRyaXggKTsKCQkJCQkJam9pbnQubWF0cml4LmRlY29tcG9zZSggam9pbnQucG9zaXRpb24sIGpvaW50LnJvdGF0aW9uLCBqb2ludC5zY2FsZSApOwoJCQkJCQlqb2ludC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJCQkJam9pbnQuam9pbnRSYWRpdXMgPSBqb2ludFBvc2UucmFkaXVzOwoKCQkJCQl9CgoJCQkJCWpvaW50LnZpc2libGUgPSBqb2ludFBvc2UgIT09IG51bGw7CgoJCQkJfQoKCQkJCS8vIEN1c3RvbSBldmVudHMKCgkJCQkvLyBDaGVjayBwaW5jaHoKCQkJCWNvbnN0IGluZGV4VGlwID0gaGFuZC5qb2ludHNbICdpbmRleC1maW5nZXItdGlwJyBdOwoJCQkJY29uc3QgdGh1bWJUaXAgPSBoYW5kLmpvaW50c1sgJ3RodW1iLXRpcCcgXTsKCQkJCWNvbnN0IGRpc3RhbmNlID0gaW5kZXhUaXAucG9zaXRpb24uZGlzdGFuY2VUbyggdGh1bWJUaXAucG9zaXRpb24gKTsKCgkJCQljb25zdCBkaXN0YW5jZVRvUGluY2ggPSAwLjAyOwoJCQkJY29uc3QgdGhyZXNob2xkID0gMC4wMDU7CgoJCQkJaWYgKCBoYW5kLmlucHV0U3RhdGUucGluY2hpbmcgJiYgZGlzdGFuY2UgPiBkaXN0YW5jZVRvUGluY2ggKyB0aHJlc2hvbGQgKSB7CgoJCQkJCWhhbmQuaW5wdXRTdGF0ZS5waW5jaGluZyA9IGZhbHNlOwoJCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggewoJCQkJCQl0eXBlOiAncGluY2hlbmQnLAoJCQkJCQloYW5kZWRuZXNzOiBpbnB1dFNvdXJjZS5oYW5kZWRuZXNzLAoJCQkJCQl0YXJnZXQ6IHRoaXMKCQkJCQl9ICk7CgoJCQkJfSBlbHNlIGlmICggISBoYW5kLmlucHV0U3RhdGUucGluY2hpbmcgJiYgZGlzdGFuY2UgPD0gZGlzdGFuY2VUb1BpbmNoIC0gdGhyZXNob2xkICkgewoKCQkJCQloYW5kLmlucHV0U3RhdGUucGluY2hpbmcgPSB0cnVlOwoJCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggewoJCQkJCQl0eXBlOiAncGluY2hzdGFydCcsCgkJCQkJCWhhbmRlZG5lc3M6IGlucHV0U291cmNlLmhhbmRlZG5lc3MsCgkJCQkJCXRhcmdldDogdGhpcwoJCQkJCX0gKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWlmICggZ3JpcCAhPT0gbnVsbCAmJiBpbnB1dFNvdXJjZS5ncmlwU3BhY2UgKSB7CgoJCQkJCWdyaXBQb3NlID0gZnJhbWUuZ2V0UG9zZSggaW5wdXRTb3VyY2UuZ3JpcFNwYWNlLCByZWZlcmVuY2VTcGFjZSApOwoKCQkJCQlpZiAoIGdyaXBQb3NlICE9PSBudWxsICkgewoKCQkJCQkJZ3JpcC5tYXRyaXguZnJvbUFycmF5KCBncmlwUG9zZS50cmFuc2Zvcm0ubWF0cml4ICk7CgkJCQkJCWdyaXAubWF0cml4LmRlY29tcG9zZSggZ3JpcC5wb3NpdGlvbiwgZ3JpcC5yb3RhdGlvbiwgZ3JpcC5zY2FsZSApOwoJCQkJCQlncmlwLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCQkJaWYgKCBncmlwUG9zZS5saW5lYXJWZWxvY2l0eSApIHsKCgkJCQkJCQlncmlwLmhhc0xpbmVhclZlbG9jaXR5ID0gdHJ1ZTsKCQkJCQkJCWdyaXAubGluZWFyVmVsb2NpdHkuY29weSggZ3JpcFBvc2UubGluZWFyVmVsb2NpdHkgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJZ3JpcC5oYXNMaW5lYXJWZWxvY2l0eSA9IGZhbHNlOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBncmlwUG9zZS5hbmd1bGFyVmVsb2NpdHkgKSB7CgoJCQkJCQkJZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSB0cnVlOwoJCQkJCQkJZ3JpcC5hbmd1bGFyVmVsb2NpdHkuY29weSggZ3JpcFBvc2UuYW5ndWxhclZlbG9jaXR5ICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWdyaXAuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHRhcmdldFJheSAhPT0gbnVsbCApIHsKCgkJCQlpbnB1dFBvc2UgPSBmcmFtZS5nZXRQb3NlKCBpbnB1dFNvdXJjZS50YXJnZXRSYXlTcGFjZSwgcmVmZXJlbmNlU3BhY2UgKTsKCgkJCQkvLyBTb21lIHJ1bnRpbWVzIChuYW1lbHkgVml2ZSBDb3Ntb3Mgd2l0aCBWaXZlIE9wZW5YUiBSdW50aW1lKSBoYXZlIG9ubHkgZ3JpcCBzcGFjZSBhbmQgcmF5IHNwYWNlIGlzIGVxdWFsIHRvIGl0CgkJCQlpZiAoIGlucHV0UG9zZSA9PT0gbnVsbCAmJiBncmlwUG9zZSAhPT0gbnVsbCApIHsKCgkJCQkJaW5wdXRQb3NlID0gZ3JpcFBvc2U7CgoJCQkJfQoKCQkJCWlmICggaW5wdXRQb3NlICE9PSBudWxsICkgewoKCQkJCQl0YXJnZXRSYXkubWF0cml4LmZyb21BcnJheSggaW5wdXRQb3NlLnRyYW5zZm9ybS5tYXRyaXggKTsKCQkJCQl0YXJnZXRSYXkubWF0cml4LmRlY29tcG9zZSggdGFyZ2V0UmF5LnBvc2l0aW9uLCB0YXJnZXRSYXkucm90YXRpb24sIHRhcmdldFJheS5zY2FsZSApOwoJCQkJCXRhcmdldFJheS5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJaWYgKCBpbnB1dFBvc2UubGluZWFyVmVsb2NpdHkgKSB7CgoJCQkJCQl0YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSB0cnVlOwoJCQkJCQl0YXJnZXRSYXkubGluZWFyVmVsb2NpdHkuY29weSggaW5wdXRQb3NlLmxpbmVhclZlbG9jaXR5ICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl0YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCgkJCQkJfQoKCQkJCQlpZiAoIGlucHV0UG9zZS5hbmd1bGFyVmVsb2NpdHkgKSB7CgoJCQkJCQl0YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gdHJ1ZTsKCQkJCQkJdGFyZ2V0UmF5LmFuZ3VsYXJWZWxvY2l0eS5jb3B5KCBpbnB1dFBvc2UuYW5ndWxhclZlbG9jaXR5ICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl0YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CgoJCQkJCX0KCgkJCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCBfbW92ZUV2ZW50ICk7CgoJCQkJfQoKCQkJfQoKCgkJfQoKCQlpZiAoIHRhcmdldFJheSAhPT0gbnVsbCApIHsKCgkJCXRhcmdldFJheS52aXNpYmxlID0gKCBpbnB1dFBvc2UgIT09IG51bGwgKTsKCgkJfQoKCQlpZiAoIGdyaXAgIT09IG51bGwgKSB7CgoJCQlncmlwLnZpc2libGUgPSAoIGdyaXBQb3NlICE9PSBudWxsICk7CgoJCX0KCgkJaWYgKCBoYW5kICE9PSBudWxsICkgewoKCQkJaGFuZC52aXNpYmxlID0gKCBoYW5kUG9zZSAhPT0gbnVsbCApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgkvLyBwcml2YXRlIG1ldGhvZAoKCV9nZXRIYW5kSm9pbnQoIGhhbmQsIGlucHV0am9pbnQgKSB7CgoJCWlmICggaGFuZC5qb2ludHNbIGlucHV0am9pbnQuam9pbnROYW1lIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IGpvaW50ID0gbmV3IEdyb3VwKCk7CgkJCWpvaW50Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJam9pbnQudmlzaWJsZSA9IGZhbHNlOwoJCQloYW5kLmpvaW50c1sgaW5wdXRqb2ludC5qb2ludE5hbWUgXSA9IGpvaW50OwoKCQkJaGFuZC5hZGQoIGpvaW50ICk7CgoJCX0KCgkJcmV0dXJuIGhhbmQuam9pbnRzWyBpbnB1dGpvaW50LmpvaW50TmFtZSBdOwoKCX0KCn0KCmNsYXNzIFdlYlhSTWFuYWdlciBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgoJY29uc3RydWN0b3IoIHJlbmRlcmVyLCBnbCApIHsKCgkJc3VwZXIoKTsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQlsZXQgc2Vzc2lvbiA9IG51bGw7CgoJCWxldCBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gMS4wOwoKCQlsZXQgcmVmZXJlbmNlU3BhY2UgPSBudWxsOwoJCWxldCByZWZlcmVuY2VTcGFjZVR5cGUgPSAnbG9jYWwtZmxvb3InOwoJCS8vIFNldCBkZWZhdWx0IGZvdmVhdGlvbiB0byBtYXhpbXVtLgoJCWxldCBmb3ZlYXRpb24gPSAxLjA7CgkJbGV0IGN1c3RvbVJlZmVyZW5jZVNwYWNlID0gbnVsbDsKCgkJbGV0IHBvc2UgPSBudWxsOwoJCWxldCBnbEJpbmRpbmcgPSBudWxsOwoJCWxldCBnbFByb2pMYXllciA9IG51bGw7CgkJbGV0IGdsQmFzZUxheWVyID0gbnVsbDsKCQlsZXQgeHJGcmFtZSA9IG51bGw7CgkJY29uc3QgYXR0cmlidXRlcyA9IGdsLmdldENvbnRleHRBdHRyaWJ1dGVzKCk7CgkJbGV0IGluaXRpYWxSZW5kZXJUYXJnZXQgPSBudWxsOwoJCWxldCBuZXdSZW5kZXJUYXJnZXQgPSBudWxsOwoKCQljb25zdCBjb250cm9sbGVycyA9IFtdOwoJCWNvbnN0IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMgPSBbXTsKCgkJY29uc3QgY3VycmVudFNpemUgPSBuZXcgVmVjdG9yMigpOwoJCWxldCBjdXJyZW50UGl4ZWxSYXRpbyA9IG51bGw7CgoJCS8vCgoJCWNvbnN0IGNhbWVyYUwgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoKTsKCQljYW1lcmFMLmxheWVycy5lbmFibGUoIDEgKTsKCQljYW1lcmFMLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKTsKCgkJY29uc3QgY2FtZXJhUiA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwoJCWNhbWVyYVIubGF5ZXJzLmVuYWJsZSggMiApOwoJCWNhbWVyYVIudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwoKCQljb25zdCBjYW1lcmFzID0gWyBjYW1lcmFMLCBjYW1lcmFSIF07CgoJCWNvbnN0IGNhbWVyYVhSID0gbmV3IEFycmF5Q2FtZXJhKCk7CgkJY2FtZXJhWFIubGF5ZXJzLmVuYWJsZSggMSApOwoJCWNhbWVyYVhSLmxheWVycy5lbmFibGUoIDIgKTsKCgkJbGV0IF9jdXJyZW50RGVwdGhOZWFyID0gbnVsbDsKCQlsZXQgX2N1cnJlbnREZXB0aEZhciA9IG51bGw7CgoJCS8vCgoJCXRoaXMuY2FtZXJhQXV0b1VwZGF0ZSA9IHRydWU7CgkJdGhpcy5lbmFibGVkID0gZmFsc2U7CgoJCXRoaXMuaXNQcmVzZW50aW5nID0gZmFsc2U7CgoJCXRoaXMuZ2V0Q29udHJvbGxlciA9IGZ1bmN0aW9uICggaW5kZXggKSB7CgoJCQlsZXQgY29udHJvbGxlciA9IGNvbnRyb2xsZXJzWyBpbmRleCBdOwoKCQkJaWYgKCBjb250cm9sbGVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29udHJvbGxlciA9IG5ldyBXZWJYUkNvbnRyb2xsZXIoKTsKCQkJCWNvbnRyb2xsZXJzWyBpbmRleCBdID0gY29udHJvbGxlcjsKCgkJCX0KCgkJCXJldHVybiBjb250cm9sbGVyLmdldFRhcmdldFJheVNwYWNlKCk7CgoJCX07CgoJCXRoaXMuZ2V0Q29udHJvbGxlckdyaXAgPSBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJbGV0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaW5kZXggXTsKCgkJCWlmICggY29udHJvbGxlciA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnRyb2xsZXIgPSBuZXcgV2ViWFJDb250cm9sbGVyKCk7CgkJCQljb250cm9sbGVyc1sgaW5kZXggXSA9IGNvbnRyb2xsZXI7CgoJCQl9CgoJCQlyZXR1cm4gY29udHJvbGxlci5nZXRHcmlwU3BhY2UoKTsKCgkJfTsKCgkJdGhpcy5nZXRIYW5kID0gZnVuY3Rpb24gKCBpbmRleCApIHsKCgkJCWxldCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGluZGV4IF07CgoJCQlpZiAoIGNvbnRyb2xsZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb250cm9sbGVyID0gbmV3IFdlYlhSQ29udHJvbGxlcigpOwoJCQkJY29udHJvbGxlcnNbIGluZGV4IF0gPSBjb250cm9sbGVyOwoKCQkJfQoKCQkJcmV0dXJuIGNvbnRyb2xsZXIuZ2V0SGFuZFNwYWNlKCk7CgoJCX07CgoJCS8vCgoJCWZ1bmN0aW9uIG9uU2Vzc2lvbkV2ZW50KCBldmVudCApIHsKCgkJCWNvbnN0IGNvbnRyb2xsZXJJbmRleCA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMuaW5kZXhPZiggZXZlbnQuaW5wdXRTb3VyY2UgKTsKCgkJCWlmICggY29udHJvbGxlckluZGV4ID09PSAtIDEgKSB7CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJY29uc3QgY29udHJvbGxlciA9IGNvbnRyb2xsZXJzWyBjb250cm9sbGVySW5kZXggXTsKCgkJCWlmICggY29udHJvbGxlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnRyb2xsZXIudXBkYXRlKCBldmVudC5pbnB1dFNvdXJjZSwgZXZlbnQuZnJhbWUsIGN1c3RvbVJlZmVyZW5jZVNwYWNlIHx8IHJlZmVyZW5jZVNwYWNlICk7CgkJCQljb250cm9sbGVyLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogZXZlbnQudHlwZSwgZGF0YTogZXZlbnQuaW5wdXRTb3VyY2UgfSApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIG9uU2Vzc2lvbkVuZCgpIHsKCgkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NlbGVjdCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NlbGVjdHN0YXJ0Jywgb25TZXNzaW9uRXZlbnQgKTsKCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc2VsZWN0ZW5kJywgb25TZXNzaW9uRXZlbnQgKTsKCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZScsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NxdWVlemVzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NxdWVlemVlbmQnLCBvblNlc3Npb25FdmVudCApOwoJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdlbmQnLCBvblNlc3Npb25FbmQgKTsKCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnaW5wdXRzb3VyY2VzY2hhbmdlJywgb25JbnB1dFNvdXJjZXNDaGFuZ2UgKTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSArKyApIHsKCgkJCQljb25zdCBpbnB1dFNvdXJjZSA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGkgXTsKCgkJCQlpZiAoIGlucHV0U291cmNlID09PSBudWxsICkgY29udGludWU7CgoJCQkJY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdID0gbnVsbDsKCgkJCQljb250cm9sbGVyc1sgaSBdLmRpc2Nvbm5lY3QoIGlucHV0U291cmNlICk7CgoJCQl9CgoJCQlfY3VycmVudERlcHRoTmVhciA9IG51bGw7CgkJCV9jdXJyZW50RGVwdGhGYXIgPSBudWxsOwoKCQkJLy8gcmVzdG9yZSBmcmFtZWJ1ZmZlci9yZW5kZXJpbmcgc3RhdGUKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggaW5pdGlhbFJlbmRlclRhcmdldCApOwoKCQkJZ2xCYXNlTGF5ZXIgPSBudWxsOwoJCQlnbFByb2pMYXllciA9IG51bGw7CgkJCWdsQmluZGluZyA9IG51bGw7CgkJCXNlc3Npb24gPSBudWxsOwoJCQluZXdSZW5kZXJUYXJnZXQgPSBudWxsOwoKCQkJLy8KCgkJCWFuaW1hdGlvbi5zdG9wKCk7CgoJCQlzY29wZS5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKCgkJCXJlbmRlcmVyLnNldFBpeGVsUmF0aW8oIGN1cnJlbnRQaXhlbFJhdGlvICk7CgkJCXJlbmRlcmVyLnNldFNpemUoIGN1cnJlbnRTaXplLndpZHRoLCBjdXJyZW50U2l6ZS5oZWlnaHQsIGZhbHNlICk7CgoJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdzZXNzaW9uZW5kJyB9ICk7CgoJCX0KCgkJdGhpcy5zZXRGcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSB2YWx1ZTsKCgkJCWlmICggc2NvcGUuaXNQcmVzZW50aW5nID09PSB0cnVlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYlhSTWFuYWdlcjogQ2Fubm90IGNoYW5nZSBmcmFtZWJ1ZmZlciBzY2FsZSB3aGlsZSBwcmVzZW50aW5nLicgKTsKCgkJCX0KCgkJfTsKCgkJdGhpcy5zZXRSZWZlcmVuY2VTcGFjZVR5cGUgPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJcmVmZXJlbmNlU3BhY2VUeXBlID0gdmFsdWU7CgoJCQlpZiAoIHNjb3BlLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJYUk1hbmFnZXI6IENhbm5vdCBjaGFuZ2UgcmVmZXJlbmNlIHNwYWNlIHR5cGUgd2hpbGUgcHJlc2VudGluZy4nICk7CgoJCQl9CgoJCX07CgoJCXRoaXMuZ2V0UmVmZXJlbmNlU3BhY2UgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gY3VzdG9tUmVmZXJlbmNlU3BhY2UgfHwgcmVmZXJlbmNlU3BhY2U7CgoJCX07CgoJCXRoaXMuc2V0UmVmZXJlbmNlU3BhY2UgPSBmdW5jdGlvbiAoIHNwYWNlICkgewoKCQkJY3VzdG9tUmVmZXJlbmNlU3BhY2UgPSBzcGFjZTsKCgkJfTsKCgkJdGhpcy5nZXRCYXNlTGF5ZXIgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gZ2xQcm9qTGF5ZXIgIT09IG51bGwgPyBnbFByb2pMYXllciA6IGdsQmFzZUxheWVyOwoKCQl9OwoKCQl0aGlzLmdldEJpbmRpbmcgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gZ2xCaW5kaW5nOwoKCQl9OwoKCQl0aGlzLmdldEZyYW1lID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHhyRnJhbWU7CgoJCX07CgoJCXRoaXMuZ2V0U2Vzc2lvbiA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBzZXNzaW9uOwoKCQl9OwoKCQl0aGlzLnNldFNlc3Npb24gPSBhc3luYyBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJc2Vzc2lvbiA9IHZhbHVlOwoKCQkJaWYgKCBzZXNzaW9uICE9PSBudWxsICkgewoKCQkJCWluaXRpYWxSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCgkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzZWxlY3QnLCBvblNlc3Npb25FdmVudCApOwoJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc2VsZWN0c3RhcnQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc2VsZWN0ZW5kJywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NxdWVlemUnLCBvblNlc3Npb25FdmVudCApOwoJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZXN0YXJ0Jywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NxdWVlemVlbmQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnZW5kJywgb25TZXNzaW9uRW5kICk7CgkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdpbnB1dHNvdXJjZXNjaGFuZ2UnLCBvbklucHV0U291cmNlc0NoYW5nZSApOwoKCQkJCWlmICggYXR0cmlidXRlcy54ckNvbXBhdGlibGUgIT09IHRydWUgKSB7CgoJCQkJCWF3YWl0IGdsLm1ha2VYUkNvbXBhdGlibGUoKTsKCgkJCQl9CgoJCQkJY3VycmVudFBpeGVsUmF0aW8gPSByZW5kZXJlci5nZXRQaXhlbFJhdGlvKCk7CgkJCQlyZW5kZXJlci5nZXRTaXplKCBjdXJyZW50U2l6ZSApOwoKCQkJCWlmICggKCBzZXNzaW9uLnJlbmRlclN0YXRlLmxheWVycyA9PT0gdW5kZWZpbmVkICkgfHwgKCByZW5kZXJlci5jYXBhYmlsaXRpZXMuaXNXZWJHTDIgPT09IGZhbHNlICkgKSB7CgoJCQkJCWNvbnN0IGxheWVySW5pdCA9IHsKCQkJCQkJYW50aWFsaWFzOiAoIHNlc3Npb24ucmVuZGVyU3RhdGUubGF5ZXJzID09PSB1bmRlZmluZWQgKSA/IGF0dHJpYnV0ZXMuYW50aWFsaWFzIDogdHJ1ZSwKCQkJCQkJYWxwaGE6IHRydWUsCgkJCQkJCWRlcHRoOiBhdHRyaWJ1dGVzLmRlcHRoLAoJCQkJCQlzdGVuY2lsOiBhdHRyaWJ1dGVzLnN0ZW5jaWwsCgkJCQkJCWZyYW1lYnVmZmVyU2NhbGVGYWN0b3I6IGZyYW1lYnVmZmVyU2NhbGVGYWN0b3IKCQkJCQl9OwoKCQkJCQlnbEJhc2VMYXllciA9IG5ldyBYUldlYkdMTGF5ZXIoIHNlc3Npb24sIGdsLCBsYXllckluaXQgKTsKCgkJCQkJc2Vzc2lvbi51cGRhdGVSZW5kZXJTdGF0ZSggeyBiYXNlTGF5ZXI6IGdsQmFzZUxheWVyIH0gKTsKCgkJCQkJcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggMSApOwoJCQkJCXJlbmRlcmVyLnNldFNpemUoIGdsQmFzZUxheWVyLmZyYW1lYnVmZmVyV2lkdGgsIGdsQmFzZUxheWVyLmZyYW1lYnVmZmVySGVpZ2h0LCBmYWxzZSApOwoKCQkJCQluZXdSZW5kZXJUYXJnZXQgPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoCgkJCQkJCWdsQmFzZUxheWVyLmZyYW1lYnVmZmVyV2lkdGgsCgkJCQkJCWdsQmFzZUxheWVyLmZyYW1lYnVmZmVySGVpZ2h0LAoJCQkJCQl7CgkJCQkJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCgkJCQkJCQl0eXBlOiBVbnNpZ25lZEJ5dGVUeXBlLAoJCQkJCQkJY29sb3JTcGFjZTogcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSwKCQkJCQkJCXN0ZW5jaWxCdWZmZXI6IGF0dHJpYnV0ZXMuc3RlbmNpbAoJCQkJCQl9CgkJCQkJKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlsZXQgZGVwdGhGb3JtYXQgPSBudWxsOwoJCQkJCWxldCBkZXB0aFR5cGUgPSBudWxsOwoJCQkJCWxldCBnbERlcHRoRm9ybWF0ID0gbnVsbDsKCgkJCQkJaWYgKCBhdHRyaWJ1dGVzLmRlcHRoICkgewoKCQkJCQkJZ2xEZXB0aEZvcm1hdCA9IGF0dHJpYnV0ZXMuc3RlbmNpbCA/IGdsLkRFUFRIMjRfU1RFTkNJTDggOiBnbC5ERVBUSF9DT01QT05FTlQyNDsKCQkJCQkJZGVwdGhGb3JtYXQgPSBhdHRyaWJ1dGVzLnN0ZW5jaWwgPyBEZXB0aFN0ZW5jaWxGb3JtYXQgOiBEZXB0aEZvcm1hdDsKCQkJCQkJZGVwdGhUeXBlID0gYXR0cmlidXRlcy5zdGVuY2lsID8gVW5zaWduZWRJbnQyNDhUeXBlIDogVW5zaWduZWRJbnRUeXBlOwoKCQkJCQl9CgoJCQkJCWNvbnN0IHByb2plY3Rpb25sYXllckluaXQgPSB7CgkJCQkJCWNvbG9yRm9ybWF0OiBnbC5SR0JBOCwKCQkJCQkJZGVwdGhGb3JtYXQ6IGdsRGVwdGhGb3JtYXQsCgkJCQkJCXNjYWxlRmFjdG9yOiBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yCgkJCQkJfTsKCgkJCQkJZ2xCaW5kaW5nID0gbmV3IFhSV2ViR0xCaW5kaW5nKCBzZXNzaW9uLCBnbCApOwoKCQkJCQlnbFByb2pMYXllciA9IGdsQmluZGluZy5jcmVhdGVQcm9qZWN0aW9uTGF5ZXIoIHByb2plY3Rpb25sYXllckluaXQgKTsKCgkJCQkJc2Vzc2lvbi51cGRhdGVSZW5kZXJTdGF0ZSggeyBsYXllcnM6IFsgZ2xQcm9qTGF5ZXIgXSB9ICk7CgoJCQkJCXJlbmRlcmVyLnNldFBpeGVsUmF0aW8oIDEgKTsKCQkJCQlyZW5kZXJlci5zZXRTaXplKCBnbFByb2pMYXllci50ZXh0dXJlV2lkdGgsIGdsUHJvakxheWVyLnRleHR1cmVIZWlnaHQsIGZhbHNlICk7CgoJCQkJCW5ld1JlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCgKCQkJCQkJZ2xQcm9qTGF5ZXIudGV4dHVyZVdpZHRoLAoJCQkJCQlnbFByb2pMYXllci50ZXh0dXJlSGVpZ2h0LAoJCQkJCQl7CgkJCQkJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCgkJCQkJCQl0eXBlOiBVbnNpZ25lZEJ5dGVUeXBlLAoJCQkJCQkJZGVwdGhUZXh0dXJlOiBuZXcgRGVwdGhUZXh0dXJlKCBnbFByb2pMYXllci50ZXh0dXJlV2lkdGgsIGdsUHJvakxheWVyLnRleHR1cmVIZWlnaHQsIGRlcHRoVHlwZSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgZGVwdGhGb3JtYXQgKSwKCQkJCQkJCXN0ZW5jaWxCdWZmZXI6IGF0dHJpYnV0ZXMuc3RlbmNpbCwKCQkJCQkJCWNvbG9yU3BhY2U6IHJlbmRlcmVyLm91dHB1dENvbG9yU3BhY2UsCgkJCQkJCQlzYW1wbGVzOiBhdHRyaWJ1dGVzLmFudGlhbGlhcyA/IDQgOiAwCgkJCQkJCX0gKTsKCgkJCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHJlbmRlcmVyLnByb3BlcnRpZXMuZ2V0KCBuZXdSZW5kZXJUYXJnZXQgKTsKCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9faWdub3JlRGVwdGhWYWx1ZXMgPSBnbFByb2pMYXllci5pZ25vcmVEZXB0aFZhbHVlczsKCgkJCQl9CgoJCQkJbmV3UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPSB0cnVlOyAvLyBUT0RPIFJlbW92ZSB0aGlzIHdoZW4gcG9zc2libGUsIHNlZSAjMjMyNzgKCgkJCQl0aGlzLnNldEZvdmVhdGlvbiggZm92ZWF0aW9uICk7CgoJCQkJY3VzdG9tUmVmZXJlbmNlU3BhY2UgPSBudWxsOwoJCQkJcmVmZXJlbmNlU3BhY2UgPSBhd2FpdCBzZXNzaW9uLnJlcXVlc3RSZWZlcmVuY2VTcGFjZSggcmVmZXJlbmNlU3BhY2VUeXBlICk7CgoJCQkJYW5pbWF0aW9uLnNldENvbnRleHQoIHNlc3Npb24gKTsKCQkJCWFuaW1hdGlvbi5zdGFydCgpOwoKCQkJCXNjb3BlLmlzUHJlc2VudGluZyA9IHRydWU7CgoJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnc2Vzc2lvbnN0YXJ0JyB9ICk7CgoJCQl9CgoJCX07CgoJCXRoaXMuZ2V0RW52aXJvbm1lbnRCbGVuZE1vZGUgPSBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIHNlc3Npb24gIT09IG51bGwgKSB7CgoJCQkJcmV0dXJuIHNlc3Npb24uZW52aXJvbm1lbnRCbGVuZE1vZGU7CgoJCQl9CgoJCX07CgoJCWZ1bmN0aW9uIG9uSW5wdXRTb3VyY2VzQ2hhbmdlKCBldmVudCApIHsKCgkJCS8vIE5vdGlmeSBkaXNjb25uZWN0ZWQKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGV2ZW50LnJlbW92ZWQubGVuZ3RoOyBpICsrICkgewoKCQkJCWNvbnN0IGlucHV0U291cmNlID0gZXZlbnQucmVtb3ZlZFsgaSBdOwoJCQkJY29uc3QgaW5kZXggPSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmluZGV4T2YoIGlucHV0U291cmNlICk7CgoJCQkJaWYgKCBpbmRleCA+PSAwICkgewoKCQkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzWyBpbmRleCBdID0gbnVsbDsKCQkJCQljb250cm9sbGVyc1sgaW5kZXggXS5kaXNjb25uZWN0KCBpbnB1dFNvdXJjZSApOwoKCQkJCX0KCgkJCX0KCgkJCS8vIE5vdGlmeSBjb25uZWN0ZWQKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGV2ZW50LmFkZGVkLmxlbmd0aDsgaSArKyApIHsKCgkJCQljb25zdCBpbnB1dFNvdXJjZSA9IGV2ZW50LmFkZGVkWyBpIF07CgoJCQkJbGV0IGNvbnRyb2xsZXJJbmRleCA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMuaW5kZXhPZiggaW5wdXRTb3VyY2UgKTsKCgkJCQlpZiAoIGNvbnRyb2xsZXJJbmRleCA9PT0gLSAxICkgewoKCQkJCQkvLyBBc3NpZ24gaW5wdXQgc291cmNlIGEgY29udHJvbGxlciB0aGF0IGN1cnJlbnRseSBoYXMgbm8gaW5wdXQgc291cmNlCgoJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCWlmICggaSA+PSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmxlbmd0aCApIHsKCgkJCQkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzLnB1c2goIGlucHV0U291cmNlICk7CgkJCQkJCQljb250cm9sbGVySW5kZXggPSBpOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQl9IGVsc2UgaWYgKCBjb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF0gPT09IG51bGwgKSB7CgoJCQkJCQkJY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdID0gaW5wdXRTb3VyY2U7CgkJCQkJCQljb250cm9sbGVySW5kZXggPSBpOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJLy8gSWYgYWxsIGNvbnRyb2xsZXJzIGRvIGN1cnJlbnRseSByZWNlaXZlIGlucHV0IHdlIGlnbm9yZSBuZXcgb25lcwoKCQkJCQlpZiAoIGNvbnRyb2xsZXJJbmRleCA9PT0gLSAxICkgYnJlYWs7CgoJCQkJfQoKCQkJCWNvbnN0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgY29udHJvbGxlckluZGV4IF07CgoJCQkJaWYgKCBjb250cm9sbGVyICkgewoKCQkJCQljb250cm9sbGVyLmNvbm5lY3QoIGlucHV0U291cmNlICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8vCgoJCWNvbnN0IGNhbWVyYUxQb3MgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IGNhbWVyYVJQb3MgPSBuZXcgVmVjdG9yMygpOwoKCQkvKioKCQkgKiBBc3N1bWVzIDIgY2FtZXJhcyB0aGF0IGFyZSBwYXJhbGxlbCBhbmQgc2hhcmUgYW4gWC1heGlzLCBhbmQgdGhhdAoJCSAqIHRoZSBjYW1lcmFzJyBwcm9qZWN0aW9uIGFuZCB3b3JsZCBtYXRyaWNlcyBoYXZlIGFscmVhZHkgYmVlbiBzZXQuCgkJICogQW5kIHRoYXQgbmVhciBhbmQgZmFyIHBsYW5lcyBhcmUgaWRlbnRpY2FsIGZvciBib3RoIGNhbWVyYXMuCgkJICogVmlzdWFsaXphdGlvbiBvZiB0aGlzIHRlY2huaXF1ZTogaHR0cHM6Ly9jb21wdXRlcmdyYXBoaWNzLnN0YWNrZXhjaGFuZ2UuY29tL2EvNDc2NQoJCSAqLwoJCWZ1bmN0aW9uIHNldFByb2plY3Rpb25Gcm9tVW5pb24oIGNhbWVyYSwgY2FtZXJhTCwgY2FtZXJhUiApIHsKCgkJCWNhbWVyYUxQb3Muc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmFMLm1hdHJpeFdvcmxkICk7CgkJCWNhbWVyYVJQb3Muc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmFSLm1hdHJpeFdvcmxkICk7CgoJCQljb25zdCBpcGQgPSBjYW1lcmFMUG9zLmRpc3RhbmNlVG8oIGNhbWVyYVJQb3MgKTsKCgkJCWNvbnN0IHByb2pMID0gY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzOwoJCQljb25zdCBwcm9qUiA9IGNhbWVyYVIucHJvamVjdGlvbk1hdHJpeC5lbGVtZW50czsKCgkJCS8vIFZSIHN5c3RlbXMgd2lsbCBoYXZlIGlkZW50aWNhbCBmYXIgYW5kIG5lYXIgcGxhbmVzLCBhbmQKCQkJLy8gbW9zdCBsaWtlbHkgaWRlbnRpY2FsIHRvcCBhbmQgYm90dG9tIGZydXN0dW0gZXh0ZW50cy4KCQkJLy8gVXNlIHRoZSBsZWZ0IGNhbWVyYSBmb3IgdGhlc2UgdmFsdWVzLgoJCQljb25zdCBuZWFyID0gcHJvakxbIDE0IF0gLyAoIHByb2pMWyAxMCBdIC0gMSApOwoJCQljb25zdCBmYXIgPSBwcm9qTFsgMTQgXSAvICggcHJvakxbIDEwIF0gKyAxICk7CgkJCWNvbnN0IHRvcEZvdiA9ICggcHJvakxbIDkgXSArIDEgKSAvIHByb2pMWyA1IF07CgkJCWNvbnN0IGJvdHRvbUZvdiA9ICggcHJvakxbIDkgXSAtIDEgKSAvIHByb2pMWyA1IF07CgoJCQljb25zdCBsZWZ0Rm92ID0gKCBwcm9qTFsgOCBdIC0gMSApIC8gcHJvakxbIDAgXTsKCQkJY29uc3QgcmlnaHRGb3YgPSAoIHByb2pSWyA4IF0gKyAxICkgLyBwcm9qUlsgMCBdOwoJCQljb25zdCBsZWZ0ID0gbmVhciAqIGxlZnRGb3Y7CgkJCWNvbnN0IHJpZ2h0ID0gbmVhciAqIHJpZ2h0Rm92OwoKCQkJLy8gQ2FsY3VsYXRlIHRoZSBuZXcgY2FtZXJhJ3MgcG9zaXRpb24gb2Zmc2V0IGZyb20gdGhlCgkJCS8vIGxlZnQgY2FtZXJhLiB4T2Zmc2V0IHNob3VsZCBiZSByb3VnaGx5IGhhbGYgYGlwZGAuCgkJCWNvbnN0IHpPZmZzZXQgPSBpcGQgLyAoIC0gbGVmdEZvdiArIHJpZ2h0Rm92ICk7CgkJCWNvbnN0IHhPZmZzZXQgPSB6T2Zmc2V0ICogLSBsZWZ0Rm92OwoKCQkJLy8gVE9ETzogQmV0dGVyIHdheSB0byBhcHBseSB0aGlzIG9mZnNldD8KCQkJY2FtZXJhTC5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwoJCQljYW1lcmEudHJhbnNsYXRlWCggeE9mZnNldCApOwoJCQljYW1lcmEudHJhbnNsYXRlWiggek9mZnNldCApOwoJCQljYW1lcmEubWF0cml4V29ybGQuY29tcG9zZSggY2FtZXJhLnBvc2l0aW9uLCBjYW1lcmEucXVhdGVybmlvbiwgY2FtZXJhLnNjYWxlICk7CgkJCWNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UuY29weSggY2FtZXJhLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgoJCQkvLyBGaW5kIHRoZSB1bmlvbiBvZiB0aGUgZnJ1c3R1bSB2YWx1ZXMgb2YgdGhlIGNhbWVyYXMgYW5kIHNjYWxlCgkJCS8vIHRoZSB2YWx1ZXMgc28gdGhhdCB0aGUgbmVhciBwbGFuZSdzIHBvc2l0aW9uIGRvZXMgbm90IGNoYW5nZSBpbiB3b3JsZCBzcGFjZSwKCQkJLy8gYWx0aG91Z2ggbXVzdCBub3cgYmUgcmVsYXRpdmUgdG8gdGhlIG5ldyB1bmlvbiBjYW1lcmEuCgkJCWNvbnN0IG5lYXIyID0gbmVhciArIHpPZmZzZXQ7CgkJCWNvbnN0IGZhcjIgPSBmYXIgKyB6T2Zmc2V0OwoJCQljb25zdCBsZWZ0MiA9IGxlZnQgLSB4T2Zmc2V0OwoJCQljb25zdCByaWdodDIgPSByaWdodCArICggaXBkIC0geE9mZnNldCApOwoJCQljb25zdCB0b3AyID0gdG9wRm92ICogZmFyIC8gZmFyMiAqIG5lYXIyOwoJCQljb25zdCBib3R0b20yID0gYm90dG9tRm92ICogZmFyIC8gZmFyMiAqIG5lYXIyOwoKCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXgubWFrZVBlcnNwZWN0aXZlKCBsZWZ0MiwgcmlnaHQyLCB0b3AyLCBib3R0b20yLCBuZWFyMiwgZmFyMiApOwoJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKS5pbnZlcnQoKTsKCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGVDYW1lcmEoIGNhbWVyYSwgcGFyZW50ICkgewoKCQkJaWYgKCBwYXJlbnQgPT09IG51bGwgKSB7CgoJCQkJY2FtZXJhLm1hdHJpeFdvcmxkLmNvcHkoIGNhbWVyYS5tYXRyaXggKTsKCgkJCX0gZWxzZSB7CgoJCQkJY2FtZXJhLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHBhcmVudC5tYXRyaXhXb3JsZCwgY2FtZXJhLm1hdHJpeCApOwoKCQkJfQoKCQkJY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZS5jb3B5KCBjYW1lcmEubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgkJfQoKCQl0aGlzLnVwZGF0ZUNhbWVyYSA9IGZ1bmN0aW9uICggY2FtZXJhICkgewoKCQkJaWYgKCBzZXNzaW9uID09PSBudWxsICkgcmV0dXJuOwoKCQkJY2FtZXJhWFIubmVhciA9IGNhbWVyYVIubmVhciA9IGNhbWVyYUwubmVhciA9IGNhbWVyYS5uZWFyOwoJCQljYW1lcmFYUi5mYXIgPSBjYW1lcmFSLmZhciA9IGNhbWVyYUwuZmFyID0gY2FtZXJhLmZhcjsKCgkJCWlmICggX2N1cnJlbnREZXB0aE5lYXIgIT09IGNhbWVyYVhSLm5lYXIgfHwgX2N1cnJlbnREZXB0aEZhciAhPT0gY2FtZXJhWFIuZmFyICkgewoKCQkJCS8vIE5vdGUgdGhhdCB0aGUgbmV3IHJlbmRlclN0YXRlIHdvbid0IGFwcGx5IHVudGlsIHRoZSBuZXh0IGZyYW1lLiBTZWUgIzE4MzIwCgoJCQkJc2Vzc2lvbi51cGRhdGVSZW5kZXJTdGF0ZSggewoJCQkJCWRlcHRoTmVhcjogY2FtZXJhWFIubmVhciwKCQkJCQlkZXB0aEZhcjogY2FtZXJhWFIuZmFyCgkJCQl9ICk7CgoJCQkJX2N1cnJlbnREZXB0aE5lYXIgPSBjYW1lcmFYUi5uZWFyOwoJCQkJX2N1cnJlbnREZXB0aEZhciA9IGNhbWVyYVhSLmZhcjsKCgkJCX0KCgkJCWNvbnN0IHBhcmVudCA9IGNhbWVyYS5wYXJlbnQ7CgkJCWNvbnN0IGNhbWVyYXMgPSBjYW1lcmFYUi5jYW1lcmFzOwoKCQkJdXBkYXRlQ2FtZXJhKCBjYW1lcmFYUiwgcGFyZW50ICk7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjYW1lcmFzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl1cGRhdGVDYW1lcmEoIGNhbWVyYXNbIGkgXSwgcGFyZW50ICk7CgoJCQl9CgoJCQkvLyB1cGRhdGUgcHJvamVjdGlvbiBtYXRyaXggZm9yIHByb3BlciB2aWV3IGZydXN0dW0gY3VsbGluZwoKCQkJaWYgKCBjYW1lcmFzLmxlbmd0aCA9PT0gMiApIHsKCgkJCQlzZXRQcm9qZWN0aW9uRnJvbVVuaW9uKCBjYW1lcmFYUiwgY2FtZXJhTCwgY2FtZXJhUiApOwoKCQkJfSBlbHNlIHsKCgkJCQkvLyBhc3N1bWUgc2luZ2xlIGNhbWVyYSBzZXR1cCAoQVIpCgoJCQkJY2FtZXJhWFIucHJvamVjdGlvbk1hdHJpeC5jb3B5KCBjYW1lcmFMLnByb2plY3Rpb25NYXRyaXggKTsKCgkJCX0KCgkJCS8vIHVwZGF0ZSB1c2VyIGNhbWVyYSBhbmQgaXRzIGNoaWxkcmVuCgoJCQl1cGRhdGVVc2VyQ2FtZXJhKCBjYW1lcmEsIGNhbWVyYVhSLCBwYXJlbnQgKTsKCgkJfTsKCgkJZnVuY3Rpb24gdXBkYXRlVXNlckNhbWVyYSggY2FtZXJhLCBjYW1lcmFYUiwgcGFyZW50ICkgewoKCQkJaWYgKCBwYXJlbnQgPT09IG51bGwgKSB7CgoJCQkJY2FtZXJhLm1hdHJpeC5jb3B5KCBjYW1lcmFYUi5tYXRyaXhXb3JsZCApOwoKCQkJfSBlbHNlIHsKCgkJCQljYW1lcmEubWF0cml4LmNvcHkoIHBhcmVudC5tYXRyaXhXb3JsZCApOwoJCQkJY2FtZXJhLm1hdHJpeC5pbnZlcnQoKTsKCQkJCWNhbWVyYS5tYXRyaXgubXVsdGlwbHkoIGNhbWVyYVhSLm1hdHJpeFdvcmxkICk7CgoJCQl9CgoJCQljYW1lcmEubWF0cml4LmRlY29tcG9zZSggY2FtZXJhLnBvc2l0aW9uLCBjYW1lcmEucXVhdGVybmlvbiwgY2FtZXJhLnNjYWxlICk7CgkJCWNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCggdHJ1ZSApOwoKCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhWFIucHJvamVjdGlvbk1hdHJpeCApOwoJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggY2FtZXJhWFIucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCgkJCWlmICggY2FtZXJhLmlzUGVyc3BlY3RpdmVDYW1lcmEgKSB7CgoJCQkJY2FtZXJhLmZvdiA9IFJBRDJERUcgKiAyICogTWF0aC5hdGFuKCAxIC8gY2FtZXJhLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHNbIDUgXSApOwoJCQkJY2FtZXJhLnpvb20gPSAxOwoKCQkJfQoKCQl9CgoJCXRoaXMuZ2V0Q2FtZXJhID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIGNhbWVyYVhSOwoKCQl9OwoKCQl0aGlzLmdldEZvdmVhdGlvbiA9IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggZ2xQcm9qTGF5ZXIgPT09IG51bGwgJiYgZ2xCYXNlTGF5ZXIgPT09IG51bGwgKSB7CgoJCQkJcmV0dXJuIHVuZGVmaW5lZDsKCgkJCX0KCgkJCXJldHVybiBmb3ZlYXRpb247CgoJCX07CgoJCXRoaXMuc2V0Rm92ZWF0aW9uID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCS8vIDAgPSBubyBmb3ZlYXRpb24gPSBmdWxsIHJlc29sdXRpb24KCQkJLy8gMSA9IG1heGltdW0gZm92ZWF0aW9uID0gdGhlIGVkZ2VzIHJlbmRlciBhdCBsb3dlciByZXNvbHV0aW9uCgoJCQlmb3ZlYXRpb24gPSB2YWx1ZTsKCgkJCWlmICggZ2xQcm9qTGF5ZXIgIT09IG51bGwgKSB7CgoJCQkJZ2xQcm9qTGF5ZXIuZml4ZWRGb3ZlYXRpb24gPSB2YWx1ZTsKCgkJCX0KCgkJCWlmICggZ2xCYXNlTGF5ZXIgIT09IG51bGwgJiYgZ2xCYXNlTGF5ZXIuZml4ZWRGb3ZlYXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQlnbEJhc2VMYXllci5maXhlZEZvdmVhdGlvbiA9IHZhbHVlOwoKCQkJfQoKCQl9OwoKCQkvLyBBbmltYXRpb24gTG9vcAoKCQlsZXQgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrID0gbnVsbDsKCgkJZnVuY3Rpb24gb25BbmltYXRpb25GcmFtZSggdGltZSwgZnJhbWUgKSB7CgoJCQlwb3NlID0gZnJhbWUuZ2V0Vmlld2VyUG9zZSggY3VzdG9tUmVmZXJlbmNlU3BhY2UgfHwgcmVmZXJlbmNlU3BhY2UgKTsKCQkJeHJGcmFtZSA9IGZyYW1lOwoKCQkJaWYgKCBwb3NlICE9PSBudWxsICkgewoKCQkJCWNvbnN0IHZpZXdzID0gcG9zZS52aWV3czsKCgkJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICkgewoKCQkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXRGcmFtZWJ1ZmZlciggbmV3UmVuZGVyVGFyZ2V0LCBnbEJhc2VMYXllci5mcmFtZWJ1ZmZlciApOwoJCQkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggbmV3UmVuZGVyVGFyZ2V0ICk7CgoJCQkJfQoKCQkJCWxldCBjYW1lcmFYUk5lZWRzVXBkYXRlID0gZmFsc2U7CgoJCQkJLy8gY2hlY2sgaWYgaXQncyBuZWNlc3NhcnkgdG8gcmVidWlsZCBjYW1lcmFYUidzIGNhbWVyYSBsaXN0CgoJCQkJaWYgKCB2aWV3cy5sZW5ndGggIT09IGNhbWVyYVhSLmNhbWVyYXMubGVuZ3RoICkgewoKCQkJCQljYW1lcmFYUi5jYW1lcmFzLmxlbmd0aCA9IDA7CgkJCQkJY2FtZXJhWFJOZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJfQoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHZpZXdzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgdmlldyA9IHZpZXdzWyBpIF07CgoJCQkJCWxldCB2aWV3cG9ydCA9IG51bGw7CgoJCQkJCWlmICggZ2xCYXNlTGF5ZXIgIT09IG51bGwgKSB7CgoJCQkJCQl2aWV3cG9ydCA9IGdsQmFzZUxheWVyLmdldFZpZXdwb3J0KCB2aWV3ICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQljb25zdCBnbFN1YkltYWdlID0gZ2xCaW5kaW5nLmdldFZpZXdTdWJJbWFnZSggZ2xQcm9qTGF5ZXIsIHZpZXcgKTsKCQkJCQkJdmlld3BvcnQgPSBnbFN1YkltYWdlLnZpZXdwb3J0OwoKCQkJCQkJLy8gRm9yIHNpZGUtYnktc2lkZSBwcm9qZWN0aW9uLCB3ZSBvbmx5IHByb2R1Y2UgYSBzaW5nbGUgdGV4dHVyZSBmb3IgYm90aCBleWVzLgoJCQkJCQlpZiAoIGkgPT09IDAgKSB7CgoJCQkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0VGV4dHVyZXMoCgkJCQkJCQkJbmV3UmVuZGVyVGFyZ2V0LAoJCQkJCQkJCWdsU3ViSW1hZ2UuY29sb3JUZXh0dXJlLAoJCQkJCQkJCWdsUHJvakxheWVyLmlnbm9yZURlcHRoVmFsdWVzID8gdW5kZWZpbmVkIDogZ2xTdWJJbWFnZS5kZXB0aFN0ZW5jaWxUZXh0dXJlICk7CgoJCQkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBuZXdSZW5kZXJUYXJnZXQgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQlsZXQgY2FtZXJhID0gY2FtZXJhc1sgaSBdOwoKCQkJCQlpZiAoIGNhbWVyYSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJY2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJCQkJCWNhbWVyYS5sYXllcnMuZW5hYmxlKCBpICk7CgkJCQkJCWNhbWVyYS52aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CgkJCQkJCWNhbWVyYXNbIGkgXSA9IGNhbWVyYTsKCgkJCQkJfQoKCQkJCQljYW1lcmEubWF0cml4LmZyb21BcnJheSggdmlldy50cmFuc2Zvcm0ubWF0cml4ICk7CgkJCQkJY2FtZXJhLm1hdHJpeC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwoJCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmZyb21BcnJheSggdmlldy5wcm9qZWN0aW9uTWF0cml4ICk7CgkJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICkuaW52ZXJ0KCk7CgkJCQkJY2FtZXJhLnZpZXdwb3J0LnNldCggdmlld3BvcnQueCwgdmlld3BvcnQueSwgdmlld3BvcnQud2lkdGgsIHZpZXdwb3J0LmhlaWdodCApOwoKCQkJCQlpZiAoIGkgPT09IDAgKSB7CgoJCQkJCQljYW1lcmFYUi5tYXRyaXguY29weSggY2FtZXJhLm1hdHJpeCApOwoJCQkJCQljYW1lcmFYUi5tYXRyaXguZGVjb21wb3NlKCBjYW1lcmFYUi5wb3NpdGlvbiwgY2FtZXJhWFIucXVhdGVybmlvbiwgY2FtZXJhWFIuc2NhbGUgKTsKCgkJCQkJfQoKCQkJCQlpZiAoIGNhbWVyYVhSTmVlZHNVcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJCQljYW1lcmFYUi5jYW1lcmFzLnB1c2goIGNhbWVyYSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLy8KCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSArKyApIHsKCgkJCQljb25zdCBpbnB1dFNvdXJjZSA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGkgXTsKCQkJCWNvbnN0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaSBdOwoKCQkJCWlmICggaW5wdXRTb3VyY2UgIT09IG51bGwgJiYgY29udHJvbGxlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQljb250cm9sbGVyLnVwZGF0ZSggaW5wdXRTb3VyY2UsIGZyYW1lLCBjdXN0b21SZWZlcmVuY2VTcGFjZSB8fCByZWZlcmVuY2VTcGFjZSApOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggb25BbmltYXRpb25GcmFtZUNhbGxiYWNrICkgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrKCB0aW1lLCBmcmFtZSApOwoKCQkJaWYgKCBmcmFtZS5kZXRlY3RlZFBsYW5lcyApIHsKCgkJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdwbGFuZXNkZXRlY3RlZCcsIGRhdGE6IGZyYW1lIH0gKTsKCgkJCX0KCgkJCXhyRnJhbWUgPSBudWxsOwoKCQl9CgoJCWNvbnN0IGFuaW1hdGlvbiA9IG5ldyBXZWJHTEFuaW1hdGlvbigpOwoKCQlhbmltYXRpb24uc2V0QW5pbWF0aW9uTG9vcCggb25BbmltYXRpb25GcmFtZSApOwoKCQl0aGlzLnNldEFuaW1hdGlvbkxvb3AgPSBmdW5jdGlvbiAoIGNhbGxiYWNrICkgewoKCQkJb25BbmltYXRpb25GcmFtZUNhbGxiYWNrID0gY2FsbGJhY2s7CgoJCX07CgoJCXRoaXMuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHt9OwoKCX0KCn0KCmZ1bmN0aW9uIFdlYkdMTWF0ZXJpYWxzKCByZW5kZXJlciwgcHJvcGVydGllcyApIHsKCglmdW5jdGlvbiByZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWFwLCB1bmlmb3JtICkgewoKCQlpZiAoIG1hcC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJbWFwLnVwZGF0ZU1hdHJpeCgpOwoKCQl9CgoJCXVuaWZvcm0udmFsdWUuY29weSggbWFwLm1hdHJpeCApOwoKCX0KCglmdW5jdGlvbiByZWZyZXNoRm9nVW5pZm9ybXMoIHVuaWZvcm1zLCBmb2cgKSB7CgoJCWZvZy5jb2xvci5nZXRSR0IoIHVuaWZvcm1zLmZvZ0NvbG9yLnZhbHVlLCBnZXRVbmxpdFVuaWZvcm1Db2xvclNwYWNlKCByZW5kZXJlciApICk7CgoJCWlmICggZm9nLmlzRm9nICkgewoKCQkJdW5pZm9ybXMuZm9nTmVhci52YWx1ZSA9IGZvZy5uZWFyOwoJCQl1bmlmb3Jtcy5mb2dGYXIudmFsdWUgPSBmb2cuZmFyOwoKCQl9IGVsc2UgaWYgKCBmb2cuaXNGb2dFeHAyICkgewoKCQkJdW5pZm9ybXMuZm9nRGVuc2l0eS52YWx1ZSA9IGZvZy5kZW5zaXR5OwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHJlZnJlc2hNYXRlcmlhbFVuaWZvcm1zKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHBpeGVsUmF0aW8sIGhlaWdodCwgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICkgewoKCQlpZiAoIG1hdGVyaWFsLmlzTWVzaEJhc2ljTWF0ZXJpYWwgKSB7CgoJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgKSB7CgoJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgKSB7CgoJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQlyZWZyZXNoVW5pZm9ybXNUb29uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoUGhvbmdNYXRlcmlhbCApIHsKCgkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgkJCXJlZnJlc2hVbmlmb3Jtc1Bob25nKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCApIHsKCgkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgkJCXJlZnJlc2hVbmlmb3Jtc1N0YW5kYXJkKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCWlmICggbWF0ZXJpYWwuaXNNZXNoUGh5c2ljYWxNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNQaHlzaWNhbCggdW5pZm9ybXMsIG1hdGVyaWFsLCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCgkJCX0KCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoTWF0Y2FwTWF0ZXJpYWwgKSB7CgoJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQlyZWZyZXNoVW5pZm9ybXNNYXRjYXAoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hEZXB0aE1hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoRGlzdGFuY2VNYXRlcmlhbCApIHsKCgkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgkJCXJlZnJlc2hVbmlmb3Jtc0Rpc3RhbmNlKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoTm9ybWFsTWF0ZXJpYWwgKSB7CgoJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc0xpbmVCYXNpY01hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zTGluZSggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQlpZiAoIG1hdGVyaWFsLmlzTGluZURhc2hlZE1hdGVyaWFsICkgewoKCQkJCXJlZnJlc2hVbmlmb3Jtc0Rhc2goIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1BvaW50c01hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zUG9pbnRzKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHBpeGVsUmF0aW8sIGhlaWdodCApOwoKCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1Nwcml0ZU1hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zU3ByaXRlcyggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU2hhZG93TWF0ZXJpYWwgKSB7CgoJCQl1bmlmb3Jtcy5jb2xvci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwoJCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCApIHsKCgkJCW1hdGVyaWFsLnVuaWZvcm1zTmVlZFVwZGF0ZSA9IGZhbHNlOyAvLyAjMTU1ODEKCgkJfQoKCX0KCglmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgoJCWlmICggbWF0ZXJpYWwuY29sb3IgKSB7CgoJCQl1bmlmb3Jtcy5kaWZmdXNlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmNvbG9yICk7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5lbWlzc2l2ZSApIHsKCgkJCXVuaWZvcm1zLmVtaXNzaXZlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmVtaXNzaXZlICkubXVsdGlwbHlTY2FsYXIoIG1hdGVyaWFsLmVtaXNzaXZlSW50ZW5zaXR5ICk7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5tYXAgKSB7CgoJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmFscGhhTWFwICkgewoKCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5hbHBoYU1hcCwgdW5pZm9ybXMuYWxwaGFNYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmJ1bXBNYXAgKSB7CgoJCQl1bmlmb3Jtcy5idW1wTWFwLnZhbHVlID0gbWF0ZXJpYWwuYnVtcE1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5idW1wTWFwLCB1bmlmb3Jtcy5idW1wTWFwVHJhbnNmb3JtICk7CgoJCQl1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgPSBtYXRlcmlhbC5idW1wU2NhbGU7CgoJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgewoKCQkJCXVuaWZvcm1zLmJ1bXBTY2FsZS52YWx1ZSAqPSAtIDE7CgoJCQl9CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5ub3JtYWxNYXAgKSB7CgoJCQl1bmlmb3Jtcy5ub3JtYWxNYXAudmFsdWUgPSBtYXRlcmlhbC5ub3JtYWxNYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubm9ybWFsTWFwLCB1bmlmb3Jtcy5ub3JtYWxNYXBUcmFuc2Zvcm0gKTsKCgkJCXVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLm5vcm1hbFNjYWxlICk7CgoJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgewoKCQkJCXVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwoKCQkJfQoKCQl9CgoJCWlmICggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwICkgewoKCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50TWFwLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwOwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCwgdW5pZm9ybXMuZGlzcGxhY2VtZW50TWFwVHJhbnNmb3JtICk7CgoJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwoJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRCaWFzLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmVtaXNzaXZlTWFwICkgewoKCQkJdW5pZm9ybXMuZW1pc3NpdmVNYXAudmFsdWUgPSBtYXRlcmlhbC5lbWlzc2l2ZU1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcCwgdW5pZm9ybXMuZW1pc3NpdmVNYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFyTWFwICkgewoKCQkJdW5pZm9ybXMuc3BlY3VsYXJNYXAudmFsdWUgPSBtYXRlcmlhbC5zcGVjdWxhck1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zcGVjdWxhck1hcCwgdW5pZm9ybXMuc3BlY3VsYXJNYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmFscGhhVGVzdCA+IDAgKSB7CgoJCQl1bmlmb3Jtcy5hbHBoYVRlc3QudmFsdWUgPSBtYXRlcmlhbC5hbHBoYVRlc3Q7CgoJCX0KCgkJY29uc3QgZW52TWFwID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICkuZW52TWFwOwoKCQlpZiAoIGVudk1hcCApIHsKCgkJCXVuaWZvcm1zLmVudk1hcC52YWx1ZSA9IGVudk1hcDsKCgkJCXVuaWZvcm1zLmZsaXBFbnZNYXAudmFsdWUgPSAoIGVudk1hcC5pc0N1YmVUZXh0dXJlICYmIGVudk1hcC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtIDEgOiAxOwoKCQkJdW5pZm9ybXMucmVmbGVjdGl2aXR5LnZhbHVlID0gbWF0ZXJpYWwucmVmbGVjdGl2aXR5OwoJCQl1bmlmb3Jtcy5pb3IudmFsdWUgPSBtYXRlcmlhbC5pb3I7CgkJCXVuaWZvcm1zLnJlZnJhY3Rpb25SYXRpby52YWx1ZSA9IG1hdGVyaWFsLnJlZnJhY3Rpb25SYXRpbzsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmxpZ2h0TWFwICkgewoKCQkJdW5pZm9ybXMubGlnaHRNYXAudmFsdWUgPSBtYXRlcmlhbC5saWdodE1hcDsKCgkJCS8vIGFydGlzdC1mcmllbmRseSBsaWdodCBpbnRlbnNpdHkgc2NhbGluZyBmYWN0b3IKCQkJY29uc3Qgc2NhbGVGYWN0b3IgPSAoIHJlbmRlcmVyLl91c2VMZWdhY3lMaWdodHMgPT09IHRydWUgKSA/IE1hdGguUEkgOiAxOwoKCQkJdW5pZm9ybXMubGlnaHRNYXBJbnRlbnNpdHkudmFsdWUgPSBtYXRlcmlhbC5saWdodE1hcEludGVuc2l0eSAqIHNjYWxlRmFjdG9yOwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmxpZ2h0TWFwLCB1bmlmb3Jtcy5saWdodE1hcFRyYW5zZm9ybSApOwoKCQl9CgoJCWlmICggbWF0ZXJpYWwuYW9NYXAgKSB7CgoJCQl1bmlmb3Jtcy5hb01hcC52YWx1ZSA9IG1hdGVyaWFsLmFvTWFwOwoJCQl1bmlmb3Jtcy5hb01hcEludGVuc2l0eS52YWx1ZSA9IG1hdGVyaWFsLmFvTWFwSW50ZW5zaXR5OwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmFvTWFwLCB1bmlmb3Jtcy5hb01hcFRyYW5zZm9ybSApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0xpbmUoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwoJCXVuaWZvcm1zLm9wYWNpdHkudmFsdWUgPSBtYXRlcmlhbC5vcGFjaXR5OwoKCQlpZiAoIG1hdGVyaWFsLm1hcCApIHsKCgkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5tYXAsIHVuaWZvcm1zLm1hcFRyYW5zZm9ybSApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0Rhc2goIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJdW5pZm9ybXMuZGFzaFNpemUudmFsdWUgPSBtYXRlcmlhbC5kYXNoU2l6ZTsKCQl1bmlmb3Jtcy50b3RhbFNpemUudmFsdWUgPSBtYXRlcmlhbC5kYXNoU2l6ZSArIG1hdGVyaWFsLmdhcFNpemU7CgkJdW5pZm9ybXMuc2NhbGUudmFsdWUgPSBtYXRlcmlhbC5zY2FsZTsKCgl9CgoJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zUG9pbnRzKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHBpeGVsUmF0aW8sIGhlaWdodCApIHsKCgkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwoJCXVuaWZvcm1zLm9wYWNpdHkudmFsdWUgPSBtYXRlcmlhbC5vcGFjaXR5OwoJCXVuaWZvcm1zLnNpemUudmFsdWUgPSBtYXRlcmlhbC5zaXplICogcGl4ZWxSYXRpbzsKCQl1bmlmb3Jtcy5zY2FsZS52YWx1ZSA9IGhlaWdodCAqIDAuNTsKCgkJaWYgKCBtYXRlcmlhbC5tYXAgKSB7CgoJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy51dlRyYW5zZm9ybSApOwoKCQl9CgoJCWlmICggbWF0ZXJpYWwuYWxwaGFNYXAgKSB7CgoJCQl1bmlmb3Jtcy5hbHBoYU1hcC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhTWFwOwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmFscGhhTWFwLCB1bmlmb3Jtcy5hbHBoYU1hcFRyYW5zZm9ybSApOwoKCQl9CgoJCWlmICggbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHsKCgkJCXVuaWZvcm1zLmFscGhhVGVzdC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhVGVzdDsKCgkJfQoKCX0KCglmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNTcHJpdGVzKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCQl1bmlmb3Jtcy5yb3RhdGlvbi52YWx1ZSA9IG1hdGVyaWFsLnJvdGF0aW9uOwoKCQlpZiAoIG1hdGVyaWFsLm1hcCApIHsKCgkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5tYXAsIHVuaWZvcm1zLm1hcFRyYW5zZm9ybSApOwoKCQl9CgoJCWlmICggbWF0ZXJpYWwuYWxwaGFNYXAgKSB7CgoJCQl1bmlmb3Jtcy5hbHBoYU1hcC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhTWFwOwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmFscGhhTWFwLCB1bmlmb3Jtcy5hbHBoYU1hcFRyYW5zZm9ybSApOwoKCQl9CgoJCWlmICggbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHsKCgkJCXVuaWZvcm1zLmFscGhhVGVzdC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhVGVzdDsKCgkJfQoKCX0KCglmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNQaG9uZyggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQl1bmlmb3Jtcy5zcGVjdWxhci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5zcGVjdWxhciApOwoJCXVuaWZvcm1zLnNoaW5pbmVzcy52YWx1ZSA9IE1hdGgubWF4KCBtYXRlcmlhbC5zaGluaW5lc3MsIDFlLTQgKTsgLy8gdG8gcHJldmVudCBwb3coIDAuMCwgMC4wICkKCgl9CgoJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zVG9vbiggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQlpZiAoIG1hdGVyaWFsLmdyYWRpZW50TWFwICkgewoKCQkJdW5pZm9ybXMuZ3JhZGllbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5ncmFkaWVudE1hcDsKCgkJfQoKCX0KCglmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNTdGFuZGFyZCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQl1bmlmb3Jtcy5tZXRhbG5lc3MudmFsdWUgPSBtYXRlcmlhbC5tZXRhbG5lc3M7CgoJCWlmICggbWF0ZXJpYWwubWV0YWxuZXNzTWFwICkgewoKCQkJdW5pZm9ybXMubWV0YWxuZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwubWV0YWxuZXNzTWFwOwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1ldGFsbmVzc01hcCwgdW5pZm9ybXMubWV0YWxuZXNzTWFwVHJhbnNmb3JtICk7CgoJCX0KCgkJdW5pZm9ybXMucm91Z2huZXNzLnZhbHVlID0gbWF0ZXJpYWwucm91Z2huZXNzOwoKCQlpZiAoIG1hdGVyaWFsLnJvdWdobmVzc01hcCApIHsKCgkJCXVuaWZvcm1zLnJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLnJvdWdobmVzc01hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5yb3VnaG5lc3NNYXAsIHVuaWZvcm1zLnJvdWdobmVzc01hcFRyYW5zZm9ybSApOwoKCQl9CgoJCWNvbnN0IGVudk1hcCA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLmVudk1hcDsKCgkJaWYgKCBlbnZNYXAgKSB7CgoJCQkvL3VuaWZvcm1zLmVudk1hcC52YWx1ZSA9IG1hdGVyaWFsLmVudk1hcDsgLy8gcGFydCBvZiB1bmlmb3JtcyBjb21tb24KCQkJdW5pZm9ybXMuZW52TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuZW52TWFwSW50ZW5zaXR5OwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1BoeXNpY2FsKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApIHsKCgkJdW5pZm9ybXMuaW9yLnZhbHVlID0gbWF0ZXJpYWwuaW9yOyAvLyBhbHNvIHBhcnQgb2YgdW5pZm9ybXMgY29tbW9uCgoJCWlmICggbWF0ZXJpYWwuc2hlZW4gPiAwICkgewoKCQkJdW5pZm9ybXMuc2hlZW5Db2xvci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5zaGVlbkNvbG9yICkubXVsdGlwbHlTY2FsYXIoIG1hdGVyaWFsLnNoZWVuICk7CgoJCQl1bmlmb3Jtcy5zaGVlblJvdWdobmVzcy52YWx1ZSA9IG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzOwoKCQkJaWYgKCBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwICkgewoKCQkJCXVuaWZvcm1zLnNoZWVuQ29sb3JNYXAudmFsdWUgPSBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwLCB1bmlmb3Jtcy5zaGVlbkNvbG9yTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwICkgewoKCQkJCXVuaWZvcm1zLnNoZWVuUm91Z2huZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwLCB1bmlmb3Jtcy5zaGVlblJvdWdobmVzc01hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQl9CgoJCWlmICggbWF0ZXJpYWwuY2xlYXJjb2F0ID4gMCApIHsKCgkJCXVuaWZvcm1zLmNsZWFyY29hdC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdDsKCQkJdW5pZm9ybXMuY2xlYXJjb2F0Um91Z2huZXNzLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzOwoKCQkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXRNYXAgKSB7CgoJCQkJdW5pZm9ybXMuY2xlYXJjb2F0TWFwLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0TWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5jbGVhcmNvYXRNYXAsIHVuaWZvcm1zLmNsZWFyY29hdE1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgKSB7CgoJCQkJdW5pZm9ybXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAsIHVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzc01hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXAgKSB7CgoJCQkJdW5pZm9ybXMuY2xlYXJjb2F0Tm9ybWFsTWFwLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXAsIHVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybSApOwoKCQkJCXVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbFNjYWxlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbFNjYWxlICk7CgoJCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHsKCgkJCQkJdW5pZm9ybXMuY2xlYXJjb2F0Tm9ybWFsU2NhbGUudmFsdWUubmVnYXRlKCk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWlmICggbWF0ZXJpYWwuaXJpZGVzY2VuY2UgPiAwICkgewoKCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2UudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZTsKCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2VJT1IudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZUlPUjsKCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtLnZhbHVlID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZVsgMCBdOwoJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW0udmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlWyAxIF07CgoJCQlpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwICkgewoKCQkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlTWFwLnZhbHVlID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2VNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwLCB1bmlmb3Jtcy5pcmlkZXNjZW5jZU1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCApIHsKCgkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCwgdW5pZm9ybXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJfQoKCQlpZiAoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA+IDAgKSB7CgoJCQl1bmlmb3Jtcy50cmFuc21pc3Npb24udmFsdWUgPSBtYXRlcmlhbC50cmFuc21pc3Npb247CgkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvblNhbXBsZXJNYXAudmFsdWUgPSB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQudGV4dHVyZTsKCQkJdW5pZm9ybXMudHJhbnNtaXNzaW9uU2FtcGxlclNpemUudmFsdWUuc2V0KCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQud2lkdGgsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCWlmICggbWF0ZXJpYWwudHJhbnNtaXNzaW9uTWFwICkgewoKCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvbk1hcC52YWx1ZSA9IG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwudHJhbnNtaXNzaW9uTWFwLCB1bmlmb3Jtcy50cmFuc21pc3Npb25NYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCXVuaWZvcm1zLnRoaWNrbmVzcy52YWx1ZSA9IG1hdGVyaWFsLnRoaWNrbmVzczsKCgkJCWlmICggbWF0ZXJpYWwudGhpY2tuZXNzTWFwICkgewoKCQkJCXVuaWZvcm1zLnRoaWNrbmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLnRoaWNrbmVzc01hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwudGhpY2tuZXNzTWFwLCB1bmlmb3Jtcy50aGlja25lc3NNYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCXVuaWZvcm1zLmF0dGVudWF0aW9uRGlzdGFuY2UudmFsdWUgPSBtYXRlcmlhbC5hdHRlbnVhdGlvbkRpc3RhbmNlOwoJCQl1bmlmb3Jtcy5hdHRlbnVhdGlvbkNvbG9yLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmF0dGVudWF0aW9uQ29sb3IgKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmFuaXNvdHJvcHkgPiAwICkgewoKCQkJdW5pZm9ybXMuYW5pc290cm9weVZlY3Rvci52YWx1ZS5zZXQoIG1hdGVyaWFsLmFuaXNvdHJvcHkgKiBNYXRoLmNvcyggbWF0ZXJpYWwuYW5pc290cm9weVJvdGF0aW9uICksIG1hdGVyaWFsLmFuaXNvdHJvcHkgKiBNYXRoLnNpbiggbWF0ZXJpYWwuYW5pc290cm9weVJvdGF0aW9uICkgKTsKCgkJCWlmICggbWF0ZXJpYWwuYW5pc290cm9weU1hcCApIHsKCgkJCQl1bmlmb3Jtcy5hbmlzb3Ryb3B5TWFwLnZhbHVlID0gbWF0ZXJpYWwuYW5pc290cm9weU1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYW5pc290cm9weU1hcCwgdW5pZm9ybXMuYW5pc290cm9weU1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQl9CgoJCXVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHk7CgkJdW5pZm9ybXMuc3BlY3VsYXJDb2xvci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICk7CgoJCWlmICggbWF0ZXJpYWwuc3BlY3VsYXJDb2xvck1hcCApIHsKCgkJCXVuaWZvcm1zLnNwZWN1bGFyQ29sb3JNYXAudmFsdWUgPSBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwOwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXAsIHVuaWZvcm1zLnNwZWN1bGFyQ29sb3JNYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwICkgewoKCQkJdW5pZm9ybXMuc3BlY3VsYXJJbnRlbnNpdHlNYXAudmFsdWUgPSBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eU1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eU1hcCwgdW5pZm9ybXMuc3BlY3VsYXJJbnRlbnNpdHlNYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCX0KCglmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNNYXRjYXAoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJaWYgKCBtYXRlcmlhbC5tYXRjYXAgKSB7CgoJCQl1bmlmb3Jtcy5tYXRjYXAudmFsdWUgPSBtYXRlcmlhbC5tYXRjYXA7CgoJCX0KCgl9CgoJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zRGlzdGFuY2UoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJY29uc3QgbGlnaHQgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKS5saWdodDsKCgkJdW5pZm9ybXMucmVmZXJlbmNlUG9zaXRpb24udmFsdWUuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCXVuaWZvcm1zLm5lYXJEaXN0YW5jZS52YWx1ZSA9IGxpZ2h0LnNoYWRvdy5jYW1lcmEubmVhcjsKCQl1bmlmb3Jtcy5mYXJEaXN0YW5jZS52YWx1ZSA9IGxpZ2h0LnNoYWRvdy5jYW1lcmEuZmFyOwoKCX0KCglyZXR1cm4gewoJCXJlZnJlc2hGb2dVbmlmb3JtczogcmVmcmVzaEZvZ1VuaWZvcm1zLAoJCXJlZnJlc2hNYXRlcmlhbFVuaWZvcm1zOiByZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcwoJfTsKCn0KCmZ1bmN0aW9uIFdlYkdMVW5pZm9ybXNHcm91cHMoIGdsLCBpbmZvLCBjYXBhYmlsaXRpZXMsIHN0YXRlICkgewoKCWxldCBidWZmZXJzID0ge307CglsZXQgdXBkYXRlTGlzdCA9IHt9OwoJbGV0IGFsbG9jYXRlZEJpbmRpbmdQb2ludHMgPSBbXTsKCgljb25zdCBtYXhCaW5kaW5nUG9pbnRzID0gKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgKSA/IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1VOSUZPUk1fQlVGRkVSX0JJTkRJTkdTICkgOiAwOyAvLyBiaW5kaW5nIHBvaW50cyBhcmUgZ2xvYmFsIHdoZXJlYXMgYmxvY2sgaW5kaWNlcyBhcmUgcGVyIHNoYWRlciBwcm9ncmFtCgoJZnVuY3Rpb24gYmluZCggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCgkJY29uc3Qgd2ViZ2xQcm9ncmFtID0gcHJvZ3JhbS5wcm9ncmFtOwoJCXN0YXRlLnVuaWZvcm1CbG9ja0JpbmRpbmcoIHVuaWZvcm1zR3JvdXAsIHdlYmdsUHJvZ3JhbSApOwoKCX0KCglmdW5jdGlvbiB1cGRhdGUoIHVuaWZvcm1zR3JvdXAsIHByb2dyYW0gKSB7CgoJCWxldCBidWZmZXIgPSBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF07CgoJCWlmICggYnVmZmVyID09PSB1bmRlZmluZWQgKSB7CgoJCQlwcmVwYXJlVW5pZm9ybXNHcm91cCggdW5pZm9ybXNHcm91cCApOwoKCQkJYnVmZmVyID0gY3JlYXRlQnVmZmVyKCB1bmlmb3Jtc0dyb3VwICk7CgkJCWJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXSA9IGJ1ZmZlcjsKCgkJCXVuaWZvcm1zR3JvdXAuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblVuaWZvcm1zR3JvdXBzRGlzcG9zZSApOwoKCQl9CgoJCS8vIGVuc3VyZSB0byB1cGRhdGUgdGhlIGJpbmRpbmcgcG9pbnRzL2Jsb2NrIGluZGljZXMgbWFwcGluZyBmb3IgdGhpcyBwcm9ncmFtCgoJCWNvbnN0IHdlYmdsUHJvZ3JhbSA9IHByb2dyYW0ucHJvZ3JhbTsKCQlzdGF0ZS51cGRhdGVVQk9NYXBwaW5nKCB1bmlmb3Jtc0dyb3VwLCB3ZWJnbFByb2dyYW0gKTsKCgkJLy8gdXBkYXRlIFVCTyBvbmNlIHBlciBmcmFtZQoKCQljb25zdCBmcmFtZSA9IGluZm8ucmVuZGVyLmZyYW1lOwoKCQlpZiAoIHVwZGF0ZUxpc3RbIHVuaWZvcm1zR3JvdXAuaWQgXSAhPT0gZnJhbWUgKSB7CgoJCQl1cGRhdGVCdWZmZXJEYXRhKCB1bmlmb3Jtc0dyb3VwICk7CgoJCQl1cGRhdGVMaXN0WyB1bmlmb3Jtc0dyb3VwLmlkIF0gPSBmcmFtZTsKCgkJfQoKCX0KCglmdW5jdGlvbiBjcmVhdGVCdWZmZXIoIHVuaWZvcm1zR3JvdXAgKSB7CgoJCS8vIHRoZSBzZXR1cCBvZiBhbiBVQk8gaXMgaW5kZXBlbmRlbnQgb2YgYSBwYXJ0aWN1bGFyIHNoYWRlciBwcm9ncmFtIGJ1dCBnbG9iYWwKCgkJY29uc3QgYmluZGluZ1BvaW50SW5kZXggPSBhbGxvY2F0ZUJpbmRpbmdQb2ludEluZGV4KCk7CgkJdW5pZm9ybXNHcm91cC5fX2JpbmRpbmdQb2ludEluZGV4ID0gYmluZGluZ1BvaW50SW5kZXg7CgoJCWNvbnN0IGJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpOwoJCWNvbnN0IHNpemUgPSB1bmlmb3Jtc0dyb3VwLl9fc2l6ZTsKCQljb25zdCB1c2FnZSA9IHVuaWZvcm1zR3JvdXAudXNhZ2U7CgoJCWdsLmJpbmRCdWZmZXIoIGdsLlVOSUZPUk1fQlVGRkVSLCBidWZmZXIgKTsKCQlnbC5idWZmZXJEYXRhKCBnbC5VTklGT1JNX0JVRkZFUiwgc2l6ZSwgdXNhZ2UgKTsKCQlnbC5iaW5kQnVmZmVyKCBnbC5VTklGT1JNX0JVRkZFUiwgbnVsbCApOwoJCWdsLmJpbmRCdWZmZXJCYXNlKCBnbC5VTklGT1JNX0JVRkZFUiwgYmluZGluZ1BvaW50SW5kZXgsIGJ1ZmZlciApOwoKCQlyZXR1cm4gYnVmZmVyOwoKCX0KCglmdW5jdGlvbiBhbGxvY2F0ZUJpbmRpbmdQb2ludEluZGV4KCkgewoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXhCaW5kaW5nUG9pbnRzOyBpICsrICkgewoKCQkJaWYgKCBhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzLmluZGV4T2YoIGkgKSA9PT0gLSAxICkgewoKCQkJCWFsbG9jYXRlZEJpbmRpbmdQb2ludHMucHVzaCggaSApOwoJCQkJcmV0dXJuIGk7CgoJCQl9CgoJCX0KCgkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IE1heGltdW0gbnVtYmVyIG9mIHNpbXVsdGFuZW91c2x5IHVzYWJsZSB1bmlmb3JtcyBncm91cHMgcmVhY2hlZC4nICk7CgoJCXJldHVybiAwOwoKCX0KCglmdW5jdGlvbiB1cGRhdGVCdWZmZXJEYXRhKCB1bmlmb3Jtc0dyb3VwICkgewoKCQljb25zdCBidWZmZXIgPSBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF07CgkJY29uc3QgdW5pZm9ybXMgPSB1bmlmb3Jtc0dyb3VwLnVuaWZvcm1zOwoJCWNvbnN0IGNhY2hlID0gdW5pZm9ybXNHcm91cC5fX2NhY2hlOwoKCQlnbC5iaW5kQnVmZmVyKCBnbC5VTklGT1JNX0JVRkZFUiwgYnVmZmVyICk7CgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSB1bmlmb3Jtcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCWNvbnN0IHVuaWZvcm1BcnJheSA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm1zWyBpIF0gKSA/IHVuaWZvcm1zWyBpIF0gOiBbIHVuaWZvcm1zWyBpIF0gXTsKCgkJCWZvciAoIGxldCBqID0gMCwgamwgPSB1bmlmb3JtQXJyYXkubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJY29uc3QgdW5pZm9ybSA9IHVuaWZvcm1BcnJheVsgaiBdOwoKCQkJCWlmICggaGFzVW5pZm9ybUNoYW5nZWQoIHVuaWZvcm0sIGksIGosIGNhY2hlICkgPT09IHRydWUgKSB7CgoJCQkJCWNvbnN0IG9mZnNldCA9IHVuaWZvcm0uX19vZmZzZXQ7CgoJCQkJCWNvbnN0IHZhbHVlcyA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm0udmFsdWUgKSA/IHVuaWZvcm0udmFsdWUgOiBbIHVuaWZvcm0udmFsdWUgXTsKCgkJCQkJbGV0IGFycmF5T2Zmc2V0ID0gMDsKCgkJCQkJZm9yICggbGV0IGsgPSAwOyBrIDwgdmFsdWVzLmxlbmd0aDsgayArKyApIHsKCgkJCQkJCWNvbnN0IHZhbHVlID0gdmFsdWVzWyBrIF07CgoJCQkJCQljb25zdCBpbmZvID0gZ2V0VW5pZm9ybVNpemUoIHZhbHVlICk7CgoJCQkJCQkvLyBUT0RPIGFkZCBpbnRlZ2VyIGFuZCBzdHJ1Y3Qgc3VwcG9ydAoJCQkJCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgKSB7CgoJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDAgXSA9IHZhbHVlOwoJCQkJCQkJZ2wuYnVmZmVyU3ViRGF0YSggZ2wuVU5JRk9STV9CVUZGRVIsIG9mZnNldCArIGFycmF5T2Zmc2V0LCB1bmlmb3JtLl9fZGF0YSApOwoKCQkJCQkJfSBlbHNlIGlmICggdmFsdWUuaXNNYXRyaXgzICkgewoKCQkJCQkJCS8vIG1hbnVhbGx5IGNvbnZlcnRpbmcgM3gzIHRvIDN4NAoKCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAwIF0gPSB2YWx1ZS5lbGVtZW50c1sgMCBdOwoJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDEgXSA9IHZhbHVlLmVsZW1lbnRzWyAxIF07CgkJCQkJCQl1bmlmb3JtLl9fZGF0YVsgMiBdID0gdmFsdWUuZWxlbWVudHNbIDIgXTsKCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAzIF0gPSAwOwoJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDQgXSA9IHZhbHVlLmVsZW1lbnRzWyAzIF07CgkJCQkJCQl1bmlmb3JtLl9fZGF0YVsgNSBdID0gdmFsdWUuZWxlbWVudHNbIDQgXTsKCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA2IF0gPSB2YWx1ZS5lbGVtZW50c1sgNSBdOwoJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDcgXSA9IDA7CgkJCQkJCQl1bmlmb3JtLl9fZGF0YVsgOCBdID0gdmFsdWUuZWxlbWVudHNbIDYgXTsKCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA5IF0gPSB2YWx1ZS5lbGVtZW50c1sgNyBdOwoJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDEwIF0gPSB2YWx1ZS5lbGVtZW50c1sgOCBdOwoJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDExIF0gPSAwOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQl2YWx1ZS50b0FycmF5KCB1bmlmb3JtLl9fZGF0YSwgYXJyYXlPZmZzZXQgKTsKCgkJCQkJCQlhcnJheU9mZnNldCArPSBpbmZvLnN0b3JhZ2UgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJZ2wuYnVmZmVyU3ViRGF0YSggZ2wuVU5JRk9STV9CVUZGRVIsIG9mZnNldCwgdW5pZm9ybS5fX2RhdGEgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwgKTsKCgl9CgoJZnVuY3Rpb24gaGFzVW5pZm9ybUNoYW5nZWQoIHVuaWZvcm0sIGluZGV4LCBpbmRleEFycmF5LCBjYWNoZSApIHsKCgkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoJCWNvbnN0IGluZGV4U3RyaW5nID0gaW5kZXggKyAnXycgKyBpbmRleEFycmF5OwoKCQlpZiAoIGNhY2hlWyBpbmRleFN0cmluZyBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkvLyBjYWNoZSBlbnRyeSBkb2VzIG5vdCBleGlzdCBzbyBmYXIKCgkJCWlmICggdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJyApIHsKCgkJCQljYWNoZVsgaW5kZXhTdHJpbmcgXSA9IHZhbHVlOwoKCQkJfSBlbHNlIHsKCgkJCQljYWNoZVsgaW5kZXhTdHJpbmcgXSA9IHZhbHVlLmNsb25lKCk7CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfSBlbHNlIHsKCgkJCWNvbnN0IGNhY2hlZE9iamVjdCA9IGNhY2hlWyBpbmRleFN0cmluZyBdOwoKCQkJLy8gY29tcGFyZSBjdXJyZW50IHZhbHVlIHdpdGggY2FjaGVkIGVudHJ5CgoJCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgKSB7CgoJCQkJaWYgKCBjYWNoZWRPYmplY3QgIT09IHZhbHVlICkgewoKCQkJCQljYWNoZVsgaW5kZXhTdHJpbmcgXSA9IHZhbHVlOwoJCQkJCXJldHVybiB0cnVlOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJaWYgKCBjYWNoZWRPYmplY3QuZXF1YWxzKCB2YWx1ZSApID09PSBmYWxzZSApIHsKCgkJCQkJY2FjaGVkT2JqZWN0LmNvcHkoIHZhbHVlICk7CgkJCQkJcmV0dXJuIHRydWU7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXJldHVybiBmYWxzZTsKCgl9CgoJZnVuY3Rpb24gcHJlcGFyZVVuaWZvcm1zR3JvdXAoIHVuaWZvcm1zR3JvdXAgKSB7CgoJCS8vIGRldGVybWluZSB0b3RhbCBidWZmZXIgc2l6ZSBhY2NvcmRpbmcgdG8gdGhlIFNURDE0MCBsYXlvdXQKCQkvLyBIaW50OiBTVEQxNDAgaXMgdGhlIG9ubHkgc3VwcG9ydGVkIGxheW91dCBpbiBXZWJHTCAyCgoJCWNvbnN0IHVuaWZvcm1zID0gdW5pZm9ybXNHcm91cC51bmlmb3JtczsKCgkJbGV0IG9mZnNldCA9IDA7IC8vIGdsb2JhbCBidWZmZXIgb2Zmc2V0IGluIGJ5dGVzCgkJY29uc3QgY2h1bmtTaXplID0gMTY7IC8vIHNpemUgb2YgYSBjaHVuayBpbiBieXRlcwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB1bmlmb3Jtcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgdW5pZm9ybUFycmF5ID0gQXJyYXkuaXNBcnJheSggdW5pZm9ybXNbIGkgXSApID8gdW5pZm9ybXNbIGkgXSA6IFsgdW5pZm9ybXNbIGkgXSBdOwoKCQkJZm9yICggbGV0IGogPSAwLCBqbCA9IHVuaWZvcm1BcnJheS5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQljb25zdCB1bmlmb3JtID0gdW5pZm9ybUFycmF5WyBqIF07CgoJCQkJY29uc3QgdmFsdWVzID0gQXJyYXkuaXNBcnJheSggdW5pZm9ybS52YWx1ZSApID8gdW5pZm9ybS52YWx1ZSA6IFsgdW5pZm9ybS52YWx1ZSBdOwoKCQkJCWZvciAoIGxldCBrID0gMCwga2wgPSB2YWx1ZXMubGVuZ3RoOyBrIDwga2w7IGsgKysgKSB7CgoJCQkJCWNvbnN0IHZhbHVlID0gdmFsdWVzWyBrIF07CgoJCQkJCWNvbnN0IGluZm8gPSBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKTsKCgkJCQkJLy8gQ2FsY3VsYXRlIHRoZSBjaHVuayBvZmZzZXQKCQkJCQljb25zdCBjaHVua09mZnNldFVuaWZvcm0gPSBvZmZzZXQgJSBjaHVua1NpemU7CgoJCQkJCS8vIENoZWNrIGZvciBjaHVuayBvdmVyZmxvdwoJCQkJCWlmICggY2h1bmtPZmZzZXRVbmlmb3JtICE9PSAwICYmICggY2h1bmtTaXplIC0gY2h1bmtPZmZzZXRVbmlmb3JtICkgPCBpbmZvLmJvdW5kYXJ5ICkgewoKCQkJCQkJLy8gQWRkIHBhZGRpbmcgYW5kIGFkanVzdCBvZmZzZXQKCQkJCQkJb2Zmc2V0ICs9ICggY2h1bmtTaXplIC0gY2h1bmtPZmZzZXRVbmlmb3JtICk7CgoJCQkJCX0KCgkJCQkJLy8gdGhlIGZvbGxvd2luZyB0d28gcHJvcGVydGllcyB3aWxsIGJlIHVzZWQgZm9yIHBhcnRpYWwgYnVmZmVyIHVwZGF0ZXMKCgkJCQkJdW5pZm9ybS5fX2RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KCBpbmZvLnN0b3JhZ2UgLyBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKTsKCQkJCQl1bmlmb3JtLl9fb2Zmc2V0ID0gb2Zmc2V0OwoKCgkJCQkJLy8gVXBkYXRlIHRoZSBnbG9iYWwgb2Zmc2V0CgkJCQkJb2Zmc2V0ICs9IGluZm8uc3RvcmFnZTsKCgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8vIGVuc3VyZSBjb3JyZWN0IGZpbmFsIHBhZGRpbmcKCgkJY29uc3QgY2h1bmtPZmZzZXQgPSBvZmZzZXQgJSBjaHVua1NpemU7CgoJCWlmICggY2h1bmtPZmZzZXQgPiAwICkgb2Zmc2V0ICs9ICggY2h1bmtTaXplIC0gY2h1bmtPZmZzZXQgKTsKCgkJLy8KCgkJdW5pZm9ybXNHcm91cC5fX3NpemUgPSBvZmZzZXQ7CgkJdW5pZm9ybXNHcm91cC5fX2NhY2hlID0ge307CgoJCXJldHVybiB0aGlzOwoKCX0KCglmdW5jdGlvbiBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKSB7CgoJCWNvbnN0IGluZm8gPSB7CgkJCWJvdW5kYXJ5OiAwLCAvLyBieXRlcwoJCQlzdG9yYWdlOiAwIC8vIGJ5dGVzCgkJfTsKCgkJLy8gZGV0ZXJtaW5lIHNpemVzIGFjY29yZGluZyB0byBTVEQxNDAKCgkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKCQkJLy8gZmxvYXQvaW50L2Jvb2wKCgkJCWluZm8uYm91bmRhcnkgPSA0OwoJCQlpbmZvLnN0b3JhZ2UgPSA0OwoKCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc1ZlY3RvcjIgKSB7CgoJCQkvLyB2ZWMyCgoJCQlpbmZvLmJvdW5kYXJ5ID0gODsKCQkJaW5mby5zdG9yYWdlID0gODsKCgkJfSBlbHNlIGlmICggdmFsdWUuaXNWZWN0b3IzIHx8IHZhbHVlLmlzQ29sb3IgKSB7CgoJCQkvLyB2ZWMzCgoJCQlpbmZvLmJvdW5kYXJ5ID0gMTY7CgkJCWluZm8uc3RvcmFnZSA9IDEyOyAvLyBldmlsOiB2ZWMzIG11c3Qgc3RhcnQgb24gYSAxNi1ieXRlIGJvdW5kYXJ5IGJ1dCBpdCBvbmx5IGNvbnN1bWVzIDEyIGJ5dGVzCgoJCX0gZWxzZSBpZiAoIHZhbHVlLmlzVmVjdG9yNCApIHsKCgkJCS8vIHZlYzQKCgkJCWluZm8uYm91bmRhcnkgPSAxNjsKCQkJaW5mby5zdG9yYWdlID0gMTY7CgoJCX0gZWxzZSBpZiAoIHZhbHVlLmlzTWF0cml4MyApIHsKCgkJCS8vIG1hdDMgKGluIFNURDE0MCBhIDN4MyBtYXRyaXggaXMgcmVwcmVzZW50ZWQgYXMgM3g0KQoKCQkJaW5mby5ib3VuZGFyeSA9IDQ4OwoJCQlpbmZvLnN0b3JhZ2UgPSA0ODsKCgkJfSBlbHNlIGlmICggdmFsdWUuaXNNYXRyaXg0ICkgewoKCQkJLy8gbWF0NAoKCQkJaW5mby5ib3VuZGFyeSA9IDY0OwoJCQlpbmZvLnN0b3JhZ2UgPSA2NDsKCgkJfSBlbHNlIGlmICggdmFsdWUuaXNUZXh0dXJlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBzYW1wbGVycyBjYW4gbm90IGJlIHBhcnQgb2YgYW4gdW5pZm9ybXMgZ3JvdXAuJyApOwoKCQl9IGVsc2UgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVW5zdXBwb3J0ZWQgdW5pZm9ybSB2YWx1ZSB0eXBlLicsIHZhbHVlICk7CgoJCX0KCgkJcmV0dXJuIGluZm87CgoJfQoKCWZ1bmN0aW9uIG9uVW5pZm9ybXNHcm91cHNEaXNwb3NlKCBldmVudCApIHsKCgkJY29uc3QgdW5pZm9ybXNHcm91cCA9IGV2ZW50LnRhcmdldDsKCgkJdW5pZm9ybXNHcm91cC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVW5pZm9ybXNHcm91cHNEaXNwb3NlICk7CgoJCWNvbnN0IGluZGV4ID0gYWxsb2NhdGVkQmluZGluZ1BvaW50cy5pbmRleE9mKCB1bmlmb3Jtc0dyb3VwLl9fYmluZGluZ1BvaW50SW5kZXggKTsKCQlhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzLnNwbGljZSggaW5kZXgsIDEgKTsKCgkJZ2wuZGVsZXRlQnVmZmVyKCBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF0gKTsKCgkJZGVsZXRlIGJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXTsKCQlkZWxldGUgdXBkYXRlTGlzdFsgdW5pZm9ybXNHcm91cC5pZCBdOwoKCX0KCglmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQlmb3IgKCBjb25zdCBpZCBpbiBidWZmZXJzICkgewoKCQkJZ2wuZGVsZXRlQnVmZmVyKCBidWZmZXJzWyBpZCBdICk7CgoJCX0KCgkJYWxsb2NhdGVkQmluZGluZ1BvaW50cyA9IFtdOwoJCWJ1ZmZlcnMgPSB7fTsKCQl1cGRhdGVMaXN0ID0ge307CgoJfQoKCXJldHVybiB7CgoJCWJpbmQ6IGJpbmQsCgkJdXBkYXRlOiB1cGRhdGUsCgoJCWRpc3Bvc2U6IGRpc3Bvc2UKCgl9OwoKfQoKY2xhc3MgV2ViR0xSZW5kZXJlciB7CgoJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgPSB7fSApIHsKCgkJY29uc3QgewoJCQljYW52YXMgPSBjcmVhdGVDYW52YXNFbGVtZW50KCksCgkJCWNvbnRleHQgPSBudWxsLAoJCQlkZXB0aCA9IHRydWUsCgkJCXN0ZW5jaWwgPSB0cnVlLAoJCQlhbHBoYSA9IGZhbHNlLAoJCQlhbnRpYWxpYXMgPSBmYWxzZSwKCQkJcHJlbXVsdGlwbGllZEFscGhhID0gdHJ1ZSwKCQkJcHJlc2VydmVEcmF3aW5nQnVmZmVyID0gZmFsc2UsCgkJCXBvd2VyUHJlZmVyZW5jZSA9ICdkZWZhdWx0JywKCQkJZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCA9IGZhbHNlLAoJCX0gPSBwYXJhbWV0ZXJzOwoKCQl0aGlzLmlzV2ViR0xSZW5kZXJlciA9IHRydWU7CgoJCWxldCBfYWxwaGE7CgoJCWlmICggY29udGV4dCAhPT0gbnVsbCApIHsKCgkJCV9hbHBoYSA9IGNvbnRleHQuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKS5hbHBoYTsKCgkJfSBlbHNlIHsKCgkJCV9hbHBoYSA9IGFscGhhOwoKCQl9CgoJCWNvbnN0IHVpbnRDbGVhckNvbG9yID0gbmV3IFVpbnQzMkFycmF5KCA0ICk7CgkJY29uc3QgaW50Q2xlYXJDb2xvciA9IG5ldyBJbnQzMkFycmF5KCA0ICk7CgoJCWxldCBjdXJyZW50UmVuZGVyTGlzdCA9IG51bGw7CgkJbGV0IGN1cnJlbnRSZW5kZXJTdGF0ZSA9IG51bGw7CgoJCS8vIHJlbmRlcigpIGNhbiBiZSBjYWxsZWQgZnJvbSB3aXRoaW4gYSBjYWxsYmFjayB0cmlnZ2VyZWQgYnkgYW5vdGhlciByZW5kZXIuCgkJLy8gV2UgdHJhY2sgdGhpcyBzbyB0aGF0IHRoZSBuZXN0ZWQgcmVuZGVyIGNhbGwgZ2V0cyBpdHMgbGlzdCBhbmQgc3RhdGUgaXNvbGF0ZWQgZnJvbSB0aGUgcGFyZW50IHJlbmRlciBjYWxsLgoKCQljb25zdCByZW5kZXJMaXN0U3RhY2sgPSBbXTsKCQljb25zdCByZW5kZXJTdGF0ZVN0YWNrID0gW107CgoJCS8vIHB1YmxpYyBwcm9wZXJ0aWVzCgoJCXRoaXMuZG9tRWxlbWVudCA9IGNhbnZhczsKCgkJLy8gRGVidWcgY29uZmlndXJhdGlvbiBjb250YWluZXIKCQl0aGlzLmRlYnVnID0gewoKCQkJLyoqCgkJCSAqIEVuYWJsZXMgZXJyb3IgY2hlY2tpbmcgYW5kIHJlcG9ydGluZyB3aGVuIHNoYWRlciBwcm9ncmFtcyBhcmUgYmVpbmcgY29tcGlsZWQKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqLwoJCQljaGVja1NoYWRlckVycm9yczogdHJ1ZSwKCQkJLyoqCgkJCSAqIENhbGxiYWNrIGZvciBjdXN0b20gZXJyb3IgcmVwb3J0aW5nLgoJCQkgKiBAdHlwZSB7P0Z1bmN0aW9ufQoJCQkgKi8KCQkJb25TaGFkZXJFcnJvcjogbnVsbAoJCX07CgoJCS8vIGNsZWFyaW5nCgoJCXRoaXMuYXV0b0NsZWFyID0gdHJ1ZTsKCQl0aGlzLmF1dG9DbGVhckNvbG9yID0gdHJ1ZTsKCQl0aGlzLmF1dG9DbGVhckRlcHRoID0gdHJ1ZTsKCQl0aGlzLmF1dG9DbGVhclN0ZW5jaWwgPSB0cnVlOwoKCQkvLyBzY2VuZSBncmFwaAoKCQl0aGlzLnNvcnRPYmplY3RzID0gdHJ1ZTsKCgkJLy8gdXNlci1kZWZpbmVkIGNsaXBwaW5nCgoJCXRoaXMuY2xpcHBpbmdQbGFuZXMgPSBbXTsKCQl0aGlzLmxvY2FsQ2xpcHBpbmdFbmFibGVkID0gZmFsc2U7CgoJCS8vIHBoeXNpY2FsbHkgYmFzZWQgc2hhZGluZwoKCQl0aGlzLl9vdXRwdXRDb2xvclNwYWNlID0gU1JHQkNvbG9yU3BhY2U7CgoJCS8vIHBoeXNpY2FsIGxpZ2h0cwoKCQl0aGlzLl91c2VMZWdhY3lMaWdodHMgPSBmYWxzZTsKCgkJLy8gdG9uZSBtYXBwaW5nCgoJCXRoaXMudG9uZU1hcHBpbmcgPSBOb1RvbmVNYXBwaW5nOwoJCXRoaXMudG9uZU1hcHBpbmdFeHBvc3VyZSA9IDEuMDsKCgkJLy8gaW50ZXJuYWwgcHJvcGVydGllcwoKCQljb25zdCBfdGhpcyA9IHRoaXM7CgoJCWxldCBfaXNDb250ZXh0TG9zdCA9IGZhbHNlOwoKCQkvLyBpbnRlcm5hbCBzdGF0ZSBjYWNoZQoKCQlsZXQgX2N1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IDA7CgkJbGV0IF9jdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwoJCWxldCBfY3VycmVudFJlbmRlclRhcmdldCA9IG51bGw7CgkJbGV0IF9jdXJyZW50TWF0ZXJpYWxJZCA9IC0gMTsKCgkJbGV0IF9jdXJyZW50Q2FtZXJhID0gbnVsbDsKCgkJY29uc3QgX2N1cnJlbnRWaWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CgkJY29uc3QgX2N1cnJlbnRTY2lzc29yID0gbmV3IFZlY3RvcjQoKTsKCQlsZXQgX2N1cnJlbnRTY2lzc29yVGVzdCA9IG51bGw7CgoJCWNvbnN0IF9jdXJyZW50Q2xlYXJDb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQlsZXQgX2N1cnJlbnRDbGVhckFscGhhID0gMDsKCgkJLy8KCgkJbGV0IF93aWR0aCA9IGNhbnZhcy53aWR0aDsKCQlsZXQgX2hlaWdodCA9IGNhbnZhcy5oZWlnaHQ7CgoJCWxldCBfcGl4ZWxSYXRpbyA9IDE7CgkJbGV0IF9vcGFxdWVTb3J0ID0gbnVsbDsKCQlsZXQgX3RyYW5zcGFyZW50U29ydCA9IG51bGw7CgoJCWNvbnN0IF92aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCAwLCAwLCBfd2lkdGgsIF9oZWlnaHQgKTsKCQljb25zdCBfc2Npc3NvciA9IG5ldyBWZWN0b3I0KCAwLCAwLCBfd2lkdGgsIF9oZWlnaHQgKTsKCQlsZXQgX3NjaXNzb3JUZXN0ID0gZmFsc2U7CgoJCS8vIGZydXN0dW0KCgkJY29uc3QgX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwoKCQkvLyBjbGlwcGluZwoKCQlsZXQgX2NsaXBwaW5nRW5hYmxlZCA9IGZhbHNlOwoJCWxldCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBmYWxzZTsKCgkJLy8gdHJhbnNtaXNzaW9uCgoJCWxldCBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJLy8gY2FtZXJhIG1hdHJpY2VzIGNhY2hlCgoJCWNvbnN0IF9wcm9qU2NyZWVuTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCgkJY29uc3QgX3ZlY3RvcjIgPSBuZXcgVmVjdG9yMigpOwoJCWNvbnN0IF92ZWN0b3IzID0gbmV3IFZlY3RvcjMoKTsKCgkJY29uc3QgX2VtcHR5U2NlbmUgPSB7IGJhY2tncm91bmQ6IG51bGwsIGZvZzogbnVsbCwgZW52aXJvbm1lbnQ6IG51bGwsIG92ZXJyaWRlTWF0ZXJpYWw6IG51bGwsIGlzU2NlbmU6IHRydWUgfTsKCgkJZnVuY3Rpb24gZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpIHsKCgkJCXJldHVybiBfY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCA/IF9waXhlbFJhdGlvIDogMTsKCgkJfQoKCQkvLyBpbml0aWFsaXplCgoJCWxldCBfZ2wgPSBjb250ZXh0OwoKCQlmdW5jdGlvbiBnZXRDb250ZXh0KCBjb250ZXh0TmFtZXMsIGNvbnRleHRBdHRyaWJ1dGVzICkgewoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY29udGV4dE5hbWVzLmxlbmd0aDsgaSArKyApIHsKCgkJCQljb25zdCBjb250ZXh0TmFtZSA9IGNvbnRleHROYW1lc1sgaSBdOwoJCQkJY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCBjb250ZXh0TmFtZSwgY29udGV4dEF0dHJpYnV0ZXMgKTsKCQkJCWlmICggY29udGV4dCAhPT0gbnVsbCApIHJldHVybiBjb250ZXh0OwoKCQkJfQoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJdHJ5IHsKCgkJCWNvbnN0IGNvbnRleHRBdHRyaWJ1dGVzID0gewoJCQkJYWxwaGE6IHRydWUsCgkJCQlkZXB0aCwKCQkJCXN0ZW5jaWwsCgkJCQlhbnRpYWxpYXMsCgkJCQlwcmVtdWx0aXBsaWVkQWxwaGEsCgkJCQlwcmVzZXJ2ZURyYXdpbmdCdWZmZXIsCgkJCQlwb3dlclByZWZlcmVuY2UsCgkJCQlmYWlsSWZNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0LAoJCQl9OwoKCQkJLy8gT2Zmc2NyZWVuQ2FudmFzIGRvZXMgbm90IGhhdmUgc2V0QXR0cmlidXRlLCBzZWUgIzIyODExCgkJCWlmICggJ3NldEF0dHJpYnV0ZScgaW4gY2FudmFzICkgY2FudmFzLnNldEF0dHJpYnV0ZSggJ2RhdGEtZW5naW5lJywgYHRocmVlLmpzIHIke1JFVklTSU9OfWAgKTsKCgkJCS8vIGV2ZW50IGxpc3RlbmVycyBtdXN0IGJlIHJlZ2lzdGVyZWQgYmVmb3JlIFdlYkdMIGNvbnRleHQgaXMgY3JlYXRlZCwgc2VlICMxMjc1MwoJCQljYW52YXMuYWRkRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dGxvc3QnLCBvbkNvbnRleHRMb3N0LCBmYWxzZSApOwoJCQljYW52YXMuYWRkRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dHJlc3RvcmVkJywgb25Db250ZXh0UmVzdG9yZSwgZmFsc2UgKTsKCQkJY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRjcmVhdGlvbmVycm9yJywgb25Db250ZXh0Q3JlYXRpb25FcnJvciwgZmFsc2UgKTsKCgkJCWlmICggX2dsID09PSBudWxsICkgewoKCQkJCWNvbnN0IGNvbnRleHROYW1lcyA9IFsgJ3dlYmdsMicsICd3ZWJnbCcsICdleHBlcmltZW50YWwtd2ViZ2wnIF07CgoJCQkJaWYgKCBfdGhpcy5pc1dlYkdMMVJlbmRlcmVyID09PSB0cnVlICkgewoKCQkJCQljb250ZXh0TmFtZXMuc2hpZnQoKTsKCgkJCQl9CgoJCQkJX2dsID0gZ2V0Q29udGV4dCggY29udGV4dE5hbWVzLCBjb250ZXh0QXR0cmlidXRlcyApOwoKCQkJCWlmICggX2dsID09PSBudWxsICkgewoKCQkJCQlpZiAoIGdldENvbnRleHQoIGNvbnRleHROYW1lcyApICkgewoKCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnRXJyb3IgY3JlYXRpbmcgV2ViR0wgY29udGV4dCB3aXRoIHlvdXIgc2VsZWN0ZWQgYXR0cmlidXRlcy4nICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdFcnJvciBjcmVhdGluZyBXZWJHTCBjb250ZXh0LicgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWlmICggdHlwZW9mIFdlYkdMUmVuZGVyaW5nQ29udGV4dCAhPT0gJ3VuZGVmaW5lZCcgJiYgX2dsIGluc3RhbmNlb2YgV2ViR0xSZW5kZXJpbmdDb250ZXh0ICkgeyAvLyBAZGVwcmVjYXRlZCwgcjE1MwoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFdlYkdMIDEgc3VwcG9ydCB3YXMgZGVwcmVjYXRlZCBpbiByMTUzIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gcjE2My4nICk7CgoJCQl9CgoJCQkvLyBTb21lIGV4cGVyaW1lbnRhbC13ZWJnbCBpbXBsZW1lbnRhdGlvbnMgZG8gbm90IGhhdmUgZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0CgoJCQlpZiAoIF9nbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlfZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoKCQkJCQlyZXR1cm4geyAncmFuZ2VNaW4nOiAxLCAncmFuZ2VNYXgnOiAxLCAncHJlY2lzaW9uJzogMSB9OwoKCQkJCX07CgoJCQl9CgoJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAnICsgZXJyb3IubWVzc2FnZSApOwoJCQl0aHJvdyBlcnJvcjsKCgkJfQoKCQlsZXQgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzLCBzdGF0ZSwgaW5mbzsKCQlsZXQgcHJvcGVydGllcywgdGV4dHVyZXMsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBhdHRyaWJ1dGVzLCBnZW9tZXRyaWVzLCBvYmplY3RzOwoJCWxldCBwcm9ncmFtQ2FjaGUsIG1hdGVyaWFscywgcmVuZGVyTGlzdHMsIHJlbmRlclN0YXRlcywgY2xpcHBpbmcsIHNoYWRvd01hcDsKCgkJbGV0IGJhY2tncm91bmQsIG1vcnBodGFyZ2V0cywgYnVmZmVyUmVuZGVyZXIsIGluZGV4ZWRCdWZmZXJSZW5kZXJlcjsKCgkJbGV0IHV0aWxzLCBiaW5kaW5nU3RhdGVzLCB1bmlmb3Jtc0dyb3VwczsKCgkJZnVuY3Rpb24gaW5pdEdMQ29udGV4dCgpIHsKCgkJCWV4dGVuc2lvbnMgPSBuZXcgV2ViR0xFeHRlbnNpb25zKCBfZ2wgKTsKCgkJCWNhcGFiaWxpdGllcyA9IG5ldyBXZWJHTENhcGFiaWxpdGllcyggX2dsLCBleHRlbnNpb25zLCBwYXJhbWV0ZXJzICk7CgoJCQlleHRlbnNpb25zLmluaXQoIGNhcGFiaWxpdGllcyApOwoKCQkJdXRpbHMgPSBuZXcgV2ViR0xVdGlscyggX2dsLCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMgKTsKCgkJCXN0YXRlID0gbmV3IFdlYkdMU3RhdGUoIF9nbCwgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzICk7CgoJCQlpbmZvID0gbmV3IFdlYkdMSW5mbyggX2dsICk7CgkJCXByb3BlcnRpZXMgPSBuZXcgV2ViR0xQcm9wZXJ0aWVzKCk7CgkJCXRleHR1cmVzID0gbmV3IFdlYkdMVGV4dHVyZXMoIF9nbCwgZXh0ZW5zaW9ucywgc3RhdGUsIHByb3BlcnRpZXMsIGNhcGFiaWxpdGllcywgdXRpbHMsIGluZm8gKTsKCQkJY3ViZW1hcHMgPSBuZXcgV2ViR0xDdWJlTWFwcyggX3RoaXMgKTsKCQkJY3ViZXV2bWFwcyA9IG5ldyBXZWJHTEN1YmVVVk1hcHMoIF90aGlzICk7CgkJCWF0dHJpYnV0ZXMgPSBuZXcgV2ViR0xBdHRyaWJ1dGVzKCBfZ2wsIGNhcGFiaWxpdGllcyApOwoJCQliaW5kaW5nU3RhdGVzID0gbmV3IFdlYkdMQmluZGluZ1N0YXRlcyggX2dsLCBleHRlbnNpb25zLCBhdHRyaWJ1dGVzLCBjYXBhYmlsaXRpZXMgKTsKCQkJZ2VvbWV0cmllcyA9IG5ldyBXZWJHTEdlb21ldHJpZXMoIF9nbCwgYXR0cmlidXRlcywgaW5mbywgYmluZGluZ1N0YXRlcyApOwoJCQlvYmplY3RzID0gbmV3IFdlYkdMT2JqZWN0cyggX2dsLCBnZW9tZXRyaWVzLCBhdHRyaWJ1dGVzLCBpbmZvICk7CgkJCW1vcnBodGFyZ2V0cyA9IG5ldyBXZWJHTE1vcnBodGFyZ2V0cyggX2dsLCBjYXBhYmlsaXRpZXMsIHRleHR1cmVzICk7CgkJCWNsaXBwaW5nID0gbmV3IFdlYkdMQ2xpcHBpbmcoIHByb3BlcnRpZXMgKTsKCQkJcHJvZ3JhbUNhY2hlID0gbmV3IFdlYkdMUHJvZ3JhbXMoIF90aGlzLCBjdWJlbWFwcywgY3ViZXV2bWFwcywgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzLCBiaW5kaW5nU3RhdGVzLCBjbGlwcGluZyApOwoJCQltYXRlcmlhbHMgPSBuZXcgV2ViR0xNYXRlcmlhbHMoIF90aGlzLCBwcm9wZXJ0aWVzICk7CgkJCXJlbmRlckxpc3RzID0gbmV3IFdlYkdMUmVuZGVyTGlzdHMoKTsKCQkJcmVuZGVyU3RhdGVzID0gbmV3IFdlYkdMUmVuZGVyU3RhdGVzKCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMgKTsKCQkJYmFja2dyb3VuZCA9IG5ldyBXZWJHTEJhY2tncm91bmQoIF90aGlzLCBjdWJlbWFwcywgY3ViZXV2bWFwcywgc3RhdGUsIG9iamVjdHMsIF9hbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICk7CgkJCXNoYWRvd01hcCA9IG5ldyBXZWJHTFNoYWRvd01hcCggX3RoaXMsIG9iamVjdHMsIGNhcGFiaWxpdGllcyApOwoJCQl1bmlmb3Jtc0dyb3VwcyA9IG5ldyBXZWJHTFVuaWZvcm1zR3JvdXBzKCBfZ2wsIGluZm8sIGNhcGFiaWxpdGllcywgc3RhdGUgKTsKCgkJCWJ1ZmZlclJlbmRlcmVyID0gbmV3IFdlYkdMQnVmZmVyUmVuZGVyZXIoIF9nbCwgZXh0ZW5zaW9ucywgaW5mbywgY2FwYWJpbGl0aWVzICk7CgkJCWluZGV4ZWRCdWZmZXJSZW5kZXJlciA9IG5ldyBXZWJHTEluZGV4ZWRCdWZmZXJSZW5kZXJlciggX2dsLCBleHRlbnNpb25zLCBpbmZvLCBjYXBhYmlsaXRpZXMgKTsKCgkJCWluZm8ucHJvZ3JhbXMgPSBwcm9ncmFtQ2FjaGUucHJvZ3JhbXM7CgoJCQlfdGhpcy5jYXBhYmlsaXRpZXMgPSBjYXBhYmlsaXRpZXM7CgkJCV90aGlzLmV4dGVuc2lvbnMgPSBleHRlbnNpb25zOwoJCQlfdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKCQkJX3RoaXMucmVuZGVyTGlzdHMgPSByZW5kZXJMaXN0czsKCQkJX3RoaXMuc2hhZG93TWFwID0gc2hhZG93TWFwOwoJCQlfdGhpcy5zdGF0ZSA9IHN0YXRlOwoJCQlfdGhpcy5pbmZvID0gaW5mbzsKCgkJfQoKCQlpbml0R0xDb250ZXh0KCk7CgoJCS8vIHhyCgoJCWNvbnN0IHhyID0gbmV3IFdlYlhSTWFuYWdlciggX3RoaXMsIF9nbCApOwoKCQl0aGlzLnhyID0geHI7CgoJCS8vIEFQSQoKCQl0aGlzLmdldENvbnRleHQgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gX2dsOwoKCQl9OwoKCQl0aGlzLmdldENvbnRleHRBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIF9nbC5nZXRDb250ZXh0QXR0cmlidXRlcygpOwoKCQl9OwoKCQl0aGlzLmZvcmNlQ29udGV4dExvc3MgPSBmdW5jdGlvbiAoKSB7CgoJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2xvc2VfY29udGV4dCcgKTsKCQkJaWYgKCBleHRlbnNpb24gKSBleHRlbnNpb24ubG9zZUNvbnRleHQoKTsKCgkJfTsKCgkJdGhpcy5mb3JjZUNvbnRleHRSZXN0b3JlID0gZnVuY3Rpb24gKCkgewoKCQkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9sb3NlX2NvbnRleHQnICk7CgkJCWlmICggZXh0ZW5zaW9uICkgZXh0ZW5zaW9uLnJlc3RvcmVDb250ZXh0KCk7CgoJCX07CgoJCXRoaXMuZ2V0UGl4ZWxSYXRpbyA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBfcGl4ZWxSYXRpbzsKCgkJfTsKCgkJdGhpcy5zZXRQaXhlbFJhdGlvID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJCV9waXhlbFJhdGlvID0gdmFsdWU7CgoJCQl0aGlzLnNldFNpemUoIF93aWR0aCwgX2hlaWdodCwgZmFsc2UgKTsKCgkJfTsKCgkJdGhpcy5nZXRTaXplID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LnNldCggX3dpZHRoLCBfaGVpZ2h0ICk7CgoJCX07CgoJCXRoaXMuc2V0U2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgdXBkYXRlU3R5bGUgPSB0cnVlICkgewoKCQkJaWYgKCB4ci5pc1ByZXNlbnRpbmcgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQ2FuXCd0IGNoYW5nZSBzaXplIHdoaWxlIFZSIGRldmljZSBpcyBwcmVzZW50aW5nLicgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCV93aWR0aCA9IHdpZHRoOwoJCQlfaGVpZ2h0ID0gaGVpZ2h0OwoKCQkJY2FudmFzLndpZHRoID0gTWF0aC5mbG9vciggd2lkdGggKiBfcGl4ZWxSYXRpbyApOwoJCQljYW52YXMuaGVpZ2h0ID0gTWF0aC5mbG9vciggaGVpZ2h0ICogX3BpeGVsUmF0aW8gKTsKCgkJCWlmICggdXBkYXRlU3R5bGUgPT09IHRydWUgKSB7CgoJCQkJY2FudmFzLnN0eWxlLndpZHRoID0gd2lkdGggKyAncHgnOwoJCQkJY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7CgoJCQl9CgoJCQl0aGlzLnNldFZpZXdwb3J0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCX07CgoJCXRoaXMuZ2V0RHJhd2luZ0J1ZmZlclNpemUgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCXJldHVybiB0YXJnZXQuc2V0KCBfd2lkdGggKiBfcGl4ZWxSYXRpbywgX2hlaWdodCAqIF9waXhlbFJhdGlvICkuZmxvb3IoKTsKCgkJfTsKCgkJdGhpcy5zZXREcmF3aW5nQnVmZmVyU2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgcGl4ZWxSYXRpbyApIHsKCgkJCV93aWR0aCA9IHdpZHRoOwoJCQlfaGVpZ2h0ID0gaGVpZ2h0OwoKCQkJX3BpeGVsUmF0aW8gPSBwaXhlbFJhdGlvOwoKCQkJY2FudmFzLndpZHRoID0gTWF0aC5mbG9vciggd2lkdGggKiBwaXhlbFJhdGlvICk7CgkJCWNhbnZhcy5oZWlnaHQgPSBNYXRoLmZsb29yKCBoZWlnaHQgKiBwaXhlbFJhdGlvICk7CgoJCQl0aGlzLnNldFZpZXdwb3J0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCX07CgoJCXRoaXMuZ2V0Q3VycmVudFZpZXdwb3J0ID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIF9jdXJyZW50Vmlld3BvcnQgKTsKCgkJfTsKCgkJdGhpcy5nZXRWaWV3cG9ydCA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBfdmlld3BvcnQgKTsKCgkJfTsKCgkJdGhpcy5zZXRWaWV3cG9ydCA9IGZ1bmN0aW9uICggeCwgeSwgd2lkdGgsIGhlaWdodCApIHsKCgkJCWlmICggeC5pc1ZlY3RvcjQgKSB7CgoJCQkJX3ZpZXdwb3J0LnNldCggeC54LCB4LnksIHgueiwgeC53ICk7CgoJCQl9IGVsc2UgewoKCQkJCV92aWV3cG9ydC5zZXQoIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCX0KCgkJCXN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0LmNvcHkoIF92aWV3cG9ydCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApLmZsb29yKCkgKTsKCgkJfTsKCgkJdGhpcy5nZXRTY2lzc29yID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIF9zY2lzc29yICk7CgoJCX07CgoJCXRoaXMuc2V0U2Npc3NvciA9IGZ1bmN0aW9uICggeCwgeSwgd2lkdGgsIGhlaWdodCApIHsKCgkJCWlmICggeC5pc1ZlY3RvcjQgKSB7CgoJCQkJX3NjaXNzb3Iuc2V0KCB4LngsIHgueSwgeC56LCB4LncgKTsKCgkJCX0gZWxzZSB7CgoJCQkJX3NjaXNzb3Iuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQl9CgoJCQlzdGF0ZS5zY2lzc29yKCBfY3VycmVudFNjaXNzb3IuY29weSggX3NjaXNzb3IgKS5tdWx0aXBseVNjYWxhciggX3BpeGVsUmF0aW8gKS5mbG9vcigpICk7CgoJCX07CgoJCXRoaXMuZ2V0U2Npc3NvclRlc3QgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gX3NjaXNzb3JUZXN0OwoKCQl9OwoKCQl0aGlzLnNldFNjaXNzb3JUZXN0ID0gZnVuY3Rpb24gKCBib29sZWFuICkgewoKCQkJc3RhdGUuc2V0U2Npc3NvclRlc3QoIF9zY2lzc29yVGVzdCA9IGJvb2xlYW4gKTsKCgkJfTsKCgkJdGhpcy5zZXRPcGFxdWVTb3J0ID0gZnVuY3Rpb24gKCBtZXRob2QgKSB7CgoJCQlfb3BhcXVlU29ydCA9IG1ldGhvZDsKCgkJfTsKCgkJdGhpcy5zZXRUcmFuc3BhcmVudFNvcnQgPSBmdW5jdGlvbiAoIG1ldGhvZCApIHsKCgkJCV90cmFuc3BhcmVudFNvcnQgPSBtZXRob2Q7CgoJCX07CgoJCS8vIENsZWFyaW5nCgoJCXRoaXMuZ2V0Q2xlYXJDb2xvciA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBiYWNrZ3JvdW5kLmdldENsZWFyQ29sb3IoKSApOwoKCQl9OwoKCQl0aGlzLnNldENsZWFyQ29sb3IgPSBmdW5jdGlvbiAoKSB7CgoJCQliYWNrZ3JvdW5kLnNldENsZWFyQ29sb3IuYXBwbHkoIGJhY2tncm91bmQsIGFyZ3VtZW50cyApOwoKCQl9OwoKCQl0aGlzLmdldENsZWFyQWxwaGEgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gYmFja2dyb3VuZC5nZXRDbGVhckFscGhhKCk7CgoJCX07CgoJCXRoaXMuc2V0Q2xlYXJBbHBoYSA9IGZ1bmN0aW9uICgpIHsKCgkJCWJhY2tncm91bmQuc2V0Q2xlYXJBbHBoYS5hcHBseSggYmFja2dyb3VuZCwgYXJndW1lbnRzICk7CgoJCX07CgoJCXRoaXMuY2xlYXIgPSBmdW5jdGlvbiAoIGNvbG9yID0gdHJ1ZSwgZGVwdGggPSB0cnVlLCBzdGVuY2lsID0gdHJ1ZSApIHsKCgkJCWxldCBiaXRzID0gMDsKCgkJCWlmICggY29sb3IgKSB7CgoJCQkJLy8gY2hlY2sgaWYgd2UncmUgdHJ5aW5nIHRvIGNsZWFyIGFuIGludGVnZXIgdGFyZ2V0CgkJCQlsZXQgaXNJbnRlZ2VyRm9ybWF0ID0gZmFsc2U7CgkJCQlpZiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgewoKCQkJCQljb25zdCB0YXJnZXRGb3JtYXQgPSBfY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmZvcm1hdDsKCQkJCQlpc0ludGVnZXJGb3JtYXQgPSB0YXJnZXRGb3JtYXQgPT09IFJHQkFJbnRlZ2VyRm9ybWF0IHx8CgkJCQkJCXRhcmdldEZvcm1hdCA9PT0gUkdJbnRlZ2VyRm9ybWF0IHx8CgkJCQkJCXRhcmdldEZvcm1hdCA9PT0gUmVkSW50ZWdlckZvcm1hdDsKCgkJCQl9CgoJCQkJLy8gdXNlIHRoZSBhcHByb3ByaWF0ZSBjbGVhciBmdW5jdGlvbnMgdG8gY2xlYXIgdGhlIHRhcmdldCBpZiBpdCdzIGEgc2lnbmVkCgkJCQkvLyBvciB1bnNpZ25lZCBpbnRlZ2VyIHRhcmdldAoJCQkJaWYgKCBpc0ludGVnZXJGb3JtYXQgKSB7CgoJCQkJCWNvbnN0IHRhcmdldFR5cGUgPSBfY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLnR5cGU7CgkJCQkJY29uc3QgaXNVbnNpZ25lZFR5cGUgPSB0YXJnZXRUeXBlID09PSBVbnNpZ25lZEJ5dGVUeXBlIHx8CgkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fAoJCQkJCQl0YXJnZXRUeXBlID09PSBVbnNpZ25lZFNob3J0VHlwZSB8fAoJCQkJCQl0YXJnZXRUeXBlID09PSBVbnNpZ25lZEludDI0OFR5cGUgfHwKCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRTaG9ydDQ0NDRUeXBlIHx8CgkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkU2hvcnQ1NTUxVHlwZTsKCgkJCQkJY29uc3QgY2xlYXJDb2xvciA9IGJhY2tncm91bmQuZ2V0Q2xlYXJDb2xvcigpOwoJCQkJCWNvbnN0IGEgPSBiYWNrZ3JvdW5kLmdldENsZWFyQWxwaGEoKTsKCQkJCQljb25zdCByID0gY2xlYXJDb2xvci5yOwoJCQkJCWNvbnN0IGcgPSBjbGVhckNvbG9yLmc7CgkJCQkJY29uc3QgYiA9IGNsZWFyQ29sb3IuYjsKCgkJCQkJaWYgKCBpc1Vuc2lnbmVkVHlwZSApIHsKCgkJCQkJCXVpbnRDbGVhckNvbG9yWyAwIF0gPSByOwoJCQkJCQl1aW50Q2xlYXJDb2xvclsgMSBdID0gZzsKCQkJCQkJdWludENsZWFyQ29sb3JbIDIgXSA9IGI7CgkJCQkJCXVpbnRDbGVhckNvbG9yWyAzIF0gPSBhOwoJCQkJCQlfZ2wuY2xlYXJCdWZmZXJ1aXYoIF9nbC5DT0xPUiwgMCwgdWludENsZWFyQ29sb3IgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWludENsZWFyQ29sb3JbIDAgXSA9IHI7CgkJCQkJCWludENsZWFyQ29sb3JbIDEgXSA9IGc7CgkJCQkJCWludENsZWFyQ29sb3JbIDIgXSA9IGI7CgkJCQkJCWludENsZWFyQ29sb3JbIDMgXSA9IGE7CgkJCQkJCV9nbC5jbGVhckJ1ZmZlcml2KCBfZ2wuQ09MT1IsIDAsIGludENsZWFyQ29sb3IgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWJpdHMgfD0gX2dsLkNPTE9SX0JVRkZFUl9CSVQ7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBkZXB0aCApIGJpdHMgfD0gX2dsLkRFUFRIX0JVRkZFUl9CSVQ7CgkJCWlmICggc3RlbmNpbCApIHsKCgkJCQliaXRzIHw9IF9nbC5TVEVOQ0lMX0JVRkZFUl9CSVQ7CgkJCQl0aGlzLnN0YXRlLmJ1ZmZlcnMuc3RlbmNpbC5zZXRNYXNrKCAweGZmZmZmZmZmICk7CgoJCQl9CgoJCQlfZ2wuY2xlYXIoIGJpdHMgKTsKCgkJfTsKCgkJdGhpcy5jbGVhckNvbG9yID0gZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5jbGVhciggdHJ1ZSwgZmFsc2UsIGZhbHNlICk7CgoJCX07CgoJCXRoaXMuY2xlYXJEZXB0aCA9IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuY2xlYXIoIGZhbHNlLCB0cnVlLCBmYWxzZSApOwoKCQl9OwoKCQl0aGlzLmNsZWFyU3RlbmNpbCA9IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuY2xlYXIoIGZhbHNlLCBmYWxzZSwgdHJ1ZSApOwoKCQl9OwoKCQkvLwoKCQl0aGlzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7CgoJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dGxvc3QnLCBvbkNvbnRleHRMb3N0LCBmYWxzZSApOwoJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dHJlc3RvcmVkJywgb25Db250ZXh0UmVzdG9yZSwgZmFsc2UgKTsKCQkJY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRjcmVhdGlvbmVycm9yJywgb25Db250ZXh0Q3JlYXRpb25FcnJvciwgZmFsc2UgKTsKCgkJCXJlbmRlckxpc3RzLmRpc3Bvc2UoKTsKCQkJcmVuZGVyU3RhdGVzLmRpc3Bvc2UoKTsKCQkJcHJvcGVydGllcy5kaXNwb3NlKCk7CgkJCWN1YmVtYXBzLmRpc3Bvc2UoKTsKCQkJY3ViZXV2bWFwcy5kaXNwb3NlKCk7CgkJCW9iamVjdHMuZGlzcG9zZSgpOwoJCQliaW5kaW5nU3RhdGVzLmRpc3Bvc2UoKTsKCQkJdW5pZm9ybXNHcm91cHMuZGlzcG9zZSgpOwoJCQlwcm9ncmFtQ2FjaGUuZGlzcG9zZSgpOwoKCQkJeHIuZGlzcG9zZSgpOwoKCQkJeHIucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25zdGFydCcsIG9uWFJTZXNzaW9uU3RhcnQgKTsKCQkJeHIucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25lbmQnLCBvblhSU2Vzc2lvbkVuZCApOwoKCQkJaWYgKCBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICkgewoKCQkJCV90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuZGlzcG9zZSgpOwoJCQkJX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCA9IG51bGw7CgoJCQl9CgoJCQlhbmltYXRpb24uc3RvcCgpOwoKCQl9OwoKCQkvLyBFdmVudHMKCgkJZnVuY3Rpb24gb25Db250ZXh0TG9zdCggZXZlbnQgKSB7CgoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBDb250ZXh0IExvc3QuJyApOwoKCQkJX2lzQ29udGV4dExvc3QgPSB0cnVlOwoKCQl9CgoJCWZ1bmN0aW9uIG9uQ29udGV4dFJlc3RvcmUoIC8qIGV2ZW50ICovICkgewoKCQkJY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBDb250ZXh0IFJlc3RvcmVkLicgKTsKCgkJCV9pc0NvbnRleHRMb3N0ID0gZmFsc2U7CgoJCQljb25zdCBpbmZvQXV0b1Jlc2V0ID0gaW5mby5hdXRvUmVzZXQ7CgkJCWNvbnN0IHNoYWRvd01hcEVuYWJsZWQgPSBzaGFkb3dNYXAuZW5hYmxlZDsKCQkJY29uc3Qgc2hhZG93TWFwQXV0b1VwZGF0ZSA9IHNoYWRvd01hcC5hdXRvVXBkYXRlOwoJCQljb25zdCBzaGFkb3dNYXBOZWVkc1VwZGF0ZSA9IHNoYWRvd01hcC5uZWVkc1VwZGF0ZTsKCQkJY29uc3Qgc2hhZG93TWFwVHlwZSA9IHNoYWRvd01hcC50eXBlOwoKCQkJaW5pdEdMQ29udGV4dCgpOwoKCQkJaW5mby5hdXRvUmVzZXQgPSBpbmZvQXV0b1Jlc2V0OwoJCQlzaGFkb3dNYXAuZW5hYmxlZCA9IHNoYWRvd01hcEVuYWJsZWQ7CgkJCXNoYWRvd01hcC5hdXRvVXBkYXRlID0gc2hhZG93TWFwQXV0b1VwZGF0ZTsKCQkJc2hhZG93TWFwLm5lZWRzVXBkYXRlID0gc2hhZG93TWFwTmVlZHNVcGRhdGU7CgkJCXNoYWRvd01hcC50eXBlID0gc2hhZG93TWFwVHlwZTsKCgkJfQoKCQlmdW5jdGlvbiBvbkNvbnRleHRDcmVhdGlvbkVycm9yKCBldmVudCApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBIFdlYkdMIGNvbnRleHQgY291bGQgbm90IGJlIGNyZWF0ZWQuIFJlYXNvbjogJywgZXZlbnQuc3RhdHVzTWVzc2FnZSApOwoKCQl9CgoJCWZ1bmN0aW9uIG9uTWF0ZXJpYWxEaXNwb3NlKCBldmVudCApIHsKCgkJCWNvbnN0IG1hdGVyaWFsID0gZXZlbnQudGFyZ2V0OwoKCQkJbWF0ZXJpYWwucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbk1hdGVyaWFsRGlzcG9zZSApOwoKCQkJZGVhbGxvY2F0ZU1hdGVyaWFsKCBtYXRlcmlhbCApOwoKCQl9CgoJCS8vIEJ1ZmZlciBkZWFsbG9jYXRpb24KCgkJZnVuY3Rpb24gZGVhbGxvY2F0ZU1hdGVyaWFsKCBtYXRlcmlhbCApIHsKCgkJCXJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApOwoKCQkJcHJvcGVydGllcy5yZW1vdmUoIG1hdGVyaWFsICk7CgoJCX0KCgoJCWZ1bmN0aW9uIHJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApIHsKCgkJCWNvbnN0IHByb2dyYW1zID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICkucHJvZ3JhbXM7CgoJCQlpZiAoIHByb2dyYW1zICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcHJvZ3JhbXMuZm9yRWFjaCggZnVuY3Rpb24gKCBwcm9ncmFtICkgewoKCQkJCQlwcm9ncmFtQ2FjaGUucmVsZWFzZVByb2dyYW0oIHByb2dyYW0gKTsKCgkJCQl9ICk7CgoJCQkJaWYgKCBtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICkgewoKCQkJCQlwcm9ncmFtQ2FjaGUucmVsZWFzZVNoYWRlckNhY2hlKCBtYXRlcmlhbCApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQkvLyBCdWZmZXIgcmVuZGVyaW5nCgoJCXRoaXMucmVuZGVyQnVmZmVyRGlyZWN0ID0gZnVuY3Rpb24gKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKSB7CgoJCQlpZiAoIHNjZW5lID09PSBudWxsICkgc2NlbmUgPSBfZW1wdHlTY2VuZTsgLy8gcmVuZGVyQnVmZmVyRGlyZWN0IHNlY29uZCBwYXJhbWV0ZXIgdXNlZCB0byBiZSBmb2cgKGNvdWxkIGJlIG51bGwpCgoJCQljb25zdCBmcm9udEZhY2VDVyA9ICggb2JqZWN0LmlzTWVzaCAmJiBvYmplY3QubWF0cml4V29ybGQuZGV0ZXJtaW5hbnQoKSA8IDAgKTsKCgkJCWNvbnN0IHByb2dyYW0gPSBzZXRQcm9ncmFtKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCApOwoKCQkJc3RhdGUuc2V0TWF0ZXJpYWwoIG1hdGVyaWFsLCBmcm9udEZhY2VDVyApOwoKCQkJLy8KCgkJCWxldCBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCQlsZXQgcmFuZ2VGYWN0b3IgPSAxOwoKCQkJaWYgKCBtYXRlcmlhbC53aXJlZnJhbWUgPT09IHRydWUgKSB7CgoJCQkJaW5kZXggPSBnZW9tZXRyaWVzLmdldFdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKTsKCgkJCQlpZiAoIGluZGV4ID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQkJcmFuZ2VGYWN0b3IgPSAyOwoKCQkJfQoKCQkJLy8KCgkJCWNvbnN0IGRyYXdSYW5nZSA9IGdlb21ldHJ5LmRyYXdSYW5nZTsKCQkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQkJbGV0IGRyYXdTdGFydCA9IGRyYXdSYW5nZS5zdGFydCAqIHJhbmdlRmFjdG9yOwoJCQlsZXQgZHJhd0VuZCA9ICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKiByYW5nZUZhY3RvcjsKCgkJCWlmICggZ3JvdXAgIT09IG51bGwgKSB7CgoJCQkJZHJhd1N0YXJ0ID0gTWF0aC5tYXgoIGRyYXdTdGFydCwgZ3JvdXAuc3RhcnQgKiByYW5nZUZhY3RvciApOwoJCQkJZHJhd0VuZCA9IE1hdGgubWluKCBkcmF3RW5kLCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSAqIHJhbmdlRmFjdG9yICk7CgoJCQl9CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCWRyYXdTdGFydCA9IE1hdGgubWF4KCBkcmF3U3RhcnQsIDAgKTsKCQkJCWRyYXdFbmQgPSBNYXRoLm1pbiggZHJhd0VuZCwgaW5kZXguY291bnQgKTsKCgkJCX0gZWxzZSBpZiAoIHBvc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgcG9zaXRpb24gIT09IG51bGwgKSB7CgoJCQkJZHJhd1N0YXJ0ID0gTWF0aC5tYXgoIGRyYXdTdGFydCwgMCApOwoJCQkJZHJhd0VuZCA9IE1hdGgubWluKCBkcmF3RW5kLCBwb3NpdGlvbi5jb3VudCApOwoKCQkJfQoKCQkJY29uc3QgZHJhd0NvdW50ID0gZHJhd0VuZCAtIGRyYXdTdGFydDsKCgkJCWlmICggZHJhd0NvdW50IDwgMCB8fCBkcmF3Q291bnQgPT09IEluZmluaXR5ICkgcmV0dXJuOwoKCQkJLy8KCgkJCWJpbmRpbmdTdGF0ZXMuc2V0dXAoIG9iamVjdCwgbWF0ZXJpYWwsIHByb2dyYW0sIGdlb21ldHJ5LCBpbmRleCApOwoKCQkJbGV0IGF0dHJpYnV0ZTsKCQkJbGV0IHJlbmRlcmVyID0gYnVmZmVyUmVuZGVyZXI7CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCWF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApOwoKCQkJCXJlbmRlcmVyID0gaW5kZXhlZEJ1ZmZlclJlbmRlcmVyOwoJCQkJcmVuZGVyZXIuc2V0SW5kZXgoIGF0dHJpYnV0ZSApOwoKCQkJfQoKCQkJLy8KCgkJCWlmICggb2JqZWN0LmlzTWVzaCApIHsKCgkJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCgkJCQkJc3RhdGUuc2V0TGluZVdpZHRoKCBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGggKiBnZXRUYXJnZXRQaXhlbFJhdGlvKCkgKTsKCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuTElORVMgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuVFJJQU5HTEVTICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGluZSApIHsKCgkJCQlsZXQgbGluZVdpZHRoID0gbWF0ZXJpYWwubGluZXdpZHRoOwoKCQkJCWlmICggbGluZVdpZHRoID09PSB1bmRlZmluZWQgKSBsaW5lV2lkdGggPSAxOyAvLyBOb3QgdXNpbmcgTGluZSpNYXRlcmlhbAoKCQkJCXN0YXRlLnNldExpbmVXaWR0aCggbGluZVdpZHRoICogZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpICk7CgoJCQkJaWYgKCBvYmplY3QuaXNMaW5lU2VnbWVudHMgKSB7CgoJCQkJCXJlbmRlcmVyLnNldE1vZGUoIF9nbC5MSU5FUyApOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xpbmVMb29wICkgewoKCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuTElORV9MT09QICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVfU1RSSVAgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNQb2ludHMgKSB7CgoJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlBPSU5UUyApOwoKCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzU3ByaXRlICkgewoKCQkJCXJlbmRlcmVyLnNldE1vZGUoIF9nbC5UUklBTkdMRVMgKTsKCgkJCX0KCgkJCWlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggKSB7CgoJCQkJcmVuZGVyZXIucmVuZGVyTXVsdGlEcmF3KCBvYmplY3QuX211bHRpRHJhd1N0YXJ0cywgb2JqZWN0Ll9tdWx0aURyYXdDb3VudHMsIG9iamVjdC5fbXVsdGlEcmF3Q291bnQgKTsKCgkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggKSB7CgoJCQkJcmVuZGVyZXIucmVuZGVySW5zdGFuY2VzKCBkcmF3U3RhcnQsIGRyYXdDb3VudCwgb2JqZWN0LmNvdW50ICk7CgoJCQl9IGVsc2UgaWYgKCBnZW9tZXRyeS5pc0luc3RhbmNlZEJ1ZmZlckdlb21ldHJ5ICkgewoKCQkJCWNvbnN0IG1heEluc3RhbmNlQ291bnQgPSBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCAhPT0gdW5kZWZpbmVkID8gZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgOiBJbmZpbml0eTsKCQkJCWNvbnN0IGluc3RhbmNlQ291bnQgPSBNYXRoLm1pbiggZ2VvbWV0cnkuaW5zdGFuY2VDb3VudCwgbWF4SW5zdGFuY2VDb3VudCApOwoKCQkJCXJlbmRlcmVyLnJlbmRlckluc3RhbmNlcyggZHJhd1N0YXJ0LCBkcmF3Q291bnQsIGluc3RhbmNlQ291bnQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJcmVuZGVyZXIucmVuZGVyKCBkcmF3U3RhcnQsIGRyYXdDb3VudCApOwoKCQkJfQoKCQl9OwoKCQkvLyBDb21waWxlCgoJCWZ1bmN0aW9uIHByZXBhcmVNYXRlcmlhbCggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKSB7CgoJCQlpZiAoIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSB0cnVlICYmIG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUgJiYgbWF0ZXJpYWwuZm9yY2VTaW5nbGVQYXNzID09PSBmYWxzZSApIHsKCgkJCQltYXRlcmlhbC5zaWRlID0gQmFja1NpZGU7CgkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQlnZXRQcm9ncmFtKCBtYXRlcmlhbCwgc2NlbmUsIG9iamVjdCApOwoKCQkJCW1hdGVyaWFsLnNpZGUgPSBGcm9udFNpZGU7CgkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQlnZXRQcm9ncmFtKCBtYXRlcmlhbCwgc2NlbmUsIG9iamVjdCApOwoKCQkJCW1hdGVyaWFsLnNpZGUgPSBEb3VibGVTaWRlOwoKCQkJfSBlbHNlIHsKCgkJCQlnZXRQcm9ncmFtKCBtYXRlcmlhbCwgc2NlbmUsIG9iamVjdCApOwoKCQkJfQoKCQl9CgoJCXRoaXMuY29tcGlsZSA9IGZ1bmN0aW9uICggc2NlbmUsIGNhbWVyYSwgdGFyZ2V0U2NlbmUgPSBudWxsICkgewoKCQkJaWYgKCB0YXJnZXRTY2VuZSA9PT0gbnVsbCApIHRhcmdldFNjZW5lID0gc2NlbmU7CgoJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCB0YXJnZXRTY2VuZSApOwoJCQljdXJyZW50UmVuZGVyU3RhdGUuaW5pdCgpOwoKCQkJcmVuZGVyU3RhdGVTdGFjay5wdXNoKCBjdXJyZW50UmVuZGVyU3RhdGUgKTsKCgkJCS8vIGdhdGhlciBsaWdodHMgZnJvbSBib3RoIHRoZSB0YXJnZXQgc2NlbmUgYW5kIHRoZSBuZXcgb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCB0byB0aGUgc2NlbmUuCgoJCQl0YXJnZXRTY2VuZS50cmF2ZXJzZVZpc2libGUoIGZ1bmN0aW9uICggb2JqZWN0ICkgewoKCQkJCWlmICggb2JqZWN0LmlzTGlnaHQgJiYgb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgoJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoTGlnaHQoIG9iamVjdCApOwoKCQkJCQlpZiAoIG9iamVjdC5jYXN0U2hhZG93ICkgewoKCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfSApOwoKCQkJaWYgKCBzY2VuZSAhPT0gdGFyZ2V0U2NlbmUgKSB7CgoJCQkJc2NlbmUudHJhdmVyc2VWaXNpYmxlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCQkJaWYgKCBvYmplY3QuaXNMaWdodCAmJiBvYmplY3QubGF5ZXJzLnRlc3QoIGNhbWVyYS5sYXllcnMgKSApIHsKCgkJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoTGlnaHQoIG9iamVjdCApOwoKCQkJCQkJaWYgKCBvYmplY3QuY2FzdFNoYWRvdyApIHsKCgkJCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaFNoYWRvdyggb2JqZWN0ICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9ICk7CgoJCQl9CgoJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHMoIF90aGlzLl91c2VMZWdhY3lMaWdodHMgKTsKCgkJCS8vIE9ubHkgaW5pdGlhbGl6ZSBtYXRlcmlhbHMgaW4gdGhlIG5ldyBzY2VuZSwgbm90IHRoZSB0YXJnZXRTY2VuZS4KCgkJCWNvbnN0IG1hdGVyaWFscyA9IG5ldyBTZXQoKTsKCgkJCXNjZW5lLnRyYXZlcnNlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQlpZiAoIG1hdGVyaWFsICkgewoKCQkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsICkgKSB7CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXRlcmlhbC5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQkJY29uc3QgbWF0ZXJpYWwyID0gbWF0ZXJpYWxbIGkgXTsKCgkJCQkJCQlwcmVwYXJlTWF0ZXJpYWwoIG1hdGVyaWFsMiwgdGFyZ2V0U2NlbmUsIG9iamVjdCApOwoJCQkJCQkJbWF0ZXJpYWxzLmFkZCggbWF0ZXJpYWwyICk7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlwcmVwYXJlTWF0ZXJpYWwoIG1hdGVyaWFsLCB0YXJnZXRTY2VuZSwgb2JqZWN0ICk7CgkJCQkJCW1hdGVyaWFscy5hZGQoIG1hdGVyaWFsICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9ICk7CgoJCQlyZW5kZXJTdGF0ZVN0YWNrLnBvcCgpOwoJCQljdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKCQkJcmV0dXJuIG1hdGVyaWFsczsKCgkJfTsKCgkJLy8gY29tcGlsZUFzeW5jCgoJCXRoaXMuY29tcGlsZUFzeW5jID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhLCB0YXJnZXRTY2VuZSA9IG51bGwgKSB7CgoJCQljb25zdCBtYXRlcmlhbHMgPSB0aGlzLmNvbXBpbGUoIHNjZW5lLCBjYW1lcmEsIHRhcmdldFNjZW5lICk7CgoJCQkvLyBXYWl0IGZvciBhbGwgdGhlIG1hdGVyaWFscyBpbiB0aGUgbmV3IG9iamVjdCB0byBpbmRpY2F0ZSB0aGF0IHRoZXkncmUKCQkJLy8gcmVhZHkgdG8gYmUgdXNlZCBiZWZvcmUgcmVzb2x2aW5nIHRoZSBwcm9taXNlLgoKCQkJcmV0dXJuIG5ldyBQcm9taXNlKCAoIHJlc29sdmUgKSA9PiB7CgoJCQkJZnVuY3Rpb24gY2hlY2tNYXRlcmlhbHNSZWFkeSgpIHsKCgkJCQkJbWF0ZXJpYWxzLmZvckVhY2goIGZ1bmN0aW9uICggbWF0ZXJpYWwgKSB7CgoJCQkJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCQkJCQkJY29uc3QgcHJvZ3JhbSA9IG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbTsKCgkJCQkJCWlmICggcHJvZ3JhbS5pc1JlYWR5KCkgKSB7CgoJCQkJCQkJLy8gcmVtb3ZlIGFueSBwcm9ncmFtcyB0aGF0IHJlcG9ydCB0aGV5J3JlIHJlYWR5IHRvIHVzZSBmcm9tIHRoZSBsaXN0CgkJCQkJCQltYXRlcmlhbHMuZGVsZXRlKCBtYXRlcmlhbCApOwoKCQkJCQkJfQoKCQkJCQl9ICk7CgoJCQkJCS8vIG9uY2UgdGhlIGxpc3Qgb2YgY29tcGlsaW5nIG1hdGVyaWFscyBpcyBlbXB0eSwgY2FsbCB0aGUgY2FsbGJhY2sKCgkJCQkJaWYgKCBtYXRlcmlhbHMuc2l6ZSA9PT0gMCApIHsKCgkJCQkJCXJlc29sdmUoIHNjZW5lICk7CgkJCQkJCXJldHVybjsKCgkJCQkJfQoKCQkJCQkvLyBpZiBzb21lIG1hdGVyaWFscyBhcmUgc3RpbGwgbm90IHJlYWR5LCB3YWl0IGEgYml0IGFuZCBjaGVjayBhZ2FpbgoKCQkJCQlzZXRUaW1lb3V0KCBjaGVja01hdGVyaWFsc1JlYWR5LCAxMCApOwoKCQkJCX0KCgkJCQlpZiAoIGV4dGVuc2lvbnMuZ2V0KCAnS0hSX3BhcmFsbGVsX3NoYWRlcl9jb21waWxlJyApICE9PSBudWxsICkgewoKCQkJCQkvLyBJZiB3ZSBjYW4gY2hlY2sgdGhlIGNvbXBpbGF0aW9uIHN0YXR1cyBvZiB0aGUgbWF0ZXJpYWxzIHdpdGhvdXQKCQkJCQkvLyBibG9ja2luZyB0aGVuIGRvIHNvIHJpZ2h0IGF3YXkuCgoJCQkJCWNoZWNrTWF0ZXJpYWxzUmVhZHkoKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBPdGhlcndpc2Ugc3RhcnQgYnkgd2FpdGluZyBhIGJpdCB0byBnaXZlIHRoZSBtYXRlcmlhbHMgd2UganVzdAoJCQkJCS8vIGluaXRpYWxpemVkIGEgY2hhbmNlIHRvIGZpbmlzaC4KCgkJCQkJc2V0VGltZW91dCggY2hlY2tNYXRlcmlhbHNSZWFkeSwgMTAgKTsKCgkJCQl9CgoJCQl9ICk7CgoJCX07CgoJCS8vIEFuaW1hdGlvbiBMb29wCgoJCWxldCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBudWxsOwoKCQlmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lICkgewoKCQkJaWYgKCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgKSBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2soIHRpbWUgKTsKCgkJfQoKCQlmdW5jdGlvbiBvblhSU2Vzc2lvblN0YXJ0KCkgewoKCQkJYW5pbWF0aW9uLnN0b3AoKTsKCgkJfQoKCQlmdW5jdGlvbiBvblhSU2Vzc2lvbkVuZCgpIHsKCgkJCWFuaW1hdGlvbi5zdGFydCgpOwoKCQl9CgoJCWNvbnN0IGFuaW1hdGlvbiA9IG5ldyBXZWJHTEFuaW1hdGlvbigpOwoJCWFuaW1hdGlvbi5zZXRBbmltYXRpb25Mb29wKCBvbkFuaW1hdGlvbkZyYW1lICk7CgoJCWlmICggdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnICkgYW5pbWF0aW9uLnNldENvbnRleHQoIHNlbGYgKTsKCgkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCW9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IGNhbGxiYWNrOwoJCQl4ci5zZXRBbmltYXRpb25Mb29wKCBjYWxsYmFjayApOwoKCQkJKCBjYWxsYmFjayA9PT0gbnVsbCApID8gYW5pbWF0aW9uLnN0b3AoKSA6IGFuaW1hdGlvbi5zdGFydCgpOwoKCQl9OwoKCQl4ci5hZGRFdmVudExpc3RlbmVyKCAnc2Vzc2lvbnN0YXJ0Jywgb25YUlNlc3Npb25TdGFydCApOwoJCXhyLmFkZEV2ZW50TGlzdGVuZXIoICdzZXNzaW9uZW5kJywgb25YUlNlc3Npb25FbmQgKTsKCgkJLy8gUmVuZGVyaW5nCgoJCXRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhICkgewoKCQkJaWYgKCBjYW1lcmEgIT09IHVuZGVmaW5lZCAmJiBjYW1lcmEuaXNDYW1lcmEgIT09IHRydWUgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVuZGVyOiBjYW1lcmEgaXMgbm90IGFuIGluc3RhbmNlIG9mIFRIUkVFLkNhbWVyYS4nICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQlpZiAoIF9pc0NvbnRleHRMb3N0ID09PSB0cnVlICkgcmV0dXJuOwoKCQkJLy8gdXBkYXRlIHNjZW5lIGdyYXBoCgoJCQlpZiAoIHNjZW5lLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHNjZW5lLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCQkvLyB1cGRhdGUgY2FtZXJhIG1hdHJpY2VzIGFuZCBmcnVzdHVtCgoJCQlpZiAoIGNhbWVyYS5wYXJlbnQgPT09IG51bGwgJiYgY2FtZXJhLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIGNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJaWYgKCB4ci5lbmFibGVkID09PSB0cnVlICYmIHhyLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCgkJCQlpZiAoIHhyLmNhbWVyYUF1dG9VcGRhdGUgPT09IHRydWUgKSB4ci51cGRhdGVDYW1lcmEoIGNhbWVyYSApOwoKCQkJCWNhbWVyYSA9IHhyLmdldENhbWVyYSgpOyAvLyB1c2UgWFIgY2FtZXJhIGZvciByZW5kZXJpbmcKCgkJCX0KCgkJCS8vCgkJCWlmICggc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSApIHNjZW5lLm9uQmVmb3JlUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgX2N1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlcy5nZXQoIHNjZW5lLCByZW5kZXJTdGF0ZVN0YWNrLmxlbmd0aCApOwoJCQljdXJyZW50UmVuZGVyU3RhdGUuaW5pdCgpOwoKCQkJcmVuZGVyU3RhdGVTdGFjay5wdXNoKCBjdXJyZW50UmVuZGVyU3RhdGUgKTsKCgkJCV9wcm9qU2NyZWVuTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CgkJCV9mcnVzdHVtLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KCBfcHJvalNjcmVlbk1hdHJpeCApOwoKCQkJX2xvY2FsQ2xpcHBpbmdFbmFibGVkID0gdGhpcy5sb2NhbENsaXBwaW5nRW5hYmxlZDsKCQkJX2NsaXBwaW5nRW5hYmxlZCA9IGNsaXBwaW5nLmluaXQoIHRoaXMuY2xpcHBpbmdQbGFuZXMsIF9sb2NhbENsaXBwaW5nRW5hYmxlZCApOwoKCQkJY3VycmVudFJlbmRlckxpc3QgPSByZW5kZXJMaXN0cy5nZXQoIHNjZW5lLCByZW5kZXJMaXN0U3RhY2subGVuZ3RoICk7CgkJCWN1cnJlbnRSZW5kZXJMaXN0LmluaXQoKTsKCgkJCXJlbmRlckxpc3RTdGFjay5wdXNoKCBjdXJyZW50UmVuZGVyTGlzdCApOwoKCQkJcHJvamVjdE9iamVjdCggc2NlbmUsIGNhbWVyYSwgMCwgX3RoaXMuc29ydE9iamVjdHMgKTsKCgkJCWN1cnJlbnRSZW5kZXJMaXN0LmZpbmlzaCgpOwoKCQkJaWYgKCBfdGhpcy5zb3J0T2JqZWN0cyA9PT0gdHJ1ZSApIHsKCgkJCQljdXJyZW50UmVuZGVyTGlzdC5zb3J0KCBfb3BhcXVlU29ydCwgX3RyYW5zcGFyZW50U29ydCApOwoKCQkJfQoKCQkJLy8KCgkJCXRoaXMuaW5mby5yZW5kZXIuZnJhbWUgKys7CgoJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5iZWdpblNoYWRvd3MoKTsKCgkJCWNvbnN0IHNoYWRvd3NBcnJheSA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5zaGFkb3dzQXJyYXk7CgoJCQlzaGFkb3dNYXAucmVuZGVyKCBzaGFkb3dzQXJyYXksIHNjZW5lLCBjYW1lcmEgKTsKCgkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLmVuZFNoYWRvd3MoKTsKCgkJCS8vCgoJCQlpZiAoIHRoaXMuaW5mby5hdXRvUmVzZXQgPT09IHRydWUgKSB0aGlzLmluZm8ucmVzZXQoKTsKCgoJCQkvLwoKCQkJYmFja2dyb3VuZC5yZW5kZXIoIGN1cnJlbnRSZW5kZXJMaXN0LCBzY2VuZSApOwoKCQkJLy8gcmVuZGVyIHNjZW5lCgoJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHMoIF90aGlzLl91c2VMZWdhY3lMaWdodHMgKTsKCgkJCWlmICggY2FtZXJhLmlzQXJyYXlDYW1lcmEgKSB7CgoJCQkJY29uc3QgY2FtZXJhcyA9IGNhbWVyYS5jYW1lcmFzOwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNhbWVyYXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJY29uc3QgY2FtZXJhMiA9IGNhbWVyYXNbIGkgXTsKCgkJCQkJcmVuZGVyU2NlbmUoIGN1cnJlbnRSZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhMiwgY2FtZXJhMi52aWV3cG9ydCApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJcmVuZGVyU2NlbmUoIGN1cnJlbnRSZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhICk7CgoJCQl9CgoJCQkvLwoKCQkJaWYgKCBfY3VycmVudFJlbmRlclRhcmdldCAhPT0gbnVsbCApIHsKCgkJCQkvLyByZXNvbHZlIG11bHRpc2FtcGxlIHJlbmRlcmJ1ZmZlcnMgdG8gYSBzaW5nbGUtc2FtcGxlIHRleHR1cmUgaWYgbmVjZXNzYXJ5CgoJCQkJdGV4dHVyZXMudXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgoJCQkJLy8gR2VuZXJhdGUgbWlwbWFwIGlmIHdlJ3JlIHVzaW5nIGFueSBraW5kIG9mIG1pcG1hcCBmaWx0ZXJpbmcKCgkJCQl0ZXh0dXJlcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgoJCQl9CgoJCQkvLwoKCQkJaWYgKCBzY2VuZS5pc1NjZW5lID09PSB0cnVlICkgc2NlbmUub25BZnRlclJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEgKTsKCgkJCS8vIF9nbC5maW5pc2goKTsKCgkJCWJpbmRpbmdTdGF0ZXMucmVzZXREZWZhdWx0U3RhdGUoKTsKCQkJX2N1cnJlbnRNYXRlcmlhbElkID0gLSAxOwoJCQlfY3VycmVudENhbWVyYSA9IG51bGw7CgoJCQlyZW5kZXJTdGF0ZVN0YWNrLnBvcCgpOwoKCQkJaWYgKCByZW5kZXJTdGF0ZVN0YWNrLmxlbmd0aCA+IDAgKSB7CgoJCQkJY3VycmVudFJlbmRlclN0YXRlID0gcmVuZGVyU3RhdGVTdGFja1sgcmVuZGVyU3RhdGVTdGFjay5sZW5ndGggLSAxIF07CgoJCQl9IGVsc2UgewoKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IG51bGw7CgoJCQl9CgoJCQlyZW5kZXJMaXN0U3RhY2sucG9wKCk7CgoJCQlpZiAoIHJlbmRlckxpc3RTdGFjay5sZW5ndGggPiAwICkgewoKCQkJCWN1cnJlbnRSZW5kZXJMaXN0ID0gcmVuZGVyTGlzdFN0YWNrWyByZW5kZXJMaXN0U3RhY2subGVuZ3RoIC0gMSBdOwoKCQkJfSBlbHNlIHsKCgkJCQljdXJyZW50UmVuZGVyTGlzdCA9IG51bGw7CgoJCQl9CgoJCX07CgoJCWZ1bmN0aW9uIHByb2plY3RPYmplY3QoIG9iamVjdCwgY2FtZXJhLCBncm91cE9yZGVyLCBzb3J0T2JqZWN0cyApIHsKCgkJCWlmICggb2JqZWN0LnZpc2libGUgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJY29uc3QgdmlzaWJsZSA9IG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApOwoKCQkJaWYgKCB2aXNpYmxlICkgewoKCQkJCWlmICggb2JqZWN0LmlzR3JvdXAgKSB7CgoJCQkJCWdyb3VwT3JkZXIgPSBvYmplY3QucmVuZGVyT3JkZXI7CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTE9EICkgewoKCQkJCQlpZiAoIG9iamVjdC5hdXRvVXBkYXRlID09PSB0cnVlICkgb2JqZWN0LnVwZGF0ZSggY2FtZXJhICk7CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGlnaHQgKSB7CgoJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoTGlnaHQoIG9iamVjdCApOwoKCQkJCQlpZiAoIG9iamVjdC5jYXN0U2hhZG93ICkgewoKCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzU3ByaXRlICkgewoKCQkJCQlpZiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c1Nwcml0ZSggb2JqZWN0ICkgKSB7CgoJCQkJCQlpZiAoIHNvcnRPYmplY3RzICkgewoKCQkJCQkJCV92ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggb2JqZWN0Lm1hdHJpeFdvcmxkICkKCQkJCQkJCQkuYXBwbHlNYXRyaXg0KCBfcHJvalNjcmVlbk1hdHJpeCApOwoKCQkJCQkJfQoKCQkJCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZSggb2JqZWN0ICk7CgkJCQkJCWNvbnN0IG1hdGVyaWFsID0gb2JqZWN0Lm1hdGVyaWFsOwoKCQkJCQkJaWYgKCBtYXRlcmlhbC52aXNpYmxlICkgewoKCQkJCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnB1c2goIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCBfdmVjdG9yMy56LCBudWxsICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNNZXNoIHx8IG9iamVjdC5pc0xpbmUgfHwgb2JqZWN0LmlzUG9pbnRzICkgewoKCQkJCQlpZiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c09iamVjdCggb2JqZWN0ICkgKSB7CgoJCQkJCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdHMudXBkYXRlKCBvYmplY3QgKTsKCQkJCQkJY29uc3QgbWF0ZXJpYWwgPSBvYmplY3QubWF0ZXJpYWw7CgoJCQkJCQlpZiAoIHNvcnRPYmplY3RzICkgewoKCQkJCQkJCWlmICggb2JqZWN0LmJvdW5kaW5nU3BoZXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJCWlmICggb2JqZWN0LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgb2JqZWN0LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoJCQkJCQkJCV92ZWN0b3IzLmNvcHkoIG9iamVjdC5ib3VuZGluZ1NwaGVyZS5jZW50ZXIgKTsKCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgkJCQkJCQkJX3ZlY3RvcjMuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUuY2VudGVyICk7CgoJCQkJCQkJfQoKCQkJCQkJCV92ZWN0b3IzCgkJCQkJCQkJLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICkKCQkJCQkJCQkuYXBwbHlNYXRyaXg0KCBfcHJvalNjcmVlbk1hdHJpeCApOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQkJCWNvbnN0IGdyb3VwcyA9IGdlb21ldHJ5Lmdyb3VwczsKCgkJCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBncm91cHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQkJCQljb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbIGdyb3VwLm1hdGVyaWFsSW5kZXggXTsKCgkJCQkJCQkJaWYgKCBncm91cE1hdGVyaWFsICYmIGdyb3VwTWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnB1c2goIG9iamVjdCwgZ2VvbWV0cnksIGdyb3VwTWF0ZXJpYWwsIGdyb3VwT3JkZXIsIF92ZWN0b3IzLnosIGdyb3VwICk7CgoJCQkJCQkJCX0KCgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC52aXNpYmxlICkgewoKCQkJCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnB1c2goIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCBfdmVjdG9yMy56LCBudWxsICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJcHJvamVjdE9iamVjdCggY2hpbGRyZW5bIGkgXSwgY2FtZXJhLCBncm91cE9yZGVyLCBzb3J0T2JqZWN0cyApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlclNjZW5lKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSwgdmlld3BvcnQgKSB7CgoJCQljb25zdCBvcGFxdWVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3Qub3BhcXVlOwoJCQljb25zdCB0cmFuc21pc3NpdmVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3QudHJhbnNtaXNzaXZlOwoJCQljb25zdCB0cmFuc3BhcmVudE9iamVjdHMgPSBjdXJyZW50UmVuZGVyTGlzdC50cmFuc3BhcmVudDsKCgkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0c1ZpZXcoIGNhbWVyYSApOwoKCQkJaWYgKCBfY2xpcHBpbmdFbmFibGVkID09PSB0cnVlICkgY2xpcHBpbmcuc2V0R2xvYmFsU3RhdGUoIF90aGlzLmNsaXBwaW5nUGxhbmVzLCBjYW1lcmEgKTsKCgkJCWlmICggdHJhbnNtaXNzaXZlT2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyVHJhbnNtaXNzaW9uUGFzcyggb3BhcXVlT2JqZWN0cywgdHJhbnNtaXNzaXZlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKCQkJaWYgKCB2aWV3cG9ydCApIHN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0LmNvcHkoIHZpZXdwb3J0ICkgKTsKCgkJCWlmICggb3BhcXVlT2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyT2JqZWN0cyggb3BhcXVlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoJCQlpZiAoIHRyYW5zbWlzc2l2ZU9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlck9iamVjdHMoIHRyYW5zbWlzc2l2ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCQkJaWYgKCB0cmFuc3BhcmVudE9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlck9iamVjdHMoIHRyYW5zcGFyZW50T2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKCQkJLy8gRW5zdXJlIGRlcHRoIGJ1ZmZlciB3cml0aW5nIGlzIGVuYWJsZWQgc28gaXQgY2FuIGJlIGNsZWFyZWQgb24gbmV4dCByZW5kZXIKCgkJCXN0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0VGVzdCggdHJ1ZSApOwoJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldE1hc2soIHRydWUgKTsKCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRNYXNrKCB0cnVlICk7CgoJCQlzdGF0ZS5zZXRQb2x5Z29uT2Zmc2V0KCBmYWxzZSApOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlclRyYW5zbWlzc2lvblBhc3MoIG9wYXF1ZU9iamVjdHMsIHRyYW5zbWlzc2l2ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKSB7CgoJCQljb25zdCBvdmVycmlkZU1hdGVyaWFsID0gc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSA/IHNjZW5lLm92ZXJyaWRlTWF0ZXJpYWwgOiBudWxsOwoKCQkJaWYgKCBvdmVycmlkZU1hdGVyaWFsICE9PSBudWxsICkgewoKCQkJCXJldHVybjsKCgkJCX0KCgkJCWNvbnN0IGlzV2ViR0wyID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyOwoKCQkJaWYgKCBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ID09PSBudWxsICkgewoKCQkJCV90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoIDEsIDEsIHsKCQkJCQlnZW5lcmF0ZU1pcG1hcHM6IHRydWUsCgkJCQkJdHlwZTogZXh0ZW5zaW9ucy5oYXMoICdFWFRfY29sb3JfYnVmZmVyX2hhbGZfZmxvYXQnICkgPyBIYWxmRmxvYXRUeXBlIDogVW5zaWduZWRCeXRlVHlwZSwKCQkJCQltaW5GaWx0ZXI6IExpbmVhck1pcG1hcExpbmVhckZpbHRlciwKCQkJCQlzYW1wbGVzOiAoIGlzV2ViR0wyICkgPyA0IDogMAoJCQkJfSApOwoKCQkJCS8vIGRlYnVnCgoJCQkJLyoKCQkJCWNvbnN0IGdlb21ldHJ5ID0gbmV3IFBsYW5lR2VvbWV0cnkoKTsKCQkJCWNvbnN0IG1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7IG1hcDogX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldC50ZXh0dXJlIH0gKTsKCgkJCQljb25zdCBtZXNoID0gbmV3IE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoJCQkJc2NlbmUuYWRkKCBtZXNoICk7CgkJCQkqLwoKCQkJfQoKCQkJX3RoaXMuZ2V0RHJhd2luZ0J1ZmZlclNpemUoIF92ZWN0b3IyICk7CgoJCQlpZiAoIGlzV2ViR0wyICkgewoKCQkJCV90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuc2V0U2l6ZSggX3ZlY3RvcjIueCwgX3ZlY3RvcjIueSApOwoKCQkJfSBlbHNlIHsKCgkJCQlfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LnNldFNpemUoIGZsb29yUG93ZXJPZlR3byggX3ZlY3RvcjIueCApLCBmbG9vclBvd2VyT2ZUd28oIF92ZWN0b3IyLnkgKSApOwoKCQkJfQoKCQkJLy8KCgkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSBfdGhpcy5nZXRSZW5kZXJUYXJnZXQoKTsKCQkJX3RoaXMuc2V0UmVuZGVyVGFyZ2V0KCBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgoJCQlfdGhpcy5nZXRDbGVhckNvbG9yKCBfY3VycmVudENsZWFyQ29sb3IgKTsKCQkJX2N1cnJlbnRDbGVhckFscGhhID0gX3RoaXMuZ2V0Q2xlYXJBbHBoYSgpOwoJCQlpZiAoIF9jdXJyZW50Q2xlYXJBbHBoYSA8IDEgKSBfdGhpcy5zZXRDbGVhckNvbG9yKCAweGZmZmZmZiwgMC41ICk7CgoJCQlfdGhpcy5jbGVhcigpOwoKCQkJLy8gVHVybiBvZmYgdGhlIGZlYXR1cmVzIHdoaWNoIGNhbiBhZmZlY3QgdGhlIGZyYWcgY29sb3IgZm9yIG9wYXF1ZSBvYmplY3RzIHBhc3MuCgkJCS8vIE90aGVyd2lzZSB0aGV5IGFyZSBhcHBsaWVkIHR3aWNlIGluIG9wYXF1ZSBvYmplY3RzIHBhc3MgYW5kIHRyYW5zbWlzc2lvbiBvYmplY3RzIHBhc3MuCgkJCWNvbnN0IGN1cnJlbnRUb25lTWFwcGluZyA9IF90aGlzLnRvbmVNYXBwaW5nOwoJCQlfdGhpcy50b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgoJCQlyZW5kZXJPYmplY3RzKCBvcGFxdWVPYmplY3RzLCBzY2VuZSwgY2FtZXJhICk7CgoJCQl0ZXh0dXJlcy51cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldCggX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCApOwoJCQl0ZXh0dXJlcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAoIF90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCgkJCWxldCByZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdHJhbnNtaXNzaXZlT2JqZWN0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IHJlbmRlckl0ZW0gPSB0cmFuc21pc3NpdmVPYmplY3RzWyBpIF07CgoJCQkJY29uc3Qgb2JqZWN0ID0gcmVuZGVySXRlbS5vYmplY3Q7CgkJCQljb25zdCBnZW9tZXRyeSA9IHJlbmRlckl0ZW0uZ2VvbWV0cnk7CgkJCQljb25zdCBtYXRlcmlhbCA9IHJlbmRlckl0ZW0ubWF0ZXJpYWw7CgkJCQljb25zdCBncm91cCA9IHJlbmRlckl0ZW0uZ3JvdXA7CgoJCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlICYmIG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApICkgewoKCQkJCQljb25zdCBjdXJyZW50U2lkZSA9IG1hdGVyaWFsLnNpZGU7CgoJCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKCQkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCXJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICk7CgoJCQkJCW1hdGVyaWFsLnNpZGUgPSBjdXJyZW50U2lkZTsKCQkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCXJlbmRlclRhcmdldE5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHJlbmRlclRhcmdldE5lZWRzVXBkYXRlID09PSB0cnVlICkgewoKCQkJCXRleHR1cmVzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgkJCQl0ZXh0dXJlcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAoIF90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCgkJCX0KCgkJCV90aGlzLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCApOwoKCQkJX3RoaXMuc2V0Q2xlYXJDb2xvciggX2N1cnJlbnRDbGVhckNvbG9yLCBfY3VycmVudENsZWFyQWxwaGEgKTsKCgkJCV90aGlzLnRvbmVNYXBwaW5nID0gY3VycmVudFRvbmVNYXBwaW5nOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlck9iamVjdHMoIHJlbmRlckxpc3QsIHNjZW5lLCBjYW1lcmEgKSB7CgoJCQljb25zdCBvdmVycmlkZU1hdGVyaWFsID0gc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSA/IHNjZW5lLm92ZXJyaWRlTWF0ZXJpYWwgOiBudWxsOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gcmVuZGVyTGlzdC5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IHJlbmRlckl0ZW0gPSByZW5kZXJMaXN0WyBpIF07CgoJCQkJY29uc3Qgb2JqZWN0ID0gcmVuZGVySXRlbS5vYmplY3Q7CgkJCQljb25zdCBnZW9tZXRyeSA9IHJlbmRlckl0ZW0uZ2VvbWV0cnk7CgkJCQljb25zdCBtYXRlcmlhbCA9IG92ZXJyaWRlTWF0ZXJpYWwgPT09IG51bGwgPyByZW5kZXJJdGVtLm1hdGVyaWFsIDogb3ZlcnJpZGVNYXRlcmlhbDsKCQkJCWNvbnN0IGdyb3VwID0gcmVuZGVySXRlbS5ncm91cDsKCgkJCQlpZiAoIG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApICkgewoKCQkJCQlyZW5kZXJPYmplY3QoIG9iamVjdCwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZW5kZXJPYmplY3QoIG9iamVjdCwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApIHsKCgkJCW9iamVjdC5vbkJlZm9yZVJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCgkJCW9iamVjdC5tb2RlbFZpZXdNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSwgb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgkJCW9iamVjdC5ub3JtYWxNYXRyaXguZ2V0Tm9ybWFsTWF0cml4KCBvYmplY3QubW9kZWxWaWV3TWF0cml4ICk7CgoJCQltYXRlcmlhbC5vbkJlZm9yZVJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBvYmplY3QsIGdyb3VwICk7CgoJCQlpZiAoIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSB0cnVlICYmIG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUgJiYgbWF0ZXJpYWwuZm9yY2VTaW5nbGVQYXNzID09PSBmYWxzZSApIHsKCgkJCQltYXRlcmlhbC5zaWRlID0gQmFja1NpZGU7CgkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQlfdGhpcy5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgc2NlbmUsIGdlb21ldHJ5LCBtYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKCQkJCW1hdGVyaWFsLnNpZGUgPSBGcm9udFNpZGU7CgkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQlfdGhpcy5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgc2NlbmUsIGdlb21ldHJ5LCBtYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKCQkJCW1hdGVyaWFsLnNpZGUgPSBEb3VibGVTaWRlOwoKCQkJfSBlbHNlIHsKCgkJCQlfdGhpcy5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgc2NlbmUsIGdlb21ldHJ5LCBtYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKCQkJfQoKCQkJb2JqZWN0Lm9uQWZ0ZXJSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICk7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0UHJvZ3JhbSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKSB7CgoJCQlpZiAoIHNjZW5lLmlzU2NlbmUgIT09IHRydWUgKSBzY2VuZSA9IF9lbXB0eVNjZW5lOyAvLyBzY2VuZSBjb3VsZCBiZSBhIE1lc2gsIExpbmUsIFBvaW50cywgLi4uCgoJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCgkJCWNvbnN0IGxpZ2h0cyA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5saWdodHM7CgkJCWNvbnN0IHNoYWRvd3NBcnJheSA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5zaGFkb3dzQXJyYXk7CgoJCQljb25zdCBsaWdodHNTdGF0ZVZlcnNpb24gPSBsaWdodHMuc3RhdGUudmVyc2lvbjsKCgkJCWNvbnN0IHBhcmFtZXRlcnMgPSBwcm9ncmFtQ2FjaGUuZ2V0UGFyYW1ldGVycyggbWF0ZXJpYWwsIGxpZ2h0cy5zdGF0ZSwgc2hhZG93c0FycmF5LCBzY2VuZSwgb2JqZWN0ICk7CgkJCWNvbnN0IHByb2dyYW1DYWNoZUtleSA9IHByb2dyYW1DYWNoZS5nZXRQcm9ncmFtQ2FjaGVLZXkoIHBhcmFtZXRlcnMgKTsKCgkJCWxldCBwcm9ncmFtcyA9IG1hdGVyaWFsUHJvcGVydGllcy5wcm9ncmFtczsKCgkJCS8vIGFsd2F5cyB1cGRhdGUgZW52aXJvbm1lbnQgYW5kIGZvZyAtIGNoYW5naW5nIHRoZXNlIHRyaWdnZXIgYW4gZ2V0UHJvZ3JhbSBjYWxsLCBidXQgaXQncyBwb3NzaWJsZSB0aGF0IHRoZSBwcm9ncmFtIGRvZXNuJ3QgY2hhbmdlCgoJCQltYXRlcmlhbFByb3BlcnRpZXMuZW52aXJvbm1lbnQgPSBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gc2NlbmUuZW52aXJvbm1lbnQgOiBudWxsOwoJCQltYXRlcmlhbFByb3BlcnRpZXMuZm9nID0gc2NlbmUuZm9nOwoJCQltYXRlcmlhbFByb3BlcnRpZXMuZW52TWFwID0gKCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gY3ViZXV2bWFwcyA6IGN1YmVtYXBzICkuZ2V0KCBtYXRlcmlhbC5lbnZNYXAgfHwgbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudmlyb25tZW50ICk7CgoJCQlpZiAoIHByb2dyYW1zID09PSB1bmRlZmluZWQgKSB7CgoJCQkJLy8gbmV3IG1hdGVyaWFsCgoJCQkJbWF0ZXJpYWwuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbk1hdGVyaWFsRGlzcG9zZSApOwoKCQkJCXByb2dyYW1zID0gbmV3IE1hcCgpOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnByb2dyYW1zID0gcHJvZ3JhbXM7CgoJCQl9CgoJCQlsZXQgcHJvZ3JhbSA9IHByb2dyYW1zLmdldCggcHJvZ3JhbUNhY2hlS2V5ICk7CgoJCQlpZiAoIHByb2dyYW0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBlYXJseSBvdXQgaWYgcHJvZ3JhbSBhbmQgbGlnaHQgc3RhdGUgaXMgaWRlbnRpY2FsCgoJCQkJaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMuY3VycmVudFByb2dyYW0gPT09IHByb2dyYW0gJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0c1N0YXRlVmVyc2lvbiA9PT0gbGlnaHRzU3RhdGVWZXJzaW9uICkgewoKCQkJCQl1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICk7CgoJCQkJCXJldHVybiBwcm9ncmFtOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJcGFyYW1ldGVycy51bmlmb3JtcyA9IHByb2dyYW1DYWNoZS5nZXRVbmlmb3JtcyggbWF0ZXJpYWwgKTsKCgkJCQltYXRlcmlhbC5vbkJ1aWxkKCBvYmplY3QsIHBhcmFtZXRlcnMsIF90aGlzICk7CgoJCQkJbWF0ZXJpYWwub25CZWZvcmVDb21waWxlKCBwYXJhbWV0ZXJzLCBfdGhpcyApOwoKCQkJCXByb2dyYW0gPSBwcm9ncmFtQ2FjaGUuYWNxdWlyZVByb2dyYW0oIHBhcmFtZXRlcnMsIHByb2dyYW1DYWNoZUtleSApOwoJCQkJcHJvZ3JhbXMuc2V0KCBwcm9ncmFtQ2FjaGVLZXksIHByb2dyYW0gKTsKCgkJCQltYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXMgPSBwYXJhbWV0ZXJzLnVuaWZvcm1zOwoKCQkJfQoKCQkJY29uc3QgdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXM7CgoJCQlpZiAoICggISBtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICYmICEgbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHx8IG1hdGVyaWFsLmNsaXBwaW5nID09PSB0cnVlICkgewoKCQkJCXVuaWZvcm1zLmNsaXBwaW5nUGxhbmVzID0gY2xpcHBpbmcudW5pZm9ybTsKCgkJCX0KCgkJCXVwZGF0ZUNvbW1vbk1hdGVyaWFsUHJvcGVydGllcyggbWF0ZXJpYWwsIHBhcmFtZXRlcnMgKTsKCgkJCS8vIHN0b3JlIHRoZSBsaWdodCBzZXR1cCBpdCB3YXMgY3JlYXRlZCBmb3IKCgkJCW1hdGVyaWFsUHJvcGVydGllcy5uZWVkc0xpZ2h0cyA9IG1hdGVyaWFsTmVlZHNMaWdodHMoIG1hdGVyaWFsICk7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5saWdodHNTdGF0ZVZlcnNpb24gPSBsaWdodHNTdGF0ZVZlcnNpb247CgoJCQlpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5uZWVkc0xpZ2h0cyApIHsKCgkJCQkvLyB3aXJlIHVwIHRoZSBtYXRlcmlhbCB0byB0aGlzIHJlbmRlcmVyJ3MgbGlnaHRpbmcgc3RhdGUKCgkJCQl1bmlmb3Jtcy5hbWJpZW50TGlnaHRDb2xvci52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5hbWJpZW50OwoJCQkJdW5pZm9ybXMubGlnaHRQcm9iZS52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wcm9iZTsKCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsOwoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodFNoYWRvd3MudmFsdWUgPSBsaWdodHMuc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3c7CgkJCQl1bmlmb3Jtcy5zcG90TGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnNwb3Q7CgkJCQl1bmlmb3Jtcy5zcG90TGlnaHRTaGFkb3dzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnNwb3RTaGFkb3c7CgkJCQl1bmlmb3Jtcy5yZWN0QXJlYUxpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5yZWN0QXJlYTsKCQkJCXVuaWZvcm1zLmx0Y18xLnZhbHVlID0gbGlnaHRzLnN0YXRlLnJlY3RBcmVhTFRDMTsKCQkJCXVuaWZvcm1zLmx0Y18yLnZhbHVlID0gbGlnaHRzLnN0YXRlLnJlY3RBcmVhTFRDMjsKCQkJCXVuaWZvcm1zLnBvaW50TGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnBvaW50OwoJCQkJdW5pZm9ybXMucG9pbnRMaWdodFNoYWRvd3MudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3c7CgkJCQl1bmlmb3Jtcy5oZW1pc3BoZXJlTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmhlbWk7CgoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dNYXA7CgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbFNoYWRvd01hdHJpeC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hdHJpeDsKCQkJCXVuaWZvcm1zLnNwb3RTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdFNoYWRvd01hcDsKCQkJCXVuaWZvcm1zLnNwb3RMaWdodE1hdHJpeC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90TGlnaHRNYXRyaXg7CgkJCQl1bmlmb3Jtcy5zcG90TGlnaHRNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdExpZ2h0TWFwOwoJCQkJdW5pZm9ybXMucG9pbnRTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXA7CgkJCQl1bmlmb3Jtcy5wb2ludFNoYWRvd01hdHJpeC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludFNoYWRvd01hdHJpeDsKCQkJCS8vIFRPRE8gKGFiZWxuYXRpb24pOiBhZGQgYXJlYSBsaWdodHMgc2hhZG93IGluZm8gdG8gdW5pZm9ybXMKCgkJCX0KCgkJCW1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbSA9IHByb2dyYW07CgkJCW1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3QgPSBudWxsOwoKCQkJcmV0dXJuIHByb2dyYW07CgoJCX0KCgkJZnVuY3Rpb24gZ2V0VW5pZm9ybUxpc3QoIG1hdGVyaWFsUHJvcGVydGllcyApIHsKCgkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9PT0gbnVsbCApIHsKCgkJCQljb25zdCBwcm9nVW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMuY3VycmVudFByb2dyYW0uZ2V0VW5pZm9ybXMoKTsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3QgPSBXZWJHTFVuaWZvcm1zLnNlcVdpdGhWYWx1ZSggcHJvZ1VuaWZvcm1zLnNlcSwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zICk7CgoJCQl9CgoJCQlyZXR1cm4gbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdDsKCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICkgewoKCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgoJCQltYXRlcmlhbFByb3BlcnRpZXMub3V0cHV0Q29sb3JTcGFjZSA9IHBhcmFtZXRlcnMub3V0cHV0Q29sb3JTcGFjZTsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID0gcGFyYW1ldGVycy5iYXRjaGluZzsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmcgPSBwYXJhbWV0ZXJzLmluc3RhbmNpbmc7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPSBwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvcjsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnNraW5uaW5nID0gcGFyYW1ldGVycy5za2lubmluZzsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoVGFyZ2V0cyA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzOwoJCQltYXRlcmlhbFByb3BlcnRpZXMubW9ycGhOb3JtYWxzID0gcGFyYW1ldGVycy5tb3JwaE5vcm1hbHM7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5tb3JwaENvbG9ycyA9IHBhcmFtZXRlcnMubW9ycGhDb2xvcnM7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHNDb3VudCA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQ7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5udW1DbGlwcGluZ1BsYW5lcyA9IHBhcmFtZXRlcnMubnVtQ2xpcHBpbmdQbGFuZXM7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5udW1JbnRlcnNlY3Rpb24gPSBwYXJhbWV0ZXJzLm51bUNsaXBJbnRlcnNlY3Rpb247CgkJCW1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgPSBwYXJhbWV0ZXJzLnZlcnRleEFscGhhczsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnZlcnRleFRhbmdlbnRzID0gcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50czsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnRvbmVNYXBwaW5nID0gcGFyYW1ldGVycy50b25lTWFwcGluZzsKCgkJfQoKCQlmdW5jdGlvbiBzZXRQcm9ncmFtKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCApIHsKCgkJCWlmICggc2NlbmUuaXNTY2VuZSAhPT0gdHJ1ZSApIHNjZW5lID0gX2VtcHR5U2NlbmU7IC8vIHNjZW5lIGNvdWxkIGJlIGEgTWVzaCwgTGluZSwgUG9pbnRzLCAuLi4KCgkJCXRleHR1cmVzLnJlc2V0VGV4dHVyZVVuaXRzKCk7CgoJCQljb25zdCBmb2cgPSBzY2VuZS5mb2c7CgkJCWNvbnN0IGVudmlyb25tZW50ID0gbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IHNjZW5lLmVudmlyb25tZW50IDogbnVsbDsKCQkJY29uc3QgY29sb3JTcGFjZSA9ICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgKSA/IF90aGlzLm91dHB1dENvbG9yU3BhY2UgOiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgPyBfY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSApOwoJCQljb25zdCBlbnZNYXAgPSAoIG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBjdWJldXZtYXBzIDogY3ViZW1hcHMgKS5nZXQoIG1hdGVyaWFsLmVudk1hcCB8fCBlbnZpcm9ubWVudCApOwoJCQljb25zdCB2ZXJ0ZXhBbHBoYXMgPSBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMgPT09IHRydWUgJiYgISEgZ2VvbWV0cnkuYXR0cmlidXRlcy5jb2xvciAmJiBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yLml0ZW1TaXplID09PSA0OwoJCQljb25zdCB2ZXJ0ZXhUYW5nZW50cyA9ICEhIGdlb21ldHJ5LmF0dHJpYnV0ZXMudGFuZ2VudCAmJiAoICEhIG1hdGVyaWFsLm5vcm1hbE1hcCB8fCBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMCApOwoJCQljb25zdCBtb3JwaFRhcmdldHMgPSAhISBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CgkJCWNvbnN0IG1vcnBoTm9ybWFscyA9ICEhIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWw7CgkJCWNvbnN0IG1vcnBoQ29sb3JzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoKCQkJbGV0IHRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCgkJCWlmICggbWF0ZXJpYWwudG9uZU1hcHBlZCApIHsKCgkJCQlpZiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgKSB7CgoJCQkJCXRvbmVNYXBwaW5nID0gX3RoaXMudG9uZU1hcHBpbmc7CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCB8fCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3I7CgkJCWNvbnN0IG1vcnBoVGFyZ2V0c0NvdW50ID0gKCBtb3JwaEF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgPyBtb3JwaEF0dHJpYnV0ZS5sZW5ndGggOiAwOwoKCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgkJCWNvbnN0IGxpZ2h0cyA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5saWdodHM7CgoJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSB7CgoJCQkJaWYgKCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgfHwgY2FtZXJhICE9PSBfY3VycmVudENhbWVyYSApIHsKCgkJCQkJY29uc3QgdXNlQ2FjaGUgPQoJCQkJCQljYW1lcmEgPT09IF9jdXJyZW50Q2FtZXJhICYmCgkJCQkJCW1hdGVyaWFsLmlkID09PSBfY3VycmVudE1hdGVyaWFsSWQ7CgoJCQkJCS8vIHdlIG1pZ2h0IHdhbnQgdG8gY2FsbCB0aGlzIGZ1bmN0aW9uIHdpdGggc29tZSBDbGlwcGluZ0dyb3VwCgkJCQkJLy8gb2JqZWN0IGluc3RlYWQgb2YgdGhlIG1hdGVyaWFsLCBvbmNlIGl0IGJlY29tZXMgZmVhc2libGUKCQkJCQkvLyAoIzg0NjUsICM4Mzc5KQoJCQkJCWNsaXBwaW5nLnNldFN0YXRlKCBtYXRlcmlhbCwgY2FtZXJhLCB1c2VDYWNoZSApOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlsZXQgbmVlZHNQcm9ncmFtQ2hhbmdlID0gZmFsc2U7CgoJCQlpZiAoIG1hdGVyaWFsLnZlcnNpb24gPT09IG1hdGVyaWFsUHJvcGVydGllcy5fX3ZlcnNpb24gKSB7CgoJCQkJaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubmVlZHNMaWdodHMgJiYgKCBtYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uICE9PSBsaWdodHMuc3RhdGUudmVyc2lvbiApICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5vdXRwdXRDb2xvclNwYWNlICE9PSBjb2xvclNwYWNlICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0JhdGNoZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5iYXRjaGluZyA9PT0gZmFsc2UgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggISBvYmplY3QuaXNCYXRjaGVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuYmF0Y2hpbmcgPT09IHRydWUgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9PT0gZmFsc2UgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggISBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nID09PSB0cnVlICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1NraW5uZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5za2lubmluZyA9PT0gZmFsc2UgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggISBvYmplY3QuaXNTa2lubmVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPT09IHRydWUgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ0NvbG9yID09PSB0cnVlICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yID09PSBudWxsICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmdDb2xvciA9PT0gZmFsc2UgJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgIT09IG51bGwgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudk1hcCAhPT0gZW52TWFwICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmZvZyA9PT0gdHJ1ZSAmJiBtYXRlcmlhbFByb3BlcnRpZXMuZm9nICE9PSBmb2cgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUNsaXBwaW5nUGxhbmVzICE9PSB1bmRlZmluZWQgJiYKCQkJCQkoIG1hdGVyaWFsUHJvcGVydGllcy5udW1DbGlwcGluZ1BsYW5lcyAhPT0gY2xpcHBpbmcubnVtUGxhbmVzIHx8CgkJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUludGVyc2VjdGlvbiAhPT0gY2xpcHBpbmcubnVtSW50ZXJzZWN0aW9uICkgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnZlcnRleEFscGhhcyAhPT0gdmVydGV4QWxwaGFzICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhUYW5nZW50cyAhPT0gdmVydGV4VGFuZ2VudHMgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoVGFyZ2V0cyAhPT0gbW9ycGhUYXJnZXRzICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5tb3JwaE5vcm1hbHMgIT09IG1vcnBoTm9ybWFscyApIHsKCgkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhDb2xvcnMgIT09IG1vcnBoQ29sb3JzICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy50b25lTWFwcGluZyAhPT0gdG9uZU1hcHBpbmcgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyID09PSB0cnVlICYmIG1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHNDb3VudCAhPT0gbW9ycGhUYXJnZXRzQ291bnQgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9IG1hdGVyaWFsLnZlcnNpb247CgoJCQl9CgoJCQkvLwoKCQkJbGV0IHByb2dyYW0gPSBtYXRlcmlhbFByb3BlcnRpZXMuY3VycmVudFByb2dyYW07CgoJCQlpZiAoIG5lZWRzUHJvZ3JhbUNoYW5nZSA9PT0gdHJ1ZSApIHsKCgkJCQlwcm9ncmFtID0gZ2V0UHJvZ3JhbSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKTsKCgkJCX0KCgkJCWxldCByZWZyZXNoUHJvZ3JhbSA9IGZhbHNlOwoJCQlsZXQgcmVmcmVzaE1hdGVyaWFsID0gZmFsc2U7CgkJCWxldCByZWZyZXNoTGlnaHRzID0gZmFsc2U7CgoJCQljb25zdCBwX3VuaWZvcm1zID0gcHJvZ3JhbS5nZXRVbmlmb3JtcygpLAoJCQkJbV91bmlmb3JtcyA9IG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3JtczsKCgkJCWlmICggc3RhdGUudXNlUHJvZ3JhbSggcHJvZ3JhbS5wcm9ncmFtICkgKSB7CgoJCQkJcmVmcmVzaFByb2dyYW0gPSB0cnVlOwoJCQkJcmVmcmVzaE1hdGVyaWFsID0gdHJ1ZTsKCQkJCXJlZnJlc2hMaWdodHMgPSB0cnVlOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5pZCAhPT0gX2N1cnJlbnRNYXRlcmlhbElkICkgewoKCQkJCV9jdXJyZW50TWF0ZXJpYWxJZCA9IG1hdGVyaWFsLmlkOwoKCQkJCXJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CgoJCQl9CgoJCQlpZiAoIHJlZnJlc2hQcm9ncmFtIHx8IF9jdXJyZW50Q2FtZXJhICE9PSBjYW1lcmEgKSB7CgoJCQkJLy8gY29tbW9uIGNhbWVyYSB1bmlmb3JtcwoKCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ3Byb2plY3Rpb25NYXRyaXgnLCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApOwoJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAndmlld01hdHJpeCcsIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCgkJCQljb25zdCB1Q2FtUG9zID0gcF91bmlmb3Jtcy5tYXAuY2FtZXJhUG9zaXRpb247CgoJCQkJaWYgKCB1Q2FtUG9zICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXVDYW1Qb3Muc2V0VmFsdWUoIF9nbCwgX3ZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmEubWF0cml4V29ybGQgKSApOwoKCQkJCX0KCgkJCQlpZiAoIGNhcGFiaWxpdGllcy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICkgewoKCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdsb2dEZXB0aEJ1ZkZDJywKCQkJCQkJMi4wIC8gKCBNYXRoLmxvZyggY2FtZXJhLmZhciArIDEuMCApIC8gTWF0aC5MTjIgKSApOwoKCQkJCX0KCgkJCQkvLyBjb25zaWRlciBtb3ZpbmcgaXNPcnRob2dyYXBoaWMgdG8gVW5pZm9ybUxpYiBhbmQgV2ViR0xNYXRlcmlhbHMsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL3B1bGwvMjY0NjcjaXNzdWVjb21tZW50LTE2NDUxODUwNjcKCgkJCQlpZiAoIG1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5pc01lc2hCYXNpY01hdGVyaWFsIHx8CgkJCQkJbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCB8fAoJCQkJCW1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgKSB7CgoJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2lzT3J0aG9ncmFwaGljJywgY2FtZXJhLmlzT3J0aG9ncmFwaGljQ2FtZXJhID09PSB0cnVlICk7CgoJCQkJfQoKCQkJCWlmICggX2N1cnJlbnRDYW1lcmEgIT09IGNhbWVyYSApIHsKCgkJCQkJX2N1cnJlbnRDYW1lcmEgPSBjYW1lcmE7CgoJCQkJCS8vIGxpZ2h0aW5nIHVuaWZvcm1zIGRlcGVuZCBvbiB0aGUgY2FtZXJhIHNvIGVuZm9yY2UgYW4gdXBkYXRlCgkJCQkJLy8gbm93LCBpbiBjYXNlIHRoaXMgbWF0ZXJpYWwgc3VwcG9ydHMgbGlnaHRzIC0gb3IgbGF0ZXIsIHdoZW4KCQkJCQkvLyB0aGUgbmV4dCBtYXRlcmlhbCB0aGF0IGRvZXMgZ2V0cyBhY3RpdmF0ZWQ6CgoJCQkJCXJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CQkvLyBzZXQgdG8gdHJ1ZSBvbiBtYXRlcmlhbCBjaGFuZ2UKCQkJCQlyZWZyZXNoTGlnaHRzID0gdHJ1ZTsJCS8vIHJlbWFpbnMgc2V0IHVudGlsIHVwZGF0ZSBkb25lCgoJCQkJfQoKCQkJfQoKCQkJLy8gc2tpbm5pbmcgYW5kIG1vcnBoIHRhcmdldCB1bmlmb3JtcyBtdXN0IGJlIHNldCBldmVuIGlmIG1hdGVyaWFsIGRpZG4ndCBjaGFuZ2UKCQkJLy8gYXV0by1zZXR0aW5nIG9mIHRleHR1cmUgdW5pdCBmb3IgYm9uZSBhbmQgbW9ycGggdGV4dHVyZSBtdXN0IGdvIGJlZm9yZSBvdGhlciB0ZXh0dXJlcwoJCQkvLyBvdGhlcndpc2UgdGV4dHVyZXMgdXNlZCBmb3Igc2tpbm5pbmcgYW5kIG1vcnBoaW5nIGNhbiB0YWtlIG92ZXIgdGV4dHVyZSB1bml0cyByZXNlcnZlZCBmb3Igb3RoZXIgbWF0ZXJpYWwgdGV4dHVyZXMKCgkJCWlmICggb2JqZWN0LmlzU2tpbm5lZE1lc2ggKSB7CgoJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiaW5kTWF0cml4JyApOwoJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiaW5kTWF0cml4SW52ZXJzZScgKTsKCgkJCQljb25zdCBza2VsZXRvbiA9IG9iamVjdC5za2VsZXRvbjsKCgkJCQlpZiAoIHNrZWxldG9uICkgewoKCQkJCQlpZiAoIGNhcGFiaWxpdGllcy5mbG9hdFZlcnRleFRleHR1cmVzICkgewoKCQkJCQkJaWYgKCBza2VsZXRvbi5ib25lVGV4dHVyZSA9PT0gbnVsbCApIHNrZWxldG9uLmNvbXB1dGVCb25lVGV4dHVyZSgpOwoKCQkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnYm9uZVRleHR1cmUnLCBza2VsZXRvbi5ib25lVGV4dHVyZSwgdGV4dHVyZXMgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFNraW5uZWRNZXNoIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCBXZWJHTCAyLiBXaXRoIFdlYkdMIDEgT0VTX3RleHR1cmVfZmxvYXQgYW5kIHZlcnRleCB0ZXh0dXJlcyBzdXBwb3J0IGlzIHJlcXVpcmVkLicgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggKSB7CgoJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiYXRjaGluZ1RleHR1cmUnICk7CgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdiYXRjaGluZ1RleHR1cmUnLCBvYmplY3QuX21hdHJpY2VzVGV4dHVyZSwgdGV4dHVyZXMgKTsKCgkJCX0KCgkJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlczsKCgkJCWlmICggbW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQgfHwgbW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCAhPT0gdW5kZWZpbmVkIHx8ICggbW9ycGhBdHRyaWJ1dGVzLmNvbG9yICE9PSB1bmRlZmluZWQgJiYgY2FwYWJpbGl0aWVzLmlzV2ViR0wyID09PSB0cnVlICkgKSB7CgoJCQkJbW9ycGh0YXJnZXRzLnVwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSApOwoKCQkJfQoKCQkJaWYgKCByZWZyZXNoTWF0ZXJpYWwgfHwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnJlY2VpdmVTaGFkb3cgIT09IG9iamVjdC5yZWNlaXZlU2hhZG93ICkgewoKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5yZWNlaXZlU2hhZG93ID0gb2JqZWN0LnJlY2VpdmVTaGFkb3c7CgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdyZWNlaXZlU2hhZG93Jywgb2JqZWN0LnJlY2VpdmVTaGFkb3cgKTsKCgkJCX0KCgkJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvcHVsbC8yNDQ2NyNpc3N1ZWNvbW1lbnQtMTIwOTAzMTUxMgoKCQkJaWYgKCBtYXRlcmlhbC5pc01lc2hHb3VyYXVkTWF0ZXJpYWwgJiYgbWF0ZXJpYWwuZW52TWFwICE9PSBudWxsICkgewoKCQkJCW1fdW5pZm9ybXMuZW52TWFwLnZhbHVlID0gZW52TWFwOwoKCQkJCW1fdW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9ICggZW52TWFwLmlzQ3ViZVRleHR1cmUgJiYgZW52TWFwLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgKSA/IC0gMSA6IDE7CgoJCQl9CgoJCQlpZiAoIHJlZnJlc2hNYXRlcmlhbCApIHsKCgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICd0b25lTWFwcGluZ0V4cG9zdXJlJywgX3RoaXMudG9uZU1hcHBpbmdFeHBvc3VyZSApOwoKCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzICkgewoKCQkJCQkvLyB0aGUgY3VycmVudCBtYXRlcmlhbCByZXF1aXJlcyBsaWdodGluZyBpbmZvCgoJCQkJCS8vIG5vdGU6IGFsbCBsaWdodGluZyB1bmlmb3JtcyBhcmUgYWx3YXlzIHNldCBjb3JyZWN0bHkKCQkJCQkvLyB0aGV5IHNpbXBseSByZWZlcmVuY2UgdGhlIHJlbmRlcmVyJ3Mgc3RhdGUgZm9yIHRoZWlyCgkJCQkJLy8gdmFsdWVzCgkJCQkJLy8KCQkJCQkvLyB1c2UgdGhlIGN1cnJlbnQgbWF0ZXJpYWwncyAubmVlZHNVcGRhdGUgZmxhZ3MgdG8gc2V0CgkJCQkJLy8gdGhlIEdMIHN0YXRlIHdoZW4gcmVxdWlyZWQKCgkJCQkJbWFya1VuaWZvcm1zTGlnaHRzTmVlZHNVcGRhdGUoIG1fdW5pZm9ybXMsIHJlZnJlc2hMaWdodHMgKTsKCgkJCQl9CgoJCQkJLy8gcmVmcmVzaCB1bmlmb3JtcyBjb21tb24gdG8gc2V2ZXJhbCBtYXRlcmlhbHMKCgkJCQlpZiAoIGZvZyAmJiBtYXRlcmlhbC5mb2cgPT09IHRydWUgKSB7CgoJCQkJCW1hdGVyaWFscy5yZWZyZXNoRm9nVW5pZm9ybXMoIG1fdW5pZm9ybXMsIGZvZyApOwoKCQkJCX0KCgkJCQltYXRlcmlhbHMucmVmcmVzaE1hdGVyaWFsVW5pZm9ybXMoIG1fdW5pZm9ybXMsIG1hdGVyaWFsLCBfcGl4ZWxSYXRpbywgX2hlaWdodCwgX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCApOwoKCQkJCVdlYkdMVW5pZm9ybXMudXBsb2FkKCBfZ2wsIGdldFVuaWZvcm1MaXN0KCBtYXRlcmlhbFByb3BlcnRpZXMgKSwgbV91bmlmb3JtcywgdGV4dHVyZXMgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiBtYXRlcmlhbC51bmlmb3Jtc05lZWRVcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJV2ViR0xVbmlmb3Jtcy51cGxvYWQoIF9nbCwgZ2V0VW5pZm9ybUxpc3QoIG1hdGVyaWFsUHJvcGVydGllcyApLCBtX3VuaWZvcm1zLCB0ZXh0dXJlcyApOwoJCQkJbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmlzU3ByaXRlTWF0ZXJpYWwgKSB7CgoJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnY2VudGVyJywgb2JqZWN0LmNlbnRlciApOwoKCQkJfQoKCQkJLy8gY29tbW9uIG1hdHJpY2VzCgoJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdtb2RlbFZpZXdNYXRyaXgnLCBvYmplY3QubW9kZWxWaWV3TWF0cml4ICk7CgkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ25vcm1hbE1hdHJpeCcsIG9iamVjdC5ub3JtYWxNYXRyaXggKTsKCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnbW9kZWxNYXRyaXgnLCBvYmplY3QubWF0cml4V29ybGQgKTsKCgkJCS8vIFVCT3MKCgkJCWlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc1Jhd1NoYWRlck1hdGVyaWFsICkgewoKCQkJCWNvbnN0IGdyb3VwcyA9IG1hdGVyaWFsLnVuaWZvcm1zR3JvdXBzOwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHsKCgkJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgoJCQkJCQl1bmlmb3Jtc0dyb3Vwcy51cGRhdGUoIGdyb3VwLCBwcm9ncmFtICk7CgkJCQkJCXVuaWZvcm1zR3JvdXBzLmJpbmQoIGdyb3VwLCBwcm9ncmFtICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBVbmlmb3JtIEJ1ZmZlciBPYmplY3RzIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCBXZWJHTCAyLicgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBwcm9ncmFtOwoKCQl9CgoJCS8vIElmIHVuaWZvcm1zIGFyZSBtYXJrZWQgYXMgY2xlYW4sIHRoZXkgZG9uJ3QgbmVlZCB0byBiZSBsb2FkZWQgdG8gdGhlIEdQVS4KCgkJZnVuY3Rpb24gbWFya1VuaWZvcm1zTGlnaHRzTmVlZHNVcGRhdGUoIHVuaWZvcm1zLCB2YWx1ZSApIHsKCgkJCXVuaWZvcm1zLmFtYmllbnRMaWdodENvbG9yLm5lZWRzVXBkYXRlID0gdmFsdWU7CgkJCXVuaWZvcm1zLmxpZ2h0UHJvYmUubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCgkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CgkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzLm5lZWRzVXBkYXRlID0gdmFsdWU7CgkJCXVuaWZvcm1zLnBvaW50TGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CgkJCXVuaWZvcm1zLnBvaW50TGlnaHRTaGFkb3dzLm5lZWRzVXBkYXRlID0gdmFsdWU7CgkJCXVuaWZvcm1zLnNwb3RMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJdW5pZm9ybXMuc3BvdExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQl1bmlmb3Jtcy5yZWN0QXJlYUxpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQl1bmlmb3Jtcy5oZW1pc3BoZXJlTGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CgoJCX0KCgkJZnVuY3Rpb24gbWF0ZXJpYWxOZWVkc0xpZ2h0cyggbWF0ZXJpYWwgKSB7CgoJCQlyZXR1cm4gbWF0ZXJpYWwuaXNNZXNoTGFtYmVydE1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzTWVzaFRvb25NYXRlcmlhbCB8fCBtYXRlcmlhbC5pc01lc2hQaG9uZ01hdGVyaWFsIHx8CgkJCQltYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzU2hhZG93TWF0ZXJpYWwgfHwKCQkJCSggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiBtYXRlcmlhbC5saWdodHMgPT09IHRydWUgKTsKCgkJfQoKCQl0aGlzLmdldEFjdGl2ZUN1YmVGYWNlID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIF9jdXJyZW50QWN0aXZlQ3ViZUZhY2U7CgoJCX07CgoJCXRoaXMuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gX2N1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbDsKCgkJfTsKCgkJdGhpcy5nZXRSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gX2N1cnJlbnRSZW5kZXJUYXJnZXQ7CgoJCX07CgoJCXRoaXMuc2V0UmVuZGVyVGFyZ2V0VGV4dHVyZXMgPSBmdW5jdGlvbiAoIHJlbmRlclRhcmdldCwgY29sb3JUZXh0dXJlLCBkZXB0aFRleHR1cmUgKSB7CgoJCQlwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSA9IGNvbG9yVGV4dHVyZTsKCQkJcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSA9IGRlcHRoVGV4dHVyZTsKCgkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzID0gdHJ1ZTsKCgkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2hhc0V4dGVybmFsVGV4dHVyZXMgKSB7CgoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2F1dG9BbGxvY2F0ZURlcHRoQnVmZmVyID0gZGVwdGhUZXh0dXJlID09PSB1bmRlZmluZWQ7CgoJCQkJaWYgKCAhIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciApIHsKCgkJCQkJLy8gVGhlIG11bHRpc2FtcGxlX3JlbmRlcl90b190ZXh0dXJlIGV4dGVuc2lvbiBkb2Vzbid0IHdvcmsgcHJvcGVybHkgaWYgdGhlcmUKCQkJCQkvLyBhcmUgbWlkZnJhbWUgZmx1c2hlcyBhbmQgYW4gZXh0ZXJuYWwgZGVwdGggYnVmZmVyLiBEaXNhYmxlIHVzZSBvZiB0aGUgZXh0ZW5zaW9uLgoJCQkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgPT09IHRydWUgKSB7CgoJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBSZW5kZXItdG8tdGV4dHVyZSBleHRlbnNpb24gd2FzIGRpc2FibGVkIGJlY2F1c2UgYW4gZXh0ZXJuYWwgdGV4dHVyZSB3YXMgcHJvdmlkZWQnICk7CgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX191c2VSZW5kZXJUb1RleHR1cmUgPSBmYWxzZTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfTsKCgkJdGhpcy5zZXRSZW5kZXJUYXJnZXRGcmFtZWJ1ZmZlciA9IGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCBkZWZhdWx0RnJhbWVidWZmZXIgKSB7CgoJCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IGRlZmF1bHRGcmFtZWJ1ZmZlcjsKCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZURlZmF1bHRGcmFtZWJ1ZmZlciA9IGRlZmF1bHRGcmFtZWJ1ZmZlciA9PT0gdW5kZWZpbmVkOwoKCQl9OwoKCQl0aGlzLnNldFJlbmRlclRhcmdldCA9IGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCBhY3RpdmVDdWJlRmFjZSA9IDAsIGFjdGl2ZU1pcG1hcExldmVsID0gMCApIHsKCgkJCV9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoJCQlfY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gYWN0aXZlQ3ViZUZhY2U7CgkJCV9jdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSBhY3RpdmVNaXBtYXBMZXZlbDsKCgkJCWxldCB1c2VEZWZhdWx0RnJhbWVidWZmZXIgPSB0cnVlOwoJCQlsZXQgZnJhbWVidWZmZXIgPSBudWxsOwoJCQlsZXQgaXNDdWJlID0gZmFsc2U7CgkJCWxldCBpc1JlbmRlclRhcmdldDNEID0gZmFsc2U7CgoJCQlpZiAoIHJlbmRlclRhcmdldCApIHsKCgkJCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoKCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZURlZmF1bHRGcmFtZWJ1ZmZlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkvLyBXZSBuZWVkIHRvIG1ha2Ugc3VyZSB0byByZWJpbmQgdGhlIGZyYW1lYnVmZmVyLgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBudWxsICk7CgkJCQkJdXNlRGVmYXVsdEZyYW1lYnVmZmVyID0gZmFsc2U7CgoJCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdGV4dHVyZXMuc2V0dXBSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApOwoKCQkJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzICkgewoKCQkJCQkvLyBDb2xvciBhbmQgZGVwdGggdGV4dHVyZSBtdXN0IGJlIHJlYm91bmQgaW4gb3JkZXIgZm9yIHRoZSBzd2FwY2hhaW4gdG8gdXBkYXRlLgoJCQkJCXRleHR1cmVzLnJlYmluZFRleHR1cmVzKCByZW5kZXJUYXJnZXQsIHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQudGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlLCBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlICk7CgoJCQkJfQoKCQkJCWNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKCgkJCQlpZiAoIHRleHR1cmUuaXNEYXRhM0RUZXh0dXJlIHx8IHRleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlIHx8IHRleHR1cmUuaXNDb21wcmVzc2VkQXJyYXlUZXh0dXJlICkgewoKCQkJCQlpc1JlbmRlclRhcmdldDNEID0gdHJ1ZTsKCgkJCQl9CgoJCQkJY29uc3QgX193ZWJnbEZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApLl9fd2ViZ2xGcmFtZWJ1ZmZlcjsKCgkJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCApIHsKCgkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlIF0gKSApIHsKCgkJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZSBdWyBhY3RpdmVNaXBtYXBMZXZlbCBdOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlIF07CgoJCQkJCX0KCgkJCQkJaXNDdWJlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiAmJiByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgKSAmJiB0ZXh0dXJlcy51c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApID09PSBmYWxzZSApIHsKCgkJCQkJZnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggQXJyYXkuaXNBcnJheSggX193ZWJnbEZyYW1lYnVmZmVyICkgKSB7CgoJCQkJCQlmcmFtZWJ1ZmZlciA9IF9fd2ViZ2xGcmFtZWJ1ZmZlclsgYWN0aXZlTWlwbWFwTGV2ZWwgXTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJCQl9CgoJCQkJfQoKCQkJCV9jdXJyZW50Vmlld3BvcnQuY29weSggcmVuZGVyVGFyZ2V0LnZpZXdwb3J0ICk7CgkJCQlfY3VycmVudFNjaXNzb3IuY29weSggcmVuZGVyVGFyZ2V0LnNjaXNzb3IgKTsKCQkJCV9jdXJyZW50U2Npc3NvclRlc3QgPSByZW5kZXJUYXJnZXQuc2Npc3NvclRlc3Q7CgoJCQl9IGVsc2UgewoKCQkJCV9jdXJyZW50Vmlld3BvcnQuY29weSggX3ZpZXdwb3J0ICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkuZmxvb3IoKTsKCQkJCV9jdXJyZW50U2Npc3Nvci5jb3B5KCBfc2Npc3NvciApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApLmZsb29yKCk7CgkJCQlfY3VycmVudFNjaXNzb3JUZXN0ID0gX3NjaXNzb3JUZXN0OwoKCQkJfQoKCQkJY29uc3QgZnJhbWVidWZmZXJCb3VuZCA9IHN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBmcmFtZWJ1ZmZlciApOwoKCQkJaWYgKCBmcmFtZWJ1ZmZlckJvdW5kICYmIGNhcGFiaWxpdGllcy5kcmF3QnVmZmVycyAmJiB1c2VEZWZhdWx0RnJhbWVidWZmZXIgKSB7CgoJCQkJc3RhdGUuZHJhd0J1ZmZlcnMoIHJlbmRlclRhcmdldCwgZnJhbWVidWZmZXIgKTsKCgkJCX0KCgkJCXN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0ICk7CgkJCXN0YXRlLnNjaXNzb3IoIF9jdXJyZW50U2Npc3NvciApOwoJCQlzdGF0ZS5zZXRTY2lzc29yVGVzdCggX2N1cnJlbnRTY2lzc29yVGVzdCApOwoKCQkJaWYgKCBpc0N1YmUgKSB7CgoJCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKTsKCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBhY3RpdmVDdWJlRmFjZSwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGFjdGl2ZU1pcG1hcExldmVsICk7CgoJCQl9IGVsc2UgaWYgKCBpc1JlbmRlclRhcmdldDNEICkgewoKCQkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICk7CgkJCQljb25zdCBsYXllciA9IGFjdGl2ZUN1YmVGYWNlIHx8IDA7CgkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgYWN0aXZlTWlwbWFwTGV2ZWwgfHwgMCwgbGF5ZXIgKTsKCgkJCX0KCgkJCV9jdXJyZW50TWF0ZXJpYWxJZCA9IC0gMTsgLy8gcmVzZXQgY3VycmVudCBtYXRlcmlhbCB0byBlbnN1cmUgY29ycmVjdCB1bmlmb3JtIGJpbmRpbmdzCgoJCX07CgoJCXRoaXMucmVhZFJlbmRlclRhcmdldFBpeGVscyA9IGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBidWZmZXIsIGFjdGl2ZUN1YmVGYWNlSW5kZXggKSB7CgoJCQlpZiAoICEgKCByZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LmlzV2ViR0xSZW5kZXJUYXJnZXQgKSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZW5kZXJUYXJnZXQgaXMgbm90IFRIUkVFLldlYkdMUmVuZGVyVGFyZ2V0LicgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCWxldCBmcmFtZWJ1ZmZlciA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXI7CgoJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCAmJiBhY3RpdmVDdWJlRmFjZUluZGV4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZnJhbWVidWZmZXIgPSBmcmFtZWJ1ZmZlclsgYWN0aXZlQ3ViZUZhY2VJbmRleCBdOwoKCQkJfQoKCQkJaWYgKCBmcmFtZWJ1ZmZlciApIHsKCgkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCQl0cnkgewoKCQkJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgkJCQkJY29uc3QgdGV4dHVyZUZvcm1hdCA9IHRleHR1cmUuZm9ybWF0OwoJCQkJCWNvbnN0IHRleHR1cmVUeXBlID0gdGV4dHVyZS50eXBlOwoKCQkJCQlpZiAoIHRleHR1cmVGb3JtYXQgIT09IFJHQkFGb3JtYXQgJiYgdXRpbHMuY29udmVydCggdGV4dHVyZUZvcm1hdCApICE9PSBfZ2wuZ2V0UGFyYW1ldGVyKCBfZ2wuSU1QTEVNRU5UQVRJT05fQ09MT1JfUkVBRF9GT1JNQVQgKSApIHsKCgkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gUkdCQSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIGZvcm1hdC4nICk7CgkJCQkJCXJldHVybjsKCgkJCQkJfQoKCQkJCQljb25zdCBoYWxmRmxvYXRTdXBwb3J0ZWRCeUV4dCA9ICggdGV4dHVyZVR5cGUgPT09IEhhbGZGbG9hdFR5cGUgKSAmJiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9oYWxmX2Zsb2F0JyApIHx8ICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyICYmIGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKSApICk7CgoJCQkJCWlmICggdGV4dHVyZVR5cGUgIT09IFVuc2lnbmVkQnl0ZVR5cGUgJiYgdXRpbHMuY29udmVydCggdGV4dHVyZVR5cGUgKSAhPT0gX2dsLmdldFBhcmFtZXRlciggX2dsLklNUExFTUVOVEFUSU9OX0NPTE9SX1JFQURfVFlQRSApICYmIC8vIEVkZ2UgYW5kIENocm9tZSBNYWMgPCA1MiAoIzk1MTMpCgkJCQkJCSEgKCB0ZXh0dXJlVHlwZSA9PT0gRmxvYXRUeXBlICYmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyIHx8IGV4dGVuc2lvbnMuaGFzKCAnT0VTX3RleHR1cmVfZmxvYXQnICkgfHwgZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9jb2xvcl9idWZmZXJfZmxvYXQnICkgKSApICYmIC8vIENocm9tZSBNYWMgPj0gNTIgYW5kIEZpcmVmb3gKCQkJCQkJISBoYWxmRmxvYXRTdXBwb3J0ZWRCeUV4dCApIHsKCgkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gVW5zaWduZWRCeXRlVHlwZSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIHR5cGUuJyApOwoJCQkJCQlyZXR1cm47CgoJCQkJCX0KCgkJCQkJLy8gdGhlIGZvbGxvd2luZyBpZiBzdGF0ZW1lbnQgZW5zdXJlcyB2YWxpZCByZWFkIHJlcXVlc3RzIChubyBvdXQtb2YtYm91bmRzIHBpeGVscywgc2VlICM4NjA0KQoKCQkJCQlpZiAoICggeCA+PSAwICYmIHggPD0gKCByZW5kZXJUYXJnZXQud2lkdGggLSB3aWR0aCApICkgJiYgKCB5ID49IDAgJiYgeSA8PSAoIHJlbmRlclRhcmdldC5oZWlnaHQgLSBoZWlnaHQgKSApICkgewoKCQkJCQkJX2dsLnJlYWRQaXhlbHMoIHgsIHksIHdpZHRoLCBoZWlnaHQsIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVGb3JtYXQgKSwgdXRpbHMuY29udmVydCggdGV4dHVyZVR5cGUgKSwgYnVmZmVyICk7CgoJCQkJCX0KCgkJCQl9IGZpbmFsbHkgewoKCQkJCQkvLyByZXN0b3JlIGZyYW1lYnVmZmVyIG9mIGN1cnJlbnQgcmVuZGVyIHRhcmdldCBpZiBuZWNlc3NhcnkKCgkJCQkJY29uc3QgZnJhbWVidWZmZXIgPSAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgPyBwcm9wZXJ0aWVzLmdldCggX2N1cnJlbnRSZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXIgOiBudWxsOwoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBmcmFtZWJ1ZmZlciApOwoKCQkJCX0KCgkJCX0KCgkJfTsKCgkJdGhpcy5jb3B5RnJhbWVidWZmZXJUb1RleHR1cmUgPSBmdW5jdGlvbiAoIHBvc2l0aW9uLCB0ZXh0dXJlLCBsZXZlbCA9IDAgKSB7CgoJCQljb25zdCBsZXZlbFNjYWxlID0gTWF0aC5wb3coIDIsIC0gbGV2ZWwgKTsKCQkJY29uc3Qgd2lkdGggPSBNYXRoLmZsb29yKCB0ZXh0dXJlLmltYWdlLndpZHRoICogbGV2ZWxTY2FsZSApOwoJCQljb25zdCBoZWlnaHQgPSBNYXRoLmZsb29yKCB0ZXh0dXJlLmltYWdlLmhlaWdodCAqIGxldmVsU2NhbGUgKTsKCgkJCXRleHR1cmVzLnNldFRleHR1cmUyRCggdGV4dHVyZSwgMCApOwoKCQkJX2dsLmNvcHlUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWwsIDAsIDAsIHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJfTsKCgkJdGhpcy5jb3B5VGV4dHVyZVRvVGV4dHVyZSA9IGZ1bmN0aW9uICggcG9zaXRpb24sIHNyY1RleHR1cmUsIGRzdFRleHR1cmUsIGxldmVsID0gMCApIHsKCgkJCWNvbnN0IHdpZHRoID0gc3JjVGV4dHVyZS5pbWFnZS53aWR0aDsKCQkJY29uc3QgaGVpZ2h0ID0gc3JjVGV4dHVyZS5pbWFnZS5oZWlnaHQ7CgkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggZHN0VGV4dHVyZS5mb3JtYXQgKTsKCQkJY29uc3QgZ2xUeXBlID0gdXRpbHMuY29udmVydCggZHN0VGV4dHVyZS50eXBlICk7CgoJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlMkQoIGRzdFRleHR1cmUsIDAgKTsKCgkJCS8vIEFzIGFub3RoZXIgdGV4dHVyZSB1cGxvYWQgbWF5IGhhdmUgY2hhbmdlZCBwaXhlbFN0b3JlaQoJCQkvLyBwYXJhbWV0ZXJzLCBtYWtlIHN1cmUgdGhleSBhcmUgY29ycmVjdCBmb3IgdGhlIGRzdFRleHR1cmUKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZHN0VGV4dHVyZS5mbGlwWSApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGRzdFRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQUxJR05NRU5ULCBkc3RUZXh0dXJlLnVucGFja0FsaWdubWVudCApOwoKCQkJaWYgKCBzcmNUZXh0dXJlLmlzRGF0YVRleHR1cmUgKSB7CgoJCQkJX2dsLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbCwgcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgd2lkdGgsIGhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgc3JjVGV4dHVyZS5pbWFnZS5kYXRhICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggc3JjVGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlICkgewoKCQkJCQlfZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbCwgcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgc3JjVGV4dHVyZS5taXBtYXBzWyAwIF0ud2lkdGgsIHNyY1RleHR1cmUubWlwbWFwc1sgMCBdLmhlaWdodCwgZ2xGb3JtYXQsIHNyY1RleHR1cmUubWlwbWFwc1sgMCBdLmRhdGEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfZ2wudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVsLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBnbEZvcm1hdCwgZ2xUeXBlLCBzcmNUZXh0dXJlLmltYWdlICk7CgoJCQkJfQoKCQkJfQoKCQkJLy8gR2VuZXJhdGUgbWlwbWFwcyBvbmx5IHdoZW4gY29weWluZyBsZXZlbCAwCgkJCWlmICggbGV2ZWwgPT09IDAgJiYgZHN0VGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgKSBfZ2wuZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFXzJEICk7CgoJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCX07CgoJCXRoaXMuY29weVRleHR1cmVUb1RleHR1cmUzRCA9IGZ1bmN0aW9uICggc291cmNlQm94LCBwb3NpdGlvbiwgc3JjVGV4dHVyZSwgZHN0VGV4dHVyZSwgbGV2ZWwgPSAwICkgewoKCQkJaWYgKCBfdGhpcy5pc1dlYkdMMVJlbmRlcmVyICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXIuY29weVRleHR1cmVUb1RleHR1cmUzRDogY2FuIG9ubHkgYmUgdXNlZCB3aXRoIFdlYkdMMi4nICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQljb25zdCB3aWR0aCA9IHNvdXJjZUJveC5tYXgueCAtIHNvdXJjZUJveC5taW4ueCArIDE7CgkJCWNvbnN0IGhlaWdodCA9IHNvdXJjZUJveC5tYXgueSAtIHNvdXJjZUJveC5taW4ueSArIDE7CgkJCWNvbnN0IGRlcHRoID0gc291cmNlQm94Lm1heC56IC0gc291cmNlQm94Lm1pbi56ICsgMTsKCQkJY29uc3QgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCBkc3RUZXh0dXJlLmZvcm1hdCApOwoJCQljb25zdCBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCBkc3RUZXh0dXJlLnR5cGUgKTsKCQkJbGV0IGdsVGFyZ2V0OwoKCQkJaWYgKCBkc3RUZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCgkJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlM0QoIGRzdFRleHR1cmUsIDAgKTsKCQkJCWdsVGFyZ2V0ID0gX2dsLlRFWFRVUkVfM0Q7CgoJCQl9IGVsc2UgaWYgKCBkc3RUZXh0dXJlLmlzRGF0YUFycmF5VGV4dHVyZSB8fCBkc3RUZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCgkJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlMkRBcnJheSggZHN0VGV4dHVyZSwgMCApOwoJCQkJZ2xUYXJnZXQgPSBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5jb3B5VGV4dHVyZVRvVGV4dHVyZTNEOiBvbmx5IHN1cHBvcnRzIFRIUkVFLkRhdGFUZXh0dXJlM0QgYW5kIFRIUkVFLkRhdGFUZXh0dXJlMkRBcnJheS4nICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBkc3RUZXh0dXJlLmZsaXBZICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgZHN0VGV4dHVyZS5wcmVtdWx0aXBseUFscGhhICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19BTElHTk1FTlQsIGRzdFRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CgoJCQljb25zdCB1bnBhY2tSb3dMZW4gPSBfZ2wuZ2V0UGFyYW1ldGVyKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEggKTsKCQkJY29uc3QgdW5wYWNrSW1hZ2VIZWlnaHQgPSBfZ2wuZ2V0UGFyYW1ldGVyKCBfZ2wuVU5QQUNLX0lNQUdFX0hFSUdIVCApOwoJCQljb25zdCB1bnBhY2tTa2lwUGl4ZWxzID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19TS0lQX1BJWEVMUyApOwoJCQljb25zdCB1bnBhY2tTa2lwUm93cyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTICk7CgkJCWNvbnN0IHVucGFja1NraXBJbWFnZXMgPSBfZ2wuZ2V0UGFyYW1ldGVyKCBfZ2wuVU5QQUNLX1NLSVBfSU1BR0VTICk7CgoJCQljb25zdCBpbWFnZSA9IHNyY1RleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSA/IHNyY1RleHR1cmUubWlwbWFwc1sgbGV2ZWwgXSA6IHNyY1RleHR1cmUuaW1hZ2U7CgoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCwgaW1hZ2Uud2lkdGggKTsKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0lNQUdFX0hFSUdIVCwgaW1hZ2UuaGVpZ2h0ICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgc291cmNlQm94Lm1pbi54ICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1JPV1MsIHNvdXJjZUJveC5taW4ueSApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMsIHNvdXJjZUJveC5taW4ueiApOwoKCQkJaWYgKCBzcmNUZXh0dXJlLmlzRGF0YVRleHR1cmUgfHwgc3JjVGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgoJCQkJX2dsLnRleFN1YkltYWdlM0QoIGdsVGFyZ2V0LCBsZXZlbCwgcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCX0gZWxzZSB7CgoJCQkJaWYgKCBzcmNUZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5jb3B5VGV4dHVyZVRvVGV4dHVyZTNEOiB1bnRlc3RlZCBzdXBwb3J0IGZvciBjb21wcmVzc2VkIHNyY1RleHR1cmUuJyApOwoJCQkJCV9nbC5jb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGxldmVsLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56LCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGltYWdlLmRhdGEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfZ2wudGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGxldmVsLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56LCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCgkJCQl9CgoJCQl9CgoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCwgdW5wYWNrUm93TGVuICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19JTUFHRV9IRUlHSFQsIHVucGFja0ltYWdlSGVpZ2h0ICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgdW5wYWNrU2tpcFBpeGVscyApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTLCB1bnBhY2tTa2lwUm93cyApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMsIHVucGFja1NraXBJbWFnZXMgKTsKCgkJCS8vIEdlbmVyYXRlIG1pcG1hcHMgb25seSB3aGVuIGNvcHlpbmcgbGV2ZWwgMAoJCQlpZiAoIGxldmVsID09PSAwICYmIGRzdFRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzICkgX2dsLmdlbmVyYXRlTWlwbWFwKCBnbFRhcmdldCApOwoKCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKCQl9OwoKCQl0aGlzLmluaXRUZXh0dXJlID0gZnVuY3Rpb24gKCB0ZXh0dXJlICkgewoKCQkJaWYgKCB0ZXh0dXJlLmlzQ3ViZVRleHR1cmUgKSB7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmUoIHRleHR1cmUsIDAgKTsKCgkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNEYXRhM0RUZXh0dXJlICkgewoKCQkJCXRleHR1cmVzLnNldFRleHR1cmUzRCggdGV4dHVyZSwgMCApOwoKCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEQXJyYXkoIHRleHR1cmUsIDAgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCAwICk7CgoJCQl9CgoJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCX07CgoJCXRoaXMucmVzZXRTdGF0ZSA9IGZ1bmN0aW9uICgpIHsKCgkJCV9jdXJyZW50QWN0aXZlQ3ViZUZhY2UgPSAwOwoJCQlfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gMDsKCQkJX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwoKCQkJc3RhdGUucmVzZXQoKTsKCQkJYmluZGluZ1N0YXRlcy5yZXNldCgpOwoKCQl9OwoKCQlpZiAoIHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX18gIT09ICd1bmRlZmluZWQnICkgewoKCQkJX19USFJFRV9ERVZUT09MU19fLmRpc3BhdGNoRXZlbnQoIG5ldyBDdXN0b21FdmVudCggJ29ic2VydmUnLCB7IGRldGFpbDogdGhpcyB9ICkgKTsKCgkJfQoKCX0KCglnZXQgY29vcmRpbmF0ZVN5c3RlbSgpIHsKCgkJcmV0dXJuIFdlYkdMQ29vcmRpbmF0ZVN5c3RlbTsKCgl9CgoJZ2V0IG91dHB1dENvbG9yU3BhY2UoKSB7CgoJCXJldHVybiB0aGlzLl9vdXRwdXRDb2xvclNwYWNlOwoKCX0KCglzZXQgb3V0cHV0Q29sb3JTcGFjZSggY29sb3JTcGFjZSApIHsKCgkJdGhpcy5fb3V0cHV0Q29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CgoJCWNvbnN0IGdsID0gdGhpcy5nZXRDb250ZXh0KCk7CgkJZ2wuZHJhd2luZ0J1ZmZlckNvbG9yU3BhY2UgPSBjb2xvclNwYWNlID09PSBEaXNwbGF5UDNDb2xvclNwYWNlID8gJ2Rpc3BsYXktcDMnIDogJ3NyZ2InOwoJCWdsLnVucGFja0NvbG9yU3BhY2UgPSBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgPT09IExpbmVhckRpc3BsYXlQM0NvbG9yU3BhY2UgPyAnZGlzcGxheS1wMycgOiAnc3JnYic7CgoJfQoKCWdldCBvdXRwdXRFbmNvZGluZygpIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTIKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogUHJvcGVydHkgLm91dHB1dEVuY29kaW5nIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSAub3V0cHV0Q29sb3JTcGFjZSBpbnN0ZWFkLicgKTsKCQlyZXR1cm4gdGhpcy5vdXRwdXRDb2xvclNwYWNlID09PSBTUkdCQ29sb3JTcGFjZSA/IHNSR0JFbmNvZGluZyA6IExpbmVhckVuY29kaW5nOwoKCX0KCglzZXQgb3V0cHV0RW5jb2RpbmcoIGVuY29kaW5nICkgeyAvLyBAZGVwcmVjYXRlZCwgcjE1MgoKCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBQcm9wZXJ0eSAub3V0cHV0RW5jb2RpbmcgaGFzIGJlZW4gcmVtb3ZlZC4gVXNlIC5vdXRwdXRDb2xvclNwYWNlIGluc3RlYWQuJyApOwoJCXRoaXMub3V0cHV0Q29sb3JTcGFjZSA9IGVuY29kaW5nID09PSBzUkdCRW5jb2RpbmcgPyBTUkdCQ29sb3JTcGFjZSA6IExpbmVhclNSR0JDb2xvclNwYWNlOwoKCX0KCglnZXQgdXNlTGVnYWN5TGlnaHRzKCkgeyAvLyBAZGVwcmVjYXRlZCwgcjE1NQoKCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUaGUgcHJvcGVydHkgLnVzZUxlZ2FjeUxpZ2h0cyBoYXMgYmVlbiBkZXByZWNhdGVkLiBNaWdyYXRlIHlvdXIgbGlnaHRpbmcgYWNjb3JkaW5nIHRvIHRoZSBmb2xsb3dpbmcgZ3VpZGU6IGh0dHBzOi8vZGlzY291cnNlLnRocmVlanMub3JnL3QvdXBkYXRlcy10by1saWdodGluZy1pbi10aHJlZS1qcy1yMTU1LzUzNzMzLicgKTsKCQlyZXR1cm4gdGhpcy5fdXNlTGVnYWN5TGlnaHRzOwoKCX0KCglzZXQgdXNlTGVnYWN5TGlnaHRzKCB2YWx1ZSApIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTUKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGhlIHByb3BlcnR5IC51c2VMZWdhY3lMaWdodHMgaGFzIGJlZW4gZGVwcmVjYXRlZC4gTWlncmF0ZSB5b3VyIGxpZ2h0aW5nIGFjY29yZGluZyB0byB0aGUgZm9sbG93aW5nIGd1aWRlOiBodHRwczovL2Rpc2NvdXJzZS50aHJlZWpzLm9yZy90L3VwZGF0ZXMtdG8tbGlnaHRpbmctaW4tdGhyZWUtanMtcjE1NS81MzczMy4nICk7CgkJdGhpcy5fdXNlTGVnYWN5TGlnaHRzID0gdmFsdWU7CgoJfQoKfQoKY2xhc3MgV2ViR0wxUmVuZGVyZXIgZXh0ZW5kcyBXZWJHTFJlbmRlcmVyIHt9CgpXZWJHTDFSZW5kZXJlci5wcm90b3R5cGUuaXNXZWJHTDFSZW5kZXJlciA9IHRydWU7CgpjbGFzcyBGb2dFeHAyIHsKCgljb25zdHJ1Y3RvciggY29sb3IsIGRlbnNpdHkgPSAwLjAwMDI1ICkgewoKCQl0aGlzLmlzRm9nRXhwMiA9IHRydWU7CgoJCXRoaXMubmFtZSA9ICcnOwoKCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCBjb2xvciApOwoJCXRoaXMuZGVuc2l0eSA9IGRlbnNpdHk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IEZvZ0V4cDIoIHRoaXMuY29sb3IsIHRoaXMuZGVuc2l0eSApOwoKCX0KCgl0b0pTT04oIC8qIG1ldGEgKi8gKSB7CgoJCXJldHVybiB7CgkJCXR5cGU6ICdGb2dFeHAyJywKCQkJbmFtZTogdGhpcy5uYW1lLAoJCQljb2xvcjogdGhpcy5jb2xvci5nZXRIZXgoKSwKCQkJZGVuc2l0eTogdGhpcy5kZW5zaXR5CgkJfTsKCgl9Cgp9CgpjbGFzcyBGb2cgewoKCWNvbnN0cnVjdG9yKCBjb2xvciwgbmVhciA9IDEsIGZhciA9IDEwMDAgKSB7CgoJCXRoaXMuaXNGb2cgPSB0cnVlOwoKCQl0aGlzLm5hbWUgPSAnJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggY29sb3IgKTsKCgkJdGhpcy5uZWFyID0gbmVhcjsKCQl0aGlzLmZhciA9IGZhcjsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgRm9nKCB0aGlzLmNvbG9yLCB0aGlzLm5lYXIsIHRoaXMuZmFyICk7CgoJfQoKCXRvSlNPTiggLyogbWV0YSAqLyApIHsKCgkJcmV0dXJuIHsKCQkJdHlwZTogJ0ZvZycsCgkJCW5hbWU6IHRoaXMubmFtZSwKCQkJY29sb3I6IHRoaXMuY29sb3IuZ2V0SGV4KCksCgkJCW5lYXI6IHRoaXMubmVhciwKCQkJZmFyOiB0aGlzLmZhcgoJCX07CgoJfQoKfQoKY2xhc3MgU2NlbmUgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNTY2VuZSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdTY2VuZSc7CgoJCXRoaXMuYmFja2dyb3VuZCA9IG51bGw7CgkJdGhpcy5lbnZpcm9ubWVudCA9IG51bGw7CgkJdGhpcy5mb2cgPSBudWxsOwoKCQl0aGlzLmJhY2tncm91bmRCbHVycmluZXNzID0gMDsKCQl0aGlzLmJhY2tncm91bmRJbnRlbnNpdHkgPSAxOwoKCQl0aGlzLm92ZXJyaWRlTWF0ZXJpYWwgPSBudWxsOwoKCQlpZiAoIHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX18gIT09ICd1bmRlZmluZWQnICkgewoKCQkJX19USFJFRV9ERVZUT09MU19fLmRpc3BhdGNoRXZlbnQoIG5ldyBDdXN0b21FdmVudCggJ29ic2VydmUnLCB7IGRldGFpbDogdGhpcyB9ICkgKTsKCgkJfQoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJaWYgKCBzb3VyY2UuYmFja2dyb3VuZCAhPT0gbnVsbCApIHRoaXMuYmFja2dyb3VuZCA9IHNvdXJjZS5iYWNrZ3JvdW5kLmNsb25lKCk7CgkJaWYgKCBzb3VyY2UuZW52aXJvbm1lbnQgIT09IG51bGwgKSB0aGlzLmVudmlyb25tZW50ID0gc291cmNlLmVudmlyb25tZW50LmNsb25lKCk7CgkJaWYgKCBzb3VyY2UuZm9nICE9PSBudWxsICkgdGhpcy5mb2cgPSBzb3VyY2UuZm9nLmNsb25lKCk7CgoJCXRoaXMuYmFja2dyb3VuZEJsdXJyaW5lc3MgPSBzb3VyY2UuYmFja2dyb3VuZEJsdXJyaW5lc3M7CgkJdGhpcy5iYWNrZ3JvdW5kSW50ZW5zaXR5ID0gc291cmNlLmJhY2tncm91bmRJbnRlbnNpdHk7CgoJCWlmICggc291cmNlLm92ZXJyaWRlTWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLm92ZXJyaWRlTWF0ZXJpYWwgPSBzb3VyY2Uub3ZlcnJpZGVNYXRlcmlhbC5jbG9uZSgpOwoKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQlpZiAoIHRoaXMuZm9nICE9PSBudWxsICkgZGF0YS5vYmplY3QuZm9nID0gdGhpcy5mb2cudG9KU09OKCk7CgkJaWYgKCB0aGlzLmJhY2tncm91bmRCbHVycmluZXNzID4gMCApIGRhdGEub2JqZWN0LmJhY2tncm91bmRCbHVycmluZXNzID0gdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzczsKCQlpZiAoIHRoaXMuYmFja2dyb3VuZEludGVuc2l0eSAhPT0gMSApIGRhdGEub2JqZWN0LmJhY2tncm91bmRJbnRlbnNpdHkgPSB0aGlzLmJhY2tncm91bmRJbnRlbnNpdHk7CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNsYXNzIEludGVybGVhdmVkQnVmZmVyIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIHN0cmlkZSApIHsKCgkJdGhpcy5pc0ludGVybGVhdmVkQnVmZmVyID0gdHJ1ZTsKCgkJdGhpcy5hcnJheSA9IGFycmF5OwoJCXRoaXMuc3RyaWRlID0gc3RyaWRlOwoJCXRoaXMuY291bnQgPSBhcnJheSAhPT0gdW5kZWZpbmVkID8gYXJyYXkubGVuZ3RoIC8gc3RyaWRlIDogMDsKCgkJdGhpcy51c2FnZSA9IFN0YXRpY0RyYXdVc2FnZTsKCQl0aGlzLl91cGRhdGVSYW5nZSA9IHsgb2Zmc2V0OiAwLCBjb3VudDogLSAxIH07CgkJdGhpcy51cGRhdGVSYW5nZXMgPSBbXTsKCgkJdGhpcy52ZXJzaW9uID0gMDsKCgkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJfQoKCW9uVXBsb2FkQ2FsbGJhY2soKSB7fQoKCXNldCBuZWVkc1VwZGF0ZSggdmFsdWUgKSB7CgoJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgoJfQoKCWdldCB1cGRhdGVSYW5nZSgpIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuSW50ZXJsZWF2ZWRCdWZmZXI6IHVwZGF0ZVJhbmdlKCkgaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHIxNjkuIFVzZSBhZGRVcGRhdGVSYW5nZSgpIGluc3RlYWQuJyApOyAvLyBAZGVwcmVjYXRlZCwgcjE1OQoJCXJldHVybiB0aGlzLl91cGRhdGVSYW5nZTsKCgl9CgoJc2V0VXNhZ2UoIHZhbHVlICkgewoKCQl0aGlzLnVzYWdlID0gdmFsdWU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRVcGRhdGVSYW5nZSggc3RhcnQsIGNvdW50ICkgewoKCQl0aGlzLnVwZGF0ZVJhbmdlcy5wdXNoKCB7IHN0YXJ0LCBjb3VudCB9ICk7CgoJfQoKCWNsZWFyVXBkYXRlUmFuZ2VzKCkgewoKCQl0aGlzLnVwZGF0ZVJhbmdlcy5sZW5ndGggPSAwOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXRoaXMuYXJyYXkgPSBuZXcgc291cmNlLmFycmF5LmNvbnN0cnVjdG9yKCBzb3VyY2UuYXJyYXkgKTsKCQl0aGlzLmNvdW50ID0gc291cmNlLmNvdW50OwoJCXRoaXMuc3RyaWRlID0gc291cmNlLnN0cmlkZTsKCQl0aGlzLnVzYWdlID0gc291cmNlLnVzYWdlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weUF0KCBpbmRleDEsIGF0dHJpYnV0ZSwgaW5kZXgyICkgewoKCQlpbmRleDEgKj0gdGhpcy5zdHJpZGU7CgkJaW5kZXgyICo9IGF0dHJpYnV0ZS5zdHJpZGU7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuc3RyaWRlOyBpIDwgbDsgaSArKyApIHsKCgkJCXRoaXMuYXJyYXlbIGluZGV4MSArIGkgXSA9IGF0dHJpYnV0ZS5hcnJheVsgaW5kZXgyICsgaSBdOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXQoIHZhbHVlLCBvZmZzZXQgPSAwICkgewoKCQl0aGlzLmFycmF5LnNldCggdmFsdWUsIG9mZnNldCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoIGRhdGEgKSB7CgoJCWlmICggZGF0YS5hcnJheUJ1ZmZlcnMgPT09IHVuZGVmaW5lZCApIHsKCgkJCWRhdGEuYXJyYXlCdWZmZXJzID0ge307CgoJCX0KCgkJaWYgKCB0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCA9PT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5hcnJheS5idWZmZXIuX3V1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJfQoKCQlpZiAoIGRhdGEuYXJyYXlCdWZmZXJzWyB0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQlkYXRhLmFycmF5QnVmZmVyc1sgdGhpcy5hcnJheS5idWZmZXIuX3V1aWQgXSA9IHRoaXMuYXJyYXkuc2xpY2UoIDAgKS5idWZmZXI7CgoJCX0KCgkJY29uc3QgYXJyYXkgPSBuZXcgdGhpcy5hcnJheS5jb25zdHJ1Y3RvciggZGF0YS5hcnJheUJ1ZmZlcnNbIHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkIF0gKTsKCgkJY29uc3QgaWIgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvciggYXJyYXksIHRoaXMuc3RyaWRlICk7CgkJaWIuc2V0VXNhZ2UoIHRoaXMudXNhZ2UgKTsKCgkJcmV0dXJuIGliOwoKCX0KCglvblVwbG9hZCggY2FsbGJhY2sgKSB7CgoJCXRoaXMub25VcGxvYWRDYWxsYmFjayA9IGNhbGxiYWNrOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCBkYXRhICkgewoKCQlpZiAoIGRhdGEuYXJyYXlCdWZmZXJzID09PSB1bmRlZmluZWQgKSB7CgoJCQlkYXRhLmFycmF5QnVmZmVycyA9IHt9OwoKCQl9CgoJCS8vIGdlbmVyYXRlIFVVSUQgZm9yIGFycmF5IGJ1ZmZlciBpZiBuZWNlc3NhcnkKCgkJaWYgKCB0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCA9PT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5hcnJheS5idWZmZXIuX3V1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJfQoKCQlpZiAoIGRhdGEuYXJyYXlCdWZmZXJzWyB0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQlkYXRhLmFycmF5QnVmZmVyc1sgdGhpcy5hcnJheS5idWZmZXIuX3V1aWQgXSA9IEFycmF5LmZyb20oIG5ldyBVaW50MzJBcnJheSggdGhpcy5hcnJheS5idWZmZXIgKSApOwoKCQl9CgoJCS8vCgoJCXJldHVybiB7CgkJCXV1aWQ6IHRoaXMudXVpZCwKCQkJYnVmZmVyOiB0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCwKCQkJdHlwZTogdGhpcy5hcnJheS5jb25zdHJ1Y3Rvci5uYW1lLAoJCQlzdHJpZGU6IHRoaXMuc3RyaWRlCgkJfTsKCgl9Cgp9Cgpjb25zdCBfdmVjdG9yJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGludGVybGVhdmVkQnVmZmVyLCBpdGVtU2l6ZSwgb2Zmc2V0LCBub3JtYWxpemVkID0gZmFsc2UgKSB7CgoJCXRoaXMuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSA9IHRydWU7CgoJCXRoaXMubmFtZSA9ICcnOwoKCQl0aGlzLmRhdGEgPSBpbnRlcmxlYXZlZEJ1ZmZlcjsKCQl0aGlzLml0ZW1TaXplID0gaXRlbVNpemU7CgkJdGhpcy5vZmZzZXQgPSBvZmZzZXQ7CgoJCXRoaXMubm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQ7CgoJfQoKCWdldCBjb3VudCgpIHsKCgkJcmV0dXJuIHRoaXMuZGF0YS5jb3VudDsKCgl9CgoJZ2V0IGFycmF5KCkgewoKCQlyZXR1cm4gdGhpcy5kYXRhLmFycmF5OwoKCX0KCglzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKCQl0aGlzLmRhdGEubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCgl9CgoJYXBwbHlNYXRyaXg0KCBtICkgewoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmRhdGEuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJX3ZlY3RvciQ2LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCgkJCV92ZWN0b3IkNi5hcHBseU1hdHJpeDQoIG0gKTsKCgkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDYueCwgX3ZlY3RvciQ2LnksIF92ZWN0b3IkNi56ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5Tm9ybWFsTWF0cml4KCBtICkgewoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCgkJCV92ZWN0b3IkNi5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CgoJCQlfdmVjdG9yJDYuYXBwbHlOb3JtYWxNYXRyaXgoIG0gKTsKCgkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDYueCwgX3ZlY3RvciQ2LnksIF92ZWN0b3IkNi56ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyYW5zZm9ybURpcmVjdGlvbiggbSApIHsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQlfdmVjdG9yJDYuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdGhpcywgaSApOwoKCQkJX3ZlY3RvciQ2LnRyYW5zZm9ybURpcmVjdGlvbiggbSApOwoKCQkJdGhpcy5zZXRYWVooIGksIF92ZWN0b3IkNi54LCBfdmVjdG9yJDYueSwgX3ZlY3RvciQ2LnogKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WCggaW5kZXgsIHggKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeCA9IG5vcm1hbGl6ZSggeCwgdGhpcy5hcnJheSApOwoKCQl0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0IF0gPSB4OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WSggaW5kZXgsIHkgKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQl0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0ICsgMSBdID0geTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFooIGluZGV4LCB6ICkgewoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHogPSBub3JtYWxpemUoIHosIHRoaXMuYXJyYXkgKTsKCgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDIgXSA9IHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRXKCBpbmRleCwgdyApIHsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB3ID0gbm9ybWFsaXplKCB3LCB0aGlzLmFycmF5ICk7CgoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQgKyAzIF0gPSB3OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0WCggaW5kZXggKSB7CgoJCWxldCB4ID0gdGhpcy5kYXRhLmFycmF5WyBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCBdOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHggPSBkZW5vcm1hbGl6ZSggeCwgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4geDsKCgl9CgoJZ2V0WSggaW5kZXggKSB7CgoJCWxldCB5ID0gdGhpcy5kYXRhLmFycmF5WyBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDEgXTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB5ID0gZGVub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCgkJcmV0dXJuIHk7CgoJfQoKCWdldFooIGluZGV4ICkgewoKCQlsZXQgeiA9IHRoaXMuZGF0YS5hcnJheVsgaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQgKyAyIF07CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeiA9IGRlbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgoJCXJldHVybiB6OwoKCX0KCglnZXRXKCBpbmRleCApIHsKCgkJbGV0IHcgPSB0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0ICsgMyBdOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHcgPSBkZW5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4gdzsKCgl9CgoJc2V0WFkoIGluZGV4LCB4LCB5ICkgewoKCQlpbmRleCA9IGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0OwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQl9CgoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WFlaKCBpbmRleCwgeCwgeSwgeiApIHsKCgkJaW5kZXggPSBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldDsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgoJCQl4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgkJCXkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCQkJeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQl9CgoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAyIF0gPSB6OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WFlaVyggaW5kZXgsIHgsIHksIHosIHcgKSB7CgoJCWluZGV4ID0gaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQ7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgewoKCQkJeCA9IG5vcm1hbGl6ZSggeCwgdGhpcy5hcnJheSApOwoJCQl5ID0gbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgkJCXogPSBub3JtYWxpemUoIHosIHRoaXMuYXJyYXkgKTsKCQkJdyA9IG5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQl9CgoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAyIF0gPSB6OwoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyAzIF0gPSB3OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoIGRhdGEgKSB7CgoJCWlmICggZGF0YSA9PT0gdW5kZWZpbmVkICkgewoKCQkJY29uc29sZS5sb2coICdUSFJFRS5JbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZS5jbG9uZSgpOiBDbG9uaW5nIGFuIGludGVybGVhdmVkIGJ1ZmZlciBhdHRyaWJ1dGUgd2lsbCBkZS1pbnRlcmxlYXZlIGJ1ZmZlciBkYXRhLicgKTsKCgkJCWNvbnN0IGFycmF5ID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmNvdW50OyBpICsrICkgewoKCQkJCWNvbnN0IGluZGV4ID0gaSAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldDsKCgkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCB0aGlzLml0ZW1TaXplOyBqICsrICkgewoKCQkJCQlhcnJheS5wdXNoKCB0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICsgaiBdICk7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIG5ldyB0aGlzLmFycmF5LmNvbnN0cnVjdG9yKCBhcnJheSApLCB0aGlzLml0ZW1TaXplLCB0aGlzLm5vcm1hbGl6ZWQgKTsKCgkJfSBlbHNlIHsKCgkJCWlmICggZGF0YS5pbnRlcmxlYXZlZEJ1ZmZlcnMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlkYXRhLmludGVybGVhdmVkQnVmZmVycyA9IHt9OwoKCQkJfQoKCQkJaWYgKCBkYXRhLmludGVybGVhdmVkQnVmZmVyc1sgdGhpcy5kYXRhLnV1aWQgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzWyB0aGlzLmRhdGEudXVpZCBdID0gdGhpcy5kYXRhLmNsb25lKCBkYXRhICk7CgoJCQl9CgoJCQlyZXR1cm4gbmV3IEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKCBkYXRhLmludGVybGVhdmVkQnVmZmVyc1sgdGhpcy5kYXRhLnV1aWQgXSwgdGhpcy5pdGVtU2l6ZSwgdGhpcy5vZmZzZXQsIHRoaXMubm9ybWFsaXplZCApOwoKCQl9CgoJfQoKCXRvSlNPTiggZGF0YSApIHsKCgkJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgKSB7CgoJCQljb25zb2xlLmxvZyggJ1RIUkVFLkludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlLnRvSlNPTigpOiBTZXJpYWxpemluZyBhbiBpbnRlcmxlYXZlZCBidWZmZXIgYXR0cmlidXRlIHdpbGwgZGUtaW50ZXJsZWF2ZSBidWZmZXIgZGF0YS4nICk7CgoJCQljb25zdCBhcnJheSA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5jb3VudDsgaSArKyApIHsKCgkJCQljb25zdCBpbmRleCA9IGkgKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQ7CgoJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgdGhpcy5pdGVtU2l6ZTsgaiArKyApIHsKCgkJCQkJYXJyYXkucHVzaCggdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIGogXSApOwoKCQkJCX0KCgkJCX0KCgkJCS8vIGRlLWludGVybGVhdmUgZGF0YSBhbmQgc2F2ZSBpdCBhcyBhbiBvcmRpbmFyeSBidWZmZXIgYXR0cmlidXRlIGZvciBub3cKCgkJCXJldHVybiB7CgkJCQlpdGVtU2l6ZTogdGhpcy5pdGVtU2l6ZSwKCQkJCXR5cGU6IHRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSwKCQkJCWFycmF5OiBhcnJheSwKCQkJCW5vcm1hbGl6ZWQ6IHRoaXMubm9ybWFsaXplZAoJCQl9OwoKCQl9IGVsc2UgewoKCQkJLy8gc2F2ZSBhcyB0cnVlIGludGVybGVhdmVkIGF0dHJpYnV0ZQoKCQkJaWYgKCBkYXRhLmludGVybGVhdmVkQnVmZmVycyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzID0ge307CgoJCQl9CgoJCQlpZiAoIGRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzWyB0aGlzLmRhdGEudXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJZGF0YS5pbnRlcmxlYXZlZEJ1ZmZlcnNbIHRoaXMuZGF0YS51dWlkIF0gPSB0aGlzLmRhdGEudG9KU09OKCBkYXRhICk7CgoJCQl9CgoJCQlyZXR1cm4gewoJCQkJaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZTogdHJ1ZSwKCQkJCWl0ZW1TaXplOiB0aGlzLml0ZW1TaXplLAoJCQkJZGF0YTogdGhpcy5kYXRhLnV1aWQsCgkJCQlvZmZzZXQ6IHRoaXMub2Zmc2V0LAoJCQkJbm9ybWFsaXplZDogdGhpcy5ub3JtYWxpemVkCgkJCX07CgoJCX0KCgl9Cgp9CgpjbGFzcyBTcHJpdGVNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1Nwcml0ZU1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1Nwcml0ZU1hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmFscGhhTWFwID0gbnVsbDsKCgkJdGhpcy5yb3RhdGlvbiA9IDA7CgoJCXRoaXMuc2l6ZUF0dGVudWF0aW9uID0gdHJ1ZTsKCgkJdGhpcy50cmFuc3BhcmVudCA9IHRydWU7CgoJCXRoaXMuZm9nID0gdHJ1ZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5jb2xvci5jb3B5KCBzb3VyY2UuY29sb3IgKTsKCgkJdGhpcy5tYXAgPSBzb3VyY2UubWFwOwoKCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKCQl0aGlzLnJvdGF0aW9uID0gc291cmNlLnJvdGF0aW9uOwoKCQl0aGlzLnNpemVBdHRlbnVhdGlvbiA9IHNvdXJjZS5zaXplQXR0ZW51YXRpb247CgoJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKbGV0IF9nZW9tZXRyeTsKCmNvbnN0IF9pbnRlcnNlY3RQb2ludCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3dvcmxkU2NhbGUgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9tdlBvc2l0aW9uID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY29uc3QgX2FsaWduZWRQb3NpdGlvbiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoKTsKY29uc3QgX3JvdGF0ZWRQb3NpdGlvbiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoKTsKY29uc3QgX3ZpZXdXb3JsZE1hdHJpeCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKCmNvbnN0IF92QSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZCID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdkMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgpjb25zdCBfdXZBID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwpjb25zdCBfdXZCID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwpjb25zdCBfdXZDID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwoKY2xhc3MgU3ByaXRlIGV4dGVuZHMgT2JqZWN0M0QgewoKCWNvbnN0cnVjdG9yKCBtYXRlcmlhbCA9IG5ldyBTcHJpdGVNYXRlcmlhbCgpICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzU3ByaXRlID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1Nwcml0ZSc7CgoJCWlmICggX2dlb21ldHJ5ID09PSB1bmRlZmluZWQgKSB7CgoJCQlfZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJCWNvbnN0IGZsb2F0MzJBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIFsKCQkJCS0gMC41LCAtIDAuNSwgMCwgMCwgMCwKCQkJCTAuNSwgLSAwLjUsIDAsIDEsIDAsCgkJCQkwLjUsIDAuNSwgMCwgMSwgMSwKCQkJCS0gMC41LCAwLjUsIDAsIDAsIDEKCQkJXSApOwoKCQkJY29uc3QgaW50ZXJsZWF2ZWRCdWZmZXIgPSBuZXcgSW50ZXJsZWF2ZWRCdWZmZXIoIGZsb2F0MzJBcnJheSwgNSApOwoKCQkJX2dlb21ldHJ5LnNldEluZGV4KCBbIDAsIDEsIDIsCTAsIDIsIDMgXSApOwoJCQlfZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUoIGludGVybGVhdmVkQnVmZmVyLCAzLCAwLCBmYWxzZSApICk7CgkJCV9nZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaW50ZXJsZWF2ZWRCdWZmZXIsIDIsIDMsIGZhbHNlICkgKTsKCgkJfQoKCQl0aGlzLmdlb21ldHJ5ID0gX2dlb21ldHJ5OwoJCXRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbDsKCgkJdGhpcy5jZW50ZXIgPSBuZXcgVmVjdG9yMiggMC41LCAwLjUgKTsKCgl9CgoJcmF5Y2FzdCggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzICkgewoKCQlpZiAoIHJheWNhc3Rlci5jYW1lcmEgPT09IG51bGwgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuU3ByaXRlOiAiUmF5Y2FzdGVyLmNhbWVyYSIgbmVlZHMgdG8gYmUgc2V0IGluIG9yZGVyIHRvIHJheWNhc3QgYWdhaW5zdCBzcHJpdGVzLicgKTsKCgkJfQoKCQlfd29ybGRTY2FsZS5zZXRGcm9tTWF0cml4U2NhbGUoIHRoaXMubWF0cml4V29ybGQgKTsKCgkJX3ZpZXdXb3JsZE1hdHJpeC5jb3B5KCByYXljYXN0ZXIuY2FtZXJhLm1hdHJpeFdvcmxkICk7CgkJdGhpcy5tb2RlbFZpZXdNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggcmF5Y2FzdGVyLmNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UsIHRoaXMubWF0cml4V29ybGQgKTsKCgkJX212UG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1vZGVsVmlld01hdHJpeCApOwoKCQlpZiAoIHJheWNhc3Rlci5jYW1lcmEuaXNQZXJzcGVjdGl2ZUNhbWVyYSAmJiB0aGlzLm1hdGVyaWFsLnNpemVBdHRlbnVhdGlvbiA9PT0gZmFsc2UgKSB7CgoJCQlfd29ybGRTY2FsZS5tdWx0aXBseVNjYWxhciggLSBfbXZQb3NpdGlvbi56ICk7CgoJCX0KCgkJY29uc3Qgcm90YXRpb24gPSB0aGlzLm1hdGVyaWFsLnJvdGF0aW9uOwoJCWxldCBzaW4sIGNvczsKCgkJaWYgKCByb3RhdGlvbiAhPT0gMCApIHsKCgkJCWNvcyA9IE1hdGguY29zKCByb3RhdGlvbiApOwoJCQlzaW4gPSBNYXRoLnNpbiggcm90YXRpb24gKTsKCgkJfQoKCQljb25zdCBjZW50ZXIgPSB0aGlzLmNlbnRlcjsKCgkJdHJhbnNmb3JtVmVydGV4KCBfdkEuc2V0KCAtIDAuNSwgLSAwLjUsIDAgKSwgX212UG9zaXRpb24sIGNlbnRlciwgX3dvcmxkU2NhbGUsIHNpbiwgY29zICk7CgkJdHJhbnNmb3JtVmVydGV4KCBfdkIuc2V0KCAwLjUsIC0gMC41LCAwICksIF9tdlBvc2l0aW9uLCBjZW50ZXIsIF93b3JsZFNjYWxlLCBzaW4sIGNvcyApOwoJCXRyYW5zZm9ybVZlcnRleCggX3ZDLnNldCggMC41LCAwLjUsIDAgKSwgX212UG9zaXRpb24sIGNlbnRlciwgX3dvcmxkU2NhbGUsIHNpbiwgY29zICk7CgoJCV91dkEuc2V0KCAwLCAwICk7CgkJX3V2Qi5zZXQoIDEsIDAgKTsKCQlfdXZDLnNldCggMSwgMSApOwoKCQkvLyBjaGVjayBmaXJzdCB0cmlhbmdsZQoJCWxldCBpbnRlcnNlY3QgPSByYXljYXN0ZXIucmF5LmludGVyc2VjdFRyaWFuZ2xlKCBfdkEsIF92QiwgX3ZDLCBmYWxzZSwgX2ludGVyc2VjdFBvaW50ICk7CgoJCWlmICggaW50ZXJzZWN0ID09PSBudWxsICkgewoKCQkJLy8gY2hlY2sgc2Vjb25kIHRyaWFuZ2xlCgkJCXRyYW5zZm9ybVZlcnRleCggX3ZCLnNldCggLSAwLjUsIDAuNSwgMCApLCBfbXZQb3NpdGlvbiwgY2VudGVyLCBfd29ybGRTY2FsZSwgc2luLCBjb3MgKTsKCQkJX3V2Qi5zZXQoIDAsIDEgKTsKCgkJCWludGVyc2VjdCA9IHJheWNhc3Rlci5yYXkuaW50ZXJzZWN0VHJpYW5nbGUoIF92QSwgX3ZDLCBfdkIsIGZhbHNlLCBfaW50ZXJzZWN0UG9pbnQgKTsKCQkJaWYgKCBpbnRlcnNlY3QgPT09IG51bGwgKSB7CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQl9CgoJCWNvbnN0IGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyggX2ludGVyc2VjdFBvaW50ICk7CgoJCWlmICggZGlzdGFuY2UgPCByYXljYXN0ZXIubmVhciB8fCBkaXN0YW5jZSA+IHJheWNhc3Rlci5mYXIgKSByZXR1cm47CgoJCWludGVyc2VjdHMucHVzaCggewoKCQkJZGlzdGFuY2U6IGRpc3RhbmNlLAoJCQlwb2ludDogX2ludGVyc2VjdFBvaW50LmNsb25lKCksCgkJCXV2OiBUcmlhbmdsZS5nZXRJbnRlcnBvbGF0aW9uKCBfaW50ZXJzZWN0UG9pbnQsIF92QSwgX3ZCLCBfdkMsIF91dkEsIF91dkIsIF91dkMsIG5ldyBWZWN0b3IyKCkgKSwKCQkJZmFjZTogbnVsbCwKCQkJb2JqZWN0OiB0aGlzCgoJCX0gKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCWlmICggc291cmNlLmNlbnRlciAhPT0gdW5kZWZpbmVkICkgdGhpcy5jZW50ZXIuY29weSggc291cmNlLmNlbnRlciApOwoKCQl0aGlzLm1hdGVyaWFsID0gc291cmNlLm1hdGVyaWFsOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpmdW5jdGlvbiB0cmFuc2Zvcm1WZXJ0ZXgoIHZlcnRleFBvc2l0aW9uLCBtdlBvc2l0aW9uLCBjZW50ZXIsIHNjYWxlLCBzaW4sIGNvcyApIHsKCgkvLyBjb21wdXRlIHBvc2l0aW9uIGluIGNhbWVyYSBzcGFjZQoJX2FsaWduZWRQb3NpdGlvbi5zdWJWZWN0b3JzKCB2ZXJ0ZXhQb3NpdGlvbiwgY2VudGVyICkuYWRkU2NhbGFyKCAwLjUgKS5tdWx0aXBseSggc2NhbGUgKTsKCgkvLyB0byBjaGVjayBpZiByb3RhdGlvbiBpcyBub3QgemVybwoJaWYgKCBzaW4gIT09IHVuZGVmaW5lZCApIHsKCgkJX3JvdGF0ZWRQb3NpdGlvbi54ID0gKCBjb3MgKiBfYWxpZ25lZFBvc2l0aW9uLnggKSAtICggc2luICogX2FsaWduZWRQb3NpdGlvbi55ICk7CgkJX3JvdGF0ZWRQb3NpdGlvbi55ID0gKCBzaW4gKiBfYWxpZ25lZFBvc2l0aW9uLnggKSArICggY29zICogX2FsaWduZWRQb3NpdGlvbi55ICk7CgoJfSBlbHNlIHsKCgkJX3JvdGF0ZWRQb3NpdGlvbi5jb3B5KCBfYWxpZ25lZFBvc2l0aW9uICk7CgoJfQoKCgl2ZXJ0ZXhQb3NpdGlvbi5jb3B5KCBtdlBvc2l0aW9uICk7Cgl2ZXJ0ZXhQb3NpdGlvbi54ICs9IF9yb3RhdGVkUG9zaXRpb24ueDsKCXZlcnRleFBvc2l0aW9uLnkgKz0gX3JvdGF0ZWRQb3NpdGlvbi55OwoKCS8vIHRyYW5zZm9ybSB0byB3b3JsZCBzcGFjZQoJdmVydGV4UG9zaXRpb24uYXBwbHlNYXRyaXg0KCBfdmlld1dvcmxkTWF0cml4ICk7Cgp9Cgpjb25zdCBfdjEkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3YyJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBMT0QgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuX2N1cnJlbnRMZXZlbCA9IDA7CgoJCXRoaXMudHlwZSA9ICdMT0QnOwoKCQlPYmplY3QuZGVmaW5lUHJvcGVydGllcyggdGhpcywgewoJCQlsZXZlbHM6IHsKCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQl2YWx1ZTogW10KCQkJfSwKCQkJaXNMT0Q6IHsKCQkJCXZhbHVlOiB0cnVlLAoJCQl9CgkJfSApOwoKCQl0aGlzLmF1dG9VcGRhdGUgPSB0cnVlOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgZmFsc2UgKTsKCgkJY29uc3QgbGV2ZWxzID0gc291cmNlLmxldmVsczsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBsZXZlbCA9IGxldmVsc1sgaSBdOwoKCQkJdGhpcy5hZGRMZXZlbCggbGV2ZWwub2JqZWN0LmNsb25lKCksIGxldmVsLmRpc3RhbmNlLCBsZXZlbC5oeXN0ZXJlc2lzICk7CgoJCX0KCgkJdGhpcy5hdXRvVXBkYXRlID0gc291cmNlLmF1dG9VcGRhdGU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRMZXZlbCggb2JqZWN0LCBkaXN0YW5jZSA9IDAsIGh5c3RlcmVzaXMgPSAwICkgewoKCQlkaXN0YW5jZSA9IE1hdGguYWJzKCBkaXN0YW5jZSApOwoKCQljb25zdCBsZXZlbHMgPSB0aGlzLmxldmVsczsKCgkJbGV0IGw7CgoJCWZvciAoIGwgPSAwOyBsIDwgbGV2ZWxzLmxlbmd0aDsgbCArKyApIHsKCgkJCWlmICggZGlzdGFuY2UgPCBsZXZlbHNbIGwgXS5kaXN0YW5jZSApIHsKCgkJCQlicmVhazsKCgkJCX0KCgkJfQoKCQlsZXZlbHMuc3BsaWNlKCBsLCAwLCB7IGRpc3RhbmNlOiBkaXN0YW5jZSwgaHlzdGVyZXNpczogaHlzdGVyZXNpcywgb2JqZWN0OiBvYmplY3QgfSApOwoKCQl0aGlzLmFkZCggb2JqZWN0ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRDdXJyZW50TGV2ZWwoKSB7CgoJCXJldHVybiB0aGlzLl9jdXJyZW50TGV2ZWw7CgoJfQoKCgoJZ2V0T2JqZWN0Rm9yRGlzdGFuY2UoIGRpc3RhbmNlICkgewoKCQljb25zdCBsZXZlbHMgPSB0aGlzLmxldmVsczsKCgkJaWYgKCBsZXZlbHMubGVuZ3RoID4gMCApIHsKCgkJCWxldCBpLCBsOwoKCQkJZm9yICggaSA9IDEsIGwgPSBsZXZlbHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQlsZXQgbGV2ZWxEaXN0YW5jZSA9IGxldmVsc1sgaSBdLmRpc3RhbmNlOwoKCQkJCWlmICggbGV2ZWxzWyBpIF0ub2JqZWN0LnZpc2libGUgKSB7CgoJCQkJCWxldmVsRGlzdGFuY2UgLT0gbGV2ZWxEaXN0YW5jZSAqIGxldmVsc1sgaSBdLmh5c3RlcmVzaXM7CgoJCQkJfQoKCQkJCWlmICggZGlzdGFuY2UgPCBsZXZlbERpc3RhbmNlICkgewoKCQkJCQlicmVhazsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gbGV2ZWxzWyBpIC0gMSBdLm9iamVjdDsKCgkJfQoKCQlyZXR1cm4gbnVsbDsKCgl9CgoJcmF5Y2FzdCggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzICkgewoKCQljb25zdCBsZXZlbHMgPSB0aGlzLmxldmVsczsKCgkJaWYgKCBsZXZlbHMubGVuZ3RoID4gMCApIHsKCgkJCV92MSQyLnNldEZyb21NYXRyaXhQb3NpdGlvbiggdGhpcy5tYXRyaXhXb3JsZCApOwoKCQkJY29uc3QgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKCBfdjEkMiApOwoKCQkJdGhpcy5nZXRPYmplY3RGb3JEaXN0YW5jZSggZGlzdGFuY2UgKS5yYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKTsKCgkJfQoKCX0KCgl1cGRhdGUoIGNhbWVyYSApIHsKCgkJY29uc3QgbGV2ZWxzID0gdGhpcy5sZXZlbHM7CgoJCWlmICggbGV2ZWxzLmxlbmd0aCA+IDEgKSB7CgoJCQlfdjEkMi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGNhbWVyYS5tYXRyaXhXb3JsZCApOwoJCQlfdjIkMS5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubWF0cml4V29ybGQgKTsKCgkJCWNvbnN0IGRpc3RhbmNlID0gX3YxJDIuZGlzdGFuY2VUbyggX3YyJDEgKSAvIGNhbWVyYS56b29tOwoKCQkJbGV2ZWxzWyAwIF0ub2JqZWN0LnZpc2libGUgPSB0cnVlOwoKCQkJbGV0IGksIGw7CgoJCQlmb3IgKCBpID0gMSwgbCA9IGxldmVscy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWxldCBsZXZlbERpc3RhbmNlID0gbGV2ZWxzWyBpIF0uZGlzdGFuY2U7CgoJCQkJaWYgKCBsZXZlbHNbIGkgXS5vYmplY3QudmlzaWJsZSApIHsKCgkJCQkJbGV2ZWxEaXN0YW5jZSAtPSBsZXZlbERpc3RhbmNlICogbGV2ZWxzWyBpIF0uaHlzdGVyZXNpczsKCgkJCQl9CgoJCQkJaWYgKCBkaXN0YW5jZSA+PSBsZXZlbERpc3RhbmNlICkgewoKCQkJCQlsZXZlbHNbIGkgLSAxIF0ub2JqZWN0LnZpc2libGUgPSBmYWxzZTsKCQkJCQlsZXZlbHNbIGkgXS5vYmplY3QudmlzaWJsZSA9IHRydWU7CgoJCQkJfSBlbHNlIHsKCgkJCQkJYnJlYWs7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5fY3VycmVudExldmVsID0gaSAtIDE7CgoJCQlmb3IgKCA7IGkgPCBsOyBpICsrICkgewoKCQkJCWxldmVsc1sgaSBdLm9iamVjdC52aXNpYmxlID0gZmFsc2U7CgoJCQl9CgoJCX0KCgl9CgoJdG9KU09OKCBtZXRhICkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCBtZXRhICk7CgoJCWlmICggdGhpcy5hdXRvVXBkYXRlID09PSBmYWxzZSApIGRhdGEub2JqZWN0LmF1dG9VcGRhdGUgPSBmYWxzZTsKCgkJZGF0YS5vYmplY3QubGV2ZWxzID0gW107CgoJCWNvbnN0IGxldmVscyA9IHRoaXMubGV2ZWxzOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBsZXZlbHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGxldmVsID0gbGV2ZWxzWyBpIF07CgoJCQlkYXRhLm9iamVjdC5sZXZlbHMucHVzaCggewoJCQkJb2JqZWN0OiBsZXZlbC5vYmplY3QudXVpZCwKCQkJCWRpc3RhbmNlOiBsZXZlbC5kaXN0YW5jZSwKCQkJCWh5c3RlcmVzaXM6IGxldmVsLmh5c3RlcmVzaXMKCQkJfSApOwoKCQl9CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNvbnN0IF9iYXNlUG9zaXRpb24gPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgpjb25zdCBfc2tpbkluZGV4ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yNCgpOwpjb25zdCBfc2tpbldlaWdodCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjQoKTsKCmNvbnN0IF92ZWN0b3IzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfbWF0cml4NCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX3ZlcnRleCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9zcGhlcmUkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFNwaGVyZSgpOwpjb25zdCBfaW52ZXJzZU1hdHJpeCQyID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwpjb25zdCBfcmF5JDIgPSAvKkBfX1BVUkVfXyovIG5ldyBSYXkoKTsKCmNsYXNzIFNraW5uZWRNZXNoIGV4dGVuZHMgTWVzaCB7CgoJY29uc3RydWN0b3IoIGdlb21ldHJ5LCBtYXRlcmlhbCApIHsKCgkJc3VwZXIoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLmlzU2tpbm5lZE1lc2ggPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnU2tpbm5lZE1lc2gnOwoKCQl0aGlzLmJpbmRNb2RlID0gQXR0YWNoZWRCaW5kTW9kZTsKCQl0aGlzLmJpbmRNYXRyaXggPSBuZXcgTWF0cml4NCgpOwoJCXRoaXMuYmluZE1hdHJpeEludmVyc2UgPSBuZXcgTWF0cml4NCgpOwoKCQl0aGlzLmJvdW5kaW5nQm94ID0gbnVsbDsKCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gbnVsbDsKCgl9CgoJY29tcHV0ZUJvdW5kaW5nQm94KCkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgoJCWlmICggdGhpcy5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCgkJCXRoaXMuYm91bmRpbmdCb3ggPSBuZXcgQm94MygpOwoKCQl9CgoJCXRoaXMuYm91bmRpbmdCb3gubWFrZUVtcHR5KCk7CgoJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCAncG9zaXRpb24nICk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50OyBpICsrICkgewoKCQkJdGhpcy5nZXRWZXJ0ZXhQb3NpdGlvbiggaSwgX3ZlcnRleCApOwoJCQl0aGlzLmJvdW5kaW5nQm94LmV4cGFuZEJ5UG9pbnQoIF92ZXJ0ZXggKTsKCgkJfQoKCX0KCgljb21wdXRlQm91bmRpbmdTcGhlcmUoKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCgkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgewoKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG5ldyBTcGhlcmUoKTsKCgkJfQoKCQl0aGlzLmJvdW5kaW5nU3BoZXJlLm1ha2VFbXB0eSgpOwoKCQljb25zdCBwb3NpdGlvbkF0dHJpYnV0ZSA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudDsgaSArKyApIHsKCgkJCXRoaXMuZ2V0VmVydGV4UG9zaXRpb24oIGksIF92ZXJ0ZXggKTsKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5leHBhbmRCeVBvaW50KCBfdmVydGV4ICk7CgoJCX0KCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMuYmluZE1vZGUgPSBzb3VyY2UuYmluZE1vZGU7CgkJdGhpcy5iaW5kTWF0cml4LmNvcHkoIHNvdXJjZS5iaW5kTWF0cml4ICk7CgkJdGhpcy5iaW5kTWF0cml4SW52ZXJzZS5jb3B5KCBzb3VyY2UuYmluZE1hdHJpeEludmVyc2UgKTsKCgkJdGhpcy5za2VsZXRvbiA9IHNvdXJjZS5za2VsZXRvbjsKCgkJaWYgKCBzb3VyY2UuYm91bmRpbmdCb3ggIT09IG51bGwgKSB0aGlzLmJvdW5kaW5nQm94ID0gc291cmNlLmJvdW5kaW5nQm94LmNsb25lKCk7CgkJaWYgKCBzb3VyY2UuYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB0aGlzLmJvdW5kaW5nU3BoZXJlID0gc291cmNlLmJvdW5kaW5nU3BoZXJlLmNsb25lKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgoJCWNvbnN0IG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKCQljb25zdCBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CgoJCWlmICggbWF0ZXJpYWwgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJLy8gdGVzdCB3aXRoIGJvdW5kaW5nIHNwaGVyZSBpbiB3b3JsZCBzcGFjZQoKCQlpZiAoIHRoaXMuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSB0aGlzLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQlfc3BoZXJlJDQuY29weSggdGhpcy5ib3VuZGluZ1NwaGVyZSApOwoJCV9zcGhlcmUkNC5hcHBseU1hdHJpeDQoIG1hdHJpeFdvcmxkICk7CgoJCWlmICggcmF5Y2FzdGVyLnJheS5pbnRlcnNlY3RzU3BoZXJlKCBfc3BoZXJlJDQgKSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCS8vIGNvbnZlcnQgcmF5IHRvIGxvY2FsIHNwYWNlIG9mIHNraW5uZWQgbWVzaAoKCQlfaW52ZXJzZU1hdHJpeCQyLmNvcHkoIG1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgkJX3JheSQyLmNvcHkoIHJheWNhc3Rlci5yYXkgKS5hcHBseU1hdHJpeDQoIF9pbnZlcnNlTWF0cml4JDIgKTsKCgkJLy8gdGVzdCB3aXRoIGJvdW5kaW5nIGJveCBpbiBsb2NhbCBzcGFjZQoKCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQlpZiAoIF9yYXkkMi5pbnRlcnNlY3RzQm94KCB0aGlzLmJvdW5kaW5nQm94ICkgPT09IGZhbHNlICkgcmV0dXJuOwoKCQl9CgoJCS8vIHRlc3QgZm9yIGludGVyc2VjdGlvbnMgd2l0aCBnZW9tZXRyeQoKCQl0aGlzLl9jb21wdXRlSW50ZXJzZWN0aW9ucyggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCBfcmF5JDIgKTsKCgl9CgoJZ2V0VmVydGV4UG9zaXRpb24oIGluZGV4LCB0YXJnZXQgKSB7CgoJCXN1cGVyLmdldFZlcnRleFBvc2l0aW9uKCBpbmRleCwgdGFyZ2V0ICk7CgoJCXRoaXMuYXBwbHlCb25lVHJhbnNmb3JtKCBpbmRleCwgdGFyZ2V0ICk7CgoJCXJldHVybiB0YXJnZXQ7CgoJfQoKCWJpbmQoIHNrZWxldG9uLCBiaW5kTWF0cml4ICkgewoKCQl0aGlzLnNrZWxldG9uID0gc2tlbGV0b247CgoJCWlmICggYmluZE1hdHJpeCA9PT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy51cGRhdGVNYXRyaXhXb3JsZCggdHJ1ZSApOwoKCQkJdGhpcy5za2VsZXRvbi5jYWxjdWxhdGVJbnZlcnNlcygpOwoKCQkJYmluZE1hdHJpeCA9IHRoaXMubWF0cml4V29ybGQ7CgoJCX0KCgkJdGhpcy5iaW5kTWF0cml4LmNvcHkoIGJpbmRNYXRyaXggKTsKCQl0aGlzLmJpbmRNYXRyaXhJbnZlcnNlLmNvcHkoIGJpbmRNYXRyaXggKS5pbnZlcnQoKTsKCgl9CgoJcG9zZSgpIHsKCgkJdGhpcy5za2VsZXRvbi5wb3NlKCk7CgoJfQoKCW5vcm1hbGl6ZVNraW5XZWlnaHRzKCkgewoKCQljb25zdCB2ZWN0b3IgPSBuZXcgVmVjdG9yNCgpOwoKCQljb25zdCBza2luV2VpZ2h0ID0gdGhpcy5nZW9tZXRyeS5hdHRyaWJ1dGVzLnNraW5XZWlnaHQ7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHNraW5XZWlnaHQuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJdmVjdG9yLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHNraW5XZWlnaHQsIGkgKTsKCgkJCWNvbnN0IHNjYWxlID0gMS4wIC8gdmVjdG9yLm1hbmhhdHRhbkxlbmd0aCgpOwoKCQkJaWYgKCBzY2FsZSAhPT0gSW5maW5pdHkgKSB7CgoJCQkJdmVjdG9yLm11bHRpcGx5U2NhbGFyKCBzY2FsZSApOwoKCQkJfSBlbHNlIHsKCgkJCQl2ZWN0b3Iuc2V0KCAxLCAwLCAwLCAwICk7IC8vIGRvIHNvbWV0aGluZyByZWFzb25hYmxlCgoJCQl9CgoJCQlza2luV2VpZ2h0LnNldFhZWlcoIGksIHZlY3Rvci54LCB2ZWN0b3IueSwgdmVjdG9yLnosIHZlY3Rvci53ICk7CgoJCX0KCgl9CgoJdXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICkgewoKCQlzdXBlci51cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKTsKCgkJaWYgKCB0aGlzLmJpbmRNb2RlID09PSBBdHRhY2hlZEJpbmRNb2RlICkgewoKCQkJdGhpcy5iaW5kTWF0cml4SW52ZXJzZS5jb3B5KCB0aGlzLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgoJCX0gZWxzZSBpZiAoIHRoaXMuYmluZE1vZGUgPT09IERldGFjaGVkQmluZE1vZGUgKSB7CgoJCQl0aGlzLmJpbmRNYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMuYmluZE1hdHJpeCApLmludmVydCgpOwoKCQl9IGVsc2UgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuU2tpbm5lZE1lc2g6IFVucmVjb2duaXplZCBiaW5kTW9kZTogJyArIHRoaXMuYmluZE1vZGUgKTsKCgkJfQoKCX0KCglhcHBseUJvbmVUcmFuc2Zvcm0oIGluZGV4LCB2ZWN0b3IgKSB7CgoJCWNvbnN0IHNrZWxldG9uID0gdGhpcy5za2VsZXRvbjsKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgoJCV9za2luSW5kZXguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggZ2VvbWV0cnkuYXR0cmlidXRlcy5za2luSW5kZXgsIGluZGV4ICk7CgkJX3NraW5XZWlnaHQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggZ2VvbWV0cnkuYXR0cmlidXRlcy5za2luV2VpZ2h0LCBpbmRleCApOwoKCQlfYmFzZVBvc2l0aW9uLmNvcHkoIHZlY3RvciApLmFwcGx5TWF0cml4NCggdGhpcy5iaW5kTWF0cml4ICk7CgoJCXZlY3Rvci5zZXQoIDAsIDAsIDAgKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgNDsgaSArKyApIHsKCgkJCWNvbnN0IHdlaWdodCA9IF9za2luV2VpZ2h0LmdldENvbXBvbmVudCggaSApOwoKCQkJaWYgKCB3ZWlnaHQgIT09IDAgKSB7CgoJCQkJY29uc3QgYm9uZUluZGV4ID0gX3NraW5JbmRleC5nZXRDb21wb25lbnQoIGkgKTsKCgkJCQlfbWF0cml4NC5tdWx0aXBseU1hdHJpY2VzKCBza2VsZXRvbi5ib25lc1sgYm9uZUluZGV4IF0ubWF0cml4V29ybGQsIHNrZWxldG9uLmJvbmVJbnZlcnNlc1sgYm9uZUluZGV4IF0gKTsKCgkJCQl2ZWN0b3IuYWRkU2NhbGVkVmVjdG9yKCBfdmVjdG9yMy5jb3B5KCBfYmFzZVBvc2l0aW9uICkuYXBwbHlNYXRyaXg0KCBfbWF0cml4NCApLCB3ZWlnaHQgKTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdmVjdG9yLmFwcGx5TWF0cml4NCggdGhpcy5iaW5kTWF0cml4SW52ZXJzZSApOwoKCX0KCglib25lVHJhbnNmb3JtKCBpbmRleCwgdmVjdG9yICkgeyAvLyBAZGVwcmVjYXRlZCwgcjE1MQoKCQljb25zb2xlLndhcm4oICdUSFJFRS5Ta2lubmVkTWVzaDogLmJvbmVUcmFuc2Zvcm0oKSB3YXMgcmVuYW1lZCB0byAuYXBwbHlCb25lVHJhbnNmb3JtKCkgaW4gcjE1MS4nICk7CgkJcmV0dXJuIHRoaXMuYXBwbHlCb25lVHJhbnNmb3JtKCBpbmRleCwgdmVjdG9yICk7CgoJfQoKCn0KCmNsYXNzIEJvbmUgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNCb25lID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0JvbmUnOwoKCX0KCn0KCmNsYXNzIERhdGFUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsLCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGZvcm1hdCwgdHlwZSwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIgPSBOZWFyZXN0RmlsdGVyLCBtaW5GaWx0ZXIgPSBOZWFyZXN0RmlsdGVyLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICkgewoKCQlzdXBlciggbnVsbCwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICk7CgoJCXRoaXMuaXNEYXRhVGV4dHVyZSA9IHRydWU7CgoJCXRoaXMuaW1hZ2UgPSB7IGRhdGE6IGRhdGEsIHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfTsKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCQl0aGlzLmZsaXBZID0gZmFsc2U7CgkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSAxOwoKCX0KCn0KCmNvbnN0IF9vZmZzZXRNYXRyaXggPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9pZGVudGl0eU1hdHJpeCQxID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKY2xhc3MgU2tlbGV0b24gewoKCWNvbnN0cnVjdG9yKCBib25lcyA9IFtdLCBib25lSW52ZXJzZXMgPSBbXSApIHsKCgkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJCXRoaXMuYm9uZXMgPSBib25lcy5zbGljZSggMCApOwoJCXRoaXMuYm9uZUludmVyc2VzID0gYm9uZUludmVyc2VzOwoJCXRoaXMuYm9uZU1hdHJpY2VzID0gbnVsbDsKCgkJdGhpcy5ib25lVGV4dHVyZSA9IG51bGw7CgoJCXRoaXMuaW5pdCgpOwoKCX0KCglpbml0KCkgewoKCQljb25zdCBib25lcyA9IHRoaXMuYm9uZXM7CgkJY29uc3QgYm9uZUludmVyc2VzID0gdGhpcy5ib25lSW52ZXJzZXM7CgoJCXRoaXMuYm9uZU1hdHJpY2VzID0gbmV3IEZsb2F0MzJBcnJheSggYm9uZXMubGVuZ3RoICogMTYgKTsKCgkJLy8gY2FsY3VsYXRlIGludmVyc2UgYm9uZSBtYXRyaWNlcyBpZiBuZWNlc3NhcnkKCgkJaWYgKCBib25lSW52ZXJzZXMubGVuZ3RoID09PSAwICkgewoKCQkJdGhpcy5jYWxjdWxhdGVJbnZlcnNlcygpOwoKCQl9IGVsc2UgewoKCQkJLy8gaGFuZGxlIHNwZWNpYWwgY2FzZQoKCQkJaWYgKCBib25lcy5sZW5ndGggIT09IGJvbmVJbnZlcnNlcy5sZW5ndGggKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuU2tlbGV0b246IE51bWJlciBvZiBpbnZlcnNlIGJvbmUgbWF0cmljZXMgZG9lcyBub3QgbWF0Y2ggYW1vdW50IG9mIGJvbmVzLicgKTsKCgkJCQl0aGlzLmJvbmVJbnZlcnNlcyA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0aGlzLmJvbmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQl0aGlzLmJvbmVJbnZlcnNlcy5wdXNoKCBuZXcgTWF0cml4NCgpICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJfQoKCWNhbGN1bGF0ZUludmVyc2VzKCkgewoKCQl0aGlzLmJvbmVJbnZlcnNlcy5sZW5ndGggPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGhpcy5ib25lcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCWNvbnN0IGludmVyc2UgPSBuZXcgTWF0cml4NCgpOwoKCQkJaWYgKCB0aGlzLmJvbmVzWyBpIF0gKSB7CgoJCQkJaW52ZXJzZS5jb3B5KCB0aGlzLmJvbmVzWyBpIF0ubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgkJCX0KCgkJCXRoaXMuYm9uZUludmVyc2VzLnB1c2goIGludmVyc2UgKTsKCgkJfQoKCX0KCglwb3NlKCkgewoKCQkvLyByZWNvdmVyIHRoZSBiaW5kLXRpbWUgd29ybGQgbWF0cmljZXMKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRoaXMuYm9uZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCBib25lID0gdGhpcy5ib25lc1sgaSBdOwoKCQkJaWYgKCBib25lICkgewoKCQkJCWJvbmUubWF0cml4V29ybGQuY29weSggdGhpcy5ib25lSW52ZXJzZXNbIGkgXSApLmludmVydCgpOwoKCQkJfQoKCQl9CgoJCS8vIGNvbXB1dGUgdGhlIGxvY2FsIG1hdHJpY2VzLCBwb3NpdGlvbnMsIHJvdGF0aW9ucyBhbmQgc2NhbGVzCgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0aGlzLmJvbmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJY29uc3QgYm9uZSA9IHRoaXMuYm9uZXNbIGkgXTsKCgkJCWlmICggYm9uZSApIHsKCgkJCQlpZiAoIGJvbmUucGFyZW50ICYmIGJvbmUucGFyZW50LmlzQm9uZSApIHsKCgkJCQkJYm9uZS5tYXRyaXguY29weSggYm9uZS5wYXJlbnQubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCQkJCQlib25lLm1hdHJpeC5tdWx0aXBseSggYm9uZS5tYXRyaXhXb3JsZCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWJvbmUubWF0cml4LmNvcHkoIGJvbmUubWF0cml4V29ybGQgKTsKCgkJCQl9CgoJCQkJYm9uZS5tYXRyaXguZGVjb21wb3NlKCBib25lLnBvc2l0aW9uLCBib25lLnF1YXRlcm5pb24sIGJvbmUuc2NhbGUgKTsKCgkJCX0KCgkJfQoKCX0KCgl1cGRhdGUoKSB7CgoJCWNvbnN0IGJvbmVzID0gdGhpcy5ib25lczsKCQljb25zdCBib25lSW52ZXJzZXMgPSB0aGlzLmJvbmVJbnZlcnNlczsKCQljb25zdCBib25lTWF0cmljZXMgPSB0aGlzLmJvbmVNYXRyaWNlczsKCQljb25zdCBib25lVGV4dHVyZSA9IHRoaXMuYm9uZVRleHR1cmU7CgoJCS8vIGZsYXR0ZW4gYm9uZSBtYXRyaWNlcyB0byBhcnJheQoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYm9uZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkvLyBjb21wdXRlIHRoZSBvZmZzZXQgYmV0d2VlbiB0aGUgY3VycmVudCBhbmQgdGhlIG9yaWdpbmFsIHRyYW5zZm9ybQoKCQkJY29uc3QgbWF0cml4ID0gYm9uZXNbIGkgXSA/IGJvbmVzWyBpIF0ubWF0cml4V29ybGQgOiBfaWRlbnRpdHlNYXRyaXgkMTsKCgkJCV9vZmZzZXRNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggbWF0cml4LCBib25lSW52ZXJzZXNbIGkgXSApOwoJCQlfb2Zmc2V0TWF0cml4LnRvQXJyYXkoIGJvbmVNYXRyaWNlcywgaSAqIDE2ICk7CgoJCX0KCgkJaWYgKCBib25lVGV4dHVyZSAhPT0gbnVsbCApIHsKCgkJCWJvbmVUZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJfQoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyBTa2VsZXRvbiggdGhpcy5ib25lcywgdGhpcy5ib25lSW52ZXJzZXMgKTsKCgl9CgoJY29tcHV0ZUJvbmVUZXh0dXJlKCkgewoKCQkvLyBsYXlvdXQgKDEgbWF0cml4ID0gNCBwaXhlbHMpCgkJLy8gICAgICBSR0JBIFJHQkEgUkdCQSBSR0JBICg9PiBjb2x1bW4xLCBjb2x1bW4yLCBjb2x1bW4zLCBjb2x1bW40KQoJCS8vICB3aXRoICA4eDggIHBpeGVsIHRleHR1cmUgbWF4ICAgMTYgYm9uZXMgKiA0IHBpeGVscyA9ICAoOCAqIDgpCgkJLy8gICAgICAgMTZ4MTYgcGl4ZWwgdGV4dHVyZSBtYXggICA2NCBib25lcyAqIDQgcGl4ZWxzID0gKDE2ICogMTYpCgkJLy8gICAgICAgMzJ4MzIgcGl4ZWwgdGV4dHVyZSBtYXggIDI1NiBib25lcyAqIDQgcGl4ZWxzID0gKDMyICogMzIpCgkJLy8gICAgICAgNjR4NjQgcGl4ZWwgdGV4dHVyZSBtYXggMTAyNCBib25lcyAqIDQgcGl4ZWxzID0gKDY0ICogNjQpCgoJCWxldCBzaXplID0gTWF0aC5zcXJ0KCB0aGlzLmJvbmVzLmxlbmd0aCAqIDQgKTsgLy8gNCBwaXhlbHMgbmVlZGVkIGZvciAxIG1hdHJpeAoJCXNpemUgPSBNYXRoLmNlaWwoIHNpemUgLyA0ICkgKiA0OwoJCXNpemUgPSBNYXRoLm1heCggc2l6ZSwgNCApOwoKCQljb25zdCBib25lTWF0cmljZXMgPSBuZXcgRmxvYXQzMkFycmF5KCBzaXplICogc2l6ZSAqIDQgKTsgLy8gNCBmbG9hdHMgcGVyIFJHQkEgcGl4ZWwKCQlib25lTWF0cmljZXMuc2V0KCB0aGlzLmJvbmVNYXRyaWNlcyApOyAvLyBjb3B5IGN1cnJlbnQgdmFsdWVzCgoJCWNvbnN0IGJvbmVUZXh0dXJlID0gbmV3IERhdGFUZXh0dXJlKCBib25lTWF0cmljZXMsIHNpemUsIHNpemUsIFJHQkFGb3JtYXQsIEZsb2F0VHlwZSApOwoJCWJvbmVUZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJdGhpcy5ib25lTWF0cmljZXMgPSBib25lTWF0cmljZXM7CgkJdGhpcy5ib25lVGV4dHVyZSA9IGJvbmVUZXh0dXJlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0Qm9uZUJ5TmFtZSggbmFtZSApIHsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRoaXMuYm9uZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCBib25lID0gdGhpcy5ib25lc1sgaSBdOwoKCQkJaWYgKCBib25lLm5hbWUgPT09IG5hbWUgKSB7CgoJCQkJcmV0dXJuIGJvbmU7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHVuZGVmaW5lZDsKCgl9CgoJZGlzcG9zZSggKSB7CgoJCWlmICggdGhpcy5ib25lVGV4dHVyZSAhPT0gbnVsbCApIHsKCgkJCXRoaXMuYm9uZVRleHR1cmUuZGlzcG9zZSgpOwoKCQkJdGhpcy5ib25lVGV4dHVyZSA9IG51bGw7CgoJCX0KCgl9CgoJZnJvbUpTT04oIGpzb24sIGJvbmVzICkgewoKCQl0aGlzLnV1aWQgPSBqc29uLnV1aWQ7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24uYm9uZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHV1aWQgPSBqc29uLmJvbmVzWyBpIF07CgkJCWxldCBib25lID0gYm9uZXNbIHV1aWQgXTsKCgkJCWlmICggYm9uZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlNrZWxldG9uOiBObyBib25lIGZvdW5kIHdpdGggVVVJRDonLCB1dWlkICk7CgkJCQlib25lID0gbmV3IEJvbmUoKTsKCgkJCX0KCgkJCXRoaXMuYm9uZXMucHVzaCggYm9uZSApOwoJCQl0aGlzLmJvbmVJbnZlcnNlcy5wdXNoKCBuZXcgTWF0cml4NCgpLmZyb21BcnJheSgganNvbi5ib25lSW52ZXJzZXNbIGkgXSApICk7CgoJCX0KCgkJdGhpcy5pbml0KCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSB7CgkJCW1ldGFkYXRhOiB7CgkJCQl2ZXJzaW9uOiA0LjYsCgkJCQl0eXBlOiAnU2tlbGV0b24nLAoJCQkJZ2VuZXJhdG9yOiAnU2tlbGV0b24udG9KU09OJwoJCQl9LAoJCQlib25lczogW10sCgkJCWJvbmVJbnZlcnNlczogW10KCQl9OwoKCQlkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CgoJCWNvbnN0IGJvbmVzID0gdGhpcy5ib25lczsKCQljb25zdCBib25lSW52ZXJzZXMgPSB0aGlzLmJvbmVJbnZlcnNlczsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gYm9uZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGJvbmUgPSBib25lc1sgaSBdOwoJCQlkYXRhLmJvbmVzLnB1c2goIGJvbmUudXVpZCApOwoKCQkJY29uc3QgYm9uZUludmVyc2UgPSBib25lSW52ZXJzZXNbIGkgXTsKCQkJZGF0YS5ib25lSW52ZXJzZXMucHVzaCggYm9uZUludmVyc2UudG9BcnJheSgpICk7CgoJCX0KCgkJcmV0dXJuIGRhdGE7CgoJfQoKfQoKY2xhc3MgSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkLCBtZXNoUGVyQXR0cmlidXRlID0gMSApIHsKCgkJc3VwZXIoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCQl0aGlzLmlzSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlID0gdHJ1ZTsKCgkJdGhpcy5tZXNoUGVyQXR0cmlidXRlID0gbWVzaFBlckF0dHJpYnV0ZTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5tZXNoUGVyQXR0cmlidXRlID0gc291cmNlLm1lc2hQZXJBdHRyaWJ1dGU7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS5tZXNoUGVyQXR0cmlidXRlID0gdGhpcy5tZXNoUGVyQXR0cmlidXRlOwoKCQlkYXRhLmlzSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlID0gdHJ1ZTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKfQoKY29uc3QgX2luc3RhbmNlTG9jYWxNYXRyaXggPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9pbnN0YW5jZVdvcmxkTWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKY29uc3QgX2luc3RhbmNlSW50ZXJzZWN0cyA9IFtdOwoKY29uc3QgX2JveDMgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CmNvbnN0IF9pZGVudGl0eSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX21lc2gkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1lc2goKTsKY29uc3QgX3NwaGVyZSQzID0gLypAX19QVVJFX18qLyBuZXcgU3BoZXJlKCk7CgpjbGFzcyBJbnN0YW5jZWRNZXNoIGV4dGVuZHMgTWVzaCB7CgoJY29uc3RydWN0b3IoIGdlb21ldHJ5LCBtYXRlcmlhbCwgY291bnQgKSB7CgoJCXN1cGVyKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy5pc0luc3RhbmNlZE1lc2ggPSB0cnVlOwoKCQl0aGlzLmluc3RhbmNlTWF0cml4ID0gbmV3IEluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSggbmV3IEZsb2F0MzJBcnJheSggY291bnQgKiAxNiApLCAxNiApOwoJCXRoaXMuaW5zdGFuY2VDb2xvciA9IG51bGw7CgoJCXRoaXMuY291bnQgPSBjb3VudDsKCgkJdGhpcy5ib3VuZGluZ0JveCA9IG51bGw7CgkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvdW50OyBpICsrICkgewoKCQkJdGhpcy5zZXRNYXRyaXhBdCggaSwgX2lkZW50aXR5ICk7CgoJCX0KCgl9CgoJY29tcHV0ZUJvdW5kaW5nQm94KCkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJY29uc3QgY291bnQgPSB0aGlzLmNvdW50OwoKCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQl0aGlzLmJvdW5kaW5nQm94ID0gbmV3IEJveDMoKTsKCgkJfQoKCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nQm94ID09PSBudWxsICkgewoKCQkJZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk7CgoJCX0KCgkJdGhpcy5ib3VuZGluZ0JveC5tYWtlRW1wdHkoKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKysgKSB7CgoJCQl0aGlzLmdldE1hdHJpeEF0KCBpLCBfaW5zdGFuY2VMb2NhbE1hdHJpeCApOwoKCQkJX2JveDMuY29weSggZ2VvbWV0cnkuYm91bmRpbmdCb3ggKS5hcHBseU1hdHJpeDQoIF9pbnN0YW5jZUxvY2FsTWF0cml4ICk7CgoJCQl0aGlzLmJvdW5kaW5nQm94LnVuaW9uKCBfYm94MyApOwoKCQl9CgoJfQoKCWNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCWNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDsKCgkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgewoKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG5ldyBTcGhlcmUoKTsKCgkJfQoKCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgewoKCQkJZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCX0KCgkJdGhpcy5ib3VuZGluZ1NwaGVyZS5tYWtlRW1wdHkoKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKysgKSB7CgoJCQl0aGlzLmdldE1hdHJpeEF0KCBpLCBfaW5zdGFuY2VMb2NhbE1hdHJpeCApOwoKCQkJX3NwaGVyZSQzLmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlICkuYXBwbHlNYXRyaXg0KCBfaW5zdGFuY2VMb2NhbE1hdHJpeCApOwoKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS51bmlvbiggX3NwaGVyZSQzICk7CgoJCX0KCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMuaW5zdGFuY2VNYXRyaXguY29weSggc291cmNlLmluc3RhbmNlTWF0cml4ICk7CgoJCWlmICggc291cmNlLmluc3RhbmNlQ29sb3IgIT09IG51bGwgKSB0aGlzLmluc3RhbmNlQ29sb3IgPSBzb3VyY2UuaW5zdGFuY2VDb2xvci5jbG9uZSgpOwoKCQl0aGlzLmNvdW50ID0gc291cmNlLmNvdW50OwoKCQlpZiAoIHNvdXJjZS5ib3VuZGluZ0JveCAhPT0gbnVsbCApIHRoaXMuYm91bmRpbmdCb3ggPSBzb3VyY2UuYm91bmRpbmdCb3guY2xvbmUoKTsKCQlpZiAoIHNvdXJjZS5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHRoaXMuYm91bmRpbmdTcGhlcmUgPSBzb3VyY2UuYm91bmRpbmdTcGhlcmUuY2xvbmUoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldENvbG9yQXQoIGluZGV4LCBjb2xvciApIHsKCgkJY29sb3IuZnJvbUFycmF5KCB0aGlzLmluc3RhbmNlQ29sb3IuYXJyYXksIGluZGV4ICogMyApOwoKCX0KCglnZXRNYXRyaXhBdCggaW5kZXgsIG1hdHJpeCApIHsKCgkJbWF0cml4LmZyb21BcnJheSggdGhpcy5pbnN0YW5jZU1hdHJpeC5hcnJheSwgaW5kZXggKiAxNiApOwoKCX0KCglyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgoJCWNvbnN0IG1hdHJpeFdvcmxkID0gdGhpcy5tYXRyaXhXb3JsZDsKCQljb25zdCByYXljYXN0VGltZXMgPSB0aGlzLmNvdW50OwoKCQlfbWVzaCQxLmdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQlfbWVzaCQxLm1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKCgkJaWYgKCBfbWVzaCQxLm1hdGVyaWFsID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCS8vIHRlc3Qgd2l0aCBib3VuZGluZyBzcGhlcmUgZmlyc3QKCgkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgdGhpcy5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJX3NwaGVyZSQzLmNvcHkoIHRoaXMuYm91bmRpbmdTcGhlcmUgKTsKCQlfc3BoZXJlJDMuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoKCQlpZiAoIHJheWNhc3Rlci5yYXkuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQzICkgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkvLyBub3cgdGVzdCBlYWNoIGluc3RhbmNlCgoJCWZvciAoIGxldCBpbnN0YW5jZUlkID0gMDsgaW5zdGFuY2VJZCA8IHJheWNhc3RUaW1lczsgaW5zdGFuY2VJZCArKyApIHsKCgkJCS8vIGNhbGN1bGF0ZSB0aGUgd29ybGQgbWF0cml4IGZvciBlYWNoIGluc3RhbmNlCgoJCQl0aGlzLmdldE1hdHJpeEF0KCBpbnN0YW5jZUlkLCBfaW5zdGFuY2VMb2NhbE1hdHJpeCApOwoKCQkJX2luc3RhbmNlV29ybGRNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggbWF0cml4V29ybGQsIF9pbnN0YW5jZUxvY2FsTWF0cml4ICk7CgoJCQkvLyB0aGUgbWVzaCByZXByZXNlbnRzIHRoaXMgc2luZ2xlIGluc3RhbmNlCgoJCQlfbWVzaCQxLm1hdHJpeFdvcmxkID0gX2luc3RhbmNlV29ybGRNYXRyaXg7CgoJCQlfbWVzaCQxLnJheWNhc3QoIHJheWNhc3RlciwgX2luc3RhbmNlSW50ZXJzZWN0cyApOwoKCQkJLy8gcHJvY2VzcyB0aGUgcmVzdWx0IG9mIHJheWNhc3QKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IF9pbnN0YW5jZUludGVyc2VjdHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBpbnRlcnNlY3QgPSBfaW5zdGFuY2VJbnRlcnNlY3RzWyBpIF07CgkJCQlpbnRlcnNlY3QuaW5zdGFuY2VJZCA9IGluc3RhbmNlSWQ7CgkJCQlpbnRlcnNlY3Qub2JqZWN0ID0gdGhpczsKCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0ICk7CgoJCQl9CgoJCQlfaW5zdGFuY2VJbnRlcnNlY3RzLmxlbmd0aCA9IDA7CgoJCX0KCgl9CgoJc2V0Q29sb3JBdCggaW5kZXgsIGNvbG9yICkgewoKCQlpZiAoIHRoaXMuaW5zdGFuY2VDb2xvciA9PT0gbnVsbCApIHsKCgkJCXRoaXMuaW5zdGFuY2VDb2xvciA9IG5ldyBJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUoIG5ldyBGbG9hdDMyQXJyYXkoIHRoaXMuaW5zdGFuY2VNYXRyaXguY291bnQgKiAzICksIDMgKTsKCgkJfQoKCQljb2xvci50b0FycmF5KCB0aGlzLmluc3RhbmNlQ29sb3IuYXJyYXksIGluZGV4ICogMyApOwoKCX0KCglzZXRNYXRyaXhBdCggaW5kZXgsIG1hdHJpeCApIHsKCgkJbWF0cml4LnRvQXJyYXkoIHRoaXMuaW5zdGFuY2VNYXRyaXguYXJyYXksIGluZGV4ICogMTYgKTsKCgl9CgoJdXBkYXRlTW9ycGhUYXJnZXRzKCkgewoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCgl9Cgp9CgpmdW5jdGlvbiBzb3J0T3BhcXVlKCBhLCBiICkgewoKCXJldHVybiBhLnogLSBiLno7Cgp9CgpmdW5jdGlvbiBzb3J0VHJhbnNwYXJlbnQoIGEsIGIgKSB7CgoJcmV0dXJuIGIueiAtIGEuejsKCn0KCmNsYXNzIE11bHRpRHJhd1JlbmRlckxpc3QgewoKCWNvbnN0cnVjdG9yKCkgewoKCQl0aGlzLmluZGV4ID0gMDsKCQl0aGlzLnBvb2wgPSBbXTsKCQl0aGlzLmxpc3QgPSBbXTsKCgl9CgoJcHVzaCggZHJhd1JhbmdlLCB6ICkgewoKCQljb25zdCBwb29sID0gdGhpcy5wb29sOwoJCWNvbnN0IGxpc3QgPSB0aGlzLmxpc3Q7CgkJaWYgKCB0aGlzLmluZGV4ID49IHBvb2wubGVuZ3RoICkgewoKCQkJcG9vbC5wdXNoKCB7CgoJCQkJc3RhcnQ6IC0gMSwKCQkJCWNvdW50OiAtIDEsCgkJCQl6OiAtIDEsCgoJCQl9ICk7CgoJCX0KCgkJY29uc3QgaXRlbSA9IHBvb2xbIHRoaXMuaW5kZXggXTsKCQlsaXN0LnB1c2goIGl0ZW0gKTsKCQl0aGlzLmluZGV4ICsrOwoKCQlpdGVtLnN0YXJ0ID0gZHJhd1JhbmdlLnN0YXJ0OwoJCWl0ZW0uY291bnQgPSBkcmF3UmFuZ2UuY291bnQ7CgkJaXRlbS56ID0gejsKCgl9CgoJcmVzZXQoKSB7CgoJCXRoaXMubGlzdC5sZW5ndGggPSAwOwoJCXRoaXMuaW5kZXggPSAwOwoKCX0KCn0KCmNvbnN0IElEX0FUVFJfTkFNRSA9ICdiYXRjaElkJzsKY29uc3QgX21hdHJpeCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX2ludk1hdHJpeFdvcmxkID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwpjb25zdCBfaWRlbnRpdHlNYXRyaXggPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9wcm9qU2NyZWVuTWF0cml4JDIgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9mcnVzdHVtID0gLypAX19QVVJFX18qLyBuZXcgRnJ1c3R1bSgpOwpjb25zdCBfYm94JDEgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CmNvbnN0IF9zcGhlcmUkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFNwaGVyZSgpOwpjb25zdCBfdmVjdG9yJDUgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9yZW5kZXJMaXN0ID0gLypAX19QVVJFX18qLyBuZXcgTXVsdGlEcmF3UmVuZGVyTGlzdCgpOwpjb25zdCBfbWVzaCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1lc2goKTsKY29uc3QgX2JhdGNoSW50ZXJzZWN0cyA9IFtdOwoKLy8gQFRPRE86IFNraW5uZWRNZXNoIHN1cHBvcnQ/Ci8vIEBUT0RPOiBnZW9tZXRyeS5ncm91cHMgc3VwcG9ydD8KLy8gQFRPRE86IGdlb21ldHJ5LmRyYXdSYW5nZSBzdXBwb3J0PwovLyBAVE9ETzogZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzIHN1cHBvcnQ/Ci8vIEBUT0RPOiBTdXBwb3J0IHVuaWZvcm0gcGFyYW1ldGVyIHBlciBnZW9tZXRyeQovLyBAVE9ETzogQWRkIGFuICJvcHRpbWl6ZSIgZnVuY3Rpb24gdG8gcGFjayBnZW9tZXRyeSBhbmQgcmVtb3ZlIGRhdGEgZ2FwcwoKLy8gY29waWVzIGRhdGEgZnJvbSBhdHRyaWJ1dGUgInNyYyIgaW50byAidGFyZ2V0IiBzdGFydGluZyBhdCAidGFyZ2V0T2Zmc2V0IgpmdW5jdGlvbiBjb3B5QXR0cmlidXRlRGF0YSggc3JjLCB0YXJnZXQsIHRhcmdldE9mZnNldCA9IDAgKSB7CgoJY29uc3QgaXRlbVNpemUgPSB0YXJnZXQuaXRlbVNpemU7CglpZiAoIHNyYy5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlIHx8IHNyYy5hcnJheS5jb25zdHJ1Y3RvciAhPT0gdGFyZ2V0LmFycmF5LmNvbnN0cnVjdG9yICkgewoKCQkvLyB1c2UgdGhlIGNvbXBvbmVudCBnZXR0ZXJzIGFuZCBzZXR0ZXJzIGlmIHRoZSBhcnJheSBkYXRhIGNhbm5vdAoJCS8vIGJlIGNvcGllZCBkaXJlY3RseQoJCWNvbnN0IHZlcnRleENvdW50ID0gc3JjLmNvdW50OwoJCWZvciAoIGxldCBpID0gMDsgaSA8IHZlcnRleENvdW50OyBpICsrICkgewoKCQkJZm9yICggbGV0IGMgPSAwOyBjIDwgaXRlbVNpemU7IGMgKysgKSB7CgoJCQkJdGFyZ2V0LnNldENvbXBvbmVudCggaSArIHRhcmdldE9mZnNldCwgYywgc3JjLmdldENvbXBvbmVudCggaSwgYyApICk7CgoJCQl9CgoJCX0KCgl9IGVsc2UgewoKCQkvLyBmYXN0ZXIgY29weSBhcHByb2FjaCB1c2luZyB0eXBlZCBhcnJheSBzZXQgZnVuY3Rpb24KCQl0YXJnZXQuYXJyYXkuc2V0KCBzcmMuYXJyYXksIHRhcmdldE9mZnNldCAqIGl0ZW1TaXplICk7CgoJfQoKCXRhcmdldC5uZWVkc1VwZGF0ZSA9IHRydWU7Cgp9CgpjbGFzcyBCYXRjaGVkTWVzaCBleHRlbmRzIE1lc2ggewoKCWdldCBtYXhHZW9tZXRyeUNvdW50KCkgewoKCQlyZXR1cm4gdGhpcy5fbWF4R2VvbWV0cnlDb3VudDsKCgl9CgoJY29uc3RydWN0b3IoIG1heEdlb21ldHJ5Q291bnQsIG1heFZlcnRleENvdW50LCBtYXhJbmRleENvdW50ID0gbWF4VmVydGV4Q291bnQgKiAyLCBtYXRlcmlhbCApIHsKCgkJc3VwZXIoIG5ldyBCdWZmZXJHZW9tZXRyeSgpLCBtYXRlcmlhbCApOwoKCQl0aGlzLmlzQmF0Y2hlZE1lc2ggPSB0cnVlOwoJCXRoaXMucGVyT2JqZWN0RnJ1c3R1bUN1bGxlZCA9IHRydWU7CgkJdGhpcy5zb3J0T2JqZWN0cyA9IHRydWU7CgkJdGhpcy5ib3VuZGluZ0JveCA9IG51bGw7CgkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgkJdGhpcy5jdXN0b21Tb3J0ID0gbnVsbDsKCgkJdGhpcy5fZHJhd1JhbmdlcyA9IFtdOwoJCXRoaXMuX3Jlc2VydmVkUmFuZ2VzID0gW107CgoJCXRoaXMuX3Zpc2liaWxpdHkgPSBbXTsKCQl0aGlzLl9hY3RpdmUgPSBbXTsKCQl0aGlzLl9ib3VuZHMgPSBbXTsKCgkJdGhpcy5fbWF4R2VvbWV0cnlDb3VudCA9IG1heEdlb21ldHJ5Q291bnQ7CgkJdGhpcy5fbWF4VmVydGV4Q291bnQgPSBtYXhWZXJ0ZXhDb3VudDsKCQl0aGlzLl9tYXhJbmRleENvdW50ID0gbWF4SW5kZXhDb3VudDsKCgkJdGhpcy5fZ2VvbWV0cnlJbml0aWFsaXplZCA9IGZhbHNlOwoJCXRoaXMuX2dlb21ldHJ5Q291bnQgPSAwOwoJCXRoaXMuX211bHRpRHJhd0NvdW50cyA9IG5ldyBJbnQzMkFycmF5KCBtYXhHZW9tZXRyeUNvdW50ICk7CgkJdGhpcy5fbXVsdGlEcmF3U3RhcnRzID0gbmV3IEludDMyQXJyYXkoIG1heEdlb21ldHJ5Q291bnQgKTsKCQl0aGlzLl9tdWx0aURyYXdDb3VudCA9IDA7CgkJdGhpcy5fdmlzaWJpbGl0eUNoYW5nZWQgPSB0cnVlOwoKCQkvLyBMb2NhbCBtYXRyaXggcGVyIGdlb21ldHJ5IGJ5IHVzaW5nIGRhdGEgdGV4dHVyZQoJCXRoaXMuX21hdHJpY2VzVGV4dHVyZSA9IG51bGw7CgoJCXRoaXMuX2luaXRNYXRyaWNlc1RleHR1cmUoKTsKCgl9CgoJX2luaXRNYXRyaWNlc1RleHR1cmUoKSB7CgoJCS8vIGxheW91dCAoMSBtYXRyaXggPSA0IHBpeGVscykKCQkvLyAgICAgIFJHQkEgUkdCQSBSR0JBIFJHQkEgKD0+IGNvbHVtbjEsIGNvbHVtbjIsIGNvbHVtbjMsIGNvbHVtbjQpCgkJLy8gIHdpdGggIDh4OCAgcGl4ZWwgdGV4dHVyZSBtYXggICAxNiBtYXRyaWNlcyAqIDQgcGl4ZWxzID0gICg4ICogOCkKCQkvLyAgICAgICAxNngxNiBwaXhlbCB0ZXh0dXJlIG1heCAgIDY0IG1hdHJpY2VzICogNCBwaXhlbHMgPSAoMTYgKiAxNikKCQkvLyAgICAgICAzMngzMiBwaXhlbCB0ZXh0dXJlIG1heCAgMjU2IG1hdHJpY2VzICogNCBwaXhlbHMgPSAoMzIgKiAzMikKCQkvLyAgICAgICA2NHg2NCBwaXhlbCB0ZXh0dXJlIG1heCAxMDI0IG1hdHJpY2VzICogNCBwaXhlbHMgPSAoNjQgKiA2NCkKCgkJbGV0IHNpemUgPSBNYXRoLnNxcnQoIHRoaXMuX21heEdlb21ldHJ5Q291bnQgKiA0ICk7IC8vIDQgcGl4ZWxzIG5lZWRlZCBmb3IgMSBtYXRyaXgKCQlzaXplID0gTWF0aC5jZWlsKCBzaXplIC8gNCApICogNDsKCQlzaXplID0gTWF0aC5tYXgoIHNpemUsIDQgKTsKCgkJY29uc3QgbWF0cmljZXNBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIHNpemUgKiBzaXplICogNCApOyAvLyA0IGZsb2F0cyBwZXIgUkdCQSBwaXhlbAoJCWNvbnN0IG1hdHJpY2VzVGV4dHVyZSA9IG5ldyBEYXRhVGV4dHVyZSggbWF0cmljZXNBcnJheSwgc2l6ZSwgc2l6ZSwgUkdCQUZvcm1hdCwgRmxvYXRUeXBlICk7CgoJCXRoaXMuX21hdHJpY2VzVGV4dHVyZSA9IG1hdHJpY2VzVGV4dHVyZTsKCgl9CgoJX2luaXRpYWxpemVHZW9tZXRyeSggcmVmZXJlbmNlICkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJY29uc3QgbWF4VmVydGV4Q291bnQgPSB0aGlzLl9tYXhWZXJ0ZXhDb3VudDsKCQljb25zdCBtYXhHZW9tZXRyeUNvdW50ID0gdGhpcy5fbWF4R2VvbWV0cnlDb3VudDsKCQljb25zdCBtYXhJbmRleENvdW50ID0gdGhpcy5fbWF4SW5kZXhDb3VudDsKCQlpZiAoIHRoaXMuX2dlb21ldHJ5SW5pdGlhbGl6ZWQgPT09IGZhbHNlICkgewoKCQkJZm9yICggY29uc3QgYXR0cmlidXRlTmFtZSBpbiByZWZlcmVuY2UuYXR0cmlidXRlcyApIHsKCgkJCQljb25zdCBzcmNBdHRyaWJ1dGUgPSByZWZlcmVuY2UuZ2V0QXR0cmlidXRlKCBhdHRyaWJ1dGVOYW1lICk7CgkJCQljb25zdCB7IGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCB9ID0gc3JjQXR0cmlidXRlOwoKCQkJCWNvbnN0IGRzdEFycmF5ID0gbmV3IGFycmF5LmNvbnN0cnVjdG9yKCBtYXhWZXJ0ZXhDb3VudCAqIGl0ZW1TaXplICk7CgkJCQljb25zdCBkc3RBdHRyaWJ1dGUgPSBuZXcgc3JjQXR0cmlidXRlLmNvbnN0cnVjdG9yKCBkc3RBcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCQkJCWRzdEF0dHJpYnV0ZS5zZXRVc2FnZSggc3JjQXR0cmlidXRlLnVzYWdlICk7CgoJCQkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCBhdHRyaWJ1dGVOYW1lLCBkc3RBdHRyaWJ1dGUgKTsKCgkJCX0KCgkJCWlmICggcmVmZXJlbmNlLmdldEluZGV4KCkgIT09IG51bGwgKSB7CgoJCQkJY29uc3QgaW5kZXhBcnJheSA9IG1heFZlcnRleENvdW50ID4gNjU1MzYKCQkJCQk/IG5ldyBVaW50MzJBcnJheSggbWF4SW5kZXhDb3VudCApCgkJCQkJOiBuZXcgVWludDE2QXJyYXkoIG1heEluZGV4Q291bnQgKTsKCgkJCQlnZW9tZXRyeS5zZXRJbmRleCggbmV3IEJ1ZmZlckF0dHJpYnV0ZSggaW5kZXhBcnJheSwgMSApICk7CgoJCQl9CgoJCQljb25zdCBpZEFycmF5ID0gbWF4R2VvbWV0cnlDb3VudCA+IDY1NTM2CgkJCQk/IG5ldyBVaW50MzJBcnJheSggbWF4VmVydGV4Q291bnQgKQoJCQkJOiBuZXcgVWludDE2QXJyYXkoIG1heFZlcnRleENvdW50ICk7CgkJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggSURfQVRUUl9OQU1FLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBpZEFycmF5LCAxICkgKTsKCgkJCXRoaXMuX2dlb21ldHJ5SW5pdGlhbGl6ZWQgPSB0cnVlOwoKCQl9CgoJfQoKCS8vIE1ha2Ugc3VyZSB0aGUgZ2VvbWV0cnkgaXMgY29tcGF0aWJsZSB3aXRoIHRoZSBleGlzdGluZyBjb21iaW5lZCBnZW9tZXRyeSBhdHJpYnV0ZXMKCV92YWxpZGF0ZUdlb21ldHJ5KCBnZW9tZXRyeSApIHsKCgkJLy8gY2hlY2sgdGhhdCB0aGUgZ2VvbWV0cnkgZG9lc24ndCBoYXZlIGEgdmVyc2lvbiBvZiBvdXIgcmVzZXJ2ZWQgaWQgYXR0cmlidXRlCgkJaWYgKCBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoIElEX0FUVFJfTkFNRSApICkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCBgQmF0Y2hlZE1lc2g6IEdlb21ldHJ5IGNhbm5vdCB1c2UgYXR0cmlidXRlICIkeyBJRF9BVFRSX05BTUUgfSJgICk7CgoJCX0KCgkJLy8gY2hlY2sgdG8gZW5zdXJlIHRoZSBnZW9tZXRyaWVzIGFyZSB1c2luZyBjb25zaXN0ZW50IGF0dHJpYnV0ZXMgYW5kIGluZGljZXMKCQljb25zdCBiYXRjaEdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQlpZiAoIEJvb2xlYW4oIGdlb21ldHJ5LmdldEluZGV4KCkgKSAhPT0gQm9vbGVhbiggYmF0Y2hHZW9tZXRyeS5nZXRJbmRleCgpICkgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdCYXRjaGVkTWVzaDogQWxsIGdlb21ldHJpZXMgbXVzdCBjb25zaXN0ZW50bHkgaGF2ZSAiaW5kZXgiLicgKTsKCgkJfQoKCQlmb3IgKCBjb25zdCBhdHRyaWJ1dGVOYW1lIGluIGJhdGNoR2VvbWV0cnkuYXR0cmlidXRlcyApIHsKCgkJCWlmICggYXR0cmlidXRlTmFtZSA9PT0gSURfQVRUUl9OQU1FICkgewoKCQkJCWNvbnRpbnVlOwoKCQkJfQoKCQkJaWYgKCAhIGdlb21ldHJ5Lmhhc0F0dHJpYnV0ZSggYXR0cmlidXRlTmFtZSApICkgewoKCQkJCXRocm93IG5ldyBFcnJvciggYEJhdGNoZWRNZXNoOiBBZGRlZCBnZW9tZXRyeSBtaXNzaW5nICIkeyBhdHRyaWJ1dGVOYW1lIH0iLiBBbGwgZ2VvbWV0cmllcyBtdXN0IGhhdmUgY29uc2lzdGVudCBhdHRyaWJ1dGVzLmAgKTsKCgkJCX0KCgkJCWNvbnN0IHNyY0F0dHJpYnV0ZSA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggYXR0cmlidXRlTmFtZSApOwoJCQljb25zdCBkc3RBdHRyaWJ1dGUgPSBiYXRjaEdlb21ldHJ5LmdldEF0dHJpYnV0ZSggYXR0cmlidXRlTmFtZSApOwoJCQlpZiAoIHNyY0F0dHJpYnV0ZS5pdGVtU2l6ZSAhPT0gZHN0QXR0cmlidXRlLml0ZW1TaXplIHx8IHNyY0F0dHJpYnV0ZS5ub3JtYWxpemVkICE9PSBkc3RBdHRyaWJ1dGUubm9ybWFsaXplZCApIHsKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdCYXRjaGVkTWVzaDogQWxsIGF0dHJpYnV0ZXMgbXVzdCBoYXZlIGEgY29uc2lzdGVudCBpdGVtU2l6ZSBhbmQgbm9ybWFsaXplZCB2YWx1ZS4nICk7CgoJCQl9CgoJCX0KCgl9CgoJc2V0Q3VzdG9tU29ydCggZnVuYyApIHsKCgkJdGhpcy5jdXN0b21Tb3J0ID0gZnVuYzsKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29tcHV0ZUJvdW5kaW5nQm94KCkgewoKCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQl0aGlzLmJvdW5kaW5nQm94ID0gbmV3IEJveDMoKTsKCgkJfQoKCQljb25zdCBnZW9tZXRyeUNvdW50ID0gdGhpcy5fZ2VvbWV0cnlDb3VudDsKCQljb25zdCBib3VuZGluZ0JveCA9IHRoaXMuYm91bmRpbmdCb3g7CgkJY29uc3QgYWN0aXZlID0gdGhpcy5fYWN0aXZlOwoKCQlib3VuZGluZ0JveC5tYWtlRW1wdHkoKTsKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBnZW9tZXRyeUNvdW50OyBpICsrICkgewoKCQkJaWYgKCBhY3RpdmVbIGkgXSA9PT0gZmFsc2UgKSBjb250aW51ZTsKCgkJCXRoaXMuZ2V0TWF0cml4QXQoIGksIF9tYXRyaXggKTsKCQkJdGhpcy5nZXRCb3VuZGluZ0JveEF0KCBpLCBfYm94JDEgKS5hcHBseU1hdHJpeDQoIF9tYXRyaXggKTsKCQkJYm91bmRpbmdCb3gudW5pb24oIF9ib3gkMSApOwoKCQl9CgoJfQoKCWNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpIHsKCgkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgewoKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG5ldyBTcGhlcmUoKTsKCgkJfQoKCQljb25zdCBnZW9tZXRyeUNvdW50ID0gdGhpcy5fZ2VvbWV0cnlDb3VudDsKCQljb25zdCBib3VuZGluZ1NwaGVyZSA9IHRoaXMuYm91bmRpbmdTcGhlcmU7CgkJY29uc3QgYWN0aXZlID0gdGhpcy5fYWN0aXZlOwoKCQlib3VuZGluZ1NwaGVyZS5tYWtlRW1wdHkoKTsKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBnZW9tZXRyeUNvdW50OyBpICsrICkgewoKCQkJaWYgKCBhY3RpdmVbIGkgXSA9PT0gZmFsc2UgKSBjb250aW51ZTsKCgkJCXRoaXMuZ2V0TWF0cml4QXQoIGksIF9tYXRyaXggKTsKCQkJdGhpcy5nZXRCb3VuZGluZ1NwaGVyZUF0KCBpLCBfc3BoZXJlJDIgKS5hcHBseU1hdHJpeDQoIF9tYXRyaXggKTsKCQkJYm91bmRpbmdTcGhlcmUudW5pb24oIF9zcGhlcmUkMiApOwoKCQl9CgoJfQoKCWFkZEdlb21ldHJ5KCBnZW9tZXRyeSwgdmVydGV4Q291bnQgPSAtIDEsIGluZGV4Q291bnQgPSAtIDEgKSB7CgoJCXRoaXMuX2luaXRpYWxpemVHZW9tZXRyeSggZ2VvbWV0cnkgKTsKCgkJdGhpcy5fdmFsaWRhdGVHZW9tZXRyeSggZ2VvbWV0cnkgKTsKCgkJLy8gZW5zdXJlIHdlJ3JlIG5vdCBvdmVyIGdlb21ldHJ5CgkJaWYgKCB0aGlzLl9nZW9tZXRyeUNvdW50ID49IHRoaXMuX21heEdlb21ldHJ5Q291bnQgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdCYXRjaGVkTWVzaDogTWF4aW11bSBnZW9tZXRyeSBjb3VudCByZWFjaGVkLicgKTsKCgkJfQoKCQkvLyBnZXQgdGhlIG5lY2Vzc2FyeSByYW5nZSBmbyB0aGUgZ2VvbWV0cnkKCQljb25zdCByZXNlcnZlZFJhbmdlID0gewoJCQl2ZXJ0ZXhTdGFydDogLSAxLAoJCQl2ZXJ0ZXhDb3VudDogLSAxLAoJCQlpbmRleFN0YXJ0OiAtIDEsCgkJCWluZGV4Q291bnQ6IC0gMSwKCQl9OwoKCQlsZXQgbGFzdFJhbmdlID0gbnVsbDsKCQljb25zdCByZXNlcnZlZFJhbmdlcyA9IHRoaXMuX3Jlc2VydmVkUmFuZ2VzOwoJCWNvbnN0IGRyYXdSYW5nZXMgPSB0aGlzLl9kcmF3UmFuZ2VzOwoJCWNvbnN0IGJvdW5kcyA9IHRoaXMuX2JvdW5kczsKCQlpZiAoIHRoaXMuX2dlb21ldHJ5Q291bnQgIT09IDAgKSB7CgoJCQlsYXN0UmFuZ2UgPSByZXNlcnZlZFJhbmdlc1sgcmVzZXJ2ZWRSYW5nZXMubGVuZ3RoIC0gMSBdOwoKCQl9CgoJCWlmICggdmVydGV4Q291bnQgPT09IC0gMSApIHsKCgkJCXJlc2VydmVkUmFuZ2UudmVydGV4Q291bnQgPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKS5jb3VudDsKCgkJfSBlbHNlIHsKCgkJCXJlc2VydmVkUmFuZ2UudmVydGV4Q291bnQgPSB2ZXJ0ZXhDb3VudDsKCgkJfQoKCQlpZiAoIGxhc3RSYW5nZSA9PT0gbnVsbCApIHsKCgkJCXJlc2VydmVkUmFuZ2UudmVydGV4U3RhcnQgPSAwOwoKCQl9IGVsc2UgewoKCQkJcmVzZXJ2ZWRSYW5nZS52ZXJ0ZXhTdGFydCA9IGxhc3RSYW5nZS52ZXJ0ZXhTdGFydCArIGxhc3RSYW5nZS52ZXJ0ZXhDb3VudDsKCgkJfQoKCQljb25zdCBpbmRleCA9IGdlb21ldHJ5LmdldEluZGV4KCk7CgkJY29uc3QgaGFzSW5kZXggPSBpbmRleCAhPT0gbnVsbDsKCQlpZiAoIGhhc0luZGV4ICkgewoKCQkJaWYgKCBpbmRleENvdW50CT09PSAtIDEgKSB7CgoJCQkJcmVzZXJ2ZWRSYW5nZS5pbmRleENvdW50ID0gaW5kZXguY291bnQ7CgoJCQl9IGVsc2UgewoKCQkJCXJlc2VydmVkUmFuZ2UuaW5kZXhDb3VudCA9IGluZGV4Q291bnQ7CgoJCQl9CgoJCQlpZiAoIGxhc3RSYW5nZSA9PT0gbnVsbCApIHsKCgkJCQlyZXNlcnZlZFJhbmdlLmluZGV4U3RhcnQgPSAwOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXNlcnZlZFJhbmdlLmluZGV4U3RhcnQgPSBsYXN0UmFuZ2UuaW5kZXhTdGFydCArIGxhc3RSYW5nZS5pbmRleENvdW50OwoKCQkJfQoKCQl9CgoJCWlmICgKCQkJcmVzZXJ2ZWRSYW5nZS5pbmRleFN0YXJ0ICE9PSAtIDEgJiYKCQkJcmVzZXJ2ZWRSYW5nZS5pbmRleFN0YXJ0ICsgcmVzZXJ2ZWRSYW5nZS5pbmRleENvdW50ID4gdGhpcy5fbWF4SW5kZXhDb3VudCB8fAoJCQlyZXNlcnZlZFJhbmdlLnZlcnRleFN0YXJ0ICsgcmVzZXJ2ZWRSYW5nZS52ZXJ0ZXhDb3VudCA+IHRoaXMuX21heFZlcnRleENvdW50CgkJKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdCYXRjaGVkTWVzaDogUmVzZXJ2ZWQgc3BhY2UgcmVxdWVzdCBleGNlZWRzIHRoZSBtYXhpbXVtIGJ1ZmZlciBzaXplLicgKTsKCgkJfQoKCQljb25zdCB2aXNpYmlsaXR5ID0gdGhpcy5fdmlzaWJpbGl0eTsKCQljb25zdCBhY3RpdmUgPSB0aGlzLl9hY3RpdmU7CgkJY29uc3QgbWF0cmljZXNUZXh0dXJlID0gdGhpcy5fbWF0cmljZXNUZXh0dXJlOwoJCWNvbnN0IG1hdHJpY2VzQXJyYXkgPSB0aGlzLl9tYXRyaWNlc1RleHR1cmUuaW1hZ2UuZGF0YTsKCgkJLy8gcHVzaCBuZXcgdmlzaWJpbGl0eSBzdGF0ZXMKCQl2aXNpYmlsaXR5LnB1c2goIHRydWUgKTsKCQlhY3RpdmUucHVzaCggdHJ1ZSApOwoKCQkvLyB1cGRhdGUgaWQKCQljb25zdCBnZW9tZXRyeUlkID0gdGhpcy5fZ2VvbWV0cnlDb3VudDsKCQl0aGlzLl9nZW9tZXRyeUNvdW50ICsrOwoKCQkvLyBpbml0aWFsaXplIG1hdHJpeCBpbmZvcm1hdGlvbgoJCV9pZGVudGl0eU1hdHJpeC50b0FycmF5KCBtYXRyaWNlc0FycmF5LCBnZW9tZXRyeUlkICogMTYgKTsKCQltYXRyaWNlc1RleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkvLyBhZGQgdGhlIHJlc2VydmVkIHJhbmdlIGFuZCBkcmF3IHJhbmdlIG9iamVjdHMKCQlyZXNlcnZlZFJhbmdlcy5wdXNoKCByZXNlcnZlZFJhbmdlICk7CgkJZHJhd1Jhbmdlcy5wdXNoKCB7CgkJCXN0YXJ0OiBoYXNJbmRleCA/IHJlc2VydmVkUmFuZ2UuaW5kZXhTdGFydCA6IHJlc2VydmVkUmFuZ2UudmVydGV4U3RhcnQsCgkJCWNvdW50OiAtIDEKCQl9ICk7CgkJYm91bmRzLnB1c2goIHsKCQkJYm94SW5pdGlhbGl6ZWQ6IGZhbHNlLAoJCQlib3g6IG5ldyBCb3gzKCksCgoJCQlzcGhlcmVJbml0aWFsaXplZDogZmFsc2UsCgkJCXNwaGVyZTogbmV3IFNwaGVyZSgpCgkJfSApOwoKCQkvLyBzZXQgdGhlIGlkIGZvciB0aGUgZ2VvbWV0cnkKCQljb25zdCBpZEF0dHJpYnV0ZSA9IHRoaXMuZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCBJRF9BVFRSX05BTUUgKTsKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCByZXNlcnZlZFJhbmdlLnZlcnRleENvdW50OyBpICsrICkgewoKCQkJaWRBdHRyaWJ1dGUuc2V0WCggcmVzZXJ2ZWRSYW5nZS52ZXJ0ZXhTdGFydCArIGksIGdlb21ldHJ5SWQgKTsKCgkJfQoKCQlpZEF0dHJpYnV0ZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCS8vIHVwZGF0ZSB0aGUgZ2VvbWV0cnkKCQl0aGlzLnNldEdlb21ldHJ5QXQoIGdlb21ldHJ5SWQsIGdlb21ldHJ5ICk7CgoJCXJldHVybiBnZW9tZXRyeUlkOwoKCX0KCglzZXRHZW9tZXRyeUF0KCBpZCwgZ2VvbWV0cnkgKSB7CgoJCWlmICggaWQgPj0gdGhpcy5fZ2VvbWV0cnlDb3VudCApIHsKCgkJCXRocm93IG5ldyBFcnJvciggJ0JhdGNoZWRNZXNoOiBNYXhpbXVtIGdlb21ldHJ5IGNvdW50IHJlYWNoZWQuJyApOwoKCQl9CgoJCXRoaXMuX3ZhbGlkYXRlR2VvbWV0cnkoIGdlb21ldHJ5ICk7CgoJCWNvbnN0IGJhdGNoR2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCWNvbnN0IGhhc0luZGV4ID0gYmF0Y2hHZW9tZXRyeS5nZXRJbmRleCgpICE9PSBudWxsOwoJCWNvbnN0IGRzdEluZGV4ID0gYmF0Y2hHZW9tZXRyeS5nZXRJbmRleCgpOwoJCWNvbnN0IHNyY0luZGV4ID0gZ2VvbWV0cnkuZ2V0SW5kZXgoKTsKCQljb25zdCByZXNlcnZlZFJhbmdlID0gdGhpcy5fcmVzZXJ2ZWRSYW5nZXNbIGlkIF07CgkJaWYgKAoJCQloYXNJbmRleCAmJgoJCQlzcmNJbmRleC5jb3VudCA+IHJlc2VydmVkUmFuZ2UuaW5kZXhDb3VudCB8fAoJCQlnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmNvdW50ID4gcmVzZXJ2ZWRSYW5nZS52ZXJ0ZXhDb3VudAoJCSkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnQmF0Y2hlZE1lc2g6IFJlc2VydmVkIHNwYWNlIG5vdCBsYXJnZSBlbm91Z2ggZm9yIHByb3ZpZGVkIGdlb21ldHJ5LicgKTsKCgkJfQoKCQkvLyBjb3B5IGdlb21ldHJ5IG92ZXIKCQljb25zdCB2ZXJ0ZXhTdGFydCA9IHJlc2VydmVkUmFuZ2UudmVydGV4U3RhcnQ7CgkJY29uc3QgdmVydGV4Q291bnQgPSByZXNlcnZlZFJhbmdlLnZlcnRleENvdW50OwoJCWZvciAoIGNvbnN0IGF0dHJpYnV0ZU5hbWUgaW4gYmF0Y2hHZW9tZXRyeS5hdHRyaWJ1dGVzICkgewoKCQkJaWYgKCBhdHRyaWJ1dGVOYW1lID09PSBJRF9BVFRSX05BTUUgKSB7CgoJCQkJY29udGludWU7CgoJCQl9CgoJCQkvLyBjb3B5IGF0dHJpYnV0ZSBkYXRhCgkJCWNvbnN0IHNyY0F0dHJpYnV0ZSA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggYXR0cmlidXRlTmFtZSApOwoJCQljb25zdCBkc3RBdHRyaWJ1dGUgPSBiYXRjaEdlb21ldHJ5LmdldEF0dHJpYnV0ZSggYXR0cmlidXRlTmFtZSApOwoJCQljb3B5QXR0cmlidXRlRGF0YSggc3JjQXR0cmlidXRlLCBkc3RBdHRyaWJ1dGUsIHZlcnRleFN0YXJ0ICk7CgoJCQkvLyBmaWxsIHRoZSByZXN0IGluIHdpdGggemVyb2VzCgkJCWNvbnN0IGl0ZW1TaXplID0gc3JjQXR0cmlidXRlLml0ZW1TaXplOwoJCQlmb3IgKCBsZXQgaSA9IHNyY0F0dHJpYnV0ZS5jb3VudCwgbCA9IHZlcnRleENvdW50OyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBpbmRleCA9IHZlcnRleFN0YXJ0ICsgaTsKCQkJCWZvciAoIGxldCBjID0gMDsgYyA8IGl0ZW1TaXplOyBjICsrICkgewoKCQkJCQlkc3RBdHRyaWJ1dGUuc2V0Q29tcG9uZW50KCBpbmRleCwgYywgMCApOwoKCQkJCX0KCgkJCX0KCgkJCWRzdEF0dHJpYnV0ZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJLy8gY29weSBpbmRleAoJCWlmICggaGFzSW5kZXggKSB7CgoJCQljb25zdCBpbmRleFN0YXJ0ID0gcmVzZXJ2ZWRSYW5nZS5pbmRleFN0YXJ0OwoKCQkJLy8gY29weSBpbmRleCBkYXRhIG92ZXIKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgc3JjSW5kZXguY291bnQ7IGkgKysgKSB7CgoJCQkJZHN0SW5kZXguc2V0WCggaW5kZXhTdGFydCArIGksIHZlcnRleFN0YXJ0ICsgc3JjSW5kZXguZ2V0WCggaSApICk7CgoJCQl9CgoJCQkvLyBmaWxsIHRoZSByZXN0IGluIHdpdGggemVyb2VzCgkJCWZvciAoIGxldCBpID0gc3JjSW5kZXguY291bnQsIGwgPSByZXNlcnZlZFJhbmdlLmluZGV4Q291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCWRzdEluZGV4LnNldFgoIGluZGV4U3RhcnQgKyBpLCB2ZXJ0ZXhTdGFydCApOwoKCQkJfQoKCQkJZHN0SW5kZXgubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9CgoJCS8vIHN0b3JlIHRoZSBib3VuZGluZyBib3hlcwoJCWNvbnN0IGJvdW5kID0gdGhpcy5fYm91bmRzWyBpZCBdOwoJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQlib3VuZC5ib3guY29weSggZ2VvbWV0cnkuYm91bmRpbmdCb3ggKTsKCQkJYm91bmQuYm94SW5pdGlhbGl6ZWQgPSB0cnVlOwoKCQl9IGVsc2UgewoKCQkJYm91bmQuYm94SW5pdGlhbGl6ZWQgPSBmYWxzZTsKCgkJfQoKCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlICE9PSBudWxsICkgewoKCQkJYm91bmQuc3BoZXJlLmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlICk7CgkJCWJvdW5kLnNwaGVyZUluaXRpYWxpemVkID0gdHJ1ZTsKCgkJfSBlbHNlIHsKCgkJCWJvdW5kLnNwaGVyZUluaXRpYWxpemVkID0gZmFsc2U7CgoJCX0KCgkJLy8gc2V0IGRyYXdSYW5nZSBjb3VudAoJCWNvbnN0IGRyYXdSYW5nZSA9IHRoaXMuX2RyYXdSYW5nZXNbIGlkIF07CgkJY29uc3QgcG9zQXR0ciA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoJCWRyYXdSYW5nZS5jb3VudCA9IGhhc0luZGV4ID8gc3JjSW5kZXguY291bnQgOiBwb3NBdHRyLmNvdW50OwoJCXRoaXMuX3Zpc2liaWxpdHlDaGFuZ2VkID0gdHJ1ZTsKCgkJcmV0dXJuIGlkOwoKCX0KCglkZWxldGVHZW9tZXRyeSggZ2VvbWV0cnlJZCApIHsKCgkJLy8gTm90ZTogVXNlciBuZWVkcyB0byBjYWxsIG9wdGltaXplKCkgYWZ0ZXJ3YXJkIHRvIHBhY2sgdGhlIGRhdGEuCgoJCWNvbnN0IGFjdGl2ZSA9IHRoaXMuX2FjdGl2ZTsKCQlpZiAoIGdlb21ldHJ5SWQgPj0gYWN0aXZlLmxlbmd0aCB8fCBhY3RpdmVbIGdlb21ldHJ5SWQgXSA9PT0gZmFsc2UgKSB7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlhY3RpdmVbIGdlb21ldHJ5SWQgXSA9IGZhbHNlOwoJCXRoaXMuX3Zpc2liaWxpdHlDaGFuZ2VkID0gdHJ1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vIGdldCBib3VuZGluZyBib3ggYW5kIGNvbXB1dGUgaXQgaWYgaXQgZG9lc24ndCBleGlzdAoJZ2V0Qm91bmRpbmdCb3hBdCggaWQsIHRhcmdldCApIHsKCgkJY29uc3QgYWN0aXZlID0gdGhpcy5fYWN0aXZlOwoJCWlmICggYWN0aXZlWyBpZCBdID09PSBmYWxzZSApIHsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8vIGNvbXB1dGUgYm91bmRpbmcgYm94CgkJY29uc3QgYm91bmQgPSB0aGlzLl9ib3VuZHNbIGlkIF07CgkJY29uc3QgYm94ID0gYm91bmQuYm94OwoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQlpZiAoIGJvdW5kLmJveEluaXRpYWxpemVkID09PSBmYWxzZSApIHsKCgkJCWJveC5tYWtlRW1wdHkoKTsKCgkJCWNvbnN0IGluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CgkJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgZHJhd1JhbmdlID0gdGhpcy5fZHJhd1Jhbmdlc1sgaWQgXTsKCQkJZm9yICggbGV0IGkgPSBkcmF3UmFuZ2Uuc3RhcnQsIGwgPSBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCWxldCBpdiA9IGk7CgkJCQlpZiAoIGluZGV4ICkgewoKCQkJCQlpdiA9IGluZGV4LmdldFgoIGl2ICk7CgoJCQkJfQoKCQkJCWJveC5leHBhbmRCeVBvaW50KCBfdmVjdG9yJDUuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGl2ICkgKTsKCgkJCX0KCgkJCWJvdW5kLmJveEluaXRpYWxpemVkID0gdHJ1ZTsKCgkJfQoKCQl0YXJnZXQuY29weSggYm94ICk7CgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJLy8gZ2V0IGJvdW5kaW5nIHNwaGVyZSBhbmQgY29tcHV0ZSBpdCBpZiBpdCBkb2Vzbid0IGV4aXN0CglnZXRCb3VuZGluZ1NwaGVyZUF0KCBpZCwgdGFyZ2V0ICkgewoKCQljb25zdCBhY3RpdmUgPSB0aGlzLl9hY3RpdmU7CgkJaWYgKCBhY3RpdmVbIGlkIF0gPT09IGZhbHNlICkgewoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLy8gY29tcHV0ZSBib3VuZGluZyBzcGhlcmUKCQljb25zdCBib3VuZCA9IHRoaXMuX2JvdW5kc1sgaWQgXTsKCQljb25zdCBzcGhlcmUgPSBib3VuZC5zcGhlcmU7CgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCWlmICggYm91bmQuc3BoZXJlSW5pdGlhbGl6ZWQgPT09IGZhbHNlICkgewoKCQkJc3BoZXJlLm1ha2VFbXB0eSgpOwoKCQkJdGhpcy5nZXRCb3VuZGluZ0JveEF0KCBpZCwgX2JveCQxICk7CgkJCV9ib3gkMS5nZXRDZW50ZXIoIHNwaGVyZS5jZW50ZXIgKTsKCgkJCWNvbnN0IGluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CgkJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgZHJhd1JhbmdlID0gdGhpcy5fZHJhd1Jhbmdlc1sgaWQgXTsKCgkJCWxldCBtYXhSYWRpdXNTcSA9IDA7CgkJCWZvciAoIGxldCBpID0gZHJhd1JhbmdlLnN0YXJ0LCBsID0gZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCgkJCQlsZXQgaXYgPSBpOwoJCQkJaWYgKCBpbmRleCApIHsKCgkJCQkJaXYgPSBpbmRleC5nZXRYKCBpdiApOwoKCQkJCX0KCgkJCQlfdmVjdG9yJDUuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGl2ICk7CgkJCQltYXhSYWRpdXNTcSA9IE1hdGgubWF4KCBtYXhSYWRpdXNTcSwgc3BoZXJlLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggX3ZlY3RvciQ1ICkgKTsKCgkJCX0KCgkJCXNwaGVyZS5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgkJCWJvdW5kLnNwaGVyZUluaXRpYWxpemVkID0gdHJ1ZTsKCgkJfQoKCQl0YXJnZXQuY29weSggc3BoZXJlICk7CgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJc2V0TWF0cml4QXQoIGdlb21ldHJ5SWQsIG1hdHJpeCApIHsKCgkJLy8gQFRPRE86IE1hcCBnZW9tZXRyeUlkIHRvIGluZGV4IG9mIHRoZSBhcnJheXMgYmVjYXVzZQoJCS8vICAgICAgICBvcHRpbWl6ZSgpIGNhbiBtYWtlIGdlb21ldHJ5SWQgbWlzbWF0Y2ggdGhlIGluZGV4CgoJCWNvbnN0IGFjdGl2ZSA9IHRoaXMuX2FjdGl2ZTsKCQljb25zdCBtYXRyaWNlc1RleHR1cmUgPSB0aGlzLl9tYXRyaWNlc1RleHR1cmU7CgkJY29uc3QgbWF0cmljZXNBcnJheSA9IHRoaXMuX21hdHJpY2VzVGV4dHVyZS5pbWFnZS5kYXRhOwoJCWNvbnN0IGdlb21ldHJ5Q291bnQgPSB0aGlzLl9nZW9tZXRyeUNvdW50OwoJCWlmICggZ2VvbWV0cnlJZCA+PSBnZW9tZXRyeUNvdW50IHx8IGFjdGl2ZVsgZ2VvbWV0cnlJZCBdID09PSBmYWxzZSApIHsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCW1hdHJpeC50b0FycmF5KCBtYXRyaWNlc0FycmF5LCBnZW9tZXRyeUlkICogMTYgKTsKCQltYXRyaWNlc1RleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0TWF0cml4QXQoIGdlb21ldHJ5SWQsIG1hdHJpeCApIHsKCgkJY29uc3QgYWN0aXZlID0gdGhpcy5fYWN0aXZlOwoJCWNvbnN0IG1hdHJpY2VzQXJyYXkgPSB0aGlzLl9tYXRyaWNlc1RleHR1cmUuaW1hZ2UuZGF0YTsKCQljb25zdCBnZW9tZXRyeUNvdW50ID0gdGhpcy5fZ2VvbWV0cnlDb3VudDsKCQlpZiAoIGdlb21ldHJ5SWQgPj0gZ2VvbWV0cnlDb3VudCB8fCBhY3RpdmVbIGdlb21ldHJ5SWQgXSA9PT0gZmFsc2UgKSB7CgoJCQlyZXR1cm4gbnVsbDsKCgkJfQoKCQlyZXR1cm4gbWF0cml4LmZyb21BcnJheSggbWF0cmljZXNBcnJheSwgZ2VvbWV0cnlJZCAqIDE2ICk7CgoJfQoKCXNldFZpc2libGVBdCggZ2VvbWV0cnlJZCwgdmFsdWUgKSB7CgoJCWNvbnN0IHZpc2liaWxpdHkgPSB0aGlzLl92aXNpYmlsaXR5OwoJCWNvbnN0IGFjdGl2ZSA9IHRoaXMuX2FjdGl2ZTsKCQljb25zdCBnZW9tZXRyeUNvdW50ID0gdGhpcy5fZ2VvbWV0cnlDb3VudDsKCgkJLy8gaWYgdGhlIGdlb21ldHJ5IGlzIG91dCBvZiByYW5nZSwgbm90IGFjdGl2ZSwgb3IgdmlzaWJpbGl0eSBzdGF0ZQoJCS8vIGRvZXMgbm90IGNoYW5nZSB0aGVuIHJldHVybiBlYXJseQoJCWlmICgKCQkJZ2VvbWV0cnlJZCA+PSBnZW9tZXRyeUNvdW50IHx8CgkJCWFjdGl2ZVsgZ2VvbWV0cnlJZCBdID09PSBmYWxzZSB8fAoJCQl2aXNpYmlsaXR5WyBnZW9tZXRyeUlkIF0gPT09IHZhbHVlCgkJKSB7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQl2aXNpYmlsaXR5WyBnZW9tZXRyeUlkIF0gPSB2YWx1ZTsKCQl0aGlzLl92aXNpYmlsaXR5Q2hhbmdlZCA9IHRydWU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRWaXNpYmxlQXQoIGdlb21ldHJ5SWQgKSB7CgoJCWNvbnN0IHZpc2liaWxpdHkgPSB0aGlzLl92aXNpYmlsaXR5OwoJCWNvbnN0IGFjdGl2ZSA9IHRoaXMuX2FjdGl2ZTsKCQljb25zdCBnZW9tZXRyeUNvdW50ID0gdGhpcy5fZ2VvbWV0cnlDb3VudDsKCgkJLy8gcmV0dXJuIGVhcmx5IGlmIHRoZSBnZW9tZXRyeSBpcyBvdXQgb2YgcmFuZ2Ugb3Igbm90IGFjdGl2ZQoJCWlmICggZ2VvbWV0cnlJZCA+PSBnZW9tZXRyeUNvdW50IHx8IGFjdGl2ZVsgZ2VvbWV0cnlJZCBdID09PSBmYWxzZSApIHsKCgkJCXJldHVybiBmYWxzZTsKCgkJfQoKCQlyZXR1cm4gdmlzaWJpbGl0eVsgZ2VvbWV0cnlJZCBdOwoKCX0KCglyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgoJCWNvbnN0IHZpc2liaWxpdHkgPSB0aGlzLl92aXNpYmlsaXR5OwoJCWNvbnN0IGFjdGl2ZSA9IHRoaXMuX2FjdGl2ZTsKCQljb25zdCBkcmF3UmFuZ2VzID0gdGhpcy5fZHJhd1JhbmdlczsKCQljb25zdCBnZW9tZXRyeUNvdW50ID0gdGhpcy5fZ2VvbWV0cnlDb3VudDsKCQljb25zdCBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CgkJY29uc3QgYmF0Y2hHZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgoJCS8vIGl0ZXJhdGUgb3ZlciBlYWNoIGdlb21ldHJ5CgkJX21lc2gubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoJCV9tZXNoLmdlb21ldHJ5LmluZGV4ID0gYmF0Y2hHZW9tZXRyeS5pbmRleDsKCQlfbWVzaC5nZW9tZXRyeS5hdHRyaWJ1dGVzID0gYmF0Y2hHZW9tZXRyeS5hdHRyaWJ1dGVzOwoJCWlmICggX21lc2guZ2VvbWV0cnkuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQlfbWVzaC5nZW9tZXRyeS5ib3VuZGluZ0JveCA9IG5ldyBCb3gzKCk7CgoJCX0KCgkJaWYgKCBfbWVzaC5nZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIHsKCgkJCV9tZXNoLmdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID0gbmV3IFNwaGVyZSgpOwoKCQl9CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGdlb21ldHJ5Q291bnQ7IGkgKysgKSB7CgoJCQlpZiAoICEgdmlzaWJpbGl0eVsgaSBdIHx8ICEgYWN0aXZlWyBpIF0gKSB7CgoJCQkJY29udGludWU7CgoJCQl9CgoJCQljb25zdCBkcmF3UmFuZ2UgPSBkcmF3UmFuZ2VzWyBpIF07CgkJCV9tZXNoLmdlb21ldHJ5LnNldERyYXdSYW5nZSggZHJhd1JhbmdlLnN0YXJ0LCBkcmF3UmFuZ2UuY291bnQgKTsKCgkJCS8vIGdlIHRoZSBpbnRlcnNlY3RzCgkJCXRoaXMuZ2V0TWF0cml4QXQoIGksIF9tZXNoLm1hdHJpeFdvcmxkICkucHJlbXVsdGlwbHkoIG1hdHJpeFdvcmxkICk7CgkJCXRoaXMuZ2V0Qm91bmRpbmdCb3hBdCggaSwgX21lc2guZ2VvbWV0cnkuYm91bmRpbmdCb3ggKTsKCQkJdGhpcy5nZXRCb3VuZGluZ1NwaGVyZUF0KCBpLCBfbWVzaC5nZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSApOwoJCQlfbWVzaC5yYXljYXN0KCByYXljYXN0ZXIsIF9iYXRjaEludGVyc2VjdHMgKTsKCgkJCS8vIGFkZCBiYXRjaCBpZCB0byB0aGUgaW50ZXJzZWN0cwoJCQlmb3IgKCBsZXQgaiA9IDAsIGwgPSBfYmF0Y2hJbnRlcnNlY3RzLmxlbmd0aDsgaiA8IGw7IGogKysgKSB7CgoJCQkJY29uc3QgaW50ZXJzZWN0ID0gX2JhdGNoSW50ZXJzZWN0c1sgaiBdOwoJCQkJaW50ZXJzZWN0Lm9iamVjdCA9IHRoaXM7CgkJCQlpbnRlcnNlY3QuYmF0Y2hJZCA9IGk7CgkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdCApOwoKCQkJfQoKCQkJX2JhdGNoSW50ZXJzZWN0cy5sZW5ndGggPSAwOwoKCQl9CgoJCV9tZXNoLm1hdGVyaWFsID0gbnVsbDsKCQlfbWVzaC5nZW9tZXRyeS5pbmRleCA9IG51bGw7CgkJX21lc2guZ2VvbWV0cnkuYXR0cmlidXRlcyA9IHt9OwoJCV9tZXNoLmdlb21ldHJ5LnNldERyYXdSYW5nZSggMCwgSW5maW5pdHkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5nZW9tZXRyeSA9IHNvdXJjZS5nZW9tZXRyeS5jbG9uZSgpOwoJCXRoaXMucGVyT2JqZWN0RnJ1c3R1bUN1bGxlZCA9IHNvdXJjZS5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkOwoJCXRoaXMuc29ydE9iamVjdHMgPSBzb3VyY2Uuc29ydE9iamVjdHM7CgkJdGhpcy5ib3VuZGluZ0JveCA9IHNvdXJjZS5ib3VuZGluZ0JveCAhPT0gbnVsbCA/IHNvdXJjZS5ib3VuZGluZ0JveC5jbG9uZSgpIDogbnVsbDsKCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gc291cmNlLmJvdW5kaW5nU3BoZXJlICE9PSBudWxsID8gc291cmNlLmJvdW5kaW5nU3BoZXJlLmNsb25lKCkgOiBudWxsOwoKCQl0aGlzLl9kcmF3UmFuZ2VzID0gc291cmNlLl9kcmF3UmFuZ2VzLm1hcCggcmFuZ2UgPT4gKCB7IC4uLnJhbmdlIH0gKSApOwoJCXRoaXMuX3Jlc2VydmVkUmFuZ2VzID0gc291cmNlLl9yZXNlcnZlZFJhbmdlcy5tYXAoIHJhbmdlID0+ICggeyAuLi5yYW5nZSB9ICkgKTsKCgkJdGhpcy5fdmlzaWJpbGl0eSA9IHNvdXJjZS5fdmlzaWJpbGl0eS5zbGljZSgpOwoJCXRoaXMuX2FjdGl2ZSA9IHNvdXJjZS5fYWN0aXZlLnNsaWNlKCk7CgkJdGhpcy5fYm91bmRzID0gc291cmNlLl9ib3VuZHMubWFwKCBib3VuZCA9PiAoIHsKCQkJYm94SW5pdGlhbGl6ZWQ6IGJvdW5kLmJveEluaXRpYWxpemVkLAoJCQlib3g6IGJvdW5kLmJveC5jbG9uZSgpLAoKCQkJc3BoZXJlSW5pdGlhbGl6ZWQ6IGJvdW5kLnNwaGVyZUluaXRpYWxpemVkLAoJCQlzcGhlcmU6IGJvdW5kLnNwaGVyZS5jbG9uZSgpCgkJfSApICk7CgoJCXRoaXMuX21heEdlb21ldHJ5Q291bnQgPSBzb3VyY2UuX21heEdlb21ldHJ5Q291bnQ7CgkJdGhpcy5fbWF4VmVydGV4Q291bnQgPSBzb3VyY2UuX21heFZlcnRleENvdW50OwoJCXRoaXMuX21heEluZGV4Q291bnQgPSBzb3VyY2UuX21heEluZGV4Q291bnQ7CgoJCXRoaXMuX2dlb21ldHJ5SW5pdGlhbGl6ZWQgPSBzb3VyY2UuX2dlb21ldHJ5SW5pdGlhbGl6ZWQ7CgkJdGhpcy5fZ2VvbWV0cnlDb3VudCA9IHNvdXJjZS5fZ2VvbWV0cnlDb3VudDsKCQl0aGlzLl9tdWx0aURyYXdDb3VudHMgPSBzb3VyY2UuX211bHRpRHJhd0NvdW50cy5zbGljZSgpOwoJCXRoaXMuX211bHRpRHJhd1N0YXJ0cyA9IHNvdXJjZS5fbXVsdGlEcmF3U3RhcnRzLnNsaWNlKCk7CgoJCXRoaXMuX21hdHJpY2VzVGV4dHVyZSA9IHNvdXJjZS5fbWF0cmljZXNUZXh0dXJlLmNsb25lKCk7CgkJdGhpcy5fbWF0cmljZXNUZXh0dXJlLmltYWdlLmRhdGEgPSB0aGlzLl9tYXRyaWNlc1RleHR1cmUuaW1hZ2Uuc2xpY2UoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCS8vIEFzc3VtaW5nIHRoZSBnZW9tZXRyeSBpcyBub3Qgc2hhcmVkIHdpdGggb3RoZXIgbWVzaGVzCgkJdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7CgoJCXRoaXMuX21hdHJpY2VzVGV4dHVyZS5kaXNwb3NlKCk7CgkJdGhpcy5fbWF0cmljZXNUZXh0dXJlID0gbnVsbDsKCQlyZXR1cm4gdGhpczsKCgl9CgoJb25CZWZvcmVSZW5kZXIoIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwvKiwgX2dyb3VwKi8gKSB7CgoJCS8vIGlmIHZpc2liaWxpdHkgaGFzIG5vdCBjaGFuZ2VkIGFuZCBmcnVzdHVtIGN1bGxpbmcgYW5kIG9iamVjdCBzb3J0aW5nIGlzIG5vdCByZXF1aXJlZAoJCS8vIHRoZW4gc2tpcCBpdGVyYXRpbmcgb3ZlciBhbGwgaXRlbXMKCQlpZiAoICEgdGhpcy5fdmlzaWJpbGl0eUNoYW5nZWQgJiYgISB0aGlzLnBlck9iamVjdEZydXN0dW1DdWxsZWQgJiYgISB0aGlzLnNvcnRPYmplY3RzICkgewoKCQkJcmV0dXJuOwoKCQl9CgoJCS8vIHRoZSBpbmRleGVkIHZlcnNpb24gb2YgdGhlIG11bHRpIGRyYXcgZnVuY3Rpb24gcmVxdWlyZXMgc3BlY2lmeWluZyB0aGUgc3RhcnQKCQkvLyBvZmZzZXQgaW4gYnl0ZXMuCgkJY29uc3QgaW5kZXggPSBnZW9tZXRyeS5nZXRJbmRleCgpOwoJCWNvbnN0IGJ5dGVzUGVyRWxlbWVudCA9IGluZGV4ID09PSBudWxsID8gMSA6IGluZGV4LmFycmF5LkJZVEVTX1BFUl9FTEVNRU5UOwoKCQljb25zdCB2aXNpYmlsaXR5ID0gdGhpcy5fdmlzaWJpbGl0eTsKCQljb25zdCBtdWx0aURyYXdTdGFydHMgPSB0aGlzLl9tdWx0aURyYXdTdGFydHM7CgkJY29uc3QgbXVsdGlEcmF3Q291bnRzID0gdGhpcy5fbXVsdGlEcmF3Q291bnRzOwoJCWNvbnN0IGRyYXdSYW5nZXMgPSB0aGlzLl9kcmF3UmFuZ2VzOwoJCWNvbnN0IHBlck9iamVjdEZydXN0dW1DdWxsZWQgPSB0aGlzLnBlck9iamVjdEZydXN0dW1DdWxsZWQ7CgoJCS8vIHByZXBhcmUgdGhlIGZydXN0dW0gaW4gdGhlIGxvY2FsIGZyYW1lCgkJaWYgKCBwZXJPYmplY3RGcnVzdHVtQ3VsbGVkICkgewoKCQkJX3Byb2pTY3JlZW5NYXRyaXgkMgoJCQkJLm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICkKCQkJCS5tdWx0aXBseSggdGhpcy5tYXRyaXhXb3JsZCApOwoJCQlfZnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCgKCQkJCV9wcm9qU2NyZWVuTWF0cml4JDIsCgkJCQlyZW5kZXJlci5pc1dlYkdQVVJlbmRlcmVyID8gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSA6IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbQoJCQkpOwoKCQl9CgoJCWxldCBjb3VudCA9IDA7CgkJaWYgKCB0aGlzLnNvcnRPYmplY3RzICkgewoKCQkJLy8gZ2V0IHRoZSBjYW1lcmEgcG9zaXRpb24gaW4gdGhlIGxvY2FsIGZyYW1lCgkJCV9pbnZNYXRyaXhXb3JsZC5jb3B5KCB0aGlzLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgkJCV92ZWN0b3IkNS5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGNhbWVyYS5tYXRyaXhXb3JsZCApLmFwcGx5TWF0cml4NCggX2ludk1hdHJpeFdvcmxkICk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB2aXNpYmlsaXR5Lmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJaWYgKCB2aXNpYmlsaXR5WyBpIF0gKSB7CgoJCQkJCS8vIGdldCB0aGUgYm91bmRzIGluIHdvcmxkIHNwYWNlCgkJCQkJdGhpcy5nZXRNYXRyaXhBdCggaSwgX21hdHJpeCApOwoJCQkJCXRoaXMuZ2V0Qm91bmRpbmdTcGhlcmVBdCggaSwgX3NwaGVyZSQyICkuYXBwbHlNYXRyaXg0KCBfbWF0cml4ICk7CgoJCQkJCS8vIGRldGVybWluZSB3aGV0aGVyIHRoZSBiYXRjaGVkIGdlb21ldHJ5IGlzIHdpdGhpbiB0aGUgZnJ1c3R1bQoJCQkJCWxldCBjdWxsZWQgPSBmYWxzZTsKCQkJCQlpZiAoIHBlck9iamVjdEZydXN0dW1DdWxsZWQgKSB7CgoJCQkJCQljdWxsZWQgPSAhIF9mcnVzdHVtLmludGVyc2VjdHNTcGhlcmUoIF9zcGhlcmUkMiApOwoKCQkJCQl9CgoJCQkJCWlmICggISBjdWxsZWQgKSB7CgoJCQkJCQkvLyBnZXQgdGhlIGRpc3RhbmNlIGZyb20gY2FtZXJhIHVzZWQgZm9yIHNvcnRpbmcKCQkJCQkJY29uc3QgeiA9IF92ZWN0b3IkNS5kaXN0YW5jZVRvKCBfc3BoZXJlJDIuY2VudGVyICk7CgkJCQkJCV9yZW5kZXJMaXN0LnB1c2goIGRyYXdSYW5nZXNbIGkgXSwgeiApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLy8gU29ydCB0aGUgZHJhdyByYW5nZXMgYW5kIHByZXAgZm9yIHJlbmRlcmluZwoJCQljb25zdCBsaXN0ID0gX3JlbmRlckxpc3QubGlzdDsKCQkJY29uc3QgY3VzdG9tU29ydCA9IHRoaXMuY3VzdG9tU29ydDsKCQkJaWYgKCBjdXN0b21Tb3J0ID09PSBudWxsICkgewoKCQkJCWxpc3Quc29ydCggbWF0ZXJpYWwudHJhbnNwYXJlbnQgPyBzb3J0VHJhbnNwYXJlbnQgOiBzb3J0T3BhcXVlICk7CgoJCQl9IGVsc2UgewoKCQkJCWN1c3RvbVNvcnQuY2FsbCggdGhpcywgbGlzdCwgY2FtZXJhICk7CgoJCQl9CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBsaXN0Lmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgaXRlbSA9IGxpc3RbIGkgXTsKCQkJCW11bHRpRHJhd1N0YXJ0c1sgY291bnQgXSA9IGl0ZW0uc3RhcnQgKiBieXRlc1BlckVsZW1lbnQ7CgkJCQltdWx0aURyYXdDb3VudHNbIGNvdW50IF0gPSBpdGVtLmNvdW50OwoJCQkJY291bnQgKys7CgoJCQl9CgoJCQlfcmVuZGVyTGlzdC5yZXNldCgpOwoKCQl9IGVsc2UgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdmlzaWJpbGl0eS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWlmICggdmlzaWJpbGl0eVsgaSBdICkgewoKCQkJCQkvLyBkZXRlcm1pbmUgd2hldGhlciB0aGUgYmF0Y2hlZCBnZW9tZXRyeSBpcyB3aXRoaW4gdGhlIGZydXN0dW0KCQkJCQlsZXQgY3VsbGVkID0gZmFsc2U7CgkJCQkJaWYgKCBwZXJPYmplY3RGcnVzdHVtQ3VsbGVkICkgewoKCQkJCQkJLy8gZ2V0IHRoZSBib3VuZHMgaW4gd29ybGQgc3BhY2UKCQkJCQkJdGhpcy5nZXRNYXRyaXhBdCggaSwgX21hdHJpeCApOwoJCQkJCQl0aGlzLmdldEJvdW5kaW5nU3BoZXJlQXQoIGksIF9zcGhlcmUkMiApLmFwcGx5TWF0cml4NCggX21hdHJpeCApOwoJCQkJCQljdWxsZWQgPSAhIF9mcnVzdHVtLmludGVyc2VjdHNTcGhlcmUoIF9zcGhlcmUkMiApOwoKCQkJCQl9CgoJCQkJCWlmICggISBjdWxsZWQgKSB7CgoJCQkJCQljb25zdCByYW5nZSA9IGRyYXdSYW5nZXNbIGkgXTsKCQkJCQkJbXVsdGlEcmF3U3RhcnRzWyBjb3VudCBdID0gcmFuZ2Uuc3RhcnQgKiBieXRlc1BlckVsZW1lbnQ7CgkJCQkJCW11bHRpRHJhd0NvdW50c1sgY291bnQgXSA9IHJhbmdlLmNvdW50OwoJCQkJCQljb3VudCArKzsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfQoKCQl0aGlzLl9tdWx0aURyYXdDb3VudCA9IGNvdW50OwoJCXRoaXMuX3Zpc2liaWxpdHlDaGFuZ2VkID0gZmFsc2U7CgoJfQoKCW9uQmVmb3JlU2hhZG93KCByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwvKiAsIGdyb3VwICovICkgewoKCQl0aGlzLm9uQmVmb3JlUmVuZGVyKCByZW5kZXJlciwgbnVsbCwgc2hhZG93Q2FtZXJhLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCApOwoKCX0KCn0KCmNsYXNzIExpbmVCYXNpY01hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTGluZUJhc2ljTWF0ZXJpYWwgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnTGluZUJhc2ljTWF0ZXJpYWwnOwoKCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCAweGZmZmZmZiApOwoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMubGluZXdpZHRoID0gMTsKCQl0aGlzLmxpbmVjYXAgPSAncm91bmQnOwoJCXRoaXMubGluZWpvaW4gPSAncm91bmQnOwoKCQl0aGlzLmZvZyA9IHRydWU7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMubGluZXdpZHRoID0gc291cmNlLmxpbmV3aWR0aDsKCQl0aGlzLmxpbmVjYXAgPSBzb3VyY2UubGluZWNhcDsKCQl0aGlzLmxpbmVqb2luID0gc291cmNlLmxpbmVqb2luOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNvbnN0IF9zdGFydCQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfZW5kJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9pbnZlcnNlTWF0cml4JDEgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9yYXkkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFJheSgpOwpjb25zdCBfc3BoZXJlJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBTcGhlcmUoKTsKCmNsYXNzIExpbmUgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoIGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCksIG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCkgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNMaW5lID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0xpbmUnOwoKCQl0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgkJdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsOwoKCQl0aGlzLnVwZGF0ZU1vcnBoVGFyZ2V0cygpOwoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJdGhpcy5tYXRlcmlhbCA9IEFycmF5LmlzQXJyYXkoIHNvdXJjZS5tYXRlcmlhbCApID8gc291cmNlLm1hdGVyaWFsLnNsaWNlKCkgOiBzb3VyY2UubWF0ZXJpYWw7CgkJdGhpcy5nZW9tZXRyeSA9IHNvdXJjZS5nZW9tZXRyeTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvbXB1dGVMaW5lRGlzdGFuY2VzKCkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgoJCS8vIHdlIGFzc3VtZSBub24taW5kZXhlZCBnZW9tZXRyeQoKCQlpZiAoIGdlb21ldHJ5LmluZGV4ID09PSBudWxsICkgewoKCQkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQljb25zdCBsaW5lRGlzdGFuY2VzID0gWyAwIF07CgoJCQlmb3IgKCBsZXQgaSA9IDEsIGwgPSBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJX3N0YXJ0JDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgLSAxICk7CgkJCQlfZW5kJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKTsKCgkJCQlsaW5lRGlzdGFuY2VzWyBpIF0gPSBsaW5lRGlzdGFuY2VzWyBpIC0gMSBdOwoJCQkJbGluZURpc3RhbmNlc1sgaSBdICs9IF9zdGFydCQxLmRpc3RhbmNlVG8oIF9lbmQkMSApOwoKCQkJfQoKCQkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAnbGluZURpc3RhbmNlJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGxpbmVEaXN0YW5jZXMsIDEgKSApOwoKCQl9IGVsc2UgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTGluZS5jb21wdXRlTGluZURpc3RhbmNlcygpOiBDb21wdXRhdGlvbiBvbmx5IHBvc3NpYmxlIHdpdGggbm9uLWluZGV4ZWQgQnVmZmVyR2VvbWV0cnkuJyApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQljb25zdCBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CgkJY29uc3QgdGhyZXNob2xkID0gcmF5Y2FzdGVyLnBhcmFtcy5MaW5lLnRocmVzaG9sZDsKCQljb25zdCBkcmF3UmFuZ2UgPSBnZW9tZXRyeS5kcmF3UmFuZ2U7CgoJCS8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlIGRpc3RhbmNlIHRvIHJheQoKCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCV9zcGhlcmUkMS5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSApOwoJCV9zcGhlcmUkMS5hcHBseU1hdHJpeDQoIG1hdHJpeFdvcmxkICk7CgkJX3NwaGVyZSQxLnJhZGl1cyArPSB0aHJlc2hvbGQ7CgoJCWlmICggcmF5Y2FzdGVyLnJheS5pbnRlcnNlY3RzU3BoZXJlKCBfc3BoZXJlJDEgKSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCS8vCgoJCV9pbnZlcnNlTWF0cml4JDEuY29weSggbWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCQlfcmF5JDEuY29weSggcmF5Y2FzdGVyLnJheSApLmFwcGx5TWF0cml4NCggX2ludmVyc2VNYXRyaXgkMSApOwoKCQljb25zdCBsb2NhbFRocmVzaG9sZCA9IHRocmVzaG9sZCAvICggKCB0aGlzLnNjYWxlLnggKyB0aGlzLnNjYWxlLnkgKyB0aGlzLnNjYWxlLnogKSAvIDMgKTsKCQljb25zdCBsb2NhbFRocmVzaG9sZFNxID0gbG9jYWxUaHJlc2hvbGQgKiBsb2NhbFRocmVzaG9sZDsKCgkJY29uc3QgdlN0YXJ0ID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCB2RW5kID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCBpbnRlclNlZ21lbnQgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IGludGVyUmF5ID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCBzdGVwID0gdGhpcy5pc0xpbmVTZWdtZW50cyA/IDIgOiAxOwoKCQljb25zdCBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCWNvbnN0IGF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCWNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoIDAsIGRyYXdSYW5nZS5zdGFydCApOwoJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggaW5kZXguY291bnQsICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKTsKCgkJCWZvciAoIGxldCBpID0gc3RhcnQsIGwgPSBlbmQgLSAxOyBpIDwgbDsgaSArPSBzdGVwICkgewoKCQkJCWNvbnN0IGEgPSBpbmRleC5nZXRYKCBpICk7CgkJCQljb25zdCBiID0gaW5kZXguZ2V0WCggaSArIDEgKTsKCgkJCQl2U3RhcnQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGEgKTsKCQkJCXZFbmQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGIgKTsKCgkJCQljb25zdCBkaXN0U3EgPSBfcmF5JDEuZGlzdGFuY2VTcVRvU2VnbWVudCggdlN0YXJ0LCB2RW5kLCBpbnRlclJheSwgaW50ZXJTZWdtZW50ICk7CgoJCQkJaWYgKCBkaXN0U3EgPiBsb2NhbFRocmVzaG9sZFNxICkgY29udGludWU7CgoJCQkJaW50ZXJSYXkuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICk7IC8vTW92ZSBiYWNrIHRvIHdvcmxkIHNwYWNlIGZvciBkaXN0YW5jZSBjYWxjdWxhdGlvbgoKCQkJCWNvbnN0IGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyggaW50ZXJSYXkgKTsKCgkJCQlpZiAoIGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyICkgY29udGludWU7CgoJCQkJaW50ZXJzZWN0cy5wdXNoKCB7CgoJCQkJCWRpc3RhbmNlOiBkaXN0YW5jZSwKCQkJCQkvLyBXaGF0IGRvIHdlIHdhbnQ/IGludGVyc2VjdGlvbiBwb2ludCBvbiB0aGUgcmF5IG9yIG9uIHRoZSBzZWdtZW50Pz8KCQkJCQkvLyBwb2ludDogcmF5Y2FzdGVyLnJheS5hdCggZGlzdGFuY2UgKSwKCQkJCQlwb2ludDogaW50ZXJTZWdtZW50LmNsb25lKCkuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICksCgkJCQkJaW5kZXg6IGksCgkJCQkJZmFjZTogbnVsbCwKCQkJCQlmYWNlSW5kZXg6IG51bGwsCgkJCQkJb2JqZWN0OiB0aGlzCgoJCQkJfSApOwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggMCwgZHJhd1JhbmdlLnN0YXJ0ICk7CgkJCWNvbnN0IGVuZCA9IE1hdGgubWluKCBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudCwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApOwoKCQkJZm9yICggbGV0IGkgPSBzdGFydCwgbCA9IGVuZCAtIDE7IGkgPCBsOyBpICs9IHN0ZXAgKSB7CgoJCQkJdlN0YXJ0LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICk7CgkJCQl2RW5kLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMSApOwoKCQkJCWNvbnN0IGRpc3RTcSA9IF9yYXkkMS5kaXN0YW5jZVNxVG9TZWdtZW50KCB2U3RhcnQsIHZFbmQsIGludGVyUmF5LCBpbnRlclNlZ21lbnQgKTsKCgkJCQlpZiAoIGRpc3RTcSA+IGxvY2FsVGhyZXNob2xkU3EgKSBjb250aW51ZTsKCgkJCQlpbnRlclJheS5hcHBseU1hdHJpeDQoIHRoaXMubWF0cml4V29ybGQgKTsgLy9Nb3ZlIGJhY2sgdG8gd29ybGQgc3BhY2UgZm9yIGRpc3RhbmNlIGNhbGN1bGF0aW9uCgoJCQkJY29uc3QgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKCBpbnRlclJheSApOwoKCQkJCWlmICggZGlzdGFuY2UgPCByYXljYXN0ZXIubmVhciB8fCBkaXN0YW5jZSA+IHJheWNhc3Rlci5mYXIgKSBjb250aW51ZTsKCgkJCQlpbnRlcnNlY3RzLnB1c2goIHsKCgkJCQkJZGlzdGFuY2U6IGRpc3RhbmNlLAoJCQkJCS8vIFdoYXQgZG8gd2Ugd2FudD8gaW50ZXJzZWN0aW9uIHBvaW50IG9uIHRoZSByYXkgb3Igb24gdGhlIHNlZ21lbnQ/PwoJCQkJCS8vIHBvaW50OiByYXljYXN0ZXIucmF5LmF0KCBkaXN0YW5jZSApLAoJCQkJCXBvaW50OiBpbnRlclNlZ21lbnQuY2xvbmUoKS5hcHBseU1hdHJpeDQoIHRoaXMubWF0cml4V29ybGQgKSwKCQkJCQlpbmRleDogaSwKCQkJCQlmYWNlOiBudWxsLAoJCQkJCWZhY2VJbmRleDogbnVsbCwKCQkJCQlvYmplY3Q6IHRoaXMKCgkJCQl9ICk7CgoJCQl9CgoJCX0KCgl9CgoJdXBkYXRlTW9ycGhUYXJnZXRzKCkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgoJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlczsKCQljb25zdCBrZXlzID0gT2JqZWN0LmtleXMoIG1vcnBoQXR0cmlidXRlcyApOwoKCQlpZiAoIGtleXMubGVuZ3RoID4gMCApIHsKCgkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzWyBrZXlzWyAwIF0gXTsKCgkJCWlmICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyA9IFtdOwoJCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSB7fTsKCgkJCQlmb3IgKCBsZXQgbSA9IDAsIG1sID0gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoOyBtIDwgbWw7IG0gKysgKSB7CgoJCQkJCWNvbnN0IG5hbWUgPSBtb3JwaEF0dHJpYnV0ZVsgbSBdLm5hbWUgfHwgU3RyaW5nKCBtICk7CgoJCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzLnB1c2goIDAgKTsKCQkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeVsgbmFtZSBdID0gbTsKCgkJCQl9CgoJCQl9CgoJCX0KCgl9Cgp9Cgpjb25zdCBfc3RhcnQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9lbmQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBMaW5lU2VnbWVudHMgZXh0ZW5kcyBMaW5lIHsKCgljb25zdHJ1Y3RvciggZ2VvbWV0cnksIG1hdGVyaWFsICkgewoKCQlzdXBlciggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCXRoaXMuaXNMaW5lU2VnbWVudHMgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnTGluZVNlZ21lbnRzJzsKCgl9CgoJY29tcHV0ZUxpbmVEaXN0YW5jZXMoKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCgkJLy8gd2UgYXNzdW1lIG5vbi1pbmRleGVkIGdlb21ldHJ5CgoJCWlmICggZ2VvbWV0cnkuaW5kZXggPT09IG51bGwgKSB7CgoJCQljb25zdCBwb3NpdGlvbkF0dHJpYnV0ZSA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgkJCWNvbnN0IGxpbmVEaXN0YW5jZXMgPSBbXTsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50OyBpIDwgbDsgaSArPSAyICkgewoKCQkJCV9zdGFydC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSApOwoJCQkJX2VuZC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSArIDEgKTsKCgkJCQlsaW5lRGlzdGFuY2VzWyBpIF0gPSAoIGkgPT09IDAgKSA/IDAgOiBsaW5lRGlzdGFuY2VzWyBpIC0gMSBdOwoJCQkJbGluZURpc3RhbmNlc1sgaSArIDEgXSA9IGxpbmVEaXN0YW5jZXNbIGkgXSArIF9zdGFydC5kaXN0YW5jZVRvKCBfZW5kICk7CgoJCQl9CgoJCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdsaW5lRGlzdGFuY2UnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbGluZURpc3RhbmNlcywgMSApICk7CgoJCX0gZWxzZSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5MaW5lU2VnbWVudHMuY29tcHV0ZUxpbmVEaXN0YW5jZXMoKTogQ29tcHV0YXRpb24gb25seSBwb3NzaWJsZSB3aXRoIG5vbi1pbmRleGVkIEJ1ZmZlckdlb21ldHJ5LicgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBMaW5lTG9vcCBleHRlbmRzIExpbmUgewoKCWNvbnN0cnVjdG9yKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKSB7CgoJCXN1cGVyKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy5pc0xpbmVMb29wID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0xpbmVMb29wJzsKCgl9Cgp9CgpjbGFzcyBQb2ludHNNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1BvaW50c01hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1BvaW50c01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmFscGhhTWFwID0gbnVsbDsKCgkJdGhpcy5zaXplID0gMTsKCQl0aGlzLnNpemVBdHRlbnVhdGlvbiA9IHRydWU7CgoJCXRoaXMuZm9nID0gdHJ1ZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5jb2xvci5jb3B5KCBzb3VyY2UuY29sb3IgKTsKCgkJdGhpcy5tYXAgPSBzb3VyY2UubWFwOwoKCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKCQl0aGlzLnNpemUgPSBzb3VyY2Uuc2l6ZTsKCQl0aGlzLnNpemVBdHRlbnVhdGlvbiA9IHNvdXJjZS5zaXplQXR0ZW51YXRpb247CgoJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY29uc3QgX2ludmVyc2VNYXRyaXggPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9yYXkgPSAvKkBfX1BVUkVfXyovIG5ldyBSYXkoKTsKY29uc3QgX3NwaGVyZSA9IC8qQF9fUFVSRV9fKi8gbmV3IFNwaGVyZSgpOwpjb25zdCBfcG9zaXRpb24kMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIFBvaW50cyBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvciggZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKSwgbWF0ZXJpYWwgPSBuZXcgUG9pbnRzTWF0ZXJpYWwoKSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1BvaW50cyA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdQb2ludHMnOwoKCQl0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgkJdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsOwoKCQl0aGlzLnVwZGF0ZU1vcnBoVGFyZ2V0cygpOwoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJdGhpcy5tYXRlcmlhbCA9IEFycmF5LmlzQXJyYXkoIHNvdXJjZS5tYXRlcmlhbCApID8gc291cmNlLm1hdGVyaWFsLnNsaWNlKCkgOiBzb3VyY2UubWF0ZXJpYWw7CgkJdGhpcy5nZW9tZXRyeSA9IHNvdXJjZS5nZW9tZXRyeTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCWNvbnN0IG1hdHJpeFdvcmxkID0gdGhpcy5tYXRyaXhXb3JsZDsKCQljb25zdCB0aHJlc2hvbGQgPSByYXljYXN0ZXIucGFyYW1zLlBvaW50cy50aHJlc2hvbGQ7CgkJY29uc3QgZHJhd1JhbmdlID0gZ2VvbWV0cnkuZHJhd1JhbmdlOwoKCQkvLyBDaGVja2luZyBib3VuZGluZ1NwaGVyZSBkaXN0YW5jZSB0byByYXkKCgkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQlfc3BoZXJlLmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlICk7CgkJX3NwaGVyZS5hcHBseU1hdHJpeDQoIG1hdHJpeFdvcmxkICk7CgkJX3NwaGVyZS5yYWRpdXMgKz0gdGhyZXNob2xkOwoKCQlpZiAoIHJheWNhc3Rlci5yYXkuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSApID09PSBmYWxzZSApIHJldHVybjsKCgkJLy8KCgkJX2ludmVyc2VNYXRyaXguY29weSggbWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCQlfcmF5LmNvcHkoIHJheWNhc3Rlci5yYXkgKS5hcHBseU1hdHJpeDQoIF9pbnZlcnNlTWF0cml4ICk7CgoJCWNvbnN0IGxvY2FsVGhyZXNob2xkID0gdGhyZXNob2xkIC8gKCAoIHRoaXMuc2NhbGUueCArIHRoaXMuc2NhbGUueSArIHRoaXMuc2NhbGUueiApIC8gMyApOwoJCWNvbnN0IGxvY2FsVGhyZXNob2xkU3EgPSBsb2NhbFRocmVzaG9sZCAqIGxvY2FsVGhyZXNob2xkOwoKCQljb25zdCBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCWNvbnN0IGF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCWNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoIDAsIGRyYXdSYW5nZS5zdGFydCApOwoJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggaW5kZXguY291bnQsICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKTsKCgkJCWZvciAoIGxldCBpID0gc3RhcnQsIGlsID0gZW5kOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgYSA9IGluZGV4LmdldFgoIGkgKTsKCgkJCQlfcG9zaXRpb24kMi5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgYSApOwoKCQkJCXRlc3RQb2ludCggX3Bvc2l0aW9uJDIsIGEsIGxvY2FsVGhyZXNob2xkU3EsIG1hdHJpeFdvcmxkLCByYXljYXN0ZXIsIGludGVyc2VjdHMsIHRoaXMgKTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoIDAsIGRyYXdSYW5nZS5zdGFydCApOwoJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb25BdHRyaWJ1dGUuY291bnQsICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKTsKCgkJCWZvciAoIGxldCBpID0gc3RhcnQsIGwgPSBlbmQ7IGkgPCBsOyBpICsrICkgewoKCQkJCV9wb3NpdGlvbiQyLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICk7CgoJCQkJdGVzdFBvaW50KCBfcG9zaXRpb24kMiwgaSwgbG9jYWxUaHJlc2hvbGRTcSwgbWF0cml4V29ybGQsIHJheWNhc3RlciwgaW50ZXJzZWN0cywgdGhpcyApOwoKCQkJfQoKCQl9CgoJfQoKCXVwZGF0ZU1vcnBoVGFyZ2V0cygpIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoKCQljb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXM7CgkJY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKCBtb3JwaEF0dHJpYnV0ZXMgKTsKCgkJaWYgKCBrZXlzLmxlbmd0aCA+IDAgKSB7CgoJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1sga2V5c1sgMCBdIF07CgoJCQlpZiAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMgPSBbXTsKCQkJCXRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5ID0ge307CgoJCQkJZm9yICggbGV0IG0gPSAwLCBtbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgbSA8IG1sOyBtICsrICkgewoKCQkJCQljb25zdCBuYW1lID0gbW9ycGhBdHRyaWJ1dGVbIG0gXS5uYW1lIHx8IFN0cmluZyggbSApOwoKCQkJCQl0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcy5wdXNoKCAwICk7CgkJCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnlbIG5hbWUgXSA9IG07CgoJCQkJfQoKCQkJfQoKCQl9CgoJfQoKfQoKZnVuY3Rpb24gdGVzdFBvaW50KCBwb2ludCwgaW5kZXgsIGxvY2FsVGhyZXNob2xkU3EsIG1hdHJpeFdvcmxkLCByYXljYXN0ZXIsIGludGVyc2VjdHMsIG9iamVjdCApIHsKCgljb25zdCByYXlQb2ludERpc3RhbmNlU3EgPSBfcmF5LmRpc3RhbmNlU3FUb1BvaW50KCBwb2ludCApOwoKCWlmICggcmF5UG9pbnREaXN0YW5jZVNxIDwgbG9jYWxUaHJlc2hvbGRTcSApIHsKCgkJY29uc3QgaW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjdG9yMygpOwoKCQlfcmF5LmNsb3Nlc3RQb2ludFRvUG9pbnQoIHBvaW50LCBpbnRlcnNlY3RQb2ludCApOwoJCWludGVyc2VjdFBvaW50LmFwcGx5TWF0cml4NCggbWF0cml4V29ybGQgKTsKCgkJY29uc3QgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKCBpbnRlcnNlY3RQb2ludCApOwoKCQlpZiAoIGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyICkgcmV0dXJuOwoKCQlpbnRlcnNlY3RzLnB1c2goIHsKCgkJCWRpc3RhbmNlOiBkaXN0YW5jZSwKCQkJZGlzdGFuY2VUb1JheTogTWF0aC5zcXJ0KCByYXlQb2ludERpc3RhbmNlU3EgKSwKCQkJcG9pbnQ6IGludGVyc2VjdFBvaW50LAoJCQlpbmRleDogaW5kZXgsCgkJCWZhY2U6IG51bGwsCgkJCW9iamVjdDogb2JqZWN0CgoJCX0gKTsKCgl9Cgp9CgpjbGFzcyBWaWRlb1RleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCgljb25zdHJ1Y3RvciggdmlkZW8sIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApIHsKCgkJc3VwZXIoIHZpZGVvLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkgKTsKCgkJdGhpcy5pc1ZpZGVvVGV4dHVyZSA9IHRydWU7CgoJCXRoaXMubWluRmlsdGVyID0gbWluRmlsdGVyICE9PSB1bmRlZmluZWQgPyBtaW5GaWx0ZXIgOiBMaW5lYXJGaWx0ZXI7CgkJdGhpcy5tYWdGaWx0ZXIgPSBtYWdGaWx0ZXIgIT09IHVuZGVmaW5lZCA/IG1hZ0ZpbHRlciA6IExpbmVhckZpbHRlcjsKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQlmdW5jdGlvbiB1cGRhdGVWaWRlbygpIHsKCgkJCXNjb3BlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJdmlkZW8ucmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjayggdXBkYXRlVmlkZW8gKTsKCgkJfQoKCQlpZiAoICdyZXF1ZXN0VmlkZW9GcmFtZUNhbGxiYWNrJyBpbiB2aWRlbyApIHsKCgkJCXZpZGVvLnJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2soIHVwZGF0ZVZpZGVvICk7CgoJCX0KCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy5pbWFnZSApLmNvcHkoIHRoaXMgKTsKCgl9CgoJdXBkYXRlKCkgewoKCQljb25zdCB2aWRlbyA9IHRoaXMuaW1hZ2U7CgkJY29uc3QgaGFzVmlkZW9GcmFtZUNhbGxiYWNrID0gJ3JlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2snIGluIHZpZGVvOwoKCQlpZiAoIGhhc1ZpZGVvRnJhbWVDYWxsYmFjayA9PT0gZmFsc2UgJiYgdmlkZW8ucmVhZHlTdGF0ZSA+PSB2aWRlby5IQVZFX0NVUlJFTlRfREFUQSApIHsKCgkJCXRoaXMubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9CgoJfQoKfQoKY2xhc3MgRnJhbWVidWZmZXJUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIHdpZHRoLCBoZWlnaHQgKSB7CgoJCXN1cGVyKCB7IHdpZHRoLCBoZWlnaHQgfSApOwoKCQl0aGlzLmlzRnJhbWVidWZmZXJUZXh0dXJlID0gdHJ1ZTsKCgkJdGhpcy5tYWdGaWx0ZXIgPSBOZWFyZXN0RmlsdGVyOwoJCXRoaXMubWluRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKfQoKY2xhc3MgQ29tcHJlc3NlZFRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCgljb25zdHJ1Y3RvciggbWlwbWFwcywgd2lkdGgsIGhlaWdodCwgZm9ybWF0LCB0eXBlLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICkgewoKCQlzdXBlciggbnVsbCwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICk7CgoJCXRoaXMuaXNDb21wcmVzc2VkVGV4dHVyZSA9IHRydWU7CgoJCXRoaXMuaW1hZ2UgPSB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfTsKCQl0aGlzLm1pcG1hcHMgPSBtaXBtYXBzOwoKCQkvLyBubyBmbGlwcGluZyBmb3IgY3ViZSB0ZXh0dXJlcwoJCS8vIChhbHNvIGZsaXBwaW5nIGRvZXNuJ3Qgd29yayBmb3IgY29tcHJlc3NlZCB0ZXh0dXJlcyApCgoJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCgkJLy8gY2FuJ3QgZ2VuZXJhdGUgbWlwbWFwcyBmb3IgY29tcHJlc3NlZCB0ZXh0dXJlcwoJCS8vIG1pcHMgbXVzdCBiZSBlbWJlZGRlZCBpbiBERFMgZmlsZXMKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgl9Cgp9CgpjbGFzcyBDb21wcmVzc2VkQXJyYXlUZXh0dXJlIGV4dGVuZHMgQ29tcHJlc3NlZFRleHR1cmUgewoKCWNvbnN0cnVjdG9yKCBtaXBtYXBzLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZm9ybWF0LCB0eXBlICkgewoKCQlzdXBlciggbWlwbWFwcywgd2lkdGgsIGhlaWdodCwgZm9ybWF0LCB0eXBlICk7CgoJCXRoaXMuaXNDb21wcmVzc2VkQXJyYXlUZXh0dXJlID0gdHJ1ZTsKCQl0aGlzLmltYWdlLmRlcHRoID0gZGVwdGg7CgkJdGhpcy53cmFwUiA9IENsYW1wVG9FZGdlV3JhcHBpbmc7CgoJfQoKfQoKY2xhc3MgQ29tcHJlc3NlZEN1YmVUZXh0dXJlIGV4dGVuZHMgQ29tcHJlc3NlZFRleHR1cmUgewoKCWNvbnN0cnVjdG9yKCBpbWFnZXMsIGZvcm1hdCwgdHlwZSApIHsKCgkJc3VwZXIoIHVuZGVmaW5lZCwgaW1hZ2VzWyAwIF0ud2lkdGgsIGltYWdlc1sgMCBdLmhlaWdodCwgZm9ybWF0LCB0eXBlLCBDdWJlUmVmbGVjdGlvbk1hcHBpbmcgKTsKCgkJdGhpcy5pc0NvbXByZXNzZWRDdWJlVGV4dHVyZSA9IHRydWU7CgkJdGhpcy5pc0N1YmVUZXh0dXJlID0gdHJ1ZTsKCgkJdGhpcy5pbWFnZSA9IGltYWdlczsKCgl9Cgp9CgpjbGFzcyBDYW52YXNUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIGNhbnZhcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICkgewoKCQlzdXBlciggY2FudmFzLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkgKTsKCgkJdGhpcy5pc0NhbnZhc1RleHR1cmUgPSB0cnVlOwoKCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9Cgp9CgovKioKICogRXh0ZW5zaWJsZSBjdXJ2ZSBvYmplY3QuCiAqCiAqIFNvbWUgY29tbW9uIG9mIGN1cnZlIG1ldGhvZHM6CiAqIC5nZXRQb2ludCggdCwgb3B0aW9uYWxUYXJnZXQgKSwgLmdldFRhbmdlbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ICkKICogLmdldFBvaW50QXQoIHUsIG9wdGlvbmFsVGFyZ2V0ICksIC5nZXRUYW5nZW50QXQoIHUsIG9wdGlvbmFsVGFyZ2V0ICkKICogLmdldFBvaW50cygpLCAuZ2V0U3BhY2VkUG9pbnRzKCkKICogLmdldExlbmd0aCgpCiAqIC51cGRhdGVBcmNMZW5ndGhzKCkKICoKICogVGhpcyBmb2xsb3dpbmcgY3VydmVzIGluaGVyaXQgZnJvbSBUSFJFRS5DdXJ2ZToKICoKICogLS0gMkQgY3VydmVzIC0tCiAqIFRIUkVFLkFyY0N1cnZlCiAqIFRIUkVFLkN1YmljQmV6aWVyQ3VydmUKICogVEhSRUUuRWxsaXBzZUN1cnZlCiAqIFRIUkVFLkxpbmVDdXJ2ZQogKiBUSFJFRS5RdWFkcmF0aWNCZXppZXJDdXJ2ZQogKiBUSFJFRS5TcGxpbmVDdXJ2ZQogKgogKiAtLSAzRCBjdXJ2ZXMgLS0KICogVEhSRUUuQ2F0bXVsbFJvbUN1cnZlMwogKiBUSFJFRS5DdWJpY0JlemllckN1cnZlMwogKiBUSFJFRS5MaW5lQ3VydmUzCiAqIFRIUkVFLlF1YWRyYXRpY0JlemllckN1cnZlMwogKgogKiBBIHNlcmllcyBvZiBjdXJ2ZXMgY2FuIGJlIHJlcHJlc2VudGVkIGFzIGEgVEhSRUUuQ3VydmVQYXRoLgogKgogKiovCgpjbGFzcyBDdXJ2ZSB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXRoaXMudHlwZSA9ICdDdXJ2ZSc7CgoJCXRoaXMuYXJjTGVuZ3RoRGl2aXNpb25zID0gMjAwOwoKCX0KCgkvLyBWaXJ0dWFsIGJhc2UgY2xhc3MgbWV0aG9kIHRvIG92ZXJ3cml0ZSBhbmQgaW1wbGVtZW50IGluIHN1YmNsYXNzZXMKCS8vCS0gdCBbMCAuLiAxXQoKCWdldFBvaW50KCAvKiB0LCBvcHRpb25hbFRhcmdldCAqLyApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuQ3VydmU6IC5nZXRQb2ludCgpIG5vdCBpbXBsZW1lbnRlZC4nICk7CgkJcmV0dXJuIG51bGw7CgoJfQoKCS8vIEdldCBwb2ludCBhdCByZWxhdGl2ZSBwb3NpdGlvbiBpbiBjdXJ2ZSBhY2NvcmRpbmcgdG8gYXJjIGxlbmd0aAoJLy8gLSB1IFswIC4uIDFdCgoJZ2V0UG9pbnRBdCggdSwgb3B0aW9uYWxUYXJnZXQgKSB7CgoJCWNvbnN0IHQgPSB0aGlzLmdldFV0b1RtYXBwaW5nKCB1ICk7CgkJcmV0dXJuIHRoaXMuZ2V0UG9pbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ICk7CgoJfQoKCS8vIEdldCBzZXF1ZW5jZSBvZiBwb2ludHMgdXNpbmcgZ2V0UG9pbnQoIHQgKQoKCWdldFBvaW50cyggZGl2aXNpb25zID0gNSApIHsKCgkJY29uc3QgcG9pbnRzID0gW107CgoJCWZvciAoIGxldCBkID0gMDsgZCA8PSBkaXZpc2lvbnM7IGQgKysgKSB7CgoJCQlwb2ludHMucHVzaCggdGhpcy5nZXRQb2ludCggZCAvIGRpdmlzaW9ucyApICk7CgoJCX0KCgkJcmV0dXJuIHBvaW50czsKCgl9CgoJLy8gR2V0IHNlcXVlbmNlIG9mIHBvaW50cyB1c2luZyBnZXRQb2ludEF0KCB1ICkKCglnZXRTcGFjZWRQb2ludHMoIGRpdmlzaW9ucyA9IDUgKSB7CgoJCWNvbnN0IHBvaW50cyA9IFtdOwoKCQlmb3IgKCBsZXQgZCA9IDA7IGQgPD0gZGl2aXNpb25zOyBkICsrICkgewoKCQkJcG9pbnRzLnB1c2goIHRoaXMuZ2V0UG9pbnRBdCggZCAvIGRpdmlzaW9ucyApICk7CgoJCX0KCgkJcmV0dXJuIHBvaW50czsKCgl9CgoJLy8gR2V0IHRvdGFsIGN1cnZlIGFyYyBsZW5ndGgKCglnZXRMZW5ndGgoKSB7CgoJCWNvbnN0IGxlbmd0aHMgPSB0aGlzLmdldExlbmd0aHMoKTsKCQlyZXR1cm4gbGVuZ3Roc1sgbGVuZ3Rocy5sZW5ndGggLSAxIF07CgoJfQoKCS8vIEdldCBsaXN0IG9mIGN1bXVsYXRpdmUgc2VnbWVudCBsZW5ndGhzCgoJZ2V0TGVuZ3RocyggZGl2aXNpb25zID0gdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnMgKSB7CgoJCWlmICggdGhpcy5jYWNoZUFyY0xlbmd0aHMgJiYKCQkJKCB0aGlzLmNhY2hlQXJjTGVuZ3Rocy5sZW5ndGggPT09IGRpdmlzaW9ucyArIDEgKSAmJgoJCQkhIHRoaXMubmVlZHNVcGRhdGUgKSB7CgoJCQlyZXR1cm4gdGhpcy5jYWNoZUFyY0xlbmd0aHM7CgoJCX0KCgkJdGhpcy5uZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQljb25zdCBjYWNoZSA9IFtdOwoJCWxldCBjdXJyZW50LCBsYXN0ID0gdGhpcy5nZXRQb2ludCggMCApOwoJCWxldCBzdW0gPSAwOwoKCQljYWNoZS5wdXNoKCAwICk7CgoJCWZvciAoIGxldCBwID0gMTsgcCA8PSBkaXZpc2lvbnM7IHAgKysgKSB7CgoJCQljdXJyZW50ID0gdGhpcy5nZXRQb2ludCggcCAvIGRpdmlzaW9ucyApOwoJCQlzdW0gKz0gY3VycmVudC5kaXN0YW5jZVRvKCBsYXN0ICk7CgkJCWNhY2hlLnB1c2goIHN1bSApOwoJCQlsYXN0ID0gY3VycmVudDsKCgkJfQoKCQl0aGlzLmNhY2hlQXJjTGVuZ3RocyA9IGNhY2hlOwoKCQlyZXR1cm4gY2FjaGU7IC8vIHsgc3VtczogY2FjaGUsIHN1bTogc3VtIH07IFN1bSBpcyBpbiB0aGUgbGFzdCBlbGVtZW50LgoKCX0KCgl1cGRhdGVBcmNMZW5ndGhzKCkgewoKCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCQl0aGlzLmdldExlbmd0aHMoKTsKCgl9CgoJLy8gR2l2ZW4gdSAoIDAgLi4gMSApLCBnZXQgYSB0IHRvIGZpbmQgcC4gVGhpcyBnaXZlcyB5b3UgcG9pbnRzIHdoaWNoIGFyZSBlcXVpZGlzdGFudAoKCWdldFV0b1RtYXBwaW5nKCB1LCBkaXN0YW5jZSApIHsKCgkJY29uc3QgYXJjTGVuZ3RocyA9IHRoaXMuZ2V0TGVuZ3RocygpOwoKCQlsZXQgaSA9IDA7CgkJY29uc3QgaWwgPSBhcmNMZW5ndGhzLmxlbmd0aDsKCgkJbGV0IHRhcmdldEFyY0xlbmd0aDsgLy8gVGhlIHRhcmdldGVkIHUgZGlzdGFuY2UgdmFsdWUgdG8gZ2V0CgoJCWlmICggZGlzdGFuY2UgKSB7CgoJCQl0YXJnZXRBcmNMZW5ndGggPSBkaXN0YW5jZTsKCgkJfSBlbHNlIHsKCgkJCXRhcmdldEFyY0xlbmd0aCA9IHUgKiBhcmNMZW5ndGhzWyBpbCAtIDEgXTsKCgkJfQoKCQkvLyBiaW5hcnkgc2VhcmNoIGZvciB0aGUgaW5kZXggd2l0aCBsYXJnZXN0IHZhbHVlIHNtYWxsZXIgdGhhbiB0YXJnZXQgdSBkaXN0YW5jZQoKCQlsZXQgbG93ID0gMCwgaGlnaCA9IGlsIC0gMSwgY29tcGFyaXNvbjsKCgkJd2hpbGUgKCBsb3cgPD0gaGlnaCApIHsKCgkJCWkgPSBNYXRoLmZsb29yKCBsb3cgKyAoIGhpZ2ggLSBsb3cgKSAvIDIgKTsgLy8gbGVzcyBsaWtlbHkgdG8gb3ZlcmZsb3csIHRob3VnaCBwcm9iYWJseSBub3QgaXNzdWUgaGVyZSwgSlMgZG9lc24ndCByZWFsbHkgaGF2ZSBpbnRlZ2VycywgYWxsIG51bWJlcnMgYXJlIGZsb2F0cwoKCQkJY29tcGFyaXNvbiA9IGFyY0xlbmd0aHNbIGkgXSAtIHRhcmdldEFyY0xlbmd0aDsKCgkJCWlmICggY29tcGFyaXNvbiA8IDAgKSB7CgoJCQkJbG93ID0gaSArIDE7CgoJCQl9IGVsc2UgaWYgKCBjb21wYXJpc29uID4gMCApIHsKCgkJCQloaWdoID0gaSAtIDE7CgoJCQl9IGVsc2UgewoKCQkJCWhpZ2ggPSBpOwoJCQkJYnJlYWs7CgoJCQkJLy8gRE9ORQoKCQkJfQoKCQl9CgoJCWkgPSBoaWdoOwoKCQlpZiAoIGFyY0xlbmd0aHNbIGkgXSA9PT0gdGFyZ2V0QXJjTGVuZ3RoICkgewoKCQkJcmV0dXJuIGkgLyAoIGlsIC0gMSApOwoKCQl9CgoJCS8vIHdlIGNvdWxkIGdldCBmaW5lciBncmFpbiBhdCBsZW5ndGhzLCBvciB1c2Ugc2ltcGxlIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gcG9pbnRzCgoJCWNvbnN0IGxlbmd0aEJlZm9yZSA9IGFyY0xlbmd0aHNbIGkgXTsKCQljb25zdCBsZW5ndGhBZnRlciA9IGFyY0xlbmd0aHNbIGkgKyAxIF07CgoJCWNvbnN0IHNlZ21lbnRMZW5ndGggPSBsZW5ndGhBZnRlciAtIGxlbmd0aEJlZm9yZTsKCgkJLy8gZGV0ZXJtaW5lIHdoZXJlIHdlIGFyZSBiZXR3ZWVuIHRoZSAnYmVmb3JlJyBhbmQgJ2FmdGVyJyBwb2ludHMKCgkJY29uc3Qgc2VnbWVudEZyYWN0aW9uID0gKCB0YXJnZXRBcmNMZW5ndGggLSBsZW5ndGhCZWZvcmUgKSAvIHNlZ21lbnRMZW5ndGg7CgoJCS8vIGFkZCB0aGF0IGZyYWN0aW9uYWwgYW1vdW50IHRvIHQKCgkJY29uc3QgdCA9ICggaSArIHNlZ21lbnRGcmFjdGlvbiApIC8gKCBpbCAtIDEgKTsKCgkJcmV0dXJuIHQ7CgoJfQoKCS8vIFJldHVybnMgYSB1bml0IHZlY3RvciB0YW5nZW50IGF0IHQKCS8vIEluIGNhc2UgYW55IHN1YiBjdXJ2ZSBkb2VzIG5vdCBpbXBsZW1lbnQgaXRzIHRhbmdlbnQgZGVyaXZhdGlvbiwKCS8vIDIgcG9pbnRzIGEgc21hbGwgZGVsdGEgYXBhcnQgd2lsbCBiZSB1c2VkIHRvIGZpbmQgaXRzIGdyYWRpZW50CgkvLyB3aGljaCBzZWVtcyB0byBnaXZlIGEgcmVhc29uYWJsZSBhcHByb3hpbWF0aW9uCgoJZ2V0VGFuZ2VudCggdCwgb3B0aW9uYWxUYXJnZXQgKSB7CgoJCWNvbnN0IGRlbHRhID0gMC4wMDAxOwoJCWxldCB0MSA9IHQgLSBkZWx0YTsKCQlsZXQgdDIgPSB0ICsgZGVsdGE7CgoJCS8vIENhcHBpbmcgaW4gY2FzZSBvZiBkYW5nZXIKCgkJaWYgKCB0MSA8IDAgKSB0MSA9IDA7CgkJaWYgKCB0MiA+IDEgKSB0MiA9IDE7CgoJCWNvbnN0IHB0MSA9IHRoaXMuZ2V0UG9pbnQoIHQxICk7CgkJY29uc3QgcHQyID0gdGhpcy5nZXRQb2ludCggdDIgKTsKCgkJY29uc3QgdGFuZ2VudCA9IG9wdGlvbmFsVGFyZ2V0IHx8ICggKCBwdDEuaXNWZWN0b3IyICkgPyBuZXcgVmVjdG9yMigpIDogbmV3IFZlY3RvcjMoKSApOwoKCQl0YW5nZW50LmNvcHkoIHB0MiApLnN1YiggcHQxICkubm9ybWFsaXplKCk7CgoJCXJldHVybiB0YW5nZW50OwoKCX0KCglnZXRUYW5nZW50QXQoIHUsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQljb25zdCB0ID0gdGhpcy5nZXRVdG9UbWFwcGluZyggdSApOwoJCXJldHVybiB0aGlzLmdldFRhbmdlbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ICk7CgoJfQoKCWNvbXB1dGVGcmVuZXRGcmFtZXMoIHNlZ21lbnRzLCBjbG9zZWQgKSB7CgoJCS8vIHNlZSBodHRwOi8vd3d3LmNzLmluZGlhbmEuZWR1L3B1Yi90ZWNocmVwb3J0cy9UUjQyNS5wZGYKCgkJY29uc3Qgbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCgkJY29uc3QgdGFuZ2VudHMgPSBbXTsKCQljb25zdCBub3JtYWxzID0gW107CgkJY29uc3QgYmlub3JtYWxzID0gW107CgoJCWNvbnN0IHZlYyA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3QgbWF0ID0gbmV3IE1hdHJpeDQoKTsKCgkJLy8gY29tcHV0ZSB0aGUgdGFuZ2VudCB2ZWN0b3JzIGZvciBlYWNoIHNlZ21lbnQgb24gdGhlIGN1cnZlCgoJCWZvciAoIGxldCBpID0gMDsgaSA8PSBzZWdtZW50czsgaSArKyApIHsKCgkJCWNvbnN0IHUgPSBpIC8gc2VnbWVudHM7CgoJCQl0YW5nZW50c1sgaSBdID0gdGhpcy5nZXRUYW5nZW50QXQoIHUsIG5ldyBWZWN0b3IzKCkgKTsKCgkJfQoKCQkvLyBzZWxlY3QgYW4gaW5pdGlhbCBub3JtYWwgdmVjdG9yIHBlcnBlbmRpY3VsYXIgdG8gdGhlIGZpcnN0IHRhbmdlbnQgdmVjdG9yLAoJCS8vIGFuZCBpbiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBtaW5pbXVtIHRhbmdlbnQgeHl6IGNvbXBvbmVudAoKCQlub3JtYWxzWyAwIF0gPSBuZXcgVmVjdG9yMygpOwoJCWJpbm9ybWFsc1sgMCBdID0gbmV3IFZlY3RvcjMoKTsKCQlsZXQgbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKCQljb25zdCB0eCA9IE1hdGguYWJzKCB0YW5nZW50c1sgMCBdLnggKTsKCQljb25zdCB0eSA9IE1hdGguYWJzKCB0YW5nZW50c1sgMCBdLnkgKTsKCQljb25zdCB0eiA9IE1hdGguYWJzKCB0YW5nZW50c1sgMCBdLnogKTsKCgkJaWYgKCB0eCA8PSBtaW4gKSB7CgoJCQltaW4gPSB0eDsKCQkJbm9ybWFsLnNldCggMSwgMCwgMCApOwoKCQl9CgoJCWlmICggdHkgPD0gbWluICkgewoKCQkJbWluID0gdHk7CgkJCW5vcm1hbC5zZXQoIDAsIDEsIDAgKTsKCgkJfQoKCQlpZiAoIHR6IDw9IG1pbiApIHsKCgkJCW5vcm1hbC5zZXQoIDAsIDAsIDEgKTsKCgkJfQoKCQl2ZWMuY3Jvc3NWZWN0b3JzKCB0YW5nZW50c1sgMCBdLCBub3JtYWwgKS5ub3JtYWxpemUoKTsKCgkJbm9ybWFsc1sgMCBdLmNyb3NzVmVjdG9ycyggdGFuZ2VudHNbIDAgXSwgdmVjICk7CgkJYmlub3JtYWxzWyAwIF0uY3Jvc3NWZWN0b3JzKCB0YW5nZW50c1sgMCBdLCBub3JtYWxzWyAwIF0gKTsKCgoJCS8vIGNvbXB1dGUgdGhlIHNsb3dseS12YXJ5aW5nIG5vcm1hbCBhbmQgYmlub3JtYWwgdmVjdG9ycyBmb3IgZWFjaCBzZWdtZW50IG9uIHRoZSBjdXJ2ZQoKCQlmb3IgKCBsZXQgaSA9IDE7IGkgPD0gc2VnbWVudHM7IGkgKysgKSB7CgoJCQlub3JtYWxzWyBpIF0gPSBub3JtYWxzWyBpIC0gMSBdLmNsb25lKCk7CgoJCQliaW5vcm1hbHNbIGkgXSA9IGJpbm9ybWFsc1sgaSAtIDEgXS5jbG9uZSgpOwoKCQkJdmVjLmNyb3NzVmVjdG9ycyggdGFuZ2VudHNbIGkgLSAxIF0sIHRhbmdlbnRzWyBpIF0gKTsKCgkJCWlmICggdmVjLmxlbmd0aCgpID4gTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkJdmVjLm5vcm1hbGl6ZSgpOwoKCQkJCWNvbnN0IHRoZXRhID0gTWF0aC5hY29zKCBjbGFtcCggdGFuZ2VudHNbIGkgLSAxIF0uZG90KCB0YW5nZW50c1sgaSBdICksIC0gMSwgMSApICk7IC8vIGNsYW1wIGZvciBmbG9hdGluZyBwdCBlcnJvcnMKCgkJCQlub3JtYWxzWyBpIF0uYXBwbHlNYXRyaXg0KCBtYXQubWFrZVJvdGF0aW9uQXhpcyggdmVjLCB0aGV0YSApICk7CgoJCQl9CgoJCQliaW5vcm1hbHNbIGkgXS5jcm9zc1ZlY3RvcnMoIHRhbmdlbnRzWyBpIF0sIG5vcm1hbHNbIGkgXSApOwoKCQl9CgoJCS8vIGlmIHRoZSBjdXJ2ZSBpcyBjbG9zZWQsIHBvc3Rwcm9jZXNzIHRoZSB2ZWN0b3JzIHNvIHRoZSBmaXJzdCBhbmQgbGFzdCBub3JtYWwgdmVjdG9ycyBhcmUgdGhlIHNhbWUKCgkJaWYgKCBjbG9zZWQgPT09IHRydWUgKSB7CgoJCQlsZXQgdGhldGEgPSBNYXRoLmFjb3MoIGNsYW1wKCBub3JtYWxzWyAwIF0uZG90KCBub3JtYWxzWyBzZWdtZW50cyBdICksIC0gMSwgMSApICk7CgkJCXRoZXRhIC89IHNlZ21lbnRzOwoKCQkJaWYgKCB0YW5nZW50c1sgMCBdLmRvdCggdmVjLmNyb3NzVmVjdG9ycyggbm9ybWFsc1sgMCBdLCBub3JtYWxzWyBzZWdtZW50cyBdICkgKSA+IDAgKSB7CgoJCQkJdGhldGEgPSAtIHRoZXRhOwoKCQkJfQoKCQkJZm9yICggbGV0IGkgPSAxOyBpIDw9IHNlZ21lbnRzOyBpICsrICkgewoKCQkJCS8vIHR3aXN0IGEgbGl0dGxlLi4uCgkJCQlub3JtYWxzWyBpIF0uYXBwbHlNYXRyaXg0KCBtYXQubWFrZVJvdGF0aW9uQXhpcyggdGFuZ2VudHNbIGkgXSwgdGhldGEgKiBpICkgKTsKCQkJCWJpbm9ybWFsc1sgaSBdLmNyb3NzVmVjdG9ycyggdGFuZ2VudHNbIGkgXSwgbm9ybWFsc1sgaSBdICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHsKCQkJdGFuZ2VudHM6IHRhbmdlbnRzLAoJCQlub3JtYWxzOiBub3JtYWxzLAoJCQliaW5vcm1hbHM6IGJpbm9ybWFscwoJCX07CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnMgPSBzb3VyY2UuYXJjTGVuZ3RoRGl2aXNpb25zOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gewoJCQltZXRhZGF0YTogewoJCQkJdmVyc2lvbjogNC42LAoJCQkJdHlwZTogJ0N1cnZlJywKCQkJCWdlbmVyYXRvcjogJ0N1cnZlLnRvSlNPTicKCQkJfQoJCX07CgoJCWRhdGEuYXJjTGVuZ3RoRGl2aXNpb25zID0gdGhpcy5hcmNMZW5ndGhEaXZpc2lvbnM7CgkJZGF0YS50eXBlID0gdGhpcy50eXBlOwoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXRoaXMuYXJjTGVuZ3RoRGl2aXNpb25zID0ganNvbi5hcmNMZW5ndGhEaXZpc2lvbnM7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIEVsbGlwc2VDdXJ2ZSBleHRlbmRzIEN1cnZlIHsKCgljb25zdHJ1Y3RvciggYVggPSAwLCBhWSA9IDAsIHhSYWRpdXMgPSAxLCB5UmFkaXVzID0gMSwgYVN0YXJ0QW5nbGUgPSAwLCBhRW5kQW5nbGUgPSBNYXRoLlBJICogMiwgYUNsb2Nrd2lzZSA9IGZhbHNlLCBhUm90YXRpb24gPSAwICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzRWxsaXBzZUN1cnZlID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0VsbGlwc2VDdXJ2ZSc7CgoJCXRoaXMuYVggPSBhWDsKCQl0aGlzLmFZID0gYVk7CgoJCXRoaXMueFJhZGl1cyA9IHhSYWRpdXM7CgkJdGhpcy55UmFkaXVzID0geVJhZGl1czsKCgkJdGhpcy5hU3RhcnRBbmdsZSA9IGFTdGFydEFuZ2xlOwoJCXRoaXMuYUVuZEFuZ2xlID0gYUVuZEFuZ2xlOwoKCQl0aGlzLmFDbG9ja3dpc2UgPSBhQ2xvY2t3aXNlOwoKCQl0aGlzLmFSb3RhdGlvbiA9IGFSb3RhdGlvbjsKCgl9CgoJZ2V0UG9pbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQljb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0IHx8IG5ldyBWZWN0b3IyKCk7CgoJCWNvbnN0IHR3b1BpID0gTWF0aC5QSSAqIDI7CgkJbGV0IGRlbHRhQW5nbGUgPSB0aGlzLmFFbmRBbmdsZSAtIHRoaXMuYVN0YXJ0QW5nbGU7CgkJY29uc3Qgc2FtZVBvaW50cyA9IE1hdGguYWJzKCBkZWx0YUFuZ2xlICkgPCBOdW1iZXIuRVBTSUxPTjsKCgkJLy8gZW5zdXJlcyB0aGF0IGRlbHRhQW5nbGUgaXMgMCAuLiAyIFBJCgkJd2hpbGUgKCBkZWx0YUFuZ2xlIDwgMCApIGRlbHRhQW5nbGUgKz0gdHdvUGk7CgkJd2hpbGUgKCBkZWx0YUFuZ2xlID4gdHdvUGkgKSBkZWx0YUFuZ2xlIC09IHR3b1BpOwoKCQlpZiAoIGRlbHRhQW5nbGUgPCBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCWlmICggc2FtZVBvaW50cyApIHsKCgkJCQlkZWx0YUFuZ2xlID0gMDsKCgkJCX0gZWxzZSB7CgoJCQkJZGVsdGFBbmdsZSA9IHR3b1BpOwoKCQkJfQoKCQl9CgoJCWlmICggdGhpcy5hQ2xvY2t3aXNlID09PSB0cnVlICYmICEgc2FtZVBvaW50cyApIHsKCgkJCWlmICggZGVsdGFBbmdsZSA9PT0gdHdvUGkgKSB7CgoJCQkJZGVsdGFBbmdsZSA9IC0gdHdvUGk7CgoJCQl9IGVsc2UgewoKCQkJCWRlbHRhQW5nbGUgPSBkZWx0YUFuZ2xlIC0gdHdvUGk7CgoJCQl9CgoJCX0KCgkJY29uc3QgYW5nbGUgPSB0aGlzLmFTdGFydEFuZ2xlICsgdCAqIGRlbHRhQW5nbGU7CgkJbGV0IHggPSB0aGlzLmFYICsgdGhpcy54UmFkaXVzICogTWF0aC5jb3MoIGFuZ2xlICk7CgkJbGV0IHkgPSB0aGlzLmFZICsgdGhpcy55UmFkaXVzICogTWF0aC5zaW4oIGFuZ2xlICk7CgoJCWlmICggdGhpcy5hUm90YXRpb24gIT09IDAgKSB7CgoJCQljb25zdCBjb3MgPSBNYXRoLmNvcyggdGhpcy5hUm90YXRpb24gKTsKCQkJY29uc3Qgc2luID0gTWF0aC5zaW4oIHRoaXMuYVJvdGF0aW9uICk7CgoJCQljb25zdCB0eCA9IHggLSB0aGlzLmFYOwoJCQljb25zdCB0eSA9IHkgLSB0aGlzLmFZOwoKCQkJLy8gUm90YXRlIHRoZSBwb2ludCBhYm91dCB0aGUgY2VudGVyIG9mIHRoZSBlbGxpcHNlLgoJCQl4ID0gdHggKiBjb3MgLSB0eSAqIHNpbiArIHRoaXMuYVg7CgkJCXkgPSB0eCAqIHNpbiArIHR5ICogY29zICsgdGhpcy5hWTsKCgkJfQoKCQlyZXR1cm4gcG9pbnQuc2V0KCB4LCB5ICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuYVggPSBzb3VyY2UuYVg7CgkJdGhpcy5hWSA9IHNvdXJjZS5hWTsKCgkJdGhpcy54UmFkaXVzID0gc291cmNlLnhSYWRpdXM7CgkJdGhpcy55UmFkaXVzID0gc291cmNlLnlSYWRpdXM7CgoJCXRoaXMuYVN0YXJ0QW5nbGUgPSBzb3VyY2UuYVN0YXJ0QW5nbGU7CgkJdGhpcy5hRW5kQW5nbGUgPSBzb3VyY2UuYUVuZEFuZ2xlOwoKCQl0aGlzLmFDbG9ja3dpc2UgPSBzb3VyY2UuYUNsb2Nrd2lzZTsKCgkJdGhpcy5hUm90YXRpb24gPSBzb3VyY2UuYVJvdGF0aW9uOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEuYVggPSB0aGlzLmFYOwoJCWRhdGEuYVkgPSB0aGlzLmFZOwoKCQlkYXRhLnhSYWRpdXMgPSB0aGlzLnhSYWRpdXM7CgkJZGF0YS55UmFkaXVzID0gdGhpcy55UmFkaXVzOwoKCQlkYXRhLmFTdGFydEFuZ2xlID0gdGhpcy5hU3RhcnRBbmdsZTsKCQlkYXRhLmFFbmRBbmdsZSA9IHRoaXMuYUVuZEFuZ2xlOwoKCQlkYXRhLmFDbG9ja3dpc2UgPSB0aGlzLmFDbG9ja3dpc2U7CgoJCWRhdGEuYVJvdGF0aW9uID0gdGhpcy5hUm90YXRpb247CgoJCXJldHVybiBkYXRhOwoKCX0KCglmcm9tSlNPTigganNvbiApIHsKCgkJc3VwZXIuZnJvbUpTT04oIGpzb24gKTsKCgkJdGhpcy5hWCA9IGpzb24uYVg7CgkJdGhpcy5hWSA9IGpzb24uYVk7CgoJCXRoaXMueFJhZGl1cyA9IGpzb24ueFJhZGl1czsKCQl0aGlzLnlSYWRpdXMgPSBqc29uLnlSYWRpdXM7CgoJCXRoaXMuYVN0YXJ0QW5nbGUgPSBqc29uLmFTdGFydEFuZ2xlOwoJCXRoaXMuYUVuZEFuZ2xlID0ganNvbi5hRW5kQW5nbGU7CgoJCXRoaXMuYUNsb2Nrd2lzZSA9IGpzb24uYUNsb2Nrd2lzZTsKCgkJdGhpcy5hUm90YXRpb24gPSBqc29uLmFSb3RhdGlvbjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgQXJjQ3VydmUgZXh0ZW5kcyBFbGxpcHNlQ3VydmUgewoKCWNvbnN0cnVjdG9yKCBhWCwgYVksIGFSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UgKSB7CgoJCXN1cGVyKCBhWCwgYVksIGFSYWRpdXMsIGFSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UgKTsKCgkJdGhpcy5pc0FyY0N1cnZlID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0FyY0N1cnZlJzsKCgl9Cgp9CgovKioKICogQ2VudHJpcGV0YWwgQ2F0bXVsbFJvbSBDdXJ2ZSAtIHdoaWNoIGlzIHVzZWZ1bCBmb3IgYXZvaWRpbmcKICogY3VzcHMgYW5kIHNlbGYtaW50ZXJzZWN0aW9ucyBpbiBub24tdW5pZm9ybSBjYXRtdWxsIHJvbSBjdXJ2ZXMuCiAqIGh0dHA6Ly93d3cuY2VteXVrc2VsLmNvbS9yZXNlYXJjaC9jYXRtdWxscm9tX3BhcmFtL2NhdG11bGxyb20ucGRmCiAqCiAqIGN1cnZlLnR5cGUgYWNjZXB0cyBjZW50cmlwZXRhbChkZWZhdWx0KSwgY2hvcmRhbCBhbmQgY2F0bXVsbHJvbQogKiBjdXJ2ZS50ZW5zaW9uIGlzIHVzZWQgZm9yIGNhdG11bGxyb20gd2hpY2ggZGVmYXVsdHMgdG8gMC41CiAqLwoKCi8qCkJhc2VkIG9uIGFuIG9wdGltaXplZCBjKysgc29sdXRpb24gaW4KIC0gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy85NDg5NzM2L2NhdG11bGwtcm9tLWN1cnZlLXdpdGgtbm8tY3VzcHMtYW5kLW5vLXNlbGYtaW50ZXJzZWN0aW9ucy8KIC0gaHR0cDovL2lkZW9uZS5jb20vTm9FYlZNCgpUaGlzIEN1YmljUG9seSBjbGFzcyBjb3VsZCBiZSB1c2VkIGZvciByZXVzaW5nIHNvbWUgdmFyaWFibGVzIGFuZCBjYWxjdWxhdGlvbnMsCmJ1dCBmb3IgdGhyZWUuanMgY3VydmUgdXNlLCBpdCBjb3VsZCBiZSBwb3NzaWJsZSBpbmxpbmVkIGFuZCBmbGF0dGVuIGludG8gYSBzaW5nbGUgZnVuY3Rpb24gY2FsbAp3aGljaCBjYW4gYmUgcGxhY2VkIGluIEN1cnZlVXRpbHMuCiovCgpmdW5jdGlvbiBDdWJpY1BvbHkoKSB7CgoJbGV0IGMwID0gMCwgYzEgPSAwLCBjMiA9IDAsIGMzID0gMDsKCgkvKgoJICogQ29tcHV0ZSBjb2VmZmljaWVudHMgZm9yIGEgY3ViaWMgcG9seW5vbWlhbAoJICogICBwKHMpID0gYzAgKyBjMSpzICsgYzIqc14yICsgYzMqc14zCgkgKiBzdWNoIHRoYXQKCSAqICAgcCgwKSA9IHgwLCBwKDEpID0geDEKCSAqICBhbmQKCSAqICAgcCcoMCkgPSB0MCwgcCcoMSkgPSB0MS4KCSAqLwoJZnVuY3Rpb24gaW5pdCggeDAsIHgxLCB0MCwgdDEgKSB7CgoJCWMwID0geDA7CgkJYzEgPSB0MDsKCQljMiA9IC0gMyAqIHgwICsgMyAqIHgxIC0gMiAqIHQwIC0gdDE7CgkJYzMgPSAyICogeDAgLSAyICogeDEgKyB0MCArIHQxOwoKCX0KCglyZXR1cm4gewoKCQlpbml0Q2F0bXVsbFJvbTogZnVuY3Rpb24gKCB4MCwgeDEsIHgyLCB4MywgdGVuc2lvbiApIHsKCgkJCWluaXQoIHgxLCB4MiwgdGVuc2lvbiAqICggeDIgLSB4MCApLCB0ZW5zaW9uICogKCB4MyAtIHgxICkgKTsKCgkJfSwKCgkJaW5pdE5vbnVuaWZvcm1DYXRtdWxsUm9tOiBmdW5jdGlvbiAoIHgwLCB4MSwgeDIsIHgzLCBkdDAsIGR0MSwgZHQyICkgewoKCQkJLy8gY29tcHV0ZSB0YW5nZW50cyB3aGVuIHBhcmFtZXRlcml6ZWQgaW4gW3QxLHQyXQoJCQlsZXQgdDEgPSAoIHgxIC0geDAgKSAvIGR0MCAtICggeDIgLSB4MCApIC8gKCBkdDAgKyBkdDEgKSArICggeDIgLSB4MSApIC8gZHQxOwoJCQlsZXQgdDIgPSAoIHgyIC0geDEgKSAvIGR0MSAtICggeDMgLSB4MSApIC8gKCBkdDEgKyBkdDIgKSArICggeDMgLSB4MiApIC8gZHQyOwoKCQkJLy8gcmVzY2FsZSB0YW5nZW50cyBmb3IgcGFyYW1ldHJpemF0aW9uIGluIFswLDFdCgkJCXQxICo9IGR0MTsKCQkJdDIgKj0gZHQxOwoKCQkJaW5pdCggeDEsIHgyLCB0MSwgdDIgKTsKCgkJfSwKCgkJY2FsYzogZnVuY3Rpb24gKCB0ICkgewoKCQkJY29uc3QgdDIgPSB0ICogdDsKCQkJY29uc3QgdDMgPSB0MiAqIHQ7CgkJCXJldHVybiBjMCArIGMxICogdCArIGMyICogdDIgKyBjMyAqIHQzOwoKCQl9CgoJfTsKCn0KCi8vCgpjb25zdCB0bXAgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IHB4ID0gLypAX19QVVJFX18qLyBuZXcgQ3ViaWNQb2x5KCk7CmNvbnN0IHB5ID0gLypAX19QVVJFX18qLyBuZXcgQ3ViaWNQb2x5KCk7CmNvbnN0IHB6ID0gLypAX19QVVJFX18qLyBuZXcgQ3ViaWNQb2x5KCk7CgpjbGFzcyBDYXRtdWxsUm9tQ3VydmUzIGV4dGVuZHMgQ3VydmUgewoKCWNvbnN0cnVjdG9yKCBwb2ludHMgPSBbXSwgY2xvc2VkID0gZmFsc2UsIGN1cnZlVHlwZSA9ICdjZW50cmlwZXRhbCcsIHRlbnNpb24gPSAwLjUgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNDYXRtdWxsUm9tQ3VydmUzID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0NhdG11bGxSb21DdXJ2ZTMnOwoKCQl0aGlzLnBvaW50cyA9IHBvaW50czsKCQl0aGlzLmNsb3NlZCA9IGNsb3NlZDsKCQl0aGlzLmN1cnZlVHlwZSA9IGN1cnZlVHlwZTsKCQl0aGlzLnRlbnNpb24gPSB0ZW5zaW9uOwoKCX0KCglnZXRQb2ludCggdCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMygpICkgewoKCQljb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwoKCQljb25zdCBwb2ludHMgPSB0aGlzLnBvaW50czsKCQljb25zdCBsID0gcG9pbnRzLmxlbmd0aDsKCgkJY29uc3QgcCA9ICggbCAtICggdGhpcy5jbG9zZWQgPyAwIDogMSApICkgKiB0OwoJCWxldCBpbnRQb2ludCA9IE1hdGguZmxvb3IoIHAgKTsKCQlsZXQgd2VpZ2h0ID0gcCAtIGludFBvaW50OwoKCQlpZiAoIHRoaXMuY2xvc2VkICkgewoKCQkJaW50UG9pbnQgKz0gaW50UG9pbnQgPiAwID8gMCA6ICggTWF0aC5mbG9vciggTWF0aC5hYnMoIGludFBvaW50ICkgLyBsICkgKyAxICkgKiBsOwoKCQl9IGVsc2UgaWYgKCB3ZWlnaHQgPT09IDAgJiYgaW50UG9pbnQgPT09IGwgLSAxICkgewoKCQkJaW50UG9pbnQgPSBsIC0gMjsKCQkJd2VpZ2h0ID0gMTsKCgkJfQoKCQlsZXQgcDAsIHAzOyAvLyA0IHBvaW50cyAocDEgJiBwMiBkZWZpbmVkIGJlbG93KQoKCQlpZiAoIHRoaXMuY2xvc2VkIHx8IGludFBvaW50ID4gMCApIHsKCgkJCXAwID0gcG9pbnRzWyAoIGludFBvaW50IC0gMSApICUgbCBdOwoKCQl9IGVsc2UgewoKCQkJLy8gZXh0cmFwb2xhdGUgZmlyc3QgcG9pbnQKCQkJdG1wLnN1YlZlY3RvcnMoIHBvaW50c1sgMCBdLCBwb2ludHNbIDEgXSApLmFkZCggcG9pbnRzWyAwIF0gKTsKCQkJcDAgPSB0bXA7CgoJCX0KCgkJY29uc3QgcDEgPSBwb2ludHNbIGludFBvaW50ICUgbCBdOwoJCWNvbnN0IHAyID0gcG9pbnRzWyAoIGludFBvaW50ICsgMSApICUgbCBdOwoKCQlpZiAoIHRoaXMuY2xvc2VkIHx8IGludFBvaW50ICsgMiA8IGwgKSB7CgoJCQlwMyA9IHBvaW50c1sgKCBpbnRQb2ludCArIDIgKSAlIGwgXTsKCgkJfSBlbHNlIHsKCgkJCS8vIGV4dHJhcG9sYXRlIGxhc3QgcG9pbnQKCQkJdG1wLnN1YlZlY3RvcnMoIHBvaW50c1sgbCAtIDEgXSwgcG9pbnRzWyBsIC0gMiBdICkuYWRkKCBwb2ludHNbIGwgLSAxIF0gKTsKCQkJcDMgPSB0bXA7CgoJCX0KCgkJaWYgKCB0aGlzLmN1cnZlVHlwZSA9PT0gJ2NlbnRyaXBldGFsJyB8fCB0aGlzLmN1cnZlVHlwZSA9PT0gJ2Nob3JkYWwnICkgewoKCQkJLy8gaW5pdCBDZW50cmlwZXRhbCAvIENob3JkYWwgQ2F0bXVsbC1Sb20KCQkJY29uc3QgcG93ID0gdGhpcy5jdXJ2ZVR5cGUgPT09ICdjaG9yZGFsJyA/IDAuNSA6IDAuMjU7CgkJCWxldCBkdDAgPSBNYXRoLnBvdyggcDAuZGlzdGFuY2VUb1NxdWFyZWQoIHAxICksIHBvdyApOwoJCQlsZXQgZHQxID0gTWF0aC5wb3coIHAxLmRpc3RhbmNlVG9TcXVhcmVkKCBwMiApLCBwb3cgKTsKCQkJbGV0IGR0MiA9IE1hdGgucG93KCBwMi5kaXN0YW5jZVRvU3F1YXJlZCggcDMgKSwgcG93ICk7CgoJCQkvLyBzYWZldHkgY2hlY2sgZm9yIHJlcGVhdGVkIHBvaW50cwoJCQlpZiAoIGR0MSA8IDFlLTQgKSBkdDEgPSAxLjA7CgkJCWlmICggZHQwIDwgMWUtNCApIGR0MCA9IGR0MTsKCQkJaWYgKCBkdDIgPCAxZS00ICkgZHQyID0gZHQxOwoKCQkJcHguaW5pdE5vbnVuaWZvcm1DYXRtdWxsUm9tKCBwMC54LCBwMS54LCBwMi54LCBwMy54LCBkdDAsIGR0MSwgZHQyICk7CgkJCXB5LmluaXROb251bmlmb3JtQ2F0bXVsbFJvbSggcDAueSwgcDEueSwgcDIueSwgcDMueSwgZHQwLCBkdDEsIGR0MiApOwoJCQlwei5pbml0Tm9udW5pZm9ybUNhdG11bGxSb20oIHAwLnosIHAxLnosIHAyLnosIHAzLnosIGR0MCwgZHQxLCBkdDIgKTsKCgkJfSBlbHNlIGlmICggdGhpcy5jdXJ2ZVR5cGUgPT09ICdjYXRtdWxscm9tJyApIHsKCgkJCXB4LmluaXRDYXRtdWxsUm9tKCBwMC54LCBwMS54LCBwMi54LCBwMy54LCB0aGlzLnRlbnNpb24gKTsKCQkJcHkuaW5pdENhdG11bGxSb20oIHAwLnksIHAxLnksIHAyLnksIHAzLnksIHRoaXMudGVuc2lvbiApOwoJCQlwei5pbml0Q2F0bXVsbFJvbSggcDAueiwgcDEueiwgcDIueiwgcDMueiwgdGhpcy50ZW5zaW9uICk7CgoJCX0KCgkJcG9pbnQuc2V0KAoJCQlweC5jYWxjKCB3ZWlnaHQgKSwKCQkJcHkuY2FsYyggd2VpZ2h0ICksCgkJCXB6LmNhbGMoIHdlaWdodCApCgkJKTsKCgkJcmV0dXJuIHBvaW50OwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnBvaW50cyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBzb3VyY2UucG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBwb2ludCA9IHNvdXJjZS5wb2ludHNbIGkgXTsKCgkJCXRoaXMucG9pbnRzLnB1c2goIHBvaW50LmNsb25lKCkgKTsKCgkJfQoKCQl0aGlzLmNsb3NlZCA9IHNvdXJjZS5jbG9zZWQ7CgkJdGhpcy5jdXJ2ZVR5cGUgPSBzb3VyY2UuY3VydmVUeXBlOwoJCXRoaXMudGVuc2lvbiA9IHNvdXJjZS50ZW5zaW9uOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEucG9pbnRzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMucG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBwb2ludCA9IHRoaXMucG9pbnRzWyBpIF07CgkJCWRhdGEucG9pbnRzLnB1c2goIHBvaW50LnRvQXJyYXkoKSApOwoKCQl9CgoJCWRhdGEuY2xvc2VkID0gdGhpcy5jbG9zZWQ7CgkJZGF0YS5jdXJ2ZVR5cGUgPSB0aGlzLmN1cnZlVHlwZTsKCQlkYXRhLnRlbnNpb24gPSB0aGlzLnRlbnNpb247CgoJCXJldHVybiBkYXRhOwoKCX0KCglmcm9tSlNPTigganNvbiApIHsKCgkJc3VwZXIuZnJvbUpTT04oIGpzb24gKTsKCgkJdGhpcy5wb2ludHMgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0ganNvbi5wb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHBvaW50ID0ganNvbi5wb2ludHNbIGkgXTsKCQkJdGhpcy5wb2ludHMucHVzaCggbmV3IFZlY3RvcjMoKS5mcm9tQXJyYXkoIHBvaW50ICkgKTsKCgkJfQoKCQl0aGlzLmNsb3NlZCA9IGpzb24uY2xvc2VkOwoJCXRoaXMuY3VydmVUeXBlID0ganNvbi5jdXJ2ZVR5cGU7CgkJdGhpcy50ZW5zaW9uID0ganNvbi50ZW5zaW9uOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgovKioKICogQmV6aWVyIEN1cnZlcyBmb3JtdWxhcyBvYnRhaW5lZCBmcm9tCiAqIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0IlQzMlQTl6aWVyX2N1cnZlCiAqLwoKZnVuY3Rpb24gQ2F0bXVsbFJvbSggdCwgcDAsIHAxLCBwMiwgcDMgKSB7CgoJY29uc3QgdjAgPSAoIHAyIC0gcDAgKSAqIDAuNTsKCWNvbnN0IHYxID0gKCBwMyAtIHAxICkgKiAwLjU7Cgljb25zdCB0MiA9IHQgKiB0OwoJY29uc3QgdDMgPSB0ICogdDI7CglyZXR1cm4gKCAyICogcDEgLSAyICogcDIgKyB2MCArIHYxICkgKiB0MyArICggLSAzICogcDEgKyAzICogcDIgLSAyICogdjAgLSB2MSApICogdDIgKyB2MCAqIHQgKyBwMTsKCn0KCi8vCgpmdW5jdGlvbiBRdWFkcmF0aWNCZXppZXJQMCggdCwgcCApIHsKCgljb25zdCBrID0gMSAtIHQ7CglyZXR1cm4gayAqIGsgKiBwOwoKfQoKZnVuY3Rpb24gUXVhZHJhdGljQmV6aWVyUDEoIHQsIHAgKSB7CgoJcmV0dXJuIDIgKiAoIDEgLSB0ICkgKiB0ICogcDsKCn0KCmZ1bmN0aW9uIFF1YWRyYXRpY0JlemllclAyKCB0LCBwICkgewoKCXJldHVybiB0ICogdCAqIHA7Cgp9CgpmdW5jdGlvbiBRdWFkcmF0aWNCZXppZXIoIHQsIHAwLCBwMSwgcDIgKSB7CgoJcmV0dXJuIFF1YWRyYXRpY0JlemllclAwKCB0LCBwMCApICsgUXVhZHJhdGljQmV6aWVyUDEoIHQsIHAxICkgKwoJCVF1YWRyYXRpY0JlemllclAyKCB0LCBwMiApOwoKfQoKLy8KCmZ1bmN0aW9uIEN1YmljQmV6aWVyUDAoIHQsIHAgKSB7CgoJY29uc3QgayA9IDEgLSB0OwoJcmV0dXJuIGsgKiBrICogayAqIHA7Cgp9CgpmdW5jdGlvbiBDdWJpY0JlemllclAxKCB0LCBwICkgewoKCWNvbnN0IGsgPSAxIC0gdDsKCXJldHVybiAzICogayAqIGsgKiB0ICogcDsKCn0KCmZ1bmN0aW9uIEN1YmljQmV6aWVyUDIoIHQsIHAgKSB7CgoJcmV0dXJuIDMgKiAoIDEgLSB0ICkgKiB0ICogdCAqIHA7Cgp9CgpmdW5jdGlvbiBDdWJpY0JlemllclAzKCB0LCBwICkgewoKCXJldHVybiB0ICogdCAqIHQgKiBwOwoKfQoKZnVuY3Rpb24gQ3ViaWNCZXppZXIoIHQsIHAwLCBwMSwgcDIsIHAzICkgewoKCXJldHVybiBDdWJpY0JlemllclAwKCB0LCBwMCApICsgQ3ViaWNCZXppZXJQMSggdCwgcDEgKSArIEN1YmljQmV6aWVyUDIoIHQsIHAyICkgKwoJCUN1YmljQmV6aWVyUDMoIHQsIHAzICk7Cgp9CgpjbGFzcyBDdWJpY0JlemllckN1cnZlIGV4dGVuZHMgQ3VydmUgewoKCWNvbnN0cnVjdG9yKCB2MCA9IG5ldyBWZWN0b3IyKCksIHYxID0gbmV3IFZlY3RvcjIoKSwgdjIgPSBuZXcgVmVjdG9yMigpLCB2MyA9IG5ldyBWZWN0b3IyKCkgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNDdWJpY0JlemllckN1cnZlID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0N1YmljQmV6aWVyQ3VydmUnOwoKCQl0aGlzLnYwID0gdjA7CgkJdGhpcy52MSA9IHYxOwoJCXRoaXMudjIgPSB2MjsKCQl0aGlzLnYzID0gdjM7CgoJfQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IyKCkgKSB7CgoJCWNvbnN0IHBvaW50ID0gb3B0aW9uYWxUYXJnZXQ7CgoJCWNvbnN0IHYwID0gdGhpcy52MCwgdjEgPSB0aGlzLnYxLCB2MiA9IHRoaXMudjIsIHYzID0gdGhpcy52MzsKCgkJcG9pbnQuc2V0KAoJCQlDdWJpY0JlemllciggdCwgdjAueCwgdjEueCwgdjIueCwgdjMueCApLAoJCQlDdWJpY0JlemllciggdCwgdjAueSwgdjEueSwgdjIueSwgdjMueSApCgkJKTsKCgkJcmV0dXJuIHBvaW50OwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnYwLmNvcHkoIHNvdXJjZS52MCApOwoJCXRoaXMudjEuY29weSggc291cmNlLnYxICk7CgkJdGhpcy52Mi5jb3B5KCBzb3VyY2UudjIgKTsKCQl0aGlzLnYzLmNvcHkoIHNvdXJjZS52MyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEudjAgPSB0aGlzLnYwLnRvQXJyYXkoKTsKCQlkYXRhLnYxID0gdGhpcy52MS50b0FycmF5KCk7CgkJZGF0YS52MiA9IHRoaXMudjIudG9BcnJheSgpOwoJCWRhdGEudjMgPSB0aGlzLnYzLnRvQXJyYXkoKTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQlzdXBlci5mcm9tSlNPTigganNvbiApOwoKCQl0aGlzLnYwLmZyb21BcnJheSgganNvbi52MCApOwoJCXRoaXMudjEuZnJvbUFycmF5KCBqc29uLnYxICk7CgkJdGhpcy52Mi5mcm9tQXJyYXkoIGpzb24udjIgKTsKCQl0aGlzLnYzLmZyb21BcnJheSgganNvbi52MyApOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBDdWJpY0JlemllckN1cnZlMyBleHRlbmRzIEN1cnZlIHsKCgljb25zdHJ1Y3RvciggdjAgPSBuZXcgVmVjdG9yMygpLCB2MSA9IG5ldyBWZWN0b3IzKCksIHYyID0gbmV3IFZlY3RvcjMoKSwgdjMgPSBuZXcgVmVjdG9yMygpICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzQ3ViaWNCZXppZXJDdXJ2ZTMgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnQ3ViaWNCZXppZXJDdXJ2ZTMnOwoKCQl0aGlzLnYwID0gdjA7CgkJdGhpcy52MSA9IHYxOwoJCXRoaXMudjIgPSB2MjsKCQl0aGlzLnYzID0gdjM7CgoJfQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IzKCkgKSB7CgoJCWNvbnN0IHBvaW50ID0gb3B0aW9uYWxUYXJnZXQ7CgoJCWNvbnN0IHYwID0gdGhpcy52MCwgdjEgPSB0aGlzLnYxLCB2MiA9IHRoaXMudjIsIHYzID0gdGhpcy52MzsKCgkJcG9pbnQuc2V0KAoJCQlDdWJpY0JlemllciggdCwgdjAueCwgdjEueCwgdjIueCwgdjMueCApLAoJCQlDdWJpY0JlemllciggdCwgdjAueSwgdjEueSwgdjIueSwgdjMueSApLAoJCQlDdWJpY0JlemllciggdCwgdjAueiwgdjEueiwgdjIueiwgdjMueiApCgkJKTsKCgkJcmV0dXJuIHBvaW50OwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnYwLmNvcHkoIHNvdXJjZS52MCApOwoJCXRoaXMudjEuY29weSggc291cmNlLnYxICk7CgkJdGhpcy52Mi5jb3B5KCBzb3VyY2UudjIgKTsKCQl0aGlzLnYzLmNvcHkoIHNvdXJjZS52MyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEudjAgPSB0aGlzLnYwLnRvQXJyYXkoKTsKCQlkYXRhLnYxID0gdGhpcy52MS50b0FycmF5KCk7CgkJZGF0YS52MiA9IHRoaXMudjIudG9BcnJheSgpOwoJCWRhdGEudjMgPSB0aGlzLnYzLnRvQXJyYXkoKTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQlzdXBlci5mcm9tSlNPTigganNvbiApOwoKCQl0aGlzLnYwLmZyb21BcnJheSgganNvbi52MCApOwoJCXRoaXMudjEuZnJvbUFycmF5KCBqc29uLnYxICk7CgkJdGhpcy52Mi5mcm9tQXJyYXkoIGpzb24udjIgKTsKCQl0aGlzLnYzLmZyb21BcnJheSgganNvbi52MyApOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBMaW5lQ3VydmUgZXh0ZW5kcyBDdXJ2ZSB7CgoJY29uc3RydWN0b3IoIHYxID0gbmV3IFZlY3RvcjIoKSwgdjIgPSBuZXcgVmVjdG9yMigpICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTGluZUN1cnZlID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0xpbmVDdXJ2ZSc7CgoJCXRoaXMudjEgPSB2MTsKCQl0aGlzLnYyID0gdjI7CgoJfQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IyKCkgKSB7CgoJCWNvbnN0IHBvaW50ID0gb3B0aW9uYWxUYXJnZXQ7CgoJCWlmICggdCA9PT0gMSApIHsKCgkJCXBvaW50LmNvcHkoIHRoaXMudjIgKTsKCgkJfSBlbHNlIHsKCgkJCXBvaW50LmNvcHkoIHRoaXMudjIgKS5zdWIoIHRoaXMudjEgKTsKCQkJcG9pbnQubXVsdGlwbHlTY2FsYXIoIHQgKS5hZGQoIHRoaXMudjEgKTsKCgkJfQoKCQlyZXR1cm4gcG9pbnQ7CgoJfQoKCS8vIExpbmUgY3VydmUgaXMgbGluZWFyLCBzbyB3ZSBjYW4gb3ZlcndyaXRlIGRlZmF1bHQgZ2V0UG9pbnRBdAoJZ2V0UG9pbnRBdCggdSwgb3B0aW9uYWxUYXJnZXQgKSB7CgoJCXJldHVybiB0aGlzLmdldFBvaW50KCB1LCBvcHRpb25hbFRhcmdldCApOwoKCX0KCglnZXRUYW5nZW50KCB0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IyKCkgKSB7CgoJCXJldHVybiBvcHRpb25hbFRhcmdldC5zdWJWZWN0b3JzKCB0aGlzLnYyLCB0aGlzLnYxICkubm9ybWFsaXplKCk7CgoJfQoKCWdldFRhbmdlbnRBdCggdSwgb3B0aW9uYWxUYXJnZXQgKSB7CgoJCXJldHVybiB0aGlzLmdldFRhbmdlbnQoIHUsIG9wdGlvbmFsVGFyZ2V0ICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMudjEuY29weSggc291cmNlLnYxICk7CgkJdGhpcy52Mi5jb3B5KCBzb3VyY2UudjIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLnYxID0gdGhpcy52MS50b0FycmF5KCk7CgkJZGF0YS52MiA9IHRoaXMudjIudG9BcnJheSgpOwoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXN1cGVyLmZyb21KU09OKCBqc29uICk7CgoJCXRoaXMudjEuZnJvbUFycmF5KCBqc29uLnYxICk7CgkJdGhpcy52Mi5mcm9tQXJyYXkoIGpzb24udjIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgTGluZUN1cnZlMyBleHRlbmRzIEN1cnZlIHsKCgljb25zdHJ1Y3RvciggdjEgPSBuZXcgVmVjdG9yMygpLCB2MiA9IG5ldyBWZWN0b3IzKCkgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNMaW5lQ3VydmUzID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0xpbmVDdXJ2ZTMnOwoKCQl0aGlzLnYxID0gdjE7CgkJdGhpcy52MiA9IHYyOwoKCX0KCglnZXRQb2ludCggdCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMygpICkgewoKCQljb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwoKCQlpZiAoIHQgPT09IDEgKSB7CgoJCQlwb2ludC5jb3B5KCB0aGlzLnYyICk7CgoJCX0gZWxzZSB7CgoJCQlwb2ludC5jb3B5KCB0aGlzLnYyICkuc3ViKCB0aGlzLnYxICk7CgkJCXBvaW50Lm11bHRpcGx5U2NhbGFyKCB0ICkuYWRkKCB0aGlzLnYxICk7CgoJCX0KCgkJcmV0dXJuIHBvaW50OwoKCX0KCgkvLyBMaW5lIGN1cnZlIGlzIGxpbmVhciwgc28gd2UgY2FuIG92ZXJ3cml0ZSBkZWZhdWx0IGdldFBvaW50QXQKCWdldFBvaW50QXQoIHUsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQlyZXR1cm4gdGhpcy5nZXRQb2ludCggdSwgb3B0aW9uYWxUYXJnZXQgKTsKCgl9CgoJZ2V0VGFuZ2VudCggdCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMygpICkgewoKCQlyZXR1cm4gb3B0aW9uYWxUYXJnZXQuc3ViVmVjdG9ycyggdGhpcy52MiwgdGhpcy52MSApLm5vcm1hbGl6ZSgpOwoKCX0KCglnZXRUYW5nZW50QXQoIHUsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQlyZXR1cm4gdGhpcy5nZXRUYW5nZW50KCB1LCBvcHRpb25hbFRhcmdldCApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnYxLmNvcHkoIHNvdXJjZS52MSApOwoJCXRoaXMudjIuY29weSggc291cmNlLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS52MSA9IHRoaXMudjEudG9BcnJheSgpOwoJCWRhdGEudjIgPSB0aGlzLnYyLnRvQXJyYXkoKTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQlzdXBlci5mcm9tSlNPTigganNvbiApOwoKCQl0aGlzLnYxLmZyb21BcnJheSgganNvbi52MSApOwoJCXRoaXMudjIuZnJvbUFycmF5KCBqc29uLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFF1YWRyYXRpY0JlemllckN1cnZlIGV4dGVuZHMgQ3VydmUgewoKCWNvbnN0cnVjdG9yKCB2MCA9IG5ldyBWZWN0b3IyKCksIHYxID0gbmV3IFZlY3RvcjIoKSwgdjIgPSBuZXcgVmVjdG9yMigpICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzUXVhZHJhdGljQmV6aWVyQ3VydmUgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUXVhZHJhdGljQmV6aWVyQ3VydmUnOwoKCQl0aGlzLnYwID0gdjA7CgkJdGhpcy52MSA9IHYxOwoJCXRoaXMudjIgPSB2MjsKCgl9CgoJZ2V0UG9pbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ID0gbmV3IFZlY3RvcjIoKSApIHsKCgkJY29uc3QgcG9pbnQgPSBvcHRpb25hbFRhcmdldDsKCgkJY29uc3QgdjAgPSB0aGlzLnYwLCB2MSA9IHRoaXMudjEsIHYyID0gdGhpcy52MjsKCgkJcG9pbnQuc2V0KAoJCQlRdWFkcmF0aWNCZXppZXIoIHQsIHYwLngsIHYxLngsIHYyLnggKSwKCQkJUXVhZHJhdGljQmV6aWVyKCB0LCB2MC55LCB2MS55LCB2Mi55ICkKCQkpOwoKCQlyZXR1cm4gcG9pbnQ7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMudjAuY29weSggc291cmNlLnYwICk7CgkJdGhpcy52MS5jb3B5KCBzb3VyY2UudjEgKTsKCQl0aGlzLnYyLmNvcHkoIHNvdXJjZS52MiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEudjAgPSB0aGlzLnYwLnRvQXJyYXkoKTsKCQlkYXRhLnYxID0gdGhpcy52MS50b0FycmF5KCk7CgkJZGF0YS52MiA9IHRoaXMudjIudG9BcnJheSgpOwoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXN1cGVyLmZyb21KU09OKCBqc29uICk7CgoJCXRoaXMudjAuZnJvbUFycmF5KCBqc29uLnYwICk7CgkJdGhpcy52MS5mcm9tQXJyYXkoIGpzb24udjEgKTsKCQl0aGlzLnYyLmZyb21BcnJheSgganNvbi52MiApOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBRdWFkcmF0aWNCZXppZXJDdXJ2ZTMgZXh0ZW5kcyBDdXJ2ZSB7CgoJY29uc3RydWN0b3IoIHYwID0gbmV3IFZlY3RvcjMoKSwgdjEgPSBuZXcgVmVjdG9yMygpLCB2MiA9IG5ldyBWZWN0b3IzKCkgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNRdWFkcmF0aWNCZXppZXJDdXJ2ZTMgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUXVhZHJhdGljQmV6aWVyQ3VydmUzJzsKCgkJdGhpcy52MCA9IHYwOwoJCXRoaXMudjEgPSB2MTsKCQl0aGlzLnYyID0gdjI7CgoJfQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IzKCkgKSB7CgoJCWNvbnN0IHBvaW50ID0gb3B0aW9uYWxUYXJnZXQ7CgoJCWNvbnN0IHYwID0gdGhpcy52MCwgdjEgPSB0aGlzLnYxLCB2MiA9IHRoaXMudjI7CgoJCXBvaW50LnNldCgKCQkJUXVhZHJhdGljQmV6aWVyKCB0LCB2MC54LCB2MS54LCB2Mi54ICksCgkJCVF1YWRyYXRpY0JlemllciggdCwgdjAueSwgdjEueSwgdjIueSApLAoJCQlRdWFkcmF0aWNCZXppZXIoIHQsIHYwLnosIHYxLnosIHYyLnogKQoJCSk7CgoJCXJldHVybiBwb2ludDsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy52MC5jb3B5KCBzb3VyY2UudjAgKTsKCQl0aGlzLnYxLmNvcHkoIHNvdXJjZS52MSApOwoJCXRoaXMudjIuY29weSggc291cmNlLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS52MCA9IHRoaXMudjAudG9BcnJheSgpOwoJCWRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKCQlkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCglmcm9tSlNPTigganNvbiApIHsKCgkJc3VwZXIuZnJvbUpTT04oIGpzb24gKTsKCgkJdGhpcy52MC5mcm9tQXJyYXkoIGpzb24udjAgKTsKCQl0aGlzLnYxLmZyb21BcnJheSgganNvbi52MSApOwoJCXRoaXMudjIuZnJvbUFycmF5KCBqc29uLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFNwbGluZUN1cnZlIGV4dGVuZHMgQ3VydmUgewoKCWNvbnN0cnVjdG9yKCBwb2ludHMgPSBbXSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1NwbGluZUN1cnZlID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1NwbGluZUN1cnZlJzsKCgkJdGhpcy5wb2ludHMgPSBwb2ludHM7CgoJfQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IyKCkgKSB7CgoJCWNvbnN0IHBvaW50ID0gb3B0aW9uYWxUYXJnZXQ7CgoJCWNvbnN0IHBvaW50cyA9IHRoaXMucG9pbnRzOwoJCWNvbnN0IHAgPSAoIHBvaW50cy5sZW5ndGggLSAxICkgKiB0OwoKCQljb25zdCBpbnRQb2ludCA9IE1hdGguZmxvb3IoIHAgKTsKCQljb25zdCB3ZWlnaHQgPSBwIC0gaW50UG9pbnQ7CgoJCWNvbnN0IHAwID0gcG9pbnRzWyBpbnRQb2ludCA9PT0gMCA/IGludFBvaW50IDogaW50UG9pbnQgLSAxIF07CgkJY29uc3QgcDEgPSBwb2ludHNbIGludFBvaW50IF07CgkJY29uc3QgcDIgPSBwb2ludHNbIGludFBvaW50ID4gcG9pbnRzLmxlbmd0aCAtIDIgPyBwb2ludHMubGVuZ3RoIC0gMSA6IGludFBvaW50ICsgMSBdOwoJCWNvbnN0IHAzID0gcG9pbnRzWyBpbnRQb2ludCA+IHBvaW50cy5sZW5ndGggLSAzID8gcG9pbnRzLmxlbmd0aCAtIDEgOiBpbnRQb2ludCArIDIgXTsKCgkJcG9pbnQuc2V0KAoJCQlDYXRtdWxsUm9tKCB3ZWlnaHQsIHAwLngsIHAxLngsIHAyLngsIHAzLnggKSwKCQkJQ2F0bXVsbFJvbSggd2VpZ2h0LCBwMC55LCBwMS55LCBwMi55LCBwMy55ICkKCQkpOwoKCQlyZXR1cm4gcG9pbnQ7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucG9pbnRzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHNvdXJjZS5wb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHBvaW50ID0gc291cmNlLnBvaW50c1sgaSBdOwoKCQkJdGhpcy5wb2ludHMucHVzaCggcG9pbnQuY2xvbmUoKSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS5wb2ludHMgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5wb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHBvaW50ID0gdGhpcy5wb2ludHNbIGkgXTsKCQkJZGF0YS5wb2ludHMucHVzaCggcG9pbnQudG9BcnJheSgpICk7CgoJCX0KCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQlzdXBlci5mcm9tSlNPTigganNvbiApOwoKCQl0aGlzLnBvaW50cyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBqc29uLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgcG9pbnQgPSBqc29uLnBvaW50c1sgaSBdOwoJCQl0aGlzLnBvaW50cy5wdXNoKCBuZXcgVmVjdG9yMigpLmZyb21BcnJheSggcG9pbnQgKSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCnZhciBDdXJ2ZXMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CglfX3Byb3RvX186IG51bGwsCglBcmNDdXJ2ZTogQXJjQ3VydmUsCglDYXRtdWxsUm9tQ3VydmUzOiBDYXRtdWxsUm9tQ3VydmUzLAoJQ3ViaWNCZXppZXJDdXJ2ZTogQ3ViaWNCZXppZXJDdXJ2ZSwKCUN1YmljQmV6aWVyQ3VydmUzOiBDdWJpY0JlemllckN1cnZlMywKCUVsbGlwc2VDdXJ2ZTogRWxsaXBzZUN1cnZlLAoJTGluZUN1cnZlOiBMaW5lQ3VydmUsCglMaW5lQ3VydmUzOiBMaW5lQ3VydmUzLAoJUXVhZHJhdGljQmV6aWVyQ3VydmU6IFF1YWRyYXRpY0JlemllckN1cnZlLAoJUXVhZHJhdGljQmV6aWVyQ3VydmUzOiBRdWFkcmF0aWNCZXppZXJDdXJ2ZTMsCglTcGxpbmVDdXJ2ZTogU3BsaW5lQ3VydmUKfSk7CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICoJQ3VydmVkIFBhdGggLSBhIGN1cnZlIHBhdGggaXMgc2ltcGx5IGEgYXJyYXkgb2YgY29ubmVjdGVkCiAqICBjdXJ2ZXMsIGJ1dCByZXRhaW5zIHRoZSBhcGkgb2YgYSBjdXJ2ZQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgpjbGFzcyBDdXJ2ZVBhdGggZXh0ZW5kcyBDdXJ2ZSB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdDdXJ2ZVBhdGgnOwoKCQl0aGlzLmN1cnZlcyA9IFtdOwoJCXRoaXMuYXV0b0Nsb3NlID0gZmFsc2U7IC8vIEF1dG9tYXRpY2FsbHkgY2xvc2VzIHRoZSBwYXRoCgoJfQoKCWFkZCggY3VydmUgKSB7CgoJCXRoaXMuY3VydmVzLnB1c2goIGN1cnZlICk7CgoJfQoKCWNsb3NlUGF0aCgpIHsKCgkJLy8gQWRkIGEgbGluZSBjdXJ2ZSBpZiBzdGFydCBhbmQgZW5kIG9mIGxpbmVzIGFyZSBub3QgY29ubmVjdGVkCgkJY29uc3Qgc3RhcnRQb2ludCA9IHRoaXMuY3VydmVzWyAwIF0uZ2V0UG9pbnQoIDAgKTsKCQljb25zdCBlbmRQb2ludCA9IHRoaXMuY3VydmVzWyB0aGlzLmN1cnZlcy5sZW5ndGggLSAxIF0uZ2V0UG9pbnQoIDEgKTsKCgkJaWYgKCAhIHN0YXJ0UG9pbnQuZXF1YWxzKCBlbmRQb2ludCApICkgewoKCQkJY29uc3QgbGluZVR5cGUgPSAoIHN0YXJ0UG9pbnQuaXNWZWN0b3IyID09PSB0cnVlICkgPyAnTGluZUN1cnZlJyA6ICdMaW5lQ3VydmUzJzsKCQkJdGhpcy5jdXJ2ZXMucHVzaCggbmV3IEN1cnZlc1sgbGluZVR5cGUgXSggZW5kUG9pbnQsIHN0YXJ0UG9pbnQgKSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgkvLyBUbyBnZXQgYWNjdXJhdGUgcG9pbnQgd2l0aCByZWZlcmVuY2UgdG8KCS8vIGVudGlyZSBwYXRoIGRpc3RhbmNlIGF0IHRpbWUgdCwKCS8vIGZvbGxvd2luZyBoYXMgdG8gYmUgZG9uZToKCgkvLyAxLiBMZW5ndGggb2YgZWFjaCBzdWIgcGF0aCBoYXZlIHRvIGJlIGtub3duCgkvLyAyLiBMb2NhdGUgYW5kIGlkZW50aWZ5IHR5cGUgb2YgY3VydmUKCS8vIDMuIEdldCB0IGZvciB0aGUgY3VydmUKCS8vIDQuIFJldHVybiBjdXJ2ZS5nZXRQb2ludEF0KHQnKQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCApIHsKCgkJY29uc3QgZCA9IHQgKiB0aGlzLmdldExlbmd0aCgpOwoJCWNvbnN0IGN1cnZlTGVuZ3RocyA9IHRoaXMuZ2V0Q3VydmVMZW5ndGhzKCk7CgkJbGV0IGkgPSAwOwoKCQkvLyBUbyB0aGluayBhYm91dCBib3VuZGFyaWVzIHBvaW50cy4KCgkJd2hpbGUgKCBpIDwgY3VydmVMZW5ndGhzLmxlbmd0aCApIHsKCgkJCWlmICggY3VydmVMZW5ndGhzWyBpIF0gPj0gZCApIHsKCgkJCQljb25zdCBkaWZmID0gY3VydmVMZW5ndGhzWyBpIF0gLSBkOwoJCQkJY29uc3QgY3VydmUgPSB0aGlzLmN1cnZlc1sgaSBdOwoKCQkJCWNvbnN0IHNlZ21lbnRMZW5ndGggPSBjdXJ2ZS5nZXRMZW5ndGgoKTsKCQkJCWNvbnN0IHUgPSBzZWdtZW50TGVuZ3RoID09PSAwID8gMCA6IDEgLSBkaWZmIC8gc2VnbWVudExlbmd0aDsKCgkJCQlyZXR1cm4gY3VydmUuZ2V0UG9pbnRBdCggdSwgb3B0aW9uYWxUYXJnZXQgKTsKCgkJCX0KCgkJCWkgKys7CgoJCX0KCgkJcmV0dXJuIG51bGw7CgoJCS8vIGxvb3Agd2hlcmUgc3VtICE9IDAsIHN1bSA+IGQgLCBzdW0rMSA8ZAoKCX0KCgkvLyBXZSBjYW5ub3QgdXNlIHRoZSBkZWZhdWx0IFRIUkVFLkN1cnZlIGdldFBvaW50KCkgd2l0aCBnZXRMZW5ndGgoKSBiZWNhdXNlIGluCgkvLyBUSFJFRS5DdXJ2ZSwgZ2V0TGVuZ3RoKCkgZGVwZW5kcyBvbiBnZXRQb2ludCgpIGJ1dCBpbiBUSFJFRS5DdXJ2ZVBhdGgKCS8vIGdldFBvaW50KCkgZGVwZW5kcyBvbiBnZXRMZW5ndGgKCglnZXRMZW5ndGgoKSB7CgoJCWNvbnN0IGxlbnMgPSB0aGlzLmdldEN1cnZlTGVuZ3RocygpOwoJCXJldHVybiBsZW5zWyBsZW5zLmxlbmd0aCAtIDEgXTsKCgl9CgoJLy8gY2FjaGVMZW5ndGhzIG11c3QgYmUgcmVjYWxjdWxhdGVkLgoJdXBkYXRlQXJjTGVuZ3RocygpIHsKCgkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJdGhpcy5jYWNoZUxlbmd0aHMgPSBudWxsOwoJCXRoaXMuZ2V0Q3VydmVMZW5ndGhzKCk7CgoJfQoKCS8vIENvbXB1dGUgbGVuZ3RocyBhbmQgY2FjaGUgdGhlbQoJLy8gV2UgY2Fubm90IG92ZXJ3cml0ZSBnZXRMZW5ndGhzKCkgYmVjYXVzZSBVdG9UIG1hcHBpbmcgdXNlcyBpdC4KCglnZXRDdXJ2ZUxlbmd0aHMoKSB7CgoJCS8vIFdlIHVzZSBjYWNoZSB2YWx1ZXMgaWYgY3VydmVzIGFuZCBjYWNoZSBhcnJheSBhcmUgc2FtZSBsZW5ndGgKCgkJaWYgKCB0aGlzLmNhY2hlTGVuZ3RocyAmJiB0aGlzLmNhY2hlTGVuZ3Rocy5sZW5ndGggPT09IHRoaXMuY3VydmVzLmxlbmd0aCApIHsKCgkJCXJldHVybiB0aGlzLmNhY2hlTGVuZ3RoczsKCgkJfQoKCQkvLyBHZXQgbGVuZ3RoIG9mIHN1Yi1jdXJ2ZQoJCS8vIFB1c2ggc3VtcyBpbnRvIGNhY2hlZCBhcnJheQoKCQljb25zdCBsZW5ndGhzID0gW107CgkJbGV0IHN1bXMgPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmN1cnZlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJc3VtcyArPSB0aGlzLmN1cnZlc1sgaSBdLmdldExlbmd0aCgpOwoJCQlsZW5ndGhzLnB1c2goIHN1bXMgKTsKCgkJfQoKCQl0aGlzLmNhY2hlTGVuZ3RocyA9IGxlbmd0aHM7CgoJCXJldHVybiBsZW5ndGhzOwoKCX0KCglnZXRTcGFjZWRQb2ludHMoIGRpdmlzaW9ucyA9IDQwICkgewoKCQljb25zdCBwb2ludHMgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDw9IGRpdmlzaW9uczsgaSArKyApIHsKCgkJCXBvaW50cy5wdXNoKCB0aGlzLmdldFBvaW50KCBpIC8gZGl2aXNpb25zICkgKTsKCgkJfQoKCQlpZiAoIHRoaXMuYXV0b0Nsb3NlICkgewoKCQkJcG9pbnRzLnB1c2goIHBvaW50c1sgMCBdICk7CgoJCX0KCgkJcmV0dXJuIHBvaW50czsKCgl9CgoJZ2V0UG9pbnRzKCBkaXZpc2lvbnMgPSAxMiApIHsKCgkJY29uc3QgcG9pbnRzID0gW107CgkJbGV0IGxhc3Q7CgoJCWZvciAoIGxldCBpID0gMCwgY3VydmVzID0gdGhpcy5jdXJ2ZXM7IGkgPCBjdXJ2ZXMubGVuZ3RoOyBpICsrICkgewoKCQkJY29uc3QgY3VydmUgPSBjdXJ2ZXNbIGkgXTsKCQkJY29uc3QgcmVzb2x1dGlvbiA9IGN1cnZlLmlzRWxsaXBzZUN1cnZlID8gZGl2aXNpb25zICogMgoJCQkJOiAoIGN1cnZlLmlzTGluZUN1cnZlIHx8IGN1cnZlLmlzTGluZUN1cnZlMyApID8gMQoJCQkJCTogY3VydmUuaXNTcGxpbmVDdXJ2ZSA/IGRpdmlzaW9ucyAqIGN1cnZlLnBvaW50cy5sZW5ndGgKCQkJCQkJOiBkaXZpc2lvbnM7CgoJCQljb25zdCBwdHMgPSBjdXJ2ZS5nZXRQb2ludHMoIHJlc29sdXRpb24gKTsKCgkJCWZvciAoIGxldCBqID0gMDsgaiA8IHB0cy5sZW5ndGg7IGogKysgKSB7CgoJCQkJY29uc3QgcG9pbnQgPSBwdHNbIGogXTsKCgkJCQlpZiAoIGxhc3QgJiYgbGFzdC5lcXVhbHMoIHBvaW50ICkgKSBjb250aW51ZTsgLy8gZW5zdXJlcyBubyBjb25zZWN1dGl2ZSBwb2ludHMgYXJlIGR1cGxpY2F0ZXMKCgkJCQlwb2ludHMucHVzaCggcG9pbnQgKTsKCQkJCWxhc3QgPSBwb2ludDsKCgkJCX0KCgkJfQoKCQlpZiAoIHRoaXMuYXV0b0Nsb3NlICYmIHBvaW50cy5sZW5ndGggPiAxICYmICEgcG9pbnRzWyBwb2ludHMubGVuZ3RoIC0gMSBdLmVxdWFscyggcG9pbnRzWyAwIF0gKSApIHsKCgkJCXBvaW50cy5wdXNoKCBwb2ludHNbIDAgXSApOwoKCQl9CgoJCXJldHVybiBwb2ludHM7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuY3VydmVzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHNvdXJjZS5jdXJ2ZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGN1cnZlID0gc291cmNlLmN1cnZlc1sgaSBdOwoKCQkJdGhpcy5jdXJ2ZXMucHVzaCggY3VydmUuY2xvbmUoKSApOwoKCQl9CgoJCXRoaXMuYXV0b0Nsb3NlID0gc291cmNlLmF1dG9DbG9zZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLmF1dG9DbG9zZSA9IHRoaXMuYXV0b0Nsb3NlOwoJCWRhdGEuY3VydmVzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY3VydmVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBjdXJ2ZSA9IHRoaXMuY3VydmVzWyBpIF07CgkJCWRhdGEuY3VydmVzLnB1c2goIGN1cnZlLnRvSlNPTigpICk7CgoJCX0KCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQlzdXBlci5mcm9tSlNPTigganNvbiApOwoKCQl0aGlzLmF1dG9DbG9zZSA9IGpzb24uYXV0b0Nsb3NlOwoJCXRoaXMuY3VydmVzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24uY3VydmVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBjdXJ2ZSA9IGpzb24uY3VydmVzWyBpIF07CgkJCXRoaXMuY3VydmVzLnB1c2goIG5ldyBDdXJ2ZXNbIGN1cnZlLnR5cGUgXSgpLmZyb21KU09OKCBjdXJ2ZSApICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgUGF0aCBleHRlbmRzIEN1cnZlUGF0aCB7CgoJY29uc3RydWN0b3IoIHBvaW50cyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ1BhdGgnOwoKCQl0aGlzLmN1cnJlbnRQb2ludCA9IG5ldyBWZWN0b3IyKCk7CgoJCWlmICggcG9pbnRzICkgewoKCQkJdGhpcy5zZXRGcm9tUG9pbnRzKCBwb2ludHMgKTsKCgkJfQoKCX0KCglzZXRGcm9tUG9pbnRzKCBwb2ludHMgKSB7CgoJCXRoaXMubW92ZVRvKCBwb2ludHNbIDAgXS54LCBwb2ludHNbIDAgXS55ICk7CgoJCWZvciAoIGxldCBpID0gMSwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJdGhpcy5saW5lVG8oIHBvaW50c1sgaSBdLngsIHBvaW50c1sgaSBdLnkgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbW92ZVRvKCB4LCB5ICkgewoKCQl0aGlzLmN1cnJlbnRQb2ludC5zZXQoIHgsIHkgKTsgLy8gVE9ETyBjb25zaWRlciByZWZlcmVuY2luZyB2ZWN0b3JzIGluc3RlYWQgb2YgY29weWluZz8KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWxpbmVUbyggeCwgeSApIHsKCgkJY29uc3QgY3VydmUgPSBuZXcgTGluZUN1cnZlKCB0aGlzLmN1cnJlbnRQb2ludC5jbG9uZSgpLCBuZXcgVmVjdG9yMiggeCwgeSApICk7CgkJdGhpcy5jdXJ2ZXMucHVzaCggY3VydmUgKTsKCgkJdGhpcy5jdXJyZW50UG9pbnQuc2V0KCB4LCB5ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglxdWFkcmF0aWNDdXJ2ZVRvKCBhQ1B4LCBhQ1B5LCBhWCwgYVkgKSB7CgoJCWNvbnN0IGN1cnZlID0gbmV3IFF1YWRyYXRpY0JlemllckN1cnZlKAoJCQl0aGlzLmN1cnJlbnRQb2ludC5jbG9uZSgpLAoJCQluZXcgVmVjdG9yMiggYUNQeCwgYUNQeSApLAoJCQluZXcgVmVjdG9yMiggYVgsIGFZICkKCQkpOwoKCQl0aGlzLmN1cnZlcy5wdXNoKCBjdXJ2ZSApOwoKCQl0aGlzLmN1cnJlbnRQb2ludC5zZXQoIGFYLCBhWSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYmV6aWVyQ3VydmVUbyggYUNQMXgsIGFDUDF5LCBhQ1AyeCwgYUNQMnksIGFYLCBhWSApIHsKCgkJY29uc3QgY3VydmUgPSBuZXcgQ3ViaWNCZXppZXJDdXJ2ZSgKCQkJdGhpcy5jdXJyZW50UG9pbnQuY2xvbmUoKSwKCQkJbmV3IFZlY3RvcjIoIGFDUDF4LCBhQ1AxeSApLAoJCQluZXcgVmVjdG9yMiggYUNQMngsIGFDUDJ5ICksCgkJCW5ldyBWZWN0b3IyKCBhWCwgYVkgKQoJCSk7CgoJCXRoaXMuY3VydmVzLnB1c2goIGN1cnZlICk7CgoJCXRoaXMuY3VycmVudFBvaW50LnNldCggYVgsIGFZICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzcGxpbmVUaHJ1KCBwdHMgLypBcnJheSBvZiBWZWN0b3IqLyApIHsKCgkJY29uc3QgbnB0cyA9IFsgdGhpcy5jdXJyZW50UG9pbnQuY2xvbmUoKSBdLmNvbmNhdCggcHRzICk7CgoJCWNvbnN0IGN1cnZlID0gbmV3IFNwbGluZUN1cnZlKCBucHRzICk7CgkJdGhpcy5jdXJ2ZXMucHVzaCggY3VydmUgKTsKCgkJdGhpcy5jdXJyZW50UG9pbnQuY29weSggcHRzWyBwdHMubGVuZ3RoIC0gMSBdICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcmMoIGFYLCBhWSwgYVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSApIHsKCgkJY29uc3QgeDAgPSB0aGlzLmN1cnJlbnRQb2ludC54OwoJCWNvbnN0IHkwID0gdGhpcy5jdXJyZW50UG9pbnQueTsKCgkJdGhpcy5hYnNhcmMoIGFYICsgeDAsIGFZICsgeTAsIGFSYWRpdXMsCgkJCWFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFic2FyYyggYVgsIGFZLCBhUmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlICkgewoKCQl0aGlzLmFic2VsbGlwc2UoIGFYLCBhWSwgYVJhZGl1cywgYVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZWxsaXBzZSggYVgsIGFZLCB4UmFkaXVzLCB5UmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlLCBhUm90YXRpb24gKSB7CgoJCWNvbnN0IHgwID0gdGhpcy5jdXJyZW50UG9pbnQueDsKCQljb25zdCB5MCA9IHRoaXMuY3VycmVudFBvaW50Lnk7CgoJCXRoaXMuYWJzZWxsaXBzZSggYVggKyB4MCwgYVkgKyB5MCwgeFJhZGl1cywgeVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSwgYVJvdGF0aW9uICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhYnNlbGxpcHNlKCBhWCwgYVksIHhSYWRpdXMsIHlSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UsIGFSb3RhdGlvbiApIHsKCgkJY29uc3QgY3VydmUgPSBuZXcgRWxsaXBzZUN1cnZlKCBhWCwgYVksIHhSYWRpdXMsIHlSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UsIGFSb3RhdGlvbiApOwoKCQlpZiAoIHRoaXMuY3VydmVzLmxlbmd0aCA+IDAgKSB7CgoJCQkvLyBpZiBhIHByZXZpb3VzIGN1cnZlIGlzIHByZXNlbnQsIGF0dGVtcHQgdG8gam9pbgoJCQljb25zdCBmaXJzdFBvaW50ID0gY3VydmUuZ2V0UG9pbnQoIDAgKTsKCgkJCWlmICggISBmaXJzdFBvaW50LmVxdWFscyggdGhpcy5jdXJyZW50UG9pbnQgKSApIHsKCgkJCQl0aGlzLmxpbmVUbyggZmlyc3RQb2ludC54LCBmaXJzdFBvaW50LnkgKTsKCgkJCX0KCgkJfQoKCQl0aGlzLmN1cnZlcy5wdXNoKCBjdXJ2ZSApOwoKCQljb25zdCBsYXN0UG9pbnQgPSBjdXJ2ZS5nZXRQb2ludCggMSApOwoJCXRoaXMuY3VycmVudFBvaW50LmNvcHkoIGxhc3RQb2ludCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5jdXJyZW50UG9pbnQuY29weSggc291cmNlLmN1cnJlbnRQb2ludCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEuY3VycmVudFBvaW50ID0gdGhpcy5jdXJyZW50UG9pbnQudG9BcnJheSgpOwoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXN1cGVyLmZyb21KU09OKCBqc29uICk7CgoJCXRoaXMuY3VycmVudFBvaW50LmZyb21BcnJheSgganNvbi5jdXJyZW50UG9pbnQgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgTGF0aGVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcG9pbnRzID0gWyBuZXcgVmVjdG9yMiggMCwgLSAwLjUgKSwgbmV3IFZlY3RvcjIoIDAuNSwgMCApLCBuZXcgVmVjdG9yMiggMCwgMC41ICkgXSwgc2VnbWVudHMgPSAxMiwgcGhpU3RhcnQgPSAwLCBwaGlMZW5ndGggPSBNYXRoLlBJICogMiApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ0xhdGhlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXBvaW50czogcG9pbnRzLAoJCQlzZWdtZW50czogc2VnbWVudHMsCgkJCXBoaVN0YXJ0OiBwaGlTdGFydCwKCQkJcGhpTGVuZ3RoOiBwaGlMZW5ndGgKCQl9OwoKCQlzZWdtZW50cyA9IE1hdGguZmxvb3IoIHNlZ21lbnRzICk7CgoJCS8vIGNsYW1wIHBoaUxlbmd0aCBzbyBpdCdzIGluIHJhbmdlIG9mIFsgMCwgMlBJIF0KCgkJcGhpTGVuZ3RoID0gY2xhbXAoIHBoaUxlbmd0aCwgMCwgTWF0aC5QSSAqIDIgKTsKCgkJLy8gYnVmZmVycwoKCQljb25zdCBpbmRpY2VzID0gW107CgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCQljb25zdCBpbml0Tm9ybWFscyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQljb25zdCBpbnZlcnNlU2VnbWVudHMgPSAxLjAgLyBzZWdtZW50czsKCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IHV2ID0gbmV3IFZlY3RvcjIoKTsKCQljb25zdCBub3JtYWwgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IGN1ck5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3QgcHJldk5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJbGV0IGR4ID0gMDsKCQlsZXQgZHkgPSAwOwoKCQkvLyBwcmUtY29tcHV0ZSBub3JtYWxzIGZvciBpbml0aWFsICJtZXJpZGlhbiIKCgkJZm9yICggbGV0IGogPSAwOyBqIDw9ICggcG9pbnRzLmxlbmd0aCAtIDEgKTsgaiArKyApIHsKCgkJCXN3aXRjaCAoIGogKSB7CgoJCQkJY2FzZSAwOgkJCQkvLyBzcGVjaWFsIGhhbmRsaW5nIGZvciAxc3QgdmVydGV4IG9uIHBhdGgKCgkJCQkJZHggPSBwb2ludHNbIGogKyAxIF0ueCAtIHBvaW50c1sgaiBdLng7CgkJCQkJZHkgPSBwb2ludHNbIGogKyAxIF0ueSAtIHBvaW50c1sgaiBdLnk7CgoJCQkJCW5vcm1hbC54ID0gZHkgKiAxLjA7CgkJCQkJbm9ybWFsLnkgPSAtIGR4OwoJCQkJCW5vcm1hbC56ID0gZHkgKiAwLjA7CgoJCQkJCXByZXZOb3JtYWwuY29weSggbm9ybWFsICk7CgoJCQkJCW5vcm1hbC5ub3JtYWxpemUoKTsKCgkJCQkJaW5pdE5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICggcG9pbnRzLmxlbmd0aCAtIDEgKToJLy8gc3BlY2lhbCBoYW5kbGluZyBmb3IgbGFzdCBWZXJ0ZXggb24gcGF0aAoKCQkJCQlpbml0Tm9ybWFscy5wdXNoKCBwcmV2Tm9ybWFsLngsIHByZXZOb3JtYWwueSwgcHJldk5vcm1hbC56ICk7CgoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CQkJLy8gZGVmYXVsdCBoYW5kbGluZyBmb3IgYWxsIHZlcnRpY2VzIGluIGJldHdlZW4KCgkJCQkJZHggPSBwb2ludHNbIGogKyAxIF0ueCAtIHBvaW50c1sgaiBdLng7CgkJCQkJZHkgPSBwb2ludHNbIGogKyAxIF0ueSAtIHBvaW50c1sgaiBdLnk7CgoJCQkJCW5vcm1hbC54ID0gZHkgKiAxLjA7CgkJCQkJbm9ybWFsLnkgPSAtIGR4OwoJCQkJCW5vcm1hbC56ID0gZHkgKiAwLjA7CgoJCQkJCWN1ck5vcm1hbC5jb3B5KCBub3JtYWwgKTsKCgkJCQkJbm9ybWFsLnggKz0gcHJldk5vcm1hbC54OwoJCQkJCW5vcm1hbC55ICs9IHByZXZOb3JtYWwueTsKCQkJCQlub3JtYWwueiArPSBwcmV2Tm9ybWFsLno7CgoJCQkJCW5vcm1hbC5ub3JtYWxpemUoKTsKCgkJCQkJaW5pdE5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCQlwcmV2Tm9ybWFsLmNvcHkoIGN1ck5vcm1hbCApOwoKCQkJfQoKCQl9CgoJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCB1dnMgYW5kIG5vcm1hbHMKCgkJZm9yICggbGV0IGkgPSAwOyBpIDw9IHNlZ21lbnRzOyBpICsrICkgewoKCQkJY29uc3QgcGhpID0gcGhpU3RhcnQgKyBpICogaW52ZXJzZVNlZ21lbnRzICogcGhpTGVuZ3RoOwoKCQkJY29uc3Qgc2luID0gTWF0aC5zaW4oIHBoaSApOwoJCQljb25zdCBjb3MgPSBNYXRoLmNvcyggcGhpICk7CgoJCQlmb3IgKCBsZXQgaiA9IDA7IGogPD0gKCBwb2ludHMubGVuZ3RoIC0gMSApOyBqICsrICkgewoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRleC54ID0gcG9pbnRzWyBqIF0ueCAqIHNpbjsKCQkJCXZlcnRleC55ID0gcG9pbnRzWyBqIF0ueTsKCQkJCXZlcnRleC56ID0gcG9pbnRzWyBqIF0ueCAqIGNvczsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkJLy8gdXYKCgkJCQl1di54ID0gaSAvIHNlZ21lbnRzOwoJCQkJdXYueSA9IGogLyAoIHBvaW50cy5sZW5ndGggLSAxICk7CgoJCQkJdXZzLnB1c2goIHV2LngsIHV2LnkgKTsKCgkJCQkvLyBub3JtYWwKCgkJCQljb25zdCB4ID0gaW5pdE5vcm1hbHNbIDMgKiBqICsgMCBdICogc2luOwoJCQkJY29uc3QgeSA9IGluaXROb3JtYWxzWyAzICogaiArIDEgXTsKCQkJCWNvbnN0IHogPSBpbml0Tm9ybWFsc1sgMyAqIGogKyAwIF0gKiBjb3M7CgoJCQkJbm9ybWFscy5wdXNoKCB4LCB5LCB6ICk7CgoJCQl9CgoJCX0KCgkJLy8gaW5kaWNlcwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBzZWdtZW50czsgaSArKyApIHsKCgkJCWZvciAoIGxldCBqID0gMDsgaiA8ICggcG9pbnRzLmxlbmd0aCAtIDEgKTsgaiArKyApIHsKCgkJCQljb25zdCBiYXNlID0gaiArIGkgKiBwb2ludHMubGVuZ3RoOwoKCQkJCWNvbnN0IGEgPSBiYXNlOwoJCQkJY29uc3QgYiA9IGJhc2UgKyBwb2ludHMubGVuZ3RoOwoJCQkJY29uc3QgYyA9IGJhc2UgKyBwb2ludHMubGVuZ3RoICsgMTsKCQkJCWNvbnN0IGQgPSBiYXNlICsgMTsKCgkJCQkvLyBmYWNlcwoKCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaW5kaWNlcy5wdXNoKCBjLCBkLCBiICk7CgoJCQl9CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgTGF0aGVHZW9tZXRyeSggZGF0YS5wb2ludHMsIGRhdGEuc2VnbWVudHMsIGRhdGEucGhpU3RhcnQsIGRhdGEucGhpTGVuZ3RoICk7CgoJfQoKfQoKY2xhc3MgQ2Fwc3VsZUdlb21ldHJ5IGV4dGVuZHMgTGF0aGVHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIGxlbmd0aCA9IDEsIGNhcFNlZ21lbnRzID0gNCwgcmFkaWFsU2VnbWVudHMgPSA4ICkgewoKCQljb25zdCBwYXRoID0gbmV3IFBhdGgoKTsKCQlwYXRoLmFic2FyYyggMCwgLSBsZW5ndGggLyAyLCByYWRpdXMsIE1hdGguUEkgKiAxLjUsIDAgKTsKCQlwYXRoLmFic2FyYyggMCwgbGVuZ3RoIC8gMiwgcmFkaXVzLCAwLCBNYXRoLlBJICogMC41ICk7CgoJCXN1cGVyKCBwYXRoLmdldFBvaW50cyggY2FwU2VnbWVudHMgKSwgcmFkaWFsU2VnbWVudHMgKTsKCgkJdGhpcy50eXBlID0gJ0NhcHN1bGVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCWxlbmd0aDogbGVuZ3RoLAoJCQljYXBTZWdtZW50czogY2FwU2VnbWVudHMsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQl9OwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgQ2Fwc3VsZUdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS5sZW5ndGgsIGRhdGEuY2FwU2VnbWVudHMsIGRhdGEucmFkaWFsU2VnbWVudHMgKTsKCgl9Cgp9CgpjbGFzcyBDaXJjbGVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgc2VnbWVudHMgPSAzMiwgdGhldGFTdGFydCA9IDAsIHRoZXRhTGVuZ3RoID0gTWF0aC5QSSAqIDIgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdDaXJjbGVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCXNlZ21lbnRzOiBzZWdtZW50cywKCQkJdGhldGFTdGFydDogdGhldGFTdGFydCwKCQkJdGhldGFMZW5ndGg6IHRoZXRhTGVuZ3RoCgkJfTsKCgkJc2VnbWVudHMgPSBNYXRoLm1heCggMywgc2VnbWVudHMgKTsKCgkJLy8gYnVmZmVycwoKCQljb25zdCBpbmRpY2VzID0gW107CgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBub3JtYWxzID0gW107CgkJY29uc3QgdXZzID0gW107CgoJCS8vIGhlbHBlciB2YXJpYWJsZXMKCgkJY29uc3QgdmVydGV4ID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCB1diA9IG5ldyBWZWN0b3IyKCk7CgoJCS8vIGNlbnRlciBwb2ludAoKCQl2ZXJ0aWNlcy5wdXNoKCAwLCAwLCAwICk7CgkJbm9ybWFscy5wdXNoKCAwLCAwLCAxICk7CgkJdXZzLnB1c2goIDAuNSwgMC41ICk7CgoJCWZvciAoIGxldCBzID0gMCwgaSA9IDM7IHMgPD0gc2VnbWVudHM7IHMgKyssIGkgKz0gMyApIHsKCgkJCWNvbnN0IHNlZ21lbnQgPSB0aGV0YVN0YXJ0ICsgcyAvIHNlZ21lbnRzICogdGhldGFMZW5ndGg7CgoJCQkvLyB2ZXJ0ZXgKCgkJCXZlcnRleC54ID0gcmFkaXVzICogTWF0aC5jb3MoIHNlZ21lbnQgKTsKCQkJdmVydGV4LnkgPSByYWRpdXMgKiBNYXRoLnNpbiggc2VnbWVudCApOwoKCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJLy8gbm9ybWFsCgoJCQlub3JtYWxzLnB1c2goIDAsIDAsIDEgKTsKCgkJCS8vIHV2cwoKCQkJdXYueCA9ICggdmVydGljZXNbIGkgXSAvIHJhZGl1cyArIDEgKSAvIDI7CgkJCXV2LnkgPSAoIHZlcnRpY2VzWyBpICsgMSBdIC8gcmFkaXVzICsgMSApIC8gMjsKCgkJCXV2cy5wdXNoKCB1di54LCB1di55ICk7CgoJCX0KCgkJLy8gaW5kaWNlcwoKCQlmb3IgKCBsZXQgaSA9IDE7IGkgPD0gc2VnbWVudHM7IGkgKysgKSB7CgoJCQlpbmRpY2VzLnB1c2goIGksIGkgKyAxLCAwICk7CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgQ2lyY2xlR2VvbWV0cnkoIGRhdGEucmFkaXVzLCBkYXRhLnNlZ21lbnRzLCBkYXRhLnRoZXRhU3RhcnQsIGRhdGEudGhldGFMZW5ndGggKTsKCgl9Cgp9CgpjbGFzcyBDeWxpbmRlckdlb21ldHJ5IGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewoKCWNvbnN0cnVjdG9yKCByYWRpdXNUb3AgPSAxLCByYWRpdXNCb3R0b20gPSAxLCBoZWlnaHQgPSAxLCByYWRpYWxTZWdtZW50cyA9IDMyLCBoZWlnaHRTZWdtZW50cyA9IDEsIG9wZW5FbmRlZCA9IGZhbHNlLCB0aGV0YVN0YXJ0ID0gMCwgdGhldGFMZW5ndGggPSBNYXRoLlBJICogMiApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ0N5bGluZGVyR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1c1RvcDogcmFkaXVzVG9wLAoJCQlyYWRpdXNCb3R0b206IHJhZGl1c0JvdHRvbSwKCQkJaGVpZ2h0OiBoZWlnaHQsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQkJaGVpZ2h0U2VnbWVudHM6IGhlaWdodFNlZ21lbnRzLAoJCQlvcGVuRW5kZWQ6IG9wZW5FbmRlZCwKCQkJdGhldGFTdGFydDogdGhldGFTdGFydCwKCQkJdGhldGFMZW5ndGg6IHRoZXRhTGVuZ3RoCgkJfTsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQlyYWRpYWxTZWdtZW50cyA9IE1hdGguZmxvb3IoIHJhZGlhbFNlZ21lbnRzICk7CgkJaGVpZ2h0U2VnbWVudHMgPSBNYXRoLmZsb29yKCBoZWlnaHRTZWdtZW50cyApOwoKCQkvLyBidWZmZXJzCgoJCWNvbnN0IGluZGljZXMgPSBbXTsKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQlsZXQgaW5kZXggPSAwOwoJCWNvbnN0IGluZGV4QXJyYXkgPSBbXTsKCQljb25zdCBoYWxmSGVpZ2h0ID0gaGVpZ2h0IC8gMjsKCQlsZXQgZ3JvdXBTdGFydCA9IDA7CgoJCS8vIGdlbmVyYXRlIGdlb21ldHJ5CgoJCWdlbmVyYXRlVG9yc28oKTsKCgkJaWYgKCBvcGVuRW5kZWQgPT09IGZhbHNlICkgewoKCQkJaWYgKCByYWRpdXNUb3AgPiAwICkgZ2VuZXJhdGVDYXAoIHRydWUgKTsKCQkJaWYgKCByYWRpdXNCb3R0b20gPiAwICkgZ2VuZXJhdGVDYXAoIGZhbHNlICk7CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgkJZnVuY3Rpb24gZ2VuZXJhdGVUb3JzbygpIHsKCgkJCWNvbnN0IG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlsZXQgZ3JvdXBDb3VudCA9IDA7CgoJCQkvLyB0aGlzIHdpbGwgYmUgdXNlZCB0byBjYWxjdWxhdGUgdGhlIG5vcm1hbAoJCQljb25zdCBzbG9wZSA9ICggcmFkaXVzQm90dG9tIC0gcmFkaXVzVG9wICkgLyBoZWlnaHQ7CgoJCQkvLyBnZW5lcmF0ZSB2ZXJ0aWNlcywgbm9ybWFscyBhbmQgdXZzCgoJCQlmb3IgKCBsZXQgeSA9IDA7IHkgPD0gaGVpZ2h0U2VnbWVudHM7IHkgKysgKSB7CgoJCQkJY29uc3QgaW5kZXhSb3cgPSBbXTsKCgkJCQljb25zdCB2ID0geSAvIGhlaWdodFNlZ21lbnRzOwoKCQkJCS8vIGNhbGN1bGF0ZSB0aGUgcmFkaXVzIG9mIHRoZSBjdXJyZW50IHJvdwoKCQkJCWNvbnN0IHJhZGl1cyA9IHYgKiAoIHJhZGl1c0JvdHRvbSAtIHJhZGl1c1RvcCApICsgcmFkaXVzVG9wOwoKCQkJCWZvciAoIGxldCB4ID0gMDsgeCA8PSByYWRpYWxTZWdtZW50czsgeCArKyApIHsKCgkJCQkJY29uc3QgdSA9IHggLyByYWRpYWxTZWdtZW50czsKCgkJCQkJY29uc3QgdGhldGEgPSB1ICogdGhldGFMZW5ndGggKyB0aGV0YVN0YXJ0OwoKCQkJCQljb25zdCBzaW5UaGV0YSA9IE1hdGguc2luKCB0aGV0YSApOwoJCQkJCWNvbnN0IGNvc1RoZXRhID0gTWF0aC5jb3MoIHRoZXRhICk7CgoJCQkJCS8vIHZlcnRleAoKCQkJCQl2ZXJ0ZXgueCA9IHJhZGl1cyAqIHNpblRoZXRhOwoJCQkJCXZlcnRleC55ID0gLSB2ICogaGVpZ2h0ICsgaGFsZkhlaWdodDsKCQkJCQl2ZXJ0ZXgueiA9IHJhZGl1cyAqIGNvc1RoZXRhOwoJCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCQkJLy8gbm9ybWFsCgoJCQkJCW5vcm1hbC5zZXQoIHNpblRoZXRhLCBzbG9wZSwgY29zVGhldGEgKS5ub3JtYWxpemUoKTsKCQkJCQlub3JtYWxzLnB1c2goIG5vcm1hbC54LCBub3JtYWwueSwgbm9ybWFsLnogKTsKCgkJCQkJLy8gdXYKCgkJCQkJdXZzLnB1c2goIHUsIDEgLSB2ICk7CgoJCQkJCS8vIHNhdmUgaW5kZXggb2YgdmVydGV4IGluIHJlc3BlY3RpdmUgcm93CgoJCQkJCWluZGV4Um93LnB1c2goIGluZGV4ICsrICk7CgoJCQkJfQoKCQkJCS8vIG5vdyBzYXZlIHZlcnRpY2VzIG9mIHRoZSByb3cgaW4gb3VyIGluZGV4IGFycmF5CgoJCQkJaW5kZXhBcnJheS5wdXNoKCBpbmRleFJvdyApOwoKCQkJfQoKCQkJLy8gZ2VuZXJhdGUgaW5kaWNlcwoKCQkJZm9yICggbGV0IHggPSAwOyB4IDwgcmFkaWFsU2VnbWVudHM7IHggKysgKSB7CgoJCQkJZm9yICggbGV0IHkgPSAwOyB5IDwgaGVpZ2h0U2VnbWVudHM7IHkgKysgKSB7CgoJCQkJCS8vIHdlIHVzZSB0aGUgaW5kZXggYXJyYXkgdG8gYWNjZXNzIHRoZSBjb3JyZWN0IGluZGljZXMKCgkJCQkJY29uc3QgYSA9IGluZGV4QXJyYXlbIHkgXVsgeCBdOwoJCQkJCWNvbnN0IGIgPSBpbmRleEFycmF5WyB5ICsgMSBdWyB4IF07CgkJCQkJY29uc3QgYyA9IGluZGV4QXJyYXlbIHkgKyAxIF1bIHggKyAxIF07CgkJCQkJY29uc3QgZCA9IGluZGV4QXJyYXlbIHkgXVsgeCArIDEgXTsKCgkJCQkJLy8gZmFjZXMKCgkJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQkJCS8vIHVwZGF0ZSBncm91cCBjb3VudGVyCgoJCQkJCWdyb3VwQ291bnQgKz0gNjsKCgkJCQl9CgoJCQl9CgoJCQkvLyBhZGQgYSBncm91cCB0byB0aGUgZ2VvbWV0cnkuIHRoaXMgd2lsbCBlbnN1cmUgbXVsdGkgbWF0ZXJpYWwgc3VwcG9ydAoKCQkJc2NvcGUuYWRkR3JvdXAoIGdyb3VwU3RhcnQsIGdyb3VwQ291bnQsIDAgKTsKCgkJCS8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgdmFsdWUgZm9yIGdyb3VwcwoKCQkJZ3JvdXBTdGFydCArPSBncm91cENvdW50OwoKCQl9CgoJCWZ1bmN0aW9uIGdlbmVyYXRlQ2FwKCB0b3AgKSB7CgoJCQkvLyBzYXZlIHRoZSBpbmRleCBvZiB0aGUgZmlyc3QgY2VudGVyIHZlcnRleAoJCQljb25zdCBjZW50ZXJJbmRleFN0YXJ0ID0gaW5kZXg7CgoJCQljb25zdCB1diA9IG5ldyBWZWN0b3IyKCk7CgkJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlsZXQgZ3JvdXBDb3VudCA9IDA7CgoJCQljb25zdCByYWRpdXMgPSAoIHRvcCA9PT0gdHJ1ZSApID8gcmFkaXVzVG9wIDogcmFkaXVzQm90dG9tOwoJCQljb25zdCBzaWduID0gKCB0b3AgPT09IHRydWUgKSA/IDEgOiAtIDE7CgoJCQkvLyBmaXJzdCB3ZSBnZW5lcmF0ZSB0aGUgY2VudGVyIHZlcnRleCBkYXRhIG9mIHRoZSBjYXAuCgkJCS8vIGJlY2F1c2UgdGhlIGdlb21ldHJ5IG5lZWRzIG9uZSBzZXQgb2YgdXZzIHBlciBmYWNlLAoJCQkvLyB3ZSBtdXN0IGdlbmVyYXRlIGEgY2VudGVyIHZlcnRleCBwZXIgZmFjZS9zZWdtZW50CgoJCQlmb3IgKCBsZXQgeCA9IDE7IHggPD0gcmFkaWFsU2VnbWVudHM7IHggKysgKSB7CgoJCQkJLy8gdmVydGV4CgoJCQkJdmVydGljZXMucHVzaCggMCwgaGFsZkhlaWdodCAqIHNpZ24sIDAgKTsKCgkJCQkvLyBub3JtYWwKCgkJCQlub3JtYWxzLnB1c2goIDAsIHNpZ24sIDAgKTsKCgkJCQkvLyB1dgoKCQkJCXV2cy5wdXNoKCAwLjUsIDAuNSApOwoKCQkJCS8vIGluY3JlYXNlIGluZGV4CgoJCQkJaW5kZXggKys7CgoJCQl9CgoJCQkvLyBzYXZlIHRoZSBpbmRleCBvZiB0aGUgbGFzdCBjZW50ZXIgdmVydGV4CgkJCWNvbnN0IGNlbnRlckluZGV4RW5kID0gaW5kZXg7CgoJCQkvLyBub3cgd2UgZ2VuZXJhdGUgdGhlIHN1cnJvdW5kaW5nIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJCWZvciAoIGxldCB4ID0gMDsgeCA8PSByYWRpYWxTZWdtZW50czsgeCArKyApIHsKCgkJCQljb25zdCB1ID0geCAvIHJhZGlhbFNlZ21lbnRzOwoJCQkJY29uc3QgdGhldGEgPSB1ICogdGhldGFMZW5ndGggKyB0aGV0YVN0YXJ0OwoKCQkJCWNvbnN0IGNvc1RoZXRhID0gTWF0aC5jb3MoIHRoZXRhICk7CgkJCQljb25zdCBzaW5UaGV0YSA9IE1hdGguc2luKCB0aGV0YSApOwoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRleC54ID0gcmFkaXVzICogc2luVGhldGE7CgkJCQl2ZXJ0ZXgueSA9IGhhbGZIZWlnaHQgKiBzaWduOwoJCQkJdmVydGV4LnogPSByYWRpdXMgKiBjb3NUaGV0YTsKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCQkvLyBub3JtYWwKCgkJCQlub3JtYWxzLnB1c2goIDAsIHNpZ24sIDAgKTsKCgkJCQkvLyB1dgoKCQkJCXV2LnggPSAoIGNvc1RoZXRhICogMC41ICkgKyAwLjU7CgkJCQl1di55ID0gKCBzaW5UaGV0YSAqIDAuNSAqIHNpZ24gKSArIDAuNTsKCQkJCXV2cy5wdXNoKCB1di54LCB1di55ICk7CgoJCQkJLy8gaW5jcmVhc2UgaW5kZXgKCgkJCQlpbmRleCArKzsKCgkJCX0KCgkJCS8vIGdlbmVyYXRlIGluZGljZXMKCgkJCWZvciAoIGxldCB4ID0gMDsgeCA8IHJhZGlhbFNlZ21lbnRzOyB4ICsrICkgewoKCQkJCWNvbnN0IGMgPSBjZW50ZXJJbmRleFN0YXJ0ICsgeDsKCQkJCWNvbnN0IGkgPSBjZW50ZXJJbmRleEVuZCArIHg7CgoJCQkJaWYgKCB0b3AgPT09IHRydWUgKSB7CgoJCQkJCS8vIGZhY2UgdG9wCgoJCQkJCWluZGljZXMucHVzaCggaSwgaSArIDEsIGMgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBmYWNlIGJvdHRvbQoKCQkJCQlpbmRpY2VzLnB1c2goIGkgKyAxLCBpLCBjICk7CgoJCQkJfQoKCQkJCWdyb3VwQ291bnQgKz0gMzsKCgkJCX0KCgkJCS8vIGFkZCBhIGdyb3VwIHRvIHRoZSBnZW9tZXRyeS4gdGhpcyB3aWxsIGVuc3VyZSBtdWx0aSBtYXRlcmlhbCBzdXBwb3J0CgoJCQlzY29wZS5hZGRHcm91cCggZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgdG9wID09PSB0cnVlID8gMSA6IDIgKTsKCgkJCS8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgdmFsdWUgZm9yIGdyb3VwcwoKCQkJZ3JvdXBTdGFydCArPSBncm91cENvdW50OwoKCQl9CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IEN5bGluZGVyR2VvbWV0cnkoIGRhdGEucmFkaXVzVG9wLCBkYXRhLnJhZGl1c0JvdHRvbSwgZGF0YS5oZWlnaHQsIGRhdGEucmFkaWFsU2VnbWVudHMsIGRhdGEuaGVpZ2h0U2VnbWVudHMsIGRhdGEub3BlbkVuZGVkLCBkYXRhLnRoZXRhU3RhcnQsIGRhdGEudGhldGFMZW5ndGggKTsKCgl9Cgp9CgpjbGFzcyBDb25lR2VvbWV0cnkgZXh0ZW5kcyBDeWxpbmRlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgaGVpZ2h0ID0gMSwgcmFkaWFsU2VnbWVudHMgPSAzMiwgaGVpZ2h0U2VnbWVudHMgPSAxLCBvcGVuRW5kZWQgPSBmYWxzZSwgdGhldGFTdGFydCA9IDAsIHRoZXRhTGVuZ3RoID0gTWF0aC5QSSAqIDIgKSB7CgoJCXN1cGVyKCAwLCByYWRpdXMsIGhlaWdodCwgcmFkaWFsU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCBvcGVuRW5kZWQsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICk7CgoJCXRoaXMudHlwZSA9ICdDb25lR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQloZWlnaHQ6IGhlaWdodCwKCQkJcmFkaWFsU2VnbWVudHM6IHJhZGlhbFNlZ21lbnRzLAoJCQloZWlnaHRTZWdtZW50czogaGVpZ2h0U2VnbWVudHMsCgkJCW9wZW5FbmRlZDogb3BlbkVuZGVkLAoJCQl0aGV0YVN0YXJ0OiB0aGV0YVN0YXJ0LAoJCQl0aGV0YUxlbmd0aDogdGhldGFMZW5ndGgKCQl9OwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgQ29uZUdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS5oZWlnaHQsIGRhdGEucmFkaWFsU2VnbWVudHMsIGRhdGEuaGVpZ2h0U2VnbWVudHMsIGRhdGEub3BlbkVuZGVkLCBkYXRhLnRoZXRhU3RhcnQsIGRhdGEudGhldGFMZW5ndGggKTsKCgl9Cgp9CgpjbGFzcyBQb2x5aGVkcm9uR2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHZlcnRpY2VzID0gW10sIGluZGljZXMgPSBbXSwgcmFkaXVzID0gMSwgZGV0YWlsID0gMCApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ1BvbHloZWRyb25HZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJdmVydGljZXM6IHZlcnRpY2VzLAoJCQlpbmRpY2VzOiBpbmRpY2VzLAoJCQlyYWRpdXM6IHJhZGl1cywKCQkJZGV0YWlsOiBkZXRhaWwKCQl9OwoKCQkvLyBkZWZhdWx0IGJ1ZmZlciBkYXRhCgoJCWNvbnN0IHZlcnRleEJ1ZmZlciA9IFtdOwoJCWNvbnN0IHV2QnVmZmVyID0gW107CgoJCS8vIHRoZSBzdWJkaXZpc2lvbiBjcmVhdGVzIHRoZSB2ZXJ0ZXggYnVmZmVyIGRhdGEKCgkJc3ViZGl2aWRlKCBkZXRhaWwgKTsKCgkJLy8gYWxsIHZlcnRpY2VzIHNob3VsZCBsaWUgb24gYSBjb25jZXB0dWFsIHNwaGVyZSB3aXRoIGEgZ2l2ZW4gcmFkaXVzCgoJCWFwcGx5UmFkaXVzKCByYWRpdXMgKTsKCgkJLy8gZmluYWxseSwgY3JlYXRlIHRoZSB1diBkYXRhCgoJCWdlbmVyYXRlVVZzKCk7CgoJCS8vIGJ1aWxkIG5vbi1pbmRleGVkIGdlb21ldHJ5CgoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGV4QnVmZmVyLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0ZXhCdWZmZXIuc2xpY2UoKSwgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dkJ1ZmZlciwgMiApICk7CgoJCWlmICggZGV0YWlsID09PSAwICkgewoKCQkJdGhpcy5jb21wdXRlVmVydGV4Tm9ybWFscygpOyAvLyBmbGF0IG5vcm1hbHMKCgkJfSBlbHNlIHsKCgkJCXRoaXMubm9ybWFsaXplTm9ybWFscygpOyAvLyBzbW9vdGggbm9ybWFscwoKCQl9CgoJCS8vIGhlbHBlciBmdW5jdGlvbnMKCgkJZnVuY3Rpb24gc3ViZGl2aWRlKCBkZXRhaWwgKSB7CgoJCQljb25zdCBhID0gbmV3IFZlY3RvcjMoKTsKCQkJY29uc3QgYiA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IGMgPSBuZXcgVmVjdG9yMygpOwoKCQkJLy8gaXRlcmF0ZSBvdmVyIGFsbCBmYWNlcyBhbmQgYXBwbHkgYSBzdWJkaXZpc2lvbiB3aXRoIHRoZSBnaXZlbiBkZXRhaWwgdmFsdWUKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGluZGljZXMubGVuZ3RoOyBpICs9IDMgKSB7CgoJCQkJLy8gZ2V0IHRoZSB2ZXJ0aWNlcyBvZiB0aGUgZmFjZQoKCQkJCWdldFZlcnRleEJ5SW5kZXgoIGluZGljZXNbIGkgKyAwIF0sIGEgKTsKCQkJCWdldFZlcnRleEJ5SW5kZXgoIGluZGljZXNbIGkgKyAxIF0sIGIgKTsKCQkJCWdldFZlcnRleEJ5SW5kZXgoIGluZGljZXNbIGkgKyAyIF0sIGMgKTsKCgkJCQkvLyBwZXJmb3JtIHN1YmRpdmlzaW9uCgoJCQkJc3ViZGl2aWRlRmFjZSggYSwgYiwgYywgZGV0YWlsICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc3ViZGl2aWRlRmFjZSggYSwgYiwgYywgZGV0YWlsICkgewoKCQkJY29uc3QgY29scyA9IGRldGFpbCArIDE7CgoJCQkvLyB3ZSB1c2UgdGhpcyBtdWx0aWRpbWVuc2lvbmFsIGFycmF5IGFzIGEgZGF0YSBzdHJ1Y3R1cmUgZm9yIGNyZWF0aW5nIHRoZSBzdWJkaXZpc2lvbgoKCQkJY29uc3QgdiA9IFtdOwoKCQkJLy8gY29uc3RydWN0IGFsbCBvZiB0aGUgdmVydGljZXMgZm9yIHRoaXMgc3ViZGl2aXNpb24KCgkJCWZvciAoIGxldCBpID0gMDsgaSA8PSBjb2xzOyBpICsrICkgewoKCQkJCXZbIGkgXSA9IFtdOwoKCQkJCWNvbnN0IGFqID0gYS5jbG9uZSgpLmxlcnAoIGMsIGkgLyBjb2xzICk7CgkJCQljb25zdCBiaiA9IGIuY2xvbmUoKS5sZXJwKCBjLCBpIC8gY29scyApOwoKCQkJCWNvbnN0IHJvd3MgPSBjb2xzIC0gaTsKCgkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPD0gcm93czsgaiArKyApIHsKCgkJCQkJaWYgKCBqID09PSAwICYmIGkgPT09IGNvbHMgKSB7CgoJCQkJCQl2WyBpIF1bIGogXSA9IGFqOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdlsgaSBdWyBqIF0gPSBhai5jbG9uZSgpLmxlcnAoIGJqLCBqIC8gcm93cyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLy8gY29uc3RydWN0IGFsbCBvZiB0aGUgZmFjZXMKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvbHM7IGkgKysgKSB7CgoJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgMiAqICggY29scyAtIGkgKSAtIDE7IGogKysgKSB7CgoJCQkJCWNvbnN0IGsgPSBNYXRoLmZsb29yKCBqIC8gMiApOwoKCQkJCQlpZiAoIGogJSAyID09PSAwICkgewoKCQkJCQkJcHVzaFZlcnRleCggdlsgaSBdWyBrICsgMSBdICk7CgkJCQkJCXB1c2hWZXJ0ZXgoIHZbIGkgKyAxIF1bIGsgXSApOwoJCQkJCQlwdXNoVmVydGV4KCB2WyBpIF1bIGsgXSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcHVzaFZlcnRleCggdlsgaSBdWyBrICsgMSBdICk7CgkJCQkJCXB1c2hWZXJ0ZXgoIHZbIGkgKyAxIF1bIGsgKyAxIF0gKTsKCQkJCQkJcHVzaFZlcnRleCggdlsgaSArIDEgXVsgayBdICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gYXBwbHlSYWRpdXMoIHJhZGl1cyApIHsKCgkJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgoJCQkvLyBpdGVyYXRlIG92ZXIgdGhlIGVudGlyZSBidWZmZXIgYW5kIGFwcGx5IHRoZSByYWRpdXMgdG8gZWFjaCB2ZXJ0ZXgKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHZlcnRleEJ1ZmZlci5sZW5ndGg7IGkgKz0gMyApIHsKCgkJCQl2ZXJ0ZXgueCA9IHZlcnRleEJ1ZmZlclsgaSArIDAgXTsKCQkJCXZlcnRleC55ID0gdmVydGV4QnVmZmVyWyBpICsgMSBdOwoJCQkJdmVydGV4LnogPSB2ZXJ0ZXhCdWZmZXJbIGkgKyAyIF07CgoJCQkJdmVydGV4Lm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCByYWRpdXMgKTsKCgkJCQl2ZXJ0ZXhCdWZmZXJbIGkgKyAwIF0gPSB2ZXJ0ZXgueDsKCQkJCXZlcnRleEJ1ZmZlclsgaSArIDEgXSA9IHZlcnRleC55OwoJCQkJdmVydGV4QnVmZmVyWyBpICsgMiBdID0gdmVydGV4Lno7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZ2VuZXJhdGVVVnMoKSB7CgoJCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdmVydGV4QnVmZmVyLmxlbmd0aDsgaSArPSAzICkgewoKCQkJCXZlcnRleC54ID0gdmVydGV4QnVmZmVyWyBpICsgMCBdOwoJCQkJdmVydGV4LnkgPSB2ZXJ0ZXhCdWZmZXJbIGkgKyAxIF07CgkJCQl2ZXJ0ZXgueiA9IHZlcnRleEJ1ZmZlclsgaSArIDIgXTsKCgkJCQljb25zdCB1ID0gYXppbXV0aCggdmVydGV4ICkgLyAyIC8gTWF0aC5QSSArIDAuNTsKCQkJCWNvbnN0IHYgPSBpbmNsaW5hdGlvbiggdmVydGV4ICkgLyBNYXRoLlBJICsgMC41OwoJCQkJdXZCdWZmZXIucHVzaCggdSwgMSAtIHYgKTsKCgkJCX0KCgkJCWNvcnJlY3RVVnMoKTsKCgkJCWNvcnJlY3RTZWFtKCk7CgoJCX0KCgkJZnVuY3Rpb24gY29ycmVjdFNlYW0oKSB7CgoJCQkvLyBoYW5kbGUgY2FzZSB3aGVuIGZhY2Ugc3RyYWRkbGVzIHRoZSBzZWFtLCBzZWUgIzMyNjkKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHV2QnVmZmVyLmxlbmd0aDsgaSArPSA2ICkgewoKCQkJCS8vIHV2IGRhdGEgb2YgYSBzaW5nbGUgZmFjZQoKCQkJCWNvbnN0IHgwID0gdXZCdWZmZXJbIGkgKyAwIF07CgkJCQljb25zdCB4MSA9IHV2QnVmZmVyWyBpICsgMiBdOwoJCQkJY29uc3QgeDIgPSB1dkJ1ZmZlclsgaSArIDQgXTsKCgkJCQljb25zdCBtYXggPSBNYXRoLm1heCggeDAsIHgxLCB4MiApOwoJCQkJY29uc3QgbWluID0gTWF0aC5taW4oIHgwLCB4MSwgeDIgKTsKCgkJCQkvLyAwLjkgaXMgc29tZXdoYXQgYXJiaXRyYXJ5CgoJCQkJaWYgKCBtYXggPiAwLjkgJiYgbWluIDwgMC4xICkgewoKCQkJCQlpZiAoIHgwIDwgMC4yICkgdXZCdWZmZXJbIGkgKyAwIF0gKz0gMTsKCQkJCQlpZiAoIHgxIDwgMC4yICkgdXZCdWZmZXJbIGkgKyAyIF0gKz0gMTsKCQkJCQlpZiAoIHgyIDwgMC4yICkgdXZCdWZmZXJbIGkgKyA0IF0gKz0gMTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcHVzaFZlcnRleCggdmVydGV4ICkgewoKCQkJdmVydGV4QnVmZmVyLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRWZXJ0ZXhCeUluZGV4KCBpbmRleCwgdmVydGV4ICkgewoKCQkJY29uc3Qgc3RyaWRlID0gaW5kZXggKiAzOwoKCQkJdmVydGV4LnggPSB2ZXJ0aWNlc1sgc3RyaWRlICsgMCBdOwoJCQl2ZXJ0ZXgueSA9IHZlcnRpY2VzWyBzdHJpZGUgKyAxIF07CgkJCXZlcnRleC56ID0gdmVydGljZXNbIHN0cmlkZSArIDIgXTsKCgkJfQoKCQlmdW5jdGlvbiBjb3JyZWN0VVZzKCkgewoKCQkJY29uc3QgYSA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IGIgPSBuZXcgVmVjdG9yMygpOwoJCQljb25zdCBjID0gbmV3IFZlY3RvcjMoKTsKCgkJCWNvbnN0IGNlbnRyb2lkID0gbmV3IFZlY3RvcjMoKTsKCgkJCWNvbnN0IHV2QSA9IG5ldyBWZWN0b3IyKCk7CgkJCWNvbnN0IHV2QiA9IG5ldyBWZWN0b3IyKCk7CgkJCWNvbnN0IHV2QyA9IG5ldyBWZWN0b3IyKCk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGogPSAwOyBpIDwgdmVydGV4QnVmZmVyLmxlbmd0aDsgaSArPSA5LCBqICs9IDYgKSB7CgoJCQkJYS5zZXQoIHZlcnRleEJ1ZmZlclsgaSArIDAgXSwgdmVydGV4QnVmZmVyWyBpICsgMSBdLCB2ZXJ0ZXhCdWZmZXJbIGkgKyAyIF0gKTsKCQkJCWIuc2V0KCB2ZXJ0ZXhCdWZmZXJbIGkgKyAzIF0sIHZlcnRleEJ1ZmZlclsgaSArIDQgXSwgdmVydGV4QnVmZmVyWyBpICsgNSBdICk7CgkJCQljLnNldCggdmVydGV4QnVmZmVyWyBpICsgNiBdLCB2ZXJ0ZXhCdWZmZXJbIGkgKyA3IF0sIHZlcnRleEJ1ZmZlclsgaSArIDggXSApOwoKCQkJCXV2QS5zZXQoIHV2QnVmZmVyWyBqICsgMCBdLCB1dkJ1ZmZlclsgaiArIDEgXSApOwoJCQkJdXZCLnNldCggdXZCdWZmZXJbIGogKyAyIF0sIHV2QnVmZmVyWyBqICsgMyBdICk7CgkJCQl1dkMuc2V0KCB1dkJ1ZmZlclsgaiArIDQgXSwgdXZCdWZmZXJbIGogKyA1IF0gKTsKCgkJCQljZW50cm9pZC5jb3B5KCBhICkuYWRkKCBiICkuYWRkKCBjICkuZGl2aWRlU2NhbGFyKCAzICk7CgoJCQkJY29uc3QgYXppID0gYXppbXV0aCggY2VudHJvaWQgKTsKCgkJCQljb3JyZWN0VVYoIHV2QSwgaiArIDAsIGEsIGF6aSApOwoJCQkJY29ycmVjdFVWKCB1dkIsIGogKyAyLCBiLCBhemkgKTsKCQkJCWNvcnJlY3RVViggdXZDLCBqICsgNCwgYywgYXppICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gY29ycmVjdFVWKCB1diwgc3RyaWRlLCB2ZWN0b3IsIGF6aW11dGggKSB7CgoJCQlpZiAoICggYXppbXV0aCA8IDAgKSAmJiAoIHV2LnggPT09IDEgKSApIHsKCgkJCQl1dkJ1ZmZlclsgc3RyaWRlIF0gPSB1di54IC0gMTsKCgkJCX0KCgkJCWlmICggKCB2ZWN0b3IueCA9PT0gMCApICYmICggdmVjdG9yLnogPT09IDAgKSApIHsKCgkJCQl1dkJ1ZmZlclsgc3RyaWRlIF0gPSBhemltdXRoIC8gMiAvIE1hdGguUEkgKyAwLjU7CgoJCQl9CgoJCX0KCgkJLy8gQW5nbGUgYXJvdW5kIHRoZSBZIGF4aXMsIGNvdW50ZXItY2xvY2t3aXNlIHdoZW4gbG9va2luZyBmcm9tIGFib3ZlLgoKCQlmdW5jdGlvbiBhemltdXRoKCB2ZWN0b3IgKSB7CgoJCQlyZXR1cm4gTWF0aC5hdGFuMiggdmVjdG9yLnosIC0gdmVjdG9yLnggKTsKCgkJfQoKCgkJLy8gQW5nbGUgYWJvdmUgdGhlIFhaIHBsYW5lLgoKCQlmdW5jdGlvbiBpbmNsaW5hdGlvbiggdmVjdG9yICkgewoKCQkJcmV0dXJuIE1hdGguYXRhbjIoIC0gdmVjdG9yLnksIE1hdGguc3FydCggKCB2ZWN0b3IueCAqIHZlY3Rvci54ICkgKyAoIHZlY3Rvci56ICogdmVjdG9yLnogKSApICk7CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgUG9seWhlZHJvbkdlb21ldHJ5KCBkYXRhLnZlcnRpY2VzLCBkYXRhLmluZGljZXMsIGRhdGEucmFkaXVzLCBkYXRhLmRldGFpbHMgKTsKCgl9Cgp9CgpjbGFzcyBEb2RlY2FoZWRyb25HZW9tZXRyeSBleHRlbmRzIFBvbHloZWRyb25HZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIGRldGFpbCA9IDAgKSB7CgoJCWNvbnN0IHQgPSAoIDEgKyBNYXRoLnNxcnQoIDUgKSApIC8gMjsKCQljb25zdCByID0gMSAvIHQ7CgoJCWNvbnN0IHZlcnRpY2VzID0gWwoKCQkJLy8gKMKxMSwgwrExLCDCsTEpCgkJCS0gMSwgLSAxLCAtIDEsCS0gMSwgLSAxLCAxLAoJCQktIDEsIDEsIC0gMSwgLSAxLCAxLCAxLAoJCQkxLCAtIDEsIC0gMSwgMSwgLSAxLCAxLAoJCQkxLCAxLCAtIDEsIDEsIDEsIDEsCgoJCQkvLyAoMCwgwrExL8+GLCDCsc+GKQoJCQkwLCAtIHIsIC0gdCwgMCwgLSByLCB0LAoJCQkwLCByLCAtIHQsIDAsIHIsIHQsCgoJCQkvLyAowrExL8+GLCDCsc+GLCAwKQoJCQktIHIsIC0gdCwgMCwgLSByLCB0LCAwLAoJCQlyLCAtIHQsIDAsIHIsIHQsIDAsCgoJCQkvLyAowrHPhiwgMCwgwrExL8+GKQoJCQktIHQsIDAsIC0gciwgdCwgMCwgLSByLAoJCQktIHQsIDAsIHIsIHQsIDAsIHIKCQldOwoKCQljb25zdCBpbmRpY2VzID0gWwoJCQkzLCAxMSwgNywgCTMsIDcsIDE1LCAJMywgMTUsIDEzLAoJCQk3LCAxOSwgMTcsIAk3LCAxNywgNiwgCTcsIDYsIDE1LAoJCQkxNywgNCwgOCwgCTE3LCA4LCAxMCwgCTE3LCAxMCwgNiwKCQkJOCwgMCwgMTYsIAk4LCAxNiwgMiwgCTgsIDIsIDEwLAoJCQkwLCAxMiwgMSwgCTAsIDEsIDE4LCAJMCwgMTgsIDE2LAoJCQk2LCAxMCwgMiwgCTYsIDIsIDEzLCAJNiwgMTMsIDE1LAoJCQkyLCAxNiwgMTgsIAkyLCAxOCwgMywgCTIsIDMsIDEzLAoJCQkxOCwgMSwgOSwgCTE4LCA5LCAxMSwgCTE4LCAxMSwgMywKCQkJNCwgMTQsIDEyLCAJNCwgMTIsIDAsIAk0LCAwLCA4LAoJCQkxMSwgOSwgNSwgCTExLCA1LCAxOSwgCTExLCAxOSwgNywKCQkJMTksIDUsIDE0LCAJMTksIDE0LCA0LCAJMTksIDQsIDE3LAoJCQkxLCAxMiwgMTQsIAkxLCAxNCwgNSwgCTEsIDUsIDkKCQldOwoKCQlzdXBlciggdmVydGljZXMsIGluZGljZXMsIHJhZGl1cywgZGV0YWlsICk7CgoJCXRoaXMudHlwZSA9ICdEb2RlY2FoZWRyb25HZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCWRldGFpbDogZGV0YWlsCgkJfTsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IERvZGVjYWhlZHJvbkdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS5kZXRhaWwgKTsKCgl9Cgp9Cgpjb25zdCBfdjAgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92MSQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfbm9ybWFsID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdHJpYW5nbGUgPSAvKkBfX1BVUkVfXyovIG5ldyBUcmlhbmdsZSgpOwoKY2xhc3MgRWRnZXNHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggZ2VvbWV0cnkgPSBudWxsLCB0aHJlc2hvbGRBbmdsZSA9IDEgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdFZGdlc0dlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlnZW9tZXRyeTogZ2VvbWV0cnksCgkJCXRocmVzaG9sZEFuZ2xlOiB0aHJlc2hvbGRBbmdsZQoJCX07CgoJCWlmICggZ2VvbWV0cnkgIT09IG51bGwgKSB7CgoJCQljb25zdCBwcmVjaXNpb25Qb2ludHMgPSA0OwoJCQljb25zdCBwcmVjaXNpb24gPSBNYXRoLnBvdyggMTAsIHByZWNpc2lvblBvaW50cyApOwoJCQljb25zdCB0aHJlc2hvbGREb3QgPSBNYXRoLmNvcyggREVHMlJBRCAqIHRocmVzaG9sZEFuZ2xlICk7CgoJCQljb25zdCBpbmRleEF0dHIgPSBnZW9tZXRyeS5nZXRJbmRleCgpOwoJCQljb25zdCBwb3NpdGlvbkF0dHIgPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCQkJY29uc3QgaW5kZXhDb3VudCA9IGluZGV4QXR0ciA/IGluZGV4QXR0ci5jb3VudCA6IHBvc2l0aW9uQXR0ci5jb3VudDsKCgkJCWNvbnN0IGluZGV4QXJyID0gWyAwLCAwLCAwIF07CgkJCWNvbnN0IHZlcnRLZXlzID0gWyAnYScsICdiJywgJ2MnIF07CgkJCWNvbnN0IGhhc2hlcyA9IG5ldyBBcnJheSggMyApOwoKCQkJY29uc3QgZWRnZURhdGEgPSB7fTsKCQkJY29uc3QgdmVydGljZXMgPSBbXTsKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgaW5kZXhDb3VudDsgaSArPSAzICkgewoKCQkJCWlmICggaW5kZXhBdHRyICkgewoKCQkJCQlpbmRleEFyclsgMCBdID0gaW5kZXhBdHRyLmdldFgoIGkgKTsKCQkJCQlpbmRleEFyclsgMSBdID0gaW5kZXhBdHRyLmdldFgoIGkgKyAxICk7CgkJCQkJaW5kZXhBcnJbIDIgXSA9IGluZGV4QXR0ci5nZXRYKCBpICsgMiApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWluZGV4QXJyWyAwIF0gPSBpOwoJCQkJCWluZGV4QXJyWyAxIF0gPSBpICsgMTsKCQkJCQlpbmRleEFyclsgMiBdID0gaSArIDI7CgoJCQkJfQoKCQkJCWNvbnN0IHsgYSwgYiwgYyB9ID0gX3RyaWFuZ2xlOwoJCQkJYS5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHIsIGluZGV4QXJyWyAwIF0gKTsKCQkJCWIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyLCBpbmRleEFyclsgMSBdICk7CgkJCQljLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0ciwgaW5kZXhBcnJbIDIgXSApOwoJCQkJX3RyaWFuZ2xlLmdldE5vcm1hbCggX25vcm1hbCApOwoKCQkJCS8vIGNyZWF0ZSBoYXNoZXMgZm9yIHRoZSBlZGdlIGZyb20gdGhlIHZlcnRpY2VzCgkJCQloYXNoZXNbIDAgXSA9IGAkeyBNYXRoLnJvdW5kKCBhLnggKiBwcmVjaXNpb24gKSB9LCR7IE1hdGgucm91bmQoIGEueSAqIHByZWNpc2lvbiApIH0sJHsgTWF0aC5yb3VuZCggYS56ICogcHJlY2lzaW9uICkgfWA7CgkJCQloYXNoZXNbIDEgXSA9IGAkeyBNYXRoLnJvdW5kKCBiLnggKiBwcmVjaXNpb24gKSB9LCR7IE1hdGgucm91bmQoIGIueSAqIHByZWNpc2lvbiApIH0sJHsgTWF0aC5yb3VuZCggYi56ICogcHJlY2lzaW9uICkgfWA7CgkJCQloYXNoZXNbIDIgXSA9IGAkeyBNYXRoLnJvdW5kKCBjLnggKiBwcmVjaXNpb24gKSB9LCR7IE1hdGgucm91bmQoIGMueSAqIHByZWNpc2lvbiApIH0sJHsgTWF0aC5yb3VuZCggYy56ICogcHJlY2lzaW9uICkgfWA7CgoJCQkJLy8gc2tpcCBkZWdlbmVyYXRlIHRyaWFuZ2xlcwoJCQkJaWYgKCBoYXNoZXNbIDAgXSA9PT0gaGFzaGVzWyAxIF0gfHwgaGFzaGVzWyAxIF0gPT09IGhhc2hlc1sgMiBdIHx8IGhhc2hlc1sgMiBdID09PSBoYXNoZXNbIDAgXSApIHsKCgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCS8vIGl0ZXJhdGUgb3ZlciBldmVyeSBlZGdlCgkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCAzOyBqICsrICkgewoKCQkJCQkvLyBnZXQgdGhlIGZpcnN0IGFuZCBuZXh0IHZlcnRleCBtYWtpbmcgdXAgdGhlIGVkZ2UKCQkJCQljb25zdCBqTmV4dCA9ICggaiArIDEgKSAlIDM7CgkJCQkJY29uc3QgdmVjSGFzaDAgPSBoYXNoZXNbIGogXTsKCQkJCQljb25zdCB2ZWNIYXNoMSA9IGhhc2hlc1sgak5leHQgXTsKCQkJCQljb25zdCB2MCA9IF90cmlhbmdsZVsgdmVydEtleXNbIGogXSBdOwoJCQkJCWNvbnN0IHYxID0gX3RyaWFuZ2xlWyB2ZXJ0S2V5c1sgak5leHQgXSBdOwoKCQkJCQljb25zdCBoYXNoID0gYCR7IHZlY0hhc2gwIH1fJHsgdmVjSGFzaDEgfWA7CgkJCQkJY29uc3QgcmV2ZXJzZUhhc2ggPSBgJHsgdmVjSGFzaDEgfV8keyB2ZWNIYXNoMCB9YDsKCgkJCQkJaWYgKCByZXZlcnNlSGFzaCBpbiBlZGdlRGF0YSAmJiBlZGdlRGF0YVsgcmV2ZXJzZUhhc2ggXSApIHsKCgkJCQkJCS8vIGlmIHdlIGZvdW5kIGEgc2libGluZyBlZGdlIGFkZCBpdCBpbnRvIHRoZSB2ZXJ0ZXggYXJyYXkgaWYKCQkJCQkJLy8gaXQgbWVldHMgdGhlIGFuZ2xlIHRocmVzaG9sZCBhbmQgZGVsZXRlIHRoZSBlZGdlIGZyb20gdGhlIG1hcC4KCQkJCQkJaWYgKCBfbm9ybWFsLmRvdCggZWRnZURhdGFbIHJldmVyc2VIYXNoIF0ubm9ybWFsICkgPD0gdGhyZXNob2xkRG90ICkgewoKCQkJCQkJCXZlcnRpY2VzLnB1c2goIHYwLngsIHYwLnksIHYwLnogKTsKCQkJCQkJCXZlcnRpY2VzLnB1c2goIHYxLngsIHYxLnksIHYxLnogKTsKCgkJCQkJCX0KCgkJCQkJCWVkZ2VEYXRhWyByZXZlcnNlSGFzaCBdID0gbnVsbDsKCgkJCQkJfSBlbHNlIGlmICggISAoIGhhc2ggaW4gZWRnZURhdGEgKSApIHsKCgkJCQkJCS8vIGlmIHdlJ3ZlIGFscmVhZHkgZ290IGFuIGVkZ2UgaGVyZSB0aGVuIHNraXAgYWRkaW5nIGEgbmV3IG9uZQoJCQkJCQllZGdlRGF0YVsgaGFzaCBdID0gewoKCQkJCQkJCWluZGV4MDogaW5kZXhBcnJbIGogXSwKCQkJCQkJCWluZGV4MTogaW5kZXhBcnJbIGpOZXh0IF0sCgkJCQkJCQlub3JtYWw6IF9ub3JtYWwuY2xvbmUoKSwKCgkJCQkJCX07CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQkvLyBpdGVyYXRlIG92ZXIgYWxsIHJlbWFpbmluZywgdW5tYXRjaGVkIGVkZ2VzIGFuZCBhZGQgdGhlbSB0byB0aGUgdmVydGV4IGFycmF5CgkJCWZvciAoIGNvbnN0IGtleSBpbiBlZGdlRGF0YSApIHsKCgkJCQlpZiAoIGVkZ2VEYXRhWyBrZXkgXSApIHsKCgkJCQkJY29uc3QgeyBpbmRleDAsIGluZGV4MSB9ID0gZWRnZURhdGFbIGtleSBdOwoJCQkJCV92MC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHIsIGluZGV4MCApOwoJCQkJCV92MSQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0ciwgaW5kZXgxICk7CgoJCQkJCXZlcnRpY2VzLnB1c2goIF92MC54LCBfdjAueSwgX3YwLnogKTsKCQkJCQl2ZXJ0aWNlcy5wdXNoKCBfdjEkMS54LCBfdjEkMS55LCBfdjEkMS56ICk7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFNoYXBlIGV4dGVuZHMgUGF0aCB7CgoJY29uc3RydWN0b3IoIHBvaW50cyApIHsKCgkJc3VwZXIoIHBvaW50cyApOwoKCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJdGhpcy50eXBlID0gJ1NoYXBlJzsKCgkJdGhpcy5ob2xlcyA9IFtdOwoKCX0KCglnZXRQb2ludHNIb2xlcyggZGl2aXNpb25zICkgewoKCQljb25zdCBob2xlc1B0cyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQlob2xlc1B0c1sgaSBdID0gdGhpcy5ob2xlc1sgaSBdLmdldFBvaW50cyggZGl2aXNpb25zICk7CgoJCX0KCgkJcmV0dXJuIGhvbGVzUHRzOwoKCX0KCgkvLyBnZXQgcG9pbnRzIG9mIHNoYXBlIGFuZCBob2xlcyAoa2V5cG9pbnRzIGJhc2VkIG9uIHNlZ21lbnRzIHBhcmFtZXRlcikKCglleHRyYWN0UG9pbnRzKCBkaXZpc2lvbnMgKSB7CgoJCXJldHVybiB7CgoJCQlzaGFwZTogdGhpcy5nZXRQb2ludHMoIGRpdmlzaW9ucyApLAoJCQlob2xlczogdGhpcy5nZXRQb2ludHNIb2xlcyggZGl2aXNpb25zICkKCgkJfTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5ob2xlcyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBzb3VyY2UuaG9sZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGhvbGUgPSBzb3VyY2UuaG9sZXNbIGkgXTsKCgkJCXRoaXMuaG9sZXMucHVzaCggaG9sZS5jbG9uZSgpICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CgkJZGF0YS5ob2xlcyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBob2xlID0gdGhpcy5ob2xlc1sgaSBdOwoJCQlkYXRhLmhvbGVzLnB1c2goIGhvbGUudG9KU09OKCkgKTsKCgkJfQoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXN1cGVyLmZyb21KU09OKCBqc29uICk7CgoJCXRoaXMudXVpZCA9IGpzb24udXVpZDsKCQl0aGlzLmhvbGVzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24uaG9sZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGhvbGUgPSBqc29uLmhvbGVzWyBpIF07CgkJCXRoaXMuaG9sZXMucHVzaCggbmV3IFBhdGgoKS5mcm9tSlNPTiggaG9sZSApICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKLyoqCiAqIFBvcnQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vbWFwYm94L2VhcmN1dCAodjIuMi40KQogKi8KCmNvbnN0IEVhcmN1dCA9IHsKCgl0cmlhbmd1bGF0ZTogZnVuY3Rpb24gKCBkYXRhLCBob2xlSW5kaWNlcywgZGltID0gMiApIHsKCgkJY29uc3QgaGFzSG9sZXMgPSBob2xlSW5kaWNlcyAmJiBob2xlSW5kaWNlcy5sZW5ndGg7CgkJY29uc3Qgb3V0ZXJMZW4gPSBoYXNIb2xlcyA/IGhvbGVJbmRpY2VzWyAwIF0gKiBkaW0gOiBkYXRhLmxlbmd0aDsKCQlsZXQgb3V0ZXJOb2RlID0gbGlua2VkTGlzdCggZGF0YSwgMCwgb3V0ZXJMZW4sIGRpbSwgdHJ1ZSApOwoJCWNvbnN0IHRyaWFuZ2xlcyA9IFtdOwoKCQlpZiAoICEgb3V0ZXJOb2RlIHx8IG91dGVyTm9kZS5uZXh0ID09PSBvdXRlck5vZGUucHJldiApIHJldHVybiB0cmlhbmdsZXM7CgoJCWxldCBtaW5YLCBtaW5ZLCBtYXhYLCBtYXhZLCB4LCB5LCBpbnZTaXplOwoKCQlpZiAoIGhhc0hvbGVzICkgb3V0ZXJOb2RlID0gZWxpbWluYXRlSG9sZXMoIGRhdGEsIGhvbGVJbmRpY2VzLCBvdXRlck5vZGUsIGRpbSApOwoKCQkvLyBpZiB0aGUgc2hhcGUgaXMgbm90IHRvbyBzaW1wbGUsIHdlJ2xsIHVzZSB6LW9yZGVyIGN1cnZlIGhhc2ggbGF0ZXI7IGNhbGN1bGF0ZSBwb2x5Z29uIGJib3gKCQlpZiAoIGRhdGEubGVuZ3RoID4gODAgKiBkaW0gKSB7CgoJCQltaW5YID0gbWF4WCA9IGRhdGFbIDAgXTsKCQkJbWluWSA9IG1heFkgPSBkYXRhWyAxIF07CgoJCQlmb3IgKCBsZXQgaSA9IGRpbTsgaSA8IG91dGVyTGVuOyBpICs9IGRpbSApIHsKCgkJCQl4ID0gZGF0YVsgaSBdOwoJCQkJeSA9IGRhdGFbIGkgKyAxIF07CgkJCQlpZiAoIHggPCBtaW5YICkgbWluWCA9IHg7CgkJCQlpZiAoIHkgPCBtaW5ZICkgbWluWSA9IHk7CgkJCQlpZiAoIHggPiBtYXhYICkgbWF4WCA9IHg7CgkJCQlpZiAoIHkgPiBtYXhZICkgbWF4WSA9IHk7CgoJCQl9CgoJCQkvLyBtaW5YLCBtaW5ZIGFuZCBpbnZTaXplIGFyZSBsYXRlciB1c2VkIHRvIHRyYW5zZm9ybSBjb29yZHMgaW50byBpbnRlZ2VycyBmb3Igei1vcmRlciBjYWxjdWxhdGlvbgoJCQlpbnZTaXplID0gTWF0aC5tYXgoIG1heFggLSBtaW5YLCBtYXhZIC0gbWluWSApOwoJCQlpbnZTaXplID0gaW52U2l6ZSAhPT0gMCA/IDMyNzY3IC8gaW52U2l6ZSA6IDA7CgoJCX0KCgkJZWFyY3V0TGlua2VkKCBvdXRlck5vZGUsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplLCAwICk7CgoJCXJldHVybiB0cmlhbmdsZXM7CgoJfQoKfTsKCi8vIGNyZWF0ZSBhIGNpcmN1bGFyIGRvdWJseSBsaW5rZWQgbGlzdCBmcm9tIHBvbHlnb24gcG9pbnRzIGluIHRoZSBzcGVjaWZpZWQgd2luZGluZyBvcmRlcgpmdW5jdGlvbiBsaW5rZWRMaXN0KCBkYXRhLCBzdGFydCwgZW5kLCBkaW0sIGNsb2Nrd2lzZSApIHsKCglsZXQgaSwgbGFzdDsKCglpZiAoIGNsb2Nrd2lzZSA9PT0gKCBzaWduZWRBcmVhKCBkYXRhLCBzdGFydCwgZW5kLCBkaW0gKSA+IDAgKSApIHsKCgkJZm9yICggaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IGRpbSApIGxhc3QgPSBpbnNlcnROb2RlKCBpLCBkYXRhWyBpIF0sIGRhdGFbIGkgKyAxIF0sIGxhc3QgKTsKCgl9IGVsc2UgewoKCQlmb3IgKCBpID0gZW5kIC0gZGltOyBpID49IHN0YXJ0OyBpIC09IGRpbSApIGxhc3QgPSBpbnNlcnROb2RlKCBpLCBkYXRhWyBpIF0sIGRhdGFbIGkgKyAxIF0sIGxhc3QgKTsKCgl9CgoJaWYgKCBsYXN0ICYmIGVxdWFscyggbGFzdCwgbGFzdC5uZXh0ICkgKSB7CgoJCXJlbW92ZU5vZGUoIGxhc3QgKTsKCQlsYXN0ID0gbGFzdC5uZXh0OwoKCX0KCglyZXR1cm4gbGFzdDsKCn0KCi8vIGVsaW1pbmF0ZSBjb2xpbmVhciBvciBkdXBsaWNhdGUgcG9pbnRzCmZ1bmN0aW9uIGZpbHRlclBvaW50cyggc3RhcnQsIGVuZCApIHsKCglpZiAoICEgc3RhcnQgKSByZXR1cm4gc3RhcnQ7CglpZiAoICEgZW5kICkgZW5kID0gc3RhcnQ7CgoJbGV0IHAgPSBzdGFydCwKCQlhZ2FpbjsKCWRvIHsKCgkJYWdhaW4gPSBmYWxzZTsKCgkJaWYgKCAhIHAuc3RlaW5lciAmJiAoIGVxdWFscyggcCwgcC5uZXh0ICkgfHwgYXJlYSggcC5wcmV2LCBwLCBwLm5leHQgKSA9PT0gMCApICkgewoKCQkJcmVtb3ZlTm9kZSggcCApOwoJCQlwID0gZW5kID0gcC5wcmV2OwoJCQlpZiAoIHAgPT09IHAubmV4dCApIGJyZWFrOwoJCQlhZ2FpbiA9IHRydWU7CgoJCX0gZWxzZSB7CgoJCQlwID0gcC5uZXh0OwoKCQl9CgoJfSB3aGlsZSAoIGFnYWluIHx8IHAgIT09IGVuZCApOwoKCXJldHVybiBlbmQ7Cgp9CgovLyBtYWluIGVhciBzbGljaW5nIGxvb3Agd2hpY2ggdHJpYW5ndWxhdGVzIGEgcG9seWdvbiAoZ2l2ZW4gYXMgYSBsaW5rZWQgbGlzdCkKZnVuY3Rpb24gZWFyY3V0TGlua2VkKCBlYXIsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplLCBwYXNzICkgewoKCWlmICggISBlYXIgKSByZXR1cm47CgoJLy8gaW50ZXJsaW5rIHBvbHlnb24gbm9kZXMgaW4gei1vcmRlcgoJaWYgKCAhIHBhc3MgJiYgaW52U2l6ZSApIGluZGV4Q3VydmUoIGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSApOwoKCWxldCBzdG9wID0gZWFyLAoJCXByZXYsIG5leHQ7CgoJLy8gaXRlcmF0ZSB0aHJvdWdoIGVhcnMsIHNsaWNpbmcgdGhlbSBvbmUgYnkgb25lCgl3aGlsZSAoIGVhci5wcmV2ICE9PSBlYXIubmV4dCApIHsKCgkJcHJldiA9IGVhci5wcmV2OwoJCW5leHQgPSBlYXIubmV4dDsKCgkJaWYgKCBpbnZTaXplID8gaXNFYXJIYXNoZWQoIGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSApIDogaXNFYXIoIGVhciApICkgewoKCQkJLy8gY3V0IG9mZiB0aGUgdHJpYW5nbGUKCQkJdHJpYW5nbGVzLnB1c2goIHByZXYuaSAvIGRpbSB8IDAgKTsKCQkJdHJpYW5nbGVzLnB1c2goIGVhci5pIC8gZGltIHwgMCApOwoJCQl0cmlhbmdsZXMucHVzaCggbmV4dC5pIC8gZGltIHwgMCApOwoKCQkJcmVtb3ZlTm9kZSggZWFyICk7CgoJCQkvLyBza2lwcGluZyB0aGUgbmV4dCB2ZXJ0ZXggbGVhZHMgdG8gbGVzcyBzbGl2ZXIgdHJpYW5nbGVzCgkJCWVhciA9IG5leHQubmV4dDsKCQkJc3RvcCA9IG5leHQubmV4dDsKCgkJCWNvbnRpbnVlOwoKCQl9CgoJCWVhciA9IG5leHQ7CgoJCS8vIGlmIHdlIGxvb3BlZCB0aHJvdWdoIHRoZSB3aG9sZSByZW1haW5pbmcgcG9seWdvbiBhbmQgY2FuJ3QgZmluZCBhbnkgbW9yZSBlYXJzCgkJaWYgKCBlYXIgPT09IHN0b3AgKSB7CgoJCQkvLyB0cnkgZmlsdGVyaW5nIHBvaW50cyBhbmQgc2xpY2luZyBhZ2FpbgoJCQlpZiAoICEgcGFzcyApIHsKCgkJCQllYXJjdXRMaW5rZWQoIGZpbHRlclBvaW50cyggZWFyICksIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplLCAxICk7CgoJCQkJLy8gaWYgdGhpcyBkaWRuJ3Qgd29yaywgdHJ5IGN1cmluZyBhbGwgc21hbGwgc2VsZi1pbnRlcnNlY3Rpb25zIGxvY2FsbHkKCgkJCX0gZWxzZSBpZiAoIHBhc3MgPT09IDEgKSB7CgoJCQkJZWFyID0gY3VyZUxvY2FsSW50ZXJzZWN0aW9ucyggZmlsdGVyUG9pbnRzKCBlYXIgKSwgdHJpYW5nbGVzLCBkaW0gKTsKCQkJCWVhcmN1dExpbmtlZCggZWFyLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMiApOwoKCQkJCS8vIGFzIGEgbGFzdCByZXNvcnQsIHRyeSBzcGxpdHRpbmcgdGhlIHJlbWFpbmluZyBwb2x5Z29uIGludG8gdHdvCgoJCQl9IGVsc2UgaWYgKCBwYXNzID09PSAyICkgewoKCQkJCXNwbGl0RWFyY3V0KCBlYXIsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplICk7CgoJCQl9CgoJCQlicmVhazsKCgkJfQoKCX0KCn0KCi8vIGNoZWNrIHdoZXRoZXIgYSBwb2x5Z29uIG5vZGUgZm9ybXMgYSB2YWxpZCBlYXIgd2l0aCBhZGphY2VudCBub2RlcwpmdW5jdGlvbiBpc0VhciggZWFyICkgewoKCWNvbnN0IGEgPSBlYXIucHJldiwKCQliID0gZWFyLAoJCWMgPSBlYXIubmV4dDsKCglpZiAoIGFyZWEoIGEsIGIsIGMgKSA+PSAwICkgcmV0dXJuIGZhbHNlOyAvLyByZWZsZXgsIGNhbid0IGJlIGFuIGVhcgoKCS8vIG5vdyBtYWtlIHN1cmUgd2UgZG9uJ3QgaGF2ZSBvdGhlciBwb2ludHMgaW5zaWRlIHRoZSBwb3RlbnRpYWwgZWFyCgljb25zdCBheCA9IGEueCwgYnggPSBiLngsIGN4ID0gYy54LCBheSA9IGEueSwgYnkgPSBiLnksIGN5ID0gYy55OwoKCS8vIHRyaWFuZ2xlIGJib3g7IG1pbiAmIG1heCBhcmUgY2FsY3VsYXRlZCBsaWtlIHRoaXMgZm9yIHNwZWVkCgljb25zdCB4MCA9IGF4IDwgYnggPyAoIGF4IDwgY3ggPyBheCA6IGN4ICkgOiAoIGJ4IDwgY3ggPyBieCA6IGN4ICksCgkJeTAgPSBheSA8IGJ5ID8gKCBheSA8IGN5ID8gYXkgOiBjeSApIDogKCBieSA8IGN5ID8gYnkgOiBjeSApLAoJCXgxID0gYXggPiBieCA/ICggYXggPiBjeCA/IGF4IDogY3ggKSA6ICggYnggPiBjeCA/IGJ4IDogY3ggKSwKCQl5MSA9IGF5ID4gYnkgPyAoIGF5ID4gY3kgPyBheSA6IGN5ICkgOiAoIGJ5ID4gY3kgPyBieSA6IGN5ICk7CgoJbGV0IHAgPSBjLm5leHQ7Cgl3aGlsZSAoIHAgIT09IGEgKSB7CgoJCWlmICggcC54ID49IHgwICYmIHAueCA8PSB4MSAmJiBwLnkgPj0geTAgJiYgcC55IDw9IHkxICYmCgkJCXBvaW50SW5UcmlhbmdsZSggYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgcC54LCBwLnkgKSAmJgoJCQlhcmVhKCBwLnByZXYsIHAsIHAubmV4dCApID49IDAgKSByZXR1cm4gZmFsc2U7CgkJcCA9IHAubmV4dDsKCgl9CgoJcmV0dXJuIHRydWU7Cgp9CgpmdW5jdGlvbiBpc0Vhckhhc2hlZCggZWFyLCBtaW5YLCBtaW5ZLCBpbnZTaXplICkgewoKCWNvbnN0IGEgPSBlYXIucHJldiwKCQliID0gZWFyLAoJCWMgPSBlYXIubmV4dDsKCglpZiAoIGFyZWEoIGEsIGIsIGMgKSA+PSAwICkgcmV0dXJuIGZhbHNlOyAvLyByZWZsZXgsIGNhbid0IGJlIGFuIGVhcgoKCWNvbnN0IGF4ID0gYS54LCBieCA9IGIueCwgY3ggPSBjLngsIGF5ID0gYS55LCBieSA9IGIueSwgY3kgPSBjLnk7CgoJLy8gdHJpYW5nbGUgYmJveDsgbWluICYgbWF4IGFyZSBjYWxjdWxhdGVkIGxpa2UgdGhpcyBmb3Igc3BlZWQKCWNvbnN0IHgwID0gYXggPCBieCA/ICggYXggPCBjeCA/IGF4IDogY3ggKSA6ICggYnggPCBjeCA/IGJ4IDogY3ggKSwKCQl5MCA9IGF5IDwgYnkgPyAoIGF5IDwgY3kgPyBheSA6IGN5ICkgOiAoIGJ5IDwgY3kgPyBieSA6IGN5ICksCgkJeDEgPSBheCA+IGJ4ID8gKCBheCA+IGN4ID8gYXggOiBjeCApIDogKCBieCA+IGN4ID8gYnggOiBjeCApLAoJCXkxID0gYXkgPiBieSA/ICggYXkgPiBjeSA/IGF5IDogY3kgKSA6ICggYnkgPiBjeSA/IGJ5IDogY3kgKTsKCgkvLyB6LW9yZGVyIHJhbmdlIGZvciB0aGUgY3VycmVudCB0cmlhbmdsZSBiYm94OwoJY29uc3QgbWluWiA9IHpPcmRlciggeDAsIHkwLCBtaW5YLCBtaW5ZLCBpbnZTaXplICksCgkJbWF4WiA9IHpPcmRlciggeDEsIHkxLCBtaW5YLCBtaW5ZLCBpbnZTaXplICk7CgoJbGV0IHAgPSBlYXIucHJldlosCgkJbiA9IGVhci5uZXh0WjsKCgkvLyBsb29rIGZvciBwb2ludHMgaW5zaWRlIHRoZSB0cmlhbmdsZSBpbiBib3RoIGRpcmVjdGlvbnMKCXdoaWxlICggcCAmJiBwLnogPj0gbWluWiAmJiBuICYmIG4ueiA8PSBtYXhaICkgewoKCQlpZiAoIHAueCA+PSB4MCAmJiBwLnggPD0geDEgJiYgcC55ID49IHkwICYmIHAueSA8PSB5MSAmJiBwICE9PSBhICYmIHAgIT09IGMgJiYKCQkJcG9pbnRJblRyaWFuZ2xlKCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCBwLngsIHAueSApICYmIGFyZWEoIHAucHJldiwgcCwgcC5uZXh0ICkgPj0gMCApIHJldHVybiBmYWxzZTsKCQlwID0gcC5wcmV2WjsKCgkJaWYgKCBuLnggPj0geDAgJiYgbi54IDw9IHgxICYmIG4ueSA+PSB5MCAmJiBuLnkgPD0geTEgJiYgbiAhPT0gYSAmJiBuICE9PSBjICYmCgkJCXBvaW50SW5UcmlhbmdsZSggYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgbi54LCBuLnkgKSAmJiBhcmVhKCBuLnByZXYsIG4sIG4ubmV4dCApID49IDAgKSByZXR1cm4gZmFsc2U7CgkJbiA9IG4ubmV4dFo7CgoJfQoKCS8vIGxvb2sgZm9yIHJlbWFpbmluZyBwb2ludHMgaW4gZGVjcmVhc2luZyB6LW9yZGVyCgl3aGlsZSAoIHAgJiYgcC56ID49IG1pblogKSB7CgoJCWlmICggcC54ID49IHgwICYmIHAueCA8PSB4MSAmJiBwLnkgPj0geTAgJiYgcC55IDw9IHkxICYmIHAgIT09IGEgJiYgcCAhPT0gYyAmJgoJCQlwb2ludEluVHJpYW5nbGUoIGF4LCBheSwgYngsIGJ5LCBjeCwgY3ksIHAueCwgcC55ICkgJiYgYXJlYSggcC5wcmV2LCBwLCBwLm5leHQgKSA+PSAwICkgcmV0dXJuIGZhbHNlOwoJCXAgPSBwLnByZXZaOwoKCX0KCgkvLyBsb29rIGZvciByZW1haW5pbmcgcG9pbnRzIGluIGluY3JlYXNpbmcgei1vcmRlcgoJd2hpbGUgKCBuICYmIG4ueiA8PSBtYXhaICkgewoKCQlpZiAoIG4ueCA+PSB4MCAmJiBuLnggPD0geDEgJiYgbi55ID49IHkwICYmIG4ueSA8PSB5MSAmJiBuICE9PSBhICYmIG4gIT09IGMgJiYKCQkJcG9pbnRJblRyaWFuZ2xlKCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCBuLngsIG4ueSApICYmIGFyZWEoIG4ucHJldiwgbiwgbi5uZXh0ICkgPj0gMCApIHJldHVybiBmYWxzZTsKCQluID0gbi5uZXh0WjsKCgl9CgoJcmV0dXJuIHRydWU7Cgp9CgovLyBnbyB0aHJvdWdoIGFsbCBwb2x5Z29uIG5vZGVzIGFuZCBjdXJlIHNtYWxsIGxvY2FsIHNlbGYtaW50ZXJzZWN0aW9ucwpmdW5jdGlvbiBjdXJlTG9jYWxJbnRlcnNlY3Rpb25zKCBzdGFydCwgdHJpYW5nbGVzLCBkaW0gKSB7CgoJbGV0IHAgPSBzdGFydDsKCWRvIHsKCgkJY29uc3QgYSA9IHAucHJldiwKCQkJYiA9IHAubmV4dC5uZXh0OwoKCQlpZiAoICEgZXF1YWxzKCBhLCBiICkgJiYgaW50ZXJzZWN0cyggYSwgcCwgcC5uZXh0LCBiICkgJiYgbG9jYWxseUluc2lkZSggYSwgYiApICYmIGxvY2FsbHlJbnNpZGUoIGIsIGEgKSApIHsKCgkJCXRyaWFuZ2xlcy5wdXNoKCBhLmkgLyBkaW0gfCAwICk7CgkJCXRyaWFuZ2xlcy5wdXNoKCBwLmkgLyBkaW0gfCAwICk7CgkJCXRyaWFuZ2xlcy5wdXNoKCBiLmkgLyBkaW0gfCAwICk7CgoJCQkvLyByZW1vdmUgdHdvIG5vZGVzIGludm9sdmVkCgkJCXJlbW92ZU5vZGUoIHAgKTsKCQkJcmVtb3ZlTm9kZSggcC5uZXh0ICk7CgoJCQlwID0gc3RhcnQgPSBiOwoKCQl9CgoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IHN0YXJ0ICk7CgoJcmV0dXJuIGZpbHRlclBvaW50cyggcCApOwoKfQoKLy8gdHJ5IHNwbGl0dGluZyBwb2x5Z29uIGludG8gdHdvIGFuZCB0cmlhbmd1bGF0ZSB0aGVtIGluZGVwZW5kZW50bHkKZnVuY3Rpb24gc3BsaXRFYXJjdXQoIHN0YXJ0LCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSApIHsKCgkvLyBsb29rIGZvciBhIHZhbGlkIGRpYWdvbmFsIHRoYXQgZGl2aWRlcyB0aGUgcG9seWdvbiBpbnRvIHR3bwoJbGV0IGEgPSBzdGFydDsKCWRvIHsKCgkJbGV0IGIgPSBhLm5leHQubmV4dDsKCQl3aGlsZSAoIGIgIT09IGEucHJldiApIHsKCgkJCWlmICggYS5pICE9PSBiLmkgJiYgaXNWYWxpZERpYWdvbmFsKCBhLCBiICkgKSB7CgoJCQkJLy8gc3BsaXQgdGhlIHBvbHlnb24gaW4gdHdvIGJ5IHRoZSBkaWFnb25hbAoJCQkJbGV0IGMgPSBzcGxpdFBvbHlnb24oIGEsIGIgKTsKCgkJCQkvLyBmaWx0ZXIgY29saW5lYXIgcG9pbnRzIGFyb3VuZCB0aGUgY3V0cwoJCQkJYSA9IGZpbHRlclBvaW50cyggYSwgYS5uZXh0ICk7CgkJCQljID0gZmlsdGVyUG9pbnRzKCBjLCBjLm5leHQgKTsKCgkJCQkvLyBydW4gZWFyY3V0IG9uIGVhY2ggaGFsZgoJCQkJZWFyY3V0TGlua2VkKCBhLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMCApOwoJCQkJZWFyY3V0TGlua2VkKCBjLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJYiA9IGIubmV4dDsKCgkJfQoKCQlhID0gYS5uZXh0OwoKCX0gd2hpbGUgKCBhICE9PSBzdGFydCApOwoKfQoKLy8gbGluayBldmVyeSBob2xlIGludG8gdGhlIG91dGVyIGxvb3AsIHByb2R1Y2luZyBhIHNpbmdsZS1yaW5nIHBvbHlnb24gd2l0aG91dCBob2xlcwpmdW5jdGlvbiBlbGltaW5hdGVIb2xlcyggZGF0YSwgaG9sZUluZGljZXMsIG91dGVyTm9kZSwgZGltICkgewoKCWNvbnN0IHF1ZXVlID0gW107CglsZXQgaSwgbGVuLCBzdGFydCwgZW5kLCBsaXN0OwoKCWZvciAoIGkgPSAwLCBsZW4gPSBob2xlSW5kaWNlcy5sZW5ndGg7IGkgPCBsZW47IGkgKysgKSB7CgoJCXN0YXJ0ID0gaG9sZUluZGljZXNbIGkgXSAqIGRpbTsKCQllbmQgPSBpIDwgbGVuIC0gMSA/IGhvbGVJbmRpY2VzWyBpICsgMSBdICogZGltIDogZGF0YS5sZW5ndGg7CgkJbGlzdCA9IGxpbmtlZExpc3QoIGRhdGEsIHN0YXJ0LCBlbmQsIGRpbSwgZmFsc2UgKTsKCQlpZiAoIGxpc3QgPT09IGxpc3QubmV4dCApIGxpc3Quc3RlaW5lciA9IHRydWU7CgkJcXVldWUucHVzaCggZ2V0TGVmdG1vc3QoIGxpc3QgKSApOwoKCX0KCglxdWV1ZS5zb3J0KCBjb21wYXJlWCApOwoKCS8vIHByb2Nlc3MgaG9sZXMgZnJvbSBsZWZ0IHRvIHJpZ2h0Cglmb3IgKCBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSArKyApIHsKCgkJb3V0ZXJOb2RlID0gZWxpbWluYXRlSG9sZSggcXVldWVbIGkgXSwgb3V0ZXJOb2RlICk7CgoJfQoKCXJldHVybiBvdXRlck5vZGU7Cgp9CgpmdW5jdGlvbiBjb21wYXJlWCggYSwgYiApIHsKCglyZXR1cm4gYS54IC0gYi54OwoKfQoKLy8gZmluZCBhIGJyaWRnZSBiZXR3ZWVuIHZlcnRpY2VzIHRoYXQgY29ubmVjdHMgaG9sZSB3aXRoIGFuIG91dGVyIHJpbmcgYW5kIGxpbmsgaXQKZnVuY3Rpb24gZWxpbWluYXRlSG9sZSggaG9sZSwgb3V0ZXJOb2RlICkgewoKCWNvbnN0IGJyaWRnZSA9IGZpbmRIb2xlQnJpZGdlKCBob2xlLCBvdXRlck5vZGUgKTsKCWlmICggISBicmlkZ2UgKSB7CgoJCXJldHVybiBvdXRlck5vZGU7CgoJfQoKCWNvbnN0IGJyaWRnZVJldmVyc2UgPSBzcGxpdFBvbHlnb24oIGJyaWRnZSwgaG9sZSApOwoKCS8vIGZpbHRlciBjb2xsaW5lYXIgcG9pbnRzIGFyb3VuZCB0aGUgY3V0cwoJZmlsdGVyUG9pbnRzKCBicmlkZ2VSZXZlcnNlLCBicmlkZ2VSZXZlcnNlLm5leHQgKTsKCXJldHVybiBmaWx0ZXJQb2ludHMoIGJyaWRnZSwgYnJpZGdlLm5leHQgKTsKCn0KCi8vIERhdmlkIEViZXJseSdzIGFsZ29yaXRobSBmb3IgZmluZGluZyBhIGJyaWRnZSBiZXR3ZWVuIGhvbGUgYW5kIG91dGVyIHBvbHlnb24KZnVuY3Rpb24gZmluZEhvbGVCcmlkZ2UoIGhvbGUsIG91dGVyTm9kZSApIHsKCglsZXQgcCA9IG91dGVyTm9kZSwKCQlxeCA9IC0gSW5maW5pdHksCgkJbTsKCgljb25zdCBoeCA9IGhvbGUueCwgaHkgPSBob2xlLnk7CgoJLy8gZmluZCBhIHNlZ21lbnQgaW50ZXJzZWN0ZWQgYnkgYSByYXkgZnJvbSB0aGUgaG9sZSdzIGxlZnRtb3N0IHBvaW50IHRvIHRoZSBsZWZ0OwoJLy8gc2VnbWVudCdzIGVuZHBvaW50IHdpdGggbGVzc2VyIHggd2lsbCBiZSBwb3RlbnRpYWwgY29ubmVjdGlvbiBwb2ludAoJZG8gewoKCQlpZiAoIGh5IDw9IHAueSAmJiBoeSA+PSBwLm5leHQueSAmJiBwLm5leHQueSAhPT0gcC55ICkgewoKCQkJY29uc3QgeCA9IHAueCArICggaHkgLSBwLnkgKSAqICggcC5uZXh0LnggLSBwLnggKSAvICggcC5uZXh0LnkgLSBwLnkgKTsKCQkJaWYgKCB4IDw9IGh4ICYmIHggPiBxeCApIHsKCgkJCQlxeCA9IHg7CgkJCQltID0gcC54IDwgcC5uZXh0LnggPyBwIDogcC5uZXh0OwoJCQkJaWYgKCB4ID09PSBoeCApIHJldHVybiBtOyAvLyBob2xlIHRvdWNoZXMgb3V0ZXIgc2VnbWVudDsgcGljayBsZWZ0bW9zdCBlbmRwb2ludAoKCQkJfQoKCQl9CgoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IG91dGVyTm9kZSApOwoKCWlmICggISBtICkgcmV0dXJuIG51bGw7CgoJLy8gbG9vayBmb3IgcG9pbnRzIGluc2lkZSB0aGUgdHJpYW5nbGUgb2YgaG9sZSBwb2ludCwgc2VnbWVudCBpbnRlcnNlY3Rpb24gYW5kIGVuZHBvaW50OwoJLy8gaWYgdGhlcmUgYXJlIG5vIHBvaW50cyBmb3VuZCwgd2UgaGF2ZSBhIHZhbGlkIGNvbm5lY3Rpb247CgkvLyBvdGhlcndpc2UgY2hvb3NlIHRoZSBwb2ludCBvZiB0aGUgbWluaW11bSBhbmdsZSB3aXRoIHRoZSByYXkgYXMgY29ubmVjdGlvbiBwb2ludAoKCWNvbnN0IHN0b3AgPSBtLAoJCW14ID0gbS54LAoJCW15ID0gbS55OwoJbGV0IHRhbk1pbiA9IEluZmluaXR5LCB0YW47CgoJcCA9IG07CgoJZG8gewoKCQlpZiAoIGh4ID49IHAueCAmJiBwLnggPj0gbXggJiYgaHggIT09IHAueCAmJgoJCQkJcG9pbnRJblRyaWFuZ2xlKCBoeSA8IG15ID8gaHggOiBxeCwgaHksIG14LCBteSwgaHkgPCBteSA/IHF4IDogaHgsIGh5LCBwLngsIHAueSApICkgewoKCQkJdGFuID0gTWF0aC5hYnMoIGh5IC0gcC55ICkgLyAoIGh4IC0gcC54ICk7IC8vIHRhbmdlbnRpYWwKCgkJCWlmICggbG9jYWxseUluc2lkZSggcCwgaG9sZSApICYmICggdGFuIDwgdGFuTWluIHx8ICggdGFuID09PSB0YW5NaW4gJiYgKCBwLnggPiBtLnggfHwgKCBwLnggPT09IG0ueCAmJiBzZWN0b3JDb250YWluc1NlY3RvciggbSwgcCApICkgKSApICkgKSB7CgoJCQkJbSA9IHA7CgkJCQl0YW5NaW4gPSB0YW47CgoJCQl9CgoJCX0KCgkJcCA9IHAubmV4dDsKCgl9IHdoaWxlICggcCAhPT0gc3RvcCApOwoKCXJldHVybiBtOwoKfQoKLy8gd2hldGhlciBzZWN0b3IgaW4gdmVydGV4IG0gY29udGFpbnMgc2VjdG9yIGluIHZlcnRleCBwIGluIHRoZSBzYW1lIGNvb3JkaW5hdGVzCmZ1bmN0aW9uIHNlY3RvckNvbnRhaW5zU2VjdG9yKCBtLCBwICkgewoKCXJldHVybiBhcmVhKCBtLnByZXYsIG0sIHAucHJldiApIDwgMCAmJiBhcmVhKCBwLm5leHQsIG0sIG0ubmV4dCApIDwgMDsKCn0KCi8vIGludGVybGluayBwb2x5Z29uIG5vZGVzIGluIHotb3JkZXIKZnVuY3Rpb24gaW5kZXhDdXJ2ZSggc3RhcnQsIG1pblgsIG1pblksIGludlNpemUgKSB7CgoJbGV0IHAgPSBzdGFydDsKCWRvIHsKCgkJaWYgKCBwLnogPT09IDAgKSBwLnogPSB6T3JkZXIoIHAueCwgcC55LCBtaW5YLCBtaW5ZLCBpbnZTaXplICk7CgkJcC5wcmV2WiA9IHAucHJldjsKCQlwLm5leHRaID0gcC5uZXh0OwoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IHN0YXJ0ICk7CgoJcC5wcmV2Wi5uZXh0WiA9IG51bGw7CglwLnByZXZaID0gbnVsbDsKCglzb3J0TGlua2VkKCBwICk7Cgp9CgovLyBTaW1vbiBUYXRoYW0ncyBsaW5rZWQgbGlzdCBtZXJnZSBzb3J0IGFsZ29yaXRobQovLyBodHRwOi8vd3d3LmNoaWFyay5ncmVlbmVuZC5vcmcudWsvfnNndGF0aGFtL2FsZ29yaXRobXMvbGlzdHNvcnQuaHRtbApmdW5jdGlvbiBzb3J0TGlua2VkKCBsaXN0ICkgewoKCWxldCBpLCBwLCBxLCBlLCB0YWlsLCBudW1NZXJnZXMsIHBTaXplLCBxU2l6ZSwKCQlpblNpemUgPSAxOwoKCWRvIHsKCgkJcCA9IGxpc3Q7CgkJbGlzdCA9IG51bGw7CgkJdGFpbCA9IG51bGw7CgkJbnVtTWVyZ2VzID0gMDsKCgkJd2hpbGUgKCBwICkgewoKCQkJbnVtTWVyZ2VzICsrOwoJCQlxID0gcDsKCQkJcFNpemUgPSAwOwoJCQlmb3IgKCBpID0gMDsgaSA8IGluU2l6ZTsgaSArKyApIHsKCgkJCQlwU2l6ZSArKzsKCQkJCXEgPSBxLm5leHRaOwoJCQkJaWYgKCAhIHEgKSBicmVhazsKCgkJCX0KCgkJCXFTaXplID0gaW5TaXplOwoKCQkJd2hpbGUgKCBwU2l6ZSA+IDAgfHwgKCBxU2l6ZSA+IDAgJiYgcSApICkgewoKCQkJCWlmICggcFNpemUgIT09IDAgJiYgKCBxU2l6ZSA9PT0gMCB8fCAhIHEgfHwgcC56IDw9IHEueiApICkgewoKCQkJCQllID0gcDsKCQkJCQlwID0gcC5uZXh0WjsKCQkJCQlwU2l6ZSAtLTsKCgkJCQl9IGVsc2UgewoKCQkJCQllID0gcTsKCQkJCQlxID0gcS5uZXh0WjsKCQkJCQlxU2l6ZSAtLTsKCgkJCQl9CgoJCQkJaWYgKCB0YWlsICkgdGFpbC5uZXh0WiA9IGU7CgkJCQllbHNlIGxpc3QgPSBlOwoKCQkJCWUucHJldlogPSB0YWlsOwoJCQkJdGFpbCA9IGU7CgoJCQl9CgoJCQlwID0gcTsKCgkJfQoKCQl0YWlsLm5leHRaID0gbnVsbDsKCQlpblNpemUgKj0gMjsKCgl9IHdoaWxlICggbnVtTWVyZ2VzID4gMSApOwoKCXJldHVybiBsaXN0OwoKfQoKLy8gei1vcmRlciBvZiBhIHBvaW50IGdpdmVuIGNvb3JkcyBhbmQgaW52ZXJzZSBvZiB0aGUgbG9uZ2VyIHNpZGUgb2YgZGF0YSBiYm94CmZ1bmN0aW9uIHpPcmRlciggeCwgeSwgbWluWCwgbWluWSwgaW52U2l6ZSApIHsKCgkvLyBjb29yZHMgYXJlIHRyYW5zZm9ybWVkIGludG8gbm9uLW5lZ2F0aXZlIDE1LWJpdCBpbnRlZ2VyIHJhbmdlCgl4ID0gKCB4IC0gbWluWCApICogaW52U2l6ZSB8IDA7Cgl5ID0gKCB5IC0gbWluWSApICogaW52U2l6ZSB8IDA7CgoJeCA9ICggeCB8ICggeCA8PCA4ICkgKSAmIDB4MDBGRjAwRkY7Cgl4ID0gKCB4IHwgKCB4IDw8IDQgKSApICYgMHgwRjBGMEYwRjsKCXggPSAoIHggfCAoIHggPDwgMiApICkgJiAweDMzMzMzMzMzOwoJeCA9ICggeCB8ICggeCA8PCAxICkgKSAmIDB4NTU1NTU1NTU7CgoJeSA9ICggeSB8ICggeSA8PCA4ICkgKSAmIDB4MDBGRjAwRkY7Cgl5ID0gKCB5IHwgKCB5IDw8IDQgKSApICYgMHgwRjBGMEYwRjsKCXkgPSAoIHkgfCAoIHkgPDwgMiApICkgJiAweDMzMzMzMzMzOwoJeSA9ICggeSB8ICggeSA8PCAxICkgKSAmIDB4NTU1NTU1NTU7CgoJcmV0dXJuIHggfCAoIHkgPDwgMSApOwoKfQoKLy8gZmluZCB0aGUgbGVmdG1vc3Qgbm9kZSBvZiBhIHBvbHlnb24gcmluZwpmdW5jdGlvbiBnZXRMZWZ0bW9zdCggc3RhcnQgKSB7CgoJbGV0IHAgPSBzdGFydCwKCQlsZWZ0bW9zdCA9IHN0YXJ0OwoJZG8gewoKCQlpZiAoIHAueCA8IGxlZnRtb3N0LnggfHwgKCBwLnggPT09IGxlZnRtb3N0LnggJiYgcC55IDwgbGVmdG1vc3QueSApICkgbGVmdG1vc3QgPSBwOwoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IHN0YXJ0ICk7CgoJcmV0dXJuIGxlZnRtb3N0OwoKfQoKLy8gY2hlY2sgaWYgYSBwb2ludCBsaWVzIHdpdGhpbiBhIGNvbnZleCB0cmlhbmdsZQpmdW5jdGlvbiBwb2ludEluVHJpYW5nbGUoIGF4LCBheSwgYngsIGJ5LCBjeCwgY3ksIHB4LCBweSApIHsKCglyZXR1cm4gKCBjeCAtIHB4ICkgKiAoIGF5IC0gcHkgKSA+PSAoIGF4IC0gcHggKSAqICggY3kgLSBweSApICYmCiAgICAgICAgICAgKCBheCAtIHB4ICkgKiAoIGJ5IC0gcHkgKSA+PSAoIGJ4IC0gcHggKSAqICggYXkgLSBweSApICYmCiAgICAgICAgICAgKCBieCAtIHB4ICkgKiAoIGN5IC0gcHkgKSA+PSAoIGN4IC0gcHggKSAqICggYnkgLSBweSApOwoKfQoKLy8gY2hlY2sgaWYgYSBkaWFnb25hbCBiZXR3ZWVuIHR3byBwb2x5Z29uIG5vZGVzIGlzIHZhbGlkIChsaWVzIGluIHBvbHlnb24gaW50ZXJpb3IpCmZ1bmN0aW9uIGlzVmFsaWREaWFnb25hbCggYSwgYiApIHsKCglyZXR1cm4gYS5uZXh0LmkgIT09IGIuaSAmJiBhLnByZXYuaSAhPT0gYi5pICYmICEgaW50ZXJzZWN0c1BvbHlnb24oIGEsIGIgKSAmJiAvLyBkb25lcyd0IGludGVyc2VjdCBvdGhlciBlZGdlcwogICAgICAgICAgICggbG9jYWxseUluc2lkZSggYSwgYiApICYmIGxvY2FsbHlJbnNpZGUoIGIsIGEgKSAmJiBtaWRkbGVJbnNpZGUoIGEsIGIgKSAmJiAvLyBsb2NhbGx5IHZpc2libGUKICAgICAgICAgICAgKCBhcmVhKCBhLnByZXYsIGEsIGIucHJldiApIHx8IGFyZWEoIGEsIGIucHJldiwgYiApICkgfHwgLy8gZG9lcyBub3QgY3JlYXRlIG9wcG9zaXRlLWZhY2luZyBzZWN0b3JzCiAgICAgICAgICAgIGVxdWFscyggYSwgYiApICYmIGFyZWEoIGEucHJldiwgYSwgYS5uZXh0ICkgPiAwICYmIGFyZWEoIGIucHJldiwgYiwgYi5uZXh0ICkgPiAwICk7IC8vIHNwZWNpYWwgemVyby1sZW5ndGggY2FzZQoKfQoKLy8gc2lnbmVkIGFyZWEgb2YgYSB0cmlhbmdsZQpmdW5jdGlvbiBhcmVhKCBwLCBxLCByICkgewoKCXJldHVybiAoIHEueSAtIHAueSApICogKCByLnggLSBxLnggKSAtICggcS54IC0gcC54ICkgKiAoIHIueSAtIHEueSApOwoKfQoKLy8gY2hlY2sgaWYgdHdvIHBvaW50cyBhcmUgZXF1YWwKZnVuY3Rpb24gZXF1YWxzKCBwMSwgcDIgKSB7CgoJcmV0dXJuIHAxLnggPT09IHAyLnggJiYgcDEueSA9PT0gcDIueTsKCn0KCi8vIGNoZWNrIGlmIHR3byBzZWdtZW50cyBpbnRlcnNlY3QKZnVuY3Rpb24gaW50ZXJzZWN0cyggcDEsIHExLCBwMiwgcTIgKSB7CgoJY29uc3QgbzEgPSBzaWduKCBhcmVhKCBwMSwgcTEsIHAyICkgKTsKCWNvbnN0IG8yID0gc2lnbiggYXJlYSggcDEsIHExLCBxMiApICk7Cgljb25zdCBvMyA9IHNpZ24oIGFyZWEoIHAyLCBxMiwgcDEgKSApOwoJY29uc3QgbzQgPSBzaWduKCBhcmVhKCBwMiwgcTIsIHExICkgKTsKCglpZiAoIG8xICE9PSBvMiAmJiBvMyAhPT0gbzQgKSByZXR1cm4gdHJ1ZTsgLy8gZ2VuZXJhbCBjYXNlCgoJaWYgKCBvMSA9PT0gMCAmJiBvblNlZ21lbnQoIHAxLCBwMiwgcTEgKSApIHJldHVybiB0cnVlOyAvLyBwMSwgcTEgYW5kIHAyIGFyZSBjb2xsaW5lYXIgYW5kIHAyIGxpZXMgb24gcDFxMQoJaWYgKCBvMiA9PT0gMCAmJiBvblNlZ21lbnQoIHAxLCBxMiwgcTEgKSApIHJldHVybiB0cnVlOyAvLyBwMSwgcTEgYW5kIHEyIGFyZSBjb2xsaW5lYXIgYW5kIHEyIGxpZXMgb24gcDFxMQoJaWYgKCBvMyA9PT0gMCAmJiBvblNlZ21lbnQoIHAyLCBwMSwgcTIgKSApIHJldHVybiB0cnVlOyAvLyBwMiwgcTIgYW5kIHAxIGFyZSBjb2xsaW5lYXIgYW5kIHAxIGxpZXMgb24gcDJxMgoJaWYgKCBvNCA9PT0gMCAmJiBvblNlZ21lbnQoIHAyLCBxMSwgcTIgKSApIHJldHVybiB0cnVlOyAvLyBwMiwgcTIgYW5kIHExIGFyZSBjb2xsaW5lYXIgYW5kIHExIGxpZXMgb24gcDJxMgoKCXJldHVybiBmYWxzZTsKCn0KCi8vIGZvciBjb2xsaW5lYXIgcG9pbnRzIHAsIHEsIHIsIGNoZWNrIGlmIHBvaW50IHEgbGllcyBvbiBzZWdtZW50IHByCmZ1bmN0aW9uIG9uU2VnbWVudCggcCwgcSwgciApIHsKCglyZXR1cm4gcS54IDw9IE1hdGgubWF4KCBwLngsIHIueCApICYmIHEueCA+PSBNYXRoLm1pbiggcC54LCByLnggKSAmJiBxLnkgPD0gTWF0aC5tYXgoIHAueSwgci55ICkgJiYgcS55ID49IE1hdGgubWluKCBwLnksIHIueSApOwoKfQoKZnVuY3Rpb24gc2lnbiggbnVtICkgewoKCXJldHVybiBudW0gPiAwID8gMSA6IG51bSA8IDAgPyAtIDEgOiAwOwoKfQoKLy8gY2hlY2sgaWYgYSBwb2x5Z29uIGRpYWdvbmFsIGludGVyc2VjdHMgYW55IHBvbHlnb24gc2VnbWVudHMKZnVuY3Rpb24gaW50ZXJzZWN0c1BvbHlnb24oIGEsIGIgKSB7CgoJbGV0IHAgPSBhOwoJZG8gewoKCQlpZiAoIHAuaSAhPT0gYS5pICYmIHAubmV4dC5pICE9PSBhLmkgJiYgcC5pICE9PSBiLmkgJiYgcC5uZXh0LmkgIT09IGIuaSAmJgoJCQlpbnRlcnNlY3RzKCBwLCBwLm5leHQsIGEsIGIgKSApIHJldHVybiB0cnVlOwoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IGEgKTsKCglyZXR1cm4gZmFsc2U7Cgp9CgovLyBjaGVjayBpZiBhIHBvbHlnb24gZGlhZ29uYWwgaXMgbG9jYWxseSBpbnNpZGUgdGhlIHBvbHlnb24KZnVuY3Rpb24gbG9jYWxseUluc2lkZSggYSwgYiApIHsKCglyZXR1cm4gYXJlYSggYS5wcmV2LCBhLCBhLm5leHQgKSA8IDAgPwoJCWFyZWEoIGEsIGIsIGEubmV4dCApID49IDAgJiYgYXJlYSggYSwgYS5wcmV2LCBiICkgPj0gMCA6CgkJYXJlYSggYSwgYiwgYS5wcmV2ICkgPCAwIHx8IGFyZWEoIGEsIGEubmV4dCwgYiApIDwgMDsKCn0KCi8vIGNoZWNrIGlmIHRoZSBtaWRkbGUgcG9pbnQgb2YgYSBwb2x5Z29uIGRpYWdvbmFsIGlzIGluc2lkZSB0aGUgcG9seWdvbgpmdW5jdGlvbiBtaWRkbGVJbnNpZGUoIGEsIGIgKSB7CgoJbGV0IHAgPSBhLAoJCWluc2lkZSA9IGZhbHNlOwoJY29uc3QgcHggPSAoIGEueCArIGIueCApIC8gMiwKCQlweSA9ICggYS55ICsgYi55ICkgLyAyOwoJZG8gewoKCQlpZiAoICggKCBwLnkgPiBweSApICE9PSAoIHAubmV4dC55ID4gcHkgKSApICYmIHAubmV4dC55ICE9PSBwLnkgJiYKCQkJKCBweCA8ICggcC5uZXh0LnggLSBwLnggKSAqICggcHkgLSBwLnkgKSAvICggcC5uZXh0LnkgLSBwLnkgKSArIHAueCApICkKCQkJaW5zaWRlID0gISBpbnNpZGU7CgkJcCA9IHAubmV4dDsKCgl9IHdoaWxlICggcCAhPT0gYSApOwoKCXJldHVybiBpbnNpZGU7Cgp9CgovLyBsaW5rIHR3byBwb2x5Z29uIHZlcnRpY2VzIHdpdGggYSBicmlkZ2U7IGlmIHRoZSB2ZXJ0aWNlcyBiZWxvbmcgdG8gdGhlIHNhbWUgcmluZywgaXQgc3BsaXRzIHBvbHlnb24gaW50byB0d287Ci8vIGlmIG9uZSBiZWxvbmdzIHRvIHRoZSBvdXRlciByaW5nIGFuZCBhbm90aGVyIHRvIGEgaG9sZSwgaXQgbWVyZ2VzIGl0IGludG8gYSBzaW5nbGUgcmluZwpmdW5jdGlvbiBzcGxpdFBvbHlnb24oIGEsIGIgKSB7CgoJY29uc3QgYTIgPSBuZXcgTm9kZSggYS5pLCBhLngsIGEueSApLAoJCWIyID0gbmV3IE5vZGUoIGIuaSwgYi54LCBiLnkgKSwKCQlhbiA9IGEubmV4dCwKCQlicCA9IGIucHJldjsKCglhLm5leHQgPSBiOwoJYi5wcmV2ID0gYTsKCglhMi5uZXh0ID0gYW47Cglhbi5wcmV2ID0gYTI7CgoJYjIubmV4dCA9IGEyOwoJYTIucHJldiA9IGIyOwoKCWJwLm5leHQgPSBiMjsKCWIyLnByZXYgPSBicDsKCglyZXR1cm4gYjI7Cgp9CgovLyBjcmVhdGUgYSBub2RlIGFuZCBvcHRpb25hbGx5IGxpbmsgaXQgd2l0aCBwcmV2aW91cyBvbmUgKGluIGEgY2lyY3VsYXIgZG91Ymx5IGxpbmtlZCBsaXN0KQpmdW5jdGlvbiBpbnNlcnROb2RlKCBpLCB4LCB5LCBsYXN0ICkgewoKCWNvbnN0IHAgPSBuZXcgTm9kZSggaSwgeCwgeSApOwoKCWlmICggISBsYXN0ICkgewoKCQlwLnByZXYgPSBwOwoJCXAubmV4dCA9IHA7CgoJfSBlbHNlIHsKCgkJcC5uZXh0ID0gbGFzdC5uZXh0OwoJCXAucHJldiA9IGxhc3Q7CgkJbGFzdC5uZXh0LnByZXYgPSBwOwoJCWxhc3QubmV4dCA9IHA7CgoJfQoKCXJldHVybiBwOwoKfQoKZnVuY3Rpb24gcmVtb3ZlTm9kZSggcCApIHsKCglwLm5leHQucHJldiA9IHAucHJldjsKCXAucHJldi5uZXh0ID0gcC5uZXh0OwoKCWlmICggcC5wcmV2WiApIHAucHJldloubmV4dFogPSBwLm5leHRaOwoJaWYgKCBwLm5leHRaICkgcC5uZXh0Wi5wcmV2WiA9IHAucHJldlo7Cgp9CgpmdW5jdGlvbiBOb2RlKCBpLCB4LCB5ICkgewoKCS8vIHZlcnRleCBpbmRleCBpbiBjb29yZGluYXRlcyBhcnJheQoJdGhpcy5pID0gaTsKCgkvLyB2ZXJ0ZXggY29vcmRpbmF0ZXMKCXRoaXMueCA9IHg7Cgl0aGlzLnkgPSB5OwoKCS8vIHByZXZpb3VzIGFuZCBuZXh0IHZlcnRleCBub2RlcyBpbiBhIHBvbHlnb24gcmluZwoJdGhpcy5wcmV2ID0gbnVsbDsKCXRoaXMubmV4dCA9IG51bGw7CgoJLy8gei1vcmRlciBjdXJ2ZSB2YWx1ZQoJdGhpcy56ID0gMDsKCgkvLyBwcmV2aW91cyBhbmQgbmV4dCBub2RlcyBpbiB6LW9yZGVyCgl0aGlzLnByZXZaID0gbnVsbDsKCXRoaXMubmV4dFogPSBudWxsOwoKCS8vIGluZGljYXRlcyB3aGV0aGVyIHRoaXMgaXMgYSBzdGVpbmVyIHBvaW50Cgl0aGlzLnN0ZWluZXIgPSBmYWxzZTsKCn0KCmZ1bmN0aW9uIHNpZ25lZEFyZWEoIGRhdGEsIHN0YXJ0LCBlbmQsIGRpbSApIHsKCglsZXQgc3VtID0gMDsKCWZvciAoIGxldCBpID0gc3RhcnQsIGogPSBlbmQgLSBkaW07IGkgPCBlbmQ7IGkgKz0gZGltICkgewoKCQlzdW0gKz0gKCBkYXRhWyBqIF0gLSBkYXRhWyBpIF0gKSAqICggZGF0YVsgaSArIDEgXSArIGRhdGFbIGogKyAxIF0gKTsKCQlqID0gaTsKCgl9CgoJcmV0dXJuIHN1bTsKCn0KCmNsYXNzIFNoYXBlVXRpbHMgewoKCS8vIGNhbGN1bGF0ZSBhcmVhIG9mIHRoZSBjb250b3VyIHBvbHlnb24KCglzdGF0aWMgYXJlYSggY29udG91ciApIHsKCgkJY29uc3QgbiA9IGNvbnRvdXIubGVuZ3RoOwoJCWxldCBhID0gMC4wOwoKCQlmb3IgKCBsZXQgcCA9IG4gLSAxLCBxID0gMDsgcSA8IG47IHAgPSBxICsrICkgewoKCQkJYSArPSBjb250b3VyWyBwIF0ueCAqIGNvbnRvdXJbIHEgXS55IC0gY29udG91clsgcSBdLnggKiBjb250b3VyWyBwIF0ueTsKCgkJfQoKCQlyZXR1cm4gYSAqIDAuNTsKCgl9CgoJc3RhdGljIGlzQ2xvY2tXaXNlKCBwdHMgKSB7CgoJCXJldHVybiBTaGFwZVV0aWxzLmFyZWEoIHB0cyApIDwgMDsKCgl9CgoJc3RhdGljIHRyaWFuZ3VsYXRlU2hhcGUoIGNvbnRvdXIsIGhvbGVzICkgewoKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOyAvLyBmbGF0IGFycmF5IG9mIHZlcnRpY2VzIGxpa2UgWyB4MCx5MCwgeDEseTEsIHgyLHkyLCAuLi4gXQoJCWNvbnN0IGhvbGVJbmRpY2VzID0gW107IC8vIGFycmF5IG9mIGhvbGUgaW5kaWNlcwoJCWNvbnN0IGZhY2VzID0gW107IC8vIGZpbmFsIGFycmF5IG9mIHZlcnRleCBpbmRpY2VzIGxpa2UgWyBbIGEsYixkIF0sIFsgYixjLGQgXSBdCgoJCXJlbW92ZUR1cEVuZFB0cyggY29udG91ciApOwoJCWFkZENvbnRvdXIoIHZlcnRpY2VzLCBjb250b3VyICk7CgoJCS8vCgoJCWxldCBob2xlSW5kZXggPSBjb250b3VyLmxlbmd0aDsKCgkJaG9sZXMuZm9yRWFjaCggcmVtb3ZlRHVwRW5kUHRzICk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGhvbGVzLmxlbmd0aDsgaSArKyApIHsKCgkJCWhvbGVJbmRpY2VzLnB1c2goIGhvbGVJbmRleCApOwoJCQlob2xlSW5kZXggKz0gaG9sZXNbIGkgXS5sZW5ndGg7CgkJCWFkZENvbnRvdXIoIHZlcnRpY2VzLCBob2xlc1sgaSBdICk7CgoJCX0KCgkJLy8KCgkJY29uc3QgdHJpYW5nbGVzID0gRWFyY3V0LnRyaWFuZ3VsYXRlKCB2ZXJ0aWNlcywgaG9sZUluZGljZXMgKTsKCgkJLy8KCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSArPSAzICkgewoKCQkJZmFjZXMucHVzaCggdHJpYW5nbGVzLnNsaWNlKCBpLCBpICsgMyApICk7CgoJCX0KCgkJcmV0dXJuIGZhY2VzOwoKCX0KCn0KCmZ1bmN0aW9uIHJlbW92ZUR1cEVuZFB0cyggcG9pbnRzICkgewoKCWNvbnN0IGwgPSBwb2ludHMubGVuZ3RoOwoKCWlmICggbCA+IDIgJiYgcG9pbnRzWyBsIC0gMSBdLmVxdWFscyggcG9pbnRzWyAwIF0gKSApIHsKCgkJcG9pbnRzLnBvcCgpOwoKCX0KCn0KCmZ1bmN0aW9uIGFkZENvbnRvdXIoIHZlcnRpY2VzLCBjb250b3VyICkgewoKCWZvciAoIGxldCBpID0gMDsgaSA8IGNvbnRvdXIubGVuZ3RoOyBpICsrICkgewoKCQl2ZXJ0aWNlcy5wdXNoKCBjb250b3VyWyBpIF0ueCApOwoJCXZlcnRpY2VzLnB1c2goIGNvbnRvdXJbIGkgXS55ICk7CgoJfQoKfQoKLyoqCiAqIENyZWF0ZXMgZXh0cnVkZWQgZ2VvbWV0cnkgZnJvbSBhIHBhdGggc2hhcGUuCiAqCiAqIHBhcmFtZXRlcnMgPSB7CiAqCiAqICBjdXJ2ZVNlZ21lbnRzOiA8aW50PiwgLy8gbnVtYmVyIG9mIHBvaW50cyBvbiB0aGUgY3VydmVzCiAqICBzdGVwczogPGludD4sIC8vIG51bWJlciBvZiBwb2ludHMgZm9yIHotc2lkZSBleHRydXNpb25zIC8gdXNlZCBmb3Igc3ViZGl2aWRpbmcgc2VnbWVudHMgb2YgZXh0cnVkZSBzcGxpbmUgdG9vCiAqICBkZXB0aDogPGZsb2F0PiwgLy8gRGVwdGggdG8gZXh0cnVkZSB0aGUgc2hhcGUKICoKICogIGJldmVsRW5hYmxlZDogPGJvb2w+LCAvLyB0dXJuIG9uIGJldmVsCiAqICBiZXZlbFRoaWNrbmVzczogPGZsb2F0PiwgLy8gaG93IGRlZXAgaW50byB0aGUgb3JpZ2luYWwgc2hhcGUgYmV2ZWwgZ29lcwogKiAgYmV2ZWxTaXplOiA8ZmxvYXQ+LCAvLyBob3cgZmFyIGZyb20gc2hhcGUgb3V0bGluZSAoaW5jbHVkaW5nIGJldmVsT2Zmc2V0KSBpcyBiZXZlbAogKiAgYmV2ZWxPZmZzZXQ6IDxmbG9hdD4sIC8vIGhvdyBmYXIgZnJvbSBzaGFwZSBvdXRsaW5lIGRvZXMgYmV2ZWwgc3RhcnQKICogIGJldmVsU2VnbWVudHM6IDxpbnQ+LCAvLyBudW1iZXIgb2YgYmV2ZWwgbGF5ZXJzCiAqCiAqICBleHRydWRlUGF0aDogPFRIUkVFLkN1cnZlPiAvLyBjdXJ2ZSB0byBleHRydWRlIHNoYXBlIGFsb25nCiAqCiAqICBVVkdlbmVyYXRvcjogPE9iamVjdD4gLy8gb2JqZWN0IHRoYXQgcHJvdmlkZXMgVVYgZ2VuZXJhdG9yIGZ1bmN0aW9ucwogKgogKiB9CiAqLwoKCmNsYXNzIEV4dHJ1ZGVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3Rvciggc2hhcGVzID0gbmV3IFNoYXBlKCBbIG5ldyBWZWN0b3IyKCAwLjUsIDAuNSApLCBuZXcgVmVjdG9yMiggLSAwLjUsIDAuNSApLCBuZXcgVmVjdG9yMiggLSAwLjUsIC0gMC41ICksIG5ldyBWZWN0b3IyKCAwLjUsIC0gMC41ICkgXSApLCBvcHRpb25zID0ge30gKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdFeHRydWRlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXNoYXBlczogc2hhcGVzLAoJCQlvcHRpb25zOiBvcHRpb25zCgkJfTsKCgkJc2hhcGVzID0gQXJyYXkuaXNBcnJheSggc2hhcGVzICkgPyBzaGFwZXMgOiBbIHNoYXBlcyBdOwoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCWNvbnN0IHZlcnRpY2VzQXJyYXkgPSBbXTsKCQljb25zdCB1dkFycmF5ID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3Qgc2hhcGUgPSBzaGFwZXNbIGkgXTsKCQkJYWRkU2hhcGUoIHNoYXBlICk7CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlc0FycmF5LCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2QXJyYXksIDIgKSApOwoKCQl0aGlzLmNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCk7CgoJCS8vIGZ1bmN0aW9ucwoKCQlmdW5jdGlvbiBhZGRTaGFwZSggc2hhcGUgKSB7CgoJCQljb25zdCBwbGFjZWhvbGRlciA9IFtdOwoKCQkJLy8gb3B0aW9ucwoKCQkJY29uc3QgY3VydmVTZWdtZW50cyA9IG9wdGlvbnMuY3VydmVTZWdtZW50cyAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5jdXJ2ZVNlZ21lbnRzIDogMTI7CgkJCWNvbnN0IHN0ZXBzID0gb3B0aW9ucy5zdGVwcyAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5zdGVwcyA6IDE7CgkJCWNvbnN0IGRlcHRoID0gb3B0aW9ucy5kZXB0aCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5kZXB0aCA6IDE7CgoJCQlsZXQgYmV2ZWxFbmFibGVkID0gb3B0aW9ucy5iZXZlbEVuYWJsZWQgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYmV2ZWxFbmFibGVkIDogdHJ1ZTsKCQkJbGV0IGJldmVsVGhpY2tuZXNzID0gb3B0aW9ucy5iZXZlbFRoaWNrbmVzcyAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5iZXZlbFRoaWNrbmVzcyA6IDAuMjsKCQkJbGV0IGJldmVsU2l6ZSA9IG9wdGlvbnMuYmV2ZWxTaXplICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJldmVsU2l6ZSA6IGJldmVsVGhpY2tuZXNzIC0gMC4xOwoJCQlsZXQgYmV2ZWxPZmZzZXQgPSBvcHRpb25zLmJldmVsT2Zmc2V0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJldmVsT2Zmc2V0IDogMDsKCQkJbGV0IGJldmVsU2VnbWVudHMgPSBvcHRpb25zLmJldmVsU2VnbWVudHMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYmV2ZWxTZWdtZW50cyA6IDM7CgoJCQljb25zdCBleHRydWRlUGF0aCA9IG9wdGlvbnMuZXh0cnVkZVBhdGg7CgoJCQljb25zdCB1dmdlbiA9IG9wdGlvbnMuVVZHZW5lcmF0b3IgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuVVZHZW5lcmF0b3IgOiBXb3JsZFVWR2VuZXJhdG9yOwoKCQkJLy8KCgkJCWxldCBleHRydWRlUHRzLCBleHRydWRlQnlQYXRoID0gZmFsc2U7CgkJCWxldCBzcGxpbmVUdWJlLCBiaW5vcm1hbCwgbm9ybWFsLCBwb3NpdGlvbjI7CgoJCQlpZiAoIGV4dHJ1ZGVQYXRoICkgewoKCQkJCWV4dHJ1ZGVQdHMgPSBleHRydWRlUGF0aC5nZXRTcGFjZWRQb2ludHMoIHN0ZXBzICk7CgoJCQkJZXh0cnVkZUJ5UGF0aCA9IHRydWU7CgkJCQliZXZlbEVuYWJsZWQgPSBmYWxzZTsgLy8gYmV2ZWxzIG5vdCBzdXBwb3J0ZWQgZm9yIHBhdGggZXh0cnVzaW9uCgoJCQkJLy8gU0VUVVAgVE5CIHZhcmlhYmxlcwoKCQkJCS8vIFRPRE8xIC0gaGF2ZSBhIC5pc0Nsb3NlZCBpbiBzcGxpbmU/CgoJCQkJc3BsaW5lVHViZSA9IGV4dHJ1ZGVQYXRoLmNvbXB1dGVGcmVuZXRGcmFtZXMoIHN0ZXBzLCBmYWxzZSApOwoKCQkJCS8vIGNvbnNvbGUubG9nKHNwbGluZVR1YmUsICdzcGxpbmVUdWJlJywgc3BsaW5lVHViZS5ub3JtYWxzLmxlbmd0aCwgJ3N0ZXBzJywgc3RlcHMsICdleHRydWRlUHRzJywgZXh0cnVkZVB0cy5sZW5ndGgpOwoKCQkJCWJpbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCQkJCW5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJCQlwb3NpdGlvbjIgPSBuZXcgVmVjdG9yMygpOwoKCQkJfQoKCQkJLy8gU2FmZWd1YXJkcyBpZiBiZXZlbHMgYXJlIG5vdCBlbmFibGVkCgoJCQlpZiAoICEgYmV2ZWxFbmFibGVkICkgewoKCQkJCWJldmVsU2VnbWVudHMgPSAwOwoJCQkJYmV2ZWxUaGlja25lc3MgPSAwOwoJCQkJYmV2ZWxTaXplID0gMDsKCQkJCWJldmVsT2Zmc2V0ID0gMDsKCgkJCX0KCgkJCS8vIFZhcmlhYmxlcyBpbml0aWFsaXphdGlvbgoKCQkJY29uc3Qgc2hhcGVQb2ludHMgPSBzaGFwZS5leHRyYWN0UG9pbnRzKCBjdXJ2ZVNlZ21lbnRzICk7CgoJCQlsZXQgdmVydGljZXMgPSBzaGFwZVBvaW50cy5zaGFwZTsKCQkJY29uc3QgaG9sZXMgPSBzaGFwZVBvaW50cy5ob2xlczsKCgkJCWNvbnN0IHJldmVyc2UgPSAhIFNoYXBlVXRpbHMuaXNDbG9ja1dpc2UoIHZlcnRpY2VzICk7CgoJCQlpZiAoIHJldmVyc2UgKSB7CgoJCQkJdmVydGljZXMgPSB2ZXJ0aWNlcy5yZXZlcnNlKCk7CgoJCQkJLy8gTWF5YmUgd2Ugc2hvdWxkIGFsc28gY2hlY2sgaWYgaG9sZXMgYXJlIGluIHRoZSBvcHBvc2l0ZSBkaXJlY3Rpb24sIGp1c3QgdG8gYmUgc2FmZSAuLi4KCgkJCQlmb3IgKCBsZXQgaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGggKysgKSB7CgoJCQkJCWNvbnN0IGFob2xlID0gaG9sZXNbIGggXTsKCgkJCQkJaWYgKCBTaGFwZVV0aWxzLmlzQ2xvY2tXaXNlKCBhaG9sZSApICkgewoKCQkJCQkJaG9sZXNbIGggXSA9IGFob2xlLnJldmVyc2UoKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgoJCQljb25zdCBmYWNlcyA9IFNoYXBlVXRpbHMudHJpYW5ndWxhdGVTaGFwZSggdmVydGljZXMsIGhvbGVzICk7CgoJCQkvKiBWZXJ0aWNlcyAqLwoKCQkJY29uc3QgY29udG91ciA9IHZlcnRpY2VzOyAvLyB2ZXJ0aWNlcyBoYXMgYWxsIHBvaW50cyBidXQgY29udG91ciBoYXMgb25seSBwb2ludHMgb2YgY2lyY3VtZmVyZW5jZQoKCQkJZm9yICggbGV0IGggPSAwLCBobCA9IGhvbGVzLmxlbmd0aDsgaCA8IGhsOyBoICsrICkgewoKCQkJCWNvbnN0IGFob2xlID0gaG9sZXNbIGggXTsKCgkJCQl2ZXJ0aWNlcyA9IHZlcnRpY2VzLmNvbmNhdCggYWhvbGUgKTsKCgkJCX0KCgoJCQlmdW5jdGlvbiBzY2FsZVB0MiggcHQsIHZlYywgc2l6ZSApIHsKCgkJCQlpZiAoICEgdmVjICkgY29uc29sZS5lcnJvciggJ1RIUkVFLkV4dHJ1ZGVHZW9tZXRyeTogdmVjIGRvZXMgbm90IGV4aXN0JyApOwoKCQkJCXJldHVybiBwdC5jbG9uZSgpLmFkZFNjYWxlZFZlY3RvciggdmVjLCBzaXplICk7CgoJCQl9CgoJCQljb25zdCB2bGVuID0gdmVydGljZXMubGVuZ3RoLCBmbGVuID0gZmFjZXMubGVuZ3RoOwoKCgkJCS8vIEZpbmQgZGlyZWN0aW9ucyBmb3IgcG9pbnQgbW92ZW1lbnQKCgoJCQlmdW5jdGlvbiBnZXRCZXZlbFZlYyggaW5QdCwgaW5QcmV2LCBpbk5leHQgKSB7CgoJCQkJLy8gY29tcHV0ZXMgZm9yIGluUHQgdGhlIGNvcnJlc3BvbmRpbmcgcG9pbnQgaW5QdCcgb24gYSBuZXcgY29udG91cgoJCQkJLy8gICBzaGlmdGVkIGJ5IDEgdW5pdCAobGVuZ3RoIG9mIG5vcm1hbGl6ZWQgdmVjdG9yKSB0byB0aGUgbGVmdAoJCQkJLy8gaWYgd2Ugd2FsayBhbG9uZyBjb250b3VyIGNsb2Nrd2lzZSwgdGhpcyBuZXcgY29udG91ciBpcyBvdXRzaWRlIHRoZSBvbGQgb25lCgkJCQkvLwoJCQkJLy8gaW5QdCcgaXMgdGhlIGludGVyc2VjdGlvbiBvZiB0aGUgdHdvIGxpbmVzIHBhcmFsbGVsIHRvIHRoZSB0d28KCQkJCS8vICBhZGphY2VudCBlZGdlcyBvZiBpblB0IGF0IGEgZGlzdGFuY2Ugb2YgMSB1bml0IG9uIHRoZSBsZWZ0IHNpZGUuCgoJCQkJbGV0IHZfdHJhbnNfeCwgdl90cmFuc195LCBzaHJpbmtfYnk7IC8vIHJlc3VsdGluZyB0cmFuc2xhdGlvbiB2ZWN0b3IgZm9yIGluUHQKCgkJCQkvLyBnb29kIHJlYWRpbmcgZm9yIGdlb21ldHJ5IGFsZ29yaXRobXMgKGhlcmU6IGxpbmUtbGluZSBpbnRlcnNlY3Rpb24pCgkJCQkvLyBodHRwOi8vZ2VvbWFsZ29yaXRobXMuY29tL2EwNS1faW50ZXJzZWN0LTEuaHRtbAoKCQkJCWNvbnN0IHZfcHJldl94ID0gaW5QdC54IC0gaW5QcmV2LngsCgkJCQkJdl9wcmV2X3kgPSBpblB0LnkgLSBpblByZXYueTsKCQkJCWNvbnN0IHZfbmV4dF94ID0gaW5OZXh0LnggLSBpblB0LngsCgkJCQkJdl9uZXh0X3kgPSBpbk5leHQueSAtIGluUHQueTsKCgkJCQljb25zdCB2X3ByZXZfbGVuc3EgPSAoIHZfcHJldl94ICogdl9wcmV2X3ggKyB2X3ByZXZfeSAqIHZfcHJldl95ICk7CgoJCQkJLy8gY2hlY2sgZm9yIGNvbGxpbmVhciBlZGdlcwoJCQkJY29uc3QgY29sbGluZWFyMCA9ICggdl9wcmV2X3ggKiB2X25leHRfeSAtIHZfcHJldl95ICogdl9uZXh0X3ggKTsKCgkJCQlpZiAoIE1hdGguYWJzKCBjb2xsaW5lYXIwICkgPiBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCQkJLy8gbm90IGNvbGxpbmVhcgoKCQkJCQkvLyBsZW5ndGggb2YgdmVjdG9ycyBmb3Igbm9ybWFsaXppbmcKCgkJCQkJY29uc3Qgdl9wcmV2X2xlbiA9IE1hdGguc3FydCggdl9wcmV2X2xlbnNxICk7CgkJCQkJY29uc3Qgdl9uZXh0X2xlbiA9IE1hdGguc3FydCggdl9uZXh0X3ggKiB2X25leHRfeCArIHZfbmV4dF95ICogdl9uZXh0X3kgKTsKCgkJCQkJLy8gc2hpZnQgYWRqYWNlbnQgcG9pbnRzIGJ5IHVuaXQgdmVjdG9ycyB0byB0aGUgbGVmdAoKCQkJCQljb25zdCBwdFByZXZTaGlmdF94ID0gKCBpblByZXYueCAtIHZfcHJldl95IC8gdl9wcmV2X2xlbiApOwoJCQkJCWNvbnN0IHB0UHJldlNoaWZ0X3kgPSAoIGluUHJldi55ICsgdl9wcmV2X3ggLyB2X3ByZXZfbGVuICk7CgoJCQkJCWNvbnN0IHB0TmV4dFNoaWZ0X3ggPSAoIGluTmV4dC54IC0gdl9uZXh0X3kgLyB2X25leHRfbGVuICk7CgkJCQkJY29uc3QgcHROZXh0U2hpZnRfeSA9ICggaW5OZXh0LnkgKyB2X25leHRfeCAvIHZfbmV4dF9sZW4gKTsKCgkJCQkJLy8gc2NhbGluZyBmYWN0b3IgZm9yIHZfcHJldiB0byBpbnRlcnNlY3Rpb24gcG9pbnQKCgkJCQkJY29uc3Qgc2YgPSAoICggcHROZXh0U2hpZnRfeCAtIHB0UHJldlNoaWZ0X3ggKSAqIHZfbmV4dF95IC0KCQkJCQkJCSggcHROZXh0U2hpZnRfeSAtIHB0UHJldlNoaWZ0X3kgKSAqIHZfbmV4dF94ICkgLwoJCQkJCQkoIHZfcHJldl94ICogdl9uZXh0X3kgLSB2X3ByZXZfeSAqIHZfbmV4dF94ICk7CgoJCQkJCS8vIHZlY3RvciBmcm9tIGluUHQgdG8gaW50ZXJzZWN0aW9uIHBvaW50CgoJCQkJCXZfdHJhbnNfeCA9ICggcHRQcmV2U2hpZnRfeCArIHZfcHJldl94ICogc2YgLSBpblB0LnggKTsKCQkJCQl2X3RyYW5zX3kgPSAoIHB0UHJldlNoaWZ0X3kgKyB2X3ByZXZfeSAqIHNmIC0gaW5QdC55ICk7CgoJCQkJCS8vIERvbid0IG5vcm1hbGl6ZSEsIG90aGVyd2lzZSBzaGFycCBjb3JuZXJzIGJlY29tZSB1Z2x5CgkJCQkJLy8gIGJ1dCBwcmV2ZW50IGNyYXp5IHNwaWtlcwoJCQkJCWNvbnN0IHZfdHJhbnNfbGVuc3EgPSAoIHZfdHJhbnNfeCAqIHZfdHJhbnNfeCArIHZfdHJhbnNfeSAqIHZfdHJhbnNfeSApOwoJCQkJCWlmICggdl90cmFuc19sZW5zcSA8PSAyICkgewoKCQkJCQkJcmV0dXJuIG5ldyBWZWN0b3IyKCB2X3RyYW5zX3gsIHZfdHJhbnNfeSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc2hyaW5rX2J5ID0gTWF0aC5zcXJ0KCB2X3RyYW5zX2xlbnNxIC8gMiApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gaGFuZGxlIHNwZWNpYWwgY2FzZSBvZiBjb2xsaW5lYXIgZWRnZXMKCgkJCQkJbGV0IGRpcmVjdGlvbl9lcSA9IGZhbHNlOyAvLyBhc3N1bWVzOiBvcHBvc2l0ZQoKCQkJCQlpZiAoIHZfcHJldl94ID4gTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkJCQlpZiAoIHZfbmV4dF94ID4gTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkJCQkJZGlyZWN0aW9uX2VxID0gdHJ1ZTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggdl9wcmV2X3ggPCAtIE51bWJlci5FUFNJTE9OICkgewoKCQkJCQkJCWlmICggdl9uZXh0X3ggPCAtIE51bWJlci5FUFNJTE9OICkgewoKCQkJCQkJCQlkaXJlY3Rpb25fZXEgPSB0cnVlOwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJaWYgKCBNYXRoLnNpZ24oIHZfcHJldl95ICkgPT09IE1hdGguc2lnbiggdl9uZXh0X3kgKSApIHsKCgkJCQkJCQkJZGlyZWN0aW9uX2VxID0gdHJ1ZTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJaWYgKCBkaXJlY3Rpb25fZXEgKSB7CgoJCQkJCQkvLyBjb25zb2xlLmxvZygiV2FybmluZzogbGluZXMgYXJlIGEgc3RyYWlnaHQgc2VxdWVuY2UiKTsKCQkJCQkJdl90cmFuc194ID0gLSB2X3ByZXZfeTsKCQkJCQkJdl90cmFuc195ID0gdl9wcmV2X3g7CgkJCQkJCXNocmlua19ieSA9IE1hdGguc3FydCggdl9wcmV2X2xlbnNxICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyBjb25zb2xlLmxvZygiV2FybmluZzogbGluZXMgYXJlIGEgc3RyYWlnaHQgc3Bpa2UiKTsKCQkJCQkJdl90cmFuc194ID0gdl9wcmV2X3g7CgkJCQkJCXZfdHJhbnNfeSA9IHZfcHJldl95OwoJCQkJCQlzaHJpbmtfYnkgPSBNYXRoLnNxcnQoIHZfcHJldl9sZW5zcSAvIDIgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlyZXR1cm4gbmV3IFZlY3RvcjIoIHZfdHJhbnNfeCAvIHNocmlua19ieSwgdl90cmFuc195IC8gc2hyaW5rX2J5ICk7CgoJCQl9CgoKCQkJY29uc3QgY29udG91ck1vdmVtZW50cyA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGNvbnRvdXIubGVuZ3RoLCBqID0gaWwgLSAxLCBrID0gaSArIDE7IGkgPCBpbDsgaSArKywgaiArKywgayArKyApIHsKCgkJCQlpZiAoIGogPT09IGlsICkgaiA9IDA7CgkJCQlpZiAoIGsgPT09IGlsICkgayA9IDA7CgoJCQkJLy8gIChqKS0tLShpKS0tLShrKQoJCQkJLy8gY29uc29sZS5sb2coJ2ksaixrJywgaSwgaiAsIGspCgoJCQkJY29udG91ck1vdmVtZW50c1sgaSBdID0gZ2V0QmV2ZWxWZWMoIGNvbnRvdXJbIGkgXSwgY29udG91clsgaiBdLCBjb250b3VyWyBrIF0gKTsKCgkJCX0KCgkJCWNvbnN0IGhvbGVzTW92ZW1lbnRzID0gW107CgkJCWxldCBvbmVIb2xlTW92ZW1lbnRzLCB2ZXJ0aWNlc01vdmVtZW50cyA9IGNvbnRvdXJNb3ZlbWVudHMuY29uY2F0KCk7CgoJCQlmb3IgKCBsZXQgaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGggKysgKSB7CgoJCQkJY29uc3QgYWhvbGUgPSBob2xlc1sgaCBdOwoKCQkJCW9uZUhvbGVNb3ZlbWVudHMgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYWhvbGUubGVuZ3RoLCBqID0gaWwgLSAxLCBrID0gaSArIDE7IGkgPCBpbDsgaSArKywgaiArKywgayArKyApIHsKCgkJCQkJaWYgKCBqID09PSBpbCApIGogPSAwOwoJCQkJCWlmICggayA9PT0gaWwgKSBrID0gMDsKCgkJCQkJLy8gIChqKS0tLShpKS0tLShrKQoJCQkJCW9uZUhvbGVNb3ZlbWVudHNbIGkgXSA9IGdldEJldmVsVmVjKCBhaG9sZVsgaSBdLCBhaG9sZVsgaiBdLCBhaG9sZVsgayBdICk7CgoJCQkJfQoKCQkJCWhvbGVzTW92ZW1lbnRzLnB1c2goIG9uZUhvbGVNb3ZlbWVudHMgKTsKCQkJCXZlcnRpY2VzTW92ZW1lbnRzID0gdmVydGljZXNNb3ZlbWVudHMuY29uY2F0KCBvbmVIb2xlTW92ZW1lbnRzICk7CgoJCQl9CgoKCQkJLy8gTG9vcCBiZXZlbFNlZ21lbnRzLCAxIGZvciB0aGUgZnJvbnQsIDEgZm9yIHRoZSBiYWNrCgoJCQlmb3IgKCBsZXQgYiA9IDA7IGIgPCBiZXZlbFNlZ21lbnRzOyBiICsrICkgewoKCQkJCS8vZm9yICggYiA9IGJldmVsU2VnbWVudHM7IGIgPiAwOyBiIC0tICkgewoKCQkJCWNvbnN0IHQgPSBiIC8gYmV2ZWxTZWdtZW50czsKCQkJCWNvbnN0IHogPSBiZXZlbFRoaWNrbmVzcyAqIE1hdGguY29zKCB0ICogTWF0aC5QSSAvIDIgKTsKCQkJCWNvbnN0IGJzID0gYmV2ZWxTaXplICogTWF0aC5zaW4oIHQgKiBNYXRoLlBJIC8gMiApICsgYmV2ZWxPZmZzZXQ7CgoJCQkJLy8gY29udHJhY3Qgc2hhcGUKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gY29udG91ci5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJY29uc3QgdmVydCA9IHNjYWxlUHQyKCBjb250b3VyWyBpIF0sIGNvbnRvdXJNb3ZlbWVudHNbIGkgXSwgYnMgKTsKCgkJCQkJdiggdmVydC54LCB2ZXJ0LnksIC0geiApOwoKCQkJCX0KCgkJCQkvLyBleHBhbmQgaG9sZXMKCgkJCQlmb3IgKCBsZXQgaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGggKysgKSB7CgoJCQkJCWNvbnN0IGFob2xlID0gaG9sZXNbIGggXTsKCQkJCQlvbmVIb2xlTW92ZW1lbnRzID0gaG9sZXNNb3ZlbWVudHNbIGggXTsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGFob2xlLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJY29uc3QgdmVydCA9IHNjYWxlUHQyKCBhaG9sZVsgaSBdLCBvbmVIb2xlTW92ZW1lbnRzWyBpIF0sIGJzICk7CgoJCQkJCQl2KCB2ZXJ0LngsIHZlcnQueSwgLSB6ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQljb25zdCBicyA9IGJldmVsU2l6ZSArIGJldmVsT2Zmc2V0OwoKCQkJLy8gQmFjayBmYWNpbmcgdmVydGljZXMKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHZsZW47IGkgKysgKSB7CgoJCQkJY29uc3QgdmVydCA9IGJldmVsRW5hYmxlZCA/IHNjYWxlUHQyKCB2ZXJ0aWNlc1sgaSBdLCB2ZXJ0aWNlc01vdmVtZW50c1sgaSBdLCBicyApIDogdmVydGljZXNbIGkgXTsKCgkJCQlpZiAoICEgZXh0cnVkZUJ5UGF0aCApIHsKCgkJCQkJdiggdmVydC54LCB2ZXJ0LnksIDAgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyB2KCB2ZXJ0LngsIHZlcnQueSArIGV4dHJ1ZGVQdHNbIDAgXS55LCBleHRydWRlUHRzWyAwIF0ueCApOwoKCQkJCQlub3JtYWwuY29weSggc3BsaW5lVHViZS5ub3JtYWxzWyAwIF0gKS5tdWx0aXBseVNjYWxhciggdmVydC54ICk7CgkJCQkJYmlub3JtYWwuY29weSggc3BsaW5lVHViZS5iaW5vcm1hbHNbIDAgXSApLm11bHRpcGx5U2NhbGFyKCB2ZXJ0LnkgKTsKCgkJCQkJcG9zaXRpb24yLmNvcHkoIGV4dHJ1ZGVQdHNbIDAgXSApLmFkZCggbm9ybWFsICkuYWRkKCBiaW5vcm1hbCApOwoKCQkJCQl2KCBwb3NpdGlvbjIueCwgcG9zaXRpb24yLnksIHBvc2l0aW9uMi56ICk7CgoJCQkJfQoKCQkJfQoKCQkJLy8gQWRkIHN0ZXBwZWQgdmVydGljZXMuLi4KCQkJLy8gSW5jbHVkaW5nIGZyb250IGZhY2luZyB2ZXJ0aWNlcwoKCQkJZm9yICggbGV0IHMgPSAxOyBzIDw9IHN0ZXBzOyBzICsrICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHZsZW47IGkgKysgKSB7CgoJCQkJCWNvbnN0IHZlcnQgPSBiZXZlbEVuYWJsZWQgPyBzY2FsZVB0MiggdmVydGljZXNbIGkgXSwgdmVydGljZXNNb3ZlbWVudHNbIGkgXSwgYnMgKSA6IHZlcnRpY2VzWyBpIF07CgoJCQkJCWlmICggISBleHRydWRlQnlQYXRoICkgewoKCQkJCQkJdiggdmVydC54LCB2ZXJ0LnksIGRlcHRoIC8gc3RlcHMgKiBzICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyB2KCB2ZXJ0LngsIHZlcnQueSArIGV4dHJ1ZGVQdHNbIHMgLSAxIF0ueSwgZXh0cnVkZVB0c1sgcyAtIDEgXS54ICk7CgoJCQkJCQlub3JtYWwuY29weSggc3BsaW5lVHViZS5ub3JtYWxzWyBzIF0gKS5tdWx0aXBseVNjYWxhciggdmVydC54ICk7CgkJCQkJCWJpbm9ybWFsLmNvcHkoIHNwbGluZVR1YmUuYmlub3JtYWxzWyBzIF0gKS5tdWx0aXBseVNjYWxhciggdmVydC55ICk7CgoJCQkJCQlwb3NpdGlvbjIuY29weSggZXh0cnVkZVB0c1sgcyBdICkuYWRkKCBub3JtYWwgKS5hZGQoIGJpbm9ybWFsICk7CgoJCQkJCQl2KCBwb3NpdGlvbjIueCwgcG9zaXRpb24yLnksIHBvc2l0aW9uMi56ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoKCQkJLy8gQWRkIGJldmVsIHNlZ21lbnRzIHBsYW5lcwoKCQkJLy9mb3IgKCBiID0gMTsgYiA8PSBiZXZlbFNlZ21lbnRzOyBiICsrICkgewoJCQlmb3IgKCBsZXQgYiA9IGJldmVsU2VnbWVudHMgLSAxOyBiID49IDA7IGIgLS0gKSB7CgoJCQkJY29uc3QgdCA9IGIgLyBiZXZlbFNlZ21lbnRzOwoJCQkJY29uc3QgeiA9IGJldmVsVGhpY2tuZXNzICogTWF0aC5jb3MoIHQgKiBNYXRoLlBJIC8gMiApOwoJCQkJY29uc3QgYnMgPSBiZXZlbFNpemUgKiBNYXRoLnNpbiggdCAqIE1hdGguUEkgLyAyICkgKyBiZXZlbE9mZnNldDsKCgkJCQkvLyBjb250cmFjdCBzaGFwZQoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBjb250b3VyLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQljb25zdCB2ZXJ0ID0gc2NhbGVQdDIoIGNvbnRvdXJbIGkgXSwgY29udG91ck1vdmVtZW50c1sgaSBdLCBicyApOwoJCQkJCXYoIHZlcnQueCwgdmVydC55LCBkZXB0aCArIHogKTsKCgkJCQl9CgoJCQkJLy8gZXhwYW5kIGhvbGVzCgoJCQkJZm9yICggbGV0IGggPSAwLCBobCA9IGhvbGVzLmxlbmd0aDsgaCA8IGhsOyBoICsrICkgewoKCQkJCQljb25zdCBhaG9sZSA9IGhvbGVzWyBoIF07CgkJCQkJb25lSG9sZU1vdmVtZW50cyA9IGhvbGVzTW92ZW1lbnRzWyBoIF07CgoJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBhaG9sZS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCWNvbnN0IHZlcnQgPSBzY2FsZVB0MiggYWhvbGVbIGkgXSwgb25lSG9sZU1vdmVtZW50c1sgaSBdLCBicyApOwoKCQkJCQkJaWYgKCAhIGV4dHJ1ZGVCeVBhdGggKSB7CgoJCQkJCQkJdiggdmVydC54LCB2ZXJ0LnksIGRlcHRoICsgeiApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQl2KCB2ZXJ0LngsIHZlcnQueSArIGV4dHJ1ZGVQdHNbIHN0ZXBzIC0gMSBdLnksIGV4dHJ1ZGVQdHNbIHN0ZXBzIC0gMSBdLnggKyB6ICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQkvKiBGYWNlcyAqLwoKCQkJLy8gVG9wIGFuZCBib3R0b20gZmFjZXMKCgkJCWJ1aWxkTGlkRmFjZXMoKTsKCgkJCS8vIFNpZGVzIGZhY2VzCgoJCQlidWlsZFNpZGVGYWNlcygpOwoKCgkJCS8vLy8vICBJbnRlcm5hbCBmdW5jdGlvbnMKCgkJCWZ1bmN0aW9uIGJ1aWxkTGlkRmFjZXMoKSB7CgoJCQkJY29uc3Qgc3RhcnQgPSB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDM7CgoJCQkJaWYgKCBiZXZlbEVuYWJsZWQgKSB7CgoJCQkJCWxldCBsYXllciA9IDA7IC8vIHN0ZXBzICsgMQoJCQkJCWxldCBvZmZzZXQgPSB2bGVuICogbGF5ZXI7CgoJCQkJCS8vIEJvdHRvbSBmYWNlcwoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBmbGVuOyBpICsrICkgewoKCQkJCQkJY29uc3QgZmFjZSA9IGZhY2VzWyBpIF07CgkJCQkJCWYzKCBmYWNlWyAyIF0gKyBvZmZzZXQsIGZhY2VbIDEgXSArIG9mZnNldCwgZmFjZVsgMCBdICsgb2Zmc2V0ICk7CgoJCQkJCX0KCgkJCQkJbGF5ZXIgPSBzdGVwcyArIGJldmVsU2VnbWVudHMgKiAyOwoJCQkJCW9mZnNldCA9IHZsZW4gKiBsYXllcjsKCgkJCQkJLy8gVG9wIGZhY2VzCgoJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGZsZW47IGkgKysgKSB7CgoJCQkJCQljb25zdCBmYWNlID0gZmFjZXNbIGkgXTsKCQkJCQkJZjMoIGZhY2VbIDAgXSArIG9mZnNldCwgZmFjZVsgMSBdICsgb2Zmc2V0LCBmYWNlWyAyIF0gKyBvZmZzZXQgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIEJvdHRvbSBmYWNlcwoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBmbGVuOyBpICsrICkgewoKCQkJCQkJY29uc3QgZmFjZSA9IGZhY2VzWyBpIF07CgkJCQkJCWYzKCBmYWNlWyAyIF0sIGZhY2VbIDEgXSwgZmFjZVsgMCBdICk7CgoJCQkJCX0KCgkJCQkJLy8gVG9wIGZhY2VzCgoJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGZsZW47IGkgKysgKSB7CgoJCQkJCQljb25zdCBmYWNlID0gZmFjZXNbIGkgXTsKCQkJCQkJZjMoIGZhY2VbIDAgXSArIHZsZW4gKiBzdGVwcywgZmFjZVsgMSBdICsgdmxlbiAqIHN0ZXBzLCBmYWNlWyAyIF0gKyB2bGVuICogc3RlcHMgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlzY29wZS5hZGRHcm91cCggc3RhcnQsIHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMyAtIHN0YXJ0LCAwICk7CgoJCQl9CgoJCQkvLyBDcmVhdGUgZmFjZXMgZm9yIHRoZSB6LXNpZGVzIG9mIHRoZSBzaGFwZQoKCQkJZnVuY3Rpb24gYnVpbGRTaWRlRmFjZXMoKSB7CgoJCQkJY29uc3Qgc3RhcnQgPSB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDM7CgkJCQlsZXQgbGF5ZXJvZmZzZXQgPSAwOwoJCQkJc2lkZXdhbGxzKCBjb250b3VyLCBsYXllcm9mZnNldCApOwoJCQkJbGF5ZXJvZmZzZXQgKz0gY29udG91ci5sZW5ndGg7CgoJCQkJZm9yICggbGV0IGggPSAwLCBobCA9IGhvbGVzLmxlbmd0aDsgaCA8IGhsOyBoICsrICkgewoKCQkJCQljb25zdCBhaG9sZSA9IGhvbGVzWyBoIF07CgkJCQkJc2lkZXdhbGxzKCBhaG9sZSwgbGF5ZXJvZmZzZXQgKTsKCgkJCQkJLy8sIHRydWUKCQkJCQlsYXllcm9mZnNldCArPSBhaG9sZS5sZW5ndGg7CgoJCQkJfQoKCgkJCQlzY29wZS5hZGRHcm91cCggc3RhcnQsIHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMyAtIHN0YXJ0LCAxICk7CgoKCQkJfQoKCQkJZnVuY3Rpb24gc2lkZXdhbGxzKCBjb250b3VyLCBsYXllcm9mZnNldCApIHsKCgkJCQlsZXQgaSA9IGNvbnRvdXIubGVuZ3RoOwoKCQkJCXdoaWxlICggLS0gaSA+PSAwICkgewoKCQkJCQljb25zdCBqID0gaTsKCQkJCQlsZXQgayA9IGkgLSAxOwoJCQkJCWlmICggayA8IDAgKSBrID0gY29udG91ci5sZW5ndGggLSAxOwoKCQkJCQkvL2NvbnNvbGUubG9nKCdiJywgaSxqLCBpLTEsIGssdmVydGljZXMubGVuZ3RoKTsKCgkJCQkJZm9yICggbGV0IHMgPSAwLCBzbCA9ICggc3RlcHMgKyBiZXZlbFNlZ21lbnRzICogMiApOyBzIDwgc2w7IHMgKysgKSB7CgoJCQkJCQljb25zdCBzbGVuMSA9IHZsZW4gKiBzOwoJCQkJCQljb25zdCBzbGVuMiA9IHZsZW4gKiAoIHMgKyAxICk7CgoJCQkJCQljb25zdCBhID0gbGF5ZXJvZmZzZXQgKyBqICsgc2xlbjEsCgkJCQkJCQliID0gbGF5ZXJvZmZzZXQgKyBrICsgc2xlbjEsCgkJCQkJCQljID0gbGF5ZXJvZmZzZXQgKyBrICsgc2xlbjIsCgkJCQkJCQlkID0gbGF5ZXJvZmZzZXQgKyBqICsgc2xlbjI7CgoJCQkJCQlmNCggYSwgYiwgYywgZCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJZnVuY3Rpb24gdiggeCwgeSwgeiApIHsKCgkJCQlwbGFjZWhvbGRlci5wdXNoKCB4ICk7CgkJCQlwbGFjZWhvbGRlci5wdXNoKCB5ICk7CgkJCQlwbGFjZWhvbGRlci5wdXNoKCB6ICk7CgoJCQl9CgoKCQkJZnVuY3Rpb24gZjMoIGEsIGIsIGMgKSB7CgoJCQkJYWRkVmVydGV4KCBhICk7CgkJCQlhZGRWZXJ0ZXgoIGIgKTsKCQkJCWFkZFZlcnRleCggYyApOwoKCQkJCWNvbnN0IG5leHRJbmRleCA9IHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMzsKCQkJCWNvbnN0IHV2cyA9IHV2Z2VuLmdlbmVyYXRlVG9wVVYoIHNjb3BlLCB2ZXJ0aWNlc0FycmF5LCBuZXh0SW5kZXggLSAzLCBuZXh0SW5kZXggLSAyLCBuZXh0SW5kZXggLSAxICk7CgoJCQkJYWRkVVYoIHV2c1sgMCBdICk7CgkJCQlhZGRVViggdXZzWyAxIF0gKTsKCQkJCWFkZFVWKCB1dnNbIDIgXSApOwoKCQkJfQoKCQkJZnVuY3Rpb24gZjQoIGEsIGIsIGMsIGQgKSB7CgoJCQkJYWRkVmVydGV4KCBhICk7CgkJCQlhZGRWZXJ0ZXgoIGIgKTsKCQkJCWFkZFZlcnRleCggZCApOwoKCQkJCWFkZFZlcnRleCggYiApOwoJCQkJYWRkVmVydGV4KCBjICk7CgkJCQlhZGRWZXJ0ZXgoIGQgKTsKCgoJCQkJY29uc3QgbmV4dEluZGV4ID0gdmVydGljZXNBcnJheS5sZW5ndGggLyAzOwoJCQkJY29uc3QgdXZzID0gdXZnZW4uZ2VuZXJhdGVTaWRlV2FsbFVWKCBzY29wZSwgdmVydGljZXNBcnJheSwgbmV4dEluZGV4IC0gNiwgbmV4dEluZGV4IC0gMywgbmV4dEluZGV4IC0gMiwgbmV4dEluZGV4IC0gMSApOwoKCQkJCWFkZFVWKCB1dnNbIDAgXSApOwoJCQkJYWRkVVYoIHV2c1sgMSBdICk7CgkJCQlhZGRVViggdXZzWyAzIF0gKTsKCgkJCQlhZGRVViggdXZzWyAxIF0gKTsKCQkJCWFkZFVWKCB1dnNbIDIgXSApOwoJCQkJYWRkVVYoIHV2c1sgMyBdICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBhZGRWZXJ0ZXgoIGluZGV4ICkgewoKCQkJCXZlcnRpY2VzQXJyYXkucHVzaCggcGxhY2Vob2xkZXJbIGluZGV4ICogMyArIDAgXSApOwoJCQkJdmVydGljZXNBcnJheS5wdXNoKCBwbGFjZWhvbGRlclsgaW5kZXggKiAzICsgMSBdICk7CgkJCQl2ZXJ0aWNlc0FycmF5LnB1c2goIHBsYWNlaG9sZGVyWyBpbmRleCAqIDMgKyAyIF0gKTsKCgkJCX0KCgoJCQlmdW5jdGlvbiBhZGRVViggdmVjdG9yMiApIHsKCgkJCQl1dkFycmF5LnB1c2goIHZlY3RvcjIueCApOwoJCQkJdXZBcnJheS5wdXNoKCB2ZWN0b3IyLnkgKTsKCgkJCX0KCgkJfQoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnBhcmFtZXRlcnMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQljb25zdCBzaGFwZXMgPSB0aGlzLnBhcmFtZXRlcnMuc2hhcGVzOwoJCWNvbnN0IG9wdGlvbnMgPSB0aGlzLnBhcmFtZXRlcnMub3B0aW9uczsKCgkJcmV0dXJuIHRvSlNPTiQxKCBzaGFwZXMsIG9wdGlvbnMsIGRhdGEgKTsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhLCBzaGFwZXMgKSB7CgoJCWNvbnN0IGdlb21ldHJ5U2hhcGVzID0gW107CgoJCWZvciAoIGxldCBqID0gMCwgamwgPSBkYXRhLnNoYXBlcy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCWNvbnN0IHNoYXBlID0gc2hhcGVzWyBkYXRhLnNoYXBlc1sgaiBdIF07CgoJCQlnZW9tZXRyeVNoYXBlcy5wdXNoKCBzaGFwZSApOwoKCQl9CgoJCWNvbnN0IGV4dHJ1ZGVQYXRoID0gZGF0YS5vcHRpb25zLmV4dHJ1ZGVQYXRoOwoKCQlpZiAoIGV4dHJ1ZGVQYXRoICE9PSB1bmRlZmluZWQgKSB7CgoJCQlkYXRhLm9wdGlvbnMuZXh0cnVkZVBhdGggPSBuZXcgQ3VydmVzWyBleHRydWRlUGF0aC50eXBlIF0oKS5mcm9tSlNPTiggZXh0cnVkZVBhdGggKTsKCgkJfQoKCQlyZXR1cm4gbmV3IEV4dHJ1ZGVHZW9tZXRyeSggZ2VvbWV0cnlTaGFwZXMsIGRhdGEub3B0aW9ucyApOwoKCX0KCn0KCmNvbnN0IFdvcmxkVVZHZW5lcmF0b3IgPSB7CgoJZ2VuZXJhdGVUb3BVVjogZnVuY3Rpb24gKCBnZW9tZXRyeSwgdmVydGljZXMsIGluZGV4QSwgaW5kZXhCLCBpbmRleEMgKSB7CgoJCWNvbnN0IGFfeCA9IHZlcnRpY2VzWyBpbmRleEEgKiAzIF07CgkJY29uc3QgYV95ID0gdmVydGljZXNbIGluZGV4QSAqIDMgKyAxIF07CgkJY29uc3QgYl94ID0gdmVydGljZXNbIGluZGV4QiAqIDMgXTsKCQljb25zdCBiX3kgPSB2ZXJ0aWNlc1sgaW5kZXhCICogMyArIDEgXTsKCQljb25zdCBjX3ggPSB2ZXJ0aWNlc1sgaW5kZXhDICogMyBdOwoJCWNvbnN0IGNfeSA9IHZlcnRpY2VzWyBpbmRleEMgKiAzICsgMSBdOwoKCQlyZXR1cm4gWwoJCQluZXcgVmVjdG9yMiggYV94LCBhX3kgKSwKCQkJbmV3IFZlY3RvcjIoIGJfeCwgYl95ICksCgkJCW5ldyBWZWN0b3IyKCBjX3gsIGNfeSApCgkJXTsKCgl9LAoKCWdlbmVyYXRlU2lkZVdhbGxVVjogZnVuY3Rpb24gKCBnZW9tZXRyeSwgdmVydGljZXMsIGluZGV4QSwgaW5kZXhCLCBpbmRleEMsIGluZGV4RCApIHsKCgkJY29uc3QgYV94ID0gdmVydGljZXNbIGluZGV4QSAqIDMgXTsKCQljb25zdCBhX3kgPSB2ZXJ0aWNlc1sgaW5kZXhBICogMyArIDEgXTsKCQljb25zdCBhX3ogPSB2ZXJ0aWNlc1sgaW5kZXhBICogMyArIDIgXTsKCQljb25zdCBiX3ggPSB2ZXJ0aWNlc1sgaW5kZXhCICogMyBdOwoJCWNvbnN0IGJfeSA9IHZlcnRpY2VzWyBpbmRleEIgKiAzICsgMSBdOwoJCWNvbnN0IGJfeiA9IHZlcnRpY2VzWyBpbmRleEIgKiAzICsgMiBdOwoJCWNvbnN0IGNfeCA9IHZlcnRpY2VzWyBpbmRleEMgKiAzIF07CgkJY29uc3QgY195ID0gdmVydGljZXNbIGluZGV4QyAqIDMgKyAxIF07CgkJY29uc3QgY196ID0gdmVydGljZXNbIGluZGV4QyAqIDMgKyAyIF07CgkJY29uc3QgZF94ID0gdmVydGljZXNbIGluZGV4RCAqIDMgXTsKCQljb25zdCBkX3kgPSB2ZXJ0aWNlc1sgaW5kZXhEICogMyArIDEgXTsKCQljb25zdCBkX3ogPSB2ZXJ0aWNlc1sgaW5kZXhEICogMyArIDIgXTsKCgkJaWYgKCBNYXRoLmFicyggYV95IC0gYl95ICkgPCBNYXRoLmFicyggYV94IC0gYl94ICkgKSB7CgoJCQlyZXR1cm4gWwoJCQkJbmV3IFZlY3RvcjIoIGFfeCwgMSAtIGFfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGJfeCwgMSAtIGJfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGNfeCwgMSAtIGNfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGRfeCwgMSAtIGRfeiApCgkJCV07CgoJCX0gZWxzZSB7CgoJCQlyZXR1cm4gWwoJCQkJbmV3IFZlY3RvcjIoIGFfeSwgMSAtIGFfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGJfeSwgMSAtIGJfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGNfeSwgMSAtIGNfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGRfeSwgMSAtIGRfeiApCgkJCV07CgoJCX0KCgl9Cgp9OwoKZnVuY3Rpb24gdG9KU09OJDEoIHNoYXBlcywgb3B0aW9ucywgZGF0YSApIHsKCglkYXRhLnNoYXBlcyA9IFtdOwoKCWlmICggQXJyYXkuaXNBcnJheSggc2hhcGVzICkgKSB7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3Qgc2hhcGUgPSBzaGFwZXNbIGkgXTsKCgkJCWRhdGEuc2hhcGVzLnB1c2goIHNoYXBlLnV1aWQgKTsKCgkJfQoKCX0gZWxzZSB7CgoJCWRhdGEuc2hhcGVzLnB1c2goIHNoYXBlcy51dWlkICk7CgoJfQoKCWRhdGEub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oIHt9LCBvcHRpb25zICk7CgoJaWYgKCBvcHRpb25zLmV4dHJ1ZGVQYXRoICE9PSB1bmRlZmluZWQgKSBkYXRhLm9wdGlvbnMuZXh0cnVkZVBhdGggPSBvcHRpb25zLmV4dHJ1ZGVQYXRoLnRvSlNPTigpOwoKCXJldHVybiBkYXRhOwoKfQoKY2xhc3MgSWNvc2FoZWRyb25HZW9tZXRyeSBleHRlbmRzIFBvbHloZWRyb25HZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIGRldGFpbCA9IDAgKSB7CgoJCWNvbnN0IHQgPSAoIDEgKyBNYXRoLnNxcnQoIDUgKSApIC8gMjsKCgkJY29uc3QgdmVydGljZXMgPSBbCgkJCS0gMSwgdCwgMCwgCTEsIHQsIDAsIAktIDEsIC0gdCwgMCwgCTEsIC0gdCwgMCwKCQkJMCwgLSAxLCB0LCAJMCwgMSwgdCwJMCwgLSAxLCAtIHQsIAkwLCAxLCAtIHQsCgkJCXQsIDAsIC0gMSwgCXQsIDAsIDEsIAktIHQsIDAsIC0gMSwgCS0gdCwgMCwgMQoJCV07CgoJCWNvbnN0IGluZGljZXMgPSBbCgkJCTAsIDExLCA1LCAJMCwgNSwgMSwgCTAsIDEsIDcsIAkwLCA3LCAxMCwgCTAsIDEwLCAxMSwKCQkJMSwgNSwgOSwgCTUsIDExLCA0LAkxMSwgMTAsIDIsCTEwLCA3LCA2LAk3LCAxLCA4LAoJCQkzLCA5LCA0LCAJMywgNCwgMiwJMywgMiwgNiwJMywgNiwgOCwJMywgOCwgOSwKCQkJNCwgOSwgNSwgCTIsIDQsIDExLAk2LCAyLCAxMCwJOCwgNiwgNywJOSwgOCwgMQoJCV07CgoJCXN1cGVyKCB2ZXJ0aWNlcywgaW5kaWNlcywgcmFkaXVzLCBkZXRhaWwgKTsKCgkJdGhpcy50eXBlID0gJ0ljb3NhaGVkcm9uR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQlkZXRhaWw6IGRldGFpbAoJCX07CgoJfQoKCXN0YXRpYyBmcm9tSlNPTiggZGF0YSApIHsKCgkJcmV0dXJuIG5ldyBJY29zYWhlZHJvbkdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS5kZXRhaWwgKTsKCgl9Cgp9CgpjbGFzcyBPY3RhaGVkcm9uR2VvbWV0cnkgZXh0ZW5kcyBQb2x5aGVkcm9uR2VvbWV0cnkgewoKCWNvbnN0cnVjdG9yKCByYWRpdXMgPSAxLCBkZXRhaWwgPSAwICkgewoKCQljb25zdCB2ZXJ0aWNlcyA9IFsKCQkJMSwgMCwgMCwgCS0gMSwgMCwgMCwJMCwgMSwgMCwKCQkJMCwgLSAxLCAwLCAJMCwgMCwgMSwJMCwgMCwgLSAxCgkJXTsKCgkJY29uc3QgaW5kaWNlcyA9IFsKCQkJMCwgMiwgNCwJMCwgNCwgMywJMCwgMywgNSwKCQkJMCwgNSwgMiwJMSwgMiwgNSwJMSwgNSwgMywKCQkJMSwgMywgNCwJMSwgNCwgMgoJCV07CgoJCXN1cGVyKCB2ZXJ0aWNlcywgaW5kaWNlcywgcmFkaXVzLCBkZXRhaWwgKTsKCgkJdGhpcy50eXBlID0gJ09jdGFoZWRyb25HZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCWRldGFpbDogZGV0YWlsCgkJfTsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IE9jdGFoZWRyb25HZW9tZXRyeSggZGF0YS5yYWRpdXMsIGRhdGEuZGV0YWlsICk7CgoJfQoKfQoKY2xhc3MgUmluZ0dlb21ldHJ5IGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewoKCWNvbnN0cnVjdG9yKCBpbm5lclJhZGl1cyA9IDAuNSwgb3V0ZXJSYWRpdXMgPSAxLCB0aGV0YVNlZ21lbnRzID0gMzIsIHBoaVNlZ21lbnRzID0gMSwgdGhldGFTdGFydCA9IDAsIHRoZXRhTGVuZ3RoID0gTWF0aC5QSSAqIDIgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdSaW5nR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCWlubmVyUmFkaXVzOiBpbm5lclJhZGl1cywKCQkJb3V0ZXJSYWRpdXM6IG91dGVyUmFkaXVzLAoJCQl0aGV0YVNlZ21lbnRzOiB0aGV0YVNlZ21lbnRzLAoJCQlwaGlTZWdtZW50czogcGhpU2VnbWVudHMsCgkJCXRoZXRhU3RhcnQ6IHRoZXRhU3RhcnQsCgkJCXRoZXRhTGVuZ3RoOiB0aGV0YUxlbmd0aAoJCX07CgoJCXRoZXRhU2VnbWVudHMgPSBNYXRoLm1heCggMywgdGhldGFTZWdtZW50cyApOwoJCXBoaVNlZ21lbnRzID0gTWF0aC5tYXgoIDEsIHBoaVNlZ21lbnRzICk7CgoJCS8vIGJ1ZmZlcnMKCgkJY29uc3QgaW5kaWNlcyA9IFtdOwoJCWNvbnN0IHZlcnRpY2VzID0gW107CgkJY29uc3Qgbm9ybWFscyA9IFtdOwoJCWNvbnN0IHV2cyA9IFtdOwoKCQkvLyBzb21lIGhlbHBlciB2YXJpYWJsZXMKCgkJbGV0IHJhZGl1cyA9IGlubmVyUmFkaXVzOwoJCWNvbnN0IHJhZGl1c1N0ZXAgPSAoICggb3V0ZXJSYWRpdXMgLSBpbm5lclJhZGl1cyApIC8gcGhpU2VnbWVudHMgKTsKCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IHV2ID0gbmV3IFZlY3RvcjIoKTsKCgkJLy8gZ2VuZXJhdGUgdmVydGljZXMsIG5vcm1hbHMgYW5kIHV2cwoKCQlmb3IgKCBsZXQgaiA9IDA7IGogPD0gcGhpU2VnbWVudHM7IGogKysgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPD0gdGhldGFTZWdtZW50czsgaSArKyApIHsKCgkJCQkvLyB2YWx1ZXMgYXJlIGdlbmVyYXRlIGZyb20gdGhlIGluc2lkZSBvZiB0aGUgcmluZyB0byB0aGUgb3V0c2lkZQoKCQkJCWNvbnN0IHNlZ21lbnQgPSB0aGV0YVN0YXJ0ICsgaSAvIHRoZXRhU2VnbWVudHMgKiB0aGV0YUxlbmd0aDsKCgkJCQkvLyB2ZXJ0ZXgKCgkJCQl2ZXJ0ZXgueCA9IHJhZGl1cyAqIE1hdGguY29zKCBzZWdtZW50ICk7CgkJCQl2ZXJ0ZXgueSA9IHJhZGl1cyAqIE1hdGguc2luKCBzZWdtZW50ICk7CgoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCS8vIG5vcm1hbAoKCQkJCW5vcm1hbHMucHVzaCggMCwgMCwgMSApOwoKCQkJCS8vIHV2CgoJCQkJdXYueCA9ICggdmVydGV4LnggLyBvdXRlclJhZGl1cyArIDEgKSAvIDI7CgkJCQl1di55ID0gKCB2ZXJ0ZXgueSAvIG91dGVyUmFkaXVzICsgMSApIC8gMjsKCgkJCQl1dnMucHVzaCggdXYueCwgdXYueSApOwoKCQkJfQoKCQkJLy8gaW5jcmVhc2UgdGhlIHJhZGl1cyBmb3IgbmV4dCByb3cgb2YgdmVydGljZXMKCgkJCXJhZGl1cyArPSByYWRpdXNTdGVwOwoKCQl9CgoJCS8vIGluZGljZXMKCgkJZm9yICggbGV0IGogPSAwOyBqIDwgcGhpU2VnbWVudHM7IGogKysgKSB7CgoJCQljb25zdCB0aGV0YVNlZ21lbnRMZXZlbCA9IGogKiAoIHRoZXRhU2VnbWVudHMgKyAxICk7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGV0YVNlZ21lbnRzOyBpICsrICkgewoKCQkJCWNvbnN0IHNlZ21lbnQgPSBpICsgdGhldGFTZWdtZW50TGV2ZWw7CgoJCQkJY29uc3QgYSA9IHNlZ21lbnQ7CgkJCQljb25zdCBiID0gc2VnbWVudCArIHRoZXRhU2VnbWVudHMgKyAxOwoJCQkJY29uc3QgYyA9IHNlZ21lbnQgKyB0aGV0YVNlZ21lbnRzICsgMjsKCQkJCWNvbnN0IGQgPSBzZWdtZW50ICsgMTsKCgkJCQkvLyBmYWNlcwoKCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQl9CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgUmluZ0dlb21ldHJ5KCBkYXRhLmlubmVyUmFkaXVzLCBkYXRhLm91dGVyUmFkaXVzLCBkYXRhLnRoZXRhU2VnbWVudHMsIGRhdGEucGhpU2VnbWVudHMsIGRhdGEudGhldGFTdGFydCwgZGF0YS50aGV0YUxlbmd0aCApOwoKCX0KCn0KCmNsYXNzIFNoYXBlR2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHNoYXBlcyA9IG5ldyBTaGFwZSggWyBuZXcgVmVjdG9yMiggMCwgMC41ICksIG5ldyBWZWN0b3IyKCAtIDAuNSwgLSAwLjUgKSwgbmV3IFZlY3RvcjIoIDAuNSwgLSAwLjUgKSBdICksIGN1cnZlU2VnbWVudHMgPSAxMiApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ1NoYXBlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXNoYXBlczogc2hhcGVzLAoJCQljdXJ2ZVNlZ21lbnRzOiBjdXJ2ZVNlZ21lbnRzCgkJfTsKCgkJLy8gYnVmZmVycwoKCQljb25zdCBpbmRpY2VzID0gW107CgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBub3JtYWxzID0gW107CgkJY29uc3QgdXZzID0gW107CgoJCS8vIGhlbHBlciB2YXJpYWJsZXMKCgkJbGV0IGdyb3VwU3RhcnQgPSAwOwoJCWxldCBncm91cENvdW50ID0gMDsKCgkJLy8gYWxsb3cgc2luZ2xlIGFuZCBhcnJheSB2YWx1ZXMgZm9yICJzaGFwZXMiIHBhcmFtZXRlcgoKCQlpZiAoIEFycmF5LmlzQXJyYXkoIHNoYXBlcyApID09PSBmYWxzZSApIHsKCgkJCWFkZFNoYXBlKCBzaGFwZXMgKTsKCgkJfSBlbHNlIHsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHNoYXBlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJYWRkU2hhcGUoIHNoYXBlc1sgaSBdICk7CgoJCQkJdGhpcy5hZGRHcm91cCggZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgaSApOyAvLyBlbmFibGVzIE11bHRpTWF0ZXJpYWwgc3VwcG9ydAoKCQkJCWdyb3VwU3RhcnQgKz0gZ3JvdXBDb3VudDsKCQkJCWdyb3VwQ291bnQgPSAwOwoKCQkJfQoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoKCQkvLyBoZWxwZXIgZnVuY3Rpb25zCgoJCWZ1bmN0aW9uIGFkZFNoYXBlKCBzaGFwZSApIHsKCgkJCWNvbnN0IGluZGV4T2Zmc2V0ID0gdmVydGljZXMubGVuZ3RoIC8gMzsKCQkJY29uc3QgcG9pbnRzID0gc2hhcGUuZXh0cmFjdFBvaW50cyggY3VydmVTZWdtZW50cyApOwoKCQkJbGV0IHNoYXBlVmVydGljZXMgPSBwb2ludHMuc2hhcGU7CgkJCWNvbnN0IHNoYXBlSG9sZXMgPSBwb2ludHMuaG9sZXM7CgoJCQkvLyBjaGVjayBkaXJlY3Rpb24gb2YgdmVydGljZXMKCgkJCWlmICggU2hhcGVVdGlscy5pc0Nsb2NrV2lzZSggc2hhcGVWZXJ0aWNlcyApID09PSBmYWxzZSApIHsKCgkJCQlzaGFwZVZlcnRpY2VzID0gc2hhcGVWZXJ0aWNlcy5yZXZlcnNlKCk7CgoJCQl9CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBzaGFwZUhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3Qgc2hhcGVIb2xlID0gc2hhcGVIb2xlc1sgaSBdOwoKCQkJCWlmICggU2hhcGVVdGlscy5pc0Nsb2NrV2lzZSggc2hhcGVIb2xlICkgPT09IHRydWUgKSB7CgoJCQkJCXNoYXBlSG9sZXNbIGkgXSA9IHNoYXBlSG9sZS5yZXZlcnNlKCk7CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgZmFjZXMgPSBTaGFwZVV0aWxzLnRyaWFuZ3VsYXRlU2hhcGUoIHNoYXBlVmVydGljZXMsIHNoYXBlSG9sZXMgKTsKCgkJCS8vIGpvaW4gdmVydGljZXMgb2YgaW5uZXIgYW5kIG91dGVyIHBhdGhzIHRvIGEgc2luZ2xlIGFycmF5CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBzaGFwZUhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3Qgc2hhcGVIb2xlID0gc2hhcGVIb2xlc1sgaSBdOwoJCQkJc2hhcGVWZXJ0aWNlcyA9IHNoYXBlVmVydGljZXMuY29uY2F0KCBzaGFwZUhvbGUgKTsKCgkJCX0KCgkJCS8vIHZlcnRpY2VzLCBub3JtYWxzLCB1dnMKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlVmVydGljZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCB2ZXJ0ZXggPSBzaGFwZVZlcnRpY2VzWyBpIF07CgoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCAwICk7CgkJCQlub3JtYWxzLnB1c2goIDAsIDAsIDEgKTsKCQkJCXV2cy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnkgKTsgLy8gd29ybGQgdXZzCgoJCQl9CgoJCQkvLyBpbmRpY2VzCgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBmYWNlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IGZhY2UgPSBmYWNlc1sgaSBdOwoKCQkJCWNvbnN0IGEgPSBmYWNlWyAwIF0gKyBpbmRleE9mZnNldDsKCQkJCWNvbnN0IGIgPSBmYWNlWyAxIF0gKyBpbmRleE9mZnNldDsKCQkJCWNvbnN0IGMgPSBmYWNlWyAyIF0gKyBpbmRleE9mZnNldDsKCgkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGMgKTsKCQkJCWdyb3VwQ291bnQgKz0gMzsKCgkJCX0KCgkJfQoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnBhcmFtZXRlcnMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQljb25zdCBzaGFwZXMgPSB0aGlzLnBhcmFtZXRlcnMuc2hhcGVzOwoKCQlyZXR1cm4gdG9KU09OKCBzaGFwZXMsIGRhdGEgKTsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhLCBzaGFwZXMgKSB7CgoJCWNvbnN0IGdlb21ldHJ5U2hhcGVzID0gW107CgoJCWZvciAoIGxldCBqID0gMCwgamwgPSBkYXRhLnNoYXBlcy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCWNvbnN0IHNoYXBlID0gc2hhcGVzWyBkYXRhLnNoYXBlc1sgaiBdIF07CgoJCQlnZW9tZXRyeVNoYXBlcy5wdXNoKCBzaGFwZSApOwoKCQl9CgoJCXJldHVybiBuZXcgU2hhcGVHZW9tZXRyeSggZ2VvbWV0cnlTaGFwZXMsIGRhdGEuY3VydmVTZWdtZW50cyApOwoKCX0KCn0KCmZ1bmN0aW9uIHRvSlNPTiggc2hhcGVzLCBkYXRhICkgewoKCWRhdGEuc2hhcGVzID0gW107CgoJaWYgKCBBcnJheS5pc0FycmF5KCBzaGFwZXMgKSApIHsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gc2hhcGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBzaGFwZSA9IHNoYXBlc1sgaSBdOwoKCQkJZGF0YS5zaGFwZXMucHVzaCggc2hhcGUudXVpZCApOwoKCQl9CgoJfSBlbHNlIHsKCgkJZGF0YS5zaGFwZXMucHVzaCggc2hhcGVzLnV1aWQgKTsKCgl9CgoJcmV0dXJuIGRhdGE7Cgp9CgpjbGFzcyBTcGhlcmVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgd2lkdGhTZWdtZW50cyA9IDMyLCBoZWlnaHRTZWdtZW50cyA9IDE2LCBwaGlTdGFydCA9IDAsIHBoaUxlbmd0aCA9IE1hdGguUEkgKiAyLCB0aGV0YVN0YXJ0ID0gMCwgdGhldGFMZW5ndGggPSBNYXRoLlBJICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnU3BoZXJlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQl3aWR0aFNlZ21lbnRzOiB3aWR0aFNlZ21lbnRzLAoJCQloZWlnaHRTZWdtZW50czogaGVpZ2h0U2VnbWVudHMsCgkJCXBoaVN0YXJ0OiBwaGlTdGFydCwKCQkJcGhpTGVuZ3RoOiBwaGlMZW5ndGgsCgkJCXRoZXRhU3RhcnQ6IHRoZXRhU3RhcnQsCgkJCXRoZXRhTGVuZ3RoOiB0aGV0YUxlbmd0aAoJCX07CgoJCXdpZHRoU2VnbWVudHMgPSBNYXRoLm1heCggMywgTWF0aC5mbG9vciggd2lkdGhTZWdtZW50cyApICk7CgkJaGVpZ2h0U2VnbWVudHMgPSBNYXRoLm1heCggMiwgTWF0aC5mbG9vciggaGVpZ2h0U2VnbWVudHMgKSApOwoKCQljb25zdCB0aGV0YUVuZCA9IE1hdGgubWluKCB0aGV0YVN0YXJ0ICsgdGhldGFMZW5ndGgsIE1hdGguUEkgKTsKCgkJbGV0IGluZGV4ID0gMDsKCQljb25zdCBncmlkID0gW107CgoJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3Qgbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCgkJLy8gYnVmZmVycwoKCQljb25zdCBpbmRpY2VzID0gW107CgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBub3JtYWxzID0gW107CgkJY29uc3QgdXZzID0gW107CgoJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJZm9yICggbGV0IGl5ID0gMDsgaXkgPD0gaGVpZ2h0U2VnbWVudHM7IGl5ICsrICkgewoKCQkJY29uc3QgdmVydGljZXNSb3cgPSBbXTsKCgkJCWNvbnN0IHYgPSBpeSAvIGhlaWdodFNlZ21lbnRzOwoKCQkJLy8gc3BlY2lhbCBjYXNlIGZvciB0aGUgcG9sZXMKCgkJCWxldCB1T2Zmc2V0ID0gMDsKCgkJCWlmICggaXkgPT09IDAgJiYgdGhldGFTdGFydCA9PT0gMCApIHsKCgkJCQl1T2Zmc2V0ID0gMC41IC8gd2lkdGhTZWdtZW50czsKCgkJCX0gZWxzZSBpZiAoIGl5ID09PSBoZWlnaHRTZWdtZW50cyAmJiB0aGV0YUVuZCA9PT0gTWF0aC5QSSApIHsKCgkJCQl1T2Zmc2V0ID0gLSAwLjUgLyB3aWR0aFNlZ21lbnRzOwoKCQkJfQoKCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPD0gd2lkdGhTZWdtZW50czsgaXggKysgKSB7CgoJCQkJY29uc3QgdSA9IGl4IC8gd2lkdGhTZWdtZW50czsKCgkJCQkvLyB2ZXJ0ZXgKCgkJCQl2ZXJ0ZXgueCA9IC0gcmFkaXVzICogTWF0aC5jb3MoIHBoaVN0YXJ0ICsgdSAqIHBoaUxlbmd0aCApICogTWF0aC5zaW4oIHRoZXRhU3RhcnQgKyB2ICogdGhldGFMZW5ndGggKTsKCQkJCXZlcnRleC55ID0gcmFkaXVzICogTWF0aC5jb3MoIHRoZXRhU3RhcnQgKyB2ICogdGhldGFMZW5ndGggKTsKCQkJCXZlcnRleC56ID0gcmFkaXVzICogTWF0aC5zaW4oIHBoaVN0YXJ0ICsgdSAqIHBoaUxlbmd0aCApICogTWF0aC5zaW4oIHRoZXRhU3RhcnQgKyB2ICogdGhldGFMZW5ndGggKTsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkJLy8gbm9ybWFsCgoJCQkJbm9ybWFsLmNvcHkoIHZlcnRleCApLm5vcm1hbGl6ZSgpOwoJCQkJbm9ybWFscy5wdXNoKCBub3JtYWwueCwgbm9ybWFsLnksIG5vcm1hbC56ICk7CgoJCQkJLy8gdXYKCgkJCQl1dnMucHVzaCggdSArIHVPZmZzZXQsIDEgLSB2ICk7CgoJCQkJdmVydGljZXNSb3cucHVzaCggaW5kZXggKysgKTsKCgkJCX0KCgkJCWdyaWQucHVzaCggdmVydGljZXNSb3cgKTsKCgkJfQoKCQkvLyBpbmRpY2VzCgoJCWZvciAoIGxldCBpeSA9IDA7IGl5IDwgaGVpZ2h0U2VnbWVudHM7IGl5ICsrICkgewoKCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCB3aWR0aFNlZ21lbnRzOyBpeCArKyApIHsKCgkJCQljb25zdCBhID0gZ3JpZFsgaXkgXVsgaXggKyAxIF07CgkJCQljb25zdCBiID0gZ3JpZFsgaXkgXVsgaXggXTsKCQkJCWNvbnN0IGMgPSBncmlkWyBpeSArIDEgXVsgaXggXTsKCQkJCWNvbnN0IGQgPSBncmlkWyBpeSArIDEgXVsgaXggKyAxIF07CgoJCQkJaWYgKCBpeSAhPT0gMCB8fCB0aGV0YVN0YXJ0ID4gMCApIGluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaWYgKCBpeSAhPT0gaGVpZ2h0U2VnbWVudHMgLSAxIHx8IHRoZXRhRW5kIDwgTWF0aC5QSSApIGluZGljZXMucHVzaCggYiwgYywgZCApOwoKCQkJfQoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IFNwaGVyZUdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS53aWR0aFNlZ21lbnRzLCBkYXRhLmhlaWdodFNlZ21lbnRzLCBkYXRhLnBoaVN0YXJ0LCBkYXRhLnBoaUxlbmd0aCwgZGF0YS50aGV0YVN0YXJ0LCBkYXRhLnRoZXRhTGVuZ3RoICk7CgoJfQoKfQoKY2xhc3MgVGV0cmFoZWRyb25HZW9tZXRyeSBleHRlbmRzIFBvbHloZWRyb25HZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIGRldGFpbCA9IDAgKSB7CgoJCWNvbnN0IHZlcnRpY2VzID0gWwoJCQkxLCAxLCAxLCAJLSAxLCAtIDEsIDEsIAktIDEsIDEsIC0gMSwgCTEsIC0gMSwgLSAxCgkJXTsKCgkJY29uc3QgaW5kaWNlcyA9IFsKCQkJMiwgMSwgMCwgCTAsIDMsIDIsCTEsIDMsIDAsCTIsIDMsIDEKCQldOwoKCQlzdXBlciggdmVydGljZXMsIGluZGljZXMsIHJhZGl1cywgZGV0YWlsICk7CgoJCXRoaXMudHlwZSA9ICdUZXRyYWhlZHJvbkdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXM6IHJhZGl1cywKCQkJZGV0YWlsOiBkZXRhaWwKCQl9OwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgVGV0cmFoZWRyb25HZW9tZXRyeSggZGF0YS5yYWRpdXMsIGRhdGEuZGV0YWlsICk7CgoJfQoKfQoKY2xhc3MgVG9ydXNHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgdHViZSA9IDAuNCwgcmFkaWFsU2VnbWVudHMgPSAxMiwgdHVidWxhclNlZ21lbnRzID0gNDgsIGFyYyA9IE1hdGguUEkgKiAyICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnVG9ydXNHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCXR1YmU6IHR1YmUsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQkJdHVidWxhclNlZ21lbnRzOiB0dWJ1bGFyU2VnbWVudHMsCgkJCWFyYzogYXJjCgkJfTsKCgkJcmFkaWFsU2VnbWVudHMgPSBNYXRoLmZsb29yKCByYWRpYWxTZWdtZW50cyApOwoJCXR1YnVsYXJTZWdtZW50cyA9IE1hdGguZmxvb3IoIHR1YnVsYXJTZWdtZW50cyApOwoKCQkvLyBidWZmZXJzCgoJCWNvbnN0IGluZGljZXMgPSBbXTsKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQljb25zdCBjZW50ZXIgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3Qgbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCgkJLy8gZ2VuZXJhdGUgdmVydGljZXMsIG5vcm1hbHMgYW5kIHV2cwoKCQlmb3IgKCBsZXQgaiA9IDA7IGogPD0gcmFkaWFsU2VnbWVudHM7IGogKysgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpICsrICkgewoKCQkJCWNvbnN0IHUgPSBpIC8gdHVidWxhclNlZ21lbnRzICogYXJjOwoJCQkJY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRleC54ID0gKCByYWRpdXMgKyB0dWJlICogTWF0aC5jb3MoIHYgKSApICogTWF0aC5jb3MoIHUgKTsKCQkJCXZlcnRleC55ID0gKCByYWRpdXMgKyB0dWJlICogTWF0aC5jb3MoIHYgKSApICogTWF0aC5zaW4oIHUgKTsKCQkJCXZlcnRleC56ID0gdHViZSAqIE1hdGguc2luKCB2ICk7CgoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCS8vIG5vcm1hbAoKCQkJCWNlbnRlci54ID0gcmFkaXVzICogTWF0aC5jb3MoIHUgKTsKCQkJCWNlbnRlci55ID0gcmFkaXVzICogTWF0aC5zaW4oIHUgKTsKCQkJCW5vcm1hbC5zdWJWZWN0b3JzKCB2ZXJ0ZXgsIGNlbnRlciApLm5vcm1hbGl6ZSgpOwoKCQkJCW5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCS8vIHV2CgoJCQkJdXZzLnB1c2goIGkgLyB0dWJ1bGFyU2VnbWVudHMgKTsKCQkJCXV2cy5wdXNoKCBqIC8gcmFkaWFsU2VnbWVudHMgKTsKCgkJCX0KCgkJfQoKCQkvLyBnZW5lcmF0ZSBpbmRpY2VzCgoJCWZvciAoIGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaiArKyApIHsKCgkJCWZvciAoIGxldCBpID0gMTsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkgKysgKSB7CgoJCQkJLy8gaW5kaWNlcwoKCQkJCWNvbnN0IGEgPSAoIHR1YnVsYXJTZWdtZW50cyArIDEgKSAqIGogKyBpIC0gMTsKCQkJCWNvbnN0IGIgPSAoIHR1YnVsYXJTZWdtZW50cyArIDEgKSAqICggaiAtIDEgKSArIGkgLSAxOwoJCQkJY29uc3QgYyA9ICggdHVidWxhclNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgaTsKCQkJCWNvbnN0IGQgPSAoIHR1YnVsYXJTZWdtZW50cyArIDEgKSAqIGogKyBpOwoKCQkJCS8vIGZhY2VzCgoJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQlpbmRpY2VzLnB1c2goIGIsIGMsIGQgKTsKCgkJCX0KCgkJfQoKCQkvLyBidWlsZCBnZW9tZXRyeQoKCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnBhcmFtZXRlcnMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN0YXRpYyBmcm9tSlNPTiggZGF0YSApIHsKCgkJcmV0dXJuIG5ldyBUb3J1c0dlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS50dWJlLCBkYXRhLnJhZGlhbFNlZ21lbnRzLCBkYXRhLnR1YnVsYXJTZWdtZW50cywgZGF0YS5hcmMgKTsKCgl9Cgp9CgpjbGFzcyBUb3J1c0tub3RHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgdHViZSA9IDAuNCwgdHVidWxhclNlZ21lbnRzID0gNjQsIHJhZGlhbFNlZ21lbnRzID0gOCwgcCA9IDIsIHEgPSAzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnVG9ydXNLbm90R2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQl0dWJlOiB0dWJlLAoJCQl0dWJ1bGFyU2VnbWVudHM6IHR1YnVsYXJTZWdtZW50cywKCQkJcmFkaWFsU2VnbWVudHM6IHJhZGlhbFNlZ21lbnRzLAoJCQlwOiBwLAoJCQlxOiBxCgkJfTsKCgkJdHVidWxhclNlZ21lbnRzID0gTWF0aC5mbG9vciggdHVidWxhclNlZ21lbnRzICk7CgkJcmFkaWFsU2VnbWVudHMgPSBNYXRoLmZsb29yKCByYWRpYWxTZWdtZW50cyApOwoKCQkvLyBidWZmZXJzCgoJCWNvbnN0IGluZGljZXMgPSBbXTsKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgoJCWNvbnN0IFAxID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCBQMiA9IG5ldyBWZWN0b3IzKCk7CgoJCWNvbnN0IEIgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IFQgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IE4gPSBuZXcgVmVjdG9yMygpOwoKCQkvLyBnZW5lcmF0ZSB2ZXJ0aWNlcywgbm9ybWFscyBhbmQgdXZzCgoJCWZvciAoIGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7ICsrIGkgKSB7CgoJCQkvLyB0aGUgcmFkaWFuICJ1IiBpcyB1c2VkIHRvIGNhbGN1bGF0ZSB0aGUgcG9zaXRpb24gb24gdGhlIHRvcnVzIGN1cnZlIG9mIHRoZSBjdXJyZW50IHR1YnVsYXIgc2VnbWVudAoKCQkJY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBwICogTWF0aC5QSSAqIDI7CgoJCQkvLyBub3cgd2UgY2FsY3VsYXRlIHR3byBwb2ludHMuIFAxIGlzIG91ciBjdXJyZW50IHBvc2l0aW9uIG9uIHRoZSBjdXJ2ZSwgUDIgaXMgYSBsaXR0bGUgZmFydGhlciBhaGVhZC4KCQkJLy8gdGhlc2UgcG9pbnRzIGFyZSB1c2VkIHRvIGNyZWF0ZSBhIHNwZWNpYWwgImNvb3JkaW5hdGUgc3BhY2UiLCB3aGljaCBpcyBuZWNlc3NhcnkgdG8gY2FsY3VsYXRlIHRoZSBjb3JyZWN0IHZlcnRleCBwb3NpdGlvbnMKCgkJCWNhbGN1bGF0ZVBvc2l0aW9uT25DdXJ2ZSggdSwgcCwgcSwgcmFkaXVzLCBQMSApOwoJCQljYWxjdWxhdGVQb3NpdGlvbk9uQ3VydmUoIHUgKyAwLjAxLCBwLCBxLCByYWRpdXMsIFAyICk7CgoJCQkvLyBjYWxjdWxhdGUgb3J0aG9ub3JtYWwgYmFzaXMKCgkJCVQuc3ViVmVjdG9ycyggUDIsIFAxICk7CgkJCU4uYWRkVmVjdG9ycyggUDIsIFAxICk7CgkJCUIuY3Jvc3NWZWN0b3JzKCBULCBOICk7CgkJCU4uY3Jvc3NWZWN0b3JzKCBCLCBUICk7CgoJCQkvLyBub3JtYWxpemUgQiwgTi4gVCBjYW4gYmUgaWdub3JlZCwgd2UgZG9uJ3QgdXNlIGl0CgoJCQlCLm5vcm1hbGl6ZSgpOwoJCQlOLm5vcm1hbGl6ZSgpOwoKCQkJZm9yICggbGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyArKyBqICkgewoKCQkJCS8vIG5vdyBjYWxjdWxhdGUgdGhlIHZlcnRpY2VzLiB0aGV5IGFyZSBub3RoaW5nIG1vcmUgdGhhbiBhbiBleHRydXNpb24gb2YgdGhlIHRvcnVzIGN1cnZlLgoJCQkJLy8gYmVjYXVzZSB3ZSBleHRydWRlIGEgc2hhcGUgaW4gdGhlIHh5LXBsYW5lLCB0aGVyZSBpcyBubyBuZWVkIHRvIGNhbGN1bGF0ZSBhIHotdmFsdWUuCgoJCQkJY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwoJCQkJY29uc3QgY3ggPSAtIHR1YmUgKiBNYXRoLmNvcyggdiApOwoJCQkJY29uc3QgY3kgPSB0dWJlICogTWF0aC5zaW4oIHYgKTsKCgkJCQkvLyBub3cgY2FsY3VsYXRlIHRoZSBmaW5hbCB2ZXJ0ZXggcG9zaXRpb24uCgkJCQkvLyBmaXJzdCB3ZSBvcmllbnQgdGhlIGV4dHJ1c2lvbiB3aXRoIG91ciBiYXNpcyB2ZWN0b3JzLCB0aGVuIHdlIGFkZCBpdCB0byB0aGUgY3VycmVudCBwb3NpdGlvbiBvbiB0aGUgY3VydmUKCgkJCQl2ZXJ0ZXgueCA9IFAxLnggKyAoIGN4ICogTi54ICsgY3kgKiBCLnggKTsKCQkJCXZlcnRleC55ID0gUDEueSArICggY3ggKiBOLnkgKyBjeSAqIEIueSApOwoJCQkJdmVydGV4LnogPSBQMS56ICsgKCBjeCAqIE4ueiArIGN5ICogQi56ICk7CgoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCS8vIG5vcm1hbCAoUDEgaXMgYWx3YXlzIHRoZSBjZW50ZXIvb3JpZ2luIG9mIHRoZSBleHRydXNpb24sIHRodXMgd2UgY2FuIHVzZSBpdCB0byBjYWxjdWxhdGUgdGhlIG5vcm1hbCkKCgkJCQlub3JtYWwuc3ViVmVjdG9ycyggdmVydGV4LCBQMSApLm5vcm1hbGl6ZSgpOwoKCQkJCW5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCS8vIHV2CgoJCQkJdXZzLnB1c2goIGkgLyB0dWJ1bGFyU2VnbWVudHMgKTsKCQkJCXV2cy5wdXNoKCBqIC8gcmFkaWFsU2VnbWVudHMgKTsKCgkJCX0KCgkJfQoKCQkvLyBnZW5lcmF0ZSBpbmRpY2VzCgoJCWZvciAoIGxldCBqID0gMTsgaiA8PSB0dWJ1bGFyU2VnbWVudHM7IGogKysgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDE7IGkgPD0gcmFkaWFsU2VnbWVudHM7IGkgKysgKSB7CgoJCQkJLy8gaW5kaWNlcwoKCQkJCWNvbnN0IGEgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgKCBpIC0gMSApOwoJCQkJY29uc3QgYiA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiBqICsgKCBpIC0gMSApOwoJCQkJY29uc3QgYyA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiBqICsgaTsKCQkJCWNvbnN0IGQgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgaTsKCgkJCQkvLyBmYWNlcwoKCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQl9CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgkJLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIHRoZSBjdXJyZW50IHBvc2l0aW9uIG9uIHRoZSB0b3J1cyBjdXJ2ZQoKCQlmdW5jdGlvbiBjYWxjdWxhdGVQb3NpdGlvbk9uQ3VydmUoIHUsIHAsIHEsIHJhZGl1cywgcG9zaXRpb24gKSB7CgoJCQljb25zdCBjdSA9IE1hdGguY29zKCB1ICk7CgkJCWNvbnN0IHN1ID0gTWF0aC5zaW4oIHUgKTsKCQkJY29uc3QgcXVPdmVyUCA9IHEgLyBwICogdTsKCQkJY29uc3QgY3MgPSBNYXRoLmNvcyggcXVPdmVyUCApOwoKCQkJcG9zaXRpb24ueCA9IHJhZGl1cyAqICggMiArIGNzICkgKiAwLjUgKiBjdTsKCQkJcG9zaXRpb24ueSA9IHJhZGl1cyAqICggMiArIGNzICkgKiBzdSAqIDAuNTsKCQkJcG9zaXRpb24ueiA9IHJhZGl1cyAqIE1hdGguc2luKCBxdU92ZXJQICkgKiAwLjU7CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgVG9ydXNLbm90R2VvbWV0cnkoIGRhdGEucmFkaXVzLCBkYXRhLnR1YmUsIGRhdGEudHVidWxhclNlZ21lbnRzLCBkYXRhLnJhZGlhbFNlZ21lbnRzLCBkYXRhLnAsIGRhdGEucSApOwoKCX0KCn0KCmNsYXNzIFR1YmVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcGF0aCA9IG5ldyBRdWFkcmF0aWNCZXppZXJDdXJ2ZTMoIG5ldyBWZWN0b3IzKCAtIDEsIC0gMSwgMCApLCBuZXcgVmVjdG9yMyggLSAxLCAxLCAwICksIG5ldyBWZWN0b3IzKCAxLCAxLCAwICkgKSwgdHVidWxhclNlZ21lbnRzID0gNjQsIHJhZGl1cyA9IDEsIHJhZGlhbFNlZ21lbnRzID0gOCwgY2xvc2VkID0gZmFsc2UgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdUdWJlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXBhdGg6IHBhdGgsCgkJCXR1YnVsYXJTZWdtZW50czogdHVidWxhclNlZ21lbnRzLAoJCQlyYWRpdXM6IHJhZGl1cywKCQkJcmFkaWFsU2VnbWVudHM6IHJhZGlhbFNlZ21lbnRzLAoJCQljbG9zZWQ6IGNsb3NlZAoJCX07CgoJCWNvbnN0IGZyYW1lcyA9IHBhdGguY29tcHV0ZUZyZW5ldEZyYW1lcyggdHVidWxhclNlZ21lbnRzLCBjbG9zZWQgKTsKCgkJLy8gZXhwb3NlIGludGVybmFscwoKCQl0aGlzLnRhbmdlbnRzID0gZnJhbWVzLnRhbmdlbnRzOwoJCXRoaXMubm9ybWFscyA9IGZyYW1lcy5ub3JtYWxzOwoJCXRoaXMuYmlub3JtYWxzID0gZnJhbWVzLmJpbm9ybWFsczsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3QgdXYgPSBuZXcgVmVjdG9yMigpOwoJCWxldCBQID0gbmV3IFZlY3RvcjMoKTsKCgkJLy8gYnVmZmVyCgoJCWNvbnN0IHZlcnRpY2VzID0gW107CgkJY29uc3Qgbm9ybWFscyA9IFtdOwoJCWNvbnN0IHV2cyA9IFtdOwoJCWNvbnN0IGluZGljZXMgPSBbXTsKCgkJLy8gY3JlYXRlIGJ1ZmZlciBkYXRhCgoJCWdlbmVyYXRlQnVmZmVyRGF0YSgpOwoKCQkvLyBidWlsZCBnZW9tZXRyeQoKCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKCQkvLyBmdW5jdGlvbnMKCgkJZnVuY3Rpb24gZ2VuZXJhdGVCdWZmZXJEYXRhKCkgewoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdHVidWxhclNlZ21lbnRzOyBpICsrICkgewoKCQkJCWdlbmVyYXRlU2VnbWVudCggaSApOwoKCQkJfQoKCQkJLy8gaWYgdGhlIGdlb21ldHJ5IGlzIG5vdCBjbG9zZWQsIGdlbmVyYXRlIHRoZSBsYXN0IHJvdyBvZiB2ZXJ0aWNlcyBhbmQgbm9ybWFscwoJCQkvLyBhdCB0aGUgcmVndWxhciBwb3NpdGlvbiBvbiB0aGUgZ2l2ZW4gcGF0aAoJCQkvLwoJCQkvLyBpZiB0aGUgZ2VvbWV0cnkgaXMgY2xvc2VkLCBkdXBsaWNhdGUgdGhlIGZpcnN0IHJvdyBvZiB2ZXJ0aWNlcyBhbmQgbm9ybWFscyAodXZzIHdpbGwgZGlmZmVyKQoKCQkJZ2VuZXJhdGVTZWdtZW50KCAoIGNsb3NlZCA9PT0gZmFsc2UgKSA/IHR1YnVsYXJTZWdtZW50cyA6IDAgKTsKCgkJCS8vIHV2cyBhcmUgZ2VuZXJhdGVkIGluIGEgc2VwYXJhdGUgZnVuY3Rpb24uCgkJCS8vIHRoaXMgbWFrZXMgaXQgZWFzeSBjb21wdXRlIGNvcnJlY3QgdmFsdWVzIGZvciBjbG9zZWQgZ2VvbWV0cmllcwoKCQkJZ2VuZXJhdGVVVnMoKTsKCgkJCS8vIGZpbmFsbHkgY3JlYXRlIGZhY2VzCgoJCQlnZW5lcmF0ZUluZGljZXMoKTsKCgkJfQoKCQlmdW5jdGlvbiBnZW5lcmF0ZVNlZ21lbnQoIGkgKSB7CgoJCQkvLyB3ZSB1c2UgZ2V0UG9pbnRBdCB0byBzYW1wbGUgZXZlbmx5IGRpc3RyaWJ1dGVkIHBvaW50cyBmcm9tIHRoZSBnaXZlbiBwYXRoCgoJCQlQID0gcGF0aC5nZXRQb2ludEF0KCBpIC8gdHVidWxhclNlZ21lbnRzLCBQICk7CgoJCQkvLyByZXRyaWV2ZSBjb3JyZXNwb25kaW5nIG5vcm1hbCBhbmQgYmlub3JtYWwKCgkJCWNvbnN0IE4gPSBmcmFtZXMubm9ybWFsc1sgaSBdOwoJCQljb25zdCBCID0gZnJhbWVzLmJpbm9ybWFsc1sgaSBdOwoKCQkJLy8gZ2VuZXJhdGUgbm9ybWFscyBhbmQgdmVydGljZXMgZm9yIHRoZSBjdXJyZW50IHNlZ21lbnQKCgkJCWZvciAoIGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaiArKyApIHsKCgkJCQljb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CgoJCQkJY29uc3Qgc2luID0gTWF0aC5zaW4oIHYgKTsKCQkJCWNvbnN0IGNvcyA9IC0gTWF0aC5jb3MoIHYgKTsKCgkJCQkvLyBub3JtYWwKCgkJCQlub3JtYWwueCA9ICggY29zICogTi54ICsgc2luICogQi54ICk7CgkJCQlub3JtYWwueSA9ICggY29zICogTi55ICsgc2luICogQi55ICk7CgkJCQlub3JtYWwueiA9ICggY29zICogTi56ICsgc2luICogQi56ICk7CgkJCQlub3JtYWwubm9ybWFsaXplKCk7CgoJCQkJbm9ybWFscy5wdXNoKCBub3JtYWwueCwgbm9ybWFsLnksIG5vcm1hbC56ICk7CgoJCQkJLy8gdmVydGV4CgoJCQkJdmVydGV4LnggPSBQLnggKyByYWRpdXMgKiBub3JtYWwueDsKCQkJCXZlcnRleC55ID0gUC55ICsgcmFkaXVzICogbm9ybWFsLnk7CgkJCQl2ZXJ0ZXgueiA9IFAueiArIHJhZGl1cyAqIG5vcm1hbC56OwoKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBnZW5lcmF0ZUluZGljZXMoKSB7CgoJCQlmb3IgKCBsZXQgaiA9IDE7IGogPD0gdHVidWxhclNlZ21lbnRzOyBqICsrICkgewoKCQkJCWZvciAoIGxldCBpID0gMTsgaSA8PSByYWRpYWxTZWdtZW50czsgaSArKyApIHsKCgkJCQkJY29uc3QgYSA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiAoIGogLSAxICkgKyAoIGkgLSAxICk7CgkJCQkJY29uc3QgYiA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiBqICsgKCBpIC0gMSApOwoJCQkJCWNvbnN0IGMgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogaiArIGk7CgkJCQkJY29uc3QgZCA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiAoIGogLSAxICkgKyBpOwoKCQkJCQkvLyBmYWNlcwoKCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKCQkJCQlpbmRpY2VzLnB1c2goIGIsIGMsIGQgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZ2VuZXJhdGVVVnMoKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpICsrICkgewoKCQkJCWZvciAoIGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaiArKyApIHsKCgkJCQkJdXYueCA9IGkgLyB0dWJ1bGFyU2VnbWVudHM7CgkJCQkJdXYueSA9IGogLyByYWRpYWxTZWdtZW50czsKCgkJCQkJdXZzLnB1c2goIHV2LngsIHV2LnkgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS5wYXRoID0gdGhpcy5wYXJhbWV0ZXJzLnBhdGgudG9KU09OKCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCS8vIFRoaXMgb25seSB3b3JrcyBmb3IgYnVpbHQtaW4gY3VydmVzIChlLmcuIENhdG11bGxSb21DdXJ2ZTMpLgoJCS8vIFVzZXIgZGVmaW5lZCBjdXJ2ZXMgb3IgaW5zdGFuY2VzIG9mIEN1cnZlUGF0aCB3aWxsIG5vdCBiZSBkZXNlcmlhbGl6ZWQuCgkJcmV0dXJuIG5ldyBUdWJlR2VvbWV0cnkoCgkJCW5ldyBDdXJ2ZXNbIGRhdGEucGF0aC50eXBlIF0oKS5mcm9tSlNPTiggZGF0YS5wYXRoICksCgkJCWRhdGEudHVidWxhclNlZ21lbnRzLAoJCQlkYXRhLnJhZGl1cywKCQkJZGF0YS5yYWRpYWxTZWdtZW50cywKCQkJZGF0YS5jbG9zZWQKCQkpOwoKCX0KCn0KCmNsYXNzIFdpcmVmcmFtZUdlb21ldHJ5IGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewoKCWNvbnN0cnVjdG9yKCBnZW9tZXRyeSA9IG51bGwgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdXaXJlZnJhbWVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJZ2VvbWV0cnk6IGdlb21ldHJ5CgkJfTsKCgkJaWYgKCBnZW9tZXRyeSAhPT0gbnVsbCApIHsKCgkJCS8vIGJ1ZmZlcgoKCQkJY29uc3QgdmVydGljZXMgPSBbXTsKCQkJY29uc3QgZWRnZXMgPSBuZXcgU2V0KCk7CgoJCQkvLyBoZWxwZXIgdmFyaWFibGVzCgoJCQljb25zdCBzdGFydCA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IGVuZCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlpZiAoIGdlb21ldHJ5LmluZGV4ICE9PSBudWxsICkgewoKCQkJCS8vIGluZGV4ZWQgQnVmZmVyR2VvbWV0cnkKCgkJCQljb25zdCBwb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgkJCQljb25zdCBpbmRpY2VzID0gZ2VvbWV0cnkuaW5kZXg7CgkJCQlsZXQgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoKCQkJCWlmICggZ3JvdXBzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQkJZ3JvdXBzID0gWyB7IHN0YXJ0OiAwLCBjb3VudDogaW5kaWNlcy5jb3VudCwgbWF0ZXJpYWxJbmRleDogMCB9IF07CgoJCQkJfQoKCQkJCS8vIGNyZWF0ZSBhIGRhdGEgc3RydWN0dXJlIHRoYXQgY29udGFpbnMgYWxsIGVkZ2VzIHdpdGhvdXQgZHVwbGljYXRlcwoKCQkJCWZvciAoIGxldCBvID0gMCwgb2wgPSBncm91cHMubGVuZ3RoOyBvIDwgb2w7ICsrIG8gKSB7CgoJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBvIF07CgoJCQkJCWNvbnN0IGdyb3VwU3RhcnQgPSBncm91cC5zdGFydDsKCQkJCQljb25zdCBncm91cENvdW50ID0gZ3JvdXAuY291bnQ7CgoJCQkJCWZvciAoIGxldCBpID0gZ3JvdXBTdGFydCwgbCA9ICggZ3JvdXBTdGFydCArIGdyb3VwQ291bnQgKTsgaSA8IGw7IGkgKz0gMyApIHsKCgkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IDM7IGogKysgKSB7CgoJCQkJCQkJY29uc3QgaW5kZXgxID0gaW5kaWNlcy5nZXRYKCBpICsgaiApOwoJCQkJCQkJY29uc3QgaW5kZXgyID0gaW5kaWNlcy5nZXRYKCBpICsgKCBqICsgMSApICUgMyApOwoKCQkJCQkJCXN0YXJ0LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBpbmRleDEgKTsKCQkJCQkJCWVuZC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgaW5kZXgyICk7CgoJCQkJCQkJaWYgKCBpc1VuaXF1ZUVkZ2UoIHN0YXJ0LCBlbmQsIGVkZ2VzICkgPT09IHRydWUgKSB7CgoJCQkJCQkJCXZlcnRpY2VzLnB1c2goIHN0YXJ0LngsIHN0YXJ0LnksIHN0YXJ0LnogKTsKCQkJCQkJCQl2ZXJ0aWNlcy5wdXNoKCBlbmQueCwgZW5kLnksIGVuZC56ICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQkvLyBub24taW5kZXhlZCBCdWZmZXJHZW9tZXRyeQoKCQkJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSAoIHBvc2l0aW9uLmNvdW50IC8gMyApOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgMzsgaiArKyApIHsKCgkJCQkJCS8vIHRocmVlIGVkZ2VzIHBlciB0cmlhbmdsZSwgYW4gZWRnZSBpcyByZXByZXNlbnRlZCBhcyAoaW5kZXgxLCBpbmRleDIpCgkJCQkJCS8vIGUuZy4gdGhlIGZpcnN0IHRyaWFuZ2xlIGhhcyB0aGUgZm9sbG93aW5nIGVkZ2VzOiAoMCwxKSwoMSwyKSwoMiwwKQoKCQkJCQkJY29uc3QgaW5kZXgxID0gMyAqIGkgKyBqOwoJCQkJCQljb25zdCBpbmRleDIgPSAzICogaSArICggKCBqICsgMSApICUgMyApOwoKCQkJCQkJc3RhcnQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGluZGV4MSApOwoJCQkJCQllbmQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGluZGV4MiApOwoKCQkJCQkJaWYgKCBpc1VuaXF1ZUVkZ2UoIHN0YXJ0LCBlbmQsIGVkZ2VzICkgPT09IHRydWUgKSB7CgoJCQkJCQkJdmVydGljZXMucHVzaCggc3RhcnQueCwgc3RhcnQueSwgc3RhcnQueiApOwoJCQkJCQkJdmVydGljZXMucHVzaCggZW5kLngsIGVuZC55LCBlbmQueiApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoKCQl9CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpmdW5jdGlvbiBpc1VuaXF1ZUVkZ2UoIHN0YXJ0LCBlbmQsIGVkZ2VzICkgewoKCWNvbnN0IGhhc2gxID0gYCR7c3RhcnQueH0sJHtzdGFydC55fSwke3N0YXJ0Lnp9LSR7ZW5kLnh9LCR7ZW5kLnl9LCR7ZW5kLnp9YDsKCWNvbnN0IGhhc2gyID0gYCR7ZW5kLnh9LCR7ZW5kLnl9LCR7ZW5kLnp9LSR7c3RhcnQueH0sJHtzdGFydC55fSwke3N0YXJ0Lnp9YDsgLy8gY29pbmNpZGVudCBlZGdlCgoJaWYgKCBlZGdlcy5oYXMoIGhhc2gxICkgPT09IHRydWUgfHwgZWRnZXMuaGFzKCBoYXNoMiApID09PSB0cnVlICkgewoKCQlyZXR1cm4gZmFsc2U7CgoJfSBlbHNlIHsKCgkJZWRnZXMuYWRkKCBoYXNoMSApOwoJCWVkZ2VzLmFkZCggaGFzaDIgKTsKCQlyZXR1cm4gdHJ1ZTsKCgl9Cgp9Cgp2YXIgR2VvbWV0cmllcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCV9fcHJvdG9fXzogbnVsbCwKCUJveEdlb21ldHJ5OiBCb3hHZW9tZXRyeSwKCUNhcHN1bGVHZW9tZXRyeTogQ2Fwc3VsZUdlb21ldHJ5LAoJQ2lyY2xlR2VvbWV0cnk6IENpcmNsZUdlb21ldHJ5LAoJQ29uZUdlb21ldHJ5OiBDb25lR2VvbWV0cnksCglDeWxpbmRlckdlb21ldHJ5OiBDeWxpbmRlckdlb21ldHJ5LAoJRG9kZWNhaGVkcm9uR2VvbWV0cnk6IERvZGVjYWhlZHJvbkdlb21ldHJ5LAoJRWRnZXNHZW9tZXRyeTogRWRnZXNHZW9tZXRyeSwKCUV4dHJ1ZGVHZW9tZXRyeTogRXh0cnVkZUdlb21ldHJ5LAoJSWNvc2FoZWRyb25HZW9tZXRyeTogSWNvc2FoZWRyb25HZW9tZXRyeSwKCUxhdGhlR2VvbWV0cnk6IExhdGhlR2VvbWV0cnksCglPY3RhaGVkcm9uR2VvbWV0cnk6IE9jdGFoZWRyb25HZW9tZXRyeSwKCVBsYW5lR2VvbWV0cnk6IFBsYW5lR2VvbWV0cnksCglQb2x5aGVkcm9uR2VvbWV0cnk6IFBvbHloZWRyb25HZW9tZXRyeSwKCVJpbmdHZW9tZXRyeTogUmluZ0dlb21ldHJ5LAoJU2hhcGVHZW9tZXRyeTogU2hhcGVHZW9tZXRyeSwKCVNwaGVyZUdlb21ldHJ5OiBTcGhlcmVHZW9tZXRyeSwKCVRldHJhaGVkcm9uR2VvbWV0cnk6IFRldHJhaGVkcm9uR2VvbWV0cnksCglUb3J1c0dlb21ldHJ5OiBUb3J1c0dlb21ldHJ5LAoJVG9ydXNLbm90R2VvbWV0cnk6IFRvcnVzS25vdEdlb21ldHJ5LAoJVHViZUdlb21ldHJ5OiBUdWJlR2VvbWV0cnksCglXaXJlZnJhbWVHZW9tZXRyeTogV2lyZWZyYW1lR2VvbWV0cnkKfSk7CgpjbGFzcyBTaGFkb3dNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1NoYWRvd01hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1NoYWRvd01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQl0aGlzLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFJhd1NoYWRlck1hdGVyaWFsIGV4dGVuZHMgU2hhZGVyTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlciggcGFyYW1ldGVycyApOwoKCQl0aGlzLmlzUmF3U2hhZGVyTWF0ZXJpYWwgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUmF3U2hhZGVyTWF0ZXJpYWwnOwoKCX0KCn0KCmNsYXNzIE1lc2hTdGFuZGFyZE1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPSB0cnVlOwoKCQl0aGlzLmRlZmluZXMgPSB7ICdTVEFOREFSRCc6ICcnIH07CgoJCXRoaXMudHlwZSA9ICdNZXNoU3RhbmRhcmRNYXRlcmlhbCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIDB4ZmZmZmZmICk7IC8vIGRpZmZ1c2UKCQl0aGlzLnJvdWdobmVzcyA9IDEuMDsKCQl0aGlzLm1ldGFsbmVzcyA9IDAuMDsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmFvTWFwID0gbnVsbDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmVtaXNzaXZlID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwoJCXRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSAxLjA7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IG51bGw7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy5yb3VnaG5lc3NNYXAgPSBudWxsOwoKCQl0aGlzLm1ldGFsbmVzc01hcCA9IG51bGw7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLmVudk1hcCA9IG51bGw7CgkJdGhpcy5lbnZNYXBJbnRlbnNpdHkgPSAxLjA7CgoJCXRoaXMud2lyZWZyYW1lID0gZmFsc2U7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9ICdyb3VuZCc7CgkJdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9ICdyb3VuZCc7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmRlZmluZXMgPSB7ICdTVEFOREFSRCc6ICcnIH07CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgkJdGhpcy5yb3VnaG5lc3MgPSBzb3VyY2Uucm91Z2huZXNzOwoJCXRoaXMubWV0YWxuZXNzID0gc291cmNlLm1ldGFsbmVzczsKCgkJdGhpcy5tYXAgPSBzb3VyY2UubWFwOwoKCQl0aGlzLmxpZ2h0TWFwID0gc291cmNlLmxpZ2h0TWFwOwoJCXRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSBzb3VyY2UubGlnaHRNYXBJbnRlbnNpdHk7CgoJCXRoaXMuYW9NYXAgPSBzb3VyY2UuYW9NYXA7CgkJdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKCgkJdGhpcy5lbWlzc2l2ZS5jb3B5KCBzb3VyY2UuZW1pc3NpdmUgKTsKCQl0aGlzLmVtaXNzaXZlTWFwID0gc291cmNlLmVtaXNzaXZlTWFwOwoJCXRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSBzb3VyY2UuZW1pc3NpdmVJbnRlbnNpdHk7CgoJCXRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwoJCXRoaXMuYnVtcFNjYWxlID0gc291cmNlLmJ1bXBTY2FsZTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBzb3VyY2Uubm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IHNvdXJjZS5ub3JtYWxNYXBUeXBlOwoJCXRoaXMubm9ybWFsU2NhbGUuY29weSggc291cmNlLm5vcm1hbFNjYWxlICk7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQl0aGlzLnJvdWdobmVzc01hcCA9IHNvdXJjZS5yb3VnaG5lc3NNYXA7CgoJCXRoaXMubWV0YWxuZXNzTWFwID0gc291cmNlLm1ldGFsbmVzc01hcDsKCgkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwoJCXRoaXMuZW52TWFwSW50ZW5zaXR5ID0gc291cmNlLmVudk1hcEludGVuc2l0eTsKCgkJdGhpcy53aXJlZnJhbWUgPSBzb3VyY2Uud2lyZWZyYW1lOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSBzb3VyY2Uud2lyZWZyYW1lTGluZWNhcDsKCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gc291cmNlLndpcmVmcmFtZUxpbmVqb2luOwoKCQl0aGlzLmZsYXRTaGFkaW5nID0gc291cmNlLmZsYXRTaGFkaW5nOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIE1lc2hQaHlzaWNhbE1hdGVyaWFsIGV4dGVuZHMgTWVzaFN0YW5kYXJkTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaFBoeXNpY2FsTWF0ZXJpYWwgPSB0cnVlOwoKCQl0aGlzLmRlZmluZXMgPSB7CgoJCQknU1RBTkRBUkQnOiAnJywKCQkJJ1BIWVNJQ0FMJzogJycKCgkJfTsKCgkJdGhpcy50eXBlID0gJ01lc2hQaHlzaWNhbE1hdGVyaWFsJzsKCgkJdGhpcy5hbmlzb3Ryb3B5Um90YXRpb24gPSAwOwoJCXRoaXMuYW5pc290cm9weU1hcCA9IG51bGw7CgoJCXRoaXMuY2xlYXJjb2F0TWFwID0gbnVsbDsKCQl0aGlzLmNsZWFyY29hdFJvdWdobmVzcyA9IDAuMDsKCQl0aGlzLmNsZWFyY29hdFJvdWdobmVzc01hcCA9IG51bGw7CgkJdGhpcy5jbGVhcmNvYXROb3JtYWxTY2FsZSA9IG5ldyBWZWN0b3IyKCAxLCAxICk7CgkJdGhpcy5jbGVhcmNvYXROb3JtYWxNYXAgPSBudWxsOwoKCQl0aGlzLmlvciA9IDEuNTsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAncmVmbGVjdGl2aXR5JywgewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gKCBjbGFtcCggMi41ICogKCB0aGlzLmlvciAtIDEgKSAvICggdGhpcy5pb3IgKyAxICksIDAsIDEgKSApOwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoIHJlZmxlY3Rpdml0eSApIHsKCgkJCQl0aGlzLmlvciA9ICggMSArIDAuNCAqIHJlZmxlY3Rpdml0eSApIC8gKCAxIC0gMC40ICogcmVmbGVjdGl2aXR5ICk7CgoJCQl9CgkJfSApOwoKCQl0aGlzLmlyaWRlc2NlbmNlTWFwID0gbnVsbDsKCQl0aGlzLmlyaWRlc2NlbmNlSU9SID0gMS4zOwoJCXRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSA9IFsgMTAwLCA0MDAgXTsKCQl0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID0gbnVsbDsKCgkJdGhpcy5zaGVlbkNvbG9yID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwoJCXRoaXMuc2hlZW5Db2xvck1hcCA9IG51bGw7CgkJdGhpcy5zaGVlblJvdWdobmVzcyA9IDEuMDsKCQl0aGlzLnNoZWVuUm91Z2huZXNzTWFwID0gbnVsbDsKCgkJdGhpcy50cmFuc21pc3Npb25NYXAgPSBudWxsOwoKCQl0aGlzLnRoaWNrbmVzcyA9IDA7CgkJdGhpcy50aGlja25lc3NNYXAgPSBudWxsOwoJCXRoaXMuYXR0ZW51YXRpb25EaXN0YW5jZSA9IEluZmluaXR5OwoJCXRoaXMuYXR0ZW51YXRpb25Db2xvciA9IG5ldyBDb2xvciggMSwgMSwgMSApOwoKCQl0aGlzLnNwZWN1bGFySW50ZW5zaXR5ID0gMS4wOwoJCXRoaXMuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPSBudWxsOwoJCXRoaXMuc3BlY3VsYXJDb2xvciA9IG5ldyBDb2xvciggMSwgMSwgMSApOwoJCXRoaXMuc3BlY3VsYXJDb2xvck1hcCA9IG51bGw7CgoJCXRoaXMuX2FuaXNvdHJvcHkgPSAwOwoJCXRoaXMuX2NsZWFyY29hdCA9IDA7CgkJdGhpcy5faXJpZGVzY2VuY2UgPSAwOwoJCXRoaXMuX3NoZWVuID0gMC4wOwoJCXRoaXMuX3RyYW5zbWlzc2lvbiA9IDA7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWdldCBhbmlzb3Ryb3B5KCkgewoKCQlyZXR1cm4gdGhpcy5fYW5pc290cm9weTsKCgl9CgoJc2V0IGFuaXNvdHJvcHkoIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuX2FuaXNvdHJvcHkgPiAwICE9PSB2YWx1ZSA+IDAgKSB7CgoJCQl0aGlzLnZlcnNpb24gKys7CgoJCX0KCgkJdGhpcy5fYW5pc290cm9weSA9IHZhbHVlOwoKCX0KCglnZXQgY2xlYXJjb2F0KCkgewoKCQlyZXR1cm4gdGhpcy5fY2xlYXJjb2F0OwoKCX0KCglzZXQgY2xlYXJjb2F0KCB2YWx1ZSApIHsKCgkJaWYgKCB0aGlzLl9jbGVhcmNvYXQgPiAwICE9PSB2YWx1ZSA+IDAgKSB7CgoJCQl0aGlzLnZlcnNpb24gKys7CgoJCX0KCgkJdGhpcy5fY2xlYXJjb2F0ID0gdmFsdWU7CgoJfQoKCWdldCBpcmlkZXNjZW5jZSgpIHsKCgkJcmV0dXJuIHRoaXMuX2lyaWRlc2NlbmNlOwoKCX0KCglzZXQgaXJpZGVzY2VuY2UoIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuX2lyaWRlc2NlbmNlID4gMCAhPT0gdmFsdWUgPiAwICkgewoKCQkJdGhpcy52ZXJzaW9uICsrOwoKCQl9CgoJCXRoaXMuX2lyaWRlc2NlbmNlID0gdmFsdWU7CgoJfQoKCWdldCBzaGVlbigpIHsKCgkJcmV0dXJuIHRoaXMuX3NoZWVuOwoKCX0KCglzZXQgc2hlZW4oIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuX3NoZWVuID4gMCAhPT0gdmFsdWUgPiAwICkgewoKCQkJdGhpcy52ZXJzaW9uICsrOwoKCQl9CgoJCXRoaXMuX3NoZWVuID0gdmFsdWU7CgoJfQoKCWdldCB0cmFuc21pc3Npb24oKSB7CgoJCXJldHVybiB0aGlzLl90cmFuc21pc3Npb247CgoJfQoKCXNldCB0cmFuc21pc3Npb24oIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuX3RyYW5zbWlzc2lvbiA+IDAgIT09IHZhbHVlID4gMCApIHsKCgkJCXRoaXMudmVyc2lvbiArKzsKCgkJfQoKCQl0aGlzLl90cmFuc21pc3Npb24gPSB2YWx1ZTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5kZWZpbmVzID0gewoKCQkJJ1NUQU5EQVJEJzogJycsCgkJCSdQSFlTSUNBTCc6ICcnCgoJCX07CgoJCXRoaXMuYW5pc290cm9weSA9IHNvdXJjZS5hbmlzb3Ryb3B5OwoJCXRoaXMuYW5pc290cm9weVJvdGF0aW9uID0gc291cmNlLmFuaXNvdHJvcHlSb3RhdGlvbjsKCQl0aGlzLmFuaXNvdHJvcHlNYXAgPSBzb3VyY2UuYW5pc290cm9weU1hcDsKCgkJdGhpcy5jbGVhcmNvYXQgPSBzb3VyY2UuY2xlYXJjb2F0OwoJCXRoaXMuY2xlYXJjb2F0TWFwID0gc291cmNlLmNsZWFyY29hdE1hcDsKCQl0aGlzLmNsZWFyY29hdFJvdWdobmVzcyA9IHNvdXJjZS5jbGVhcmNvYXRSb3VnaG5lc3M7CgkJdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgPSBzb3VyY2UuY2xlYXJjb2F0Um91Z2huZXNzTWFwOwoJCXRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwID0gc291cmNlLmNsZWFyY29hdE5vcm1hbE1hcDsKCQl0aGlzLmNsZWFyY29hdE5vcm1hbFNjYWxlLmNvcHkoIHNvdXJjZS5jbGVhcmNvYXROb3JtYWxTY2FsZSApOwoKCQl0aGlzLmlvciA9IHNvdXJjZS5pb3I7CgoJCXRoaXMuaXJpZGVzY2VuY2UgPSBzb3VyY2UuaXJpZGVzY2VuY2U7CgkJdGhpcy5pcmlkZXNjZW5jZU1hcCA9IHNvdXJjZS5pcmlkZXNjZW5jZU1hcDsKCQl0aGlzLmlyaWRlc2NlbmNlSU9SID0gc291cmNlLmlyaWRlc2NlbmNlSU9SOwoJCXRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSA9IFsgLi4uc291cmNlLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2UgXTsKCQl0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID0gc291cmNlLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOwoKCQl0aGlzLnNoZWVuID0gc291cmNlLnNoZWVuOwoJCXRoaXMuc2hlZW5Db2xvci5jb3B5KCBzb3VyY2Uuc2hlZW5Db2xvciApOwoJCXRoaXMuc2hlZW5Db2xvck1hcCA9IHNvdXJjZS5zaGVlbkNvbG9yTWFwOwoJCXRoaXMuc2hlZW5Sb3VnaG5lc3MgPSBzb3VyY2Uuc2hlZW5Sb3VnaG5lc3M7CgkJdGhpcy5zaGVlblJvdWdobmVzc01hcCA9IHNvdXJjZS5zaGVlblJvdWdobmVzc01hcDsKCgkJdGhpcy50cmFuc21pc3Npb24gPSBzb3VyY2UudHJhbnNtaXNzaW9uOwoJCXRoaXMudHJhbnNtaXNzaW9uTWFwID0gc291cmNlLnRyYW5zbWlzc2lvbk1hcDsKCgkJdGhpcy50aGlja25lc3MgPSBzb3VyY2UudGhpY2tuZXNzOwoJCXRoaXMudGhpY2tuZXNzTWFwID0gc291cmNlLnRoaWNrbmVzc01hcDsKCQl0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2UgPSBzb3VyY2UuYXR0ZW51YXRpb25EaXN0YW5jZTsKCQl0aGlzLmF0dGVudWF0aW9uQ29sb3IuY29weSggc291cmNlLmF0dGVudWF0aW9uQ29sb3IgKTsKCgkJdGhpcy5zcGVjdWxhckludGVuc2l0eSA9IHNvdXJjZS5zcGVjdWxhckludGVuc2l0eTsKCQl0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwID0gc291cmNlLnNwZWN1bGFySW50ZW5zaXR5TWFwOwoJCXRoaXMuc3BlY3VsYXJDb2xvci5jb3B5KCBzb3VyY2Uuc3BlY3VsYXJDb2xvciApOwoJCXRoaXMuc3BlY3VsYXJDb2xvck1hcCA9IHNvdXJjZS5zcGVjdWxhckNvbG9yTWFwOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBNZXNoUGhvbmdNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc01lc2hQaG9uZ01hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hQaG9uZ01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZGlmZnVzZQoJCXRoaXMuc3BlY3VsYXIgPSBuZXcgQ29sb3IoIDB4MTExMTExICk7CgkJdGhpcy5zaGluaW5lc3MgPSAzMDsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmFvTWFwID0gbnVsbDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmVtaXNzaXZlID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwoJCXRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSAxLjA7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IG51bGw7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy5zcGVjdWxhck1hcCA9IG51bGw7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLmVudk1hcCA9IG51bGw7CgkJdGhpcy5jb21iaW5lID0gTXVsdGlwbHlPcGVyYXRpb247CgkJdGhpcy5yZWZsZWN0aXZpdHkgPSAxOwoJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gMC45ODsKCgkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gJ3JvdW5kJzsKCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gJ3JvdW5kJzsKCgkJdGhpcy5mbGF0U2hhZGluZyA9IGZhbHNlOwoKCQl0aGlzLmZvZyA9IHRydWU7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgkJdGhpcy5zcGVjdWxhci5jb3B5KCBzb3VyY2Uuc3BlY3VsYXIgKTsKCQl0aGlzLnNoaW5pbmVzcyA9IHNvdXJjZS5zaGluaW5lc3M7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQl0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSBzb3VyY2UuYW9NYXBJbnRlbnNpdHk7CgoJCXRoaXMuZW1pc3NpdmUuY29weSggc291cmNlLmVtaXNzaXZlICk7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IHNvdXJjZS5lbWlzc2l2ZU1hcDsKCQl0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gc291cmNlLmVtaXNzaXZlSW50ZW5zaXR5OwoKCQl0aGlzLmJ1bXBNYXAgPSBzb3VyY2UuYnVtcE1hcDsKCQl0aGlzLmJ1bXBTY2FsZSA9IHNvdXJjZS5idW1wU2NhbGU7CgoJCXRoaXMubm9ybWFsTWFwID0gc291cmNlLm5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbE1hcFR5cGUgPSBzb3VyY2Uubm9ybWFsTWFwVHlwZTsKCQl0aGlzLm5vcm1hbFNjYWxlLmNvcHkoIHNvdXJjZS5ub3JtYWxTY2FsZSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSBzb3VyY2UuZGlzcGxhY2VtZW50QmlhczsKCgkJdGhpcy5zcGVjdWxhck1hcCA9IHNvdXJjZS5zcGVjdWxhck1hcDsKCgkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwoJCXRoaXMuY29tYmluZSA9IHNvdXJjZS5jb21iaW5lOwoJCXRoaXMucmVmbGVjdGl2aXR5ID0gc291cmNlLnJlZmxlY3Rpdml0eTsKCQl0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IHNvdXJjZS5yZWZyYWN0aW9uUmF0aW87CgoJCXRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CgkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gc291cmNlLndpcmVmcmFtZUxpbmVjYXA7CgkJdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9IHNvdXJjZS53aXJlZnJhbWVMaW5lam9pbjsKCgkJdGhpcy5mbGF0U2hhZGluZyA9IHNvdXJjZS5mbGF0U2hhZGluZzsKCgkJdGhpcy5mb2cgPSBzb3VyY2UuZm9nOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBNZXNoVG9vbk1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaFRvb25NYXRlcmlhbCA9IHRydWU7CgoJCXRoaXMuZGVmaW5lcyA9IHsgJ1RPT04nOiAnJyB9OwoKCQl0aGlzLnR5cGUgPSAnTWVzaFRvb25NYXRlcmlhbCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIDB4ZmZmZmZmICk7CgoJCXRoaXMubWFwID0gbnVsbDsKCQl0aGlzLmdyYWRpZW50TWFwID0gbnVsbDsKCgkJdGhpcy5saWdodE1hcCA9IG51bGw7CgkJdGhpcy5saWdodE1hcEludGVuc2l0eSA9IDEuMDsKCgkJdGhpcy5hb01hcCA9IG51bGw7CgkJdGhpcy5hb01hcEludGVuc2l0eSA9IDEuMDsKCgkJdGhpcy5lbWlzc2l2ZSA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQl0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gMS4wOwoJCXRoaXMuZW1pc3NpdmVNYXAgPSBudWxsOwoKCQl0aGlzLmJ1bXBNYXAgPSBudWxsOwoJCXRoaXMuYnVtcFNjYWxlID0gMTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBudWxsOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IFRhbmdlbnRTcGFjZU5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoIDEsIDEgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSAncm91bmQnOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSAncm91bmQnOwoKCQl0aGlzLmZvZyA9IHRydWU7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCQl0aGlzLmdyYWRpZW50TWFwID0gc291cmNlLmdyYWRpZW50TWFwOwoKCQl0aGlzLmxpZ2h0TWFwID0gc291cmNlLmxpZ2h0TWFwOwoJCXRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSBzb3VyY2UubGlnaHRNYXBJbnRlbnNpdHk7CgoJCXRoaXMuYW9NYXAgPSBzb3VyY2UuYW9NYXA7CgkJdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKCgkJdGhpcy5lbWlzc2l2ZS5jb3B5KCBzb3VyY2UuZW1pc3NpdmUgKTsKCQl0aGlzLmVtaXNzaXZlTWFwID0gc291cmNlLmVtaXNzaXZlTWFwOwoJCXRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSBzb3VyY2UuZW1pc3NpdmVJbnRlbnNpdHk7CgoJCXRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwoJCXRoaXMuYnVtcFNjYWxlID0gc291cmNlLmJ1bXBTY2FsZTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBzb3VyY2Uubm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IHNvdXJjZS5ub3JtYWxNYXBUeXBlOwoJCXRoaXMubm9ybWFsU2NhbGUuY29weSggc291cmNlLm5vcm1hbFNjYWxlICk7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9IHNvdXJjZS53aXJlZnJhbWVMaW5lY2FwOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgoJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgTWVzaE5vcm1hbE1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaE5vcm1hbE1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hOb3JtYWxNYXRlcmlhbCc7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5idW1wTWFwID0gc291cmNlLmJ1bXBNYXA7CgkJdGhpcy5idW1wU2NhbGUgPSBzb3VyY2UuYnVtcFNjYWxlOwoKCQl0aGlzLm5vcm1hbE1hcCA9IHNvdXJjZS5ub3JtYWxNYXA7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gc291cmNlLm5vcm1hbE1hcFR5cGU7CgkJdGhpcy5ub3JtYWxTY2FsZS5jb3B5KCBzb3VyY2Uubm9ybWFsU2NhbGUgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCXRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBzb3VyY2UuZmxhdFNoYWRpbmc7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIE1lc2hMYW1iZXJ0TWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgoJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNNZXNoTGFtYmVydE1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hMYW1iZXJ0TWF0ZXJpYWwnOwoKCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCAweGZmZmZmZiApOyAvLyBkaWZmdXNlCgoJCXRoaXMubWFwID0gbnVsbDsKCgkJdGhpcy5saWdodE1hcCA9IG51bGw7CgkJdGhpcy5saWdodE1hcEludGVuc2l0eSA9IDEuMDsKCgkJdGhpcy5hb01hcCA9IG51bGw7CgkJdGhpcy5hb01hcEludGVuc2l0eSA9IDEuMDsKCgkJdGhpcy5lbWlzc2l2ZSA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQl0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gMS4wOwoJCXRoaXMuZW1pc3NpdmVNYXAgPSBudWxsOwoKCQl0aGlzLmJ1bXBNYXAgPSBudWxsOwoJCXRoaXMuYnVtcFNjYWxlID0gMTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBudWxsOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IFRhbmdlbnRTcGFjZU5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoIDEsIDEgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCXRoaXMuc3BlY3VsYXJNYXAgPSBudWxsOwoKCQl0aGlzLmFscGhhTWFwID0gbnVsbDsKCgkJdGhpcy5lbnZNYXAgPSBudWxsOwoJCXRoaXMuY29tYmluZSA9IE11bHRpcGx5T3BlcmF0aW9uOwoJCXRoaXMucmVmbGVjdGl2aXR5ID0gMTsKCQl0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IDAuOTg7CgoJCXRoaXMud2lyZWZyYW1lID0gZmFsc2U7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9ICdyb3VuZCc7CgkJdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9ICdyb3VuZCc7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMubGlnaHRNYXAgPSBzb3VyY2UubGlnaHRNYXA7CgkJdGhpcy5saWdodE1hcEludGVuc2l0eSA9IHNvdXJjZS5saWdodE1hcEludGVuc2l0eTsKCgkJdGhpcy5hb01hcCA9IHNvdXJjZS5hb01hcDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gc291cmNlLmFvTWFwSW50ZW5zaXR5OwoKCQl0aGlzLmVtaXNzaXZlLmNvcHkoIHNvdXJjZS5lbWlzc2l2ZSApOwoJCXRoaXMuZW1pc3NpdmVNYXAgPSBzb3VyY2UuZW1pc3NpdmVNYXA7CgkJdGhpcy5lbWlzc2l2ZUludGVuc2l0eSA9IHNvdXJjZS5lbWlzc2l2ZUludGVuc2l0eTsKCgkJdGhpcy5idW1wTWFwID0gc291cmNlLmJ1bXBNYXA7CgkJdGhpcy5idW1wU2NhbGUgPSBzb3VyY2UuYnVtcFNjYWxlOwoKCQl0aGlzLm5vcm1hbE1hcCA9IHNvdXJjZS5ub3JtYWxNYXA7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gc291cmNlLm5vcm1hbE1hcFR5cGU7CgkJdGhpcy5ub3JtYWxTY2FsZS5jb3B5KCBzb3VyY2Uubm9ybWFsU2NhbGUgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCXRoaXMuc3BlY3VsYXJNYXAgPSBzb3VyY2Uuc3BlY3VsYXJNYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuZW52TWFwID0gc291cmNlLmVudk1hcDsKCQl0aGlzLmNvbWJpbmUgPSBzb3VyY2UuY29tYmluZTsKCQl0aGlzLnJlZmxlY3Rpdml0eSA9IHNvdXJjZS5yZWZsZWN0aXZpdHk7CgkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSBzb3VyY2UucmVmcmFjdGlvblJhdGlvOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9IHNvdXJjZS53aXJlZnJhbWVMaW5lY2FwOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBzb3VyY2UuZmxhdFNoYWRpbmc7CgoJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgTWVzaE1hdGNhcE1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaE1hdGNhcE1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy5kZWZpbmVzID0geyAnTUFUQ0FQJzogJycgfTsKCgkJdGhpcy50eXBlID0gJ01lc2hNYXRjYXBNYXRlcmlhbCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIDB4ZmZmZmZmICk7IC8vIGRpZmZ1c2UKCgkJdGhpcy5tYXRjYXAgPSBudWxsOwoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5kZWZpbmVzID0geyAnTUFUQ0FQJzogJycgfTsKCgkJdGhpcy5jb2xvci5jb3B5KCBzb3VyY2UuY29sb3IgKTsKCgkJdGhpcy5tYXRjYXAgPSBzb3VyY2UubWF0Y2FwOwoKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwoJCXRoaXMuYnVtcFNjYWxlID0gc291cmNlLmJ1bXBTY2FsZTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBzb3VyY2Uubm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IHNvdXJjZS5ub3JtYWxNYXBUeXBlOwoJCXRoaXMubm9ybWFsU2NhbGUuY29weSggc291cmNlLm5vcm1hbFNjYWxlICk7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKCQl0aGlzLmZsYXRTaGFkaW5nID0gc291cmNlLmZsYXRTaGFkaW5nOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIExpbmVEYXNoZWRNYXRlcmlhbCBleHRlbmRzIExpbmVCYXNpY01hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0xpbmVEYXNoZWRNYXRlcmlhbCA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdMaW5lRGFzaGVkTWF0ZXJpYWwnOwoKCQl0aGlzLnNjYWxlID0gMTsKCQl0aGlzLmRhc2hTaXplID0gMzsKCQl0aGlzLmdhcFNpemUgPSAxOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnNjYWxlID0gc291cmNlLnNjYWxlOwoJCXRoaXMuZGFzaFNpemUgPSBzb3VyY2UuZGFzaFNpemU7CgkJdGhpcy5nYXBTaXplID0gc291cmNlLmdhcFNpemU7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCi8vIGNvbnZlcnRzIGFuIGFycmF5IHRvIGEgc3BlY2lmaWMgdHlwZQpmdW5jdGlvbiBjb252ZXJ0QXJyYXkoIGFycmF5LCB0eXBlLCBmb3JjZUNsb25lICkgewoKCWlmICggISBhcnJheSB8fCAvLyBsZXQgJ3VuZGVmaW5lZCcgYW5kICdudWxsJyBwYXNzCgkJISBmb3JjZUNsb25lICYmIGFycmF5LmNvbnN0cnVjdG9yID09PSB0eXBlICkgcmV0dXJuIGFycmF5OwoKCWlmICggdHlwZW9mIHR5cGUuQllURVNfUEVSX0VMRU1FTlQgPT09ICdudW1iZXInICkgewoKCQlyZXR1cm4gbmV3IHR5cGUoIGFycmF5ICk7IC8vIGNyZWF0ZSB0eXBlZCBhcnJheQoKCX0KCglyZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFycmF5ICk7IC8vIGNyZWF0ZSBBcnJheQoKfQoKZnVuY3Rpb24gaXNUeXBlZEFycmF5KCBvYmplY3QgKSB7CgoJcmV0dXJuIEFycmF5QnVmZmVyLmlzVmlldyggb2JqZWN0ICkgJiYKCQkhICggb2JqZWN0IGluc3RhbmNlb2YgRGF0YVZpZXcgKTsKCn0KCi8vIHJldHVybnMgYW4gYXJyYXkgYnkgd2hpY2ggdGltZXMgYW5kIHZhbHVlcyBjYW4gYmUgc29ydGVkCmZ1bmN0aW9uIGdldEtleWZyYW1lT3JkZXIoIHRpbWVzICkgewoKCWZ1bmN0aW9uIGNvbXBhcmVUaW1lKCBpLCBqICkgewoKCQlyZXR1cm4gdGltZXNbIGkgXSAtIHRpbWVzWyBqIF07CgoJfQoKCWNvbnN0IG4gPSB0aW1lcy5sZW5ndGg7Cgljb25zdCByZXN1bHQgPSBuZXcgQXJyYXkoIG4gKTsKCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHJlc3VsdFsgaSBdID0gaTsKCglyZXN1bHQuc29ydCggY29tcGFyZVRpbWUgKTsKCglyZXR1cm4gcmVzdWx0OwoKfQoKLy8gdXNlcyB0aGUgYXJyYXkgcHJldmlvdXNseSByZXR1cm5lZCBieSAnZ2V0S2V5ZnJhbWVPcmRlcicgdG8gc29ydCBkYXRhCmZ1bmN0aW9uIHNvcnRlZEFycmF5KCB2YWx1ZXMsIHN0cmlkZSwgb3JkZXIgKSB7CgoJY29uc3QgblZhbHVlcyA9IHZhbHVlcy5sZW5ndGg7Cgljb25zdCByZXN1bHQgPSBuZXcgdmFsdWVzLmNvbnN0cnVjdG9yKCBuVmFsdWVzICk7CgoJZm9yICggbGV0IGkgPSAwLCBkc3RPZmZzZXQgPSAwOyBkc3RPZmZzZXQgIT09IG5WYWx1ZXM7ICsrIGkgKSB7CgoJCWNvbnN0IHNyY09mZnNldCA9IG9yZGVyWyBpIF0gKiBzdHJpZGU7CgoJCWZvciAoIGxldCBqID0gMDsgaiAhPT0gc3RyaWRlOyArKyBqICkgewoKCQkJcmVzdWx0WyBkc3RPZmZzZXQgKysgXSA9IHZhbHVlc1sgc3JjT2Zmc2V0ICsgaiBdOwoKCQl9CgoJfQoKCXJldHVybiByZXN1bHQ7Cgp9CgovLyBmdW5jdGlvbiBmb3IgcGFyc2luZyBBT1Mga2V5ZnJhbWUgZm9ybWF0cwpmdW5jdGlvbiBmbGF0dGVuSlNPTigganNvbktleXMsIHRpbWVzLCB2YWx1ZXMsIHZhbHVlUHJvcGVydHlOYW1lICkgewoKCWxldCBpID0gMSwga2V5ID0ganNvbktleXNbIDAgXTsKCgl3aGlsZSAoIGtleSAhPT0gdW5kZWZpbmVkICYmIGtleVsgdmFsdWVQcm9wZXJ0eU5hbWUgXSA9PT0gdW5kZWZpbmVkICkgewoKCQlrZXkgPSBqc29uS2V5c1sgaSArKyBdOwoKCX0KCglpZiAoIGtleSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOyAvLyBubyBkYXRhCgoJbGV0IHZhbHVlID0ga2V5WyB2YWx1ZVByb3BlcnR5TmFtZSBdOwoJaWYgKCB2YWx1ZSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOyAvLyBubyBkYXRhCgoJaWYgKCBBcnJheS5pc0FycmF5KCB2YWx1ZSApICkgewoKCQlkbyB7CgoJCQl2YWx1ZSA9IGtleVsgdmFsdWVQcm9wZXJ0eU5hbWUgXTsKCgkJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aW1lcy5wdXNoKCBrZXkudGltZSApOwoJCQkJdmFsdWVzLnB1c2guYXBwbHkoIHZhbHVlcywgdmFsdWUgKTsgLy8gcHVzaCBhbGwgZWxlbWVudHMKCgkJCX0KCgkJCWtleSA9IGpzb25LZXlzWyBpICsrIF07CgoJCX0gd2hpbGUgKCBrZXkgIT09IHVuZGVmaW5lZCApOwoKCX0gZWxzZSBpZiAoIHZhbHVlLnRvQXJyYXkgIT09IHVuZGVmaW5lZCApIHsKCgkJLy8gLi4uYXNzdW1lIFRIUkVFLk1hdGgtaXNoCgoJCWRvIHsKCgkJCXZhbHVlID0ga2V5WyB2YWx1ZVByb3BlcnR5TmFtZSBdOwoKCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRpbWVzLnB1c2goIGtleS50aW1lICk7CgkJCQl2YWx1ZS50b0FycmF5KCB2YWx1ZXMsIHZhbHVlcy5sZW5ndGggKTsKCgkJCX0KCgkJCWtleSA9IGpzb25LZXlzWyBpICsrIF07CgoJCX0gd2hpbGUgKCBrZXkgIT09IHVuZGVmaW5lZCApOwoKCX0gZWxzZSB7CgoJCS8vIG90aGVyd2lzZSBwdXNoIGFzLWlzCgoJCWRvIHsKCgkJCXZhbHVlID0ga2V5WyB2YWx1ZVByb3BlcnR5TmFtZSBdOwoKCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRpbWVzLnB1c2goIGtleS50aW1lICk7CgkJCQl2YWx1ZXMucHVzaCggdmFsdWUgKTsKCgkJCX0KCgkJCWtleSA9IGpzb25LZXlzWyBpICsrIF07CgoJCX0gd2hpbGUgKCBrZXkgIT09IHVuZGVmaW5lZCApOwoKCX0KCn0KCmZ1bmN0aW9uIHN1YmNsaXAoIHNvdXJjZUNsaXAsIG5hbWUsIHN0YXJ0RnJhbWUsIGVuZEZyYW1lLCBmcHMgPSAzMCApIHsKCgljb25zdCBjbGlwID0gc291cmNlQ2xpcC5jbG9uZSgpOwoKCWNsaXAubmFtZSA9IG5hbWU7CgoJY29uc3QgdHJhY2tzID0gW107CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgY2xpcC50cmFja3MubGVuZ3RoOyArKyBpICkgewoKCQljb25zdCB0cmFjayA9IGNsaXAudHJhY2tzWyBpIF07CgkJY29uc3QgdmFsdWVTaXplID0gdHJhY2suZ2V0VmFsdWVTaXplKCk7CgoJCWNvbnN0IHRpbWVzID0gW107CgkJY29uc3QgdmFsdWVzID0gW107CgoJCWZvciAoIGxldCBqID0gMDsgaiA8IHRyYWNrLnRpbWVzLmxlbmd0aDsgKysgaiApIHsKCgkJCWNvbnN0IGZyYW1lID0gdHJhY2sudGltZXNbIGogXSAqIGZwczsKCgkJCWlmICggZnJhbWUgPCBzdGFydEZyYW1lIHx8IGZyYW1lID49IGVuZEZyYW1lICkgY29udGludWU7CgoJCQl0aW1lcy5wdXNoKCB0cmFjay50aW1lc1sgaiBdICk7CgoJCQlmb3IgKCBsZXQgayA9IDA7IGsgPCB2YWx1ZVNpemU7ICsrIGsgKSB7CgoJCQkJdmFsdWVzLnB1c2goIHRyYWNrLnZhbHVlc1sgaiAqIHZhbHVlU2l6ZSArIGsgXSApOwoKCQkJfQoKCQl9CgoJCWlmICggdGltZXMubGVuZ3RoID09PSAwICkgY29udGludWU7CgoJCXRyYWNrLnRpbWVzID0gY29udmVydEFycmF5KCB0aW1lcywgdHJhY2sudGltZXMuY29uc3RydWN0b3IgKTsKCQl0cmFjay52YWx1ZXMgPSBjb252ZXJ0QXJyYXkoIHZhbHVlcywgdHJhY2sudmFsdWVzLmNvbnN0cnVjdG9yICk7CgoJCXRyYWNrcy5wdXNoKCB0cmFjayApOwoKCX0KCgljbGlwLnRyYWNrcyA9IHRyYWNrczsKCgkvLyBmaW5kIG1pbmltdW0gLnRpbWVzIHZhbHVlIGFjcm9zcyBhbGwgdHJhY2tzIGluIHRoZSB0cmltbWVkIGNsaXAKCglsZXQgbWluU3RhcnRUaW1lID0gSW5maW5pdHk7CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgY2xpcC50cmFja3MubGVuZ3RoOyArKyBpICkgewoKCQlpZiAoIG1pblN0YXJ0VGltZSA+IGNsaXAudHJhY2tzWyBpIF0udGltZXNbIDAgXSApIHsKCgkJCW1pblN0YXJ0VGltZSA9IGNsaXAudHJhY2tzWyBpIF0udGltZXNbIDAgXTsKCgkJfQoKCX0KCgkvLyBzaGlmdCBhbGwgdHJhY2tzIHN1Y2ggdGhhdCBjbGlwIGJlZ2lucyBhdCB0PTAKCglmb3IgKCBsZXQgaSA9IDA7IGkgPCBjbGlwLnRyYWNrcy5sZW5ndGg7ICsrIGkgKSB7CgoJCWNsaXAudHJhY2tzWyBpIF0uc2hpZnQoIC0gMSAqIG1pblN0YXJ0VGltZSApOwoKCX0KCgljbGlwLnJlc2V0RHVyYXRpb24oKTsKCglyZXR1cm4gY2xpcDsKCn0KCmZ1bmN0aW9uIG1ha2VDbGlwQWRkaXRpdmUoIHRhcmdldENsaXAsIHJlZmVyZW5jZUZyYW1lID0gMCwgcmVmZXJlbmNlQ2xpcCA9IHRhcmdldENsaXAsIGZwcyA9IDMwICkgewoKCWlmICggZnBzIDw9IDAgKSBmcHMgPSAzMDsKCgljb25zdCBudW1UcmFja3MgPSByZWZlcmVuY2VDbGlwLnRyYWNrcy5sZW5ndGg7Cgljb25zdCByZWZlcmVuY2VUaW1lID0gcmVmZXJlbmNlRnJhbWUgLyBmcHM7CgoJLy8gTWFrZSBlYWNoIHRyYWNrJ3MgdmFsdWVzIHJlbGF0aXZlIHRvIHRoZSB2YWx1ZXMgYXQgdGhlIHJlZmVyZW5jZSBmcmFtZQoJZm9yICggbGV0IGkgPSAwOyBpIDwgbnVtVHJhY2tzOyArKyBpICkgewoKCQljb25zdCByZWZlcmVuY2VUcmFjayA9IHJlZmVyZW5jZUNsaXAudHJhY2tzWyBpIF07CgkJY29uc3QgcmVmZXJlbmNlVHJhY2tUeXBlID0gcmVmZXJlbmNlVHJhY2suVmFsdWVUeXBlTmFtZTsKCgkJLy8gU2tpcCB0aGlzIHRyYWNrIGlmIGl0J3Mgbm9uLW51bWVyaWMKCQlpZiAoIHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gJ2Jvb2wnIHx8IHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gJ3N0cmluZycgKSBjb250aW51ZTsKCgkJLy8gRmluZCB0aGUgdHJhY2sgaW4gdGhlIHRhcmdldCBjbGlwIHdob3NlIG5hbWUgYW5kIHR5cGUgbWF0Y2hlcyB0aGUgcmVmZXJlbmNlIHRyYWNrCgkJY29uc3QgdGFyZ2V0VHJhY2sgPSB0YXJnZXRDbGlwLnRyYWNrcy5maW5kKCBmdW5jdGlvbiAoIHRyYWNrICkgewoKCQkJcmV0dXJuIHRyYWNrLm5hbWUgPT09IHJlZmVyZW5jZVRyYWNrLm5hbWUKCQkJCSYmIHRyYWNrLlZhbHVlVHlwZU5hbWUgPT09IHJlZmVyZW5jZVRyYWNrVHlwZTsKCgkJfSApOwoKCQlpZiAoIHRhcmdldFRyYWNrID09PSB1bmRlZmluZWQgKSBjb250aW51ZTsKCgkJbGV0IHJlZmVyZW5jZU9mZnNldCA9IDA7CgkJY29uc3QgcmVmZXJlbmNlVmFsdWVTaXplID0gcmVmZXJlbmNlVHJhY2suZ2V0VmFsdWVTaXplKCk7CgoJCWlmICggcmVmZXJlbmNlVHJhY2suY3JlYXRlSW50ZXJwb2xhbnQuaXNJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RHTFRGQ3ViaWNTcGxpbmUgKSB7CgoJCQlyZWZlcmVuY2VPZmZzZXQgPSByZWZlcmVuY2VWYWx1ZVNpemUgLyAzOwoKCQl9CgoJCWxldCB0YXJnZXRPZmZzZXQgPSAwOwoJCWNvbnN0IHRhcmdldFZhbHVlU2l6ZSA9IHRhcmdldFRyYWNrLmdldFZhbHVlU2l6ZSgpOwoKCQlpZiAoIHRhcmdldFRyYWNrLmNyZWF0ZUludGVycG9sYW50LmlzSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kR0xURkN1YmljU3BsaW5lICkgewoKCQkJdGFyZ2V0T2Zmc2V0ID0gdGFyZ2V0VmFsdWVTaXplIC8gMzsKCgkJfQoKCQljb25zdCBsYXN0SW5kZXggPSByZWZlcmVuY2VUcmFjay50aW1lcy5sZW5ndGggLSAxOwoJCWxldCByZWZlcmVuY2VWYWx1ZTsKCgkJLy8gRmluZCB0aGUgdmFsdWUgdG8gc3VidHJhY3Qgb3V0IG9mIHRoZSB0cmFjawoJCWlmICggcmVmZXJlbmNlVGltZSA8PSByZWZlcmVuY2VUcmFjay50aW1lc1sgMCBdICkgewoKCQkJLy8gUmVmZXJlbmNlIGZyYW1lIGlzIGVhcmxpZXIgdGhhbiB0aGUgZmlyc3Qga2V5ZnJhbWUsIHNvIGp1c3QgdXNlIHRoZSBmaXJzdCBrZXlmcmFtZQoJCQljb25zdCBzdGFydEluZGV4ID0gcmVmZXJlbmNlT2Zmc2V0OwoJCQljb25zdCBlbmRJbmRleCA9IHJlZmVyZW5jZVZhbHVlU2l6ZSAtIHJlZmVyZW5jZU9mZnNldDsKCQkJcmVmZXJlbmNlVmFsdWUgPSByZWZlcmVuY2VUcmFjay52YWx1ZXMuc2xpY2UoIHN0YXJ0SW5kZXgsIGVuZEluZGV4ICk7CgoJCX0gZWxzZSBpZiAoIHJlZmVyZW5jZVRpbWUgPj0gcmVmZXJlbmNlVHJhY2sudGltZXNbIGxhc3RJbmRleCBdICkgewoKCQkJLy8gUmVmZXJlbmNlIGZyYW1lIGlzIGFmdGVyIHRoZSBsYXN0IGtleWZyYW1lLCBzbyBqdXN0IHVzZSB0aGUgbGFzdCBrZXlmcmFtZQoJCQljb25zdCBzdGFydEluZGV4ID0gbGFzdEluZGV4ICogcmVmZXJlbmNlVmFsdWVTaXplICsgcmVmZXJlbmNlT2Zmc2V0OwoJCQljb25zdCBlbmRJbmRleCA9IHN0YXJ0SW5kZXggKyByZWZlcmVuY2VWYWx1ZVNpemUgLSByZWZlcmVuY2VPZmZzZXQ7CgkJCXJlZmVyZW5jZVZhbHVlID0gcmVmZXJlbmNlVHJhY2sudmFsdWVzLnNsaWNlKCBzdGFydEluZGV4LCBlbmRJbmRleCApOwoKCQl9IGVsc2UgewoKCQkJLy8gSW50ZXJwb2xhdGUgdG8gdGhlIHJlZmVyZW5jZSB2YWx1ZQoJCQljb25zdCBpbnRlcnBvbGFudCA9IHJlZmVyZW5jZVRyYWNrLmNyZWF0ZUludGVycG9sYW50KCk7CgkJCWNvbnN0IHN0YXJ0SW5kZXggPSByZWZlcmVuY2VPZmZzZXQ7CgkJCWNvbnN0IGVuZEluZGV4ID0gcmVmZXJlbmNlVmFsdWVTaXplIC0gcmVmZXJlbmNlT2Zmc2V0OwoJCQlpbnRlcnBvbGFudC5ldmFsdWF0ZSggcmVmZXJlbmNlVGltZSApOwoJCQlyZWZlcmVuY2VWYWx1ZSA9IGludGVycG9sYW50LnJlc3VsdEJ1ZmZlci5zbGljZSggc3RhcnRJbmRleCwgZW5kSW5kZXggKTsKCgkJfQoKCQkvLyBDb25qdWdhdGUgdGhlIHF1YXRlcm5pb24KCQlpZiAoIHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gJ3F1YXRlcm5pb24nICkgewoKCQkJY29uc3QgcmVmZXJlbmNlUXVhdCA9IG5ldyBRdWF0ZXJuaW9uKCkuZnJvbUFycmF5KCByZWZlcmVuY2VWYWx1ZSApLm5vcm1hbGl6ZSgpLmNvbmp1Z2F0ZSgpOwoJCQlyZWZlcmVuY2VRdWF0LnRvQXJyYXkoIHJlZmVyZW5jZVZhbHVlICk7CgoJCX0KCgkJLy8gU3VidHJhY3QgdGhlIHJlZmVyZW5jZSB2YWx1ZSBmcm9tIGFsbCBvZiB0aGUgdHJhY2sgdmFsdWVzCgoJCWNvbnN0IG51bVRpbWVzID0gdGFyZ2V0VHJhY2sudGltZXMubGVuZ3RoOwoJCWZvciAoIGxldCBqID0gMDsgaiA8IG51bVRpbWVzOyArKyBqICkgewoKCQkJY29uc3QgdmFsdWVTdGFydCA9IGogKiB0YXJnZXRWYWx1ZVNpemUgKyB0YXJnZXRPZmZzZXQ7CgoJCQlpZiAoIHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gJ3F1YXRlcm5pb24nICkgewoKCQkJCS8vIE11bHRpcGx5IHRoZSBjb25qdWdhdGUgZm9yIHF1YXRlcm5pb24gdHJhY2sgdHlwZXMKCQkJCVF1YXRlcm5pb24ubXVsdGlwbHlRdWF0ZXJuaW9uc0ZsYXQoCgkJCQkJdGFyZ2V0VHJhY2sudmFsdWVzLAoJCQkJCXZhbHVlU3RhcnQsCgkJCQkJcmVmZXJlbmNlVmFsdWUsCgkJCQkJMCwKCQkJCQl0YXJnZXRUcmFjay52YWx1ZXMsCgkJCQkJdmFsdWVTdGFydAoJCQkJKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgdmFsdWVFbmQgPSB0YXJnZXRWYWx1ZVNpemUgLSB0YXJnZXRPZmZzZXQgKiAyOwoKCQkJCS8vIFN1YnRyYWN0IGVhY2ggdmFsdWUgZm9yIGFsbCBvdGhlciBudW1lcmljIHRyYWNrIHR5cGVzCgkJCQlmb3IgKCBsZXQgayA9IDA7IGsgPCB2YWx1ZUVuZDsgKysgayApIHsKCgkJCQkJdGFyZ2V0VHJhY2sudmFsdWVzWyB2YWx1ZVN0YXJ0ICsgayBdIC09IHJlZmVyZW5jZVZhbHVlWyBrIF07CgoJCQkJfQoKCQkJfQoKCQl9CgoJfQoKCXRhcmdldENsaXAuYmxlbmRNb2RlID0gQWRkaXRpdmVBbmltYXRpb25CbGVuZE1vZGU7CgoJcmV0dXJuIHRhcmdldENsaXA7Cgp9Cgpjb25zdCBBbmltYXRpb25VdGlscyA9IHsKCWNvbnZlcnRBcnJheTogY29udmVydEFycmF5LAoJaXNUeXBlZEFycmF5OiBpc1R5cGVkQXJyYXksCglnZXRLZXlmcmFtZU9yZGVyOiBnZXRLZXlmcmFtZU9yZGVyLAoJc29ydGVkQXJyYXk6IHNvcnRlZEFycmF5LAoJZmxhdHRlbkpTT046IGZsYXR0ZW5KU09OLAoJc3ViY2xpcDogc3ViY2xpcCwKCW1ha2VDbGlwQWRkaXRpdmU6IG1ha2VDbGlwQWRkaXRpdmUKfTsKCi8qKgogKiBBYnN0cmFjdCBiYXNlIGNsYXNzIG9mIGludGVycG9sYW50cyBvdmVyIHBhcmFtZXRyaWMgc2FtcGxlcy4KICoKICogVGhlIHBhcmFtZXRlciBkb21haW4gaXMgb25lIGRpbWVuc2lvbmFsLCB0eXBpY2FsbHkgdGhlIHRpbWUgb3IgYSBwYXRoCiAqIGFsb25nIGEgY3VydmUgZGVmaW5lZCBieSB0aGUgZGF0YS4KICoKICogVGhlIHNhbXBsZSB2YWx1ZXMgY2FuIGhhdmUgYW55IGRpbWVuc2lvbmFsaXR5IGFuZCBkZXJpdmVkIGNsYXNzZXMgbWF5CiAqIGFwcGx5IHNwZWNpYWwgaW50ZXJwcmV0YXRpb25zIHRvIHRoZSBkYXRhLgogKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIHRoZSBpbnRlcnZhbCBzZWVrIGluIGEgVGVtcGxhdGUgTWV0aG9kLCBkZWZlcnJpbmcKICogdGhlIGFjdHVhbCBpbnRlcnBvbGF0aW9uIHRvIGRlcml2ZWQgY2xhc3Nlcy4KICoKICogVGltZSBjb21wbGV4aXR5IGlzIE8oMSkgZm9yIGxpbmVhciBhY2Nlc3MgY3Jvc3NpbmcgYXQgbW9zdCB0d28gcG9pbnRzCiAqIGFuZCBPKGxvZyBOKSBmb3IgcmFuZG9tIGFjY2Vzcywgd2hlcmUgTiBpcyB0aGUgbnVtYmVyIG9mIHBvc2l0aW9ucy4KICoKICogUmVmZXJlbmNlczoKICoKICogCQlodHRwOi8vd3d3Lm9vZGVzaWduLmNvbS90ZW1wbGF0ZS1tZXRob2QtcGF0dGVybi5odG1sCiAqCiAqLwoKY2xhc3MgSW50ZXJwb2xhbnQgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICkgewoKCQl0aGlzLnBhcmFtZXRlclBvc2l0aW9ucyA9IHBhcmFtZXRlclBvc2l0aW9uczsKCQl0aGlzLl9jYWNoZWRJbmRleCA9IDA7CgoJCXRoaXMucmVzdWx0QnVmZmVyID0gcmVzdWx0QnVmZmVyICE9PSB1bmRlZmluZWQgPwoJCQlyZXN1bHRCdWZmZXIgOiBuZXcgc2FtcGxlVmFsdWVzLmNvbnN0cnVjdG9yKCBzYW1wbGVTaXplICk7CgkJdGhpcy5zYW1wbGVWYWx1ZXMgPSBzYW1wbGVWYWx1ZXM7CgkJdGhpcy52YWx1ZVNpemUgPSBzYW1wbGVTaXplOwoKCQl0aGlzLnNldHRpbmdzID0gbnVsbDsKCQl0aGlzLkRlZmF1bHRTZXR0aW5nc18gPSB7fTsKCgl9CgoJZXZhbHVhdGUoIHQgKSB7CgoJCWNvbnN0IHBwID0gdGhpcy5wYXJhbWV0ZXJQb3NpdGlvbnM7CgkJbGV0IGkxID0gdGhpcy5fY2FjaGVkSW5kZXgsCgkJCXQxID0gcHBbIGkxIF0sCgkJCXQwID0gcHBbIGkxIC0gMSBdOwoKCQl2YWxpZGF0ZV9pbnRlcnZhbDogewoKCQkJc2VlazogewoKCQkJCWxldCByaWdodDsKCgkJCQlsaW5lYXJfc2NhbjogewoKCQkJCQkvLy0gU2VlIGh0dHA6Ly9qc3BlcmYuY29tL2NvbXBhcmlzb24tdG8tdW5kZWZpbmVkLzMKCQkJCQkvLy0gc2xvd2VyIGNvZGU6CgkJCQkJLy8tCgkJCQkJLy8tIAkJCQlpZiAoIHQgPj0gdDEgfHwgdDEgPT09IHVuZGVmaW5lZCApIHsKCQkJCQlmb3J3YXJkX3NjYW46IGlmICggISAoIHQgPCB0MSApICkgewoKCQkJCQkJZm9yICggbGV0IGdpdmVVcEF0ID0gaTEgKyAyOyA7ICkgewoKCQkJCQkJCWlmICggdDEgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkJaWYgKCB0IDwgdDAgKSBicmVhayBmb3J3YXJkX3NjYW47CgoJCQkJCQkJCS8vIGFmdGVyIGVuZAoKCQkJCQkJCQlpMSA9IHBwLmxlbmd0aDsKCQkJCQkJCQl0aGlzLl9jYWNoZWRJbmRleCA9IGkxOwoJCQkJCQkJCXJldHVybiB0aGlzLmNvcHlTYW1wbGVWYWx1ZV8oIGkxIC0gMSApOwoKCQkJCQkJCX0KCgkJCQkJCQlpZiAoIGkxID09PSBnaXZlVXBBdCApIGJyZWFrOyAvLyB0aGlzIGxvb3AKCgkJCQkJCQl0MCA9IHQxOwoJCQkJCQkJdDEgPSBwcFsgKysgaTEgXTsKCgkJCQkJCQlpZiAoIHQgPCB0MSApIHsKCgkJCQkJCQkJLy8gd2UgaGF2ZSBhcnJpdmVkIGF0IHRoZSBzb3VnaHQgaW50ZXJ2YWwKCQkJCQkJCQlicmVhayBzZWVrOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCS8vIHByZXBhcmUgYmluYXJ5IHNlYXJjaCBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgaW5kZXgKCQkJCQkJcmlnaHQgPSBwcC5sZW5ndGg7CgkJCQkJCWJyZWFrIGxpbmVhcl9zY2FuOwoKCQkJCQl9CgoJCQkJCS8vLSBzbG93ZXIgY29kZToKCQkJCQkvLy0JCQkJCWlmICggdCA8IHQwIHx8IHQwID09PSB1bmRlZmluZWQgKSB7CgkJCQkJaWYgKCAhICggdCA+PSB0MCApICkgewoKCQkJCQkJLy8gbG9vcGluZz8KCgkJCQkJCWNvbnN0IHQxZ2xvYmFsID0gcHBbIDEgXTsKCgkJCQkJCWlmICggdCA8IHQxZ2xvYmFsICkgewoKCQkJCQkJCWkxID0gMjsgLy8gKyAxLCB1c2luZyB0aGUgc2NhbiBmb3IgdGhlIGRldGFpbHMKCQkJCQkJCXQwID0gdDFnbG9iYWw7CgoJCQkJCQl9CgoJCQkJCQkvLyBsaW5lYXIgcmV2ZXJzZSBzY2FuCgoJCQkJCQlmb3IgKCBsZXQgZ2l2ZVVwQXQgPSBpMSAtIDI7IDsgKSB7CgoJCQkJCQkJaWYgKCB0MCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCQkvLyBiZWZvcmUgc3RhcnQKCgkJCQkJCQkJdGhpcy5fY2FjaGVkSW5kZXggPSAwOwoJCQkJCQkJCXJldHVybiB0aGlzLmNvcHlTYW1wbGVWYWx1ZV8oIDAgKTsKCgkJCQkJCQl9CgoJCQkJCQkJaWYgKCBpMSA9PT0gZ2l2ZVVwQXQgKSBicmVhazsgLy8gdGhpcyBsb29wCgoJCQkJCQkJdDEgPSB0MDsKCQkJCQkJCXQwID0gcHBbIC0tIGkxIC0gMSBdOwoKCQkJCQkJCWlmICggdCA+PSB0MCApIHsKCgkJCQkJCQkJLy8gd2UgaGF2ZSBhcnJpdmVkIGF0IHRoZSBzb3VnaHQgaW50ZXJ2YWwKCQkJCQkJCQlicmVhayBzZWVrOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCS8vIHByZXBhcmUgYmluYXJ5IHNlYXJjaCBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSBpbmRleAoJCQkJCQlyaWdodCA9IGkxOwoJCQkJCQlpMSA9IDA7CgkJCQkJCWJyZWFrIGxpbmVhcl9zY2FuOwoKCQkJCQl9CgoJCQkJCS8vIHRoZSBpbnRlcnZhbCBpcyB2YWxpZAoKCQkJCQlicmVhayB2YWxpZGF0ZV9pbnRlcnZhbDsKCgkJCQl9IC8vIGxpbmVhciBzY2FuCgoJCQkJLy8gYmluYXJ5IHNlYXJjaAoKCQkJCXdoaWxlICggaTEgPCByaWdodCApIHsKCgkJCQkJY29uc3QgbWlkID0gKCBpMSArIHJpZ2h0ICkgPj4+IDE7CgoJCQkJCWlmICggdCA8IHBwWyBtaWQgXSApIHsKCgkJCQkJCXJpZ2h0ID0gbWlkOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJaTEgPSBtaWQgKyAxOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXQxID0gcHBbIGkxIF07CgkJCQl0MCA9IHBwWyBpMSAtIDEgXTsKCgkJCQkvLyBjaGVjayBib3VuZGFyeSBjYXNlcywgYWdhaW4KCgkJCQlpZiAoIHQwID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCXRoaXMuX2NhY2hlZEluZGV4ID0gMDsKCQkJCQlyZXR1cm4gdGhpcy5jb3B5U2FtcGxlVmFsdWVfKCAwICk7CgoJCQkJfQoKCQkJCWlmICggdDEgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJaTEgPSBwcC5sZW5ndGg7CgkJCQkJdGhpcy5fY2FjaGVkSW5kZXggPSBpMTsKCQkJCQlyZXR1cm4gdGhpcy5jb3B5U2FtcGxlVmFsdWVfKCBpMSAtIDEgKTsKCgkJCQl9CgoJCQl9IC8vIHNlZWsKCgkJCXRoaXMuX2NhY2hlZEluZGV4ID0gaTE7CgoJCQl0aGlzLmludGVydmFsQ2hhbmdlZF8oIGkxLCB0MCwgdDEgKTsKCgkJfSAvLyB2YWxpZGF0ZV9pbnRlcnZhbAoKCQlyZXR1cm4gdGhpcy5pbnRlcnBvbGF0ZV8oIGkxLCB0MCwgdCwgdDEgKTsKCgl9CgoJZ2V0U2V0dGluZ3NfKCkgewoKCQlyZXR1cm4gdGhpcy5zZXR0aW5ncyB8fCB0aGlzLkRlZmF1bHRTZXR0aW5nc187CgoJfQoKCWNvcHlTYW1wbGVWYWx1ZV8oIGluZGV4ICkgewoKCQkvLyBjb3BpZXMgYSBzYW1wbGUgdmFsdWUgdG8gdGhlIHJlc3VsdCBidWZmZXIKCgkJY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHRCdWZmZXIsCgkJCXZhbHVlcyA9IHRoaXMuc2FtcGxlVmFsdWVzLAoJCQlzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwKCQkJb2Zmc2V0ID0gaW5kZXggKiBzdHJpZGU7CgoJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gc3RyaWRlOyArKyBpICkgewoKCQkJcmVzdWx0WyBpIF0gPSB2YWx1ZXNbIG9mZnNldCArIGkgXTsKCgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoKCX0KCgkvLyBUZW1wbGF0ZSBtZXRob2RzIGZvciBkZXJpdmVkIGNsYXNzZXM6CgoJaW50ZXJwb2xhdGVfKCAvKiBpMSwgdDAsIHQsIHQxICovICkgewoKCQl0aHJvdyBuZXcgRXJyb3IoICdjYWxsIHRvIGFic3RyYWN0IG1ldGhvZCcgKTsKCQkvLyBpbXBsZW1lbnRhdGlvbnMgc2hhbGwgcmV0dXJuIHRoaXMucmVzdWx0QnVmZmVyCgoJfQoKCWludGVydmFsQ2hhbmdlZF8oIC8qIGkxLCB0MCwgdDEgKi8gKSB7CgoJCS8vIGVtcHR5CgoJfQoKfQoKLyoqCiAqIEZhc3QgYW5kIHNpbXBsZSBjdWJpYyBzcGxpbmUgaW50ZXJwb2xhbnQuCiAqCiAqIEl0IHdhcyBkZXJpdmVkIGZyb20gYSBIZXJtaXRpYW4gY29uc3RydWN0aW9uIHNldHRpbmcgdGhlIGZpcnN0IGRlcml2YXRpdmUKICogYXQgZWFjaCBzYW1wbGUgcG9zaXRpb24gdG8gdGhlIGxpbmVhciBzbG9wZSBiZXR3ZWVuIG5laWdoYm9yaW5nIHBvc2l0aW9ucwogKiBvdmVyIHRoZWlyIHBhcmFtZXRlciBpbnRlcnZhbC4KICovCgpjbGFzcyBDdWJpY0ludGVycG9sYW50IGV4dGVuZHMgSW50ZXJwb2xhbnQgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICkgewoKCQlzdXBlciggcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApOwoKCQl0aGlzLl93ZWlnaHRQcmV2ID0gLSAwOwoJCXRoaXMuX29mZnNldFByZXYgPSAtIDA7CgkJdGhpcy5fd2VpZ2h0TmV4dCA9IC0gMDsKCQl0aGlzLl9vZmZzZXROZXh0ID0gLSAwOwoKCQl0aGlzLkRlZmF1bHRTZXR0aW5nc18gPSB7CgoJCQllbmRpbmdTdGFydDogWmVyb0N1cnZhdHVyZUVuZGluZywKCQkJZW5kaW5nRW5kOiBaZXJvQ3VydmF0dXJlRW5kaW5nCgoJCX07CgoJfQoKCWludGVydmFsQ2hhbmdlZF8oIGkxLCB0MCwgdDEgKSB7CgoJCWNvbnN0IHBwID0gdGhpcy5wYXJhbWV0ZXJQb3NpdGlvbnM7CgkJbGV0IGlQcmV2ID0gaTEgLSAyLAoJCQlpTmV4dCA9IGkxICsgMSwKCgkJCXRQcmV2ID0gcHBbIGlQcmV2IF0sCgkJCXROZXh0ID0gcHBbIGlOZXh0IF07CgoJCWlmICggdFByZXYgPT09IHVuZGVmaW5lZCApIHsKCgkJCXN3aXRjaCAoIHRoaXMuZ2V0U2V0dGluZ3NfKCkuZW5kaW5nU3RhcnQgKSB7CgoJCQkJY2FzZSBaZXJvU2xvcGVFbmRpbmc6CgoJCQkJCS8vIGYnKHQwKSA9IDAKCQkJCQlpUHJldiA9IGkxOwoJCQkJCXRQcmV2ID0gMiAqIHQwIC0gdDE7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgV3JhcEFyb3VuZEVuZGluZzoKCgkJCQkJLy8gdXNlIHRoZSBvdGhlciBlbmQgb2YgdGhlIGN1cnZlCgkJCQkJaVByZXYgPSBwcC5sZW5ndGggLSAyOwoJCQkJCXRQcmV2ID0gdDAgKyBwcFsgaVByZXYgXSAtIHBwWyBpUHJldiArIDEgXTsKCgkJCQkJYnJlYWs7CgoJCQkJZGVmYXVsdDogLy8gWmVyb0N1cnZhdHVyZUVuZGluZwoKCQkJCQkvLyBmJycodDApID0gMCBhLmsuYS4gTmF0dXJhbCBTcGxpbmUKCQkJCQlpUHJldiA9IGkxOwoJCQkJCXRQcmV2ID0gdDE7CgoJCQl9CgoJCX0KCgkJaWYgKCB0TmV4dCA9PT0gdW5kZWZpbmVkICkgewoKCQkJc3dpdGNoICggdGhpcy5nZXRTZXR0aW5nc18oKS5lbmRpbmdFbmQgKSB7CgoJCQkJY2FzZSBaZXJvU2xvcGVFbmRpbmc6CgoJCQkJCS8vIGYnKHROKSA9IDAKCQkJCQlpTmV4dCA9IGkxOwoJCQkJCXROZXh0ID0gMiAqIHQxIC0gdDA7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgV3JhcEFyb3VuZEVuZGluZzoKCgkJCQkJLy8gdXNlIHRoZSBvdGhlciBlbmQgb2YgdGhlIGN1cnZlCgkJCQkJaU5leHQgPSAxOwoJCQkJCXROZXh0ID0gdDEgKyBwcFsgMSBdIC0gcHBbIDAgXTsKCgkJCQkJYnJlYWs7CgoJCQkJZGVmYXVsdDogLy8gWmVyb0N1cnZhdHVyZUVuZGluZwoKCQkJCQkvLyBmJycodE4pID0gMCwgYS5rLmEuIE5hdHVyYWwgU3BsaW5lCgkJCQkJaU5leHQgPSBpMSAtIDE7CgkJCQkJdE5leHQgPSB0MDsKCgkJCX0KCgkJfQoKCQljb25zdCBoYWxmRHQgPSAoIHQxIC0gdDAgKSAqIDAuNSwKCQkJc3RyaWRlID0gdGhpcy52YWx1ZVNpemU7CgoJCXRoaXMuX3dlaWdodFByZXYgPSBoYWxmRHQgLyAoIHQwIC0gdFByZXYgKTsKCQl0aGlzLl93ZWlnaHROZXh0ID0gaGFsZkR0IC8gKCB0TmV4dCAtIHQxICk7CgkJdGhpcy5fb2Zmc2V0UHJldiA9IGlQcmV2ICogc3RyaWRlOwoJCXRoaXMuX29mZnNldE5leHQgPSBpTmV4dCAqIHN0cmlkZTsKCgl9CgoJaW50ZXJwb2xhdGVfKCBpMSwgdDAsIHQsIHQxICkgewoKCQljb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdEJ1ZmZlciwKCQkJdmFsdWVzID0gdGhpcy5zYW1wbGVWYWx1ZXMsCgkJCXN0cmlkZSA9IHRoaXMudmFsdWVTaXplLAoKCQkJbzEgPSBpMSAqIHN0cmlkZSwJCW8wID0gbzEgLSBzdHJpZGUsCgkJCW9QID0gdGhpcy5fb2Zmc2V0UHJldiwgCW9OID0gdGhpcy5fb2Zmc2V0TmV4dCwKCQkJd1AgPSB0aGlzLl93ZWlnaHRQcmV2LAl3TiA9IHRoaXMuX3dlaWdodE5leHQsCgoJCQlwID0gKCB0IC0gdDAgKSAvICggdDEgLSB0MCApLAoJCQlwcCA9IHAgKiBwLAoJCQlwcHAgPSBwcCAqIHA7CgoJCS8vIGV2YWx1YXRlIHBvbHlub21pYWxzCgoJCWNvbnN0IHNQID0gLSB3UCAqIHBwcCArIDIgKiB3UCAqIHBwIC0gd1AgKiBwOwoJCWNvbnN0IHMwID0gKCAxICsgd1AgKSAqIHBwcCArICggLSAxLjUgLSAyICogd1AgKSAqIHBwICsgKCAtIDAuNSArIHdQICkgKiBwICsgMTsKCQljb25zdCBzMSA9ICggLSAxIC0gd04gKSAqIHBwcCArICggMS41ICsgd04gKSAqIHBwICsgMC41ICogcDsKCQljb25zdCBzTiA9IHdOICogcHBwIC0gd04gKiBwcDsKCgkJLy8gY29tYmluZSBkYXRhIGxpbmVhcmx5CgoJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gc3RyaWRlOyArKyBpICkgewoKCQkJcmVzdWx0WyBpIF0gPQoJCQkJCXNQICogdmFsdWVzWyBvUCArIGkgXSArCgkJCQkJczAgKiB2YWx1ZXNbIG8wICsgaSBdICsKCQkJCQlzMSAqIHZhbHVlc1sgbzEgKyBpIF0gKwoJCQkJCXNOICogdmFsdWVzWyBvTiArIGkgXTsKCgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoKCX0KCn0KCmNsYXNzIExpbmVhckludGVycG9sYW50IGV4dGVuZHMgSW50ZXJwb2xhbnQgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICkgewoKCQlzdXBlciggcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApOwoKCX0KCglpbnRlcnBvbGF0ZV8oIGkxLCB0MCwgdCwgdDEgKSB7CgoJCWNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0QnVmZmVyLAoJCQl2YWx1ZXMgPSB0aGlzLnNhbXBsZVZhbHVlcywKCQkJc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsCgoJCQlvZmZzZXQxID0gaTEgKiBzdHJpZGUsCgkJCW9mZnNldDAgPSBvZmZzZXQxIC0gc3RyaWRlLAoKCQkJd2VpZ2h0MSA9ICggdCAtIHQwICkgLyAoIHQxIC0gdDAgKSwKCQkJd2VpZ2h0MCA9IDEgLSB3ZWlnaHQxOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IHN0cmlkZTsgKysgaSApIHsKCgkJCXJlc3VsdFsgaSBdID0KCQkJCQl2YWx1ZXNbIG9mZnNldDAgKyBpIF0gKiB3ZWlnaHQwICsKCQkJCQl2YWx1ZXNbIG9mZnNldDEgKyBpIF0gKiB3ZWlnaHQxOwoKCQl9CgoJCXJldHVybiByZXN1bHQ7CgoJfQoKfQoKLyoqCiAqCiAqIEludGVycG9sYW50IHRoYXQgZXZhbHVhdGVzIHRvIHRoZSBzYW1wbGUgdmFsdWUgYXQgdGhlIHBvc2l0aW9uIHByZWNlZGluZwogKiB0aGUgcGFyYW1ldGVyLgogKi8KCmNsYXNzIERpc2NyZXRlSW50ZXJwb2xhbnQgZXh0ZW5kcyBJbnRlcnBvbGFudCB7CgoJY29uc3RydWN0b3IoIHBhcmFtZXRlclBvc2l0aW9ucywgc2FtcGxlVmFsdWVzLCBzYW1wbGVTaXplLCByZXN1bHRCdWZmZXIgKSB7CgoJCXN1cGVyKCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICk7CgoJfQoKCWludGVycG9sYXRlXyggaTEgLyosIHQwLCB0LCB0MSAqLyApIHsKCgkJcmV0dXJuIHRoaXMuY29weVNhbXBsZVZhbHVlXyggaTEgLSAxICk7CgoJfQoKfQoKY2xhc3MgS2V5ZnJhbWVUcmFjayB7CgoJY29uc3RydWN0b3IoIG5hbWUsIHRpbWVzLCB2YWx1ZXMsIGludGVycG9sYXRpb24gKSB7CgoJCWlmICggbmFtZSA9PT0gdW5kZWZpbmVkICkgdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogdHJhY2sgbmFtZSBpcyB1bmRlZmluZWQnICk7CgkJaWYgKCB0aW1lcyA9PT0gdW5kZWZpbmVkIHx8IHRpbWVzLmxlbmd0aCA9PT0gMCApIHRocm93IG5ldyBFcnJvciggJ1RIUkVFLktleWZyYW1lVHJhY2s6IG5vIGtleWZyYW1lcyBpbiB0cmFjayBuYW1lZCAnICsgbmFtZSApOwoKCQl0aGlzLm5hbWUgPSBuYW1lOwoKCQl0aGlzLnRpbWVzID0gY29udmVydEFycmF5KCB0aW1lcywgdGhpcy5UaW1lQnVmZmVyVHlwZSApOwoJCXRoaXMudmFsdWVzID0gY29udmVydEFycmF5KCB2YWx1ZXMsIHRoaXMuVmFsdWVCdWZmZXJUeXBlICk7CgoJCXRoaXMuc2V0SW50ZXJwb2xhdGlvbiggaW50ZXJwb2xhdGlvbiB8fCB0aGlzLkRlZmF1bHRJbnRlcnBvbGF0aW9uICk7CgoJfQoKCS8vIFNlcmlhbGl6YXRpb24gKGluIHN0YXRpYyBjb250ZXh0LCBiZWNhdXNlIG9mIGNvbnN0cnVjdG9yIGludm9jYXRpb24KCS8vIGFuZCBhdXRvbWF0aWMgaW52b2NhdGlvbiBvZiAudG9KU09OKToKCglzdGF0aWMgdG9KU09OKCB0cmFjayApIHsKCgkJY29uc3QgdHJhY2tUeXBlID0gdHJhY2suY29uc3RydWN0b3I7CgoJCWxldCBqc29uOwoKCQkvLyBkZXJpdmVkIGNsYXNzZXMgY2FuIGRlZmluZSBhIHN0YXRpYyB0b0pTT04gbWV0aG9kCgkJaWYgKCB0cmFja1R5cGUudG9KU09OICE9PSB0aGlzLnRvSlNPTiApIHsKCgkJCWpzb24gPSB0cmFja1R5cGUudG9KU09OKCB0cmFjayApOwoKCQl9IGVsc2UgewoKCQkJLy8gYnkgZGVmYXVsdCwgd2UgYXNzdW1lIHRoZSBkYXRhIGNhbiBiZSBzZXJpYWxpemVkIGFzLWlzCgkJCWpzb24gPSB7CgoJCQkJJ25hbWUnOiB0cmFjay5uYW1lLAoJCQkJJ3RpbWVzJzogY29udmVydEFycmF5KCB0cmFjay50aW1lcywgQXJyYXkgKSwKCQkJCSd2YWx1ZXMnOiBjb252ZXJ0QXJyYXkoIHRyYWNrLnZhbHVlcywgQXJyYXkgKQoKCQkJfTsKCgkJCWNvbnN0IGludGVycG9sYXRpb24gPSB0cmFjay5nZXRJbnRlcnBvbGF0aW9uKCk7CgoJCQlpZiAoIGludGVycG9sYXRpb24gIT09IHRyYWNrLkRlZmF1bHRJbnRlcnBvbGF0aW9uICkgewoKCQkJCWpzb24uaW50ZXJwb2xhdGlvbiA9IGludGVycG9sYXRpb247CgoJCQl9CgoJCX0KCgkJanNvbi50eXBlID0gdHJhY2suVmFsdWVUeXBlTmFtZTsgLy8gbWFuZGF0b3J5CgoJCXJldHVybiBqc29uOwoKCX0KCglJbnRlcnBvbGFudEZhY3RvcnlNZXRob2REaXNjcmV0ZSggcmVzdWx0ICkgewoKCQlyZXR1cm4gbmV3IERpc2NyZXRlSW50ZXJwb2xhbnQoIHRoaXMudGltZXMsIHRoaXMudmFsdWVzLCB0aGlzLmdldFZhbHVlU2l6ZSgpLCByZXN1bHQgKTsKCgl9CgoJSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kTGluZWFyKCByZXN1bHQgKSB7CgoJCXJldHVybiBuZXcgTGluZWFySW50ZXJwb2xhbnQoIHRoaXMudGltZXMsIHRoaXMudmFsdWVzLCB0aGlzLmdldFZhbHVlU2l6ZSgpLCByZXN1bHQgKTsKCgl9CgoJSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kU21vb3RoKCByZXN1bHQgKSB7CgoJCXJldHVybiBuZXcgQ3ViaWNJbnRlcnBvbGFudCggdGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCksIHJlc3VsdCApOwoKCX0KCglzZXRJbnRlcnBvbGF0aW9uKCBpbnRlcnBvbGF0aW9uICkgewoKCQlsZXQgZmFjdG9yeU1ldGhvZDsKCgkJc3dpdGNoICggaW50ZXJwb2xhdGlvbiApIHsKCgkJCWNhc2UgSW50ZXJwb2xhdGVEaXNjcmV0ZToKCgkJCQlmYWN0b3J5TWV0aG9kID0gdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2REaXNjcmV0ZTsKCgkJCQlicmVhazsKCgkJCWNhc2UgSW50ZXJwb2xhdGVMaW5lYXI6CgoJCQkJZmFjdG9yeU1ldGhvZCA9IHRoaXMuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kTGluZWFyOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSBJbnRlcnBvbGF0ZVNtb290aDoKCgkJCQlmYWN0b3J5TWV0aG9kID0gdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGg7CgoJCQkJYnJlYWs7CgoJCX0KCgkJaWYgKCBmYWN0b3J5TWV0aG9kID09PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBtZXNzYWdlID0gJ3Vuc3VwcG9ydGVkIGludGVycG9sYXRpb24gZm9yICcgKwoJCQkJdGhpcy5WYWx1ZVR5cGVOYW1lICsgJyBrZXlmcmFtZSB0cmFjayBuYW1lZCAnICsgdGhpcy5uYW1lOwoKCQkJaWYgKCB0aGlzLmNyZWF0ZUludGVycG9sYW50ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJLy8gZmFsbCBiYWNrIHRvIGRlZmF1bHQsIHVubGVzcyB0aGUgZGVmYXVsdCBpdHNlbGYgaXMgbWVzc2VkIHVwCgkJCQlpZiAoIGludGVycG9sYXRpb24gIT09IHRoaXMuRGVmYXVsdEludGVycG9sYXRpb24gKSB7CgoJCQkJCXRoaXMuc2V0SW50ZXJwb2xhdGlvbiggdGhpcy5EZWZhdWx0SW50ZXJwb2xhdGlvbiApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggbWVzc2FnZSApOyAvLyBmYXRhbCwgaW4gdGhpcyBjYXNlCgoJCQkJfQoKCQkJfQoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazonLCBtZXNzYWdlICk7CgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCXRoaXMuY3JlYXRlSW50ZXJwb2xhbnQgPSBmYWN0b3J5TWV0aG9kOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0SW50ZXJwb2xhdGlvbigpIHsKCgkJc3dpdGNoICggdGhpcy5jcmVhdGVJbnRlcnBvbGFudCApIHsKCgkJCWNhc2UgdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2REaXNjcmV0ZToKCgkJCQlyZXR1cm4gSW50ZXJwb2xhdGVEaXNjcmV0ZTsKCgkJCWNhc2UgdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXI6CgoJCQkJcmV0dXJuIEludGVycG9sYXRlTGluZWFyOwoKCQkJY2FzZSB0aGlzLkludGVycG9sYW50RmFjdG9yeU1ldGhvZFNtb290aDoKCgkJCQlyZXR1cm4gSW50ZXJwb2xhdGVTbW9vdGg7CgoJCX0KCgl9CgoJZ2V0VmFsdWVTaXplKCkgewoKCQlyZXR1cm4gdGhpcy52YWx1ZXMubGVuZ3RoIC8gdGhpcy50aW1lcy5sZW5ndGg7CgoJfQoKCS8vIG1vdmUgYWxsIGtleWZyYW1lcyBlaXRoZXIgZm9yd2FyZHMgb3IgYmFja3dhcmRzIGluIHRpbWUKCXNoaWZ0KCB0aW1lT2Zmc2V0ICkgewoKCQlpZiAoIHRpbWVPZmZzZXQgIT09IDAuMCApIHsKCgkJCWNvbnN0IHRpbWVzID0gdGhpcy50aW1lczsKCgkJCWZvciAoIGxldCBpID0gMCwgbiA9IHRpbWVzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQl0aW1lc1sgaSBdICs9IHRpbWVPZmZzZXQ7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vIHNjYWxlIGFsbCBrZXlmcmFtZSB0aW1lcyBieSBhIGZhY3RvciAodXNlZnVsIGZvciBmcmFtZSA8LT4gc2Vjb25kcyBjb252ZXJzaW9ucykKCXNjYWxlKCB0aW1lU2NhbGUgKSB7CgoJCWlmICggdGltZVNjYWxlICE9PSAxLjAgKSB7CgoJCQljb25zdCB0aW1lcyA9IHRoaXMudGltZXM7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSB0aW1lcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJdGltZXNbIGkgXSAqPSB0aW1lU2NhbGU7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vIHJlbW92ZXMga2V5ZnJhbWVzIGJlZm9yZSBhbmQgYWZ0ZXIgYW5pbWF0aW9uIHdpdGhvdXQgY2hhbmdpbmcgYW55IHZhbHVlcyB3aXRoaW4gdGhlIHJhbmdlIFtzdGFydFRpbWUsIGVuZFRpbWVdLgoJLy8gSU1QT1JUQU5UOiBXZSBkbyBub3Qgc2hpZnQgYXJvdW5kIGtleXMgdG8gdGhlIHN0YXJ0IG9mIHRoZSB0cmFjayB0aW1lLCBiZWNhdXNlIGZvciBpbnRlcnBvbGF0ZWQga2V5cyB0aGlzIHdpbGwgY2hhbmdlIHRoZWlyIHZhbHVlcwoJdHJpbSggc3RhcnRUaW1lLCBlbmRUaW1lICkgewoKCQljb25zdCB0aW1lcyA9IHRoaXMudGltZXMsCgkJCW5LZXlzID0gdGltZXMubGVuZ3RoOwoKCQlsZXQgZnJvbSA9IDAsCgkJCXRvID0gbktleXMgLSAxOwoKCQl3aGlsZSAoIGZyb20gIT09IG5LZXlzICYmIHRpbWVzWyBmcm9tIF0gPCBzdGFydFRpbWUgKSB7CgoJCQkrKyBmcm9tOwoKCQl9CgoJCXdoaWxlICggdG8gIT09IC0gMSAmJiB0aW1lc1sgdG8gXSA+IGVuZFRpbWUgKSB7CgoJCQktLSB0bzsKCgkJfQoKCQkrKyB0bzsgLy8gaW5jbHVzaXZlIC0+IGV4Y2x1c2l2ZSBib3VuZAoKCQlpZiAoIGZyb20gIT09IDAgfHwgdG8gIT09IG5LZXlzICkgewoKCQkJLy8gZW1wdHkgdHJhY2tzIGFyZSBmb3JiaWRkZW4sIHNvIGtlZXAgYXQgbGVhc3Qgb25lIGtleWZyYW1lCgkJCWlmICggZnJvbSA+PSB0byApIHsKCgkJCQl0byA9IE1hdGgubWF4KCB0bywgMSApOwoJCQkJZnJvbSA9IHRvIC0gMTsKCgkJCX0KCgkJCWNvbnN0IHN0cmlkZSA9IHRoaXMuZ2V0VmFsdWVTaXplKCk7CgkJCXRoaXMudGltZXMgPSB0aW1lcy5zbGljZSggZnJvbSwgdG8gKTsKCQkJdGhpcy52YWx1ZXMgPSB0aGlzLnZhbHVlcy5zbGljZSggZnJvbSAqIHN0cmlkZSwgdG8gKiBzdHJpZGUgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gZW5zdXJlIHdlIGRvIG5vdCBnZXQgYSBHYXJiYWdlSW5HYXJiYWdlT3V0IHNpdHVhdGlvbiwgbWFrZSBzdXJlIHRyYWNrcyBhcmUgYXQgbGVhc3QgbWluaW1hbGx5IHZpYWJsZQoJdmFsaWRhdGUoKSB7CgoJCWxldCB2YWxpZCA9IHRydWU7CgoJCWNvbnN0IHZhbHVlU2l6ZSA9IHRoaXMuZ2V0VmFsdWVTaXplKCk7CgkJaWYgKCB2YWx1ZVNpemUgLSBNYXRoLmZsb29yKCB2YWx1ZVNpemUgKSAhPT0gMCApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiBJbnZhbGlkIHZhbHVlIHNpemUgaW4gdHJhY2suJywgdGhpcyApOwoJCQl2YWxpZCA9IGZhbHNlOwoKCQl9CgoJCWNvbnN0IHRpbWVzID0gdGhpcy50aW1lcywKCQkJdmFsdWVzID0gdGhpcy52YWx1ZXMsCgoJCQluS2V5cyA9IHRpbWVzLmxlbmd0aDsKCgkJaWYgKCBuS2V5cyA9PT0gMCApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiBUcmFjayBpcyBlbXB0eS4nLCB0aGlzICk7CgkJCXZhbGlkID0gZmFsc2U7CgoJCX0KCgkJbGV0IHByZXZUaW1lID0gbnVsbDsKCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuS2V5czsgaSArKyApIHsKCgkJCWNvbnN0IGN1cnJUaW1lID0gdGltZXNbIGkgXTsKCgkJCWlmICggdHlwZW9mIGN1cnJUaW1lID09PSAnbnVtYmVyJyAmJiBpc05hTiggY3VyclRpbWUgKSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogVGltZSBpcyBub3QgYSB2YWxpZCBudW1iZXIuJywgdGhpcywgaSwgY3VyclRpbWUgKTsKCQkJCXZhbGlkID0gZmFsc2U7CgkJCQlicmVhazsKCgkJCX0KCgkJCWlmICggcHJldlRpbWUgIT09IG51bGwgJiYgcHJldlRpbWUgPiBjdXJyVGltZSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogT3V0IG9mIG9yZGVyIGtleXMuJywgdGhpcywgaSwgY3VyclRpbWUsIHByZXZUaW1lICk7CgkJCQl2YWxpZCA9IGZhbHNlOwoJCQkJYnJlYWs7CgoJCQl9CgoJCQlwcmV2VGltZSA9IGN1cnJUaW1lOwoKCQl9CgoJCWlmICggdmFsdWVzICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGlzVHlwZWRBcnJheSggdmFsdWVzICkgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBuID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQkJY29uc3QgdmFsdWUgPSB2YWx1ZXNbIGkgXTsKCgkJCQkJaWYgKCBpc05hTiggdmFsdWUgKSApIHsKCgkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiBWYWx1ZSBpcyBub3QgYSB2YWxpZCBudW1iZXIuJywgdGhpcywgaSwgdmFsdWUgKTsKCQkJCQkJdmFsaWQgPSBmYWxzZTsKCQkJCQkJYnJlYWs7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHZhbGlkOwoKCX0KCgkvLyByZW1vdmVzIGVxdWl2YWxlbnQgc2VxdWVudGlhbCBrZXlzIGFzIGNvbW1vbiBpbiBtb3JwaCB0YXJnZXQgc2VxdWVuY2VzCgkvLyAoMCwwLDAsMCwxLDEsMSwwLDAsMCwwLDAsMCwwKSAtLT4gKDAsMCwxLDEsMCwwKQoJb3B0aW1pemUoKSB7CgoJCS8vIHRpbWVzIG9yIHZhbHVlcyBtYXkgYmUgc2hhcmVkIHdpdGggb3RoZXIgdHJhY2tzLCBzbyBvdmVyd3JpdGluZyBpcyB1bnNhZmUKCQljb25zdCB0aW1lcyA9IHRoaXMudGltZXMuc2xpY2UoKSwKCQkJdmFsdWVzID0gdGhpcy52YWx1ZXMuc2xpY2UoKSwKCQkJc3RyaWRlID0gdGhpcy5nZXRWYWx1ZVNpemUoKSwKCgkJCXNtb290aEludGVycG9sYXRpb24gPSB0aGlzLmdldEludGVycG9sYXRpb24oKSA9PT0gSW50ZXJwb2xhdGVTbW9vdGgsCgoJCQlsYXN0SW5kZXggPSB0aW1lcy5sZW5ndGggLSAxOwoKCQlsZXQgd3JpdGVJbmRleCA9IDE7CgoJCWZvciAoIGxldCBpID0gMTsgaSA8IGxhc3RJbmRleDsgKysgaSApIHsKCgkJCWxldCBrZWVwID0gZmFsc2U7CgoJCQljb25zdCB0aW1lID0gdGltZXNbIGkgXTsKCQkJY29uc3QgdGltZU5leHQgPSB0aW1lc1sgaSArIDEgXTsKCgkJCS8vIHJlbW92ZSBhZGphY2VudCBrZXlmcmFtZXMgc2NoZWR1bGVkIGF0IHRoZSBzYW1lIHRpbWUKCgkJCWlmICggdGltZSAhPT0gdGltZU5leHQgJiYgKCBpICE9PSAxIHx8IHRpbWUgIT09IHRpbWVzWyAwIF0gKSApIHsKCgkJCQlpZiAoICEgc21vb3RoSW50ZXJwb2xhdGlvbiApIHsKCgkJCQkJLy8gcmVtb3ZlIHVubmVjZXNzYXJ5IGtleWZyYW1lcyBzYW1lIGFzIHRoZWlyIG5laWdoYm9ycwoKCQkJCQljb25zdCBvZmZzZXQgPSBpICogc3RyaWRlLAoJCQkJCQlvZmZzZXRQID0gb2Zmc2V0IC0gc3RyaWRlLAoJCQkJCQlvZmZzZXROID0gb2Zmc2V0ICsgc3RyaWRlOwoKCQkJCQlmb3IgKCBsZXQgaiA9IDA7IGogIT09IHN0cmlkZTsgKysgaiApIHsKCgkJCQkJCWNvbnN0IHZhbHVlID0gdmFsdWVzWyBvZmZzZXQgKyBqIF07CgoJCQkJCQlpZiAoIHZhbHVlICE9PSB2YWx1ZXNbIG9mZnNldFAgKyBqIF0gfHwKCQkJCQkJCXZhbHVlICE9PSB2YWx1ZXNbIG9mZnNldE4gKyBqIF0gKSB7CgoJCQkJCQkJa2VlcCA9IHRydWU7CgkJCQkJCQlicmVhazsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWtlZXAgPSB0cnVlOwoKCQkJCX0KCgkJCX0KCgkJCS8vIGluLXBsYWNlIGNvbXBhY3Rpb24KCgkJCWlmICgga2VlcCApIHsKCgkJCQlpZiAoIGkgIT09IHdyaXRlSW5kZXggKSB7CgoJCQkJCXRpbWVzWyB3cml0ZUluZGV4IF0gPSB0aW1lc1sgaSBdOwoKCQkJCQljb25zdCByZWFkT2Zmc2V0ID0gaSAqIHN0cmlkZSwKCQkJCQkJd3JpdGVPZmZzZXQgPSB3cml0ZUluZGV4ICogc3RyaWRlOwoKCQkJCQlmb3IgKCBsZXQgaiA9IDA7IGogIT09IHN0cmlkZTsgKysgaiApIHsKCgkJCQkJCXZhbHVlc1sgd3JpdGVPZmZzZXQgKyBqIF0gPSB2YWx1ZXNbIHJlYWRPZmZzZXQgKyBqIF07CgoJCQkJCX0KCgkJCQl9CgoJCQkJKysgd3JpdGVJbmRleDsKCgkJCX0KCgkJfQoKCQkvLyBmbHVzaCBsYXN0IGtleWZyYW1lIChjb21wYWN0aW9uIGxvb2tzIGFoZWFkKQoKCQlpZiAoIGxhc3RJbmRleCA+IDAgKSB7CgoJCQl0aW1lc1sgd3JpdGVJbmRleCBdID0gdGltZXNbIGxhc3RJbmRleCBdOwoKCQkJZm9yICggbGV0IHJlYWRPZmZzZXQgPSBsYXN0SW5kZXggKiBzdHJpZGUsIHdyaXRlT2Zmc2V0ID0gd3JpdGVJbmRleCAqIHN0cmlkZSwgaiA9IDA7IGogIT09IHN0cmlkZTsgKysgaiApIHsKCgkJCQl2YWx1ZXNbIHdyaXRlT2Zmc2V0ICsgaiBdID0gdmFsdWVzWyByZWFkT2Zmc2V0ICsgaiBdOwoKCQkJfQoKCQkJKysgd3JpdGVJbmRleDsKCgkJfQoKCQlpZiAoIHdyaXRlSW5kZXggIT09IHRpbWVzLmxlbmd0aCApIHsKCgkJCXRoaXMudGltZXMgPSB0aW1lcy5zbGljZSggMCwgd3JpdGVJbmRleCApOwoJCQl0aGlzLnZhbHVlcyA9IHZhbHVlcy5zbGljZSggMCwgd3JpdGVJbmRleCAqIHN0cmlkZSApOwoKCQl9IGVsc2UgewoKCQkJdGhpcy50aW1lcyA9IHRpbWVzOwoJCQl0aGlzLnZhbHVlcyA9IHZhbHVlczsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoKSB7CgoJCWNvbnN0IHRpbWVzID0gdGhpcy50aW1lcy5zbGljZSgpOwoJCWNvbnN0IHZhbHVlcyA9IHRoaXMudmFsdWVzLnNsaWNlKCk7CgoJCWNvbnN0IFR5cGVkS2V5ZnJhbWVUcmFjayA9IHRoaXMuY29uc3RydWN0b3I7CgkJY29uc3QgdHJhY2sgPSBuZXcgVHlwZWRLZXlmcmFtZVRyYWNrKCB0aGlzLm5hbWUsIHRpbWVzLCB2YWx1ZXMgKTsKCgkJLy8gSW50ZXJwb2xhbnQgYXJndW1lbnQgdG8gY29uc3RydWN0b3IgaXMgbm90IHNhdmVkLCBzbyBjb3B5IHRoZSBmYWN0b3J5IG1ldGhvZCBkaXJlY3RseS4KCQl0cmFjay5jcmVhdGVJbnRlcnBvbGFudCA9IHRoaXMuY3JlYXRlSW50ZXJwb2xhbnQ7CgoJCXJldHVybiB0cmFjazsKCgl9Cgp9CgpLZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5UaW1lQnVmZmVyVHlwZSA9IEZsb2F0MzJBcnJheTsKS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVCdWZmZXJUeXBlID0gRmxvYXQzMkFycmF5OwpLZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5EZWZhdWx0SW50ZXJwb2xhdGlvbiA9IEludGVycG9sYXRlTGluZWFyOwoKLyoqCiAqIEEgVHJhY2sgb2YgQm9vbGVhbiBrZXlmcmFtZSB2YWx1ZXMuCiAqLwpjbGFzcyBCb29sZWFuS2V5ZnJhbWVUcmFjayBleHRlbmRzIEtleWZyYW1lVHJhY2sge30KCkJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5WYWx1ZVR5cGVOYW1lID0gJ2Jvb2wnOwpCb29sZWFuS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVCdWZmZXJUeXBlID0gQXJyYXk7CkJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5EZWZhdWx0SW50ZXJwb2xhdGlvbiA9IEludGVycG9sYXRlRGlzY3JldGU7CkJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXIgPSB1bmRlZmluZWQ7CkJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGggPSB1bmRlZmluZWQ7CgovKioKICogQSBUcmFjayBvZiBrZXlmcmFtZSB2YWx1ZXMgdGhhdCByZXByZXNlbnQgY29sb3IuCiAqLwpjbGFzcyBDb2xvcktleWZyYW1lVHJhY2sgZXh0ZW5kcyBLZXlmcmFtZVRyYWNrIHt9CgpDb2xvcktleWZyYW1lVHJhY2sucHJvdG90eXBlLlZhbHVlVHlwZU5hbWUgPSAnY29sb3InOwoKLyoqCiAqIEEgVHJhY2sgb2YgbnVtZXJpYyBrZXlmcmFtZSB2YWx1ZXMuCiAqLwpjbGFzcyBOdW1iZXJLZXlmcmFtZVRyYWNrIGV4dGVuZHMgS2V5ZnJhbWVUcmFjayB7fQoKTnVtYmVyS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVUeXBlTmFtZSA9ICdudW1iZXInOwoKLyoqCiAqIFNwaGVyaWNhbCBsaW5lYXIgdW5pdCBxdWF0ZXJuaW9uIGludGVycG9sYW50LgogKi8KCmNsYXNzIFF1YXRlcm5pb25MaW5lYXJJbnRlcnBvbGFudCBleHRlbmRzIEludGVycG9sYW50IHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApIHsKCgkJc3VwZXIoIHBhcmFtZXRlclBvc2l0aW9ucywgc2FtcGxlVmFsdWVzLCBzYW1wbGVTaXplLCByZXN1bHRCdWZmZXIgKTsKCgl9CgoJaW50ZXJwb2xhdGVfKCBpMSwgdDAsIHQsIHQxICkgewoKCQljb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdEJ1ZmZlciwKCQkJdmFsdWVzID0gdGhpcy5zYW1wbGVWYWx1ZXMsCgkJCXN0cmlkZSA9IHRoaXMudmFsdWVTaXplLAoKCQkJYWxwaGEgPSAoIHQgLSB0MCApIC8gKCB0MSAtIHQwICk7CgoJCWxldCBvZmZzZXQgPSBpMSAqIHN0cmlkZTsKCgkJZm9yICggbGV0IGVuZCA9IG9mZnNldCArIHN0cmlkZTsgb2Zmc2V0ICE9PSBlbmQ7IG9mZnNldCArPSA0ICkgewoKCQkJUXVhdGVybmlvbi5zbGVycEZsYXQoIHJlc3VsdCwgMCwgdmFsdWVzLCBvZmZzZXQgLSBzdHJpZGUsIHZhbHVlcywgb2Zmc2V0LCBhbHBoYSApOwoKCQl9CgoJCXJldHVybiByZXN1bHQ7CgoJfQoKfQoKLyoqCiAqIEEgVHJhY2sgb2YgcXVhdGVybmlvbiBrZXlmcmFtZSB2YWx1ZXMuCiAqLwpjbGFzcyBRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjayBleHRlbmRzIEtleWZyYW1lVHJhY2sgewoKCUludGVycG9sYW50RmFjdG9yeU1ldGhvZExpbmVhciggcmVzdWx0ICkgewoKCQlyZXR1cm4gbmV3IFF1YXRlcm5pb25MaW5lYXJJbnRlcnBvbGFudCggdGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCksIHJlc3VsdCApOwoKCX0KCn0KClF1YXRlcm5pb25LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5WYWx1ZVR5cGVOYW1lID0gJ3F1YXRlcm5pb24nOwovLyBWYWx1ZUJ1ZmZlclR5cGUgaXMgaW5oZXJpdGVkClF1YXRlcm5pb25LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5EZWZhdWx0SW50ZXJwb2xhdGlvbiA9IEludGVycG9sYXRlTGluZWFyOwpRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kU21vb3RoID0gdW5kZWZpbmVkOwoKLyoqCiAqIEEgVHJhY2sgdGhhdCBpbnRlcnBvbGF0ZXMgU3RyaW5ncwogKi8KY2xhc3MgU3RyaW5nS2V5ZnJhbWVUcmFjayBleHRlbmRzIEtleWZyYW1lVHJhY2sge30KClN0cmluZ0tleWZyYW1lVHJhY2sucHJvdG90eXBlLlZhbHVlVHlwZU5hbWUgPSAnc3RyaW5nJzsKU3RyaW5nS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVCdWZmZXJUeXBlID0gQXJyYXk7ClN0cmluZ0tleWZyYW1lVHJhY2sucHJvdG90eXBlLkRlZmF1bHRJbnRlcnBvbGF0aW9uID0gSW50ZXJwb2xhdGVEaXNjcmV0ZTsKU3RyaW5nS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kTGluZWFyID0gdW5kZWZpbmVkOwpTdHJpbmdLZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGggPSB1bmRlZmluZWQ7CgovKioKICogQSBUcmFjayBvZiB2ZWN0b3JlZCBrZXlmcmFtZSB2YWx1ZXMuCiAqLwpjbGFzcyBWZWN0b3JLZXlmcmFtZVRyYWNrIGV4dGVuZHMgS2V5ZnJhbWVUcmFjayB7fQoKVmVjdG9yS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVUeXBlTmFtZSA9ICd2ZWN0b3InOwoKY2xhc3MgQW5pbWF0aW9uQ2xpcCB7CgoJY29uc3RydWN0b3IoIG5hbWUsIGR1cmF0aW9uID0gLSAxLCB0cmFja3MsIGJsZW5kTW9kZSA9IE5vcm1hbEFuaW1hdGlvbkJsZW5kTW9kZSApIHsKCgkJdGhpcy5uYW1lID0gbmFtZTsKCQl0aGlzLnRyYWNrcyA9IHRyYWNrczsKCQl0aGlzLmR1cmF0aW9uID0gZHVyYXRpb247CgkJdGhpcy5ibGVuZE1vZGUgPSBibGVuZE1vZGU7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQkvLyB0aGlzIG1lYW5zIGl0IHNob3VsZCBmaWd1cmUgb3V0IGl0cyBkdXJhdGlvbiBieSBzY2FubmluZyB0aGUgdHJhY2tzCgkJaWYgKCB0aGlzLmR1cmF0aW9uIDwgMCApIHsKCgkJCXRoaXMucmVzZXREdXJhdGlvbigpOwoKCQl9CgoJfQoKCglzdGF0aWMgcGFyc2UoIGpzb24gKSB7CgoJCWNvbnN0IHRyYWNrcyA9IFtdLAoJCQlqc29uVHJhY2tzID0ganNvbi50cmFja3MsCgkJCWZyYW1lVGltZSA9IDEuMCAvICgganNvbi5mcHMgfHwgMS4wICk7CgoJCWZvciAoIGxldCBpID0gMCwgbiA9IGpzb25UcmFja3MubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJdHJhY2tzLnB1c2goIHBhcnNlS2V5ZnJhbWVUcmFjaygganNvblRyYWNrc1sgaSBdICkuc2NhbGUoIGZyYW1lVGltZSApICk7CgoJCX0KCgkJY29uc3QgY2xpcCA9IG5ldyB0aGlzKCBqc29uLm5hbWUsIGpzb24uZHVyYXRpb24sIHRyYWNrcywganNvbi5ibGVuZE1vZGUgKTsKCQljbGlwLnV1aWQgPSBqc29uLnV1aWQ7CgoJCXJldHVybiBjbGlwOwoKCX0KCglzdGF0aWMgdG9KU09OKCBjbGlwICkgewoKCQljb25zdCB0cmFja3MgPSBbXSwKCQkJY2xpcFRyYWNrcyA9IGNsaXAudHJhY2tzOwoKCQljb25zdCBqc29uID0gewoKCQkJJ25hbWUnOiBjbGlwLm5hbWUsCgkJCSdkdXJhdGlvbic6IGNsaXAuZHVyYXRpb24sCgkJCSd0cmFja3MnOiB0cmFja3MsCgkJCSd1dWlkJzogY2xpcC51dWlkLAoJCQknYmxlbmRNb2RlJzogY2xpcC5ibGVuZE1vZGUKCgkJfTsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gY2xpcFRyYWNrcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQl0cmFja3MucHVzaCggS2V5ZnJhbWVUcmFjay50b0pTT04oIGNsaXBUcmFja3NbIGkgXSApICk7CgoJCX0KCgkJcmV0dXJuIGpzb247CgoJfQoKCXN0YXRpYyBDcmVhdGVGcm9tTW9ycGhUYXJnZXRTZXF1ZW5jZSggbmFtZSwgbW9ycGhUYXJnZXRTZXF1ZW5jZSwgZnBzLCBub0xvb3AgKSB7CgoJCWNvbnN0IG51bU1vcnBoVGFyZ2V0cyA9IG1vcnBoVGFyZ2V0U2VxdWVuY2UubGVuZ3RoOwoJCWNvbnN0IHRyYWNrcyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBudW1Nb3JwaFRhcmdldHM7IGkgKysgKSB7CgoJCQlsZXQgdGltZXMgPSBbXTsKCQkJbGV0IHZhbHVlcyA9IFtdOwoKCQkJdGltZXMucHVzaCgKCQkJCSggaSArIG51bU1vcnBoVGFyZ2V0cyAtIDEgKSAlIG51bU1vcnBoVGFyZ2V0cywKCQkJCWksCgkJCQkoIGkgKyAxICkgJSBudW1Nb3JwaFRhcmdldHMgKTsKCgkJCXZhbHVlcy5wdXNoKCAwLCAxLCAwICk7CgoJCQljb25zdCBvcmRlciA9IGdldEtleWZyYW1lT3JkZXIoIHRpbWVzICk7CgkJCXRpbWVzID0gc29ydGVkQXJyYXkoIHRpbWVzLCAxLCBvcmRlciApOwoJCQl2YWx1ZXMgPSBzb3J0ZWRBcnJheSggdmFsdWVzLCAxLCBvcmRlciApOwoKCQkJLy8gaWYgdGhlcmUgaXMgYSBrZXkgYXQgdGhlIGZpcnN0IGZyYW1lLCBkdXBsaWNhdGUgaXQgYXMgdGhlCgkJCS8vIGxhc3QgZnJhbWUgYXMgd2VsbCBmb3IgcGVyZmVjdCBsb29wLgoJCQlpZiAoICEgbm9Mb29wICYmIHRpbWVzWyAwIF0gPT09IDAgKSB7CgoJCQkJdGltZXMucHVzaCggbnVtTW9ycGhUYXJnZXRzICk7CgkJCQl2YWx1ZXMucHVzaCggdmFsdWVzWyAwIF0gKTsKCgkJCX0KCgkJCXRyYWNrcy5wdXNoKAoJCQkJbmV3IE51bWJlcktleWZyYW1lVHJhY2soCgkJCQkJJy5tb3JwaFRhcmdldEluZmx1ZW5jZXNbJyArIG1vcnBoVGFyZ2V0U2VxdWVuY2VbIGkgXS5uYW1lICsgJ10nLAoJCQkJCXRpbWVzLCB2YWx1ZXMKCQkJCSkuc2NhbGUoIDEuMCAvIGZwcyApICk7CgoJCX0KCgkJcmV0dXJuIG5ldyB0aGlzKCBuYW1lLCAtIDEsIHRyYWNrcyApOwoKCX0KCglzdGF0aWMgZmluZEJ5TmFtZSggb2JqZWN0T3JDbGlwQXJyYXksIG5hbWUgKSB7CgoJCWxldCBjbGlwQXJyYXkgPSBvYmplY3RPckNsaXBBcnJheTsKCgkJaWYgKCAhIEFycmF5LmlzQXJyYXkoIG9iamVjdE9yQ2xpcEFycmF5ICkgKSB7CgoJCQljb25zdCBvID0gb2JqZWN0T3JDbGlwQXJyYXk7CgkJCWNsaXBBcnJheSA9IG8uZ2VvbWV0cnkgJiYgby5nZW9tZXRyeS5hbmltYXRpb25zIHx8IG8uYW5pbWF0aW9uczsKCgkJfQoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjbGlwQXJyYXkubGVuZ3RoOyBpICsrICkgewoKCQkJaWYgKCBjbGlwQXJyYXlbIGkgXS5uYW1lID09PSBuYW1lICkgewoKCQkJCXJldHVybiBjbGlwQXJyYXlbIGkgXTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gbnVsbDsKCgl9CgoJc3RhdGljIENyZWF0ZUNsaXBzRnJvbU1vcnBoVGFyZ2V0U2VxdWVuY2VzKCBtb3JwaFRhcmdldHMsIGZwcywgbm9Mb29wICkgewoKCQljb25zdCBhbmltYXRpb25Ub01vcnBoVGFyZ2V0cyA9IHt9OwoKCQkvLyB0ZXN0ZWQgd2l0aCBodHRwczovL3JlZ2V4MTAxLmNvbS8gb24gdHJpY2sgc2VxdWVuY2VzCgkJLy8gc3VjaCBmbGFtaW5nb19mbHlBXzAwMywgZmxhbWluZ29fcnVuMV8wMDMsIGNyZGVhdGgwMDU5CgkJY29uc3QgcGF0dGVybiA9IC9eKFtcdy1dKj8pKFtcZF0rKSQvOwoKCQkvLyBzb3J0IG1vcnBoIHRhcmdldCBuYW1lcyBpbnRvIGFuaW1hdGlvbiBncm91cHMgYmFzZWQKCQkvLyBwYXR0ZXJucyBsaWtlIFdhbGtfMDAxLCBXYWxrXzAwMiwgUnVuXzAwMSwgUnVuXzAwMgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaFRhcmdldHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCBtb3JwaFRhcmdldCA9IG1vcnBoVGFyZ2V0c1sgaSBdOwoJCQljb25zdCBwYXJ0cyA9IG1vcnBoVGFyZ2V0Lm5hbWUubWF0Y2goIHBhdHRlcm4gKTsKCgkJCWlmICggcGFydHMgJiYgcGFydHMubGVuZ3RoID4gMSApIHsKCgkJCQljb25zdCBuYW1lID0gcGFydHNbIDEgXTsKCgkJCQlsZXQgYW5pbWF0aW9uTW9ycGhUYXJnZXRzID0gYW5pbWF0aW9uVG9Nb3JwaFRhcmdldHNbIG5hbWUgXTsKCgkJCQlpZiAoICEgYW5pbWF0aW9uTW9ycGhUYXJnZXRzICkgewoKCQkJCQlhbmltYXRpb25Ub01vcnBoVGFyZ2V0c1sgbmFtZSBdID0gYW5pbWF0aW9uTW9ycGhUYXJnZXRzID0gW107CgoJCQkJfQoKCQkJCWFuaW1hdGlvbk1vcnBoVGFyZ2V0cy5wdXNoKCBtb3JwaFRhcmdldCApOwoKCQkJfQoKCQl9CgoJCWNvbnN0IGNsaXBzID0gW107CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gYW5pbWF0aW9uVG9Nb3JwaFRhcmdldHMgKSB7CgoJCQljbGlwcy5wdXNoKCB0aGlzLkNyZWF0ZUZyb21Nb3JwaFRhcmdldFNlcXVlbmNlKCBuYW1lLCBhbmltYXRpb25Ub01vcnBoVGFyZ2V0c1sgbmFtZSBdLCBmcHMsIG5vTG9vcCApICk7CgoJCX0KCgkJcmV0dXJuIGNsaXBzOwoKCX0KCgkvLyBwYXJzZSB0aGUgYW5pbWF0aW9uLmhpZXJhcmNoeSBmb3JtYXQKCXN0YXRpYyBwYXJzZUFuaW1hdGlvbiggYW5pbWF0aW9uLCBib25lcyApIHsKCgkJaWYgKCAhIGFuaW1hdGlvbiApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5BbmltYXRpb25DbGlwOiBObyBhbmltYXRpb24gaW4gSlNPTkxvYWRlciBkYXRhLicgKTsKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJY29uc3QgYWRkTm9uZW1wdHlUcmFjayA9IGZ1bmN0aW9uICggdHJhY2tUeXBlLCB0cmFja05hbWUsIGFuaW1hdGlvbktleXMsIHByb3BlcnR5TmFtZSwgZGVzdFRyYWNrcyApIHsKCgkJCS8vIG9ubHkgcmV0dXJuIHRyYWNrIGlmIHRoZXJlIGFyZSBhY3R1YWxseSBrZXlzLgoJCQlpZiAoIGFuaW1hdGlvbktleXMubGVuZ3RoICE9PSAwICkgewoKCQkJCWNvbnN0IHRpbWVzID0gW107CgkJCQljb25zdCB2YWx1ZXMgPSBbXTsKCgkJCQlmbGF0dGVuSlNPTiggYW5pbWF0aW9uS2V5cywgdGltZXMsIHZhbHVlcywgcHJvcGVydHlOYW1lICk7CgoJCQkJLy8gZW1wdHkga2V5cyBhcmUgZmlsdGVyZWQgb3V0LCBzbyBjaGVjayBhZ2FpbgoJCQkJaWYgKCB0aW1lcy5sZW5ndGggIT09IDAgKSB7CgoJCQkJCWRlc3RUcmFja3MucHVzaCggbmV3IHRyYWNrVHlwZSggdHJhY2tOYW1lLCB0aW1lcywgdmFsdWVzICkgKTsKCgkJCQl9CgoJCQl9CgoJCX07CgoJCWNvbnN0IHRyYWNrcyA9IFtdOwoKCQljb25zdCBjbGlwTmFtZSA9IGFuaW1hdGlvbi5uYW1lIHx8ICdkZWZhdWx0JzsKCQljb25zdCBmcHMgPSBhbmltYXRpb24uZnBzIHx8IDMwOwoJCWNvbnN0IGJsZW5kTW9kZSA9IGFuaW1hdGlvbi5ibGVuZE1vZGU7CgoJCS8vIGF1dG9tYXRpYyBsZW5ndGggZGV0ZXJtaW5hdGlvbiBpbiBBbmltYXRpb25DbGlwLgoJCWxldCBkdXJhdGlvbiA9IGFuaW1hdGlvbi5sZW5ndGggfHwgLSAxOwoKCQljb25zdCBoaWVyYXJjaHlUcmFja3MgPSBhbmltYXRpb24uaGllcmFyY2h5IHx8IFtdOwoKCQlmb3IgKCBsZXQgaCA9IDA7IGggPCBoaWVyYXJjaHlUcmFja3MubGVuZ3RoOyBoICsrICkgewoKCQkJY29uc3QgYW5pbWF0aW9uS2V5cyA9IGhpZXJhcmNoeVRyYWNrc1sgaCBdLmtleXM7CgoJCQkvLyBza2lwIGVtcHR5IHRyYWNrcwoJCQlpZiAoICEgYW5pbWF0aW9uS2V5cyB8fCBhbmltYXRpb25LZXlzLmxlbmd0aCA9PT0gMCApIGNvbnRpbnVlOwoKCQkJLy8gcHJvY2VzcyBtb3JwaCB0YXJnZXRzCgkJCWlmICggYW5pbWF0aW9uS2V5c1sgMCBdLm1vcnBoVGFyZ2V0cyApIHsKCgkJCQkvLyBmaWd1cmUgb3V0IGFsbCBtb3JwaCB0YXJnZXRzIHVzZWQgaW4gdGhpcyB0cmFjawoJCQkJY29uc3QgbW9ycGhUYXJnZXROYW1lcyA9IHt9OwoKCQkJCWxldCBrOwoKCQkJCWZvciAoIGsgPSAwOyBrIDwgYW5pbWF0aW9uS2V5cy5sZW5ndGg7IGsgKysgKSB7CgoJCQkJCWlmICggYW5pbWF0aW9uS2V5c1sgayBdLm1vcnBoVGFyZ2V0cyApIHsKCgkJCQkJCWZvciAoIGxldCBtID0gMDsgbSA8IGFuaW1hdGlvbktleXNbIGsgXS5tb3JwaFRhcmdldHMubGVuZ3RoOyBtICsrICkgewoKCQkJCQkJCW1vcnBoVGFyZ2V0TmFtZXNbIGFuaW1hdGlvbktleXNbIGsgXS5tb3JwaFRhcmdldHNbIG0gXSBdID0gLSAxOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIGNyZWF0ZSBhIHRyYWNrIGZvciBlYWNoIG1vcnBoIHRhcmdldCB3aXRoIGFsbCB6ZXJvCgkJCQkvLyBtb3JwaFRhcmdldEluZmx1ZW5jZXMgZXhjZXB0IGZvciB0aGUga2V5cyBpbiB3aGljaAoJCQkJLy8gdGhlIG1vcnBoVGFyZ2V0IGlzIG5hbWVkLgoJCQkJZm9yICggY29uc3QgbW9ycGhUYXJnZXROYW1lIGluIG1vcnBoVGFyZ2V0TmFtZXMgKSB7CgoJCQkJCWNvbnN0IHRpbWVzID0gW107CgkJCQkJY29uc3QgdmFsdWVzID0gW107CgoJCQkJCWZvciAoIGxldCBtID0gMDsgbSAhPT0gYW5pbWF0aW9uS2V5c1sgayBdLm1vcnBoVGFyZ2V0cy5sZW5ndGg7ICsrIG0gKSB7CgoJCQkJCQljb25zdCBhbmltYXRpb25LZXkgPSBhbmltYXRpb25LZXlzWyBrIF07CgoJCQkJCQl0aW1lcy5wdXNoKCBhbmltYXRpb25LZXkudGltZSApOwoJCQkJCQl2YWx1ZXMucHVzaCggKCBhbmltYXRpb25LZXkubW9ycGhUYXJnZXQgPT09IG1vcnBoVGFyZ2V0TmFtZSApID8gMSA6IDAgKTsKCgkJCQkJfQoKCQkJCQl0cmFja3MucHVzaCggbmV3IE51bWJlcktleWZyYW1lVHJhY2soICcubW9ycGhUYXJnZXRJbmZsdWVuY2VbJyArIG1vcnBoVGFyZ2V0TmFtZSArICddJywgdGltZXMsIHZhbHVlcyApICk7CgoJCQkJfQoKCQkJCWR1cmF0aW9uID0gbW9ycGhUYXJnZXROYW1lcy5sZW5ndGggKiBmcHM7CgoJCQl9IGVsc2UgewoKCQkJCS8vIC4uLmFzc3VtZSBza2VsZXRhbCBhbmltYXRpb24KCgkJCQljb25zdCBib25lTmFtZSA9ICcuYm9uZXNbJyArIGJvbmVzWyBoIF0ubmFtZSArICddJzsKCgkJCQlhZGROb25lbXB0eVRyYWNrKAoJCQkJCVZlY3RvcktleWZyYW1lVHJhY2ssIGJvbmVOYW1lICsgJy5wb3NpdGlvbicsCgkJCQkJYW5pbWF0aW9uS2V5cywgJ3BvcycsIHRyYWNrcyApOwoKCQkJCWFkZE5vbmVtcHR5VHJhY2soCgkJCQkJUXVhdGVybmlvbktleWZyYW1lVHJhY2ssIGJvbmVOYW1lICsgJy5xdWF0ZXJuaW9uJywKCQkJCQlhbmltYXRpb25LZXlzLCAncm90JywgdHJhY2tzICk7CgoJCQkJYWRkTm9uZW1wdHlUcmFjaygKCQkJCQlWZWN0b3JLZXlmcmFtZVRyYWNrLCBib25lTmFtZSArICcuc2NhbGUnLAoJCQkJCWFuaW1hdGlvbktleXMsICdzY2wnLCB0cmFja3MgKTsKCgkJCX0KCgkJfQoKCQlpZiAoIHRyYWNrcy5sZW5ndGggPT09IDAgKSB7CgoJCQlyZXR1cm4gbnVsbDsKCgkJfQoKCQljb25zdCBjbGlwID0gbmV3IHRoaXMoIGNsaXBOYW1lLCBkdXJhdGlvbiwgdHJhY2tzLCBibGVuZE1vZGUgKTsKCgkJcmV0dXJuIGNsaXA7CgoJfQoKCXJlc2V0RHVyYXRpb24oKSB7CgoJCWNvbnN0IHRyYWNrcyA9IHRoaXMudHJhY2tzOwoJCWxldCBkdXJhdGlvbiA9IDA7CgoJCWZvciAoIGxldCBpID0gMCwgbiA9IHRyYWNrcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQljb25zdCB0cmFjayA9IHRoaXMudHJhY2tzWyBpIF07CgoJCQlkdXJhdGlvbiA9IE1hdGgubWF4KCBkdXJhdGlvbiwgdHJhY2sudGltZXNbIHRyYWNrLnRpbWVzLmxlbmd0aCAtIDEgXSApOwoKCQl9CgoJCXRoaXMuZHVyYXRpb24gPSBkdXJhdGlvbjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyaW0oKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSArKyApIHsKCgkJCXRoaXMudHJhY2tzWyBpIF0udHJpbSggMCwgdGhpcy5kdXJhdGlvbiApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgl2YWxpZGF0ZSgpIHsKCgkJbGV0IHZhbGlkID0gdHJ1ZTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy50cmFja3MubGVuZ3RoOyBpICsrICkgewoKCQkJdmFsaWQgPSB2YWxpZCAmJiB0aGlzLnRyYWNrc1sgaSBdLnZhbGlkYXRlKCk7CgoJCX0KCgkJcmV0dXJuIHZhbGlkOwoKCX0KCglvcHRpbWl6ZSgpIHsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy50cmFja3MubGVuZ3RoOyBpICsrICkgewoKCQkJdGhpcy50cmFja3NbIGkgXS5vcHRpbWl6ZSgpOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJY29uc3QgdHJhY2tzID0gW107CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSArKyApIHsKCgkJCXRyYWNrcy5wdXNoKCB0aGlzLnRyYWNrc1sgaSBdLmNsb25lKCkgKTsKCgkJfQoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMubmFtZSwgdGhpcy5kdXJhdGlvbiwgdHJhY2tzLCB0aGlzLmJsZW5kTW9kZSApOwoKCX0KCgl0b0pTT04oKSB7CgoJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvSlNPTiggdGhpcyApOwoKCX0KCn0KCmZ1bmN0aW9uIGdldFRyYWNrVHlwZUZvclZhbHVlVHlwZU5hbWUoIHR5cGVOYW1lICkgewoKCXN3aXRjaCAoIHR5cGVOYW1lLnRvTG93ZXJDYXNlKCkgKSB7CgoJCWNhc2UgJ3NjYWxhcic6CgkJY2FzZSAnZG91YmxlJzoKCQljYXNlICdmbG9hdCc6CgkJY2FzZSAnbnVtYmVyJzoKCQljYXNlICdpbnRlZ2VyJzoKCgkJCXJldHVybiBOdW1iZXJLZXlmcmFtZVRyYWNrOwoKCQljYXNlICd2ZWN0b3InOgoJCWNhc2UgJ3ZlY3RvcjInOgoJCWNhc2UgJ3ZlY3RvcjMnOgoJCWNhc2UgJ3ZlY3RvcjQnOgoKCQkJcmV0dXJuIFZlY3RvcktleWZyYW1lVHJhY2s7CgoJCWNhc2UgJ2NvbG9yJzoKCgkJCXJldHVybiBDb2xvcktleWZyYW1lVHJhY2s7CgoJCWNhc2UgJ3F1YXRlcm5pb24nOgoKCQkJcmV0dXJuIFF1YXRlcm5pb25LZXlmcmFtZVRyYWNrOwoKCQljYXNlICdib29sJzoKCQljYXNlICdib29sZWFuJzoKCgkJCXJldHVybiBCb29sZWFuS2V5ZnJhbWVUcmFjazsKCgkJY2FzZSAnc3RyaW5nJzoKCgkJCXJldHVybiBTdHJpbmdLZXlmcmFtZVRyYWNrOwoKCX0KCgl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiBVbnN1cHBvcnRlZCB0eXBlTmFtZTogJyArIHR5cGVOYW1lICk7Cgp9CgpmdW5jdGlvbiBwYXJzZUtleWZyYW1lVHJhY2soIGpzb24gKSB7CgoJaWYgKCBqc29uLnR5cGUgPT09IHVuZGVmaW5lZCApIHsKCgkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogdHJhY2sgdHlwZSB1bmRlZmluZWQsIGNhbiBub3QgcGFyc2UnICk7CgoJfQoKCWNvbnN0IHRyYWNrVHlwZSA9IGdldFRyYWNrVHlwZUZvclZhbHVlVHlwZU5hbWUoIGpzb24udHlwZSApOwoKCWlmICgganNvbi50aW1lcyA9PT0gdW5kZWZpbmVkICkgewoKCQljb25zdCB0aW1lcyA9IFtdLCB2YWx1ZXMgPSBbXTsKCgkJZmxhdHRlbkpTT04oIGpzb24ua2V5cywgdGltZXMsIHZhbHVlcywgJ3ZhbHVlJyApOwoKCQlqc29uLnRpbWVzID0gdGltZXM7CgkJanNvbi52YWx1ZXMgPSB2YWx1ZXM7CgoJfQoKCS8vIGRlcml2ZWQgY2xhc3NlcyBjYW4gZGVmaW5lIGEgc3RhdGljIHBhcnNlIG1ldGhvZAoJaWYgKCB0cmFja1R5cGUucGFyc2UgIT09IHVuZGVmaW5lZCApIHsKCgkJcmV0dXJuIHRyYWNrVHlwZS5wYXJzZSgganNvbiApOwoKCX0gZWxzZSB7CgoJCS8vIGJ5IGRlZmF1bHQsIHdlIGFzc3VtZSBhIGNvbnN0cnVjdG9yIGNvbXBhdGlibGUgd2l0aCB0aGUgYmFzZQoJCXJldHVybiBuZXcgdHJhY2tUeXBlKCBqc29uLm5hbWUsIGpzb24udGltZXMsIGpzb24udmFsdWVzLCBqc29uLmludGVycG9sYXRpb24gKTsKCgl9Cgp9Cgpjb25zdCBDYWNoZSA9IHsKCgllbmFibGVkOiBmYWxzZSwKCglmaWxlczoge30sCgoJYWRkOiBmdW5jdGlvbiAoIGtleSwgZmlsZSApIHsKCgkJaWYgKCB0aGlzLmVuYWJsZWQgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkvLyBjb25zb2xlLmxvZyggJ1RIUkVFLkNhY2hlJywgJ0FkZGluZyBrZXk6Jywga2V5ICk7CgoJCXRoaXMuZmlsZXNbIGtleSBdID0gZmlsZTsKCgl9LAoKCWdldDogZnVuY3Rpb24gKCBrZXkgKSB7CgoJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJLy8gY29uc29sZS5sb2coICdUSFJFRS5DYWNoZScsICdDaGVja2luZyBrZXk6Jywga2V5ICk7CgoJCXJldHVybiB0aGlzLmZpbGVzWyBrZXkgXTsKCgl9LAoKCXJlbW92ZTogZnVuY3Rpb24gKCBrZXkgKSB7CgoJCWRlbGV0ZSB0aGlzLmZpbGVzWyBrZXkgXTsKCgl9LAoKCWNsZWFyOiBmdW5jdGlvbiAoKSB7CgoJCXRoaXMuZmlsZXMgPSB7fTsKCgl9Cgp9OwoKY2xhc3MgTG9hZGluZ01hbmFnZXIgewoKCWNvbnN0cnVjdG9yKCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJbGV0IGlzTG9hZGluZyA9IGZhbHNlOwoJCWxldCBpdGVtc0xvYWRlZCA9IDA7CgkJbGV0IGl0ZW1zVG90YWwgPSAwOwoJCWxldCB1cmxNb2RpZmllciA9IHVuZGVmaW5lZDsKCQljb25zdCBoYW5kbGVycyA9IFtdOwoKCQkvLyBSZWZlciB0byAjNTY4OSBmb3IgdGhlIHJlYXNvbiB3aHkgd2UgZG9uJ3Qgc2V0IC5vblN0YXJ0CgkJLy8gaW4gdGhlIGNvbnN0cnVjdG9yCgoJCXRoaXMub25TdGFydCA9IHVuZGVmaW5lZDsKCQl0aGlzLm9uTG9hZCA9IG9uTG9hZDsKCQl0aGlzLm9uUHJvZ3Jlc3MgPSBvblByb2dyZXNzOwoJCXRoaXMub25FcnJvciA9IG9uRXJyb3I7CgoJCXRoaXMuaXRlbVN0YXJ0ID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQlpdGVtc1RvdGFsICsrOwoKCQkJaWYgKCBpc0xvYWRpbmcgPT09IGZhbHNlICkgewoKCQkJCWlmICggc2NvcGUub25TdGFydCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlzY29wZS5vblN0YXJ0KCB1cmwsIGl0ZW1zTG9hZGVkLCBpdGVtc1RvdGFsICk7CgoJCQkJfQoKCQkJfQoKCQkJaXNMb2FkaW5nID0gdHJ1ZTsKCgkJfTsKCgkJdGhpcy5pdGVtRW5kID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQlpdGVtc0xvYWRlZCArKzsKCgkJCWlmICggc2NvcGUub25Qcm9ncmVzcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXNjb3BlLm9uUHJvZ3Jlc3MoIHVybCwgaXRlbXNMb2FkZWQsIGl0ZW1zVG90YWwgKTsKCgkJCX0KCgkJCWlmICggaXRlbXNMb2FkZWQgPT09IGl0ZW1zVG90YWwgKSB7CgoJCQkJaXNMb2FkaW5nID0gZmFsc2U7CgoJCQkJaWYgKCBzY29wZS5vbkxvYWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJc2NvcGUub25Mb2FkKCk7CgoJCQkJfQoKCQkJfQoKCQl9OwoKCQl0aGlzLml0ZW1FcnJvciA9IGZ1bmN0aW9uICggdXJsICkgewoKCQkJaWYgKCBzY29wZS5vbkVycm9yICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJc2NvcGUub25FcnJvciggdXJsICk7CgoJCQl9CgoJCX07CgoJCXRoaXMucmVzb2x2ZVVSTCA9IGZ1bmN0aW9uICggdXJsICkgewoKCQkJaWYgKCB1cmxNb2RpZmllciApIHsKCgkJCQlyZXR1cm4gdXJsTW9kaWZpZXIoIHVybCApOwoKCQkJfQoKCQkJcmV0dXJuIHVybDsKCgkJfTsKCgkJdGhpcy5zZXRVUkxNb2RpZmllciA9IGZ1bmN0aW9uICggdHJhbnNmb3JtICkgewoKCQkJdXJsTW9kaWZpZXIgPSB0cmFuc2Zvcm07CgoJCQlyZXR1cm4gdGhpczsKCgkJfTsKCgkJdGhpcy5hZGRIYW5kbGVyID0gZnVuY3Rpb24gKCByZWdleCwgbG9hZGVyICkgewoKCQkJaGFuZGxlcnMucHVzaCggcmVnZXgsIGxvYWRlciApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX07CgoJCXRoaXMucmVtb3ZlSGFuZGxlciA9IGZ1bmN0aW9uICggcmVnZXggKSB7CgoJCQljb25zdCBpbmRleCA9IGhhbmRsZXJzLmluZGV4T2YoIHJlZ2V4ICk7CgoJCQlpZiAoIGluZGV4ICE9PSAtIDEgKSB7CgoJCQkJaGFuZGxlcnMuc3BsaWNlKCBpbmRleCwgMiApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX07CgoJCXRoaXMuZ2V0SGFuZGxlciA9IGZ1bmN0aW9uICggZmlsZSApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGhhbmRsZXJzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMiApIHsKCgkJCQljb25zdCByZWdleCA9IGhhbmRsZXJzWyBpIF07CgkJCQljb25zdCBsb2FkZXIgPSBoYW5kbGVyc1sgaSArIDEgXTsKCgkJCQlpZiAoIHJlZ2V4Lmdsb2JhbCApIHJlZ2V4Lmxhc3RJbmRleCA9IDA7IC8vIHNlZSAjMTc5MjAKCgkJCQlpZiAoIHJlZ2V4LnRlc3QoIGZpbGUgKSApIHsKCgkJCQkJcmV0dXJuIGxvYWRlcjsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gbnVsbDsKCgkJfTsKCgl9Cgp9Cgpjb25zdCBEZWZhdWx0TG9hZGluZ01hbmFnZXIgPSAvKkBfX1BVUkVfXyovIG5ldyBMb2FkaW5nTWFuYWdlcigpOwoKY2xhc3MgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CgoJCXRoaXMuY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJzsKCQl0aGlzLndpdGhDcmVkZW50aWFscyA9IGZhbHNlOwoJCXRoaXMucGF0aCA9ICcnOwoJCXRoaXMucmVzb3VyY2VQYXRoID0gJyc7CgkJdGhpcy5yZXF1ZXN0SGVhZGVyID0ge307CgoJfQoKCWxvYWQoIC8qIHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICovICkge30KCglsb2FkQXN5bmMoIHVybCwgb25Qcm9ncmVzcyApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQlyZXR1cm4gbmV3IFByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkgewoKCQkJc2NvcGUubG9hZCggdXJsLCByZXNvbHZlLCBvblByb2dyZXNzLCByZWplY3QgKTsKCgkJfSApOwoKCX0KCglwYXJzZSggLyogZGF0YSAqLyApIHt9CgoJc2V0Q3Jvc3NPcmlnaW4oIGNyb3NzT3JpZ2luICkgewoKCQl0aGlzLmNyb3NzT3JpZ2luID0gY3Jvc3NPcmlnaW47CgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFdpdGhDcmVkZW50aWFscyggdmFsdWUgKSB7CgoJCXRoaXMud2l0aENyZWRlbnRpYWxzID0gdmFsdWU7CgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFBhdGgoIHBhdGggKSB7CgoJCXRoaXMucGF0aCA9IHBhdGg7CgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFJlc291cmNlUGF0aCggcmVzb3VyY2VQYXRoICkgewoKCQl0aGlzLnJlc291cmNlUGF0aCA9IHJlc291cmNlUGF0aDsKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0UmVxdWVzdEhlYWRlciggcmVxdWVzdEhlYWRlciApIHsKCgkJdGhpcy5yZXF1ZXN0SGVhZGVyID0gcmVxdWVzdEhlYWRlcjsKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpMb2FkZXIuREVGQVVMVF9NQVRFUklBTF9OQU1FID0gJ19fREVGQVVMVCc7Cgpjb25zdCBsb2FkaW5nID0ge307CgpjbGFzcyBIdHRwRXJyb3IgZXh0ZW5kcyBFcnJvciB7CgoJY29uc3RydWN0b3IoIG1lc3NhZ2UsIHJlc3BvbnNlICkgewoKCQlzdXBlciggbWVzc2FnZSApOwoJCXRoaXMucmVzcG9uc2UgPSByZXNwb25zZTsKCgl9Cgp9CgpjbGFzcyBGaWxlTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJc3VwZXIoIG1hbmFnZXIgKTsKCgl9CgoJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWlmICggdXJsID09PSB1bmRlZmluZWQgKSB1cmwgPSAnJzsKCgkJaWYgKCB0aGlzLnBhdGggIT09IHVuZGVmaW5lZCApIHVybCA9IHRoaXMucGF0aCArIHVybDsKCgkJdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwoIHVybCApOwoKCQljb25zdCBjYWNoZWQgPSBDYWNoZS5nZXQoIHVybCApOwoKCQlpZiAoIGNhY2hlZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgoJCQlzZXRUaW1lb3V0KCAoKSA9PiB7CgoJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIGNhY2hlZCApOwoKCQkJCXRoaXMubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCX0sIDAgKTsKCgkJCXJldHVybiBjYWNoZWQ7CgoJCX0KCgkJLy8gQ2hlY2sgaWYgcmVxdWVzdCBpcyBkdXBsaWNhdGUKCgkJaWYgKCBsb2FkaW5nWyB1cmwgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJbG9hZGluZ1sgdXJsIF0ucHVzaCggewoKCQkJCW9uTG9hZDogb25Mb2FkLAoJCQkJb25Qcm9ncmVzczogb25Qcm9ncmVzcywKCQkJCW9uRXJyb3I6IG9uRXJyb3IKCgkJCX0gKTsKCgkJCXJldHVybjsKCgkJfQoKCQkvLyBJbml0aWFsaXNlIGFycmF5IGZvciBkdXBsaWNhdGUgcmVxdWVzdHMKCQlsb2FkaW5nWyB1cmwgXSA9IFtdOwoKCQlsb2FkaW5nWyB1cmwgXS5wdXNoKCB7CgkJCW9uTG9hZDogb25Mb2FkLAoJCQlvblByb2dyZXNzOiBvblByb2dyZXNzLAoJCQlvbkVycm9yOiBvbkVycm9yLAoJCX0gKTsKCgkJLy8gY3JlYXRlIHJlcXVlc3QKCQljb25zdCByZXEgPSBuZXcgUmVxdWVzdCggdXJsLCB7CgkJCWhlYWRlcnM6IG5ldyBIZWFkZXJzKCB0aGlzLnJlcXVlc3RIZWFkZXIgKSwKCQkJY3JlZGVudGlhbHM6IHRoaXMud2l0aENyZWRlbnRpYWxzID8gJ2luY2x1ZGUnIDogJ3NhbWUtb3JpZ2luJywKCQkJLy8gQW4gYWJvcnQgY29udHJvbGxlciBjb3VsZCBiZSBhZGRlZCB3aXRoaW4gYSBmdXR1cmUgUFIKCQl9ICk7CgoJCS8vIHJlY29yZCBzdGF0ZXMgKCBhdm9pZCBkYXRhIHJhY2UgKQoJCWNvbnN0IG1pbWVUeXBlID0gdGhpcy5taW1lVHlwZTsKCQljb25zdCByZXNwb25zZVR5cGUgPSB0aGlzLnJlc3BvbnNlVHlwZTsKCgkJLy8gc3RhcnQgdGhlIGZldGNoCgkJZmV0Y2goIHJlcSApCgkJCS50aGVuKCByZXNwb25zZSA9PiB7CgoJCQkJaWYgKCByZXNwb25zZS5zdGF0dXMgPT09IDIwMCB8fCByZXNwb25zZS5zdGF0dXMgPT09IDAgKSB7CgoJCQkJCS8vIFNvbWUgYnJvd3NlcnMgcmV0dXJuIEhUVFAgU3RhdHVzIDAgd2hlbiB1c2luZyBub24taHR0cCBwcm90b2NvbAoJCQkJCS8vIGUuZy4gJ2ZpbGU6Ly8nIG9yICdkYXRhOi8vJy4gSGFuZGxlIGFzIHN1Y2Nlc3MuCgoJCQkJCWlmICggcmVzcG9uc2Uuc3RhdHVzID09PSAwICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuRmlsZUxvYWRlcjogSFRUUCBTdGF0dXMgMCByZWNlaXZlZC4nICk7CgoJCQkJCX0KCgkJCQkJLy8gV29ya2Fyb3VuZDogQ2hlY2tpbmcgaWYgcmVzcG9uc2UuYm9keSA9PT0gdW5kZWZpbmVkIGZvciBBbGlwYXkgYnJvd3NlciAjMjM1NDgKCgkJCQkJaWYgKCB0eXBlb2YgUmVhZGFibGVTdHJlYW0gPT09ICd1bmRlZmluZWQnIHx8IHJlc3BvbnNlLmJvZHkgPT09IHVuZGVmaW5lZCB8fCByZXNwb25zZS5ib2R5LmdldFJlYWRlciA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJcmV0dXJuIHJlc3BvbnNlOwoKCQkJCQl9CgoJCQkJCWNvbnN0IGNhbGxiYWNrcyA9IGxvYWRpbmdbIHVybCBdOwoJCQkJCWNvbnN0IHJlYWRlciA9IHJlc3BvbnNlLmJvZHkuZ2V0UmVhZGVyKCk7CgoJCQkJCS8vIE5naW54IG5lZWRzIFgtRmlsZS1TaXplIGNoZWNrCgkJCQkJLy8gaHR0cHM6Ly9zZXJ2ZXJmYXVsdC5jb20vcXVlc3Rpb25zLzQ4Mjg3NS93aHktZG9lcy1uZ2lueC1yZW1vdmUtY29udGVudC1sZW5ndGgtaGVhZGVyLWZvci1jaHVua2VkLWNvbnRlbnQKCQkJCQljb25zdCBjb250ZW50TGVuZ3RoID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoICdDb250ZW50LUxlbmd0aCcgKSB8fCByZXNwb25zZS5oZWFkZXJzLmdldCggJ1gtRmlsZS1TaXplJyApOwoJCQkJCWNvbnN0IHRvdGFsID0gY29udGVudExlbmd0aCA/IHBhcnNlSW50KCBjb250ZW50TGVuZ3RoICkgOiAwOwoJCQkJCWNvbnN0IGxlbmd0aENvbXB1dGFibGUgPSB0b3RhbCAhPT0gMDsKCQkJCQlsZXQgbG9hZGVkID0gMDsKCgkJCQkJLy8gcGVyaW9kaWNhbGx5IHJlYWQgZGF0YSBpbnRvIHRoZSBuZXcgc3RyZWFtIHRyYWNraW5nIHdoaWxlIGRvd25sb2FkIHByb2dyZXNzCgkJCQkJY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKCB7CgkJCQkJCXN0YXJ0KCBjb250cm9sbGVyICkgewoKCQkJCQkJCXJlYWREYXRhKCk7CgoJCQkJCQkJZnVuY3Rpb24gcmVhZERhdGEoKSB7CgoJCQkJCQkJCXJlYWRlci5yZWFkKCkudGhlbiggKCB7IGRvbmUsIHZhbHVlIH0gKSA9PiB7CgoJCQkJCQkJCQlpZiAoIGRvbmUgKSB7CgoJCQkJCQkJCQkJY29udHJvbGxlci5jbG9zZSgpOwoKCQkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCQlsb2FkZWQgKz0gdmFsdWUuYnl0ZUxlbmd0aDsKCgkJCQkJCQkJCQljb25zdCBldmVudCA9IG5ldyBQcm9ncmVzc0V2ZW50KCAncHJvZ3Jlc3MnLCB7IGxlbmd0aENvbXB1dGFibGUsIGxvYWRlZCwgdG90YWwgfSApOwoJCQkJCQkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCQkJCQkJY29uc3QgY2FsbGJhY2sgPSBjYWxsYmFja3NbIGkgXTsKCQkJCQkJCQkJCQlpZiAoIGNhbGxiYWNrLm9uUHJvZ3Jlc3MgKSBjYWxsYmFjay5vblByb2dyZXNzKCBldmVudCApOwoKCQkJCQkJCQkJCX0KCgkJCQkJCQkJCQljb250cm9sbGVyLmVucXVldWUoIHZhbHVlICk7CgkJCQkJCQkJCQlyZWFkRGF0YSgpOwoKCQkJCQkJCQkJfQoKCQkJCQkJCQl9ICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9ICk7CgoJCQkJCXJldHVybiBuZXcgUmVzcG9uc2UoIHN0cmVhbSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRocm93IG5ldyBIdHRwRXJyb3IoIGBmZXRjaCBmb3IgIiR7cmVzcG9uc2UudXJsfSIgcmVzcG9uZGVkIHdpdGggJHtyZXNwb25zZS5zdGF0dXN9OiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCwgcmVzcG9uc2UgKTsKCgkJCQl9CgoJCQl9ICkKCQkJLnRoZW4oIHJlc3BvbnNlID0+IHsKCgkJCQlzd2l0Y2ggKCByZXNwb25zZVR5cGUgKSB7CgoJCQkJCWNhc2UgJ2FycmF5YnVmZmVyJzoKCgkJCQkJCXJldHVybiByZXNwb25zZS5hcnJheUJ1ZmZlcigpOwoKCQkJCQljYXNlICdibG9iJzoKCgkJCQkJCXJldHVybiByZXNwb25zZS5ibG9iKCk7CgoJCQkJCWNhc2UgJ2RvY3VtZW50JzoKCgkJCQkJCXJldHVybiByZXNwb25zZS50ZXh0KCkKCQkJCQkJCS50aGVuKCB0ZXh0ID0+IHsKCgkJCQkJCQkJY29uc3QgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpOwoJCQkJCQkJCXJldHVybiBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKCB0ZXh0LCBtaW1lVHlwZSApOwoKCQkJCQkJCX0gKTsKCgkJCQkJY2FzZSAnanNvbic6CgoJCQkJCQlyZXR1cm4gcmVzcG9uc2UuanNvbigpOwoKCQkJCQlkZWZhdWx0OgoKCQkJCQkJaWYgKCBtaW1lVHlwZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCXJldHVybiByZXNwb25zZS50ZXh0KCk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCS8vIHNuaWZmIGVuY29kaW5nCgkJCQkJCQljb25zdCByZSA9IC9jaGFyc2V0PSI/KFteOyJcc10qKSI/L2k7CgkJCQkJCQljb25zdCBleGVjID0gcmUuZXhlYyggbWltZVR5cGUgKTsKCQkJCQkJCWNvbnN0IGxhYmVsID0gZXhlYyAmJiBleGVjWyAxIF0gPyBleGVjWyAxIF0udG9Mb3dlckNhc2UoKSA6IHVuZGVmaW5lZDsKCQkJCQkJCWNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoIGxhYmVsICk7CgkJCQkJCQlyZXR1cm4gcmVzcG9uc2UuYXJyYXlCdWZmZXIoKS50aGVuKCBhYiA9PiBkZWNvZGVyLmRlY29kZSggYWIgKSApOwoKCQkJCQkJfQoKCQkJCX0KCgkJCX0gKQoJCQkudGhlbiggZGF0YSA9PiB7CgoJCQkJLy8gQWRkIHRvIGNhY2hlIG9ubHkgb24gSFRUUCBzdWNjZXNzLCBzbyB0aGF0IHdlIGRvIG5vdCBjYWNoZQoJCQkJLy8gZXJyb3IgcmVzcG9uc2UgYm9kaWVzIGFzIHByb3BlciByZXNwb25zZXMgdG8gcmVxdWVzdHMuCgkJCQlDYWNoZS5hZGQoIHVybCwgZGF0YSApOwoKCQkJCWNvbnN0IGNhbGxiYWNrcyA9IGxvYWRpbmdbIHVybCBdOwoJCQkJZGVsZXRlIGxvYWRpbmdbIHVybCBdOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBjYWxsYmFja3MubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJaWYgKCBjYWxsYmFjay5vbkxvYWQgKSBjYWxsYmFjay5vbkxvYWQoIGRhdGEgKTsKCgkJCQl9CgoJCQl9ICkKCQkJLmNhdGNoKCBlcnIgPT4gewoKCQkJCS8vIEFib3J0IGVycm9ycyBhbmQgb3RoZXIgZXJyb3JzIGFyZSBoYW5kbGVkIHRoZSBzYW1lCgoJCQkJY29uc3QgY2FsbGJhY2tzID0gbG9hZGluZ1sgdXJsIF07CgoJCQkJaWYgKCBjYWxsYmFja3MgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gV2hlbiBvbkxvYWQgd2FzIGNhbGxlZCBhbmQgdXJsIHdhcyBkZWxldGVkIGluIGBsb2FkaW5nYAoJCQkJCXRoaXMubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQkJCXRocm93IGVycjsKCgkJCQl9CgoJCQkJZGVsZXRlIGxvYWRpbmdbIHVybCBdOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBjYWxsYmFja3MubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJaWYgKCBjYWxsYmFjay5vbkVycm9yICkgY2FsbGJhY2sub25FcnJvciggZXJyICk7CgoJCQkJfQoKCQkJCXRoaXMubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoKCQkJfSApCgkJCS5maW5hbGx5KCAoKSA9PiB7CgoJCQkJdGhpcy5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQkJfSApOwoKCQl0aGlzLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgl9CgoJc2V0UmVzcG9uc2VUeXBlKCB2YWx1ZSApIHsKCgkJdGhpcy5yZXNwb25zZVR5cGUgPSB2YWx1ZTsKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0TWltZVR5cGUoIHZhbHVlICkgewoKCQl0aGlzLm1pbWVUeXBlID0gdmFsdWU7CgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgQW5pbWF0aW9uTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJc3VwZXIoIG1hbmFnZXIgKTsKCgl9CgoJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJY29uc3QgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCQlsb2FkZXIuc2V0UmVxdWVzdEhlYWRlciggdGhpcy5yZXF1ZXN0SGVhZGVyICk7CgkJbG9hZGVyLnNldFdpdGhDcmVkZW50aWFscyggdGhpcy53aXRoQ3JlZGVudGlhbHMgKTsKCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIHRleHQgKSB7CgoJCQl0cnkgewoKCQkJCW9uTG9hZCggc2NvcGUucGFyc2UoIEpTT04ucGFyc2UoIHRleHQgKSApICk7CgoJCQl9IGNhdGNoICggZSApIHsKCgkJCQlpZiAoIG9uRXJyb3IgKSB7CgoJCQkJCW9uRXJyb3IoIGUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLmVycm9yKCBlICk7CgoJCQkJfQoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCgkJCX0KCgkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCX0KCglwYXJzZSgganNvbiApIHsKCgkJY29uc3QgYW5pbWF0aW9ucyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBqc29uLmxlbmd0aDsgaSArKyApIHsKCgkJCWNvbnN0IGNsaXAgPSBBbmltYXRpb25DbGlwLnBhcnNlKCBqc29uWyBpIF0gKTsKCgkJCWFuaW1hdGlvbnMucHVzaCggY2xpcCApOwoKCQl9CgoJCXJldHVybiBhbmltYXRpb25zOwoKCX0KCn0KCi8qKgogKiBBYnN0cmFjdCBCYXNlIGNsYXNzIHRvIGJsb2NrIGJhc2VkIHRleHR1cmVzIGxvYWRlciAoZGRzLCBwdnIsIC4uLikKICoKICogU3ViIGNsYXNzZXMgaGF2ZSB0byBpbXBsZW1lbnQgdGhlIHBhcnNlKCkgbWV0aG9kIHdoaWNoIHdpbGwgYmUgdXNlZCBpbiBsb2FkKCkuCiAqLwoKY2xhc3MgQ29tcHJlc3NlZFRleHR1cmVMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQlzdXBlciggbWFuYWdlciApOwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCBpbWFnZXMgPSBbXTsKCgkJY29uc3QgdGV4dHVyZSA9IG5ldyBDb21wcmVzc2VkVGV4dHVyZSgpOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggdGhpcy5tYW5hZ2VyICk7CgkJbG9hZGVyLnNldFBhdGgoIHRoaXMucGF0aCApOwoJCWxvYWRlci5zZXRSZXNwb25zZVR5cGUoICdhcnJheWJ1ZmZlcicgKTsKCQlsb2FkZXIuc2V0UmVxdWVzdEhlYWRlciggdGhpcy5yZXF1ZXN0SGVhZGVyICk7CgkJbG9hZGVyLnNldFdpdGhDcmVkZW50aWFscyggc2NvcGUud2l0aENyZWRlbnRpYWxzICk7CgoJCWxldCBsb2FkZWQgPSAwOwoKCQlmdW5jdGlvbiBsb2FkVGV4dHVyZSggaSApIHsKCgkJCWxvYWRlci5sb2FkKCB1cmxbIGkgXSwgZnVuY3Rpb24gKCBidWZmZXIgKSB7CgoJCQkJY29uc3QgdGV4RGF0YXMgPSBzY29wZS5wYXJzZSggYnVmZmVyLCB0cnVlICk7CgoJCQkJaW1hZ2VzWyBpIF0gPSB7CgkJCQkJd2lkdGg6IHRleERhdGFzLndpZHRoLAoJCQkJCWhlaWdodDogdGV4RGF0YXMuaGVpZ2h0LAoJCQkJCWZvcm1hdDogdGV4RGF0YXMuZm9ybWF0LAoJCQkJCW1pcG1hcHM6IHRleERhdGFzLm1pcG1hcHMKCQkJCX07CgoJCQkJbG9hZGVkICs9IDE7CgoJCQkJaWYgKCBsb2FkZWQgPT09IDYgKSB7CgoJCQkJCWlmICggdGV4RGF0YXMubWlwbWFwQ291bnQgPT09IDEgKSB0ZXh0dXJlLm1pbkZpbHRlciA9IExpbmVhckZpbHRlcjsKCgkJCQkJdGV4dHVyZS5pbWFnZSA9IGltYWdlczsKCQkJCQl0ZXh0dXJlLmZvcm1hdCA9IHRleERhdGFzLmZvcm1hdDsKCQkJCQl0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIHRleHR1cmUgKTsKCgkJCQl9CgoJCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoJCX0KCgkJaWYgKCBBcnJheS5pc0FycmF5KCB1cmwgKSApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB1cmwubGVuZ3RoOyBpIDwgaWw7ICsrIGkgKSB7CgoJCQkJbG9hZFRleHR1cmUoIGkgKTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCS8vIGNvbXByZXNzZWQgY3ViZW1hcCB0ZXh0dXJlIHN0b3JlZCBpbiBhIHNpbmdsZSBERFMgZmlsZQoKCQkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCBidWZmZXIgKSB7CgoJCQkJY29uc3QgdGV4RGF0YXMgPSBzY29wZS5wYXJzZSggYnVmZmVyLCB0cnVlICk7CgoJCQkJaWYgKCB0ZXhEYXRhcy5pc0N1YmVtYXAgKSB7CgoJCQkJCWNvbnN0IGZhY2VzID0gdGV4RGF0YXMubWlwbWFwcy5sZW5ndGggLyB0ZXhEYXRhcy5taXBtYXBDb3VudDsKCgkJCQkJZm9yICggbGV0IGYgPSAwOyBmIDwgZmFjZXM7IGYgKysgKSB7CgoJCQkJCQlpbWFnZXNbIGYgXSA9IHsgbWlwbWFwczogW10gfTsKCgkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRleERhdGFzLm1pcG1hcENvdW50OyBpICsrICkgewoKCQkJCQkJCWltYWdlc1sgZiBdLm1pcG1hcHMucHVzaCggdGV4RGF0YXMubWlwbWFwc1sgZiAqIHRleERhdGFzLm1pcG1hcENvdW50ICsgaSBdICk7CgkJCQkJCQlpbWFnZXNbIGYgXS5mb3JtYXQgPSB0ZXhEYXRhcy5mb3JtYXQ7CgkJCQkJCQlpbWFnZXNbIGYgXS53aWR0aCA9IHRleERhdGFzLndpZHRoOwoJCQkJCQkJaW1hZ2VzWyBmIF0uaGVpZ2h0ID0gdGV4RGF0YXMuaGVpZ2h0OwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCXRleHR1cmUuaW1hZ2UgPSBpbWFnZXM7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGV4dHVyZS5pbWFnZS53aWR0aCA9IHRleERhdGFzLndpZHRoOwoJCQkJCXRleHR1cmUuaW1hZ2UuaGVpZ2h0ID0gdGV4RGF0YXMuaGVpZ2h0OwoJCQkJCXRleHR1cmUubWlwbWFwcyA9IHRleERhdGFzLm1pcG1hcHM7CgoJCQkJfQoKCQkJCWlmICggdGV4RGF0YXMubWlwbWFwQ291bnQgPT09IDEgKSB7CgoJCQkJCXRleHR1cmUubWluRmlsdGVyID0gTGluZWFyRmlsdGVyOwoKCQkJCX0KCgkJCQl0ZXh0dXJlLmZvcm1hdCA9IHRleERhdGFzLmZvcm1hdDsKCQkJCXRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCB0ZXh0dXJlICk7CgoJCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoJCX0KCgkJcmV0dXJuIHRleHR1cmU7CgoJfQoKfQoKY2xhc3MgSW1hZ2VMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQlzdXBlciggbWFuYWdlciApOwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJaWYgKCB0aGlzLnBhdGggIT09IHVuZGVmaW5lZCApIHVybCA9IHRoaXMucGF0aCArIHVybDsKCgkJdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwoIHVybCApOwoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCWNvbnN0IGNhY2hlZCA9IENhY2hlLmdldCggdXJsICk7CgoJCWlmICggY2FjaGVkICE9PSB1bmRlZmluZWQgKSB7CgoJCQlzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgoJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7CgoJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIGNhY2hlZCApOwoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQl9LCAwICk7CgoJCQlyZXR1cm4gY2FjaGVkOwoKCQl9CgoJCWNvbnN0IGltYWdlID0gY3JlYXRlRWxlbWVudE5TKCAnaW1nJyApOwoKCQlmdW5jdGlvbiBvbkltYWdlTG9hZCgpIHsKCgkJCXJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CgoJCQlDYWNoZS5hZGQoIHVybCwgdGhpcyApOwoKCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIHRoaXMgKTsKCgkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCX0KCgkJZnVuY3Rpb24gb25JbWFnZUVycm9yKCBldmVudCApIHsKCgkJCXJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CgoJCQlpZiAoIG9uRXJyb3IgKSBvbkVycm9yKCBldmVudCApOwoKCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkgewoKCQkJaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBvbkltYWdlTG9hZCwgZmFsc2UgKTsKCQkJaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKCQl9CgoJCWltYWdlLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgb25JbWFnZUxvYWQsIGZhbHNlICk7CgkJaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKCQlpZiAoIHVybC5zbGljZSggMCwgNSApICE9PSAnZGF0YTonICkgewoKCQkJaWYgKCB0aGlzLmNyb3NzT3JpZ2luICE9PSB1bmRlZmluZWQgKSBpbWFnZS5jcm9zc09yaWdpbiA9IHRoaXMuY3Jvc3NPcmlnaW47CgoJCX0KCgkJc2NvcGUubWFuYWdlci5pdGVtU3RhcnQoIHVybCApOwoKCQlpbWFnZS5zcmMgPSB1cmw7CgoJCXJldHVybiBpbWFnZTsKCgl9Cgp9CgpjbGFzcyBDdWJlVGV4dHVyZUxvYWRlciBleHRlbmRzIExvYWRlciB7CgoJY29uc3RydWN0b3IoIG1hbmFnZXIgKSB7CgoJCXN1cGVyKCBtYW5hZ2VyICk7CgoJfQoKCWxvYWQoIHVybHMsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3QgdGV4dHVyZSA9IG5ldyBDdWJlVGV4dHVyZSgpOwoJCXRleHR1cmUuY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgSW1hZ2VMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCWxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5jcm9zc09yaWdpbiApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCgkJbGV0IGxvYWRlZCA9IDA7CgoJCWZ1bmN0aW9uIGxvYWRUZXh0dXJlKCBpICkgewoKCQkJbG9hZGVyLmxvYWQoIHVybHNbIGkgXSwgZnVuY3Rpb24gKCBpbWFnZSApIHsKCgkJCQl0ZXh0dXJlLmltYWdlc1sgaSBdID0gaW1hZ2U7CgoJCQkJbG9hZGVkICsrOwoKCQkJCWlmICggbG9hZGVkID09PSA2ICkgewoKCQkJCQl0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIHRleHR1cmUgKTsKCgkJCQl9CgoJCQl9LCB1bmRlZmluZWQsIG9uRXJyb3IgKTsKCgkJfQoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB1cmxzLmxlbmd0aDsgKysgaSApIHsKCgkJCWxvYWRUZXh0dXJlKCBpICk7CgoJCX0KCgkJcmV0dXJuIHRleHR1cmU7CgoJfQoKfQoKLyoqCiAqIEFic3RyYWN0IEJhc2UgY2xhc3MgdG8gbG9hZCBnZW5lcmljIGJpbmFyeSB0ZXh0dXJlcyBmb3JtYXRzIChyZ2JlLCBoZHIsIC4uLikKICoKICogU3ViIGNsYXNzZXMgaGF2ZSB0byBpbXBsZW1lbnQgdGhlIHBhcnNlKCkgbWV0aG9kIHdoaWNoIHdpbGwgYmUgdXNlZCBpbiBsb2FkKCkuCiAqLwoKY2xhc3MgRGF0YVRleHR1cmVMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQlzdXBlciggbWFuYWdlciApOwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCB0ZXh0dXJlID0gbmV3IERhdGFUZXh0dXJlKCk7CgoJCWNvbnN0IGxvYWRlciA9IG5ldyBGaWxlTG9hZGVyKCB0aGlzLm1hbmFnZXIgKTsKCQlsb2FkZXIuc2V0UmVzcG9uc2VUeXBlKCAnYXJyYXlidWZmZXInICk7CgkJbG9hZGVyLnNldFJlcXVlc3RIZWFkZXIoIHRoaXMucmVxdWVzdEhlYWRlciApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCQlsb2FkZXIuc2V0V2l0aENyZWRlbnRpYWxzKCBzY29wZS53aXRoQ3JlZGVudGlhbHMgKTsKCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIGJ1ZmZlciApIHsKCgkJCWxldCB0ZXhEYXRhOwoKCQkJdHJ5IHsKCgkJCQl0ZXhEYXRhID0gc2NvcGUucGFyc2UoIGJ1ZmZlciApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWlmICggb25FcnJvciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlvbkVycm9yKCBlcnJvciApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWNvbnNvbGUuZXJyb3IoIGVycm9yICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggdGV4RGF0YS5pbWFnZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUuaW1hZ2UgPSB0ZXhEYXRhLmltYWdlOwoKCQkJfSBlbHNlIGlmICggdGV4RGF0YS5kYXRhICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGV4dHVyZS5pbWFnZS53aWR0aCA9IHRleERhdGEud2lkdGg7CgkJCQl0ZXh0dXJlLmltYWdlLmhlaWdodCA9IHRleERhdGEuaGVpZ2h0OwoJCQkJdGV4dHVyZS5pbWFnZS5kYXRhID0gdGV4RGF0YS5kYXRhOwoKCQkJfQoKCQkJdGV4dHVyZS53cmFwUyA9IHRleERhdGEud3JhcFMgIT09IHVuZGVmaW5lZCA/IHRleERhdGEud3JhcFMgOiBDbGFtcFRvRWRnZVdyYXBwaW5nOwoJCQl0ZXh0dXJlLndyYXBUID0gdGV4RGF0YS53cmFwVCAhPT0gdW5kZWZpbmVkID8gdGV4RGF0YS53cmFwVCA6IENsYW1wVG9FZGdlV3JhcHBpbmc7CgoJCQl0ZXh0dXJlLm1hZ0ZpbHRlciA9IHRleERhdGEubWFnRmlsdGVyICE9PSB1bmRlZmluZWQgPyB0ZXhEYXRhLm1hZ0ZpbHRlciA6IExpbmVhckZpbHRlcjsKCQkJdGV4dHVyZS5taW5GaWx0ZXIgPSB0ZXhEYXRhLm1pbkZpbHRlciAhPT0gdW5kZWZpbmVkID8gdGV4RGF0YS5taW5GaWx0ZXIgOiBMaW5lYXJGaWx0ZXI7CgoJCQl0ZXh0dXJlLmFuaXNvdHJvcHkgPSB0ZXhEYXRhLmFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCA/IHRleERhdGEuYW5pc290cm9weSA6IDE7CgoJCQlpZiAoIHRleERhdGEuY29sb3JTcGFjZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUuY29sb3JTcGFjZSA9IHRleERhdGEuY29sb3JTcGFjZTsKCgkJCX0gZWxzZSBpZiAoIHRleERhdGEuZW5jb2RpbmcgIT09IHVuZGVmaW5lZCApIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTIKCgkJCQl0ZXh0dXJlLmVuY29kaW5nID0gdGV4RGF0YS5lbmNvZGluZzsKCgkJCX0KCgkJCWlmICggdGV4RGF0YS5mbGlwWSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUuZmxpcFkgPSB0ZXhEYXRhLmZsaXBZOwoKCQkJfQoKCQkJaWYgKCB0ZXhEYXRhLmZvcm1hdCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUuZm9ybWF0ID0gdGV4RGF0YS5mb3JtYXQ7CgoJCQl9CgoJCQlpZiAoIHRleERhdGEudHlwZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUudHlwZSA9IHRleERhdGEudHlwZTsKCgkJCX0KCgkJCWlmICggdGV4RGF0YS5taXBtYXBzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGV4dHVyZS5taXBtYXBzID0gdGV4RGF0YS5taXBtYXBzOwoJCQkJdGV4dHVyZS5taW5GaWx0ZXIgPSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXI7IC8vIHByZXN1bWFibHkuLi4KCgkJCX0KCgkJCWlmICggdGV4RGF0YS5taXBtYXBDb3VudCA9PT0gMSApIHsKCgkJCQl0ZXh0dXJlLm1pbkZpbHRlciA9IExpbmVhckZpbHRlcjsKCgkJCX0KCgkJCWlmICggdGV4RGF0YS5nZW5lcmF0ZU1pcG1hcHMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IHRleERhdGEuZ2VuZXJhdGVNaXBtYXBzOwoKCQkJfQoKCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggdGV4dHVyZSwgdGV4RGF0YSApOwoKCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoKCQlyZXR1cm4gdGV4dHVyZTsKCgl9Cgp9CgpjbGFzcyBUZXh0dXJlTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJc3VwZXIoIG1hbmFnZXIgKTsKCgl9CgoJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgSW1hZ2VMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCWxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5jcm9zc09yaWdpbiApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCgkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCBpbWFnZSApIHsKCgkJCXRleHR1cmUuaW1hZ2UgPSBpbWFnZTsKCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQlpZiAoIG9uTG9hZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCW9uTG9hZCggdGV4dHVyZSApOwoKCQkJfQoKCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoJCXJldHVybiB0ZXh0dXJlOwoKCX0KCn0KCmNsYXNzIExpZ2h0IGV4dGVuZHMgT2JqZWN0M0QgewoKCWNvbnN0cnVjdG9yKCBjb2xvciwgaW50ZW5zaXR5ID0gMSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0xpZ2h0ID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0xpZ2h0JzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggY29sb3IgKTsKCQl0aGlzLmludGVuc2l0eSA9IGludGVuc2l0eTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJLy8gRW1wdHkgaGVyZSBpbiBiYXNlIGNsYXNzOyBzb21lIHN1YmNsYXNzZXMgb3ZlcnJpZGUuCgoJfQoKCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoJCXRoaXMuaW50ZW5zaXR5ID0gc291cmNlLmludGVuc2l0eTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQlkYXRhLm9iamVjdC5jb2xvciA9IHRoaXMuY29sb3IuZ2V0SGV4KCk7CgkJZGF0YS5vYmplY3QuaW50ZW5zaXR5ID0gdGhpcy5pbnRlbnNpdHk7CgoJCWlmICggdGhpcy5ncm91bmRDb2xvciAhPT0gdW5kZWZpbmVkICkgZGF0YS5vYmplY3QuZ3JvdW5kQ29sb3IgPSB0aGlzLmdyb3VuZENvbG9yLmdldEhleCgpOwoKCQlpZiAoIHRoaXMuZGlzdGFuY2UgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0LmRpc3RhbmNlID0gdGhpcy5kaXN0YW5jZTsKCQlpZiAoIHRoaXMuYW5nbGUgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0LmFuZ2xlID0gdGhpcy5hbmdsZTsKCQlpZiAoIHRoaXMuZGVjYXkgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0LmRlY2F5ID0gdGhpcy5kZWNheTsKCQlpZiAoIHRoaXMucGVudW1icmEgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0LnBlbnVtYnJhID0gdGhpcy5wZW51bWJyYTsKCgkJaWYgKCB0aGlzLnNoYWRvdyAhPT0gdW5kZWZpbmVkICkgZGF0YS5vYmplY3Quc2hhZG93ID0gdGhpcy5zaGFkb3cudG9KU09OKCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNsYXNzIEhlbWlzcGhlcmVMaWdodCBleHRlbmRzIExpZ2h0IHsKCgljb25zdHJ1Y3Rvciggc2t5Q29sb3IsIGdyb3VuZENvbG9yLCBpbnRlbnNpdHkgKSB7CgoJCXN1cGVyKCBza3lDb2xvciwgaW50ZW5zaXR5ICk7CgoJCXRoaXMuaXNIZW1pc3BoZXJlTGlnaHQgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnSGVtaXNwaGVyZUxpZ2h0JzsKCgkJdGhpcy5wb3NpdGlvbi5jb3B5KCBPYmplY3QzRC5ERUZBVUxUX1VQICk7CgkJdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy5ncm91bmRDb2xvciA9IG5ldyBDb2xvciggZ3JvdW5kQ29sb3IgKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMuZ3JvdW5kQ29sb3IuY29weSggc291cmNlLmdyb3VuZENvbG9yICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNvbnN0IF9wcm9qU2NyZWVuTWF0cml4JDEgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9saWdodFBvc2l0aW9uV29ybGQkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX2xvb2tUYXJnZXQkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIExpZ2h0U2hhZG93IHsKCgljb25zdHJ1Y3RvciggY2FtZXJhICkgewoKCQl0aGlzLmNhbWVyYSA9IGNhbWVyYTsKCgkJdGhpcy5iaWFzID0gMDsKCQl0aGlzLm5vcm1hbEJpYXMgPSAwOwoJCXRoaXMucmFkaXVzID0gMTsKCQl0aGlzLmJsdXJTYW1wbGVzID0gODsKCgkJdGhpcy5tYXBTaXplID0gbmV3IFZlY3RvcjIoIDUxMiwgNTEyICk7CgoJCXRoaXMubWFwID0gbnVsbDsKCQl0aGlzLm1hcFBhc3MgPSBudWxsOwoJCXRoaXMubWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCgkJdGhpcy5hdXRvVXBkYXRlID0gdHJ1ZTsKCQl0aGlzLm5lZWRzVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwoJCXRoaXMuX2ZyYW1lRXh0ZW50cyA9IG5ldyBWZWN0b3IyKCAxLCAxICk7CgoJCXRoaXMuX3ZpZXdwb3J0Q291bnQgPSAxOwoKCQl0aGlzLl92aWV3cG9ydHMgPSBbCgoJCQluZXcgVmVjdG9yNCggMCwgMCwgMSwgMSApCgoJCV07CgoJfQoKCWdldFZpZXdwb3J0Q291bnQoKSB7CgoJCXJldHVybiB0aGlzLl92aWV3cG9ydENvdW50OwoKCX0KCglnZXRGcnVzdHVtKCkgewoKCQlyZXR1cm4gdGhpcy5fZnJ1c3R1bTsKCgl9CgoJdXBkYXRlTWF0cmljZXMoIGxpZ2h0ICkgewoKCQljb25zdCBzaGFkb3dDYW1lcmEgPSB0aGlzLmNhbWVyYTsKCQljb25zdCBzaGFkb3dNYXRyaXggPSB0aGlzLm1hdHJpeDsKCgkJX2xpZ2h0UG9zaXRpb25Xb3JsZCQxLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQlzaGFkb3dDYW1lcmEucG9zaXRpb24uY29weSggX2xpZ2h0UG9zaXRpb25Xb3JsZCQxICk7CgoJCV9sb29rVGFyZ2V0JDEuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC50YXJnZXQubWF0cml4V29ybGQgKTsKCQlzaGFkb3dDYW1lcmEubG9va0F0KCBfbG9va1RhcmdldCQxICk7CgkJc2hhZG93Q2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCV9wcm9qU2NyZWVuTWF0cml4JDEubXVsdGlwbHlNYXRyaWNlcyggc2hhZG93Q2FtZXJhLnByb2plY3Rpb25NYXRyaXgsIHNoYWRvd0NhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCQl0aGlzLl9mcnVzdHVtLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KCBfcHJvalNjcmVlbk1hdHJpeCQxICk7CgoJCXNoYWRvd01hdHJpeC5zZXQoCgkJCTAuNSwgMC4wLCAwLjAsIDAuNSwKCQkJMC4wLCAwLjUsIDAuMCwgMC41LAoJCQkwLjAsIDAuMCwgMC41LCAwLjUsCgkJCTAuMCwgMC4wLCAwLjAsIDEuMAoJCSk7CgoJCXNoYWRvd01hdHJpeC5tdWx0aXBseSggX3Byb2pTY3JlZW5NYXRyaXgkMSApOwoKCX0KCglnZXRWaWV3cG9ydCggdmlld3BvcnRJbmRleCApIHsKCgkJcmV0dXJuIHRoaXMuX3ZpZXdwb3J0c1sgdmlld3BvcnRJbmRleCBdOwoKCX0KCglnZXRGcmFtZUV4dGVudHMoKSB7CgoJCXJldHVybiB0aGlzLl9mcmFtZUV4dGVudHM7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCWlmICggdGhpcy5tYXAgKSB7CgoJCQl0aGlzLm1hcC5kaXNwb3NlKCk7CgoJCX0KCgkJaWYgKCB0aGlzLm1hcFBhc3MgKSB7CgoJCQl0aGlzLm1hcFBhc3MuZGlzcG9zZSgpOwoKCQl9CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy5jYW1lcmEgPSBzb3VyY2UuY2FtZXJhLmNsb25lKCk7CgoJCXRoaXMuYmlhcyA9IHNvdXJjZS5iaWFzOwoJCXRoaXMucmFkaXVzID0gc291cmNlLnJhZGl1czsKCgkJdGhpcy5tYXBTaXplLmNvcHkoIHNvdXJjZS5tYXBTaXplICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IG9iamVjdCA9IHt9OwoKCQlpZiAoIHRoaXMuYmlhcyAhPT0gMCApIG9iamVjdC5iaWFzID0gdGhpcy5iaWFzOwoJCWlmICggdGhpcy5ub3JtYWxCaWFzICE9PSAwICkgb2JqZWN0Lm5vcm1hbEJpYXMgPSB0aGlzLm5vcm1hbEJpYXM7CgkJaWYgKCB0aGlzLnJhZGl1cyAhPT0gMSApIG9iamVjdC5yYWRpdXMgPSB0aGlzLnJhZGl1czsKCQlpZiAoIHRoaXMubWFwU2l6ZS54ICE9PSA1MTIgfHwgdGhpcy5tYXBTaXplLnkgIT09IDUxMiApIG9iamVjdC5tYXBTaXplID0gdGhpcy5tYXBTaXplLnRvQXJyYXkoKTsKCgkJb2JqZWN0LmNhbWVyYSA9IHRoaXMuY2FtZXJhLnRvSlNPTiggZmFsc2UgKS5vYmplY3Q7CgkJZGVsZXRlIG9iamVjdC5jYW1lcmEubWF0cml4OwoKCQlyZXR1cm4gb2JqZWN0OwoKCX0KCn0KCmNsYXNzIFNwb3RMaWdodFNoYWRvdyBleHRlbmRzIExpZ2h0U2hhZG93IHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoIG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggNTAsIDEsIDAuNSwgNTAwICkgKTsKCgkJdGhpcy5pc1Nwb3RMaWdodFNoYWRvdyA9IHRydWU7CgoJCXRoaXMuZm9jdXMgPSAxOwoKCX0KCgl1cGRhdGVNYXRyaWNlcyggbGlnaHQgKSB7CgoJCWNvbnN0IGNhbWVyYSA9IHRoaXMuY2FtZXJhOwoKCQljb25zdCBmb3YgPSBSQUQyREVHICogMiAqIGxpZ2h0LmFuZ2xlICogdGhpcy5mb2N1czsKCQljb25zdCBhc3BlY3QgPSB0aGlzLm1hcFNpemUud2lkdGggLyB0aGlzLm1hcFNpemUuaGVpZ2h0OwoJCWNvbnN0IGZhciA9IGxpZ2h0LmRpc3RhbmNlIHx8IGNhbWVyYS5mYXI7CgoJCWlmICggZm92ICE9PSBjYW1lcmEuZm92IHx8IGFzcGVjdCAhPT0gY2FtZXJhLmFzcGVjdCB8fCBmYXIgIT09IGNhbWVyYS5mYXIgKSB7CgoJCQljYW1lcmEuZm92ID0gZm92OwoJCQljYW1lcmEuYXNwZWN0ID0gYXNwZWN0OwoJCQljYW1lcmEuZmFyID0gZmFyOwoJCQljYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCXN1cGVyLnVwZGF0ZU1hdHJpY2VzKCBsaWdodCApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmZvY3VzID0gc291cmNlLmZvY3VzOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBTcG90TGlnaHQgZXh0ZW5kcyBMaWdodCB7CgoJY29uc3RydWN0b3IoIGNvbG9yLCBpbnRlbnNpdHksIGRpc3RhbmNlID0gMCwgYW5nbGUgPSBNYXRoLlBJIC8gMywgcGVudW1icmEgPSAwLCBkZWNheSA9IDIgKSB7CgoJCXN1cGVyKCBjb2xvciwgaW50ZW5zaXR5ICk7CgoJCXRoaXMuaXNTcG90TGlnaHQgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnU3BvdExpZ2h0JzsKCgkJdGhpcy5wb3NpdGlvbi5jb3B5KCBPYmplY3QzRC5ERUZBVUxUX1VQICk7CgkJdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy50YXJnZXQgPSBuZXcgT2JqZWN0M0QoKTsKCgkJdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwoJCXRoaXMuYW5nbGUgPSBhbmdsZTsKCQl0aGlzLnBlbnVtYnJhID0gcGVudW1icmE7CgkJdGhpcy5kZWNheSA9IGRlY2F5OwoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMuc2hhZG93ID0gbmV3IFNwb3RMaWdodFNoYWRvdygpOwoKCX0KCglnZXQgcG93ZXIoKSB7CgoJCS8vIGNvbXB1dGUgdGhlIGxpZ2h0J3MgbHVtaW5vdXMgcG93ZXIgKGluIGx1bWVucykgZnJvbSBpdHMgaW50ZW5zaXR5IChpbiBjYW5kZWxhKQoJCS8vIGJ5IGNvbnZlbnRpb24gZm9yIGEgc3BvdGxpZ2h0LCBsdW1pbm91cyBwb3dlciAobG0pID0gz4AgKiBsdW1pbm91cyBpbnRlbnNpdHkgKGNkKQoJCXJldHVybiB0aGlzLmludGVuc2l0eSAqIE1hdGguUEk7CgoJfQoKCXNldCBwb3dlciggcG93ZXIgKSB7CgoJCS8vIHNldCB0aGUgbGlnaHQncyBpbnRlbnNpdHkgKGluIGNhbmRlbGEpIGZyb20gdGhlIGRlc2lyZWQgbHVtaW5vdXMgcG93ZXIgKGluIGx1bWVucykKCQl0aGlzLmludGVuc2l0eSA9IHBvd2VyIC8gTWF0aC5QSTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5zaGFkb3cuZGlzcG9zZSgpOwoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJdGhpcy5kaXN0YW5jZSA9IHNvdXJjZS5kaXN0YW5jZTsKCQl0aGlzLmFuZ2xlID0gc291cmNlLmFuZ2xlOwoJCXRoaXMucGVudW1icmEgPSBzb3VyY2UucGVudW1icmE7CgkJdGhpcy5kZWNheSA9IHNvdXJjZS5kZWNheTsKCgkJdGhpcy50YXJnZXQgPSBzb3VyY2UudGFyZ2V0LmNsb25lKCk7CgoJCXRoaXMuc2hhZG93ID0gc291cmNlLnNoYWRvdy5jbG9uZSgpOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9Cgpjb25zdCBfcHJvalNjcmVlbk1hdHJpeCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX2xpZ2h0UG9zaXRpb25Xb3JsZCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX2xvb2tUYXJnZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBQb2ludExpZ2h0U2hhZG93IGV4dGVuZHMgTGlnaHRTaGFkb3cgewoKCWNvbnN0cnVjdG9yKCkgewoKCQlzdXBlciggbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCA5MCwgMSwgMC41LCA1MDAgKSApOwoKCQl0aGlzLmlzUG9pbnRMaWdodFNoYWRvdyA9IHRydWU7CgoJCXRoaXMuX2ZyYW1lRXh0ZW50cyA9IG5ldyBWZWN0b3IyKCA0LCAyICk7CgoJCXRoaXMuX3ZpZXdwb3J0Q291bnQgPSA2OwoKCQl0aGlzLl92aWV3cG9ydHMgPSBbCgkJCS8vIFRoZXNlIHZpZXdwb3J0cyBtYXAgYSBjdWJlLW1hcCBvbnRvIGEgMkQgdGV4dHVyZSB3aXRoIHRoZQoJCQkvLyBmb2xsb3dpbmcgb3JpZW50YXRpb246CgkJCS8vCgkJCS8vICB4elhaCgkJCS8vICAgeSBZCgkJCS8vCgkJCS8vIFggLSBQb3NpdGl2ZSB4IGRpcmVjdGlvbgoJCQkvLyB4IC0gTmVnYXRpdmUgeCBkaXJlY3Rpb24KCQkJLy8gWSAtIFBvc2l0aXZlIHkgZGlyZWN0aW9uCgkJCS8vIHkgLSBOZWdhdGl2ZSB5IGRpcmVjdGlvbgoJCQkvLyBaIC0gUG9zaXRpdmUgeiBkaXJlY3Rpb24KCQkJLy8geiAtIE5lZ2F0aXZlIHogZGlyZWN0aW9uCgoJCQkvLyBwb3NpdGl2ZSBYCgkJCW5ldyBWZWN0b3I0KCAyLCAxLCAxLCAxICksCgkJCS8vIG5lZ2F0aXZlIFgKCQkJbmV3IFZlY3RvcjQoIDAsIDEsIDEsIDEgKSwKCQkJLy8gcG9zaXRpdmUgWgoJCQluZXcgVmVjdG9yNCggMywgMSwgMSwgMSApLAoJCQkvLyBuZWdhdGl2ZSBaCgkJCW5ldyBWZWN0b3I0KCAxLCAxLCAxLCAxICksCgkJCS8vIHBvc2l0aXZlIFkKCQkJbmV3IFZlY3RvcjQoIDMsIDAsIDEsIDEgKSwKCQkJLy8gbmVnYXRpdmUgWQoJCQluZXcgVmVjdG9yNCggMSwgMCwgMSwgMSApCgkJXTsKCgkJdGhpcy5fY3ViZURpcmVjdGlvbnMgPSBbCgkJCW5ldyBWZWN0b3IzKCAxLCAwLCAwICksIG5ldyBWZWN0b3IzKCAtIDEsIDAsIDAgKSwgbmV3IFZlY3RvcjMoIDAsIDAsIDEgKSwKCQkJbmV3IFZlY3RvcjMoIDAsIDAsIC0gMSApLCBuZXcgVmVjdG9yMyggMCwgMSwgMCApLCBuZXcgVmVjdG9yMyggMCwgLSAxLCAwICkKCQldOwoKCQl0aGlzLl9jdWJlVXBzID0gWwoJCQluZXcgVmVjdG9yMyggMCwgMSwgMCApLCBuZXcgVmVjdG9yMyggMCwgMSwgMCApLCBuZXcgVmVjdG9yMyggMCwgMSwgMCApLAoJCQluZXcgVmVjdG9yMyggMCwgMSwgMCApLCBuZXcgVmVjdG9yMyggMCwgMCwgMSApLAluZXcgVmVjdG9yMyggMCwgMCwgLSAxICkKCQldOwoKCX0KCgl1cGRhdGVNYXRyaWNlcyggbGlnaHQsIHZpZXdwb3J0SW5kZXggPSAwICkgewoKCQljb25zdCBjYW1lcmEgPSB0aGlzLmNhbWVyYTsKCQljb25zdCBzaGFkb3dNYXRyaXggPSB0aGlzLm1hdHJpeDsKCgkJY29uc3QgZmFyID0gbGlnaHQuZGlzdGFuY2UgfHwgY2FtZXJhLmZhcjsKCgkJaWYgKCBmYXIgIT09IGNhbWVyYS5mYXIgKSB7CgoJCQljYW1lcmEuZmFyID0gZmFyOwoJCQljYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCV9saWdodFBvc2l0aW9uV29ybGQuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCWNhbWVyYS5wb3NpdGlvbi5jb3B5KCBfbGlnaHRQb3NpdGlvbldvcmxkICk7CgoJCV9sb29rVGFyZ2V0LmNvcHkoIGNhbWVyYS5wb3NpdGlvbiApOwoJCV9sb29rVGFyZ2V0LmFkZCggdGhpcy5fY3ViZURpcmVjdGlvbnNbIHZpZXdwb3J0SW5kZXggXSApOwoJCWNhbWVyYS51cC5jb3B5KCB0aGlzLl9jdWJlVXBzWyB2aWV3cG9ydEluZGV4IF0gKTsKCQljYW1lcmEubG9va0F0KCBfbG9va1RhcmdldCApOwoJCWNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQlzaGFkb3dNYXRyaXgubWFrZVRyYW5zbGF0aW9uKCAtIF9saWdodFBvc2l0aW9uV29ybGQueCwgLSBfbGlnaHRQb3NpdGlvbldvcmxkLnksIC0gX2xpZ2h0UG9zaXRpb25Xb3JsZC56ICk7CgoJCV9wcm9qU2NyZWVuTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CgkJdGhpcy5fZnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgl9Cgp9CgpjbGFzcyBQb2ludExpZ2h0IGV4dGVuZHMgTGlnaHQgewoKCWNvbnN0cnVjdG9yKCBjb2xvciwgaW50ZW5zaXR5LCBkaXN0YW5jZSA9IDAsIGRlY2F5ID0gMiApIHsKCgkJc3VwZXIoIGNvbG9yLCBpbnRlbnNpdHkgKTsKCgkJdGhpcy5pc1BvaW50TGlnaHQgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUG9pbnRMaWdodCc7CgoJCXRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKCQl0aGlzLmRlY2F5ID0gZGVjYXk7CgoJCXRoaXMuc2hhZG93ID0gbmV3IFBvaW50TGlnaHRTaGFkb3coKTsKCgl9CgoJZ2V0IHBvd2VyKCkgewoKCQkvLyBjb21wdXRlIHRoZSBsaWdodCdzIGx1bWlub3VzIHBvd2VyIChpbiBsdW1lbnMpIGZyb20gaXRzIGludGVuc2l0eSAoaW4gY2FuZGVsYSkKCQkvLyBmb3IgYW4gaXNvdHJvcGljIGxpZ2h0IHNvdXJjZSwgbHVtaW5vdXMgcG93ZXIgKGxtKSA9IDQgz4AgbHVtaW5vdXMgaW50ZW5zaXR5IChjZCkKCQlyZXR1cm4gdGhpcy5pbnRlbnNpdHkgKiA0ICogTWF0aC5QSTsKCgl9CgoJc2V0IHBvd2VyKCBwb3dlciApIHsKCgkJLy8gc2V0IHRoZSBsaWdodCdzIGludGVuc2l0eSAoaW4gY2FuZGVsYSkgZnJvbSB0aGUgZGVzaXJlZCBsdW1pbm91cyBwb3dlciAoaW4gbHVtZW5zKQoJCXRoaXMuaW50ZW5zaXR5ID0gcG93ZXIgLyAoIDQgKiBNYXRoLlBJICk7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuc2hhZG93LmRpc3Bvc2UoKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMuZGlzdGFuY2UgPSBzb3VyY2UuZGlzdGFuY2U7CgkJdGhpcy5kZWNheSA9IHNvdXJjZS5kZWNheTsKCgkJdGhpcy5zaGFkb3cgPSBzb3VyY2Uuc2hhZG93LmNsb25lKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZXh0ZW5kcyBMaWdodFNoYWRvdyB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCBuZXcgT3J0aG9ncmFwaGljQ2FtZXJhKCAtIDUsIDUsIDUsIC0gNSwgMC41LCA1MDAgKSApOwoKCQl0aGlzLmlzRGlyZWN0aW9uYWxMaWdodFNoYWRvdyA9IHRydWU7CgoJfQoKfQoKY2xhc3MgRGlyZWN0aW9uYWxMaWdodCBleHRlbmRzIExpZ2h0IHsKCgljb25zdHJ1Y3RvciggY29sb3IsIGludGVuc2l0eSApIHsKCgkJc3VwZXIoIGNvbG9yLCBpbnRlbnNpdHkgKTsKCgkJdGhpcy5pc0RpcmVjdGlvbmFsTGlnaHQgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnRGlyZWN0aW9uYWxMaWdodCc7CgoJCXRoaXMucG9zaXRpb24uY29weSggT2JqZWN0M0QuREVGQVVMVF9VUCApOwoJCXRoaXMudXBkYXRlTWF0cml4KCk7CgoJCXRoaXMudGFyZ2V0ID0gbmV3IE9iamVjdDNEKCk7CgoJCXRoaXMuc2hhZG93ID0gbmV3IERpcmVjdGlvbmFsTGlnaHRTaGFkb3coKTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5zaGFkb3cuZGlzcG9zZSgpOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnRhcmdldCA9IHNvdXJjZS50YXJnZXQuY2xvbmUoKTsKCQl0aGlzLnNoYWRvdyA9IHNvdXJjZS5zaGFkb3cuY2xvbmUoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgQW1iaWVudExpZ2h0IGV4dGVuZHMgTGlnaHQgewoKCWNvbnN0cnVjdG9yKCBjb2xvciwgaW50ZW5zaXR5ICkgewoKCQlzdXBlciggY29sb3IsIGludGVuc2l0eSApOwoKCQl0aGlzLmlzQW1iaWVudExpZ2h0ID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0FtYmllbnRMaWdodCc7CgoJfQoKfQoKY2xhc3MgUmVjdEFyZWFMaWdodCBleHRlbmRzIExpZ2h0IHsKCgljb25zdHJ1Y3RvciggY29sb3IsIGludGVuc2l0eSwgd2lkdGggPSAxMCwgaGVpZ2h0ID0gMTAgKSB7CgoJCXN1cGVyKCBjb2xvciwgaW50ZW5zaXR5ICk7CgoJCXRoaXMuaXNSZWN0QXJlYUxpZ2h0ID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1JlY3RBcmVhTGlnaHQnOwoKCQl0aGlzLndpZHRoID0gd2lkdGg7CgkJdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgoJfQoKCWdldCBwb3dlcigpIHsKCgkJLy8gY29tcHV0ZSB0aGUgbGlnaHQncyBsdW1pbm91cyBwb3dlciAoaW4gbHVtZW5zKSBmcm9tIGl0cyBpbnRlbnNpdHkgKGluIG5pdHMpCgkJcmV0dXJuIHRoaXMuaW50ZW5zaXR5ICogdGhpcy53aWR0aCAqIHRoaXMuaGVpZ2h0ICogTWF0aC5QSTsKCgl9CgoJc2V0IHBvd2VyKCBwb3dlciApIHsKCgkJLy8gc2V0IHRoZSBsaWdodCdzIGludGVuc2l0eSAoaW4gbml0cykgZnJvbSB0aGUgZGVzaXJlZCBsdW1pbm91cyBwb3dlciAoaW4gbHVtZW5zKQoJCXRoaXMuaW50ZW5zaXR5ID0gcG93ZXIgLyAoIHRoaXMud2lkdGggKiB0aGlzLmhlaWdodCAqIE1hdGguUEkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy53aWR0aCA9IHNvdXJjZS53aWR0aDsKCQl0aGlzLmhlaWdodCA9IHNvdXJjZS5oZWlnaHQ7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJZGF0YS5vYmplY3Qud2lkdGggPSB0aGlzLndpZHRoOwoJCWRhdGEub2JqZWN0LmhlaWdodCA9IHRoaXMuaGVpZ2h0OwoKCQlyZXR1cm4gZGF0YTsKCgl9Cgp9CgovKioKICogUHJpbWFyeSByZWZlcmVuY2U6CiAqICAgaHR0cHM6Ly9ncmFwaGljcy5zdGFuZm9yZC5lZHUvcGFwZXJzL2Vudm1hcC9lbnZtYXAucGRmCiAqCiAqIFNlY29uZGFyeSByZWZlcmVuY2U6CiAqICAgaHR0cHM6Ly93d3cucHBzbG9hbi5vcmcvcHVibGljYXRpb25zL1N0dXBpZFNIMzYucGRmCiAqLwoKLy8gMy1iYW5kIFNIIGRlZmluZWQgYnkgOSBjb2VmZmljaWVudHMKCmNsYXNzIFNwaGVyaWNhbEhhcm1vbmljczMgewoKCWNvbnN0cnVjdG9yKCkgewoKCQl0aGlzLmlzU3BoZXJpY2FsSGFybW9uaWNzMyA9IHRydWU7CgoJCXRoaXMuY29lZmZpY2llbnRzID0gW107CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50cy5wdXNoKCBuZXcgVmVjdG9yMygpICk7CgoJCX0KCgl9CgoJc2V0KCBjb2VmZmljaWVudHMgKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50c1sgaSBdLmNvcHkoIGNvZWZmaWNpZW50c1sgaSBdICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXplcm8oKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50c1sgaSBdLnNldCggMCwgMCwgMCApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgkvLyBnZXQgdGhlIHJhZGlhbmNlIGluIHRoZSBkaXJlY3Rpb24gb2YgdGhlIG5vcm1hbAoJLy8gdGFyZ2V0IGlzIGEgVmVjdG9yMwoJZ2V0QXQoIG5vcm1hbCwgdGFyZ2V0ICkgewoKCQkvLyBub3JtYWwgaXMgYXNzdW1lZCB0byBiZSB1bml0IGxlbmd0aAoKCQljb25zdCB4ID0gbm9ybWFsLngsIHkgPSBub3JtYWwueSwgeiA9IG5vcm1hbC56OwoKCQljb25zdCBjb2VmZiA9IHRoaXMuY29lZmZpY2llbnRzOwoKCQkvLyBiYW5kIDAKCQl0YXJnZXQuY29weSggY29lZmZbIDAgXSApLm11bHRpcGx5U2NhbGFyKCAwLjI4MjA5NSApOwoKCQkvLyBiYW5kIDEKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgMSBdLCAwLjQ4ODYwMyAqIHkgKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgMiBdLCAwLjQ4ODYwMyAqIHogKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgMyBdLCAwLjQ4ODYwMyAqIHggKTsKCgkJLy8gYmFuZCAyCgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDQgXSwgMS4wOTI1NDggKiAoIHggKiB5ICkgKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgNSBdLCAxLjA5MjU0OCAqICggeSAqIHogKSApOwoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyA2IF0sIDAuMzE1MzkyICogKCAzLjAgKiB6ICogeiAtIDEuMCApICk7CgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDcgXSwgMS4wOTI1NDggKiAoIHggKiB6ICkgKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgOCBdLCAwLjU0NjI3NCAqICggeCAqIHggLSB5ICogeSApICk7CgoJCXJldHVybiB0YXJnZXQ7CgoJfQoKCS8vIGdldCB0aGUgaXJyYWRpYW5jZSAocmFkaWFuY2UgY29udm9sdmVkIHdpdGggY29zaW5lIGxvYmUpIGluIHRoZSBkaXJlY3Rpb24gb2YgdGhlIG5vcm1hbAoJLy8gdGFyZ2V0IGlzIGEgVmVjdG9yMwoJLy8gaHR0cHM6Ly9ncmFwaGljcy5zdGFuZm9yZC5lZHUvcGFwZXJzL2Vudm1hcC9lbnZtYXAucGRmCglnZXRJcnJhZGlhbmNlQXQoIG5vcm1hbCwgdGFyZ2V0ICkgewoKCQkvLyBub3JtYWwgaXMgYXNzdW1lZCB0byBiZSB1bml0IGxlbmd0aAoKCQljb25zdCB4ID0gbm9ybWFsLngsIHkgPSBub3JtYWwueSwgeiA9IG5vcm1hbC56OwoKCQljb25zdCBjb2VmZiA9IHRoaXMuY29lZmZpY2llbnRzOwoKCQkvLyBiYW5kIDAKCQl0YXJnZXQuY29weSggY29lZmZbIDAgXSApLm11bHRpcGx5U2NhbGFyKCAwLjg4NjIyNyApOyAvLyDPgCAqIDAuMjgyMDk1CgoJCS8vIGJhbmQgMQoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyAxIF0sIDIuMCAqIDAuNTExNjY0ICogeSApOyAvLyAoIDIgKiDPgCAvIDMgKSAqIDAuNDg4NjAzCgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDIgXSwgMi4wICogMC41MTE2NjQgKiB6ICk7CgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDMgXSwgMi4wICogMC41MTE2NjQgKiB4ICk7CgoJCS8vIGJhbmQgMgoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyA0IF0sIDIuMCAqIDAuNDI5MDQzICogeCAqIHkgKTsgLy8gKCDPgCAvIDQgKSAqIDEuMDkyNTQ4CgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDUgXSwgMi4wICogMC40MjkwNDMgKiB5ICogeiApOwoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyA2IF0sIDAuNzQzMTI1ICogeiAqIHogLSAwLjI0NzcwOCApOyAvLyAoIM+AIC8gNCApICogMC4zMTUzOTIgKiAzCgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDcgXSwgMi4wICogMC40MjkwNDMgKiB4ICogeiApOwoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyA4IF0sIDAuNDI5MDQzICogKCB4ICogeCAtIHkgKiB5ICkgKTsgLy8gKCDPgCAvIDQgKSAqIDAuNTQ2Mjc0CgoJCXJldHVybiB0YXJnZXQ7CgoJfQoKCWFkZCggc2ggKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50c1sgaSBdLmFkZCggc2guY29lZmZpY2llbnRzWyBpIF0gKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkU2NhbGVkU0goIHNoLCBzICkgewoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJdGhpcy5jb2VmZmljaWVudHNbIGkgXS5hZGRTY2FsZWRWZWN0b3IoIHNoLmNvZWZmaWNpZW50c1sgaSBdLCBzICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNjYWxlKCBzICkgewoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJdGhpcy5jb2VmZmljaWVudHNbIGkgXS5tdWx0aXBseVNjYWxhciggcyApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglsZXJwKCBzaCwgYWxwaGEgKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50c1sgaSBdLmxlcnAoIHNoLmNvZWZmaWNpZW50c1sgaSBdLCBhbHBoYSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIHNoICkgewoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJaWYgKCAhIHRoaXMuY29lZmZpY2llbnRzWyBpIF0uZXF1YWxzKCBzaC5jb2VmZmljaWVudHNbIGkgXSApICkgewoKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJY29weSggc2ggKSB7CgoJCXJldHVybiB0aGlzLnNldCggc2guY29lZmZpY2llbnRzICk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCWNvbnN0IGNvZWZmaWNpZW50cyA9IHRoaXMuY29lZmZpY2llbnRzOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJY29lZmZpY2llbnRzWyBpIF0uZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ICsgKCBpICogMyApICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCWNvbnN0IGNvZWZmaWNpZW50cyA9IHRoaXMuY29lZmZpY2llbnRzOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJY29lZmZpY2llbnRzWyBpIF0udG9BcnJheSggYXJyYXksIG9mZnNldCArICggaSAqIDMgKSApOwoKCQl9CgoJCXJldHVybiBhcnJheTsKCgl9CgoJLy8gZXZhbHVhdGUgdGhlIGJhc2lzIGZ1bmN0aW9ucwoJLy8gc2hCYXNpcyBpcyBhbiBBcnJheVsgOSBdCglzdGF0aWMgZ2V0QmFzaXNBdCggbm9ybWFsLCBzaEJhc2lzICkgewoKCQkvLyBub3JtYWwgaXMgYXNzdW1lZCB0byBiZSB1bml0IGxlbmd0aAoKCQljb25zdCB4ID0gbm9ybWFsLngsIHkgPSBub3JtYWwueSwgeiA9IG5vcm1hbC56OwoKCQkvLyBiYW5kIDAKCQlzaEJhc2lzWyAwIF0gPSAwLjI4MjA5NTsKCgkJLy8gYmFuZCAxCgkJc2hCYXNpc1sgMSBdID0gMC40ODg2MDMgKiB5OwoJCXNoQmFzaXNbIDIgXSA9IDAuNDg4NjAzICogejsKCQlzaEJhc2lzWyAzIF0gPSAwLjQ4ODYwMyAqIHg7CgoJCS8vIGJhbmQgMgoJCXNoQmFzaXNbIDQgXSA9IDEuMDkyNTQ4ICogeCAqIHk7CgkJc2hCYXNpc1sgNSBdID0gMS4wOTI1NDggKiB5ICogejsKCQlzaEJhc2lzWyA2IF0gPSAwLjMxNTM5MiAqICggMyAqIHogKiB6IC0gMSApOwoJCXNoQmFzaXNbIDcgXSA9IDEuMDkyNTQ4ICogeCAqIHo7CgkJc2hCYXNpc1sgOCBdID0gMC41NDYyNzQgKiAoIHggKiB4IC0geSAqIHkgKTsKCgl9Cgp9CgpjbGFzcyBMaWdodFByb2JlIGV4dGVuZHMgTGlnaHQgewoKCWNvbnN0cnVjdG9yKCBzaCA9IG5ldyBTcGhlcmljYWxIYXJtb25pY3MzKCksIGludGVuc2l0eSA9IDEgKSB7CgoJCXN1cGVyKCB1bmRlZmluZWQsIGludGVuc2l0eSApOwoKCQl0aGlzLmlzTGlnaHRQcm9iZSA9IHRydWU7CgoJCXRoaXMuc2ggPSBzaDsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5zaC5jb3B5KCBzb3VyY2Uuc2ggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQl0aGlzLmludGVuc2l0eSA9IGpzb24uaW50ZW5zaXR5OyAvLyBUT0RPOiBNb3ZlIHRoaXMgYml0IHRvIExpZ2h0LmZyb21KU09OKCk7CgkJdGhpcy5zaC5mcm9tQXJyYXkoIGpzb24uc2ggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQlkYXRhLm9iamVjdC5zaCA9IHRoaXMuc2gudG9BcnJheSgpOwoKCQlyZXR1cm4gZGF0YTsKCgl9Cgp9CgpjbGFzcyBNYXRlcmlhbExvYWRlciBleHRlbmRzIExvYWRlciB7CgoJY29uc3RydWN0b3IoIG1hbmFnZXIgKSB7CgoJCXN1cGVyKCBtYW5hZ2VyICk7CgkJdGhpcy50ZXh0dXJlcyA9IHt9OwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggc2NvcGUubWFuYWdlciApOwoJCWxvYWRlci5zZXRQYXRoKCBzY29wZS5wYXRoICk7CgkJbG9hZGVyLnNldFJlcXVlc3RIZWFkZXIoIHNjb3BlLnJlcXVlc3RIZWFkZXIgKTsKCQlsb2FkZXIuc2V0V2l0aENyZWRlbnRpYWxzKCBzY29wZS53aXRoQ3JlZGVudGlhbHMgKTsKCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIHRleHQgKSB7CgoJCQl0cnkgewoKCQkJCW9uTG9hZCggc2NvcGUucGFyc2UoIEpTT04ucGFyc2UoIHRleHQgKSApICk7CgoJCQl9IGNhdGNoICggZSApIHsKCgkJCQlpZiAoIG9uRXJyb3IgKSB7CgoJCQkJCW9uRXJyb3IoIGUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLmVycm9yKCBlICk7CgoJCQkJfQoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCgkJCX0KCgkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCX0KCglwYXJzZSgganNvbiApIHsKCgkJY29uc3QgdGV4dHVyZXMgPSB0aGlzLnRleHR1cmVzOwoKCQlmdW5jdGlvbiBnZXRUZXh0dXJlKCBuYW1lICkgewoKCQkJaWYgKCB0ZXh0dXJlc1sgbmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTWF0ZXJpYWxMb2FkZXI6IFVuZGVmaW5lZCB0ZXh0dXJlJywgbmFtZSApOwoKCQkJfQoKCQkJcmV0dXJuIHRleHR1cmVzWyBuYW1lIF07CgoJCX0KCgkJY29uc3QgbWF0ZXJpYWwgPSBNYXRlcmlhbExvYWRlci5jcmVhdGVNYXRlcmlhbEZyb21UeXBlKCBqc29uLnR5cGUgKTsKCgkJaWYgKCBqc29uLnV1aWQgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnV1aWQgPSBqc29uLnV1aWQ7CgkJaWYgKCBqc29uLm5hbWUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm5hbWUgPSBqc29uLm5hbWU7CgkJaWYgKCBqc29uLmNvbG9yICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWwuY29sb3IgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNvbG9yLnNldEhleCgganNvbi5jb2xvciApOwoJCWlmICgganNvbi5yb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnJvdWdobmVzcyA9IGpzb24ucm91Z2huZXNzOwoJCWlmICgganNvbi5tZXRhbG5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm1ldGFsbmVzcyA9IGpzb24ubWV0YWxuZXNzOwoJCWlmICgganNvbi5zaGVlbiAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc2hlZW4gPSBqc29uLnNoZWVuOwoJCWlmICgganNvbi5zaGVlbkNvbG9yICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaGVlbkNvbG9yID0gbmV3IENvbG9yKCkuc2V0SGV4KCBqc29uLnNoZWVuQ29sb3IgKTsKCQlpZiAoIGpzb24uc2hlZW5Sb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzID0ganNvbi5zaGVlblJvdWdobmVzczsKCQlpZiAoIGpzb24uZW1pc3NpdmUgIT09IHVuZGVmaW5lZCAmJiBtYXRlcmlhbC5lbWlzc2l2ZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZW1pc3NpdmUuc2V0SGV4KCBqc29uLmVtaXNzaXZlICk7CgkJaWYgKCBqc29uLnNwZWN1bGFyICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWwuc3BlY3VsYXIgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNwZWN1bGFyLnNldEhleCgganNvbi5zcGVjdWxhciApOwoJCWlmICgganNvbi5zcGVjdWxhckludGVuc2l0eSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHkgPSBqc29uLnNwZWN1bGFySW50ZW5zaXR5OwoJCWlmICgganNvbi5zcGVjdWxhckNvbG9yICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvci5zZXRIZXgoIGpzb24uc3BlY3VsYXJDb2xvciApOwoJCWlmICgganNvbi5zaGluaW5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNoaW5pbmVzcyA9IGpzb24uc2hpbmluZXNzOwoJCWlmICgganNvbi5jbGVhcmNvYXQgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNsZWFyY29hdCA9IGpzb24uY2xlYXJjb2F0OwoJCWlmICgganNvbi5jbGVhcmNvYXRSb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyA9IGpzb24uY2xlYXJjb2F0Um91Z2huZXNzOwoJCWlmICgganNvbi5pcmlkZXNjZW5jZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuaXJpZGVzY2VuY2UgPSBqc29uLmlyaWRlc2NlbmNlOwoJCWlmICgganNvbi5pcmlkZXNjZW5jZUlPUiAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuaXJpZGVzY2VuY2VJT1IgPSBqc29uLmlyaWRlc2NlbmNlSU9SOwoJCWlmICgganNvbi5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlID0ganNvbi5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlOwoJCWlmICgganNvbi50cmFuc21pc3Npb24gIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA9IGpzb24udHJhbnNtaXNzaW9uOwoJCWlmICgganNvbi50aGlja25lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnRoaWNrbmVzcyA9IGpzb24udGhpY2tuZXNzOwoJCWlmICgganNvbi5hdHRlbnVhdGlvbkRpc3RhbmNlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5hdHRlbnVhdGlvbkRpc3RhbmNlID0ganNvbi5hdHRlbnVhdGlvbkRpc3RhbmNlOwoJCWlmICgganNvbi5hdHRlbnVhdGlvbkNvbG9yICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWwuYXR0ZW51YXRpb25Db2xvciAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYXR0ZW51YXRpb25Db2xvci5zZXRIZXgoIGpzb24uYXR0ZW51YXRpb25Db2xvciApOwoJCWlmICgganNvbi5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5hbmlzb3Ryb3B5ID0ganNvbi5hbmlzb3Ryb3B5OwoJCWlmICgganNvbi5hbmlzb3Ryb3B5Um90YXRpb24gIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFuaXNvdHJvcHlSb3RhdGlvbiA9IGpzb24uYW5pc290cm9weVJvdGF0aW9uOwoJCWlmICgganNvbi5mb2cgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmZvZyA9IGpzb24uZm9nOwoJCWlmICgganNvbi5mbGF0U2hhZGluZyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZmxhdFNoYWRpbmcgPSBqc29uLmZsYXRTaGFkaW5nOwoJCWlmICgganNvbi5ibGVuZGluZyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYmxlbmRpbmcgPSBqc29uLmJsZW5kaW5nOwoJCWlmICgganNvbi5jb21iaW5lICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5jb21iaW5lID0ganNvbi5jb21iaW5lOwoJCWlmICgganNvbi5zaWRlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaWRlID0ganNvbi5zaWRlOwoJCWlmICgganNvbi5zaGFkb3dTaWRlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaGFkb3dTaWRlID0ganNvbi5zaGFkb3dTaWRlOwoJCWlmICgganNvbi5vcGFjaXR5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5vcGFjaXR5ID0ganNvbi5vcGFjaXR5OwoJCWlmICgganNvbi50cmFuc3BhcmVudCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwudHJhbnNwYXJlbnQgPSBqc29uLnRyYW5zcGFyZW50OwoJCWlmICgganNvbi5hbHBoYVRlc3QgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFscGhhVGVzdCA9IGpzb24uYWxwaGFUZXN0OwoJCWlmICgganNvbi5hbHBoYUhhc2ggIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFscGhhSGFzaCA9IGpzb24uYWxwaGFIYXNoOwoJCWlmICgganNvbi5kZXB0aEZ1bmMgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRlcHRoRnVuYyA9IGpzb24uZGVwdGhGdW5jOwoJCWlmICgganNvbi5kZXB0aFRlc3QgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRlcHRoVGVzdCA9IGpzb24uZGVwdGhUZXN0OwoJCWlmICgganNvbi5kZXB0aFdyaXRlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5kZXB0aFdyaXRlID0ganNvbi5kZXB0aFdyaXRlOwoJCWlmICgganNvbi5jb2xvcldyaXRlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5jb2xvcldyaXRlID0ganNvbi5jb2xvcldyaXRlOwoJCWlmICgganNvbi5ibGVuZFNyYyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYmxlbmRTcmMgPSBqc29uLmJsZW5kU3JjOwoJCWlmICgganNvbi5ibGVuZERzdCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYmxlbmREc3QgPSBqc29uLmJsZW5kRHN0OwoJCWlmICgganNvbi5ibGVuZEVxdWF0aW9uICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5ibGVuZEVxdWF0aW9uID0ganNvbi5ibGVuZEVxdWF0aW9uOwoJCWlmICgganNvbi5ibGVuZFNyY0FscGhhICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5ibGVuZFNyY0FscGhhID0ganNvbi5ibGVuZFNyY0FscGhhOwoJCWlmICgganNvbi5ibGVuZERzdEFscGhhICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5ibGVuZERzdEFscGhhID0ganNvbi5ibGVuZERzdEFscGhhOwoJCWlmICgganNvbi5ibGVuZEVxdWF0aW9uQWxwaGEgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmJsZW5kRXF1YXRpb25BbHBoYSA9IGpzb24uYmxlbmRFcXVhdGlvbkFscGhhOwoJCWlmICgganNvbi5ibGVuZENvbG9yICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWwuYmxlbmRDb2xvciAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYmxlbmRDb2xvci5zZXRIZXgoIGpzb24uYmxlbmRDb2xvciApOwoJCWlmICgganNvbi5ibGVuZEFscGhhICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5ibGVuZEFscGhhID0ganNvbi5ibGVuZEFscGhhOwoJCWlmICgganNvbi5zdGVuY2lsV3JpdGVNYXNrICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zdGVuY2lsV3JpdGVNYXNrID0ganNvbi5zdGVuY2lsV3JpdGVNYXNrOwoJCWlmICgganNvbi5zdGVuY2lsRnVuYyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3RlbmNpbEZ1bmMgPSBqc29uLnN0ZW5jaWxGdW5jOwoJCWlmICgganNvbi5zdGVuY2lsUmVmICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zdGVuY2lsUmVmID0ganNvbi5zdGVuY2lsUmVmOwoJCWlmICgganNvbi5zdGVuY2lsRnVuY01hc2sgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnN0ZW5jaWxGdW5jTWFzayA9IGpzb24uc3RlbmNpbEZ1bmNNYXNrOwoJCWlmICgganNvbi5zdGVuY2lsRmFpbCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3RlbmNpbEZhaWwgPSBqc29uLnN0ZW5jaWxGYWlsOwoJCWlmICgganNvbi5zdGVuY2lsWkZhaWwgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnN0ZW5jaWxaRmFpbCA9IGpzb24uc3RlbmNpbFpGYWlsOwoJCWlmICgganNvbi5zdGVuY2lsWlBhc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnN0ZW5jaWxaUGFzcyA9IGpzb24uc3RlbmNpbFpQYXNzOwoJCWlmICgganNvbi5zdGVuY2lsV3JpdGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnN0ZW5jaWxXcml0ZSA9IGpzb24uc3RlbmNpbFdyaXRlOwoKCQlpZiAoIGpzb24ud2lyZWZyYW1lICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC53aXJlZnJhbWUgPSBqc29uLndpcmVmcmFtZTsKCQlpZiAoIGpzb24ud2lyZWZyYW1lTGluZXdpZHRoICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGggPSBqc29uLndpcmVmcmFtZUxpbmV3aWR0aDsKCQlpZiAoIGpzb24ud2lyZWZyYW1lTGluZWNhcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwud2lyZWZyYW1lTGluZWNhcCA9IGpzb24ud2lyZWZyYW1lTGluZWNhcDsKCQlpZiAoIGpzb24ud2lyZWZyYW1lTGluZWpvaW4gIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLndpcmVmcmFtZUxpbmVqb2luID0ganNvbi53aXJlZnJhbWVMaW5lam9pbjsKCgkJaWYgKCBqc29uLnJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5yb3RhdGlvbiA9IGpzb24ucm90YXRpb247CgoJCWlmICgganNvbi5saW5ld2lkdGggIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmxpbmV3aWR0aCA9IGpzb24ubGluZXdpZHRoOwoJCWlmICgganNvbi5kYXNoU2l6ZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZGFzaFNpemUgPSBqc29uLmRhc2hTaXplOwoJCWlmICgganNvbi5nYXBTaXplICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5nYXBTaXplID0ganNvbi5nYXBTaXplOwoJCWlmICgganNvbi5zY2FsZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc2NhbGUgPSBqc29uLnNjYWxlOwoKCQlpZiAoIGpzb24ucG9seWdvbk9mZnNldCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwucG9seWdvbk9mZnNldCA9IGpzb24ucG9seWdvbk9mZnNldDsKCQlpZiAoIGpzb24ucG9seWdvbk9mZnNldEZhY3RvciAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwucG9seWdvbk9mZnNldEZhY3RvciA9IGpzb24ucG9seWdvbk9mZnNldEZhY3RvcjsKCQlpZiAoIGpzb24ucG9seWdvbk9mZnNldFVuaXRzICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0VW5pdHMgPSBqc29uLnBvbHlnb25PZmZzZXRVbml0czsKCgkJaWYgKCBqc29uLmRpdGhlcmluZyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZGl0aGVyaW5nID0ganNvbi5kaXRoZXJpbmc7CgoJCWlmICgganNvbi5hbHBoYVRvQ292ZXJhZ2UgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSA9IGpzb24uYWxwaGFUb0NvdmVyYWdlOwoJCWlmICgganNvbi5wcmVtdWx0aXBsaWVkQWxwaGEgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnByZW11bHRpcGxpZWRBbHBoYSA9IGpzb24ucHJlbXVsdGlwbGllZEFscGhhOwoJCWlmICgganNvbi5mb3JjZVNpbmdsZVBhc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmZvcmNlU2luZ2xlUGFzcyA9IGpzb24uZm9yY2VTaW5nbGVQYXNzOwoKCQlpZiAoIGpzb24udmlzaWJsZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwudmlzaWJsZSA9IGpzb24udmlzaWJsZTsKCgkJaWYgKCBqc29uLnRvbmVNYXBwZWQgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnRvbmVNYXBwZWQgPSBqc29uLnRvbmVNYXBwZWQ7CgoJCWlmICgganNvbi51c2VyRGF0YSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwudXNlckRhdGEgPSBqc29uLnVzZXJEYXRhOwoKCQlpZiAoIGpzb24udmVydGV4Q29sb3JzICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIHR5cGVvZiBqc29uLnZlcnRleENvbG9ycyA9PT0gJ251bWJlcicgKSB7CgoJCQkJbWF0ZXJpYWwudmVydGV4Q29sb3JzID0gKCBqc29uLnZlcnRleENvbG9ycyA+IDAgKSA/IHRydWUgOiBmYWxzZTsKCgkJCX0gZWxzZSB7CgoJCQkJbWF0ZXJpYWwudmVydGV4Q29sb3JzID0ganNvbi52ZXJ0ZXhDb2xvcnM7CgoJCQl9CgoJCX0KCgkJLy8gU2hhZGVyIE1hdGVyaWFsCgoJCWlmICgganNvbi51bmlmb3JtcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBqc29uLnVuaWZvcm1zICkgewoKCQkJCWNvbnN0IHVuaWZvcm0gPSBqc29uLnVuaWZvcm1zWyBuYW1lIF07CgoJCQkJbWF0ZXJpYWwudW5pZm9ybXNbIG5hbWUgXSA9IHt9OwoKCQkJCXN3aXRjaCAoIHVuaWZvcm0udHlwZSApIHsKCgkJCQkJY2FzZSAndCc6CgkJCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0udmFsdWUgPSBnZXRUZXh0dXJlKCB1bmlmb3JtLnZhbHVlICk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICdjJzoKCQkJCQkJbWF0ZXJpYWwudW5pZm9ybXNbIG5hbWUgXS52YWx1ZSA9IG5ldyBDb2xvcigpLnNldEhleCggdW5pZm9ybS52YWx1ZSApOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAndjInOgoJCQkJCQltYXRlcmlhbC51bmlmb3Jtc1sgbmFtZSBdLnZhbHVlID0gbmV3IFZlY3RvcjIoKS5mcm9tQXJyYXkoIHVuaWZvcm0udmFsdWUgKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ3YzJzoKCQkJCQkJbWF0ZXJpYWwudW5pZm9ybXNbIG5hbWUgXS52YWx1ZSA9IG5ldyBWZWN0b3IzKCkuZnJvbUFycmF5KCB1bmlmb3JtLnZhbHVlICk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICd2NCc6CgkJCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0udmFsdWUgPSBuZXcgVmVjdG9yNCgpLmZyb21BcnJheSggdW5pZm9ybS52YWx1ZSApOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnbTMnOgoJCQkJCQltYXRlcmlhbC51bmlmb3Jtc1sgbmFtZSBdLnZhbHVlID0gbmV3IE1hdHJpeDMoKS5mcm9tQXJyYXkoIHVuaWZvcm0udmFsdWUgKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ200JzoKCQkJCQkJbWF0ZXJpYWwudW5pZm9ybXNbIG5hbWUgXS52YWx1ZSA9IG5ldyBNYXRyaXg0KCkuZnJvbUFycmF5KCB1bmlmb3JtLnZhbHVlICk7CgkJCQkJCWJyZWFrOwoKCQkJCQlkZWZhdWx0OgoJCQkJCQltYXRlcmlhbC51bmlmb3Jtc1sgbmFtZSBdLnZhbHVlID0gdW5pZm9ybS52YWx1ZTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJaWYgKCBqc29uLmRlZmluZXMgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRlZmluZXMgPSBqc29uLmRlZmluZXM7CgkJaWYgKCBqc29uLnZlcnRleFNoYWRlciAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwudmVydGV4U2hhZGVyID0ganNvbi52ZXJ0ZXhTaGFkZXI7CgkJaWYgKCBqc29uLmZyYWdtZW50U2hhZGVyICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5mcmFnbWVudFNoYWRlciA9IGpzb24uZnJhZ21lbnRTaGFkZXI7CgkJaWYgKCBqc29uLmdsc2xWZXJzaW9uICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5nbHNsVmVyc2lvbiA9IGpzb24uZ2xzbFZlcnNpb247CgoJCWlmICgganNvbi5leHRlbnNpb25zICE9PSB1bmRlZmluZWQgKSB7CgoJCQlmb3IgKCBjb25zdCBrZXkgaW4ganNvbi5leHRlbnNpb25zICkgewoKCQkJCW1hdGVyaWFsLmV4dGVuc2lvbnNbIGtleSBdID0ganNvbi5leHRlbnNpb25zWyBrZXkgXTsKCgkJCX0KCgkJfQoKCQlpZiAoIGpzb24ubGlnaHRzICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5saWdodHMgPSBqc29uLmxpZ2h0czsKCQlpZiAoIGpzb24uY2xpcHBpbmcgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNsaXBwaW5nID0ganNvbi5jbGlwcGluZzsKCgkJLy8gZm9yIFBvaW50c01hdGVyaWFsCgoJCWlmICgganNvbi5zaXplICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaXplID0ganNvbi5zaXplOwoJCWlmICgganNvbi5zaXplQXR0ZW51YXRpb24gIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNpemVBdHRlbnVhdGlvbiA9IGpzb24uc2l6ZUF0dGVudWF0aW9uOwoKCQkvLyBtYXBzCgoJCWlmICgganNvbi5tYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm1hcCA9IGdldFRleHR1cmUoIGpzb24ubWFwICk7CgkJaWYgKCBqc29uLm1hdGNhcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubWF0Y2FwID0gZ2V0VGV4dHVyZSgganNvbi5tYXRjYXAgKTsKCgkJaWYgKCBqc29uLmFscGhhTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5hbHBoYU1hcCA9IGdldFRleHR1cmUoIGpzb24uYWxwaGFNYXAgKTsKCgkJaWYgKCBqc29uLmJ1bXBNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmJ1bXBNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmJ1bXBNYXAgKTsKCQlpZiAoIGpzb24uYnVtcFNjYWxlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5idW1wU2NhbGUgPSBqc29uLmJ1bXBTY2FsZTsKCgkJaWYgKCBqc29uLm5vcm1hbE1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubm9ybWFsTWFwID0gZ2V0VGV4dHVyZSgganNvbi5ub3JtYWxNYXAgKTsKCQlpZiAoIGpzb24ubm9ybWFsTWFwVHlwZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubm9ybWFsTWFwVHlwZSA9IGpzb24ubm9ybWFsTWFwVHlwZTsKCQlpZiAoIGpzb24ubm9ybWFsU2NhbGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCWxldCBub3JtYWxTY2FsZSA9IGpzb24ubm9ybWFsU2NhbGU7CgoJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG5vcm1hbFNjYWxlICkgPT09IGZhbHNlICkgewoKCQkJCS8vIEJsZW5kZXIgZXhwb3J0ZXIgdXNlZCB0byBleHBvcnQgYSBzY2FsYXIuIFNlZSAjNzQ1OQoKCQkJCW5vcm1hbFNjYWxlID0gWyBub3JtYWxTY2FsZSwgbm9ybWFsU2NhbGUgXTsKCgkJCX0KCgkJCW1hdGVyaWFsLm5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoKS5mcm9tQXJyYXkoIG5vcm1hbFNjYWxlICk7CgoJCX0KCgkJaWYgKCBqc29uLmRpc3BsYWNlbWVudE1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwID0gZ2V0VGV4dHVyZSgganNvbi5kaXNwbGFjZW1lbnRNYXAgKTsKCQlpZiAoIGpzb24uZGlzcGxhY2VtZW50U2NhbGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlID0ganNvbi5kaXNwbGFjZW1lbnRTY2FsZTsKCQlpZiAoIGpzb24uZGlzcGxhY2VtZW50QmlhcyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhcyA9IGpzb24uZGlzcGxhY2VtZW50QmlhczsKCgkJaWYgKCBqc29uLnJvdWdobmVzc01hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwucm91Z2huZXNzTWFwID0gZ2V0VGV4dHVyZSgganNvbi5yb3VnaG5lc3NNYXAgKTsKCQlpZiAoIGpzb24ubWV0YWxuZXNzTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5tZXRhbG5lc3NNYXAgPSBnZXRUZXh0dXJlKCBqc29uLm1ldGFsbmVzc01hcCApOwoKCQlpZiAoIGpzb24uZW1pc3NpdmVNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmVtaXNzaXZlTWFwID0gZ2V0VGV4dHVyZSgganNvbi5lbWlzc2l2ZU1hcCApOwoJCWlmICgganNvbi5lbWlzc2l2ZUludGVuc2l0eSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZW1pc3NpdmVJbnRlbnNpdHkgPSBqc29uLmVtaXNzaXZlSW50ZW5zaXR5OwoKCQlpZiAoIGpzb24uc3BlY3VsYXJNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNwZWN1bGFyTWFwID0gZ2V0VGV4dHVyZSgganNvbi5zcGVjdWxhck1hcCApOwoJCWlmICgganNvbi5zcGVjdWxhckludGVuc2l0eU1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPSBnZXRUZXh0dXJlKCBqc29uLnNwZWN1bGFySW50ZW5zaXR5TWFwICk7CgkJaWYgKCBqc29uLnNwZWN1bGFyQ29sb3JNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXAgPSBnZXRUZXh0dXJlKCBqc29uLnNwZWN1bGFyQ29sb3JNYXAgKTsKCgkJaWYgKCBqc29uLmVudk1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZW52TWFwID0gZ2V0VGV4dHVyZSgganNvbi5lbnZNYXAgKTsKCQlpZiAoIGpzb24uZW52TWFwSW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5lbnZNYXBJbnRlbnNpdHkgPSBqc29uLmVudk1hcEludGVuc2l0eTsKCgkJaWYgKCBqc29uLnJlZmxlY3Rpdml0eSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwucmVmbGVjdGl2aXR5ID0ganNvbi5yZWZsZWN0aXZpdHk7CgkJaWYgKCBqc29uLnJlZnJhY3Rpb25SYXRpbyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwucmVmcmFjdGlvblJhdGlvID0ganNvbi5yZWZyYWN0aW9uUmF0aW87CgoJCWlmICgganNvbi5saWdodE1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubGlnaHRNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmxpZ2h0TWFwICk7CgkJaWYgKCBqc29uLmxpZ2h0TWFwSW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5saWdodE1hcEludGVuc2l0eSA9IGpzb24ubGlnaHRNYXBJbnRlbnNpdHk7CgoJCWlmICgganNvbi5hb01hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYW9NYXAgPSBnZXRUZXh0dXJlKCBqc29uLmFvTWFwICk7CgkJaWYgKCBqc29uLmFvTWFwSW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5hb01hcEludGVuc2l0eSA9IGpzb24uYW9NYXBJbnRlbnNpdHk7CgoJCWlmICgganNvbi5ncmFkaWVudE1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZ3JhZGllbnRNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmdyYWRpZW50TWFwICk7CgoJCWlmICgganNvbi5jbGVhcmNvYXRNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNsZWFyY29hdE1hcCA9IGdldFRleHR1cmUoIGpzb24uY2xlYXJjb2F0TWFwICk7CgkJaWYgKCBqc29uLmNsZWFyY29hdFJvdWdobmVzc01hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzTWFwID0gZ2V0VGV4dHVyZSgganNvbi5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgKTsKCQlpZiAoIGpzb24uY2xlYXJjb2F0Tm9ybWFsTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmNsZWFyY29hdE5vcm1hbE1hcCApOwoJCWlmICgganNvbi5jbGVhcmNvYXROb3JtYWxTY2FsZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMigpLmZyb21BcnJheSgganNvbi5jbGVhcmNvYXROb3JtYWxTY2FsZSApOwoKCQlpZiAoIGpzb24uaXJpZGVzY2VuY2VNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwID0gZ2V0VGV4dHVyZSgganNvbi5pcmlkZXNjZW5jZU1hcCApOwoJCWlmICgganNvbi5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwICk7CgoJCWlmICgganNvbi50cmFuc21pc3Npb25NYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcCA9IGdldFRleHR1cmUoIGpzb24udHJhbnNtaXNzaW9uTWFwICk7CgkJaWYgKCBqc29uLnRoaWNrbmVzc01hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwudGhpY2tuZXNzTWFwID0gZ2V0VGV4dHVyZSgganNvbi50aGlja25lc3NNYXAgKTsKCgkJaWYgKCBqc29uLmFuaXNvdHJvcHlNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmFuaXNvdHJvcHlNYXAgKTsKCgkJaWYgKCBqc29uLnNoZWVuQ29sb3JNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNoZWVuQ29sb3JNYXAgPSBnZXRUZXh0dXJlKCBqc29uLnNoZWVuQ29sb3JNYXAgKTsKCQlpZiAoIGpzb24uc2hlZW5Sb3VnaG5lc3NNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwID0gZ2V0VGV4dHVyZSgganNvbi5zaGVlblJvdWdobmVzc01hcCApOwoKCQlyZXR1cm4gbWF0ZXJpYWw7CgoJfQoKCXNldFRleHR1cmVzKCB2YWx1ZSApIHsKCgkJdGhpcy50ZXh0dXJlcyA9IHZhbHVlOwoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgY3JlYXRlTWF0ZXJpYWxGcm9tVHlwZSggdHlwZSApIHsKCgkJY29uc3QgbWF0ZXJpYWxMaWIgPSB7CgkJCVNoYWRvd01hdGVyaWFsLAoJCQlTcHJpdGVNYXRlcmlhbCwKCQkJUmF3U2hhZGVyTWF0ZXJpYWwsCgkJCVNoYWRlck1hdGVyaWFsLAoJCQlQb2ludHNNYXRlcmlhbCwKCQkJTWVzaFBoeXNpY2FsTWF0ZXJpYWwsCgkJCU1lc2hTdGFuZGFyZE1hdGVyaWFsLAoJCQlNZXNoUGhvbmdNYXRlcmlhbCwKCQkJTWVzaFRvb25NYXRlcmlhbCwKCQkJTWVzaE5vcm1hbE1hdGVyaWFsLAoJCQlNZXNoTGFtYmVydE1hdGVyaWFsLAoJCQlNZXNoRGVwdGhNYXRlcmlhbCwKCQkJTWVzaERpc3RhbmNlTWF0ZXJpYWwsCgkJCU1lc2hCYXNpY01hdGVyaWFsLAoJCQlNZXNoTWF0Y2FwTWF0ZXJpYWwsCgkJCUxpbmVEYXNoZWRNYXRlcmlhbCwKCQkJTGluZUJhc2ljTWF0ZXJpYWwsCgkJCU1hdGVyaWFsCgkJfTsKCgkJcmV0dXJuIG5ldyBtYXRlcmlhbExpYlsgdHlwZSBdKCk7CgoJfQoKfQoKY2xhc3MgTG9hZGVyVXRpbHMgewoKCXN0YXRpYyBkZWNvZGVUZXh0KCBhcnJheSApIHsKCgkJaWYgKCB0eXBlb2YgVGV4dERlY29kZXIgIT09ICd1bmRlZmluZWQnICkgewoKCQkJcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZSggYXJyYXkgKTsKCgkJfQoKCQkvLyBBdm9pZCB0aGUgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBhcnJheSkgc2hvcnRjdXQsIHdoaWNoCgkJLy8gdGhyb3dzIGEgIm1heGltdW0gY2FsbCBzdGFjayBzaXplIGV4Y2VlZGVkIiBlcnJvciBmb3IgbGFyZ2UgYXJyYXlzLgoKCQlsZXQgcyA9ICcnOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkvLyBJbXBsaWNpdGx5IGFzc3VtZXMgbGl0dGxlLWVuZGlhbi4KCQkJcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCBhcnJheVsgaSBdICk7CgoJCX0KCgkJdHJ5IHsKCgkJCS8vIG1lcmdlcyBtdWx0aS1ieXRlIHV0Zi04IGNoYXJhY3RlcnMuCgoJCQlyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KCBlc2NhcGUoIHMgKSApOwoKCQl9IGNhdGNoICggZSApIHsgLy8gc2VlICMxNjM1OAoKCQkJcmV0dXJuIHM7CgoJCX0KCgl9CgoJc3RhdGljIGV4dHJhY3RVcmxCYXNlKCB1cmwgKSB7CgoJCWNvbnN0IGluZGV4ID0gdXJsLmxhc3RJbmRleE9mKCAnLycgKTsKCgkJaWYgKCBpbmRleCA9PT0gLSAxICkgcmV0dXJuICcuLyc7CgoJCXJldHVybiB1cmwuc2xpY2UoIDAsIGluZGV4ICsgMSApOwoKCX0KCglzdGF0aWMgcmVzb2x2ZVVSTCggdXJsLCBwYXRoICkgewoKCQkvLyBJbnZhbGlkIFVSTAoJCWlmICggdHlwZW9mIHVybCAhPT0gJ3N0cmluZycgfHwgdXJsID09PSAnJyApIHJldHVybiAnJzsKCgkJLy8gSG9zdCBSZWxhdGl2ZSBVUkwKCQlpZiAoIC9eaHR0cHM/OlwvXC8vaS50ZXN0KCBwYXRoICkgJiYgL15cLy8udGVzdCggdXJsICkgKSB7CgoJCQlwYXRoID0gcGF0aC5yZXBsYWNlKCAvKF5odHRwcz86XC9cL1teXC9dKykuKi9pLCAnJDEnICk7CgoJCX0KCgkJLy8gQWJzb2x1dGUgVVJMIGh0dHA6Ly8saHR0cHM6Ly8sLy8KCQlpZiAoIC9eKGh0dHBzPzopP1wvXC8vaS50ZXN0KCB1cmwgKSApIHJldHVybiB1cmw7CgoJCS8vIERhdGEgVVJJCgkJaWYgKCAvXmRhdGE6LiosLiokL2kudGVzdCggdXJsICkgKSByZXR1cm4gdXJsOwoKCQkvLyBCbG9iIFVSTAoJCWlmICggL15ibG9iOi4qJC9pLnRlc3QoIHVybCApICkgcmV0dXJuIHVybDsKCgkJLy8gUmVsYXRpdmUgVVJMCgkJcmV0dXJuIHBhdGggKyB1cmw7CgoJfQoKfQoKY2xhc3MgSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSc7CgkJdGhpcy5pbnN0YW5jZUNvdW50ID0gSW5maW5pdHk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuaW5zdGFuY2VDb3VudCA9IHNvdXJjZS5pbnN0YW5jZUNvdW50OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEuaW5zdGFuY2VDb3VudCA9IHRoaXMuaW5zdGFuY2VDb3VudDsKCgkJZGF0YS5pc0luc3RhbmNlZEJ1ZmZlckdlb21ldHJ5ID0gdHJ1ZTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKfQoKY2xhc3MgQnVmZmVyR2VvbWV0cnlMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQlzdXBlciggbWFuYWdlciApOwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggc2NvcGUubWFuYWdlciApOwoJCWxvYWRlci5zZXRQYXRoKCBzY29wZS5wYXRoICk7CgkJbG9hZGVyLnNldFJlcXVlc3RIZWFkZXIoIHNjb3BlLnJlcXVlc3RIZWFkZXIgKTsKCQlsb2FkZXIuc2V0V2l0aENyZWRlbnRpYWxzKCBzY29wZS53aXRoQ3JlZGVudGlhbHMgKTsKCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIHRleHQgKSB7CgoJCQl0cnkgewoKCQkJCW9uTG9hZCggc2NvcGUucGFyc2UoIEpTT04ucGFyc2UoIHRleHQgKSApICk7CgoJCQl9IGNhdGNoICggZSApIHsKCgkJCQlpZiAoIG9uRXJyb3IgKSB7CgoJCQkJCW9uRXJyb3IoIGUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLmVycm9yKCBlICk7CgoJCQkJfQoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCgkJCX0KCgkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCX0KCglwYXJzZSgganNvbiApIHsKCgkJY29uc3QgaW50ZXJsZWF2ZWRCdWZmZXJNYXAgPSB7fTsKCQljb25zdCBhcnJheUJ1ZmZlck1hcCA9IHt9OwoKCQlmdW5jdGlvbiBnZXRJbnRlcmxlYXZlZEJ1ZmZlcigganNvbiwgdXVpZCApIHsKCgkJCWlmICggaW50ZXJsZWF2ZWRCdWZmZXJNYXBbIHV1aWQgXSAhPT0gdW5kZWZpbmVkICkgcmV0dXJuIGludGVybGVhdmVkQnVmZmVyTWFwWyB1dWlkIF07CgoJCQljb25zdCBpbnRlcmxlYXZlZEJ1ZmZlcnMgPSBqc29uLmludGVybGVhdmVkQnVmZmVyczsKCQkJY29uc3QgaW50ZXJsZWF2ZWRCdWZmZXIgPSBpbnRlcmxlYXZlZEJ1ZmZlcnNbIHV1aWQgXTsKCgkJCWNvbnN0IGJ1ZmZlciA9IGdldEFycmF5QnVmZmVyKCBqc29uLCBpbnRlcmxlYXZlZEJ1ZmZlci5idWZmZXIgKTsKCgkJCWNvbnN0IGFycmF5ID0gZ2V0VHlwZWRBcnJheSggaW50ZXJsZWF2ZWRCdWZmZXIudHlwZSwgYnVmZmVyICk7CgkJCWNvbnN0IGliID0gbmV3IEludGVybGVhdmVkQnVmZmVyKCBhcnJheSwgaW50ZXJsZWF2ZWRCdWZmZXIuc3RyaWRlICk7CgkJCWliLnV1aWQgPSBpbnRlcmxlYXZlZEJ1ZmZlci51dWlkOwoKCQkJaW50ZXJsZWF2ZWRCdWZmZXJNYXBbIHV1aWQgXSA9IGliOwoKCQkJcmV0dXJuIGliOwoKCQl9CgoJCWZ1bmN0aW9uIGdldEFycmF5QnVmZmVyKCBqc29uLCB1dWlkICkgewoKCQkJaWYgKCBhcnJheUJ1ZmZlck1hcFsgdXVpZCBdICE9PSB1bmRlZmluZWQgKSByZXR1cm4gYXJyYXlCdWZmZXJNYXBbIHV1aWQgXTsKCgkJCWNvbnN0IGFycmF5QnVmZmVycyA9IGpzb24uYXJyYXlCdWZmZXJzOwoJCQljb25zdCBhcnJheUJ1ZmZlciA9IGFycmF5QnVmZmVyc1sgdXVpZCBdOwoKCQkJY29uc3QgYWIgPSBuZXcgVWludDMyQXJyYXkoIGFycmF5QnVmZmVyICkuYnVmZmVyOwoKCQkJYXJyYXlCdWZmZXJNYXBbIHV1aWQgXSA9IGFiOwoKCQkJcmV0dXJuIGFiOwoKCQl9CgoJCWNvbnN0IGdlb21ldHJ5ID0ganNvbi5pc0luc3RhbmNlZEJ1ZmZlckdlb21ldHJ5ID8gbmV3IEluc3RhbmNlZEJ1ZmZlckdlb21ldHJ5KCkgOiBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJY29uc3QgaW5kZXggPSBqc29uLmRhdGEuaW5kZXg7CgoJCWlmICggaW5kZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IHR5cGVkQXJyYXkgPSBnZXRUeXBlZEFycmF5KCBpbmRleC50eXBlLCBpbmRleC5hcnJheSApOwoJCQlnZW9tZXRyeS5zZXRJbmRleCggbmV3IEJ1ZmZlckF0dHJpYnV0ZSggdHlwZWRBcnJheSwgMSApICk7CgoJCX0KCgkJY29uc3QgYXR0cmlidXRlcyA9IGpzb24uZGF0YS5hdHRyaWJ1dGVzOwoKCQlmb3IgKCBjb25zdCBrZXkgaW4gYXR0cmlidXRlcyApIHsKCgkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIGtleSBdOwoJCQlsZXQgYnVmZmVyQXR0cmlidXRlOwoKCQkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQljb25zdCBpbnRlcmxlYXZlZEJ1ZmZlciA9IGdldEludGVybGVhdmVkQnVmZmVyKCBqc29uLmRhdGEsIGF0dHJpYnV0ZS5kYXRhICk7CgkJCQlidWZmZXJBdHRyaWJ1dGUgPSBuZXcgSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUoIGludGVybGVhdmVkQnVmZmVyLCBhdHRyaWJ1dGUuaXRlbVNpemUsIGF0dHJpYnV0ZS5vZmZzZXQsIGF0dHJpYnV0ZS5ub3JtYWxpemVkICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IHR5cGVkQXJyYXkgPSBnZXRUeXBlZEFycmF5KCBhdHRyaWJ1dGUudHlwZSwgYXR0cmlidXRlLmFycmF5ICk7CgkJCQljb25zdCBidWZmZXJBdHRyaWJ1dGVDb25zdHIgPSBhdHRyaWJ1dGUuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUgPyBJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUgOiBCdWZmZXJBdHRyaWJ1dGU7CgkJCQlidWZmZXJBdHRyaWJ1dGUgPSBuZXcgYnVmZmVyQXR0cmlidXRlQ29uc3RyKCB0eXBlZEFycmF5LCBhdHRyaWJ1dGUuaXRlbVNpemUsIGF0dHJpYnV0ZS5ub3JtYWxpemVkICk7CgoJCQl9CgoJCQlpZiAoIGF0dHJpYnV0ZS5uYW1lICE9PSB1bmRlZmluZWQgKSBidWZmZXJBdHRyaWJ1dGUubmFtZSA9IGF0dHJpYnV0ZS5uYW1lOwoJCQlpZiAoIGF0dHJpYnV0ZS51c2FnZSAhPT0gdW5kZWZpbmVkICkgYnVmZmVyQXR0cmlidXRlLnNldFVzYWdlKCBhdHRyaWJ1dGUudXNhZ2UgKTsKCgkJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSgga2V5LCBidWZmZXJBdHRyaWJ1dGUgKTsKCgkJfQoKCQljb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBqc29uLmRhdGEubW9ycGhBdHRyaWJ1dGVzOwoKCQlpZiAoIG1vcnBoQXR0cmlidXRlcyApIHsKCgkJCWZvciAoIGNvbnN0IGtleSBpbiBtb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJY29uc3QgYXR0cmlidXRlQXJyYXkgPSBtb3JwaEF0dHJpYnV0ZXNbIGtleSBdOwoKCQkJCWNvbnN0IGFycmF5ID0gW107CgoJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGF0dHJpYnV0ZUFycmF5Lmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQljb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVBcnJheVsgaSBdOwoJCQkJCWxldCBidWZmZXJBdHRyaWJ1dGU7CgoJCQkJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJCQljb25zdCBpbnRlcmxlYXZlZEJ1ZmZlciA9IGdldEludGVybGVhdmVkQnVmZmVyKCBqc29uLmRhdGEsIGF0dHJpYnV0ZS5kYXRhICk7CgkJCQkJCWJ1ZmZlckF0dHJpYnV0ZSA9IG5ldyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaW50ZXJsZWF2ZWRCdWZmZXIsIGF0dHJpYnV0ZS5pdGVtU2l6ZSwgYXR0cmlidXRlLm9mZnNldCwgYXR0cmlidXRlLm5vcm1hbGl6ZWQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnN0IHR5cGVkQXJyYXkgPSBnZXRUeXBlZEFycmF5KCBhdHRyaWJ1dGUudHlwZSwgYXR0cmlidXRlLmFycmF5ICk7CgkJCQkJCWJ1ZmZlckF0dHJpYnV0ZSA9IG5ldyBCdWZmZXJBdHRyaWJ1dGUoIHR5cGVkQXJyYXksIGF0dHJpYnV0ZS5pdGVtU2l6ZSwgYXR0cmlidXRlLm5vcm1hbGl6ZWQgKTsKCgkJCQkJfQoKCQkJCQlpZiAoIGF0dHJpYnV0ZS5uYW1lICE9PSB1bmRlZmluZWQgKSBidWZmZXJBdHRyaWJ1dGUubmFtZSA9IGF0dHJpYnV0ZS5uYW1lOwoJCQkJCWFycmF5LnB1c2goIGJ1ZmZlckF0dHJpYnV0ZSApOwoKCQkJCX0KCgkJCQlnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXNbIGtleSBdID0gYXJyYXk7CgoJCQl9CgoJCX0KCgkJY29uc3QgbW9ycGhUYXJnZXRzUmVsYXRpdmUgPSBqc29uLmRhdGEubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgoJCWlmICggbW9ycGhUYXJnZXRzUmVsYXRpdmUgKSB7CgoJCQlnZW9tZXRyeS5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRydWU7CgoJCX0KCgkJY29uc3QgZ3JvdXBzID0ganNvbi5kYXRhLmdyb3VwcyB8fCBqc29uLmRhdGEuZHJhd2NhbGxzIHx8IGpzb24uZGF0YS5vZmZzZXRzOwoKCQlpZiAoIGdyb3VwcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBuID0gZ3JvdXBzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwoKCQkJCWdlb21ldHJ5LmFkZEdyb3VwKCBncm91cC5zdGFydCwgZ3JvdXAuY291bnQsIGdyb3VwLm1hdGVyaWFsSW5kZXggKTsKCgkJCX0KCgkJfQoKCQljb25zdCBib3VuZGluZ1NwaGVyZSA9IGpzb24uZGF0YS5ib3VuZGluZ1NwaGVyZTsKCgkJaWYgKCBib3VuZGluZ1NwaGVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJY29uc3QgY2VudGVyID0gbmV3IFZlY3RvcjMoKTsKCgkJCWlmICggYm91bmRpbmdTcGhlcmUuY2VudGVyICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY2VudGVyLmZyb21BcnJheSggYm91bmRpbmdTcGhlcmUuY2VudGVyICk7CgoJCQl9CgoJCQlnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9IG5ldyBTcGhlcmUoIGNlbnRlciwgYm91bmRpbmdTcGhlcmUucmFkaXVzICk7CgoJCX0KCgkJaWYgKCBqc29uLm5hbWUgKSBnZW9tZXRyeS5uYW1lID0ganNvbi5uYW1lOwoJCWlmICgganNvbi51c2VyRGF0YSApIGdlb21ldHJ5LnVzZXJEYXRhID0ganNvbi51c2VyRGF0YTsKCgkJcmV0dXJuIGdlb21ldHJ5OwoKCX0KCn0KCmNsYXNzIE9iamVjdExvYWRlciBleHRlbmRzIExvYWRlciB7CgoJY29uc3RydWN0b3IoIG1hbmFnZXIgKSB7CgoJCXN1cGVyKCBtYW5hZ2VyICk7CgoJfQoKCWxvYWQoIHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCWNvbnN0IHBhdGggPSAoIHRoaXMucGF0aCA9PT0gJycgKSA/IExvYWRlclV0aWxzLmV4dHJhY3RVcmxCYXNlKCB1cmwgKSA6IHRoaXMucGF0aDsKCQl0aGlzLnJlc291cmNlUGF0aCA9IHRoaXMucmVzb3VyY2VQYXRoIHx8IHBhdGg7CgoJCWNvbnN0IGxvYWRlciA9IG5ldyBGaWxlTG9hZGVyKCB0aGlzLm1hbmFnZXIgKTsKCQlsb2FkZXIuc2V0UGF0aCggdGhpcy5wYXRoICk7CgkJbG9hZGVyLnNldFJlcXVlc3RIZWFkZXIoIHRoaXMucmVxdWVzdEhlYWRlciApOwoJCWxvYWRlci5zZXRXaXRoQ3JlZGVudGlhbHMoIHRoaXMud2l0aENyZWRlbnRpYWxzICk7CgkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCB0ZXh0ICkgewoKCQkJbGV0IGpzb24gPSBudWxsOwoKCQkJdHJ5IHsKCgkJCQlqc29uID0gSlNPTi5wYXJzZSggdGV4dCApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWlmICggb25FcnJvciAhPT0gdW5kZWZpbmVkICkgb25FcnJvciggZXJyb3IgKTsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUU6T2JqZWN0TG9hZGVyOiBDYW5cJ3QgcGFyc2UgJyArIHVybCArICcuJywgZXJyb3IubWVzc2FnZSApOwoKCQkJCXJldHVybjsKCgkJCX0KCgkJCWNvbnN0IG1ldGFkYXRhID0ganNvbi5tZXRhZGF0YTsKCgkJCWlmICggbWV0YWRhdGEgPT09IHVuZGVmaW5lZCB8fCBtZXRhZGF0YS50eXBlID09PSB1bmRlZmluZWQgfHwgbWV0YWRhdGEudHlwZS50b0xvd2VyQ2FzZSgpID09PSAnZ2VvbWV0cnknICkgewoKCQkJCWlmICggb25FcnJvciAhPT0gdW5kZWZpbmVkICkgb25FcnJvciggbmV3IEVycm9yKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBDYW5cJ3QgbG9hZCAnICsgdXJsICkgKTsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBDYW5cJ3QgbG9hZCAnICsgdXJsICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQlzY29wZS5wYXJzZSgganNvbiwgb25Mb2FkICk7CgoJCX0sIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKTsKCgl9CgoJYXN5bmMgbG9hZEFzeW5jKCB1cmwsIG9uUHJvZ3Jlc3MgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJY29uc3QgcGF0aCA9ICggdGhpcy5wYXRoID09PSAnJyApID8gTG9hZGVyVXRpbHMuZXh0cmFjdFVybEJhc2UoIHVybCApIDogdGhpcy5wYXRoOwoJCXRoaXMucmVzb3VyY2VQYXRoID0gdGhpcy5yZXNvdXJjZVBhdGggfHwgcGF0aDsKCgkJY29uc3QgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCQlsb2FkZXIuc2V0UmVxdWVzdEhlYWRlciggdGhpcy5yZXF1ZXN0SGVhZGVyICk7CgkJbG9hZGVyLnNldFdpdGhDcmVkZW50aWFscyggdGhpcy53aXRoQ3JlZGVudGlhbHMgKTsKCgkJY29uc3QgdGV4dCA9IGF3YWl0IGxvYWRlci5sb2FkQXN5bmMoIHVybCwgb25Qcm9ncmVzcyApOwoKCQljb25zdCBqc29uID0gSlNPTi5wYXJzZSggdGV4dCApOwoKCQljb25zdCBtZXRhZGF0YSA9IGpzb24ubWV0YWRhdGE7CgoJCWlmICggbWV0YWRhdGEgPT09IHVuZGVmaW5lZCB8fCBtZXRhZGF0YS50eXBlID09PSB1bmRlZmluZWQgfHwgbWV0YWRhdGEudHlwZS50b0xvd2VyQ2FzZSgpID09PSAnZ2VvbWV0cnknICkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBDYW5cJ3QgbG9hZCAnICsgdXJsICk7CgoJCX0KCgkJcmV0dXJuIGF3YWl0IHNjb3BlLnBhcnNlQXN5bmMoIGpzb24gKTsKCgl9CgoJcGFyc2UoIGpzb24sIG9uTG9hZCApIHsKCgkJY29uc3QgYW5pbWF0aW9ucyA9IHRoaXMucGFyc2VBbmltYXRpb25zKCBqc29uLmFuaW1hdGlvbnMgKTsKCQljb25zdCBzaGFwZXMgPSB0aGlzLnBhcnNlU2hhcGVzKCBqc29uLnNoYXBlcyApOwoJCWNvbnN0IGdlb21ldHJpZXMgPSB0aGlzLnBhcnNlR2VvbWV0cmllcygganNvbi5nZW9tZXRyaWVzLCBzaGFwZXMgKTsKCgkJY29uc3QgaW1hZ2VzID0gdGhpcy5wYXJzZUltYWdlcygganNvbi5pbWFnZXMsIGZ1bmN0aW9uICgpIHsKCgkJCWlmICggb25Mb2FkICE9PSB1bmRlZmluZWQgKSBvbkxvYWQoIG9iamVjdCApOwoKCQl9ICk7CgoJCWNvbnN0IHRleHR1cmVzID0gdGhpcy5wYXJzZVRleHR1cmVzKCBqc29uLnRleHR1cmVzLCBpbWFnZXMgKTsKCQljb25zdCBtYXRlcmlhbHMgPSB0aGlzLnBhcnNlTWF0ZXJpYWxzKCBqc29uLm1hdGVyaWFscywgdGV4dHVyZXMgKTsKCgkJY29uc3Qgb2JqZWN0ID0gdGhpcy5wYXJzZU9iamVjdCgganNvbi5vYmplY3QsIGdlb21ldHJpZXMsIG1hdGVyaWFscywgdGV4dHVyZXMsIGFuaW1hdGlvbnMgKTsKCQljb25zdCBza2VsZXRvbnMgPSB0aGlzLnBhcnNlU2tlbGV0b25zKCBqc29uLnNrZWxldG9ucywgb2JqZWN0ICk7CgoJCXRoaXMuYmluZFNrZWxldG9ucyggb2JqZWN0LCBza2VsZXRvbnMgKTsKCgkJLy8KCgkJaWYgKCBvbkxvYWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCWxldCBoYXNJbWFnZXMgPSBmYWxzZTsKCgkJCWZvciAoIGNvbnN0IHV1aWQgaW4gaW1hZ2VzICkgewoKCQkJCWlmICggaW1hZ2VzWyB1dWlkIF0uZGF0YSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB7CgoJCQkJCWhhc0ltYWdlcyA9IHRydWU7CgkJCQkJYnJlYWs7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBoYXNJbWFnZXMgPT09IGZhbHNlICkgb25Mb2FkKCBvYmplY3QgKTsKCgkJfQoKCQlyZXR1cm4gb2JqZWN0OwoKCX0KCglhc3luYyBwYXJzZUFzeW5jKCBqc29uICkgewoKCQljb25zdCBhbmltYXRpb25zID0gdGhpcy5wYXJzZUFuaW1hdGlvbnMoIGpzb24uYW5pbWF0aW9ucyApOwoJCWNvbnN0IHNoYXBlcyA9IHRoaXMucGFyc2VTaGFwZXMoIGpzb24uc2hhcGVzICk7CgkJY29uc3QgZ2VvbWV0cmllcyA9IHRoaXMucGFyc2VHZW9tZXRyaWVzKCBqc29uLmdlb21ldHJpZXMsIHNoYXBlcyApOwoKCQljb25zdCBpbWFnZXMgPSBhd2FpdCB0aGlzLnBhcnNlSW1hZ2VzQXN5bmMoIGpzb24uaW1hZ2VzICk7CgoJCWNvbnN0IHRleHR1cmVzID0gdGhpcy5wYXJzZVRleHR1cmVzKCBqc29uLnRleHR1cmVzLCBpbWFnZXMgKTsKCQljb25zdCBtYXRlcmlhbHMgPSB0aGlzLnBhcnNlTWF0ZXJpYWxzKCBqc29uLm1hdGVyaWFscywgdGV4dHVyZXMgKTsKCgkJY29uc3Qgb2JqZWN0ID0gdGhpcy5wYXJzZU9iamVjdCgganNvbi5vYmplY3QsIGdlb21ldHJpZXMsIG1hdGVyaWFscywgdGV4dHVyZXMsIGFuaW1hdGlvbnMgKTsKCQljb25zdCBza2VsZXRvbnMgPSB0aGlzLnBhcnNlU2tlbGV0b25zKCBqc29uLnNrZWxldG9ucywgb2JqZWN0ICk7CgoJCXRoaXMuYmluZFNrZWxldG9ucyggb2JqZWN0LCBza2VsZXRvbnMgKTsKCgkJcmV0dXJuIG9iamVjdDsKCgl9CgoJcGFyc2VTaGFwZXMoIGpzb24gKSB7CgoJCWNvbnN0IHNoYXBlcyA9IHt9OwoKCQlpZiAoIGpzb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBzaGFwZSA9IG5ldyBTaGFwZSgpLmZyb21KU09OKCBqc29uWyBpIF0gKTsKCgkJCQlzaGFwZXNbIHNoYXBlLnV1aWQgXSA9IHNoYXBlOwoKCQkJfQoKCQl9CgoJCXJldHVybiBzaGFwZXM7CgoJfQoKCXBhcnNlU2tlbGV0b25zKCBqc29uLCBvYmplY3QgKSB7CgoJCWNvbnN0IHNrZWxldG9ucyA9IHt9OwoJCWNvbnN0IGJvbmVzID0ge307CgoJCS8vIGdlbmVyYXRlIGJvbmUgbG9va3VwIHRhYmxlCgoJCW9iamVjdC50cmF2ZXJzZSggZnVuY3Rpb24gKCBjaGlsZCApIHsKCgkJCWlmICggY2hpbGQuaXNCb25lICkgYm9uZXNbIGNoaWxkLnV1aWQgXSA9IGNoaWxkOwoKCQl9ICk7CgoJCS8vIGNyZWF0ZSBza2VsZXRvbnMKCgkJaWYgKCBqc29uICE9PSB1bmRlZmluZWQgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBqc29uLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3Qgc2tlbGV0b24gPSBuZXcgU2tlbGV0b24oKS5mcm9tSlNPTigganNvblsgaSBdLCBib25lcyApOwoKCQkJCXNrZWxldG9uc1sgc2tlbGV0b24udXVpZCBdID0gc2tlbGV0b247CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHNrZWxldG9uczsKCgl9CgoJcGFyc2VHZW9tZXRyaWVzKCBqc29uLCBzaGFwZXMgKSB7CgoJCWNvbnN0IGdlb21ldHJpZXMgPSB7fTsKCgkJaWYgKCBqc29uICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBidWZmZXJHZW9tZXRyeUxvYWRlciA9IG5ldyBCdWZmZXJHZW9tZXRyeUxvYWRlcigpOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0ganNvbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWxldCBnZW9tZXRyeTsKCQkJCWNvbnN0IGRhdGEgPSBqc29uWyBpIF07CgoJCQkJc3dpdGNoICggZGF0YS50eXBlICkgewoKCQkJCQljYXNlICdCdWZmZXJHZW9tZXRyeSc6CgkJCQkJY2FzZSAnSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnknOgoKCQkJCQkJZ2VvbWV0cnkgPSBidWZmZXJHZW9tZXRyeUxvYWRlci5wYXJzZSggZGF0YSApOwoJCQkJCQlicmVhazsKCgkJCQkJZGVmYXVsdDoKCgkJCQkJCWlmICggZGF0YS50eXBlIGluIEdlb21ldHJpZXMgKSB7CgoJCQkJCQkJZ2VvbWV0cnkgPSBHZW9tZXRyaWVzWyBkYXRhLnR5cGUgXS5mcm9tSlNPTiggZGF0YSwgc2hhcGVzICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWNvbnNvbGUud2FybiggYFRIUkVFLk9iamVjdExvYWRlcjogVW5zdXBwb3J0ZWQgZ2VvbWV0cnkgdHlwZSAiJHsgZGF0YS50eXBlIH0iYCApOwoKCQkJCQkJfQoKCQkJCX0KCgkJCQlnZW9tZXRyeS51dWlkID0gZGF0YS51dWlkOwoKCQkJCWlmICggZGF0YS5uYW1lICE9PSB1bmRlZmluZWQgKSBnZW9tZXRyeS5uYW1lID0gZGF0YS5uYW1lOwoJCQkJaWYgKCBkYXRhLnVzZXJEYXRhICE9PSB1bmRlZmluZWQgKSBnZW9tZXRyeS51c2VyRGF0YSA9IGRhdGEudXNlckRhdGE7CgoJCQkJZ2VvbWV0cmllc1sgZGF0YS51dWlkIF0gPSBnZW9tZXRyeTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gZ2VvbWV0cmllczsKCgl9CgoJcGFyc2VNYXRlcmlhbHMoIGpzb24sIHRleHR1cmVzICkgewoKCQljb25zdCBjYWNoZSA9IHt9OyAvLyBNdWx0aU1hdGVyaWFsCgkJY29uc3QgbWF0ZXJpYWxzID0ge307CgoJCWlmICgganNvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJY29uc3QgbG9hZGVyID0gbmV3IE1hdGVyaWFsTG9hZGVyKCk7CgkJCWxvYWRlci5zZXRUZXh0dXJlcyggdGV4dHVyZXMgKTsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBkYXRhID0ganNvblsgaSBdOwoKCQkJCWlmICggY2FjaGVbIGRhdGEudXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNhY2hlWyBkYXRhLnV1aWQgXSA9IGxvYWRlci5wYXJzZSggZGF0YSApOwoKCQkJCX0KCgkJCQltYXRlcmlhbHNbIGRhdGEudXVpZCBdID0gY2FjaGVbIGRhdGEudXVpZCBdOwoKCQkJfQoKCQl9CgoJCXJldHVybiBtYXRlcmlhbHM7CgoJfQoKCXBhcnNlQW5pbWF0aW9ucygganNvbiApIHsKCgkJY29uc3QgYW5pbWF0aW9ucyA9IHt9OwoKCQlpZiAoIGpzb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGpzb24ubGVuZ3RoOyBpICsrICkgewoKCQkJCWNvbnN0IGRhdGEgPSBqc29uWyBpIF07CgoJCQkJY29uc3QgY2xpcCA9IEFuaW1hdGlvbkNsaXAucGFyc2UoIGRhdGEgKTsKCgkJCQlhbmltYXRpb25zWyBjbGlwLnV1aWQgXSA9IGNsaXA7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIGFuaW1hdGlvbnM7CgoJfQoKCXBhcnNlSW1hZ2VzKCBqc29uLCBvbkxvYWQgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCQljb25zdCBpbWFnZXMgPSB7fTsKCgkJbGV0IGxvYWRlcjsKCgkJZnVuY3Rpb24gbG9hZEltYWdlKCB1cmwgKSB7CgoJCQlzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgoJCQlyZXR1cm4gbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCkgewoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQl9LCB1bmRlZmluZWQsIGZ1bmN0aW9uICgpIHsKCgkJCQlzY29wZS5tYW5hZ2VyLml0ZW1FcnJvciggdXJsICk7CgkJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQkJfSApOwoKCQl9CgoJCWZ1bmN0aW9uIGRlc2VyaWFsaXplSW1hZ2UoIGltYWdlICkgewoKCQkJaWYgKCB0eXBlb2YgaW1hZ2UgPT09ICdzdHJpbmcnICkgewoKCQkJCWNvbnN0IHVybCA9IGltYWdlOwoKCQkJCWNvbnN0IHBhdGggPSAvXihcL1wvKXwoW2Etel0rOihcL1wvKT8pL2kudGVzdCggdXJsICkgPyB1cmwgOiBzY29wZS5yZXNvdXJjZVBhdGggKyB1cmw7CgoJCQkJcmV0dXJuIGxvYWRJbWFnZSggcGF0aCApOwoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIGltYWdlLmRhdGEgKSB7CgoJCQkJCXJldHVybiB7CgkJCQkJCWRhdGE6IGdldFR5cGVkQXJyYXkoIGltYWdlLnR5cGUsIGltYWdlLmRhdGEgKSwKCQkJCQkJd2lkdGg6IGltYWdlLndpZHRoLAoJCQkJCQloZWlnaHQ6IGltYWdlLmhlaWdodAoJCQkJCX07CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmV0dXJuIG51bGw7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWlmICgganNvbiAhPT0gdW5kZWZpbmVkICYmIGpzb24ubGVuZ3RoID4gMCApIHsKCgkJCWNvbnN0IG1hbmFnZXIgPSBuZXcgTG9hZGluZ01hbmFnZXIoIG9uTG9hZCApOwoKCQkJbG9hZGVyID0gbmV3IEltYWdlTG9hZGVyKCBtYW5hZ2VyICk7CgkJCWxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5jcm9zc09yaWdpbiApOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGpzb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgaW1hZ2UgPSBqc29uWyBpIF07CgkJCQljb25zdCB1cmwgPSBpbWFnZS51cmw7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCB1cmwgKSApIHsKCgkJCQkJLy8gbG9hZCBhcnJheSBvZiBpbWFnZXMgZS5nIEN1YmVUZXh0dXJlCgoJCQkJCWNvbnN0IGltYWdlQXJyYXkgPSBbXTsKCgkJCQkJZm9yICggbGV0IGogPSAwLCBqbCA9IHVybC5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJCWNvbnN0IGN1cnJlbnRVcmwgPSB1cmxbIGogXTsKCgkJCQkJCWNvbnN0IGRlc2VyaWFsaXplZEltYWdlID0gZGVzZXJpYWxpemVJbWFnZSggY3VycmVudFVybCApOwoKCQkJCQkJaWYgKCBkZXNlcmlhbGl6ZWRJbWFnZSAhPT0gbnVsbCApIHsKCgkJCQkJCQlpZiAoIGRlc2VyaWFsaXplZEltYWdlIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHsKCgkJCQkJCQkJaW1hZ2VBcnJheS5wdXNoKCBkZXNlcmlhbGl6ZWRJbWFnZSApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCS8vIHNwZWNpYWwgY2FzZTogaGFuZGxlIGFycmF5IG9mIGRhdGEgdGV4dHVyZXMgZm9yIGN1YmUgdGV4dHVyZXMKCgkJCQkJCQkJaW1hZ2VBcnJheS5wdXNoKCBuZXcgRGF0YVRleHR1cmUoIGRlc2VyaWFsaXplZEltYWdlLmRhdGEsIGRlc2VyaWFsaXplZEltYWdlLndpZHRoLCBkZXNlcmlhbGl6ZWRJbWFnZS5oZWlnaHQgKSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQlpbWFnZXNbIGltYWdlLnV1aWQgXSA9IG5ldyBTb3VyY2UoIGltYWdlQXJyYXkgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBsb2FkIHNpbmdsZSBpbWFnZQoKCQkJCQljb25zdCBkZXNlcmlhbGl6ZWRJbWFnZSA9IGRlc2VyaWFsaXplSW1hZ2UoIGltYWdlLnVybCApOwoJCQkJCWltYWdlc1sgaW1hZ2UudXVpZCBdID0gbmV3IFNvdXJjZSggZGVzZXJpYWxpemVkSW1hZ2UgKTsKCgoJCQkJfQoKCQkJfQoKCQl9CgoJCXJldHVybiBpbWFnZXM7CgoJfQoKCWFzeW5jIHBhcnNlSW1hZ2VzQXN5bmMoIGpzb24gKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCQljb25zdCBpbWFnZXMgPSB7fTsKCgkJbGV0IGxvYWRlcjsKCgkJYXN5bmMgZnVuY3Rpb24gZGVzZXJpYWxpemVJbWFnZSggaW1hZ2UgKSB7CgoJCQlpZiAoIHR5cGVvZiBpbWFnZSA9PT0gJ3N0cmluZycgKSB7CgoJCQkJY29uc3QgdXJsID0gaW1hZ2U7CgoJCQkJY29uc3QgcGF0aCA9IC9eKFwvXC8pfChbYS16XSs6KFwvXC8pPykvaS50ZXN0KCB1cmwgKSA/IHVybCA6IHNjb3BlLnJlc291cmNlUGF0aCArIHVybDsKCgkJCQlyZXR1cm4gYXdhaXQgbG9hZGVyLmxvYWRBc3luYyggcGF0aCApOwoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIGltYWdlLmRhdGEgKSB7CgoJCQkJCXJldHVybiB7CgkJCQkJCWRhdGE6IGdldFR5cGVkQXJyYXkoIGltYWdlLnR5cGUsIGltYWdlLmRhdGEgKSwKCQkJCQkJd2lkdGg6IGltYWdlLndpZHRoLAoJCQkJCQloZWlnaHQ6IGltYWdlLmhlaWdodAoJCQkJCX07CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmV0dXJuIG51bGw7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWlmICgganNvbiAhPT0gdW5kZWZpbmVkICYmIGpzb24ubGVuZ3RoID4gMCApIHsKCgkJCWxvYWRlciA9IG5ldyBJbWFnZUxvYWRlciggdGhpcy5tYW5hZ2VyICk7CgkJCWxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5jcm9zc09yaWdpbiApOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGpzb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgaW1hZ2UgPSBqc29uWyBpIF07CgkJCQljb25zdCB1cmwgPSBpbWFnZS51cmw7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCB1cmwgKSApIHsKCgkJCQkJLy8gbG9hZCBhcnJheSBvZiBpbWFnZXMgZS5nIEN1YmVUZXh0dXJlCgoJCQkJCWNvbnN0IGltYWdlQXJyYXkgPSBbXTsKCgkJCQkJZm9yICggbGV0IGogPSAwLCBqbCA9IHVybC5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQkJCWNvbnN0IGN1cnJlbnRVcmwgPSB1cmxbIGogXTsKCgkJCQkJCWNvbnN0IGRlc2VyaWFsaXplZEltYWdlID0gYXdhaXQgZGVzZXJpYWxpemVJbWFnZSggY3VycmVudFVybCApOwoKCQkJCQkJaWYgKCBkZXNlcmlhbGl6ZWRJbWFnZSAhPT0gbnVsbCApIHsKCgkJCQkJCQlpZiAoIGRlc2VyaWFsaXplZEltYWdlIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHsKCgkJCQkJCQkJaW1hZ2VBcnJheS5wdXNoKCBkZXNlcmlhbGl6ZWRJbWFnZSApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCS8vIHNwZWNpYWwgY2FzZTogaGFuZGxlIGFycmF5IG9mIGRhdGEgdGV4dHVyZXMgZm9yIGN1YmUgdGV4dHVyZXMKCgkJCQkJCQkJaW1hZ2VBcnJheS5wdXNoKCBuZXcgRGF0YVRleHR1cmUoIGRlc2VyaWFsaXplZEltYWdlLmRhdGEsIGRlc2VyaWFsaXplZEltYWdlLndpZHRoLCBkZXNlcmlhbGl6ZWRJbWFnZS5oZWlnaHQgKSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQlpbWFnZXNbIGltYWdlLnV1aWQgXSA9IG5ldyBTb3VyY2UoIGltYWdlQXJyYXkgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBsb2FkIHNpbmdsZSBpbWFnZQoKCQkJCQljb25zdCBkZXNlcmlhbGl6ZWRJbWFnZSA9IGF3YWl0IGRlc2VyaWFsaXplSW1hZ2UoIGltYWdlLnVybCApOwoJCQkJCWltYWdlc1sgaW1hZ2UudXVpZCBdID0gbmV3IFNvdXJjZSggZGVzZXJpYWxpemVkSW1hZ2UgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIGltYWdlczsKCgl9CgoJcGFyc2VUZXh0dXJlcygganNvbiwgaW1hZ2VzICkgewoKCQlmdW5jdGlvbiBwYXJzZUNvbnN0YW50KCB2YWx1ZSwgdHlwZSApIHsKCgkJCWlmICggdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyApIHJldHVybiB2YWx1ZTsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdExvYWRlci5wYXJzZVRleHR1cmU6IENvbnN0YW50IHNob3VsZCBiZSBpbiBudW1lcmljIGZvcm0uJywgdmFsdWUgKTsKCgkJCXJldHVybiB0eXBlWyB2YWx1ZSBdOwoKCQl9CgoJCWNvbnN0IHRleHR1cmVzID0ge307CgoJCWlmICgganNvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0ganNvbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IGRhdGEgPSBqc29uWyBpIF07CgoJCQkJaWYgKCBkYXRhLmltYWdlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdExvYWRlcjogTm8gImltYWdlIiBzcGVjaWZpZWQgZm9yJywgZGF0YS51dWlkICk7CgoJCQkJfQoKCQkJCWlmICggaW1hZ2VzWyBkYXRhLmltYWdlIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBVbmRlZmluZWQgaW1hZ2UnLCBkYXRhLmltYWdlICk7CgoJCQkJfQoKCQkJCWNvbnN0IHNvdXJjZSA9IGltYWdlc1sgZGF0YS5pbWFnZSBdOwoJCQkJY29uc3QgaW1hZ2UgPSBzb3VyY2UuZGF0YTsKCgkJCQlsZXQgdGV4dHVyZTsKCgkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIGltYWdlICkgKSB7CgoJCQkJCXRleHR1cmUgPSBuZXcgQ3ViZVRleHR1cmUoKTsKCgkJCQkJaWYgKCBpbWFnZS5sZW5ndGggPT09IDYgKSB0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIGltYWdlICYmIGltYWdlLmRhdGEgKSB7CgoJCQkJCQl0ZXh0dXJlID0gbmV3IERhdGFUZXh0dXJlKCk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl0ZXh0dXJlID0gbmV3IFRleHR1cmUoKTsKCgkJCQkJfQoKCQkJCQlpZiAoIGltYWdlICkgdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7IC8vIHRleHR1cmVzIGNhbiBoYXZlIHVuZGVmaW5lZCBpbWFnZSBkYXRhCgoJCQkJfQoKCQkJCXRleHR1cmUuc291cmNlID0gc291cmNlOwoKCQkJCXRleHR1cmUudXVpZCA9IGRhdGEudXVpZDsKCgkJCQlpZiAoIGRhdGEubmFtZSAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5uYW1lID0gZGF0YS5uYW1lOwoKCQkJCWlmICggZGF0YS5tYXBwaW5nICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLm1hcHBpbmcgPSBwYXJzZUNvbnN0YW50KCBkYXRhLm1hcHBpbmcsIFRFWFRVUkVfTUFQUElORyApOwoJCQkJaWYgKCBkYXRhLmNoYW5uZWwgIT09IHVuZGVmaW5lZCApIHRleHR1cmUuY2hhbm5lbCA9IGRhdGEuY2hhbm5lbDsKCgkJCQlpZiAoIGRhdGEub2Zmc2V0ICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLm9mZnNldC5mcm9tQXJyYXkoIGRhdGEub2Zmc2V0ICk7CgkJCQlpZiAoIGRhdGEucmVwZWF0ICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLnJlcGVhdC5mcm9tQXJyYXkoIGRhdGEucmVwZWF0ICk7CgkJCQlpZiAoIGRhdGEuY2VudGVyICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmNlbnRlci5mcm9tQXJyYXkoIGRhdGEuY2VudGVyICk7CgkJCQlpZiAoIGRhdGEucm90YXRpb24gIT09IHVuZGVmaW5lZCApIHRleHR1cmUucm90YXRpb24gPSBkYXRhLnJvdGF0aW9uOwoKCQkJCWlmICggZGF0YS53cmFwICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXRleHR1cmUud3JhcFMgPSBwYXJzZUNvbnN0YW50KCBkYXRhLndyYXBbIDAgXSwgVEVYVFVSRV9XUkFQUElORyApOwoJCQkJCXRleHR1cmUud3JhcFQgPSBwYXJzZUNvbnN0YW50KCBkYXRhLndyYXBbIDEgXSwgVEVYVFVSRV9XUkFQUElORyApOwoKCQkJCX0KCgkJCQlpZiAoIGRhdGEuZm9ybWF0ICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmZvcm1hdCA9IGRhdGEuZm9ybWF0OwoJCQkJaWYgKCBkYXRhLmludGVybmFsRm9ybWF0ICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmludGVybmFsRm9ybWF0ID0gZGF0YS5pbnRlcm5hbEZvcm1hdDsKCQkJCWlmICggZGF0YS50eXBlICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLnR5cGUgPSBkYXRhLnR5cGU7CgkJCQlpZiAoIGRhdGEuY29sb3JTcGFjZSAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5jb2xvclNwYWNlID0gZGF0YS5jb2xvclNwYWNlOwoJCQkJaWYgKCBkYXRhLmVuY29kaW5nICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmVuY29kaW5nID0gZGF0YS5lbmNvZGluZzsgLy8gQGRlcHJlY2F0ZWQsIHIxNTIKCgkJCQlpZiAoIGRhdGEubWluRmlsdGVyICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLm1pbkZpbHRlciA9IHBhcnNlQ29uc3RhbnQoIGRhdGEubWluRmlsdGVyLCBURVhUVVJFX0ZJTFRFUiApOwoJCQkJaWYgKCBkYXRhLm1hZ0ZpbHRlciAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5tYWdGaWx0ZXIgPSBwYXJzZUNvbnN0YW50KCBkYXRhLm1hZ0ZpbHRlciwgVEVYVFVSRV9GSUxURVIgKTsKCQkJCWlmICggZGF0YS5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmFuaXNvdHJvcHkgPSBkYXRhLmFuaXNvdHJvcHk7CgoJCQkJaWYgKCBkYXRhLmZsaXBZICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmZsaXBZID0gZGF0YS5mbGlwWTsKCgkJCQlpZiAoIGRhdGEuZ2VuZXJhdGVNaXBtYXBzICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGRhdGEuZ2VuZXJhdGVNaXBtYXBzOwoJCQkJaWYgKCBkYXRhLnByZW11bHRpcGx5QWxwaGEgIT09IHVuZGVmaW5lZCApIHRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSA9IGRhdGEucHJlbXVsdGlwbHlBbHBoYTsKCQkJCWlmICggZGF0YS51bnBhY2tBbGlnbm1lbnQgIT09IHVuZGVmaW5lZCApIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ID0gZGF0YS51bnBhY2tBbGlnbm1lbnQ7CgkJCQlpZiAoIGRhdGEuY29tcGFyZUZ1bmN0aW9uICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmNvbXBhcmVGdW5jdGlvbiA9IGRhdGEuY29tcGFyZUZ1bmN0aW9uOwoKCQkJCWlmICggZGF0YS51c2VyRGF0YSAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS51c2VyRGF0YSA9IGRhdGEudXNlckRhdGE7CgoJCQkJdGV4dHVyZXNbIGRhdGEudXVpZCBdID0gdGV4dHVyZTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdGV4dHVyZXM7CgoJfQoKCXBhcnNlT2JqZWN0KCBkYXRhLCBnZW9tZXRyaWVzLCBtYXRlcmlhbHMsIHRleHR1cmVzLCBhbmltYXRpb25zICkgewoKCQlsZXQgb2JqZWN0OwoKCQlmdW5jdGlvbiBnZXRHZW9tZXRyeSggbmFtZSApIHsKCgkJCWlmICggZ2VvbWV0cmllc1sgbmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBVbmRlZmluZWQgZ2VvbWV0cnknLCBuYW1lICk7CgoJCQl9CgoJCQlyZXR1cm4gZ2VvbWV0cmllc1sgbmFtZSBdOwoKCQl9CgoJCWZ1bmN0aW9uIGdldE1hdGVyaWFsKCBuYW1lICkgewoKCQkJaWYgKCBuYW1lID09PSB1bmRlZmluZWQgKSByZXR1cm4gdW5kZWZpbmVkOwoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCBuYW1lICkgKSB7CgoJCQkJY29uc3QgYXJyYXkgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBuYW1lLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IHV1aWQgPSBuYW1lWyBpIF07CgoJCQkJCWlmICggbWF0ZXJpYWxzWyB1dWlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdExvYWRlcjogVW5kZWZpbmVkIG1hdGVyaWFsJywgdXVpZCApOwoKCQkJCQl9CgoJCQkJCWFycmF5LnB1c2goIG1hdGVyaWFsc1sgdXVpZCBdICk7CgoJCQkJfQoKCQkJCXJldHVybiBhcnJheTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWxzWyBuYW1lIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3RMb2FkZXI6IFVuZGVmaW5lZCBtYXRlcmlhbCcsIG5hbWUgKTsKCgkJCX0KCgkJCXJldHVybiBtYXRlcmlhbHNbIG5hbWUgXTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRUZXh0dXJlKCB1dWlkICkgewoKCQkJaWYgKCB0ZXh0dXJlc1sgdXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBVbmRlZmluZWQgdGV4dHVyZScsIHV1aWQgKTsKCgkJCX0KCgkJCXJldHVybiB0ZXh0dXJlc1sgdXVpZCBdOwoKCQl9CgoJCWxldCBnZW9tZXRyeSwgbWF0ZXJpYWw7CgoJCXN3aXRjaCAoIGRhdGEudHlwZSApIHsKCgkJCWNhc2UgJ1NjZW5lJzoKCgkJCQlvYmplY3QgPSBuZXcgU2NlbmUoKTsKCgkJCQlpZiAoIGRhdGEuYmFja2dyb3VuZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlpZiAoIE51bWJlci5pc0ludGVnZXIoIGRhdGEuYmFja2dyb3VuZCApICkgewoKCQkJCQkJb2JqZWN0LmJhY2tncm91bmQgPSBuZXcgQ29sb3IoIGRhdGEuYmFja2dyb3VuZCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJb2JqZWN0LmJhY2tncm91bmQgPSBnZXRUZXh0dXJlKCBkYXRhLmJhY2tncm91bmQgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIGRhdGEuZW52aXJvbm1lbnQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJb2JqZWN0LmVudmlyb25tZW50ID0gZ2V0VGV4dHVyZSggZGF0YS5lbnZpcm9ubWVudCApOwoKCQkJCX0KCgkJCQlpZiAoIGRhdGEuZm9nICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWlmICggZGF0YS5mb2cudHlwZSA9PT0gJ0ZvZycgKSB7CgoJCQkJCQlvYmplY3QuZm9nID0gbmV3IEZvZyggZGF0YS5mb2cuY29sb3IsIGRhdGEuZm9nLm5lYXIsIGRhdGEuZm9nLmZhciApOwoKCQkJCQl9IGVsc2UgaWYgKCBkYXRhLmZvZy50eXBlID09PSAnRm9nRXhwMicgKSB7CgoJCQkJCQlvYmplY3QuZm9nID0gbmV3IEZvZ0V4cDIoIGRhdGEuZm9nLmNvbG9yLCBkYXRhLmZvZy5kZW5zaXR5ICk7CgoJCQkJCX0KCgkJCQkJaWYgKCBkYXRhLmZvZy5uYW1lICE9PSAnJyApIHsKCgkJCQkJCW9iamVjdC5mb2cubmFtZSA9IGRhdGEuZm9nLm5hbWU7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCBkYXRhLmJhY2tncm91bmRCbHVycmluZXNzICE9PSB1bmRlZmluZWQgKSBvYmplY3QuYmFja2dyb3VuZEJsdXJyaW5lc3MgPSBkYXRhLmJhY2tncm91bmRCbHVycmluZXNzOwoJCQkJaWYgKCBkYXRhLmJhY2tncm91bmRJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIG9iamVjdC5iYWNrZ3JvdW5kSW50ZW5zaXR5ID0gZGF0YS5iYWNrZ3JvdW5kSW50ZW5zaXR5OwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnUGVyc3BlY3RpdmVDYW1lcmEnOgoKCQkJCW9iamVjdCA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggZGF0YS5mb3YsIGRhdGEuYXNwZWN0LCBkYXRhLm5lYXIsIGRhdGEuZmFyICk7CgoJCQkJaWYgKCBkYXRhLmZvY3VzICE9PSB1bmRlZmluZWQgKSBvYmplY3QuZm9jdXMgPSBkYXRhLmZvY3VzOwoJCQkJaWYgKCBkYXRhLnpvb20gIT09IHVuZGVmaW5lZCApIG9iamVjdC56b29tID0gZGF0YS56b29tOwoJCQkJaWYgKCBkYXRhLmZpbG1HYXVnZSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LmZpbG1HYXVnZSA9IGRhdGEuZmlsbUdhdWdlOwoJCQkJaWYgKCBkYXRhLmZpbG1PZmZzZXQgIT09IHVuZGVmaW5lZCApIG9iamVjdC5maWxtT2Zmc2V0ID0gZGF0YS5maWxtT2Zmc2V0OwoJCQkJaWYgKCBkYXRhLnZpZXcgIT09IHVuZGVmaW5lZCApIG9iamVjdC52aWV3ID0gT2JqZWN0LmFzc2lnbigge30sIGRhdGEudmlldyApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnT3J0aG9ncmFwaGljQ2FtZXJhJzoKCgkJCQlvYmplY3QgPSBuZXcgT3J0aG9ncmFwaGljQ2FtZXJhKCBkYXRhLmxlZnQsIGRhdGEucmlnaHQsIGRhdGEudG9wLCBkYXRhLmJvdHRvbSwgZGF0YS5uZWFyLCBkYXRhLmZhciApOwoKCQkJCWlmICggZGF0YS56b29tICE9PSB1bmRlZmluZWQgKSBvYmplY3Quem9vbSA9IGRhdGEuem9vbTsKCQkJCWlmICggZGF0YS52aWV3ICE9PSB1bmRlZmluZWQgKSBvYmplY3QudmlldyA9IE9iamVjdC5hc3NpZ24oIHt9LCBkYXRhLnZpZXcgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0FtYmllbnRMaWdodCc6CgoJCQkJb2JqZWN0ID0gbmV3IEFtYmllbnRMaWdodCggZGF0YS5jb2xvciwgZGF0YS5pbnRlbnNpdHkgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0RpcmVjdGlvbmFsTGlnaHQnOgoKCQkJCW9iamVjdCA9IG5ldyBEaXJlY3Rpb25hbExpZ2h0KCBkYXRhLmNvbG9yLCBkYXRhLmludGVuc2l0eSApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnUG9pbnRMaWdodCc6CgoJCQkJb2JqZWN0ID0gbmV3IFBvaW50TGlnaHQoIGRhdGEuY29sb3IsIGRhdGEuaW50ZW5zaXR5LCBkYXRhLmRpc3RhbmNlLCBkYXRhLmRlY2F5ICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdSZWN0QXJlYUxpZ2h0JzoKCgkJCQlvYmplY3QgPSBuZXcgUmVjdEFyZWFMaWdodCggZGF0YS5jb2xvciwgZGF0YS5pbnRlbnNpdHksIGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0ICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdTcG90TGlnaHQnOgoKCQkJCW9iamVjdCA9IG5ldyBTcG90TGlnaHQoIGRhdGEuY29sb3IsIGRhdGEuaW50ZW5zaXR5LCBkYXRhLmRpc3RhbmNlLCBkYXRhLmFuZ2xlLCBkYXRhLnBlbnVtYnJhLCBkYXRhLmRlY2F5ICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdIZW1pc3BoZXJlTGlnaHQnOgoKCQkJCW9iamVjdCA9IG5ldyBIZW1pc3BoZXJlTGlnaHQoIGRhdGEuY29sb3IsIGRhdGEuZ3JvdW5kQ29sb3IsIGRhdGEuaW50ZW5zaXR5ICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdMaWdodFByb2JlJzoKCgkJCQlvYmplY3QgPSBuZXcgTGlnaHRQcm9iZSgpLmZyb21KU09OKCBkYXRhICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdTa2lubmVkTWVzaCc6CgoJCQkJZ2VvbWV0cnkgPSBnZXRHZW9tZXRyeSggZGF0YS5nZW9tZXRyeSApOwoJCQkgCW1hdGVyaWFsID0gZ2V0TWF0ZXJpYWwoIGRhdGEubWF0ZXJpYWwgKTsKCgkJCQlvYmplY3QgPSBuZXcgU2tpbm5lZE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQkJCWlmICggZGF0YS5iaW5kTW9kZSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LmJpbmRNb2RlID0gZGF0YS5iaW5kTW9kZTsKCQkJCWlmICggZGF0YS5iaW5kTWF0cml4ICE9PSB1bmRlZmluZWQgKSBvYmplY3QuYmluZE1hdHJpeC5mcm9tQXJyYXkoIGRhdGEuYmluZE1hdHJpeCApOwoJCQkJaWYgKCBkYXRhLnNrZWxldG9uICE9PSB1bmRlZmluZWQgKSBvYmplY3Quc2tlbGV0b24gPSBkYXRhLnNrZWxldG9uOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnTWVzaCc6CgoJCQkJZ2VvbWV0cnkgPSBnZXRHZW9tZXRyeSggZGF0YS5nZW9tZXRyeSApOwoJCQkJbWF0ZXJpYWwgPSBnZXRNYXRlcmlhbCggZGF0YS5tYXRlcmlhbCApOwoKCQkJCW9iamVjdCA9IG5ldyBNZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0luc3RhbmNlZE1lc2gnOgoKCQkJCWdlb21ldHJ5ID0gZ2V0R2VvbWV0cnkoIGRhdGEuZ2VvbWV0cnkgKTsKCQkJCW1hdGVyaWFsID0gZ2V0TWF0ZXJpYWwoIGRhdGEubWF0ZXJpYWwgKTsKCQkJCWNvbnN0IGNvdW50ID0gZGF0YS5jb3VudDsKCQkJCWNvbnN0IGluc3RhbmNlTWF0cml4ID0gZGF0YS5pbnN0YW5jZU1hdHJpeDsKCQkJCWNvbnN0IGluc3RhbmNlQ29sb3IgPSBkYXRhLmluc3RhbmNlQ29sb3I7CgoJCQkJb2JqZWN0ID0gbmV3IEluc3RhbmNlZE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCwgY291bnQgKTsKCQkJCW9iamVjdC5pbnN0YW5jZU1hdHJpeCA9IG5ldyBJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUoIG5ldyBGbG9hdDMyQXJyYXkoIGluc3RhbmNlTWF0cml4LmFycmF5ICksIDE2ICk7CgkJCQlpZiAoIGluc3RhbmNlQ29sb3IgIT09IHVuZGVmaW5lZCApIG9iamVjdC5pbnN0YW5jZUNvbG9yID0gbmV3IEluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSggbmV3IEZsb2F0MzJBcnJheSggaW5zdGFuY2VDb2xvci5hcnJheSApLCBpbnN0YW5jZUNvbG9yLml0ZW1TaXplICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdCYXRjaGVkTWVzaCc6CgoJCQkJZ2VvbWV0cnkgPSBnZXRHZW9tZXRyeSggZGF0YS5nZW9tZXRyeSApOwoJCQkJbWF0ZXJpYWwgPSBnZXRNYXRlcmlhbCggZGF0YS5tYXRlcmlhbCApOwoKCQkJCW9iamVjdCA9IG5ldyBCYXRjaGVkTWVzaCggZGF0YS5tYXhHZW9tZXRyeUNvdW50LCBkYXRhLm1heFZlcnRleENvdW50LCBkYXRhLm1heEluZGV4Q291bnQsIG1hdGVyaWFsICk7CgkJCQlvYmplY3QuZ2VvbWV0cnkgPSBnZW9tZXRyeTsKCQkJCW9iamVjdC5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkID0gZGF0YS5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkOwoJCQkJb2JqZWN0LnNvcnRPYmplY3RzID0gZGF0YS5zb3J0T2JqZWN0czsKCgkJCQlvYmplY3QuX2RyYXdSYW5nZXMgPSBkYXRhLmRyYXdSYW5nZXM7CgkJCQlvYmplY3QuX3Jlc2VydmVkUmFuZ2VzID0gZGF0YS5yZXNlcnZlZFJhbmdlczsKCgkJCQlvYmplY3QuX3Zpc2liaWxpdHkgPSBkYXRhLnZpc2liaWxpdHk7CgkJCQlvYmplY3QuX2FjdGl2ZSA9IGRhdGEuYWN0aXZlOwoJCQkJb2JqZWN0Ll9ib3VuZHMgPSBkYXRhLmJvdW5kcy5tYXAoIGJvdW5kID0+IHsKCgkJCQkJY29uc3QgYm94ID0gbmV3IEJveDMoKTsKCQkJCQlib3gubWluLmZyb21BcnJheSggYm91bmQuYm94TWluICk7CgkJCQkJYm94Lm1heC5mcm9tQXJyYXkoIGJvdW5kLmJveE1heCApOwoKCQkJCQljb25zdCBzcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgkJCQkJc3BoZXJlLnJhZGl1cyA9IGJvdW5kLnNwaGVyZVJhZGl1czsKCQkJCQlzcGhlcmUuY2VudGVyLmZyb21BcnJheSggYm91bmQuc3BoZXJlQ2VudGVyICk7CgoJCQkJCXJldHVybiB7CgkJCQkJCWJveEluaXRpYWxpemVkOiBib3VuZC5ib3hJbml0aWFsaXplZCwKCQkJCQkJYm94OiBib3gsCgoJCQkJCQlzcGhlcmVJbml0aWFsaXplZDogYm91bmQuc3BoZXJlSW5pdGlhbGl6ZWQsCgkJCQkJCXNwaGVyZTogc3BoZXJlCgkJCQkJfTsKCgkJCQl9ICk7CgoJCQkJb2JqZWN0Ll9tYXhHZW9tZXRyeUNvdW50ID0gZGF0YS5tYXhHZW9tZXRyeUNvdW50OwoJCQkJb2JqZWN0Ll9tYXhWZXJ0ZXhDb3VudCA9IGRhdGEubWF4VmVydGV4Q291bnQ7CgkJCQlvYmplY3QuX21heEluZGV4Q291bnQgPSBkYXRhLm1heEluZGV4Q291bnQ7CgoJCQkJb2JqZWN0Ll9nZW9tZXRyeUluaXRpYWxpemVkID0gZGF0YS5nZW9tZXRyeUluaXRpYWxpemVkOwoJCQkJb2JqZWN0Ll9nZW9tZXRyeUNvdW50ID0gZGF0YS5nZW9tZXRyeUNvdW50OwoKCQkJCW9iamVjdC5fbWF0cmljZXNUZXh0dXJlID0gZ2V0VGV4dHVyZSggZGF0YS5tYXRyaWNlc1RleHR1cmUudXVpZCApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnTE9EJzoKCgkJCQlvYmplY3QgPSBuZXcgTE9EKCk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdMaW5lJzoKCgkJCQlvYmplY3QgPSBuZXcgTGluZSggZ2V0R2VvbWV0cnkoIGRhdGEuZ2VvbWV0cnkgKSwgZ2V0TWF0ZXJpYWwoIGRhdGEubWF0ZXJpYWwgKSApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnTGluZUxvb3AnOgoKCQkJCW9iamVjdCA9IG5ldyBMaW5lTG9vcCggZ2V0R2VvbWV0cnkoIGRhdGEuZ2VvbWV0cnkgKSwgZ2V0TWF0ZXJpYWwoIGRhdGEubWF0ZXJpYWwgKSApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnTGluZVNlZ21lbnRzJzoKCgkJCQlvYmplY3QgPSBuZXcgTGluZVNlZ21lbnRzKCBnZXRHZW9tZXRyeSggZGF0YS5nZW9tZXRyeSApLCBnZXRNYXRlcmlhbCggZGF0YS5tYXRlcmlhbCApICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdQb2ludENsb3VkJzoKCQkJY2FzZSAnUG9pbnRzJzoKCgkJCQlvYmplY3QgPSBuZXcgUG9pbnRzKCBnZXRHZW9tZXRyeSggZGF0YS5nZW9tZXRyeSApLCBnZXRNYXRlcmlhbCggZGF0YS5tYXRlcmlhbCApICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdTcHJpdGUnOgoKCQkJCW9iamVjdCA9IG5ldyBTcHJpdGUoIGdldE1hdGVyaWFsKCBkYXRhLm1hdGVyaWFsICkgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0dyb3VwJzoKCgkJCQlvYmplY3QgPSBuZXcgR3JvdXAoKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0JvbmUnOgoKCQkJCW9iamVjdCA9IG5ldyBCb25lKCk7CgoJCQkJYnJlYWs7CgoJCQlkZWZhdWx0OgoKCQkJCW9iamVjdCA9IG5ldyBPYmplY3QzRCgpOwoKCQl9CgoJCW9iamVjdC51dWlkID0gZGF0YS51dWlkOwoKCQlpZiAoIGRhdGEubmFtZSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0Lm5hbWUgPSBkYXRhLm5hbWU7CgoJCWlmICggZGF0YS5tYXRyaXggIT09IHVuZGVmaW5lZCApIHsKCgkJCW9iamVjdC5tYXRyaXguZnJvbUFycmF5KCBkYXRhLm1hdHJpeCApOwoKCQkJaWYgKCBkYXRhLm1hdHJpeEF1dG9VcGRhdGUgIT09IHVuZGVmaW5lZCApIG9iamVjdC5tYXRyaXhBdXRvVXBkYXRlID0gZGF0YS5tYXRyaXhBdXRvVXBkYXRlOwoJCQlpZiAoIG9iamVjdC5tYXRyaXhBdXRvVXBkYXRlICkgb2JqZWN0Lm1hdHJpeC5kZWNvbXBvc2UoIG9iamVjdC5wb3NpdGlvbiwgb2JqZWN0LnF1YXRlcm5pb24sIG9iamVjdC5zY2FsZSApOwoKCQl9IGVsc2UgewoKCQkJaWYgKCBkYXRhLnBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSBvYmplY3QucG9zaXRpb24uZnJvbUFycmF5KCBkYXRhLnBvc2l0aW9uICk7CgkJCWlmICggZGF0YS5yb3RhdGlvbiAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnJvdGF0aW9uLmZyb21BcnJheSggZGF0YS5yb3RhdGlvbiApOwoJCQlpZiAoIGRhdGEucXVhdGVybmlvbiAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnF1YXRlcm5pb24uZnJvbUFycmF5KCBkYXRhLnF1YXRlcm5pb24gKTsKCQkJaWYgKCBkYXRhLnNjYWxlICE9PSB1bmRlZmluZWQgKSBvYmplY3Quc2NhbGUuZnJvbUFycmF5KCBkYXRhLnNjYWxlICk7CgoJCX0KCgkJaWYgKCBkYXRhLnVwICE9PSB1bmRlZmluZWQgKSBvYmplY3QudXAuZnJvbUFycmF5KCBkYXRhLnVwICk7CgoJCWlmICggZGF0YS5jYXN0U2hhZG93ICE9PSB1bmRlZmluZWQgKSBvYmplY3QuY2FzdFNoYWRvdyA9IGRhdGEuY2FzdFNoYWRvdzsKCQlpZiAoIGRhdGEucmVjZWl2ZVNoYWRvdyAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnJlY2VpdmVTaGFkb3cgPSBkYXRhLnJlY2VpdmVTaGFkb3c7CgoJCWlmICggZGF0YS5zaGFkb3cgKSB7CgoJCQlpZiAoIGRhdGEuc2hhZG93LmJpYXMgIT09IHVuZGVmaW5lZCApIG9iamVjdC5zaGFkb3cuYmlhcyA9IGRhdGEuc2hhZG93LmJpYXM7CgkJCWlmICggZGF0YS5zaGFkb3cubm9ybWFsQmlhcyAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnNoYWRvdy5ub3JtYWxCaWFzID0gZGF0YS5zaGFkb3cubm9ybWFsQmlhczsKCQkJaWYgKCBkYXRhLnNoYWRvdy5yYWRpdXMgIT09IHVuZGVmaW5lZCApIG9iamVjdC5zaGFkb3cucmFkaXVzID0gZGF0YS5zaGFkb3cucmFkaXVzOwoJCQlpZiAoIGRhdGEuc2hhZG93Lm1hcFNpemUgIT09IHVuZGVmaW5lZCApIG9iamVjdC5zaGFkb3cubWFwU2l6ZS5mcm9tQXJyYXkoIGRhdGEuc2hhZG93Lm1hcFNpemUgKTsKCQkJaWYgKCBkYXRhLnNoYWRvdy5jYW1lcmEgIT09IHVuZGVmaW5lZCApIG9iamVjdC5zaGFkb3cuY2FtZXJhID0gdGhpcy5wYXJzZU9iamVjdCggZGF0YS5zaGFkb3cuY2FtZXJhICk7CgoJCX0KCgkJaWYgKCBkYXRhLnZpc2libGUgIT09IHVuZGVmaW5lZCApIG9iamVjdC52aXNpYmxlID0gZGF0YS52aXNpYmxlOwoJCWlmICggZGF0YS5mcnVzdHVtQ3VsbGVkICE9PSB1bmRlZmluZWQgKSBvYmplY3QuZnJ1c3R1bUN1bGxlZCA9IGRhdGEuZnJ1c3R1bUN1bGxlZDsKCQlpZiAoIGRhdGEucmVuZGVyT3JkZXIgIT09IHVuZGVmaW5lZCApIG9iamVjdC5yZW5kZXJPcmRlciA9IGRhdGEucmVuZGVyT3JkZXI7CgkJaWYgKCBkYXRhLnVzZXJEYXRhICE9PSB1bmRlZmluZWQgKSBvYmplY3QudXNlckRhdGEgPSBkYXRhLnVzZXJEYXRhOwoJCWlmICggZGF0YS5sYXllcnMgIT09IHVuZGVmaW5lZCApIG9iamVjdC5sYXllcnMubWFzayA9IGRhdGEubGF5ZXJzOwoKCQlpZiAoIGRhdGEuY2hpbGRyZW4gIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IGNoaWxkcmVuID0gZGF0YS5jaGlsZHJlbjsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCgkJCQlvYmplY3QuYWRkKCB0aGlzLnBhcnNlT2JqZWN0KCBjaGlsZHJlblsgaSBdLCBnZW9tZXRyaWVzLCBtYXRlcmlhbHMsIHRleHR1cmVzLCBhbmltYXRpb25zICkgKTsKCgkJCX0KCgkJfQoKCQlpZiAoIGRhdGEuYW5pbWF0aW9ucyAhPT0gdW5kZWZpbmVkICkgewoKCQkJY29uc3Qgb2JqZWN0QW5pbWF0aW9ucyA9IGRhdGEuYW5pbWF0aW9uczsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IG9iamVjdEFuaW1hdGlvbnMubGVuZ3RoOyBpICsrICkgewoKCQkJCWNvbnN0IHV1aWQgPSBvYmplY3RBbmltYXRpb25zWyBpIF07CgoJCQkJb2JqZWN0LmFuaW1hdGlvbnMucHVzaCggYW5pbWF0aW9uc1sgdXVpZCBdICk7CgoJCQl9CgoJCX0KCgkJaWYgKCBkYXRhLnR5cGUgPT09ICdMT0QnICkgewoKCQkJaWYgKCBkYXRhLmF1dG9VcGRhdGUgIT09IHVuZGVmaW5lZCApIG9iamVjdC5hdXRvVXBkYXRlID0gZGF0YS5hdXRvVXBkYXRlOwoKCQkJY29uc3QgbGV2ZWxzID0gZGF0YS5sZXZlbHM7CgoJCQlmb3IgKCBsZXQgbCA9IDA7IGwgPCBsZXZlbHMubGVuZ3RoOyBsICsrICkgewoKCQkJCWNvbnN0IGxldmVsID0gbGV2ZWxzWyBsIF07CgkJCQljb25zdCBjaGlsZCA9IG9iamVjdC5nZXRPYmplY3RCeVByb3BlcnR5KCAndXVpZCcsIGxldmVsLm9iamVjdCApOwoKCQkJCWlmICggY2hpbGQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJb2JqZWN0LmFkZExldmVsKCBjaGlsZCwgbGV2ZWwuZGlzdGFuY2UsIGxldmVsLmh5c3RlcmVzaXMgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIG9iamVjdDsKCgl9CgoJYmluZFNrZWxldG9ucyggb2JqZWN0LCBza2VsZXRvbnMgKSB7CgoJCWlmICggT2JqZWN0LmtleXMoIHNrZWxldG9ucyApLmxlbmd0aCA9PT0gMCApIHJldHVybjsKCgkJb2JqZWN0LnRyYXZlcnNlKCBmdW5jdGlvbiAoIGNoaWxkICkgewoKCQkJaWYgKCBjaGlsZC5pc1NraW5uZWRNZXNoID09PSB0cnVlICYmIGNoaWxkLnNrZWxldG9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3Qgc2tlbGV0b24gPSBza2VsZXRvbnNbIGNoaWxkLnNrZWxldG9uIF07CgoJCQkJaWYgKCBza2VsZXRvbiA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3RMb2FkZXI6IE5vIHNrZWxldG9uIGZvdW5kIHdpdGggVVVJRDonLCBjaGlsZC5za2VsZXRvbiApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWNoaWxkLmJpbmQoIHNrZWxldG9uLCBjaGlsZC5iaW5kTWF0cml4ICk7CgoJCQkJfQoKCQkJfQoKCQl9ICk7CgoJfQoKfQoKY29uc3QgVEVYVFVSRV9NQVBQSU5HID0gewoJVVZNYXBwaW5nOiBVVk1hcHBpbmcsCglDdWJlUmVmbGVjdGlvbk1hcHBpbmc6IEN1YmVSZWZsZWN0aW9uTWFwcGluZywKCUN1YmVSZWZyYWN0aW9uTWFwcGluZzogQ3ViZVJlZnJhY3Rpb25NYXBwaW5nLAoJRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmc6IEVxdWlyZWN0YW5ndWxhclJlZmxlY3Rpb25NYXBwaW5nLAoJRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmc6IEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nLAoJQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmc6IEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nCn07Cgpjb25zdCBURVhUVVJFX1dSQVBQSU5HID0gewoJUmVwZWF0V3JhcHBpbmc6IFJlcGVhdFdyYXBwaW5nLAoJQ2xhbXBUb0VkZ2VXcmFwcGluZzogQ2xhbXBUb0VkZ2VXcmFwcGluZywKCU1pcnJvcmVkUmVwZWF0V3JhcHBpbmc6IE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcKfTsKCmNvbnN0IFRFWFRVUkVfRklMVEVSID0gewoJTmVhcmVzdEZpbHRlcjogTmVhcmVzdEZpbHRlciwKCU5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyOiBOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlciwKCU5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXI6IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIsCglMaW5lYXJGaWx0ZXI6IExpbmVhckZpbHRlciwKCUxpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXI6IExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXIsCglMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXI6IExpbmVhck1pcG1hcExpbmVhckZpbHRlcgp9OwoKY2xhc3MgSW1hZ2VCaXRtYXBMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQlzdXBlciggbWFuYWdlciApOwoKCQl0aGlzLmlzSW1hZ2VCaXRtYXBMb2FkZXIgPSB0cnVlOwoKCQlpZiAoIHR5cGVvZiBjcmVhdGVJbWFnZUJpdG1hcCA9PT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5JbWFnZUJpdG1hcExvYWRlcjogY3JlYXRlSW1hZ2VCaXRtYXAoKSBub3Qgc3VwcG9ydGVkLicgKTsKCgkJfQoKCQlpZiAoIHR5cGVvZiBmZXRjaCA9PT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5JbWFnZUJpdG1hcExvYWRlcjogZmV0Y2goKSBub3Qgc3VwcG9ydGVkLicgKTsKCgkJfQoKCQl0aGlzLm9wdGlvbnMgPSB7IHByZW11bHRpcGx5QWxwaGE6ICdub25lJyB9OwoKCX0KCglzZXRPcHRpb25zKCBvcHRpb25zICkgewoKCQl0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWlmICggdXJsID09PSB1bmRlZmluZWQgKSB1cmwgPSAnJzsKCgkJaWYgKCB0aGlzLnBhdGggIT09IHVuZGVmaW5lZCApIHVybCA9IHRoaXMucGF0aCArIHVybDsKCgkJdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwoIHVybCApOwoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCWNvbnN0IGNhY2hlZCA9IENhY2hlLmdldCggdXJsICk7CgoJCWlmICggY2FjaGVkICE9PSB1bmRlZmluZWQgKSB7CgoJCQlzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgoJCQkvLyBJZiBjYWNoZWQgaXMgYSBwcm9taXNlLCB3YWl0IGZvciBpdCB0byByZXNvbHZlCgkJCWlmICggY2FjaGVkLnRoZW4gKSB7CgoJCQkJY2FjaGVkLnRoZW4oIGltYWdlQml0bWFwID0+IHsKCgkJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIGltYWdlQml0bWFwICk7CgoJCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQkJfSApLmNhdGNoKCBlID0+IHsKCgkJCQkJaWYgKCBvbkVycm9yICkgb25FcnJvciggZSApOwoKCQkJCX0gKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCS8vIElmIGNhY2hlZCBpcyBub3QgYSBwcm9taXNlIChpLmUuLCBpdCdzIGFscmVhZHkgYW4gaW1hZ2VCaXRtYXApCgkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHsKCgkJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggY2FjaGVkICk7CgoJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCX0sIDAgKTsKCgkJCXJldHVybiBjYWNoZWQ7CgoJCX0KCgkJY29uc3QgZmV0Y2hPcHRpb25zID0ge307CgkJZmV0Y2hPcHRpb25zLmNyZWRlbnRpYWxzID0gKCB0aGlzLmNyb3NzT3JpZ2luID09PSAnYW5vbnltb3VzJyApID8gJ3NhbWUtb3JpZ2luJyA6ICdpbmNsdWRlJzsKCQlmZXRjaE9wdGlvbnMuaGVhZGVycyA9IHRoaXMucmVxdWVzdEhlYWRlcjsKCgkJY29uc3QgcHJvbWlzZSA9IGZldGNoKCB1cmwsIGZldGNoT3B0aW9ucyApLnRoZW4oIGZ1bmN0aW9uICggcmVzICkgewoKCQkJcmV0dXJuIHJlcy5ibG9iKCk7CgoJCX0gKS50aGVuKCBmdW5jdGlvbiAoIGJsb2IgKSB7CgoJCQlyZXR1cm4gY3JlYXRlSW1hZ2VCaXRtYXAoIGJsb2IsIE9iamVjdC5hc3NpZ24oIHNjb3BlLm9wdGlvbnMsIHsgY29sb3JTcGFjZUNvbnZlcnNpb246ICdub25lJyB9ICkgKTsKCgkJfSApLnRoZW4oIGZ1bmN0aW9uICggaW1hZ2VCaXRtYXAgKSB7CgoJCQlDYWNoZS5hZGQoIHVybCwgaW1hZ2VCaXRtYXAgKTsKCgkJCWlmICggb25Mb2FkICkgb25Mb2FkKCBpbWFnZUJpdG1hcCApOwoKCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCXJldHVybiBpbWFnZUJpdG1hcDsKCgkJfSApLmNhdGNoKCBmdW5jdGlvbiAoIGUgKSB7CgoJCQlpZiAoIG9uRXJyb3IgKSBvbkVycm9yKCBlICk7CgoJCQlDYWNoZS5yZW1vdmUoIHVybCApOwoKCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQl9ICk7CgoJCUNhY2hlLmFkZCggdXJsLCBwcm9taXNlICk7CgkJc2NvcGUubWFuYWdlci5pdGVtU3RhcnQoIHVybCApOwoKCX0KCn0KCmxldCBfY29udGV4dDsKCmNsYXNzIEF1ZGlvQ29udGV4dCB7CgoJc3RhdGljIGdldENvbnRleHQoKSB7CgoJCWlmICggX2NvbnRleHQgPT09IHVuZGVmaW5lZCApIHsKCgkJCV9jb250ZXh0ID0gbmV3ICggd2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0ICkoKTsKCgkJfQoKCQlyZXR1cm4gX2NvbnRleHQ7CgoJfQoKCXN0YXRpYyBzZXRDb250ZXh0KCB2YWx1ZSApIHsKCgkJX2NvbnRleHQgPSB2YWx1ZTsKCgl9Cgp9CgpjbGFzcyBBdWRpb0xvYWRlciBleHRlbmRzIExvYWRlciB7CgoJY29uc3RydWN0b3IoIG1hbmFnZXIgKSB7CgoJCXN1cGVyKCBtYW5hZ2VyICk7CgoJfQoKCWxvYWQoIHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCWNvbnN0IGxvYWRlciA9IG5ldyBGaWxlTG9hZGVyKCB0aGlzLm1hbmFnZXIgKTsKCQlsb2FkZXIuc2V0UmVzcG9uc2VUeXBlKCAnYXJyYXlidWZmZXInICk7CgkJbG9hZGVyLnNldFBhdGgoIHRoaXMucGF0aCApOwoJCWxvYWRlci5zZXRSZXF1ZXN0SGVhZGVyKCB0aGlzLnJlcXVlc3RIZWFkZXIgKTsKCQlsb2FkZXIuc2V0V2l0aENyZWRlbnRpYWxzKCB0aGlzLndpdGhDcmVkZW50aWFscyApOwoJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggYnVmZmVyICkgewoKCQkJdHJ5IHsKCgkJCQkvLyBDcmVhdGUgYSBjb3B5IG9mIHRoZSBidWZmZXIuIFRoZSBgZGVjb2RlQXVkaW9EYXRhYCBtZXRob2QKCQkJCS8vIGRldGFjaGVzIHRoZSBidWZmZXIgd2hlbiBjb21wbGV0ZSwgcHJldmVudGluZyByZXVzZS4KCQkJCWNvbnN0IGJ1ZmZlckNvcHkgPSBidWZmZXIuc2xpY2UoIDAgKTsKCgkJCQljb25zdCBjb250ZXh0ID0gQXVkaW9Db250ZXh0LmdldENvbnRleHQoKTsKCQkJCWNvbnRleHQuZGVjb2RlQXVkaW9EYXRhKCBidWZmZXJDb3B5LCBmdW5jdGlvbiAoIGF1ZGlvQnVmZmVyICkgewoKCQkJCQlvbkxvYWQoIGF1ZGlvQnVmZmVyICk7CgoJCQkJfSApLmNhdGNoKCBoYW5kbGVFcnJvciApOwoKCQkJfSBjYXRjaCAoIGUgKSB7CgoJCQkJaGFuZGxlRXJyb3IoIGUgKTsKCgkJCX0KCgkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQlmdW5jdGlvbiBoYW5kbGVFcnJvciggZSApIHsKCgkJCWlmICggb25FcnJvciApIHsKCgkJCQlvbkVycm9yKCBlICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnNvbGUuZXJyb3IoIGUgKTsKCgkJCX0KCgkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCgkJfQoKCX0KCn0KCmNvbnN0IF9leWVSaWdodCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX2V5ZUxlZnQgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9wcm9qZWN0aW9uTWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKY2xhc3MgU3RlcmVvQ2FtZXJhIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJdGhpcy50eXBlID0gJ1N0ZXJlb0NhbWVyYSc7CgoJCXRoaXMuYXNwZWN0ID0gMTsKCgkJdGhpcy5leWVTZXAgPSAwLjA2NDsKCgkJdGhpcy5jYW1lcmFMID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJdGhpcy5jYW1lcmFMLmxheWVycy5lbmFibGUoIDEgKTsKCQl0aGlzLmNhbWVyYUwubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLmNhbWVyYVIgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoKTsKCQl0aGlzLmNhbWVyYVIubGF5ZXJzLmVuYWJsZSggMiApOwoJCXRoaXMuY2FtZXJhUi5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuX2NhY2hlID0gewoJCQlmb2N1czogbnVsbCwKCQkJZm92OiBudWxsLAoJCQlhc3BlY3Q6IG51bGwsCgkJCW5lYXI6IG51bGwsCgkJCWZhcjogbnVsbCwKCQkJem9vbTogbnVsbCwKCQkJZXllU2VwOiBudWxsCgkJfTsKCgl9CgoJdXBkYXRlKCBjYW1lcmEgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5fY2FjaGU7CgoJCWNvbnN0IG5lZWRzVXBkYXRlID0gY2FjaGUuZm9jdXMgIT09IGNhbWVyYS5mb2N1cyB8fCBjYWNoZS5mb3YgIT09IGNhbWVyYS5mb3YgfHwKCQkJY2FjaGUuYXNwZWN0ICE9PSBjYW1lcmEuYXNwZWN0ICogdGhpcy5hc3BlY3QgfHwgY2FjaGUubmVhciAhPT0gY2FtZXJhLm5lYXIgfHwKCQkJY2FjaGUuZmFyICE9PSBjYW1lcmEuZmFyIHx8IGNhY2hlLnpvb20gIT09IGNhbWVyYS56b29tIHx8IGNhY2hlLmV5ZVNlcCAhPT0gdGhpcy5leWVTZXA7CgoJCWlmICggbmVlZHNVcGRhdGUgKSB7CgoJCQljYWNoZS5mb2N1cyA9IGNhbWVyYS5mb2N1czsKCQkJY2FjaGUuZm92ID0gY2FtZXJhLmZvdjsKCQkJY2FjaGUuYXNwZWN0ID0gY2FtZXJhLmFzcGVjdCAqIHRoaXMuYXNwZWN0OwoJCQljYWNoZS5uZWFyID0gY2FtZXJhLm5lYXI7CgkJCWNhY2hlLmZhciA9IGNhbWVyYS5mYXI7CgkJCWNhY2hlLnpvb20gPSBjYW1lcmEuem9vbTsKCQkJY2FjaGUuZXllU2VwID0gdGhpcy5leWVTZXA7CgoJCQkvLyBPZmYtYXhpcyBzdGVyZW9zY29waWMgZWZmZWN0IGJhc2VkIG9uCgkJCS8vIGh0dHA6Ly9wYXVsYm91cmtlLm5ldC9zdGVyZW9ncmFwaGljcy9zdGVyZW9yZW5kZXIvCgoJCQlfcHJvamVjdGlvbk1hdHJpeC5jb3B5KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApOwoJCQljb25zdCBleWVTZXBIYWxmID0gY2FjaGUuZXllU2VwIC8gMjsKCQkJY29uc3QgZXllU2VwT25Qcm9qZWN0aW9uID0gZXllU2VwSGFsZiAqIGNhY2hlLm5lYXIgLyBjYWNoZS5mb2N1czsKCQkJY29uc3QgeW1heCA9ICggY2FjaGUubmVhciAqIE1hdGgudGFuKCBERUcyUkFEICogY2FjaGUuZm92ICogMC41ICkgKSAvIGNhY2hlLnpvb207CgkJCWxldCB4bWluLCB4bWF4OwoKCQkJLy8gdHJhbnNsYXRlIHhPZmZzZXQKCgkJCV9leWVMZWZ0LmVsZW1lbnRzWyAxMiBdID0gLSBleWVTZXBIYWxmOwoJCQlfZXllUmlnaHQuZWxlbWVudHNbIDEyIF0gPSBleWVTZXBIYWxmOwoKCQkJLy8gZm9yIGxlZnQgZXllCgoJCQl4bWluID0gLSB5bWF4ICogY2FjaGUuYXNwZWN0ICsgZXllU2VwT25Qcm9qZWN0aW9uOwoJCQl4bWF4ID0geW1heCAqIGNhY2hlLmFzcGVjdCArIGV5ZVNlcE9uUHJvamVjdGlvbjsKCgkJCV9wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyAwIF0gPSAyICogY2FjaGUubmVhciAvICggeG1heCAtIHhtaW4gKTsKCQkJX3Byb2plY3Rpb25NYXRyaXguZWxlbWVudHNbIDggXSA9ICggeG1heCArIHhtaW4gKSAvICggeG1heCAtIHhtaW4gKTsKCgkJCXRoaXMuY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIF9wcm9qZWN0aW9uTWF0cml4ICk7CgoJCQkvLyBmb3IgcmlnaHQgZXllCgoJCQl4bWluID0gLSB5bWF4ICogY2FjaGUuYXNwZWN0IC0gZXllU2VwT25Qcm9qZWN0aW9uOwoJCQl4bWF4ID0geW1heCAqIGNhY2hlLmFzcGVjdCAtIGV5ZVNlcE9uUHJvamVjdGlvbjsKCgkJCV9wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyAwIF0gPSAyICogY2FjaGUubmVhciAvICggeG1heCAtIHhtaW4gKTsKCQkJX3Byb2plY3Rpb25NYXRyaXguZWxlbWVudHNbIDggXSA9ICggeG1heCArIHhtaW4gKSAvICggeG1heCAtIHhtaW4gKTsKCgkJCXRoaXMuY2FtZXJhUi5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIF9wcm9qZWN0aW9uTWF0cml4ICk7CgoJCX0KCgkJdGhpcy5jYW1lcmFMLm1hdHJpeFdvcmxkLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLm11bHRpcGx5KCBfZXllTGVmdCApOwoJCXRoaXMuY2FtZXJhUi5tYXRyaXhXb3JsZC5jb3B5KCBjYW1lcmEubWF0cml4V29ybGQgKS5tdWx0aXBseSggX2V5ZVJpZ2h0ICk7CgoJfQoKfQoKY2xhc3MgQ2xvY2sgewoKCWNvbnN0cnVjdG9yKCBhdXRvU3RhcnQgPSB0cnVlICkgewoKCQl0aGlzLmF1dG9TdGFydCA9IGF1dG9TdGFydDsKCgkJdGhpcy5zdGFydFRpbWUgPSAwOwoJCXRoaXMub2xkVGltZSA9IDA7CgkJdGhpcy5lbGFwc2VkVGltZSA9IDA7CgoJCXRoaXMucnVubmluZyA9IGZhbHNlOwoKCX0KCglzdGFydCgpIHsKCgkJdGhpcy5zdGFydFRpbWUgPSBub3coKTsKCgkJdGhpcy5vbGRUaW1lID0gdGhpcy5zdGFydFRpbWU7CgkJdGhpcy5lbGFwc2VkVGltZSA9IDA7CgkJdGhpcy5ydW5uaW5nID0gdHJ1ZTsKCgl9CgoJc3RvcCgpIHsKCgkJdGhpcy5nZXRFbGFwc2VkVGltZSgpOwoJCXRoaXMucnVubmluZyA9IGZhbHNlOwoJCXRoaXMuYXV0b1N0YXJ0ID0gZmFsc2U7CgoJfQoKCWdldEVsYXBzZWRUaW1lKCkgewoKCQl0aGlzLmdldERlbHRhKCk7CgkJcmV0dXJuIHRoaXMuZWxhcHNlZFRpbWU7CgoJfQoKCWdldERlbHRhKCkgewoKCQlsZXQgZGlmZiA9IDA7CgoJCWlmICggdGhpcy5hdXRvU3RhcnQgJiYgISB0aGlzLnJ1bm5pbmcgKSB7CgoJCQl0aGlzLnN0YXJ0KCk7CgkJCXJldHVybiAwOwoKCQl9CgoJCWlmICggdGhpcy5ydW5uaW5nICkgewoKCQkJY29uc3QgbmV3VGltZSA9IG5vdygpOwoKCQkJZGlmZiA9ICggbmV3VGltZSAtIHRoaXMub2xkVGltZSApIC8gMTAwMDsKCQkJdGhpcy5vbGRUaW1lID0gbmV3VGltZTsKCgkJCXRoaXMuZWxhcHNlZFRpbWUgKz0gZGlmZjsKCgkJfQoKCQlyZXR1cm4gZGlmZjsKCgl9Cgp9CgpmdW5jdGlvbiBub3coKSB7CgoJcmV0dXJuICggdHlwZW9mIHBlcmZvcm1hbmNlID09PSAndW5kZWZpbmVkJyA/IERhdGUgOiBwZXJmb3JtYW5jZSApLm5vdygpOyAvLyBzZWUgIzEwNzMyCgp9Cgpjb25zdCBfcG9zaXRpb24kMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3F1YXRlcm5pb24kMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFF1YXRlcm5pb24oKTsKY29uc3QgX3NjYWxlJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9vcmllbnRhdGlvbiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY2xhc3MgQXVkaW9MaXN0ZW5lciBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ0F1ZGlvTGlzdGVuZXInOwoKCQl0aGlzLmNvbnRleHQgPSBBdWRpb0NvbnRleHQuZ2V0Q29udGV4dCgpOwoKCQl0aGlzLmdhaW4gPSB0aGlzLmNvbnRleHQuY3JlYXRlR2FpbigpOwoJCXRoaXMuZ2Fpbi5jb25uZWN0KCB0aGlzLmNvbnRleHQuZGVzdGluYXRpb24gKTsKCgkJdGhpcy5maWx0ZXIgPSBudWxsOwoKCQl0aGlzLnRpbWVEZWx0YSA9IDA7CgoJCS8vIHByaXZhdGUKCgkJdGhpcy5fY2xvY2sgPSBuZXcgQ2xvY2soKTsKCgl9CgoJZ2V0SW5wdXQoKSB7CgoJCXJldHVybiB0aGlzLmdhaW47CgoJfQoKCXJlbW92ZUZpbHRlcigpIHsKCgkJaWYgKCB0aGlzLmZpbHRlciAhPT0gbnVsbCApIHsKCgkJCXRoaXMuZ2Fpbi5kaXNjb25uZWN0KCB0aGlzLmZpbHRlciApOwoJCQl0aGlzLmZpbHRlci5kaXNjb25uZWN0KCB0aGlzLmNvbnRleHQuZGVzdGluYXRpb24gKTsKCQkJdGhpcy5nYWluLmNvbm5lY3QoIHRoaXMuY29udGV4dC5kZXN0aW5hdGlvbiApOwoJCQl0aGlzLmZpbHRlciA9IG51bGw7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldEZpbHRlcigpIHsKCgkJcmV0dXJuIHRoaXMuZmlsdGVyOwoKCX0KCglzZXRGaWx0ZXIoIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuZmlsdGVyICE9PSBudWxsICkgewoKCQkJdGhpcy5nYWluLmRpc2Nvbm5lY3QoIHRoaXMuZmlsdGVyICk7CgkJCXRoaXMuZmlsdGVyLmRpc2Nvbm5lY3QoIHRoaXMuY29udGV4dC5kZXN0aW5hdGlvbiApOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5nYWluLmRpc2Nvbm5lY3QoIHRoaXMuY29udGV4dC5kZXN0aW5hdGlvbiApOwoKCQl9CgoJCXRoaXMuZmlsdGVyID0gdmFsdWU7CgkJdGhpcy5nYWluLmNvbm5lY3QoIHRoaXMuZmlsdGVyICk7CgkJdGhpcy5maWx0ZXIuY29ubmVjdCggdGhpcy5jb250ZXh0LmRlc3RpbmF0aW9uICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRNYXN0ZXJWb2x1bWUoKSB7CgoJCXJldHVybiB0aGlzLmdhaW4uZ2Fpbi52YWx1ZTsKCgl9CgoJc2V0TWFzdGVyVm9sdW1lKCB2YWx1ZSApIHsKCgkJdGhpcy5nYWluLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKCB2YWx1ZSwgdGhpcy5jb250ZXh0LmN1cnJlbnRUaW1lLCAwLjAxICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCXN1cGVyLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCQljb25zdCBsaXN0ZW5lciA9IHRoaXMuY29udGV4dC5saXN0ZW5lcjsKCQljb25zdCB1cCA9IHRoaXMudXA7CgoJCXRoaXMudGltZURlbHRhID0gdGhpcy5fY2xvY2suZ2V0RGVsdGEoKTsKCgkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIF9wb3NpdGlvbiQxLCBfcXVhdGVybmlvbiQxLCBfc2NhbGUkMSApOwoKCQlfb3JpZW50YXRpb24kMS5zZXQoIDAsIDAsIC0gMSApLmFwcGx5UXVhdGVybmlvbiggX3F1YXRlcm5pb24kMSApOwoKCQlpZiAoIGxpc3RlbmVyLnBvc2l0aW9uWCApIHsKCgkJCS8vIGNvZGUgcGF0aCBmb3IgQ2hyb21lIChzZWUgIzE0MzkzKQoKCQkJY29uc3QgZW5kVGltZSA9IHRoaXMuY29udGV4dC5jdXJyZW50VGltZSArIHRoaXMudGltZURlbHRhOwoKCQkJbGlzdGVuZXIucG9zaXRpb25YLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBfcG9zaXRpb24kMS54LCBlbmRUaW1lICk7CgkJCWxpc3RlbmVyLnBvc2l0aW9uWS5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggX3Bvc2l0aW9uJDEueSwgZW5kVGltZSApOwoJCQlsaXN0ZW5lci5wb3NpdGlvbloubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9wb3NpdGlvbiQxLnosIGVuZFRpbWUgKTsKCQkJbGlzdGVuZXIuZm9yd2FyZFgubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9vcmllbnRhdGlvbiQxLngsIGVuZFRpbWUgKTsKCQkJbGlzdGVuZXIuZm9yd2FyZFkubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9vcmllbnRhdGlvbiQxLnksIGVuZFRpbWUgKTsKCQkJbGlzdGVuZXIuZm9yd2FyZFoubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9vcmllbnRhdGlvbiQxLnosIGVuZFRpbWUgKTsKCQkJbGlzdGVuZXIudXBYLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCB1cC54LCBlbmRUaW1lICk7CgkJCWxpc3RlbmVyLnVwWS5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggdXAueSwgZW5kVGltZSApOwoJCQlsaXN0ZW5lci51cFoubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIHVwLnosIGVuZFRpbWUgKTsKCgkJfSBlbHNlIHsKCgkJCWxpc3RlbmVyLnNldFBvc2l0aW9uKCBfcG9zaXRpb24kMS54LCBfcG9zaXRpb24kMS55LCBfcG9zaXRpb24kMS56ICk7CgkJCWxpc3RlbmVyLnNldE9yaWVudGF0aW9uKCBfb3JpZW50YXRpb24kMS54LCBfb3JpZW50YXRpb24kMS55LCBfb3JpZW50YXRpb24kMS56LCB1cC54LCB1cC55LCB1cC56ICk7CgoJCX0KCgl9Cgp9CgpjbGFzcyBBdWRpbyBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvciggbGlzdGVuZXIgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdBdWRpbyc7CgoJCXRoaXMubGlzdGVuZXIgPSBsaXN0ZW5lcjsKCQl0aGlzLmNvbnRleHQgPSBsaXN0ZW5lci5jb250ZXh0OwoKCQl0aGlzLmdhaW4gPSB0aGlzLmNvbnRleHQuY3JlYXRlR2FpbigpOwoJCXRoaXMuZ2Fpbi5jb25uZWN0KCBsaXN0ZW5lci5nZXRJbnB1dCgpICk7CgoJCXRoaXMuYXV0b3BsYXkgPSBmYWxzZTsKCgkJdGhpcy5idWZmZXIgPSBudWxsOwoJCXRoaXMuZGV0dW5lID0gMDsKCQl0aGlzLmxvb3AgPSBmYWxzZTsKCQl0aGlzLmxvb3BTdGFydCA9IDA7CgkJdGhpcy5sb29wRW5kID0gMDsKCQl0aGlzLm9mZnNldCA9IDA7CgkJdGhpcy5kdXJhdGlvbiA9IHVuZGVmaW5lZDsKCQl0aGlzLnBsYXliYWNrUmF0ZSA9IDE7CgkJdGhpcy5pc1BsYXlpbmcgPSBmYWxzZTsKCQl0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9IHRydWU7CgkJdGhpcy5zb3VyY2UgPSBudWxsOwoJCXRoaXMuc291cmNlVHlwZSA9ICdlbXB0eSc7CgoJCXRoaXMuX3N0YXJ0ZWRBdCA9IDA7CgkJdGhpcy5fcHJvZ3Jlc3MgPSAwOwoJCXRoaXMuX2Nvbm5lY3RlZCA9IGZhbHNlOwoKCQl0aGlzLmZpbHRlcnMgPSBbXTsKCgl9CgoJZ2V0T3V0cHV0KCkgewoKCQlyZXR1cm4gdGhpcy5nYWluOwoKCX0KCglzZXROb2RlU291cmNlKCBhdWRpb05vZGUgKSB7CgoJCXRoaXMuaGFzUGxheWJhY2tDb250cm9sID0gZmFsc2U7CgkJdGhpcy5zb3VyY2VUeXBlID0gJ2F1ZGlvTm9kZSc7CgkJdGhpcy5zb3VyY2UgPSBhdWRpb05vZGU7CgkJdGhpcy5jb25uZWN0KCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRNZWRpYUVsZW1lbnRTb3VyY2UoIG1lZGlhRWxlbWVudCApIHsKCgkJdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPSBmYWxzZTsKCQl0aGlzLnNvdXJjZVR5cGUgPSAnbWVkaWFOb2RlJzsKCQl0aGlzLnNvdXJjZSA9IHRoaXMuY29udGV4dC5jcmVhdGVNZWRpYUVsZW1lbnRTb3VyY2UoIG1lZGlhRWxlbWVudCApOwoJCXRoaXMuY29ubmVjdCgpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0TWVkaWFTdHJlYW1Tb3VyY2UoIG1lZGlhU3RyZWFtICkgewoKCQl0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9IGZhbHNlOwoJCXRoaXMuc291cmNlVHlwZSA9ICdtZWRpYVN0cmVhbU5vZGUnOwoJCXRoaXMuc291cmNlID0gdGhpcy5jb250ZXh0LmNyZWF0ZU1lZGlhU3RyZWFtU291cmNlKCBtZWRpYVN0cmVhbSApOwoJCXRoaXMuY29ubmVjdCgpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0QnVmZmVyKCBhdWRpb0J1ZmZlciApIHsKCgkJdGhpcy5idWZmZXIgPSBhdWRpb0J1ZmZlcjsKCQl0aGlzLnNvdXJjZVR5cGUgPSAnYnVmZmVyJzsKCgkJaWYgKCB0aGlzLmF1dG9wbGF5ICkgdGhpcy5wbGF5KCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglwbGF5KCBkZWxheSA9IDAgKSB7CgoJCWlmICggdGhpcy5pc1BsYXlpbmcgPT09IHRydWUgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5BdWRpbzogQXVkaW8gaXMgYWxyZWFkeSBwbGF5aW5nLicgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCWlmICggdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPT09IGZhbHNlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuJyApOwoJCQlyZXR1cm47CgoJCX0KCgkJdGhpcy5fc3RhcnRlZEF0ID0gdGhpcy5jb250ZXh0LmN1cnJlbnRUaW1lICsgZGVsYXk7CgoJCWNvbnN0IHNvdXJjZSA9IHRoaXMuY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTsKCQlzb3VyY2UuYnVmZmVyID0gdGhpcy5idWZmZXI7CgkJc291cmNlLmxvb3AgPSB0aGlzLmxvb3A7CgkJc291cmNlLmxvb3BTdGFydCA9IHRoaXMubG9vcFN0YXJ0OwoJCXNvdXJjZS5sb29wRW5kID0gdGhpcy5sb29wRW5kOwoJCXNvdXJjZS5vbmVuZGVkID0gdGhpcy5vbkVuZGVkLmJpbmQoIHRoaXMgKTsKCQlzb3VyY2Uuc3RhcnQoIHRoaXMuX3N0YXJ0ZWRBdCwgdGhpcy5fcHJvZ3Jlc3MgKyB0aGlzLm9mZnNldCwgdGhpcy5kdXJhdGlvbiApOwoKCQl0aGlzLmlzUGxheWluZyA9IHRydWU7CgoJCXRoaXMuc291cmNlID0gc291cmNlOwoKCQl0aGlzLnNldERldHVuZSggdGhpcy5kZXR1bmUgKTsKCQl0aGlzLnNldFBsYXliYWNrUmF0ZSggdGhpcy5wbGF5YmFja1JhdGUgKTsKCgkJcmV0dXJuIHRoaXMuY29ubmVjdCgpOwoKCX0KCglwYXVzZSgpIHsKCgkJaWYgKCB0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5BdWRpbzogdGhpcyBBdWRpbyBoYXMgbm8gcGxheWJhY2sgY29udHJvbC4nICk7CgkJCXJldHVybjsKCgkJfQoKCQlpZiAoIHRoaXMuaXNQbGF5aW5nID09PSB0cnVlICkgewoKCQkJLy8gdXBkYXRlIGN1cnJlbnQgcHJvZ3Jlc3MKCgkJCXRoaXMuX3Byb2dyZXNzICs9IE1hdGgubWF4KCB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUgLSB0aGlzLl9zdGFydGVkQXQsIDAgKSAqIHRoaXMucGxheWJhY2tSYXRlOwoKCQkJaWYgKCB0aGlzLmxvb3AgPT09IHRydWUgKSB7CgoJCQkJLy8gZW5zdXJlIF9wcm9ncmVzcyBkb2VzIG5vdCBleGNlZWQgZHVyYXRpb24gd2l0aCBsb29wZWQgYXVkaW9zCgoJCQkJdGhpcy5fcHJvZ3Jlc3MgPSB0aGlzLl9wcm9ncmVzcyAlICggdGhpcy5kdXJhdGlvbiB8fCB0aGlzLmJ1ZmZlci5kdXJhdGlvbiApOwoKCQkJfQoKCQkJdGhpcy5zb3VyY2Uuc3RvcCgpOwoJCQl0aGlzLnNvdXJjZS5vbmVuZGVkID0gbnVsbDsKCgkJCXRoaXMuaXNQbGF5aW5nID0gZmFsc2U7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN0b3AoKSB7CgoJCWlmICggdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPT09IGZhbHNlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuJyApOwoJCQlyZXR1cm47CgoJCX0KCgkJdGhpcy5fcHJvZ3Jlc3MgPSAwOwoKCQlpZiAoIHRoaXMuc291cmNlICE9PSBudWxsICkgewoKCQkJdGhpcy5zb3VyY2Uuc3RvcCgpOwoJCQl0aGlzLnNvdXJjZS5vbmVuZGVkID0gbnVsbDsKCgkJfQoKCQl0aGlzLmlzUGxheWluZyA9IGZhbHNlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29ubmVjdCgpIHsKCgkJaWYgKCB0aGlzLmZpbHRlcnMubGVuZ3RoID4gMCApIHsKCgkJCXRoaXMuc291cmNlLmNvbm5lY3QoIHRoaXMuZmlsdGVyc1sgMCBdICk7CgoJCQlmb3IgKCBsZXQgaSA9IDEsIGwgPSB0aGlzLmZpbHRlcnMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQl0aGlzLmZpbHRlcnNbIGkgLSAxIF0uY29ubmVjdCggdGhpcy5maWx0ZXJzWyBpIF0gKTsKCgkJCX0KCgkJCXRoaXMuZmlsdGVyc1sgdGhpcy5maWx0ZXJzLmxlbmd0aCAtIDEgXS5jb25uZWN0KCB0aGlzLmdldE91dHB1dCgpICk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLnNvdXJjZS5jb25uZWN0KCB0aGlzLmdldE91dHB1dCgpICk7CgoJCX0KCgkJdGhpcy5fY29ubmVjdGVkID0gdHJ1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpc2Nvbm5lY3QoKSB7CgoJCWlmICggdGhpcy5fY29ubmVjdGVkID09PSBmYWxzZSApIHsKCgkJCXJldHVybjsKCgkJfQoKCQlpZiAoIHRoaXMuZmlsdGVycy5sZW5ndGggPiAwICkgewoKCQkJdGhpcy5zb3VyY2UuZGlzY29ubmVjdCggdGhpcy5maWx0ZXJzWyAwIF0gKTsKCgkJCWZvciAoIGxldCBpID0gMSwgbCA9IHRoaXMuZmlsdGVycy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXRoaXMuZmlsdGVyc1sgaSAtIDEgXS5kaXNjb25uZWN0KCB0aGlzLmZpbHRlcnNbIGkgXSApOwoKCQkJfQoKCQkJdGhpcy5maWx0ZXJzWyB0aGlzLmZpbHRlcnMubGVuZ3RoIC0gMSBdLmRpc2Nvbm5lY3QoIHRoaXMuZ2V0T3V0cHV0KCkgKTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMuc291cmNlLmRpc2Nvbm5lY3QoIHRoaXMuZ2V0T3V0cHV0KCkgKTsKCgkJfQoKCQl0aGlzLl9jb25uZWN0ZWQgPSBmYWxzZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldEZpbHRlcnMoKSB7CgoJCXJldHVybiB0aGlzLmZpbHRlcnM7CgoJfQoKCXNldEZpbHRlcnMoIHZhbHVlICkgewoKCQlpZiAoICEgdmFsdWUgKSB2YWx1ZSA9IFtdOwoKCQlpZiAoIHRoaXMuX2Nvbm5lY3RlZCA9PT0gdHJ1ZSApIHsKCgkJCXRoaXMuZGlzY29ubmVjdCgpOwoJCQl0aGlzLmZpbHRlcnMgPSB2YWx1ZS5zbGljZSgpOwoJCQl0aGlzLmNvbm5lY3QoKTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMuZmlsdGVycyA9IHZhbHVlLnNsaWNlKCk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldERldHVuZSggdmFsdWUgKSB7CgoJCXRoaXMuZGV0dW5lID0gdmFsdWU7CgoJCWlmICggdGhpcy5zb3VyY2UuZGV0dW5lID09PSB1bmRlZmluZWQgKSByZXR1cm47IC8vIG9ubHkgc2V0IGRldHVuZSB3aGVuIGF2YWlsYWJsZQoKCQlpZiAoIHRoaXMuaXNQbGF5aW5nID09PSB0cnVlICkgewoKCQkJdGhpcy5zb3VyY2UuZGV0dW5lLnNldFRhcmdldEF0VGltZSggdGhpcy5kZXR1bmUsIHRoaXMuY29udGV4dC5jdXJyZW50VGltZSwgMC4wMSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXREZXR1bmUoKSB7CgoJCXJldHVybiB0aGlzLmRldHVuZTsKCgl9CgoJZ2V0RmlsdGVyKCkgewoKCQlyZXR1cm4gdGhpcy5nZXRGaWx0ZXJzKClbIDAgXTsKCgl9CgoJc2V0RmlsdGVyKCBmaWx0ZXIgKSB7CgoJCXJldHVybiB0aGlzLnNldEZpbHRlcnMoIGZpbHRlciA/IFsgZmlsdGVyIF0gOiBbXSApOwoKCX0KCglzZXRQbGF5YmFja1JhdGUoIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuaGFzUGxheWJhY2tDb250cm9sID09PSBmYWxzZSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkF1ZGlvOiB0aGlzIEF1ZGlvIGhhcyBubyBwbGF5YmFjayBjb250cm9sLicgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCXRoaXMucGxheWJhY2tSYXRlID0gdmFsdWU7CgoJCWlmICggdGhpcy5pc1BsYXlpbmcgPT09IHRydWUgKSB7CgoJCQl0aGlzLnNvdXJjZS5wbGF5YmFja1JhdGUuc2V0VGFyZ2V0QXRUaW1lKCB0aGlzLnBsYXliYWNrUmF0ZSwgdGhpcy5jb250ZXh0LmN1cnJlbnRUaW1lLCAwLjAxICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldFBsYXliYWNrUmF0ZSgpIHsKCgkJcmV0dXJuIHRoaXMucGxheWJhY2tSYXRlOwoKCX0KCglvbkVuZGVkKCkgewoKCQl0aGlzLmlzUGxheWluZyA9IGZhbHNlOwoKCX0KCglnZXRMb29wKCkgewoKCQlpZiAoIHRoaXMuaGFzUGxheWJhY2tDb250cm9sID09PSBmYWxzZSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkF1ZGlvOiB0aGlzIEF1ZGlvIGhhcyBubyBwbGF5YmFjayBjb250cm9sLicgKTsKCQkJcmV0dXJuIGZhbHNlOwoKCQl9CgoJCXJldHVybiB0aGlzLmxvb3A7CgoJfQoKCXNldExvb3AoIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuaGFzUGxheWJhY2tDb250cm9sID09PSBmYWxzZSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkF1ZGlvOiB0aGlzIEF1ZGlvIGhhcyBubyBwbGF5YmFjayBjb250cm9sLicgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCXRoaXMubG9vcCA9IHZhbHVlOwoKCQlpZiAoIHRoaXMuaXNQbGF5aW5nID09PSB0cnVlICkgewoKCQkJdGhpcy5zb3VyY2UubG9vcCA9IHRoaXMubG9vcDsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0TG9vcFN0YXJ0KCB2YWx1ZSApIHsKCgkJdGhpcy5sb29wU3RhcnQgPSB2YWx1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldExvb3BFbmQoIHZhbHVlICkgewoKCQl0aGlzLmxvb3BFbmQgPSB2YWx1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldFZvbHVtZSgpIHsKCgkJcmV0dXJuIHRoaXMuZ2Fpbi5nYWluLnZhbHVlOwoKCX0KCglzZXRWb2x1bWUoIHZhbHVlICkgewoKCQl0aGlzLmdhaW4uZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoIHZhbHVlLCB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUsIDAuMDEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY29uc3QgX3Bvc2l0aW9uID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfcXVhdGVybmlvbiA9IC8qQF9fUFVSRV9fKi8gbmV3IFF1YXRlcm5pb24oKTsKY29uc3QgX3NjYWxlID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfb3JpZW50YXRpb24gPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBQb3NpdGlvbmFsQXVkaW8gZXh0ZW5kcyBBdWRpbyB7CgoJY29uc3RydWN0b3IoIGxpc3RlbmVyICkgewoKCQlzdXBlciggbGlzdGVuZXIgKTsKCgkJdGhpcy5wYW5uZXIgPSB0aGlzLmNvbnRleHQuY3JlYXRlUGFubmVyKCk7CgkJdGhpcy5wYW5uZXIucGFubmluZ01vZGVsID0gJ0hSVEYnOwoJCXRoaXMucGFubmVyLmNvbm5lY3QoIHRoaXMuZ2FpbiApOwoKCX0KCgljb25uZWN0KCkgewoKCQlzdXBlci5jb25uZWN0KCk7CgoJCXRoaXMucGFubmVyLmNvbm5lY3QoIHRoaXMuZ2FpbiApOwoKCX0KCglkaXNjb25uZWN0KCkgewoKCQlzdXBlci5kaXNjb25uZWN0KCk7CgoJCXRoaXMucGFubmVyLmRpc2Nvbm5lY3QoIHRoaXMuZ2FpbiApOwoKCX0KCglnZXRPdXRwdXQoKSB7CgoJCXJldHVybiB0aGlzLnBhbm5lcjsKCgl9CgoJZ2V0UmVmRGlzdGFuY2UoKSB7CgoJCXJldHVybiB0aGlzLnBhbm5lci5yZWZEaXN0YW5jZTsKCgl9CgoJc2V0UmVmRGlzdGFuY2UoIHZhbHVlICkgewoKCQl0aGlzLnBhbm5lci5yZWZEaXN0YW5jZSA9IHZhbHVlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0Um9sbG9mZkZhY3RvcigpIHsKCgkJcmV0dXJuIHRoaXMucGFubmVyLnJvbGxvZmZGYWN0b3I7CgoJfQoKCXNldFJvbGxvZmZGYWN0b3IoIHZhbHVlICkgewoKCQl0aGlzLnBhbm5lci5yb2xsb2ZmRmFjdG9yID0gdmFsdWU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXREaXN0YW5jZU1vZGVsKCkgewoKCQlyZXR1cm4gdGhpcy5wYW5uZXIuZGlzdGFuY2VNb2RlbDsKCgl9CgoJc2V0RGlzdGFuY2VNb2RlbCggdmFsdWUgKSB7CgoJCXRoaXMucGFubmVyLmRpc3RhbmNlTW9kZWwgPSB2YWx1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldE1heERpc3RhbmNlKCkgewoKCQlyZXR1cm4gdGhpcy5wYW5uZXIubWF4RGlzdGFuY2U7CgoJfQoKCXNldE1heERpc3RhbmNlKCB2YWx1ZSApIHsKCgkJdGhpcy5wYW5uZXIubWF4RGlzdGFuY2UgPSB2YWx1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldERpcmVjdGlvbmFsQ29uZSggY29uZUlubmVyQW5nbGUsIGNvbmVPdXRlckFuZ2xlLCBjb25lT3V0ZXJHYWluICkgewoKCQl0aGlzLnBhbm5lci5jb25lSW5uZXJBbmdsZSA9IGNvbmVJbm5lckFuZ2xlOwoJCXRoaXMucGFubmVyLmNvbmVPdXRlckFuZ2xlID0gY29uZU91dGVyQW5nbGU7CgkJdGhpcy5wYW5uZXIuY29uZU91dGVyR2FpbiA9IGNvbmVPdXRlckdhaW47CgoJCXJldHVybiB0aGlzOwoKCX0KCgl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCXN1cGVyLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCQlpZiAoIHRoaXMuaGFzUGxheWJhY2tDb250cm9sID09PSB0cnVlICYmIHRoaXMuaXNQbGF5aW5nID09PSBmYWxzZSApIHJldHVybjsKCgkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIF9wb3NpdGlvbiwgX3F1YXRlcm5pb24sIF9zY2FsZSApOwoKCQlfb3JpZW50YXRpb24uc2V0KCAwLCAwLCAxICkuYXBwbHlRdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiApOwoKCQljb25zdCBwYW5uZXIgPSB0aGlzLnBhbm5lcjsKCgkJaWYgKCBwYW5uZXIucG9zaXRpb25YICkgewoKCQkJLy8gY29kZSBwYXRoIGZvciBDaHJvbWUgYW5kIEZpcmVmb3ggKHNlZSAjMTQzOTMpCgoJCQljb25zdCBlbmRUaW1lID0gdGhpcy5jb250ZXh0LmN1cnJlbnRUaW1lICsgdGhpcy5saXN0ZW5lci50aW1lRGVsdGE7CgoJCQlwYW5uZXIucG9zaXRpb25YLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBfcG9zaXRpb24ueCwgZW5kVGltZSApOwoJCQlwYW5uZXIucG9zaXRpb25ZLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBfcG9zaXRpb24ueSwgZW5kVGltZSApOwoJCQlwYW5uZXIucG9zaXRpb25aLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBfcG9zaXRpb24ueiwgZW5kVGltZSApOwoJCQlwYW5uZXIub3JpZW50YXRpb25YLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBfb3JpZW50YXRpb24ueCwgZW5kVGltZSApOwoJCQlwYW5uZXIub3JpZW50YXRpb25ZLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBfb3JpZW50YXRpb24ueSwgZW5kVGltZSApOwoJCQlwYW5uZXIub3JpZW50YXRpb25aLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBfb3JpZW50YXRpb24ueiwgZW5kVGltZSApOwoKCQl9IGVsc2UgewoKCQkJcGFubmVyLnNldFBvc2l0aW9uKCBfcG9zaXRpb24ueCwgX3Bvc2l0aW9uLnksIF9wb3NpdGlvbi56ICk7CgkJCXBhbm5lci5zZXRPcmllbnRhdGlvbiggX29yaWVudGF0aW9uLngsIF9vcmllbnRhdGlvbi55LCBfb3JpZW50YXRpb24ueiApOwoKCQl9CgoJfQoKfQoKY2xhc3MgQXVkaW9BbmFseXNlciB7CgoJY29uc3RydWN0b3IoIGF1ZGlvLCBmZnRTaXplID0gMjA0OCApIHsKCgkJdGhpcy5hbmFseXNlciA9IGF1ZGlvLmNvbnRleHQuY3JlYXRlQW5hbHlzZXIoKTsKCQl0aGlzLmFuYWx5c2VyLmZmdFNpemUgPSBmZnRTaXplOwoKCQl0aGlzLmRhdGEgPSBuZXcgVWludDhBcnJheSggdGhpcy5hbmFseXNlci5mcmVxdWVuY3lCaW5Db3VudCApOwoKCQlhdWRpby5nZXRPdXRwdXQoKS5jb25uZWN0KCB0aGlzLmFuYWx5c2VyICk7CgoJfQoKCglnZXRGcmVxdWVuY3lEYXRhKCkgewoKCQl0aGlzLmFuYWx5c2VyLmdldEJ5dGVGcmVxdWVuY3lEYXRhKCB0aGlzLmRhdGEgKTsKCgkJcmV0dXJuIHRoaXMuZGF0YTsKCgl9CgoJZ2V0QXZlcmFnZUZyZXF1ZW5jeSgpIHsKCgkJbGV0IHZhbHVlID0gMDsKCQljb25zdCBkYXRhID0gdGhpcy5nZXRGcmVxdWVuY3lEYXRhKCk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICsrICkgewoKCQkJdmFsdWUgKz0gZGF0YVsgaSBdOwoKCQl9CgoJCXJldHVybiB2YWx1ZSAvIGRhdGEubGVuZ3RoOwoKCX0KCn0KCmNsYXNzIFByb3BlcnR5TWl4ZXIgewoKCWNvbnN0cnVjdG9yKCBiaW5kaW5nLCB0eXBlTmFtZSwgdmFsdWVTaXplICkgewoKCQl0aGlzLmJpbmRpbmcgPSBiaW5kaW5nOwoJCXRoaXMudmFsdWVTaXplID0gdmFsdWVTaXplOwoKCQlsZXQgbWl4RnVuY3Rpb24sCgkJCW1peEZ1bmN0aW9uQWRkaXRpdmUsCgkJCXNldElkZW50aXR5OwoKCQkvLyBidWZmZXIgbGF5b3V0OiBbIGluY29taW5nIHwgYWNjdTAgfCBhY2N1MSB8IG9yaWcgfCBhZGRBY2N1IHwgKG9wdGlvbmFsIHdvcmspIF0KCQkvLwoJCS8vIGludGVycG9sYXRvcnMgY2FuIHVzZSAuYnVmZmVyIGFzIHRoZWlyIC5yZXN1bHQKCQkvLyB0aGUgZGF0YSB0aGVuIGdvZXMgdG8gJ2luY29taW5nJwoJCS8vCgkJLy8gJ2FjY3UwJyBhbmQgJ2FjY3UxJyBhcmUgdXNlZCBmcmFtZS1pbnRlcmxlYXZlZCBmb3IKCQkvLyB0aGUgY3VtdWxhdGl2ZSByZXN1bHQgYW5kIGFyZSBjb21wYXJlZCB0byBkZXRlY3QKCQkvLyBjaGFuZ2VzCgkJLy8KCQkvLyAnb3JpZycgc3RvcmVzIHRoZSBvcmlnaW5hbCBzdGF0ZSBvZiB0aGUgcHJvcGVydHkKCQkvLwoJCS8vICdhZGQnIGlzIHVzZWQgZm9yIGFkZGl0aXZlIGN1bXVsYXRpdmUgcmVzdWx0cwoJCS8vCgkJLy8gJ3dvcmsnIGlzIG9wdGlvbmFsIGFuZCBpcyBvbmx5IHByZXNlbnQgZm9yIHF1YXRlcm5pb24gdHlwZXMuIEl0IGlzIHVzZWQKCQkvLyB0byBzdG9yZSBpbnRlcm1lZGlhdGUgcXVhdGVybmlvbiBtdWx0aXBsaWNhdGlvbiByZXN1bHRzCgoJCXN3aXRjaCAoIHR5cGVOYW1lICkgewoKCQkJY2FzZSAncXVhdGVybmlvbic6CgkJCQltaXhGdW5jdGlvbiA9IHRoaXMuX3NsZXJwOwoJCQkJbWl4RnVuY3Rpb25BZGRpdGl2ZSA9IHRoaXMuX3NsZXJwQWRkaXRpdmU7CgkJCQlzZXRJZGVudGl0eSA9IHRoaXMuX3NldEFkZGl0aXZlSWRlbnRpdHlRdWF0ZXJuaW9uOwoKCQkJCXRoaXMuYnVmZmVyID0gbmV3IEZsb2F0NjRBcnJheSggdmFsdWVTaXplICogNiApOwoJCQkJdGhpcy5fd29ya0luZGV4ID0gNTsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnc3RyaW5nJzoKCQkJY2FzZSAnYm9vbCc6CgkJCQltaXhGdW5jdGlvbiA9IHRoaXMuX3NlbGVjdDsKCgkJCQkvLyBVc2UgdGhlIHJlZ3VsYXIgbWl4IGZ1bmN0aW9uIGFuZCBmb3IgYWRkaXRpdmUgb24gdGhlc2UgdHlwZXMsCgkJCQkvLyBhZGRpdGl2ZSBpcyBub3QgcmVsZXZhbnQgZm9yIG5vbi1udW1lcmljIHR5cGVzCgkJCQltaXhGdW5jdGlvbkFkZGl0aXZlID0gdGhpcy5fc2VsZWN0OwoKCQkJCXNldElkZW50aXR5ID0gdGhpcy5fc2V0QWRkaXRpdmVJZGVudGl0eU90aGVyOwoKCQkJCXRoaXMuYnVmZmVyID0gbmV3IEFycmF5KCB2YWx1ZVNpemUgKiA1ICk7CgkJCQlicmVhazsKCgkJCWRlZmF1bHQ6CgkJCQltaXhGdW5jdGlvbiA9IHRoaXMuX2xlcnA7CgkJCQltaXhGdW5jdGlvbkFkZGl0aXZlID0gdGhpcy5fbGVycEFkZGl0aXZlOwoJCQkJc2V0SWRlbnRpdHkgPSB0aGlzLl9zZXRBZGRpdGl2ZUlkZW50aXR5TnVtZXJpYzsKCgkJCQl0aGlzLmJ1ZmZlciA9IG5ldyBGbG9hdDY0QXJyYXkoIHZhbHVlU2l6ZSAqIDUgKTsKCgkJfQoKCQl0aGlzLl9taXhCdWZmZXJSZWdpb24gPSBtaXhGdW5jdGlvbjsKCQl0aGlzLl9taXhCdWZmZXJSZWdpb25BZGRpdGl2ZSA9IG1peEZ1bmN0aW9uQWRkaXRpdmU7CgkJdGhpcy5fc2V0SWRlbnRpdHkgPSBzZXRJZGVudGl0eTsKCQl0aGlzLl9vcmlnSW5kZXggPSAzOwoJCXRoaXMuX2FkZEluZGV4ID0gNDsKCgkJdGhpcy5jdW11bGF0aXZlV2VpZ2h0ID0gMDsKCQl0aGlzLmN1bXVsYXRpdmVXZWlnaHRBZGRpdGl2ZSA9IDA7CgoJCXRoaXMudXNlQ291bnQgPSAwOwoJCXRoaXMucmVmZXJlbmNlQ291bnQgPSAwOwoKCX0KCgkvLyBhY2N1bXVsYXRlIGRhdGEgaW4gdGhlICdpbmNvbWluZycgcmVnaW9uIGludG8gJ2FjY3U8aT4nCglhY2N1bXVsYXRlKCBhY2N1SW5kZXgsIHdlaWdodCApIHsKCgkJLy8gbm90ZTogaGFwcGlseSBhY2N1bXVsYXRpbmcgbm90aGluZyB3aGVuIHdlaWdodCA9IDAsIHRoZSBjYWxsZXIga25vd3MKCQkvLyB0aGUgd2VpZ2h0IGFuZCBzaG91bGRuJ3QgaGF2ZSBtYWRlIHRoZSBjYWxsIGluIHRoZSBmaXJzdCBwbGFjZQoKCQljb25zdCBidWZmZXIgPSB0aGlzLmJ1ZmZlciwKCQkJc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsCgkJCW9mZnNldCA9IGFjY3VJbmRleCAqIHN0cmlkZSArIHN0cmlkZTsKCgkJbGV0IGN1cnJlbnRXZWlnaHQgPSB0aGlzLmN1bXVsYXRpdmVXZWlnaHQ7CgoJCWlmICggY3VycmVudFdlaWdodCA9PT0gMCApIHsKCgkJCS8vIGFjY3VOIDo9IGluY29taW5nICogd2VpZ2h0CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IHN0cmlkZTsgKysgaSApIHsKCgkJCQlidWZmZXJbIG9mZnNldCArIGkgXSA9IGJ1ZmZlclsgaSBdOwoKCQkJfQoKCQkJY3VycmVudFdlaWdodCA9IHdlaWdodDsKCgkJfSBlbHNlIHsKCgkJCS8vIGFjY3VOIDo9IGFjY3VOICsgaW5jb21pbmcgKiB3ZWlnaHQKCgkJCWN1cnJlbnRXZWlnaHQgKz0gd2VpZ2h0OwoJCQljb25zdCBtaXggPSB3ZWlnaHQgLyBjdXJyZW50V2VpZ2h0OwoJCQl0aGlzLl9taXhCdWZmZXJSZWdpb24oIGJ1ZmZlciwgb2Zmc2V0LCAwLCBtaXgsIHN0cmlkZSApOwoKCQl9CgoJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodCA9IGN1cnJlbnRXZWlnaHQ7CgoJfQoKCS8vIGFjY3VtdWxhdGUgZGF0YSBpbiB0aGUgJ2luY29taW5nJyByZWdpb24gaW50byAnYWRkJwoJYWNjdW11bGF0ZUFkZGl0aXZlKCB3ZWlnaHQgKSB7CgoJCWNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyLAoJCQlzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwKCQkJb2Zmc2V0ID0gc3RyaWRlICogdGhpcy5fYWRkSW5kZXg7CgoJCWlmICggdGhpcy5jdW11bGF0aXZlV2VpZ2h0QWRkaXRpdmUgPT09IDAgKSB7CgoJCQkvLyBhZGQgPSBpZGVudGl0eQoKCQkJdGhpcy5fc2V0SWRlbnRpdHkoKTsKCgkJfQoKCQkvLyBhZGQgOj0gYWRkICsgaW5jb21pbmcgKiB3ZWlnaHQKCgkJdGhpcy5fbWl4QnVmZmVyUmVnaW9uQWRkaXRpdmUoIGJ1ZmZlciwgb2Zmc2V0LCAwLCB3ZWlnaHQsIHN0cmlkZSApOwoJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodEFkZGl0aXZlICs9IHdlaWdodDsKCgl9CgoJLy8gYXBwbHkgdGhlIHN0YXRlIG9mICdhY2N1PGk+JyB0byB0aGUgYmluZGluZyB3aGVuIGFjY3VzIGRpZmZlcgoJYXBwbHkoIGFjY3VJbmRleCApIHsKCgkJY29uc3Qgc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsCgkJCWJ1ZmZlciA9IHRoaXMuYnVmZmVyLAoJCQlvZmZzZXQgPSBhY2N1SW5kZXggKiBzdHJpZGUgKyBzdHJpZGUsCgoJCQl3ZWlnaHQgPSB0aGlzLmN1bXVsYXRpdmVXZWlnaHQsCgkJCXdlaWdodEFkZGl0aXZlID0gdGhpcy5jdW11bGF0aXZlV2VpZ2h0QWRkaXRpdmUsCgoJCQliaW5kaW5nID0gdGhpcy5iaW5kaW5nOwoKCQl0aGlzLmN1bXVsYXRpdmVXZWlnaHQgPSAwOwoJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodEFkZGl0aXZlID0gMDsKCgkJaWYgKCB3ZWlnaHQgPCAxICkgewoKCQkJLy8gYWNjdU4gOj0gYWNjdU4gKyBvcmlnaW5hbCAqICggMSAtIGN1bXVsYXRpdmVXZWlnaHQgKQoKCQkJY29uc3Qgb3JpZ2luYWxWYWx1ZU9mZnNldCA9IHN0cmlkZSAqIHRoaXMuX29yaWdJbmRleDsKCgkJCXRoaXMuX21peEJ1ZmZlclJlZ2lvbigKCQkJCWJ1ZmZlciwgb2Zmc2V0LCBvcmlnaW5hbFZhbHVlT2Zmc2V0LCAxIC0gd2VpZ2h0LCBzdHJpZGUgKTsKCgkJfQoKCQlpZiAoIHdlaWdodEFkZGl0aXZlID4gMCApIHsKCgkJCS8vIGFjY3VOIDo9IGFjY3VOICsgYWRkaXRpdmUgYWNjdU4KCgkJCXRoaXMuX21peEJ1ZmZlclJlZ2lvbkFkZGl0aXZlKCBidWZmZXIsIG9mZnNldCwgdGhpcy5fYWRkSW5kZXggKiBzdHJpZGUsIDEsIHN0cmlkZSApOwoKCQl9CgoJCWZvciAoIGxldCBpID0gc3RyaWRlLCBlID0gc3RyaWRlICsgc3RyaWRlOyBpICE9PSBlOyArKyBpICkgewoKCQkJaWYgKCBidWZmZXJbIGkgXSAhPT0gYnVmZmVyWyBpICsgc3RyaWRlIF0gKSB7CgoJCQkJLy8gdmFsdWUgaGFzIGNoYW5nZWQgLT4gdXBkYXRlIHNjZW5lIGdyYXBoCgoJCQkJYmluZGluZy5zZXRWYWx1ZSggYnVmZmVyLCBvZmZzZXQgKTsKCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJfQoKCS8vIHJlbWVtYmVyIHRoZSBzdGF0ZSBvZiB0aGUgYm91bmQgcHJvcGVydHkgYW5kIGNvcHkgaXQgdG8gYm90aCBhY2N1cwoJc2F2ZU9yaWdpbmFsU3RhdGUoKSB7CgoJCWNvbnN0IGJpbmRpbmcgPSB0aGlzLmJpbmRpbmc7CgoJCWNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyLAoJCQlzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwKCgkJCW9yaWdpbmFsVmFsdWVPZmZzZXQgPSBzdHJpZGUgKiB0aGlzLl9vcmlnSW5kZXg7CgoJCWJpbmRpbmcuZ2V0VmFsdWUoIGJ1ZmZlciwgb3JpZ2luYWxWYWx1ZU9mZnNldCApOwoKCQkvLyBhY2N1WzAuLjFdIDo9IG9yaWcgLS0gaW5pdGlhbGx5IGRldGVjdCBjaGFuZ2VzIGFnYWluc3QgdGhlIG9yaWdpbmFsCgkJZm9yICggbGV0IGkgPSBzdHJpZGUsIGUgPSBvcmlnaW5hbFZhbHVlT2Zmc2V0OyBpICE9PSBlOyArKyBpICkgewoKCQkJYnVmZmVyWyBpIF0gPSBidWZmZXJbIG9yaWdpbmFsVmFsdWVPZmZzZXQgKyAoIGkgJSBzdHJpZGUgKSBdOwoKCQl9CgoJCS8vIEFkZCB0byBpZGVudGl0eSBmb3IgYWRkaXRpdmUKCQl0aGlzLl9zZXRJZGVudGl0eSgpOwoKCQl0aGlzLmN1bXVsYXRpdmVXZWlnaHQgPSAwOwoJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodEFkZGl0aXZlID0gMDsKCgl9CgoJLy8gYXBwbHkgdGhlIHN0YXRlIHByZXZpb3VzbHkgdGFrZW4gdmlhICdzYXZlT3JpZ2luYWxTdGF0ZScgdG8gdGhlIGJpbmRpbmcKCXJlc3RvcmVPcmlnaW5hbFN0YXRlKCkgewoKCQljb25zdCBvcmlnaW5hbFZhbHVlT2Zmc2V0ID0gdGhpcy52YWx1ZVNpemUgKiAzOwoJCXRoaXMuYmluZGluZy5zZXRWYWx1ZSggdGhpcy5idWZmZXIsIG9yaWdpbmFsVmFsdWVPZmZzZXQgKTsKCgl9CgoJX3NldEFkZGl0aXZlSWRlbnRpdHlOdW1lcmljKCkgewoKCQljb25zdCBzdGFydEluZGV4ID0gdGhpcy5fYWRkSW5kZXggKiB0aGlzLnZhbHVlU2l6ZTsKCQljb25zdCBlbmRJbmRleCA9IHN0YXJ0SW5kZXggKyB0aGlzLnZhbHVlU2l6ZTsKCgkJZm9yICggbGV0IGkgPSBzdGFydEluZGV4OyBpIDwgZW5kSW5kZXg7IGkgKysgKSB7CgoJCQl0aGlzLmJ1ZmZlclsgaSBdID0gMDsKCgkJfQoKCX0KCglfc2V0QWRkaXRpdmVJZGVudGl0eVF1YXRlcm5pb24oKSB7CgoJCXRoaXMuX3NldEFkZGl0aXZlSWRlbnRpdHlOdW1lcmljKCk7CgkJdGhpcy5idWZmZXJbIHRoaXMuX2FkZEluZGV4ICogdGhpcy52YWx1ZVNpemUgKyAzIF0gPSAxOwoKCX0KCglfc2V0QWRkaXRpdmVJZGVudGl0eU90aGVyKCkgewoKCQljb25zdCBzdGFydEluZGV4ID0gdGhpcy5fb3JpZ0luZGV4ICogdGhpcy52YWx1ZVNpemU7CgkJY29uc3QgdGFyZ2V0SW5kZXggPSB0aGlzLl9hZGRJbmRleCAqIHRoaXMudmFsdWVTaXplOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLnZhbHVlU2l6ZTsgaSArKyApIHsKCgkJCXRoaXMuYnVmZmVyWyB0YXJnZXRJbmRleCArIGkgXSA9IHRoaXMuYnVmZmVyWyBzdGFydEluZGV4ICsgaSBdOwoKCQl9CgoJfQoKCgkvLyBtaXggZnVuY3Rpb25zCgoJX3NlbGVjdCggYnVmZmVyLCBkc3RPZmZzZXQsIHNyY09mZnNldCwgdCwgc3RyaWRlICkgewoKCQlpZiAoIHQgPj0gMC41ICkgewoKCQkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBzdHJpZGU7ICsrIGkgKSB7CgoJCQkJYnVmZmVyWyBkc3RPZmZzZXQgKyBpIF0gPSBidWZmZXJbIHNyY09mZnNldCArIGkgXTsKCgkJCX0KCgkJfQoKCX0KCglfc2xlcnAoIGJ1ZmZlciwgZHN0T2Zmc2V0LCBzcmNPZmZzZXQsIHQgKSB7CgoJCVF1YXRlcm5pb24uc2xlcnBGbGF0KCBidWZmZXIsIGRzdE9mZnNldCwgYnVmZmVyLCBkc3RPZmZzZXQsIGJ1ZmZlciwgc3JjT2Zmc2V0LCB0ICk7CgoJfQoKCV9zbGVycEFkZGl0aXZlKCBidWZmZXIsIGRzdE9mZnNldCwgc3JjT2Zmc2V0LCB0LCBzdHJpZGUgKSB7CgoJCWNvbnN0IHdvcmtPZmZzZXQgPSB0aGlzLl93b3JrSW5kZXggKiBzdHJpZGU7CgoJCS8vIFN0b3JlIHJlc3VsdCBpbiBpbnRlcm1lZGlhdGUgYnVmZmVyIG9mZnNldAoJCVF1YXRlcm5pb24ubXVsdGlwbHlRdWF0ZXJuaW9uc0ZsYXQoIGJ1ZmZlciwgd29ya09mZnNldCwgYnVmZmVyLCBkc3RPZmZzZXQsIGJ1ZmZlciwgc3JjT2Zmc2V0ICk7CgoJCS8vIFNsZXJwIHRvIHRoZSBpbnRlcm1lZGlhdGUgcmVzdWx0CgkJUXVhdGVybmlvbi5zbGVycEZsYXQoIGJ1ZmZlciwgZHN0T2Zmc2V0LCBidWZmZXIsIGRzdE9mZnNldCwgYnVmZmVyLCB3b3JrT2Zmc2V0LCB0ICk7CgoJfQoKCV9sZXJwKCBidWZmZXIsIGRzdE9mZnNldCwgc3JjT2Zmc2V0LCB0LCBzdHJpZGUgKSB7CgoJCWNvbnN0IHMgPSAxIC0gdDsKCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBzdHJpZGU7ICsrIGkgKSB7CgoJCQljb25zdCBqID0gZHN0T2Zmc2V0ICsgaTsKCgkJCWJ1ZmZlclsgaiBdID0gYnVmZmVyWyBqIF0gKiBzICsgYnVmZmVyWyBzcmNPZmZzZXQgKyBpIF0gKiB0OwoKCQl9CgoJfQoKCV9sZXJwQWRkaXRpdmUoIGJ1ZmZlciwgZHN0T2Zmc2V0LCBzcmNPZmZzZXQsIHQsIHN0cmlkZSApIHsKCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBzdHJpZGU7ICsrIGkgKSB7CgoJCQljb25zdCBqID0gZHN0T2Zmc2V0ICsgaTsKCgkJCWJ1ZmZlclsgaiBdID0gYnVmZmVyWyBqIF0gKyBidWZmZXJbIHNyY09mZnNldCArIGkgXSAqIHQ7CgoJCX0KCgl9Cgp9CgovLyBDaGFyYWN0ZXJzIFtdLjovIGFyZSByZXNlcnZlZCBmb3IgdHJhY2sgYmluZGluZyBzeW50YXguCmNvbnN0IF9SRVNFUlZFRF9DSEFSU19SRSA9ICdcXFtcXF1cXC46XFwvJzsKY29uc3QgX3Jlc2VydmVkUmUgPSBuZXcgUmVnRXhwKCAnWycgKyBfUkVTRVJWRURfQ0hBUlNfUkUgKyAnXScsICdnJyApOwoKLy8gQXR0ZW1wdHMgdG8gYWxsb3cgbm9kZSBuYW1lcyBmcm9tIGFueSBsYW5ndWFnZS4gRVM1J3MgYFx3YCByZWdleHAgbWF0Y2hlcwovLyBvbmx5IGxhdGluIGNoYXJhY3RlcnMsIGFuZCB0aGUgdW5pY29kZSBccHtMfSBpcyBub3QgeWV0IHN1cHBvcnRlZC4gU28KLy8gaW5zdGVhZCwgd2UgZXhjbHVkZSByZXNlcnZlZCBjaGFyYWN0ZXJzIGFuZCBtYXRjaCBldmVyeXRoaW5nIGVsc2UuCmNvbnN0IF93b3JkQ2hhciA9ICdbXicgKyBfUkVTRVJWRURfQ0hBUlNfUkUgKyAnXSc7CmNvbnN0IF93b3JkQ2hhck9yRG90ID0gJ1teJyArIF9SRVNFUlZFRF9DSEFSU19SRS5yZXBsYWNlKCAnXFwuJywgJycgKSArICddJzsKCi8vIFBhcmVudCBkaXJlY3RvcmllcywgZGVsaW1pdGVkIGJ5ICcvJyBvciAnOicuIEN1cnJlbnRseSB1bnVzZWQsIGJ1dCBtdXN0Ci8vIGJlIG1hdGNoZWQgdG8gcGFyc2UgdGhlIHJlc3Qgb2YgdGhlIHRyYWNrIG5hbWUuCmNvbnN0IF9kaXJlY3RvcnlSZSA9IC8qQF9fUFVSRV9fKi8gLygoPzpXQytbXC86XSkqKS8uc291cmNlLnJlcGxhY2UoICdXQycsIF93b3JkQ2hhciApOwoKLy8gVGFyZ2V0IG5vZGUuIE1heSBjb250YWluIHdvcmQgY2hhcmFjdGVycyAoYS16QS1aMC05XykgYW5kICcuJyBvciAnLScuCmNvbnN0IF9ub2RlUmUgPSAvKkBfX1BVUkVfXyovIC8oV0NPRCspPy8uc291cmNlLnJlcGxhY2UoICdXQ09EJywgX3dvcmRDaGFyT3JEb3QgKTsKCi8vIE9iamVjdCBvbiB0YXJnZXQgbm9kZSwgYW5kIGFjY2Vzc29yLiBNYXkgbm90IGNvbnRhaW4gcmVzZXJ2ZWQKLy8gY2hhcmFjdGVycy4gQWNjZXNzb3IgbWF5IGNvbnRhaW4gYW55IGNoYXJhY3RlciBleGNlcHQgY2xvc2luZyBicmFja2V0Lgpjb25zdCBfb2JqZWN0UmUgPSAvKkBfX1BVUkVfXyovIC8oPzpcLihXQyspKD86XFsoLispXF0pPyk/Ly5zb3VyY2UucmVwbGFjZSggJ1dDJywgX3dvcmRDaGFyICk7CgovLyBQcm9wZXJ0eSBhbmQgYWNjZXNzb3IuIE1heSBub3QgY29udGFpbiByZXNlcnZlZCBjaGFyYWN0ZXJzLiBBY2Nlc3NvciBtYXkKLy8gY29udGFpbiBhbnkgbm9uLWJyYWNrZXQgY2hhcmFjdGVycy4KY29uc3QgX3Byb3BlcnR5UmUgPSAvKkBfX1BVUkVfXyovIC9cLihXQyspKD86XFsoLispXF0pPy8uc291cmNlLnJlcGxhY2UoICdXQycsIF93b3JkQ2hhciApOwoKY29uc3QgX3RyYWNrUmUgPSBuZXcgUmVnRXhwKCAnJwoJKyAnXicKCSsgX2RpcmVjdG9yeVJlCgkrIF9ub2RlUmUKCSsgX29iamVjdFJlCgkrIF9wcm9wZXJ0eVJlCgkrICckJwopOwoKY29uc3QgX3N1cHBvcnRlZE9iamVjdE5hbWVzID0gWyAnbWF0ZXJpYWwnLCAnbWF0ZXJpYWxzJywgJ2JvbmVzJywgJ21hcCcgXTsKCmNsYXNzIENvbXBvc2l0ZSB7CgoJY29uc3RydWN0b3IoIHRhcmdldEdyb3VwLCBwYXRoLCBvcHRpb25hbFBhcnNlZFBhdGggKSB7CgoJCWNvbnN0IHBhcnNlZFBhdGggPSBvcHRpb25hbFBhcnNlZFBhdGggfHwgUHJvcGVydHlCaW5kaW5nLnBhcnNlVHJhY2tOYW1lKCBwYXRoICk7CgoJCXRoaXMuX3RhcmdldEdyb3VwID0gdGFyZ2V0R3JvdXA7CgkJdGhpcy5fYmluZGluZ3MgPSB0YXJnZXRHcm91cC5zdWJzY3JpYmVfKCBwYXRoLCBwYXJzZWRQYXRoICk7CgoJfQoKCWdldFZhbHVlKCBhcnJheSwgb2Zmc2V0ICkgewoKCQl0aGlzLmJpbmQoKTsgLy8gYmluZCBhbGwgYmluZGluZwoKCQljb25zdCBmaXJzdFZhbGlkSW5kZXggPSB0aGlzLl90YXJnZXRHcm91cC5uQ2FjaGVkT2JqZWN0c18sCgkJCWJpbmRpbmcgPSB0aGlzLl9iaW5kaW5nc1sgZmlyc3RWYWxpZEluZGV4IF07CgoJCS8vIGFuZCBvbmx5IGNhbGwgLmdldFZhbHVlIG9uIHRoZSBmaXJzdAoJCWlmICggYmluZGluZyAhPT0gdW5kZWZpbmVkICkgYmluZGluZy5nZXRWYWx1ZSggYXJyYXksIG9mZnNldCApOwoKCX0KCglzZXRWYWx1ZSggYXJyYXksIG9mZnNldCApIHsKCgkJY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5nczsKCgkJZm9yICggbGV0IGkgPSB0aGlzLl90YXJnZXRHcm91cC5uQ2FjaGVkT2JqZWN0c18sIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQliaW5kaW5nc1sgaSBdLnNldFZhbHVlKCBhcnJheSwgb2Zmc2V0ICk7CgoJCX0KCgl9CgoJYmluZCgpIHsKCgkJY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5nczsKCgkJZm9yICggbGV0IGkgPSB0aGlzLl90YXJnZXRHcm91cC5uQ2FjaGVkT2JqZWN0c18sIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQliaW5kaW5nc1sgaSBdLmJpbmQoKTsKCgkJfQoKCX0KCgl1bmJpbmQoKSB7CgoJCWNvbnN0IGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3M7CgoJCWZvciAoIGxldCBpID0gdGhpcy5fdGFyZ2V0R3JvdXAubkNhY2hlZE9iamVjdHNfLCBuID0gYmluZGluZ3MubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJYmluZGluZ3NbIGkgXS51bmJpbmQoKTsKCgkJfQoKCX0KCn0KCi8vIE5vdGU6IFRoaXMgY2xhc3MgdXNlcyBhIFN0YXRlIHBhdHRlcm4gb24gYSBwZXItbWV0aG9kIGJhc2lzOgovLyAnYmluZCcgc2V0cyAndGhpcy5nZXRWYWx1ZScgLyAnc2V0VmFsdWUnIGFuZCBzaGFkb3dzIHRoZQovLyBwcm90b3R5cGUgdmVyc2lvbiBvZiB0aGVzZSBtZXRob2RzIHdpdGggb25lIHRoYXQgcmVwcmVzZW50cwovLyB0aGUgYm91bmQgc3RhdGUuIFdoZW4gdGhlIHByb3BlcnR5IGlzIG5vdCBmb3VuZCwgdGhlIG1ldGhvZHMKLy8gYmVjb21lIG5vLW9wcy4KY2xhc3MgUHJvcGVydHlCaW5kaW5nIHsKCgljb25zdHJ1Y3Rvciggcm9vdE5vZGUsIHBhdGgsIHBhcnNlZFBhdGggKSB7CgoJCXRoaXMucGF0aCA9IHBhdGg7CgkJdGhpcy5wYXJzZWRQYXRoID0gcGFyc2VkUGF0aCB8fCBQcm9wZXJ0eUJpbmRpbmcucGFyc2VUcmFja05hbWUoIHBhdGggKTsKCgkJdGhpcy5ub2RlID0gUHJvcGVydHlCaW5kaW5nLmZpbmROb2RlKCByb290Tm9kZSwgdGhpcy5wYXJzZWRQYXRoLm5vZGVOYW1lICk7CgoJCXRoaXMucm9vdE5vZGUgPSByb290Tm9kZTsKCgkJLy8gaW5pdGlhbCBzdGF0ZSBvZiB0aGVzZSBtZXRob2RzIHRoYXQgY2FsbHMgJ2JpbmQnCgkJdGhpcy5nZXRWYWx1ZSA9IHRoaXMuX2dldFZhbHVlX3VuYm91bmQ7CgkJdGhpcy5zZXRWYWx1ZSA9IHRoaXMuX3NldFZhbHVlX3VuYm91bmQ7CgoJfQoKCglzdGF0aWMgY3JlYXRlKCByb290LCBwYXRoLCBwYXJzZWRQYXRoICkgewoKCQlpZiAoICEgKCByb290ICYmIHJvb3QuaXNBbmltYXRpb25PYmplY3RHcm91cCApICkgewoKCQkJcmV0dXJuIG5ldyBQcm9wZXJ0eUJpbmRpbmcoIHJvb3QsIHBhdGgsIHBhcnNlZFBhdGggKTsKCgkJfSBlbHNlIHsKCgkJCXJldHVybiBuZXcgUHJvcGVydHlCaW5kaW5nLkNvbXBvc2l0ZSggcm9vdCwgcGF0aCwgcGFyc2VkUGF0aCApOwoKCQl9CgoJfQoKCS8qKgoJICogUmVwbGFjZXMgc3BhY2VzIHdpdGggdW5kZXJzY29yZXMgYW5kIHJlbW92ZXMgdW5zdXBwb3J0ZWQgY2hhcmFjdGVycyBmcm9tCgkgKiBub2RlIG5hbWVzLCB0byBlbnN1cmUgY29tcGF0aWJpbGl0eSB3aXRoIHBhcnNlVHJhY2tOYW1lKCkuCgkgKgoJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgTm9kZSBuYW1lIHRvIGJlIHNhbml0aXplZC4KCSAqIEByZXR1cm4ge3N0cmluZ30KCSAqLwoJc3RhdGljIHNhbml0aXplTm9kZU5hbWUoIG5hbWUgKSB7CgoJCXJldHVybiBuYW1lLnJlcGxhY2UoIC9ccy9nLCAnXycgKS5yZXBsYWNlKCBfcmVzZXJ2ZWRSZSwgJycgKTsKCgl9CgoJc3RhdGljIHBhcnNlVHJhY2tOYW1lKCB0cmFja05hbWUgKSB7CgoJCWNvbnN0IG1hdGNoZXMgPSBfdHJhY2tSZS5leGVjKCB0cmFja05hbWUgKTsKCgkJaWYgKCBtYXRjaGVzID09PSBudWxsICkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnUHJvcGVydHlCaW5kaW5nOiBDYW5ub3QgcGFyc2UgdHJhY2tOYW1lOiAnICsgdHJhY2tOYW1lICk7CgoJCX0KCgkJY29uc3QgcmVzdWx0cyA9IHsKCQkJLy8gZGlyZWN0b3J5TmFtZTogbWF0Y2hlc1sgMSBdLCAvLyAodHNjaHcpIGN1cnJlbnRseSB1bnVzZWQKCQkJbm9kZU5hbWU6IG1hdGNoZXNbIDIgXSwKCQkJb2JqZWN0TmFtZTogbWF0Y2hlc1sgMyBdLAoJCQlvYmplY3RJbmRleDogbWF0Y2hlc1sgNCBdLAoJCQlwcm9wZXJ0eU5hbWU6IG1hdGNoZXNbIDUgXSwgLy8gcmVxdWlyZWQKCQkJcHJvcGVydHlJbmRleDogbWF0Y2hlc1sgNiBdCgkJfTsKCgkJY29uc3QgbGFzdERvdCA9IHJlc3VsdHMubm9kZU5hbWUgJiYgcmVzdWx0cy5ub2RlTmFtZS5sYXN0SW5kZXhPZiggJy4nICk7CgoJCWlmICggbGFzdERvdCAhPT0gdW5kZWZpbmVkICYmIGxhc3REb3QgIT09IC0gMSApIHsKCgkJCWNvbnN0IG9iamVjdE5hbWUgPSByZXN1bHRzLm5vZGVOYW1lLnN1YnN0cmluZyggbGFzdERvdCArIDEgKTsKCgkJCS8vIE9iamVjdCBuYW1lcyBtdXN0IGJlIGNoZWNrZWQgYWdhaW5zdCBhbiBhbGxvd2xpc3QuIE90aGVyd2lzZSwgdGhlcmUKCQkJLy8gaXMgbm8gd2F5IHRvIHBhcnNlICdmb28uYmFyLmJheic6ICdiYXonIG11c3QgYmUgYSBwcm9wZXJ0eSwgYnV0CgkJCS8vICdiYXInIGNvdWxkIGJlIHRoZSBvYmplY3ROYW1lLCBvciBwYXJ0IG9mIGEgbm9kZU5hbWUgKHdoaWNoIGNhbgoJCQkvLyBpbmNsdWRlICcuJyBjaGFyYWN0ZXJzKS4KCQkJaWYgKCBfc3VwcG9ydGVkT2JqZWN0TmFtZXMuaW5kZXhPZiggb2JqZWN0TmFtZSApICE9PSAtIDEgKSB7CgoJCQkJcmVzdWx0cy5ub2RlTmFtZSA9IHJlc3VsdHMubm9kZU5hbWUuc3Vic3RyaW5nKCAwLCBsYXN0RG90ICk7CgkJCQlyZXN1bHRzLm9iamVjdE5hbWUgPSBvYmplY3ROYW1lOwoKCQkJfQoKCQl9CgoJCWlmICggcmVzdWx0cy5wcm9wZXJ0eU5hbWUgPT09IG51bGwgfHwgcmVzdWx0cy5wcm9wZXJ0eU5hbWUubGVuZ3RoID09PSAwICkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnUHJvcGVydHlCaW5kaW5nOiBjYW4gbm90IHBhcnNlIHByb3BlcnR5TmFtZSBmcm9tIHRyYWNrTmFtZTogJyArIHRyYWNrTmFtZSApOwoKCQl9CgoJCXJldHVybiByZXN1bHRzOwoKCX0KCglzdGF0aWMgZmluZE5vZGUoIHJvb3QsIG5vZGVOYW1lICkgewoKCQlpZiAoIG5vZGVOYW1lID09PSB1bmRlZmluZWQgfHwgbm9kZU5hbWUgPT09ICcnIHx8IG5vZGVOYW1lID09PSAnLicgfHwgbm9kZU5hbWUgPT09IC0gMSB8fCBub2RlTmFtZSA9PT0gcm9vdC5uYW1lIHx8IG5vZGVOYW1lID09PSByb290LnV1aWQgKSB7CgoJCQlyZXR1cm4gcm9vdDsKCgkJfQoKCQkvLyBzZWFyY2ggaW50byBza2VsZXRvbiBib25lcy4KCQlpZiAoIHJvb3Quc2tlbGV0b24gKSB7CgoJCQljb25zdCBib25lID0gcm9vdC5za2VsZXRvbi5nZXRCb25lQnlOYW1lKCBub2RlTmFtZSApOwoKCQkJaWYgKCBib25lICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcmV0dXJuIGJvbmU7CgoJCQl9CgoJCX0KCgkJLy8gc2VhcmNoIGludG8gbm9kZSBzdWJ0cmVlLgoJCWlmICggcm9vdC5jaGlsZHJlbiApIHsKCgkJCWNvbnN0IHNlYXJjaE5vZGVTdWJ0cmVlID0gZnVuY3Rpb24gKCBjaGlsZHJlbiApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNoaWxkTm9kZSA9IGNoaWxkcmVuWyBpIF07CgoJCQkJCWlmICggY2hpbGROb2RlLm5hbWUgPT09IG5vZGVOYW1lIHx8IGNoaWxkTm9kZS51dWlkID09PSBub2RlTmFtZSApIHsKCgkJCQkJCXJldHVybiBjaGlsZE5vZGU7CgoJCQkJCX0KCgkJCQkJY29uc3QgcmVzdWx0ID0gc2VhcmNoTm9kZVN1YnRyZWUoIGNoaWxkTm9kZS5jaGlsZHJlbiApOwoKCQkJCQlpZiAoIHJlc3VsdCApIHJldHVybiByZXN1bHQ7CgoJCQkJfQoKCQkJCXJldHVybiBudWxsOwoKCQkJfTsKCgkJCWNvbnN0IHN1YlRyZWVOb2RlID0gc2VhcmNoTm9kZVN1YnRyZWUoIHJvb3QuY2hpbGRyZW4gKTsKCgkJCWlmICggc3ViVHJlZU5vZGUgKSB7CgoJCQkJcmV0dXJuIHN1YlRyZWVOb2RlOwoKCQkJfQoKCQl9CgoJCXJldHVybiBudWxsOwoKCX0KCgkvLyB0aGVzZSBhcmUgdXNlZCB0byAiYmluZCIgYSBub25leGlzdGVudCBwcm9wZXJ0eQoJX2dldFZhbHVlX3VuYXZhaWxhYmxlKCkge30KCV9zZXRWYWx1ZV91bmF2YWlsYWJsZSgpIHt9CgoJLy8gR2V0dGVycwoKCV9nZXRWYWx1ZV9kaXJlY3QoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQlidWZmZXJbIG9mZnNldCBdID0gdGhpcy50YXJnZXRPYmplY3RbIHRoaXMucHJvcGVydHlOYW1lIF07CgoJfQoKCV9nZXRWYWx1ZV9hcnJheSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCWNvbnN0IHNvdXJjZSA9IHRoaXMucmVzb2x2ZWRQcm9wZXJ0eTsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gc291cmNlLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWJ1ZmZlclsgb2Zmc2V0ICsrIF0gPSBzb3VyY2VbIGkgXTsKCgkJfQoKCX0KCglfZ2V0VmFsdWVfYXJyYXlFbGVtZW50KCBidWZmZXIsIG9mZnNldCApIHsKCgkJYnVmZmVyWyBvZmZzZXQgXSA9IHRoaXMucmVzb2x2ZWRQcm9wZXJ0eVsgdGhpcy5wcm9wZXJ0eUluZGV4IF07CgoJfQoKCV9nZXRWYWx1ZV90b0FycmF5KCBidWZmZXIsIG9mZnNldCApIHsKCgkJdGhpcy5yZXNvbHZlZFByb3BlcnR5LnRvQXJyYXkoIGJ1ZmZlciwgb2Zmc2V0ICk7CgoJfQoKCS8vIERpcmVjdAoKCV9zZXRWYWx1ZV9kaXJlY3QoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQl0aGlzLnRhcmdldE9iamVjdFsgdGhpcy5wcm9wZXJ0eU5hbWUgXSA9IGJ1ZmZlclsgb2Zmc2V0IF07CgoJfQoKCV9zZXRWYWx1ZV9kaXJlY3Rfc2V0TmVlZHNVcGRhdGUoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQl0aGlzLnRhcmdldE9iamVjdFsgdGhpcy5wcm9wZXJ0eU5hbWUgXSA9IGJ1ZmZlclsgb2Zmc2V0IF07CgkJdGhpcy50YXJnZXRPYmplY3QubmVlZHNVcGRhdGUgPSB0cnVlOwoKCX0KCglfc2V0VmFsdWVfZGlyZWN0X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQl0aGlzLnRhcmdldE9iamVjdFsgdGhpcy5wcm9wZXJ0eU5hbWUgXSA9IGJ1ZmZlclsgb2Zmc2V0IF07CgkJdGhpcy50YXJnZXRPYmplY3QubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCS8vIEVudGlyZUFycmF5CgoJX3NldFZhbHVlX2FycmF5KCBidWZmZXIsIG9mZnNldCApIHsKCgkJY29uc3QgZGVzdCA9IHRoaXMucmVzb2x2ZWRQcm9wZXJ0eTsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gZGVzdC5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQlkZXN0WyBpIF0gPSBidWZmZXJbIG9mZnNldCArKyBdOwoKCQl9CgoJfQoKCV9zZXRWYWx1ZV9hcnJheV9zZXROZWVkc1VwZGF0ZSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCWNvbnN0IGRlc3QgPSB0aGlzLnJlc29sdmVkUHJvcGVydHk7CgoJCWZvciAoIGxldCBpID0gMCwgbiA9IGRlc3QubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJZGVzdFsgaSBdID0gYnVmZmVyWyBvZmZzZXQgKysgXTsKCgkJfQoKCQl0aGlzLnRhcmdldE9iamVjdC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCV9zZXRWYWx1ZV9hcnJheV9zZXRNYXRyaXhXb3JsZE5lZWRzVXBkYXRlKCBidWZmZXIsIG9mZnNldCApIHsKCgkJY29uc3QgZGVzdCA9IHRoaXMucmVzb2x2ZWRQcm9wZXJ0eTsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gZGVzdC5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQlkZXN0WyBpIF0gPSBidWZmZXJbIG9mZnNldCArKyBdOwoKCQl9CgoJCXRoaXMudGFyZ2V0T2JqZWN0Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKCX0KCgkvLyBBcnJheUVsZW1lbnQKCglfc2V0VmFsdWVfYXJyYXlFbGVtZW50KCBidWZmZXIsIG9mZnNldCApIHsKCgkJdGhpcy5yZXNvbHZlZFByb3BlcnR5WyB0aGlzLnByb3BlcnR5SW5kZXggXSA9IGJ1ZmZlclsgb2Zmc2V0IF07CgoJfQoKCV9zZXRWYWx1ZV9hcnJheUVsZW1lbnRfc2V0TmVlZHNVcGRhdGUoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQl0aGlzLnJlc29sdmVkUHJvcGVydHlbIHRoaXMucHJvcGVydHlJbmRleCBdID0gYnVmZmVyWyBvZmZzZXQgXTsKCQl0aGlzLnRhcmdldE9iamVjdC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCV9zZXRWYWx1ZV9hcnJheUVsZW1lbnRfc2V0TWF0cml4V29ybGROZWVkc1VwZGF0ZSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eVsgdGhpcy5wcm9wZXJ0eUluZGV4IF0gPSBidWZmZXJbIG9mZnNldCBdOwoJCXRoaXMudGFyZ2V0T2JqZWN0Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKCX0KCgkvLyBIYXNUb0Zyb21BcnJheQoKCV9zZXRWYWx1ZV9mcm9tQXJyYXkoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQl0aGlzLnJlc29sdmVkUHJvcGVydHkuZnJvbUFycmF5KCBidWZmZXIsIG9mZnNldCApOwoKCX0KCglfc2V0VmFsdWVfZnJvbUFycmF5X3NldE5lZWRzVXBkYXRlKCBidWZmZXIsIG9mZnNldCApIHsKCgkJdGhpcy5yZXNvbHZlZFByb3BlcnR5LmZyb21BcnJheSggYnVmZmVyLCBvZmZzZXQgKTsKCQl0aGlzLnRhcmdldE9iamVjdC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCV9zZXRWYWx1ZV9mcm9tQXJyYXlfc2V0TWF0cml4V29ybGROZWVkc1VwZGF0ZSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eS5mcm9tQXJyYXkoIGJ1ZmZlciwgb2Zmc2V0ICk7CgkJdGhpcy50YXJnZXRPYmplY3QubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCV9nZXRWYWx1ZV91bmJvdW5kKCB0YXJnZXRBcnJheSwgb2Zmc2V0ICkgewoKCQl0aGlzLmJpbmQoKTsKCQl0aGlzLmdldFZhbHVlKCB0YXJnZXRBcnJheSwgb2Zmc2V0ICk7CgoJfQoKCV9zZXRWYWx1ZV91bmJvdW5kKCBzb3VyY2VBcnJheSwgb2Zmc2V0ICkgewoKCQl0aGlzLmJpbmQoKTsKCQl0aGlzLnNldFZhbHVlKCBzb3VyY2VBcnJheSwgb2Zmc2V0ICk7CgoJfQoKCS8vIGNyZWF0ZSBnZXR0ZXIgLyBzZXR0ZXIgcGFpciBmb3IgYSBwcm9wZXJ0eSBpbiB0aGUgc2NlbmUgZ3JhcGgKCWJpbmQoKSB7CgoJCWxldCB0YXJnZXRPYmplY3QgPSB0aGlzLm5vZGU7CgkJY29uc3QgcGFyc2VkUGF0aCA9IHRoaXMucGFyc2VkUGF0aDsKCgkJY29uc3Qgb2JqZWN0TmFtZSA9IHBhcnNlZFBhdGgub2JqZWN0TmFtZTsKCQljb25zdCBwcm9wZXJ0eU5hbWUgPSBwYXJzZWRQYXRoLnByb3BlcnR5TmFtZTsKCQlsZXQgcHJvcGVydHlJbmRleCA9IHBhcnNlZFBhdGgucHJvcGVydHlJbmRleDsKCgkJaWYgKCAhIHRhcmdldE9iamVjdCApIHsKCgkJCXRhcmdldE9iamVjdCA9IFByb3BlcnR5QmluZGluZy5maW5kTm9kZSggdGhpcy5yb290Tm9kZSwgcGFyc2VkUGF0aC5ub2RlTmFtZSApOwoKCQkJdGhpcy5ub2RlID0gdGFyZ2V0T2JqZWN0OwoKCQl9CgoJCS8vIHNldCBmYWlsIHN0YXRlIHNvIHdlIGNhbiBqdXN0ICdyZXR1cm4nIG9uIGVycm9yCgkJdGhpcy5nZXRWYWx1ZSA9IHRoaXMuX2dldFZhbHVlX3VuYXZhaWxhYmxlOwoJCXRoaXMuc2V0VmFsdWUgPSB0aGlzLl9zZXRWYWx1ZV91bmF2YWlsYWJsZTsKCgkJLy8gZW5zdXJlIHRoZXJlIGlzIGEgdmFsdWUgbm9kZQoJCWlmICggISB0YXJnZXRPYmplY3QgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IE5vIHRhcmdldCBub2RlIGZvdW5kIGZvciB0cmFjazogJyArIHRoaXMucGF0aCArICcuJyApOwoJCQlyZXR1cm47CgoJCX0KCgkJaWYgKCBvYmplY3ROYW1lICkgewoKCQkJbGV0IG9iamVjdEluZGV4ID0gcGFyc2VkUGF0aC5vYmplY3RJbmRleDsKCgkJCS8vIHNwZWNpYWwgY2FzZXMgd2VyZSB3ZSBuZWVkIHRvIHJlYWNoIGRlZXBlciBpbnRvIHRoZSBoaWVyYXJjaHkgdG8gZ2V0IHRoZSBmYWNlIG1hdGVyaWFscy4uLi4KCQkJc3dpdGNoICggb2JqZWN0TmFtZSApIHsKCgkJCQljYXNlICdtYXRlcmlhbHMnOgoKCQkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0Lm1hdGVyaWFsICkgewoKCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG1hdGVyaWFsIGFzIG5vZGUgZG9lcyBub3QgaGF2ZSBhIG1hdGVyaWFsLicsIHRoaXMgKTsKCQkJCQkJcmV0dXJuOwoKCQkJCQl9CgoJCQkJCWlmICggISB0YXJnZXRPYmplY3QubWF0ZXJpYWwubWF0ZXJpYWxzICkgewoKCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG1hdGVyaWFsLm1hdGVyaWFscyBhcyBub2RlLm1hdGVyaWFsIGRvZXMgbm90IGhhdmUgYSBtYXRlcmlhbHMgYXJyYXkuJywgdGhpcyApOwoJCQkJCQlyZXR1cm47CgoJCQkJCX0KCgkJCQkJdGFyZ2V0T2JqZWN0ID0gdGFyZ2V0T2JqZWN0Lm1hdGVyaWFsLm1hdGVyaWFsczsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnYm9uZXMnOgoKCQkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0LnNrZWxldG9uICkgewoKCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIGJvbmVzIGFzIG5vZGUgZG9lcyBub3QgaGF2ZSBhIHNrZWxldG9uLicsIHRoaXMgKTsKCQkJCQkJcmV0dXJuOwoKCQkJCQl9CgoJCQkJCS8vIHBvdGVudGlhbCBmdXR1cmUgb3B0aW1pemF0aW9uOiBza2lwIHRoaXMgaWYgcHJvcGVydHlJbmRleCBpcyBhbHJlYWR5IGFuIGludGVnZXIKCQkJCQkvLyBhbmQgY29udmVydCB0aGUgaW50ZWdlciBzdHJpbmcgdG8gYSB0cnVlIGludGVnZXIuCgoJCQkJCXRhcmdldE9iamVjdCA9IHRhcmdldE9iamVjdC5za2VsZXRvbi5ib25lczsKCgkJCQkJLy8gc3VwcG9ydCByZXNvbHZpbmcgbW9ycGhUYXJnZXQgbmFtZXMgaW50byBpbmRpY2VzLgoJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRhcmdldE9iamVjdC5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQlpZiAoIHRhcmdldE9iamVjdFsgaSBdLm5hbWUgPT09IG9iamVjdEluZGV4ICkgewoKCQkJCQkJCW9iamVjdEluZGV4ID0gaTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ21hcCc6CgoJCQkJCWlmICggJ21hcCcgaW4gdGFyZ2V0T2JqZWN0ICkgewoKCQkJCQkJdGFyZ2V0T2JqZWN0ID0gdGFyZ2V0T2JqZWN0Lm1hcDsKCQkJCQkJYnJlYWs7CgoJCQkJCX0KCgkJCQkJaWYgKCAhIHRhcmdldE9iamVjdC5tYXRlcmlhbCApIHsKCgkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IENhbiBub3QgYmluZCB0byBtYXRlcmlhbCBhcyBub2RlIGRvZXMgbm90IGhhdmUgYSBtYXRlcmlhbC4nLCB0aGlzICk7CgkJCQkJCXJldHVybjsKCgkJCQkJfQoKCQkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0Lm1hdGVyaWFsLm1hcCApIHsKCgkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IENhbiBub3QgYmluZCB0byBtYXRlcmlhbC5tYXAgYXMgbm9kZS5tYXRlcmlhbCBkb2VzIG5vdCBoYXZlIGEgbWFwLicsIHRoaXMgKTsKCQkJCQkJcmV0dXJuOwoKCQkJCQl9CgoJCQkJCXRhcmdldE9iamVjdCA9IHRhcmdldE9iamVjdC5tYXRlcmlhbC5tYXA7CgkJCQkJYnJlYWs7CgoJCQkJZGVmYXVsdDoKCgkJCQkJaWYgKCB0YXJnZXRPYmplY3RbIG9iamVjdE5hbWUgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG9iamVjdE5hbWUgb2Ygbm9kZSB1bmRlZmluZWQuJywgdGhpcyApOwoJCQkJCQlyZXR1cm47CgoJCQkJCX0KCgkJCQkJdGFyZ2V0T2JqZWN0ID0gdGFyZ2V0T2JqZWN0WyBvYmplY3ROYW1lIF07CgoJCQl9CgoKCQkJaWYgKCBvYmplY3RJbmRleCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWlmICggdGFyZ2V0T2JqZWN0WyBvYmplY3RJbmRleCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IFRyeWluZyB0byBiaW5kIHRvIG9iamVjdEluZGV4IG9mIG9iamVjdE5hbWUsIGJ1dCBpcyB1bmRlZmluZWQuJywgdGhpcywgdGFyZ2V0T2JqZWN0ICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQl0YXJnZXRPYmplY3QgPSB0YXJnZXRPYmplY3RbIG9iamVjdEluZGV4IF07CgoJCQl9CgoJCX0KCgkJLy8gcmVzb2x2ZSBwcm9wZXJ0eQoJCWNvbnN0IG5vZGVQcm9wZXJ0eSA9IHRhcmdldE9iamVjdFsgcHJvcGVydHlOYW1lIF07CgoJCWlmICggbm9kZVByb3BlcnR5ID09PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBub2RlTmFtZSA9IHBhcnNlZFBhdGgubm9kZU5hbWU7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBUcnlpbmcgdG8gdXBkYXRlIHByb3BlcnR5IGZvciB0cmFjazogJyArIG5vZGVOYW1lICsKCQkJCScuJyArIHByb3BlcnR5TmFtZSArICcgYnV0IGl0IHdhc25cJ3QgZm91bmQuJywgdGFyZ2V0T2JqZWN0ICk7CgkJCXJldHVybjsKCgkJfQoKCQkvLyBkZXRlcm1pbmUgdmVyc2lvbmluZyBzY2hlbWUKCQlsZXQgdmVyc2lvbmluZyA9IHRoaXMuVmVyc2lvbmluZy5Ob25lOwoKCQl0aGlzLnRhcmdldE9iamVjdCA9IHRhcmdldE9iamVjdDsKCgkJaWYgKCB0YXJnZXRPYmplY3QubmVlZHNVcGRhdGUgIT09IHVuZGVmaW5lZCApIHsgLy8gbWF0ZXJpYWwKCgkJCXZlcnNpb25pbmcgPSB0aGlzLlZlcnNpb25pbmcuTmVlZHNVcGRhdGU7CgoJCX0gZWxzZSBpZiAoIHRhcmdldE9iamVjdC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlICE9PSB1bmRlZmluZWQgKSB7IC8vIG5vZGUgdHJhbnNmb3JtCgoJCQl2ZXJzaW9uaW5nID0gdGhpcy5WZXJzaW9uaW5nLk1hdHJpeFdvcmxkTmVlZHNVcGRhdGU7CgoJCX0KCgkJLy8gZGV0ZXJtaW5lIGhvdyB0aGUgcHJvcGVydHkgZ2V0cyBib3VuZAoJCWxldCBiaW5kaW5nVHlwZSA9IHRoaXMuQmluZGluZ1R5cGUuRGlyZWN0OwoKCQlpZiAoIHByb3BlcnR5SW5kZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCS8vIGFjY2VzcyBhIHN1YiBlbGVtZW50IG9mIHRoZSBwcm9wZXJ0eSBhcnJheSAob25seSBwcmltaXRpdmVzIGFyZSBzdXBwb3J0ZWQgcmlnaHQgbm93KQoKCQkJaWYgKCBwcm9wZXJ0eU5hbWUgPT09ICdtb3JwaFRhcmdldEluZmx1ZW5jZXMnICkgewoKCQkJCS8vIHBvdGVudGlhbCBvcHRpbWl6YXRpb24sIHNraXAgdGhpcyBpZiBwcm9wZXJ0eUluZGV4IGlzIGFscmVhZHkgYW4gaW50ZWdlciwgYW5kIGNvbnZlcnQgdGhlIGludGVnZXIgc3RyaW5nIHRvIGEgdHJ1ZSBpbnRlZ2VyLgoKCQkJCS8vIHN1cHBvcnQgcmVzb2x2aW5nIG1vcnBoVGFyZ2V0IG5hbWVzIGludG8gaW5kaWNlcy4KCQkJCWlmICggISB0YXJnZXRPYmplY3QuZ2VvbWV0cnkgKSB7CgoJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IENhbiBub3QgYmluZCB0byBtb3JwaFRhcmdldEluZmx1ZW5jZXMgYmVjYXVzZSBub2RlIGRvZXMgbm90IGhhdmUgYSBnZW9tZXRyeS4nLCB0aGlzICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0Lmdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcyApIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG1vcnBoVGFyZ2V0SW5mbHVlbmNlcyBiZWNhdXNlIG5vZGUgZG9lcyBub3QgaGF2ZSBhIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy4nLCB0aGlzICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQlpZiAoIHRhcmdldE9iamVjdC5tb3JwaFRhcmdldERpY3Rpb25hcnlbIHByb3BlcnR5SW5kZXggXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlwcm9wZXJ0eUluZGV4ID0gdGFyZ2V0T2JqZWN0Lm1vcnBoVGFyZ2V0RGljdGlvbmFyeVsgcHJvcGVydHlJbmRleCBdOwoKCQkJCX0KCgkJCX0KCgkJCWJpbmRpbmdUeXBlID0gdGhpcy5CaW5kaW5nVHlwZS5BcnJheUVsZW1lbnQ7CgoJCQl0aGlzLnJlc29sdmVkUHJvcGVydHkgPSBub2RlUHJvcGVydHk7CgkJCXRoaXMucHJvcGVydHlJbmRleCA9IHByb3BlcnR5SW5kZXg7CgoJCX0gZWxzZSBpZiAoIG5vZGVQcm9wZXJ0eS5mcm9tQXJyYXkgIT09IHVuZGVmaW5lZCAmJiBub2RlUHJvcGVydHkudG9BcnJheSAhPT0gdW5kZWZpbmVkICkgewoKCQkJLy8gbXVzdCB1c2UgY29weSBmb3IgT2JqZWN0M0QuRXVsZXIvUXVhdGVybmlvbgoKCQkJYmluZGluZ1R5cGUgPSB0aGlzLkJpbmRpbmdUeXBlLkhhc0Zyb21Ub0FycmF5OwoKCQkJdGhpcy5yZXNvbHZlZFByb3BlcnR5ID0gbm9kZVByb3BlcnR5OwoKCQl9IGVsc2UgaWYgKCBBcnJheS5pc0FycmF5KCBub2RlUHJvcGVydHkgKSApIHsKCgkJCWJpbmRpbmdUeXBlID0gdGhpcy5CaW5kaW5nVHlwZS5FbnRpcmVBcnJheTsKCgkJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eSA9IG5vZGVQcm9wZXJ0eTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lOwoKCQl9CgoJCS8vIHNlbGVjdCBnZXR0ZXIgLyBzZXR0ZXIKCQl0aGlzLmdldFZhbHVlID0gdGhpcy5HZXR0ZXJCeUJpbmRpbmdUeXBlWyBiaW5kaW5nVHlwZSBdOwoJCXRoaXMuc2V0VmFsdWUgPSB0aGlzLlNldHRlckJ5QmluZGluZ1R5cGVBbmRWZXJzaW9uaW5nWyBiaW5kaW5nVHlwZSBdWyB2ZXJzaW9uaW5nIF07CgoJfQoKCXVuYmluZCgpIHsKCgkJdGhpcy5ub2RlID0gbnVsbDsKCgkJLy8gYmFjayB0byB0aGUgcHJvdG90eXBlIHZlcnNpb24gb2YgZ2V0VmFsdWUgLyBzZXRWYWx1ZQoJCS8vIG5vdGU6IGF2b2lkaW5nIHRvIG11dGF0ZSB0aGUgc2hhcGUgb2YgJ3RoaXMnIHZpYSAnZGVsZXRlJwoJCXRoaXMuZ2V0VmFsdWUgPSB0aGlzLl9nZXRWYWx1ZV91bmJvdW5kOwoJCXRoaXMuc2V0VmFsdWUgPSB0aGlzLl9zZXRWYWx1ZV91bmJvdW5kOwoKCX0KCn0KClByb3BlcnR5QmluZGluZy5Db21wb3NpdGUgPSBDb21wb3NpdGU7CgpQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLkJpbmRpbmdUeXBlID0gewoJRGlyZWN0OiAwLAoJRW50aXJlQXJyYXk6IDEsCglBcnJheUVsZW1lbnQ6IDIsCglIYXNGcm9tVG9BcnJheTogMwp9OwoKUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5WZXJzaW9uaW5nID0gewoJTm9uZTogMCwKCU5lZWRzVXBkYXRlOiAxLAoJTWF0cml4V29ybGROZWVkc1VwZGF0ZTogMgp9OwoKUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5HZXR0ZXJCeUJpbmRpbmdUeXBlID0gWwoKCVByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX2dldFZhbHVlX2RpcmVjdCwKCVByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX2dldFZhbHVlX2FycmF5LAoJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fZ2V0VmFsdWVfYXJyYXlFbGVtZW50LAoJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fZ2V0VmFsdWVfdG9BcnJheSwKCl07CgpQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLlNldHRlckJ5QmluZGluZ1R5cGVBbmRWZXJzaW9uaW5nID0gWwoKCVsKCQkvLyBEaXJlY3QKCQlQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9kaXJlY3QsCgkJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfZGlyZWN0X3NldE5lZWRzVXBkYXRlLAoJCVByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2RpcmVjdF9zZXRNYXRyaXhXb3JsZE5lZWRzVXBkYXRlLAoKCV0sIFsKCgkJLy8gRW50aXJlQXJyYXkKCgkJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfYXJyYXksCgkJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfYXJyYXlfc2V0TmVlZHNVcGRhdGUsCgkJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfYXJyYXlfc2V0TWF0cml4V29ybGROZWVkc1VwZGF0ZSwKCgldLCBbCgoJCS8vIEFycmF5RWxlbWVudAoJCVByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2FycmF5RWxlbWVudCwKCQlQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9hcnJheUVsZW1lbnRfc2V0TmVlZHNVcGRhdGUsCgkJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfYXJyYXlFbGVtZW50X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUsCgoJXSwgWwoKCQkvLyBIYXNUb0Zyb21BcnJheQoJCVByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2Zyb21BcnJheSwKCQlQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9mcm9tQXJyYXlfc2V0TmVlZHNVcGRhdGUsCgkJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfZnJvbUFycmF5X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUsCgoJXQoKXTsKCi8qKgogKgogKiBBIGdyb3VwIG9mIG9iamVjdHMgdGhhdCByZWNlaXZlcyBhIHNoYXJlZCBhbmltYXRpb24gc3RhdGUuCiAqCiAqIFVzYWdlOgogKgogKiAgLSBBZGQgb2JqZWN0cyB5b3Ugd291bGQgb3RoZXJ3aXNlIHBhc3MgYXMgJ3Jvb3QnIHRvIHRoZQogKiAgICBjb25zdHJ1Y3RvciBvciB0aGUgLmNsaXBBY3Rpb24gbWV0aG9kIG9mIEFuaW1hdGlvbk1peGVyLgogKgogKiAgLSBJbnN0ZWFkIHBhc3MgdGhpcyBvYmplY3QgYXMgJ3Jvb3QnLgogKgogKiAgLSBZb3UgY2FuIGFsc28gYWRkIGFuZCByZW1vdmUgb2JqZWN0cyBsYXRlciB3aGVuIHRoZSBtaXhlcgogKiAgICBpcyBydW5uaW5nLgogKgogKiBOb3RlOgogKgogKiAgICBPYmplY3RzIG9mIHRoaXMgY2xhc3MgYXBwZWFyIGFzIG9uZSBvYmplY3QgdG8gdGhlIG1peGVyLAogKiAgICBzbyBjYWNoZSBjb250cm9sIG9mIHRoZSBpbmRpdmlkdWFsIG9iamVjdHMgbXVzdCBiZSBkb25lCiAqICAgIG9uIHRoZSBncm91cC4KICoKICogTGltaXRhdGlvbjoKICoKICogIC0gVGhlIGFuaW1hdGVkIHByb3BlcnRpZXMgbXVzdCBiZSBjb21wYXRpYmxlIGFtb25nIHRoZQogKiAgICBhbGwgb2JqZWN0cyBpbiB0aGUgZ3JvdXAuCiAqCiAqICAtIEEgc2luZ2xlIHByb3BlcnR5IGNhbiBlaXRoZXIgYmUgY29udHJvbGxlZCB0aHJvdWdoIGEKICogICAgdGFyZ2V0IGdyb3VwIG9yIGRpcmVjdGx5LCBidXQgbm90IGJvdGguCiAqLwoKY2xhc3MgQW5pbWF0aW9uT2JqZWN0R3JvdXAgewoKCWNvbnN0cnVjdG9yKCkgewoKCQl0aGlzLmlzQW5pbWF0aW9uT2JqZWN0R3JvdXAgPSB0cnVlOwoKCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJLy8gY2FjaGVkIG9iamVjdHMgZm9sbG93ZWQgYnkgdGhlIGFjdGl2ZSBvbmVzCgkJdGhpcy5fb2JqZWN0cyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBhcmd1bWVudHMgKTsKCgkJdGhpcy5uQ2FjaGVkT2JqZWN0c18gPSAwOyAvLyB0aHJlc2hvbGQKCQkvLyBub3RlOiByZWFkIGJ5IFByb3BlcnR5QmluZGluZy5Db21wb3NpdGUKCgkJY29uc3QgaW5kaWNlcyA9IHt9OwoJCXRoaXMuX2luZGljZXNCeVVVSUQgPSBpbmRpY2VzOyAvLyBmb3IgYm9va2tlZXBpbmcKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWluZGljZXNbIGFyZ3VtZW50c1sgaSBdLnV1aWQgXSA9IGk7CgoJCX0KCgkJdGhpcy5fcGF0aHMgPSBbXTsgLy8gaW5zaWRlOiBzdHJpbmcKCQl0aGlzLl9wYXJzZWRQYXRocyA9IFtdOyAvLyBpbnNpZGU6IHsgd2UgZG9uJ3QgY2FyZSwgaGVyZSB9CgkJdGhpcy5fYmluZGluZ3MgPSBbXTsgLy8gaW5zaWRlOiBBcnJheTwgUHJvcGVydHlCaW5kaW5nID4KCQl0aGlzLl9iaW5kaW5nc0luZGljZXNCeVBhdGggPSB7fTsgLy8gaW5zaWRlOiBpbmRpY2VzIGluIHRoZXNlIGFycmF5cwoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCXRoaXMuc3RhdHMgPSB7CgoJCQlvYmplY3RzOiB7CgkJCQlnZXQgdG90YWwoKSB7CgoJCQkJCXJldHVybiBzY29wZS5fb2JqZWN0cy5sZW5ndGg7CgoJCQkJfSwKCQkJCWdldCBpblVzZSgpIHsKCgkJCQkJcmV0dXJuIHRoaXMudG90YWwgLSBzY29wZS5uQ2FjaGVkT2JqZWN0c187CgoJCQkJfQoJCQl9LAoJCQlnZXQgYmluZGluZ3NQZXJPYmplY3QoKSB7CgoJCQkJcmV0dXJuIHNjb3BlLl9iaW5kaW5ncy5sZW5ndGg7CgoJCQl9CgoJCX07CgoJfQoKCWFkZCgpIHsKCgkJY29uc3Qgb2JqZWN0cyA9IHRoaXMuX29iamVjdHMsCgkJCWluZGljZXNCeVVVSUQgPSB0aGlzLl9pbmRpY2VzQnlVVUlELAoJCQlwYXRocyA9IHRoaXMuX3BhdGhzLAoJCQlwYXJzZWRQYXRocyA9IHRoaXMuX3BhcnNlZFBhdGhzLAoJCQliaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQluQmluZGluZ3MgPSBiaW5kaW5ncy5sZW5ndGg7CgoJCWxldCBrbm93bk9iamVjdCA9IHVuZGVmaW5lZCwKCQkJbk9iamVjdHMgPSBvYmplY3RzLmxlbmd0aCwKCQkJbkNhY2hlZE9iamVjdHMgPSB0aGlzLm5DYWNoZWRPYmplY3RzXzsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWNvbnN0IG9iamVjdCA9IGFyZ3VtZW50c1sgaSBdLAoJCQkJdXVpZCA9IG9iamVjdC51dWlkOwoJCQlsZXQgaW5kZXggPSBpbmRpY2VzQnlVVUlEWyB1dWlkIF07CgoJCQlpZiAoIGluZGV4ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJLy8gdW5rbm93biBvYmplY3QgLT4gYWRkIGl0IHRvIHRoZSBBQ1RJVkUgcmVnaW9uCgoJCQkJaW5kZXggPSBuT2JqZWN0cyArKzsKCQkJCWluZGljZXNCeVVVSURbIHV1aWQgXSA9IGluZGV4OwoJCQkJb2JqZWN0cy5wdXNoKCBvYmplY3QgKTsKCgkJCQkvLyBhY2NvdW50aW5nIGlzIGRvbmUsIG5vdyBkbyB0aGUgc2FtZSBmb3IgYWxsIGJpbmRpbmdzCgoJCQkJZm9yICggbGV0IGogPSAwLCBtID0gbkJpbmRpbmdzOyBqICE9PSBtOyArKyBqICkgewoKCQkJCQliaW5kaW5nc1sgaiBdLnB1c2goIG5ldyBQcm9wZXJ0eUJpbmRpbmcoIG9iamVjdCwgcGF0aHNbIGogXSwgcGFyc2VkUGF0aHNbIGogXSApICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggaW5kZXggPCBuQ2FjaGVkT2JqZWN0cyApIHsKCgkJCQlrbm93bk9iamVjdCA9IG9iamVjdHNbIGluZGV4IF07CgoJCQkJLy8gbW92ZSBleGlzdGluZyBvYmplY3QgdG8gdGhlIEFDVElWRSByZWdpb24KCgkJCQljb25zdCBmaXJzdEFjdGl2ZUluZGV4ID0gLS0gbkNhY2hlZE9iamVjdHMsCgkJCQkJbGFzdENhY2hlZE9iamVjdCA9IG9iamVjdHNbIGZpcnN0QWN0aXZlSW5kZXggXTsKCgkJCQlpbmRpY2VzQnlVVUlEWyBsYXN0Q2FjaGVkT2JqZWN0LnV1aWQgXSA9IGluZGV4OwoJCQkJb2JqZWN0c1sgaW5kZXggXSA9IGxhc3RDYWNoZWRPYmplY3Q7CgoJCQkJaW5kaWNlc0J5VVVJRFsgdXVpZCBdID0gZmlyc3RBY3RpdmVJbmRleDsKCQkJCW9iamVjdHNbIGZpcnN0QWN0aXZlSW5kZXggXSA9IG9iamVjdDsKCgkJCQkvLyBhY2NvdW50aW5nIGlzIGRvbmUsIG5vdyBkbyB0aGUgc2FtZSBmb3IgYWxsIGJpbmRpbmdzCgoJCQkJZm9yICggbGV0IGogPSAwLCBtID0gbkJpbmRpbmdzOyBqICE9PSBtOyArKyBqICkgewoKCQkJCQljb25zdCBiaW5kaW5nc0ZvclBhdGggPSBiaW5kaW5nc1sgaiBdLAoJCQkJCQlsYXN0Q2FjaGVkID0gYmluZGluZ3NGb3JQYXRoWyBmaXJzdEFjdGl2ZUluZGV4IF07CgoJCQkJCWxldCBiaW5kaW5nID0gYmluZGluZ3NGb3JQYXRoWyBpbmRleCBdOwoKCQkJCQliaW5kaW5nc0ZvclBhdGhbIGluZGV4IF0gPSBsYXN0Q2FjaGVkOwoKCQkJCQlpZiAoIGJpbmRpbmcgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCS8vIHNpbmNlIHdlIGRvIG5vdCBib3RoZXIgdG8gY3JlYXRlIG5ldyBiaW5kaW5ncwoJCQkJCQkvLyBmb3Igb2JqZWN0cyB0aGF0IGFyZSBjYWNoZWQsIHRoZSBiaW5kaW5nIG1heQoJCQkJCQkvLyBvciBtYXkgbm90IGV4aXN0CgoJCQkJCQliaW5kaW5nID0gbmV3IFByb3BlcnR5QmluZGluZyggb2JqZWN0LCBwYXRoc1sgaiBdLCBwYXJzZWRQYXRoc1sgaiBdICk7CgoJCQkJCX0KCgkJCQkJYmluZGluZ3NGb3JQYXRoWyBmaXJzdEFjdGl2ZUluZGV4IF0gPSBiaW5kaW5nOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIG9iamVjdHNbIGluZGV4IF0gIT09IGtub3duT2JqZWN0ICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5BbmltYXRpb25PYmplY3RHcm91cDogRGlmZmVyZW50IG9iamVjdHMgd2l0aCB0aGUgc2FtZSBVVUlEICcgKwoJCQkJCSdkZXRlY3RlZC4gQ2xlYW4gdGhlIGNhY2hlcyBvciByZWNyZWF0ZSB5b3VyIGluZnJhc3RydWN0dXJlIHdoZW4gcmVsb2FkaW5nIHNjZW5lcy4nICk7CgoJCQl9IC8vIGVsc2UgdGhlIG9iamVjdCBpcyBhbHJlYWR5IHdoZXJlIHdlIHdhbnQgaXQgdG8gYmUKCgkJfSAvLyBmb3IgYXJndW1lbnRzCgoJCXRoaXMubkNhY2hlZE9iamVjdHNfID0gbkNhY2hlZE9iamVjdHM7CgoJfQoKCXJlbW92ZSgpIHsKCgkJY29uc3Qgb2JqZWN0cyA9IHRoaXMuX29iamVjdHMsCgkJCWluZGljZXNCeVVVSUQgPSB0aGlzLl9pbmRpY2VzQnlVVUlELAoJCQliaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQluQmluZGluZ3MgPSBiaW5kaW5ncy5sZW5ndGg7CgoJCWxldCBuQ2FjaGVkT2JqZWN0cyA9IHRoaXMubkNhY2hlZE9iamVjdHNfOwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJY29uc3Qgb2JqZWN0ID0gYXJndW1lbnRzWyBpIF0sCgkJCQl1dWlkID0gb2JqZWN0LnV1aWQsCgkJCQlpbmRleCA9IGluZGljZXNCeVVVSURbIHV1aWQgXTsKCgkJCWlmICggaW5kZXggIT09IHVuZGVmaW5lZCAmJiBpbmRleCA+PSBuQ2FjaGVkT2JqZWN0cyApIHsKCgkJCQkvLyBtb3ZlIGV4aXN0aW5nIG9iamVjdCBpbnRvIHRoZSBDQUNIRUQgcmVnaW9uCgoJCQkJY29uc3QgbGFzdENhY2hlZEluZGV4ID0gbkNhY2hlZE9iamVjdHMgKyssCgkJCQkJZmlyc3RBY3RpdmVPYmplY3QgPSBvYmplY3RzWyBsYXN0Q2FjaGVkSW5kZXggXTsKCgkJCQlpbmRpY2VzQnlVVUlEWyBmaXJzdEFjdGl2ZU9iamVjdC51dWlkIF0gPSBpbmRleDsKCQkJCW9iamVjdHNbIGluZGV4IF0gPSBmaXJzdEFjdGl2ZU9iamVjdDsKCgkJCQlpbmRpY2VzQnlVVUlEWyB1dWlkIF0gPSBsYXN0Q2FjaGVkSW5kZXg7CgkJCQlvYmplY3RzWyBsYXN0Q2FjaGVkSW5kZXggXSA9IG9iamVjdDsKCgkJCQkvLyBhY2NvdW50aW5nIGlzIGRvbmUsIG5vdyBkbyB0aGUgc2FtZSBmb3IgYWxsIGJpbmRpbmdzCgoJCQkJZm9yICggbGV0IGogPSAwLCBtID0gbkJpbmRpbmdzOyBqICE9PSBtOyArKyBqICkgewoKCQkJCQljb25zdCBiaW5kaW5nc0ZvclBhdGggPSBiaW5kaW5nc1sgaiBdLAoJCQkJCQlmaXJzdEFjdGl2ZSA9IGJpbmRpbmdzRm9yUGF0aFsgbGFzdENhY2hlZEluZGV4IF0sCgkJCQkJCWJpbmRpbmcgPSBiaW5kaW5nc0ZvclBhdGhbIGluZGV4IF07CgoJCQkJCWJpbmRpbmdzRm9yUGF0aFsgaW5kZXggXSA9IGZpcnN0QWN0aXZlOwoJCQkJCWJpbmRpbmdzRm9yUGF0aFsgbGFzdENhY2hlZEluZGV4IF0gPSBiaW5kaW5nOwoKCQkJCX0KCgkJCX0KCgkJfSAvLyBmb3IgYXJndW1lbnRzCgoJCXRoaXMubkNhY2hlZE9iamVjdHNfID0gbkNhY2hlZE9iamVjdHM7CgoJfQoKCS8vIHJlbW92ZSAmIGZvcmdldAoJdW5jYWNoZSgpIHsKCgkJY29uc3Qgb2JqZWN0cyA9IHRoaXMuX29iamVjdHMsCgkJCWluZGljZXNCeVVVSUQgPSB0aGlzLl9pbmRpY2VzQnlVVUlELAoJCQliaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQluQmluZGluZ3MgPSBiaW5kaW5ncy5sZW5ndGg7CgoJCWxldCBuQ2FjaGVkT2JqZWN0cyA9IHRoaXMubkNhY2hlZE9iamVjdHNfLAoJCQluT2JqZWN0cyA9IG9iamVjdHMubGVuZ3RoOwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJY29uc3Qgb2JqZWN0ID0gYXJndW1lbnRzWyBpIF0sCgkJCQl1dWlkID0gb2JqZWN0LnV1aWQsCgkJCQlpbmRleCA9IGluZGljZXNCeVVVSURbIHV1aWQgXTsKCgkJCWlmICggaW5kZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCQlkZWxldGUgaW5kaWNlc0J5VVVJRFsgdXVpZCBdOwoKCQkJCWlmICggaW5kZXggPCBuQ2FjaGVkT2JqZWN0cyApIHsKCgkJCQkJLy8gb2JqZWN0IGlzIGNhY2hlZCwgc2hyaW5rIHRoZSBDQUNIRUQgcmVnaW9uCgoJCQkJCWNvbnN0IGZpcnN0QWN0aXZlSW5kZXggPSAtLSBuQ2FjaGVkT2JqZWN0cywKCQkJCQkJbGFzdENhY2hlZE9iamVjdCA9IG9iamVjdHNbIGZpcnN0QWN0aXZlSW5kZXggXSwKCQkJCQkJbGFzdEluZGV4ID0gLS0gbk9iamVjdHMsCgkJCQkJCWxhc3RPYmplY3QgPSBvYmplY3RzWyBsYXN0SW5kZXggXTsKCgkJCQkJLy8gbGFzdCBjYWNoZWQgb2JqZWN0IHRha2VzIHRoaXMgb2JqZWN0J3MgcGxhY2UKCQkJCQlpbmRpY2VzQnlVVUlEWyBsYXN0Q2FjaGVkT2JqZWN0LnV1aWQgXSA9IGluZGV4OwoJCQkJCW9iamVjdHNbIGluZGV4IF0gPSBsYXN0Q2FjaGVkT2JqZWN0OwoKCQkJCQkvLyBsYXN0IG9iamVjdCBnb2VzIHRvIHRoZSBhY3RpdmF0ZWQgc2xvdCBhbmQgcG9wCgkJCQkJaW5kaWNlc0J5VVVJRFsgbGFzdE9iamVjdC51dWlkIF0gPSBmaXJzdEFjdGl2ZUluZGV4OwoJCQkJCW9iamVjdHNbIGZpcnN0QWN0aXZlSW5kZXggXSA9IGxhc3RPYmplY3Q7CgkJCQkJb2JqZWN0cy5wb3AoKTsKCgkJCQkJLy8gYWNjb3VudGluZyBpcyBkb25lLCBub3cgZG8gdGhlIHNhbWUgZm9yIGFsbCBiaW5kaW5ncwoKCQkJCQlmb3IgKCBsZXQgaiA9IDAsIG0gPSBuQmluZGluZ3M7IGogIT09IG07ICsrIGogKSB7CgoJCQkJCQljb25zdCBiaW5kaW5nc0ZvclBhdGggPSBiaW5kaW5nc1sgaiBdLAoJCQkJCQkJbGFzdENhY2hlZCA9IGJpbmRpbmdzRm9yUGF0aFsgZmlyc3RBY3RpdmVJbmRleCBdLAoJCQkJCQkJbGFzdCA9IGJpbmRpbmdzRm9yUGF0aFsgbGFzdEluZGV4IF07CgoJCQkJCQliaW5kaW5nc0ZvclBhdGhbIGluZGV4IF0gPSBsYXN0Q2FjaGVkOwoJCQkJCQliaW5kaW5nc0ZvclBhdGhbIGZpcnN0QWN0aXZlSW5kZXggXSA9IGxhc3Q7CgkJCQkJCWJpbmRpbmdzRm9yUGF0aC5wb3AoKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIG9iamVjdCBpcyBhY3RpdmUsIGp1c3Qgc3dhcCB3aXRoIHRoZSBsYXN0IGFuZCBwb3AKCgkJCQkJY29uc3QgbGFzdEluZGV4ID0gLS0gbk9iamVjdHMsCgkJCQkJCWxhc3RPYmplY3QgPSBvYmplY3RzWyBsYXN0SW5kZXggXTsKCgkJCQkJaWYgKCBsYXN0SW5kZXggPiAwICkgewoKCQkJCQkJaW5kaWNlc0J5VVVJRFsgbGFzdE9iamVjdC51dWlkIF0gPSBpbmRleDsKCgkJCQkJfQoKCQkJCQlvYmplY3RzWyBpbmRleCBdID0gbGFzdE9iamVjdDsKCQkJCQlvYmplY3RzLnBvcCgpOwoKCQkJCQkvLyBhY2NvdW50aW5nIGlzIGRvbmUsIG5vdyBkbyB0aGUgc2FtZSBmb3IgYWxsIGJpbmRpbmdzCgoJCQkJCWZvciAoIGxldCBqID0gMCwgbSA9IG5CaW5kaW5nczsgaiAhPT0gbTsgKysgaiApIHsKCgkJCQkJCWNvbnN0IGJpbmRpbmdzRm9yUGF0aCA9IGJpbmRpbmdzWyBqIF07CgoJCQkJCQliaW5kaW5nc0ZvclBhdGhbIGluZGV4IF0gPSBiaW5kaW5nc0ZvclBhdGhbIGxhc3RJbmRleCBdOwoJCQkJCQliaW5kaW5nc0ZvclBhdGgucG9wKCk7CgoJCQkJCX0KCgkJCQl9IC8vIGNhY2hlZCBvciBhY3RpdmUKCgkJCX0gLy8gaWYgb2JqZWN0IGlzIGtub3duCgoJCX0gLy8gZm9yIGFyZ3VtZW50cwoKCQl0aGlzLm5DYWNoZWRPYmplY3RzXyA9IG5DYWNoZWRPYmplY3RzOwoKCX0KCgkvLyBJbnRlcm5hbCBpbnRlcmZhY2UgdXNlZCBieSBiZWZyaWVuZGVkIFByb3BlcnR5QmluZGluZy5Db21wb3NpdGU6CgoJc3Vic2NyaWJlXyggcGF0aCwgcGFyc2VkUGF0aCApIHsKCgkJLy8gcmV0dXJucyBhbiBhcnJheSBvZiBiaW5kaW5ncyBmb3IgdGhlIGdpdmVuIHBhdGggdGhhdCBpcyBjaGFuZ2VkCgkJLy8gYWNjb3JkaW5nIHRvIHRoZSBjb250YWluZWQgb2JqZWN0cyBpbiB0aGUgZ3JvdXAKCgkJY29uc3QgaW5kaWNlc0J5UGF0aCA9IHRoaXMuX2JpbmRpbmdzSW5kaWNlc0J5UGF0aDsKCQlsZXQgaW5kZXggPSBpbmRpY2VzQnlQYXRoWyBwYXRoIF07CgkJY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5nczsKCgkJaWYgKCBpbmRleCAhPT0gdW5kZWZpbmVkICkgcmV0dXJuIGJpbmRpbmdzWyBpbmRleCBdOwoKCQljb25zdCBwYXRocyA9IHRoaXMuX3BhdGhzLAoJCQlwYXJzZWRQYXRocyA9IHRoaXMuX3BhcnNlZFBhdGhzLAoJCQlvYmplY3RzID0gdGhpcy5fb2JqZWN0cywKCQkJbk9iamVjdHMgPSBvYmplY3RzLmxlbmd0aCwKCQkJbkNhY2hlZE9iamVjdHMgPSB0aGlzLm5DYWNoZWRPYmplY3RzXywKCQkJYmluZGluZ3NGb3JQYXRoID0gbmV3IEFycmF5KCBuT2JqZWN0cyApOwoKCQlpbmRleCA9IGJpbmRpbmdzLmxlbmd0aDsKCgkJaW5kaWNlc0J5UGF0aFsgcGF0aCBdID0gaW5kZXg7CgoJCXBhdGhzLnB1c2goIHBhdGggKTsKCQlwYXJzZWRQYXRocy5wdXNoKCBwYXJzZWRQYXRoICk7CgkJYmluZGluZ3MucHVzaCggYmluZGluZ3NGb3JQYXRoICk7CgoJCWZvciAoIGxldCBpID0gbkNhY2hlZE9iamVjdHMsIG4gPSBvYmplY3RzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWNvbnN0IG9iamVjdCA9IG9iamVjdHNbIGkgXTsKCQkJYmluZGluZ3NGb3JQYXRoWyBpIF0gPSBuZXcgUHJvcGVydHlCaW5kaW5nKCBvYmplY3QsIHBhdGgsIHBhcnNlZFBhdGggKTsKCgkJfQoKCQlyZXR1cm4gYmluZGluZ3NGb3JQYXRoOwoKCX0KCgl1bnN1YnNjcmliZV8oIHBhdGggKSB7CgoJCS8vIHRlbGxzIHRoZSBncm91cCB0byBmb3JnZXQgYWJvdXQgYSBwcm9wZXJ0eSBwYXRoIGFuZCBubyBsb25nZXIKCQkvLyB1cGRhdGUgdGhlIGFycmF5IHByZXZpb3VzbHkgb2J0YWluZWQgd2l0aCAnc3Vic2NyaWJlXycKCgkJY29uc3QgaW5kaWNlc0J5UGF0aCA9IHRoaXMuX2JpbmRpbmdzSW5kaWNlc0J5UGF0aCwKCQkJaW5kZXggPSBpbmRpY2VzQnlQYXRoWyBwYXRoIF07CgoJCWlmICggaW5kZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IHBhdGhzID0gdGhpcy5fcGF0aHMsCgkJCQlwYXJzZWRQYXRocyA9IHRoaXMuX3BhcnNlZFBhdGhzLAoJCQkJYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywKCQkJCWxhc3RCaW5kaW5nc0luZGV4ID0gYmluZGluZ3MubGVuZ3RoIC0gMSwKCQkJCWxhc3RCaW5kaW5ncyA9IGJpbmRpbmdzWyBsYXN0QmluZGluZ3NJbmRleCBdLAoJCQkJbGFzdEJpbmRpbmdzUGF0aCA9IHBhdGhbIGxhc3RCaW5kaW5nc0luZGV4IF07CgoJCQlpbmRpY2VzQnlQYXRoWyBsYXN0QmluZGluZ3NQYXRoIF0gPSBpbmRleDsKCgkJCWJpbmRpbmdzWyBpbmRleCBdID0gbGFzdEJpbmRpbmdzOwoJCQliaW5kaW5ncy5wb3AoKTsKCgkJCXBhcnNlZFBhdGhzWyBpbmRleCBdID0gcGFyc2VkUGF0aHNbIGxhc3RCaW5kaW5nc0luZGV4IF07CgkJCXBhcnNlZFBhdGhzLnBvcCgpOwoKCQkJcGF0aHNbIGluZGV4IF0gPSBwYXRoc1sgbGFzdEJpbmRpbmdzSW5kZXggXTsKCQkJcGF0aHMucG9wKCk7CgoJCX0KCgl9Cgp9CgpjbGFzcyBBbmltYXRpb25BY3Rpb24gewoKCWNvbnN0cnVjdG9yKCBtaXhlciwgY2xpcCwgbG9jYWxSb290ID0gbnVsbCwgYmxlbmRNb2RlID0gY2xpcC5ibGVuZE1vZGUgKSB7CgoJCXRoaXMuX21peGVyID0gbWl4ZXI7CgkJdGhpcy5fY2xpcCA9IGNsaXA7CgkJdGhpcy5fbG9jYWxSb290ID0gbG9jYWxSb290OwoJCXRoaXMuYmxlbmRNb2RlID0gYmxlbmRNb2RlOwoKCQljb25zdCB0cmFja3MgPSBjbGlwLnRyYWNrcywKCQkJblRyYWNrcyA9IHRyYWNrcy5sZW5ndGgsCgkJCWludGVycG9sYW50cyA9IG5ldyBBcnJheSggblRyYWNrcyApOwoKCQljb25zdCBpbnRlcnBvbGFudFNldHRpbmdzID0gewoJCQllbmRpbmdTdGFydDogWmVyb0N1cnZhdHVyZUVuZGluZywKCQkJZW5kaW5nRW5kOiBaZXJvQ3VydmF0dXJlRW5kaW5nCgkJfTsKCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuVHJhY2tzOyArKyBpICkgewoKCQkJY29uc3QgaW50ZXJwb2xhbnQgPSB0cmFja3NbIGkgXS5jcmVhdGVJbnRlcnBvbGFudCggbnVsbCApOwoJCQlpbnRlcnBvbGFudHNbIGkgXSA9IGludGVycG9sYW50OwoJCQlpbnRlcnBvbGFudC5zZXR0aW5ncyA9IGludGVycG9sYW50U2V0dGluZ3M7CgoJCX0KCgkJdGhpcy5faW50ZXJwb2xhbnRTZXR0aW5ncyA9IGludGVycG9sYW50U2V0dGluZ3M7CgoJCXRoaXMuX2ludGVycG9sYW50cyA9IGludGVycG9sYW50czsgLy8gYm91bmQgYnkgdGhlIG1peGVyCgoJCS8vIGluc2lkZTogUHJvcGVydHlNaXhlciAobWFuYWdlZCBieSB0aGUgbWl4ZXIpCgkJdGhpcy5fcHJvcGVydHlCaW5kaW5ncyA9IG5ldyBBcnJheSggblRyYWNrcyApOwoKCQl0aGlzLl9jYWNoZUluZGV4ID0gbnVsbDsgLy8gZm9yIHRoZSBtZW1vcnkgbWFuYWdlcgoJCXRoaXMuX2J5Q2xpcENhY2hlSW5kZXggPSBudWxsOyAvLyBmb3IgdGhlIG1lbW9yeSBtYW5hZ2VyCgoJCXRoaXMuX3RpbWVTY2FsZUludGVycG9sYW50ID0gbnVsbDsKCQl0aGlzLl93ZWlnaHRJbnRlcnBvbGFudCA9IG51bGw7CgoJCXRoaXMubG9vcCA9IExvb3BSZXBlYXQ7CgkJdGhpcy5fbG9vcENvdW50ID0gLSAxOwoKCQkvLyBnbG9iYWwgbWl4ZXIgdGltZSB3aGVuIHRoZSBhY3Rpb24gaXMgdG8gYmUgc3RhcnRlZAoJCS8vIGl0J3Mgc2V0IGJhY2sgdG8gJ251bGwnIHVwb24gc3RhcnQgb2YgdGhlIGFjdGlvbgoJCXRoaXMuX3N0YXJ0VGltZSA9IG51bGw7CgoJCS8vIHNjYWxlZCBsb2NhbCB0aW1lIG9mIHRoZSBhY3Rpb24KCQkvLyBnZXRzIGNsYW1wZWQgb3Igd3JhcHBlZCB0byAwLi5jbGlwLmR1cmF0aW9uIGFjY29yZGluZyB0byBsb29wCgkJdGhpcy50aW1lID0gMDsKCgkJdGhpcy50aW1lU2NhbGUgPSAxOwoJCXRoaXMuX2VmZmVjdGl2ZVRpbWVTY2FsZSA9IDE7CgoJCXRoaXMud2VpZ2h0ID0gMTsKCQl0aGlzLl9lZmZlY3RpdmVXZWlnaHQgPSAxOwoKCQl0aGlzLnJlcGV0aXRpb25zID0gSW5maW5pdHk7IC8vIG5vLiBvZiByZXBldGl0aW9ucyB3aGVuIGxvb3BpbmcKCgkJdGhpcy5wYXVzZWQgPSBmYWxzZTsgLy8gdHJ1ZSAtPiB6ZXJvIGVmZmVjdGl2ZSB0aW1lIHNjYWxlCgkJdGhpcy5lbmFibGVkID0gdHJ1ZTsgLy8gZmFsc2UgLT4gemVybyBlZmZlY3RpdmUgd2VpZ2h0CgoJCXRoaXMuY2xhbXBXaGVuRmluaXNoZWQgPSBmYWxzZTsvLyBrZWVwIGZlZWRpbmcgdGhlIGxhc3QgZnJhbWU/CgoJCXRoaXMuemVyb1Nsb3BlQXRTdGFydCA9IHRydWU7Ly8gZm9yIHNtb290aCBpbnRlcnBvbGF0aW9uIHcvbyBzZXBhcmF0ZQoJCXRoaXMuemVyb1Nsb3BlQXRFbmQgPSB0cnVlOy8vIGNsaXBzIGZvciBzdGFydCwgbG9vcCBhbmQgZW5kCgoJfQoKCS8vIFN0YXRlICYgU2NoZWR1bGluZwoKCXBsYXkoKSB7CgoJCXRoaXMuX21peGVyLl9hY3RpdmF0ZUFjdGlvbiggdGhpcyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RvcCgpIHsKCgkJdGhpcy5fbWl4ZXIuX2RlYWN0aXZhdGVBY3Rpb24oIHRoaXMgKTsKCgkJcmV0dXJuIHRoaXMucmVzZXQoKTsKCgl9CgoJcmVzZXQoKSB7CgoJCXRoaXMucGF1c2VkID0gZmFsc2U7CgkJdGhpcy5lbmFibGVkID0gdHJ1ZTsKCgkJdGhpcy50aW1lID0gMDsgLy8gcmVzdGFydCBjbGlwCgkJdGhpcy5fbG9vcENvdW50ID0gLSAxOy8vIGZvcmdldCBwcmV2aW91cyBsb29wcwoJCXRoaXMuX3N0YXJ0VGltZSA9IG51bGw7Ly8gZm9yZ2V0IHNjaGVkdWxpbmcKCgkJcmV0dXJuIHRoaXMuc3RvcEZhZGluZygpLnN0b3BXYXJwaW5nKCk7CgoJfQoKCWlzUnVubmluZygpIHsKCgkJcmV0dXJuIHRoaXMuZW5hYmxlZCAmJiAhIHRoaXMucGF1c2VkICYmIHRoaXMudGltZVNjYWxlICE9PSAwICYmCgkJCXRoaXMuX3N0YXJ0VGltZSA9PT0gbnVsbCAmJiB0aGlzLl9taXhlci5faXNBY3RpdmVBY3Rpb24oIHRoaXMgKTsKCgl9CgoJLy8gcmV0dXJuIHRydWUgd2hlbiBwbGF5IGhhcyBiZWVuIGNhbGxlZAoJaXNTY2hlZHVsZWQoKSB7CgoJCXJldHVybiB0aGlzLl9taXhlci5faXNBY3RpdmVBY3Rpb24oIHRoaXMgKTsKCgl9CgoJc3RhcnRBdCggdGltZSApIHsKCgkJdGhpcy5fc3RhcnRUaW1lID0gdGltZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldExvb3AoIG1vZGUsIHJlcGV0aXRpb25zICkgewoKCQl0aGlzLmxvb3AgPSBtb2RlOwoJCXRoaXMucmVwZXRpdGlvbnMgPSByZXBldGl0aW9uczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vIFdlaWdodAoKCS8vIHNldCB0aGUgd2VpZ2h0IHN0b3BwaW5nIGFueSBzY2hlZHVsZWQgZmFkaW5nCgkvLyBhbHRob3VnaCAuZW5hYmxlZCA9IGZhbHNlIHlpZWxkcyBhbiBlZmZlY3RpdmUgd2VpZ2h0IG9mIHplcm8sIHRoaXMKCS8vIG1ldGhvZCBkb2VzICpub3QqIGNoYW5nZSAuZW5hYmxlZCwgYmVjYXVzZSBpdCB3b3VsZCBiZSBjb25mdXNpbmcKCXNldEVmZmVjdGl2ZVdlaWdodCggd2VpZ2h0ICkgewoKCQl0aGlzLndlaWdodCA9IHdlaWdodDsKCgkJLy8gbm90ZTogc2FtZSBsb2dpYyBhcyB3aGVuIHVwZGF0ZWQgYXQgcnVudGltZQoJCXRoaXMuX2VmZmVjdGl2ZVdlaWdodCA9IHRoaXMuZW5hYmxlZCA/IHdlaWdodCA6IDA7CgoJCXJldHVybiB0aGlzLnN0b3BGYWRpbmcoKTsKCgl9CgoJLy8gcmV0dXJuIHRoZSB3ZWlnaHQgY29uc2lkZXJpbmcgZmFkaW5nIGFuZCAuZW5hYmxlZAoJZ2V0RWZmZWN0aXZlV2VpZ2h0KCkgewoKCQlyZXR1cm4gdGhpcy5fZWZmZWN0aXZlV2VpZ2h0OwoKCX0KCglmYWRlSW4oIGR1cmF0aW9uICkgewoKCQlyZXR1cm4gdGhpcy5fc2NoZWR1bGVGYWRpbmcoIGR1cmF0aW9uLCAwLCAxICk7CgoJfQoKCWZhZGVPdXQoIGR1cmF0aW9uICkgewoKCQlyZXR1cm4gdGhpcy5fc2NoZWR1bGVGYWRpbmcoIGR1cmF0aW9uLCAxLCAwICk7CgoJfQoKCWNyb3NzRmFkZUZyb20oIGZhZGVPdXRBY3Rpb24sIGR1cmF0aW9uLCB3YXJwICkgewoKCQlmYWRlT3V0QWN0aW9uLmZhZGVPdXQoIGR1cmF0aW9uICk7CgkJdGhpcy5mYWRlSW4oIGR1cmF0aW9uICk7CgoJCWlmICggd2FycCApIHsKCgkJCWNvbnN0IGZhZGVJbkR1cmF0aW9uID0gdGhpcy5fY2xpcC5kdXJhdGlvbiwKCQkJCWZhZGVPdXREdXJhdGlvbiA9IGZhZGVPdXRBY3Rpb24uX2NsaXAuZHVyYXRpb24sCgoJCQkJc3RhcnRFbmRSYXRpbyA9IGZhZGVPdXREdXJhdGlvbiAvIGZhZGVJbkR1cmF0aW9uLAoJCQkJZW5kU3RhcnRSYXRpbyA9IGZhZGVJbkR1cmF0aW9uIC8gZmFkZU91dER1cmF0aW9uOwoKCQkJZmFkZU91dEFjdGlvbi53YXJwKCAxLjAsIHN0YXJ0RW5kUmF0aW8sIGR1cmF0aW9uICk7CgkJCXRoaXMud2FycCggZW5kU3RhcnRSYXRpbywgMS4wLCBkdXJhdGlvbiApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgljcm9zc0ZhZGVUbyggZmFkZUluQWN0aW9uLCBkdXJhdGlvbiwgd2FycCApIHsKCgkJcmV0dXJuIGZhZGVJbkFjdGlvbi5jcm9zc0ZhZGVGcm9tKCB0aGlzLCBkdXJhdGlvbiwgd2FycCApOwoKCX0KCglzdG9wRmFkaW5nKCkgewoKCQljb25zdCB3ZWlnaHRJbnRlcnBvbGFudCA9IHRoaXMuX3dlaWdodEludGVycG9sYW50OwoKCQlpZiAoIHdlaWdodEludGVycG9sYW50ICE9PSBudWxsICkgewoKCQkJdGhpcy5fd2VpZ2h0SW50ZXJwb2xhbnQgPSBudWxsOwoJCQl0aGlzLl9taXhlci5fdGFrZUJhY2tDb250cm9sSW50ZXJwb2xhbnQoIHdlaWdodEludGVycG9sYW50ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vIFRpbWUgU2NhbGUgQ29udHJvbAoKCS8vIHNldCB0aGUgdGltZSBzY2FsZSBzdG9wcGluZyBhbnkgc2NoZWR1bGVkIHdhcnBpbmcKCS8vIGFsdGhvdWdoIC5wYXVzZWQgPSB0cnVlIHlpZWxkcyBhbiBlZmZlY3RpdmUgdGltZSBzY2FsZSBvZiB6ZXJvLCB0aGlzCgkvLyBtZXRob2QgZG9lcyAqbm90KiBjaGFuZ2UgLnBhdXNlZCwgYmVjYXVzZSBpdCB3b3VsZCBiZSBjb25mdXNpbmcKCXNldEVmZmVjdGl2ZVRpbWVTY2FsZSggdGltZVNjYWxlICkgewoKCQl0aGlzLnRpbWVTY2FsZSA9IHRpbWVTY2FsZTsKCQl0aGlzLl9lZmZlY3RpdmVUaW1lU2NhbGUgPSB0aGlzLnBhdXNlZCA/IDAgOiB0aW1lU2NhbGU7CgoJCXJldHVybiB0aGlzLnN0b3BXYXJwaW5nKCk7CgoJfQoKCS8vIHJldHVybiB0aGUgdGltZSBzY2FsZSBjb25zaWRlcmluZyB3YXJwaW5nIGFuZCAucGF1c2VkCglnZXRFZmZlY3RpdmVUaW1lU2NhbGUoKSB7CgoJCXJldHVybiB0aGlzLl9lZmZlY3RpdmVUaW1lU2NhbGU7CgoJfQoKCXNldER1cmF0aW9uKCBkdXJhdGlvbiApIHsKCgkJdGhpcy50aW1lU2NhbGUgPSB0aGlzLl9jbGlwLmR1cmF0aW9uIC8gZHVyYXRpb247CgoJCXJldHVybiB0aGlzLnN0b3BXYXJwaW5nKCk7CgoJfQoKCXN5bmNXaXRoKCBhY3Rpb24gKSB7CgoJCXRoaXMudGltZSA9IGFjdGlvbi50aW1lOwoJCXRoaXMudGltZVNjYWxlID0gYWN0aW9uLnRpbWVTY2FsZTsKCgkJcmV0dXJuIHRoaXMuc3RvcFdhcnBpbmcoKTsKCgl9CgoJaGFsdCggZHVyYXRpb24gKSB7CgoJCXJldHVybiB0aGlzLndhcnAoIHRoaXMuX2VmZmVjdGl2ZVRpbWVTY2FsZSwgMCwgZHVyYXRpb24gKTsKCgl9CgoJd2FycCggc3RhcnRUaW1lU2NhbGUsIGVuZFRpbWVTY2FsZSwgZHVyYXRpb24gKSB7CgoJCWNvbnN0IG1peGVyID0gdGhpcy5fbWl4ZXIsCgkJCW5vdyA9IG1peGVyLnRpbWUsCgkJCXRpbWVTY2FsZSA9IHRoaXMudGltZVNjYWxlOwoKCQlsZXQgaW50ZXJwb2xhbnQgPSB0aGlzLl90aW1lU2NhbGVJbnRlcnBvbGFudDsKCgkJaWYgKCBpbnRlcnBvbGFudCA9PT0gbnVsbCApIHsKCgkJCWludGVycG9sYW50ID0gbWl4ZXIuX2xlbmRDb250cm9sSW50ZXJwb2xhbnQoKTsKCQkJdGhpcy5fdGltZVNjYWxlSW50ZXJwb2xhbnQgPSBpbnRlcnBvbGFudDsKCgkJfQoKCQljb25zdCB0aW1lcyA9IGludGVycG9sYW50LnBhcmFtZXRlclBvc2l0aW9ucywKCQkJdmFsdWVzID0gaW50ZXJwb2xhbnQuc2FtcGxlVmFsdWVzOwoKCQl0aW1lc1sgMCBdID0gbm93OwoJCXRpbWVzWyAxIF0gPSBub3cgKyBkdXJhdGlvbjsKCgkJdmFsdWVzWyAwIF0gPSBzdGFydFRpbWVTY2FsZSAvIHRpbWVTY2FsZTsKCQl2YWx1ZXNbIDEgXSA9IGVuZFRpbWVTY2FsZSAvIHRpbWVTY2FsZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN0b3BXYXJwaW5nKCkgewoKCQljb25zdCB0aW1lU2NhbGVJbnRlcnBvbGFudCA9IHRoaXMuX3RpbWVTY2FsZUludGVycG9sYW50OwoKCQlpZiAoIHRpbWVTY2FsZUludGVycG9sYW50ICE9PSBudWxsICkgewoKCQkJdGhpcy5fdGltZVNjYWxlSW50ZXJwb2xhbnQgPSBudWxsOwoJCQl0aGlzLl9taXhlci5fdGFrZUJhY2tDb250cm9sSW50ZXJwb2xhbnQoIHRpbWVTY2FsZUludGVycG9sYW50ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vIE9iamVjdCBBY2Nlc3NvcnMKCglnZXRNaXhlcigpIHsKCgkJcmV0dXJuIHRoaXMuX21peGVyOwoKCX0KCglnZXRDbGlwKCkgewoKCQlyZXR1cm4gdGhpcy5fY2xpcDsKCgl9CgoJZ2V0Um9vdCgpIHsKCgkJcmV0dXJuIHRoaXMuX2xvY2FsUm9vdCB8fCB0aGlzLl9taXhlci5fcm9vdDsKCgl9CgoJLy8gSW50ZXJuYQoKCV91cGRhdGUoIHRpbWUsIGRlbHRhVGltZSwgdGltZURpcmVjdGlvbiwgYWNjdUluZGV4ICkgewoKCQkvLyBjYWxsZWQgYnkgdGhlIG1peGVyCgoJCWlmICggISB0aGlzLmVuYWJsZWQgKSB7CgoJCQkvLyBjYWxsIC5fdXBkYXRlV2VpZ2h0KCkgdG8gdXBkYXRlIC5fZWZmZWN0aXZlV2VpZ2h0CgoJCQl0aGlzLl91cGRhdGVXZWlnaHQoIHRpbWUgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCWNvbnN0IHN0YXJ0VGltZSA9IHRoaXMuX3N0YXJ0VGltZTsKCgkJaWYgKCBzdGFydFRpbWUgIT09IG51bGwgKSB7CgoJCQkvLyBjaGVjayBmb3Igc2NoZWR1bGVkIHN0YXJ0IG9mIGFjdGlvbgoKCQkJY29uc3QgdGltZVJ1bm5pbmcgPSAoIHRpbWUgLSBzdGFydFRpbWUgKSAqIHRpbWVEaXJlY3Rpb247CgkJCWlmICggdGltZVJ1bm5pbmcgPCAwIHx8IHRpbWVEaXJlY3Rpb24gPT09IDAgKSB7CgoJCQkJZGVsdGFUaW1lID0gMDsKCgkJCX0gZWxzZSB7CgoKCQkJCXRoaXMuX3N0YXJ0VGltZSA9IG51bGw7IC8vIHVuc2NoZWR1bGUKCQkJCWRlbHRhVGltZSA9IHRpbWVEaXJlY3Rpb24gKiB0aW1lUnVubmluZzsKCgkJCX0KCgkJfQoKCQkvLyBhcHBseSB0aW1lIHNjYWxlIGFuZCBhZHZhbmNlIHRpbWUKCgkJZGVsdGFUaW1lICo9IHRoaXMuX3VwZGF0ZVRpbWVTY2FsZSggdGltZSApOwoJCWNvbnN0IGNsaXBUaW1lID0gdGhpcy5fdXBkYXRlVGltZSggZGVsdGFUaW1lICk7CgoJCS8vIG5vdGU6IF91cGRhdGVUaW1lIG1heSBkaXNhYmxlIHRoZSBhY3Rpb24gcmVzdWx0aW5nIGluCgkJLy8gYW4gZWZmZWN0aXZlIHdlaWdodCBvZiAwCgoJCWNvbnN0IHdlaWdodCA9IHRoaXMuX3VwZGF0ZVdlaWdodCggdGltZSApOwoKCQlpZiAoIHdlaWdodCA+IDAgKSB7CgoJCQljb25zdCBpbnRlcnBvbGFudHMgPSB0aGlzLl9pbnRlcnBvbGFudHM7CgkJCWNvbnN0IHByb3BlcnR5TWl4ZXJzID0gdGhpcy5fcHJvcGVydHlCaW5kaW5nczsKCgkJCXN3aXRjaCAoIHRoaXMuYmxlbmRNb2RlICkgewoKCQkJCWNhc2UgQWRkaXRpdmVBbmltYXRpb25CbGVuZE1vZGU6CgoJCQkJCWZvciAoIGxldCBqID0gMCwgbSA9IGludGVycG9sYW50cy5sZW5ndGg7IGogIT09IG07ICsrIGogKSB7CgoJCQkJCQlpbnRlcnBvbGFudHNbIGogXS5ldmFsdWF0ZSggY2xpcFRpbWUgKTsKCQkJCQkJcHJvcGVydHlNaXhlcnNbIGogXS5hY2N1bXVsYXRlQWRkaXRpdmUoIHdlaWdodCApOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgTm9ybWFsQW5pbWF0aW9uQmxlbmRNb2RlOgoJCQkJZGVmYXVsdDoKCgkJCQkJZm9yICggbGV0IGogPSAwLCBtID0gaW50ZXJwb2xhbnRzLmxlbmd0aDsgaiAhPT0gbTsgKysgaiApIHsKCgkJCQkJCWludGVycG9sYW50c1sgaiBdLmV2YWx1YXRlKCBjbGlwVGltZSApOwoJCQkJCQlwcm9wZXJ0eU1peGVyc1sgaiBdLmFjY3VtdWxhdGUoIGFjY3VJbmRleCwgd2VpZ2h0ICk7CgoJCQkJCX0KCgkJCX0KCgkJfQoKCX0KCglfdXBkYXRlV2VpZ2h0KCB0aW1lICkgewoKCQlsZXQgd2VpZ2h0ID0gMDsKCgkJaWYgKCB0aGlzLmVuYWJsZWQgKSB7CgoJCQl3ZWlnaHQgPSB0aGlzLndlaWdodDsKCQkJY29uc3QgaW50ZXJwb2xhbnQgPSB0aGlzLl93ZWlnaHRJbnRlcnBvbGFudDsKCgkJCWlmICggaW50ZXJwb2xhbnQgIT09IG51bGwgKSB7CgoJCQkJY29uc3QgaW50ZXJwb2xhbnRWYWx1ZSA9IGludGVycG9sYW50LmV2YWx1YXRlKCB0aW1lIClbIDAgXTsKCgkJCQl3ZWlnaHQgKj0gaW50ZXJwb2xhbnRWYWx1ZTsKCgkJCQlpZiAoIHRpbWUgPiBpbnRlcnBvbGFudC5wYXJhbWV0ZXJQb3NpdGlvbnNbIDEgXSApIHsKCgkJCQkJdGhpcy5zdG9wRmFkaW5nKCk7CgoJCQkJCWlmICggaW50ZXJwb2xhbnRWYWx1ZSA9PT0gMCApIHsKCgkJCQkJCS8vIGZhZGVkIG91dCwgZGlzYWJsZQoJCQkJCQl0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfQoKCQl0aGlzLl9lZmZlY3RpdmVXZWlnaHQgPSB3ZWlnaHQ7CgkJcmV0dXJuIHdlaWdodDsKCgl9CgoJX3VwZGF0ZVRpbWVTY2FsZSggdGltZSApIHsKCgkJbGV0IHRpbWVTY2FsZSA9IDA7CgoJCWlmICggISB0aGlzLnBhdXNlZCApIHsKCgkJCXRpbWVTY2FsZSA9IHRoaXMudGltZVNjYWxlOwoKCQkJY29uc3QgaW50ZXJwb2xhbnQgPSB0aGlzLl90aW1lU2NhbGVJbnRlcnBvbGFudDsKCgkJCWlmICggaW50ZXJwb2xhbnQgIT09IG51bGwgKSB7CgoJCQkJY29uc3QgaW50ZXJwb2xhbnRWYWx1ZSA9IGludGVycG9sYW50LmV2YWx1YXRlKCB0aW1lIClbIDAgXTsKCgkJCQl0aW1lU2NhbGUgKj0gaW50ZXJwb2xhbnRWYWx1ZTsKCgkJCQlpZiAoIHRpbWUgPiBpbnRlcnBvbGFudC5wYXJhbWV0ZXJQb3NpdGlvbnNbIDEgXSApIHsKCgkJCQkJdGhpcy5zdG9wV2FycGluZygpOwoKCQkJCQlpZiAoIHRpbWVTY2FsZSA9PT0gMCApIHsKCgkJCQkJCS8vIG1vdGlvbiBoYXMgaGFsdGVkLCBwYXVzZQoJCQkJCQl0aGlzLnBhdXNlZCA9IHRydWU7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyB3YXJwIGRvbmUgLSBhcHBseSBmaW5hbCB0aW1lIHNjYWxlCgkJCQkJCXRoaXMudGltZVNjYWxlID0gdGltZVNjYWxlOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXRoaXMuX2VmZmVjdGl2ZVRpbWVTY2FsZSA9IHRpbWVTY2FsZTsKCQlyZXR1cm4gdGltZVNjYWxlOwoKCX0KCglfdXBkYXRlVGltZSggZGVsdGFUaW1lICkgewoKCQljb25zdCBkdXJhdGlvbiA9IHRoaXMuX2NsaXAuZHVyYXRpb247CgkJY29uc3QgbG9vcCA9IHRoaXMubG9vcDsKCgkJbGV0IHRpbWUgPSB0aGlzLnRpbWUgKyBkZWx0YVRpbWU7CgkJbGV0IGxvb3BDb3VudCA9IHRoaXMuX2xvb3BDb3VudDsKCgkJY29uc3QgcGluZ1BvbmcgPSAoIGxvb3AgPT09IExvb3BQaW5nUG9uZyApOwoKCQlpZiAoIGRlbHRhVGltZSA9PT0gMCApIHsKCgkJCWlmICggbG9vcENvdW50ID09PSAtIDEgKSByZXR1cm4gdGltZTsKCgkJCXJldHVybiAoIHBpbmdQb25nICYmICggbG9vcENvdW50ICYgMSApID09PSAxICkgPyBkdXJhdGlvbiAtIHRpbWUgOiB0aW1lOwoKCQl9CgoJCWlmICggbG9vcCA9PT0gTG9vcE9uY2UgKSB7CgoJCQlpZiAoIGxvb3BDb3VudCA9PT0gLSAxICkgewoKCQkJCS8vIGp1c3Qgc3RhcnRlZAoKCQkJCXRoaXMuX2xvb3BDb3VudCA9IDA7CgkJCQl0aGlzLl9zZXRFbmRpbmdzKCB0cnVlLCB0cnVlLCBmYWxzZSApOwoKCQkJfQoKCQkJaGFuZGxlX3N0b3A6IHsKCgkJCQlpZiAoIHRpbWUgPj0gZHVyYXRpb24gKSB7CgoJCQkJCXRpbWUgPSBkdXJhdGlvbjsKCgkJCQl9IGVsc2UgaWYgKCB0aW1lIDwgMCApIHsKCgkJCQkJdGltZSA9IDA7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGhpcy50aW1lID0gdGltZTsKCgkJCQkJYnJlYWsgaGFuZGxlX3N0b3A7CgoJCQkJfQoKCQkJCWlmICggdGhpcy5jbGFtcFdoZW5GaW5pc2hlZCApIHRoaXMucGF1c2VkID0gdHJ1ZTsKCQkJCWVsc2UgdGhpcy5lbmFibGVkID0gZmFsc2U7CgoJCQkJdGhpcy50aW1lID0gdGltZTsKCgkJCQl0aGlzLl9taXhlci5kaXNwYXRjaEV2ZW50KCB7CgkJCQkJdHlwZTogJ2ZpbmlzaGVkJywgYWN0aW9uOiB0aGlzLAoJCQkJCWRpcmVjdGlvbjogZGVsdGFUaW1lIDwgMCA/IC0gMSA6IDEKCQkJCX0gKTsKCgkJCX0KCgkJfSBlbHNlIHsgLy8gcmVwZXRpdGl2ZSBSZXBlYXQgb3IgUGluZ1BvbmcKCgkJCWlmICggbG9vcENvdW50ID09PSAtIDEgKSB7CgoJCQkJLy8ganVzdCBzdGFydGVkCgoJCQkJaWYgKCBkZWx0YVRpbWUgPj0gMCApIHsKCgkJCQkJbG9vcENvdW50ID0gMDsKCgkJCQkJdGhpcy5fc2V0RW5kaW5ncyggdHJ1ZSwgdGhpcy5yZXBldGl0aW9ucyA9PT0gMCwgcGluZ1BvbmcgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyB3aGVuIGxvb3BpbmcgaW4gcmV2ZXJzZSBkaXJlY3Rpb24sIHRoZSBpbml0aWFsCgkJCQkJLy8gdHJhbnNpdGlvbiB0aHJvdWdoIHplcm8gY291bnRzIGFzIGEgcmVwZXRpdGlvbiwKCQkJCQkvLyBzbyBsZWF2ZSBsb29wQ291bnQgYXQgLTEKCgkJCQkJdGhpcy5fc2V0RW5kaW5ncyggdGhpcy5yZXBldGl0aW9ucyA9PT0gMCwgdHJ1ZSwgcGluZ1BvbmcgKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHRpbWUgPj0gZHVyYXRpb24gfHwgdGltZSA8IDAgKSB7CgoJCQkJLy8gd3JhcCBhcm91bmQKCgkJCQljb25zdCBsb29wRGVsdGEgPSBNYXRoLmZsb29yKCB0aW1lIC8gZHVyYXRpb24gKTsgLy8gc2lnbmVkCgkJCQl0aW1lIC09IGR1cmF0aW9uICogbG9vcERlbHRhOwoKCQkJCWxvb3BDb3VudCArPSBNYXRoLmFicyggbG9vcERlbHRhICk7CgoJCQkJY29uc3QgcGVuZGluZyA9IHRoaXMucmVwZXRpdGlvbnMgLSBsb29wQ291bnQ7CgoJCQkJaWYgKCBwZW5kaW5nIDw9IDAgKSB7CgoJCQkJCS8vIGhhdmUgdG8gc3RvcCAoc3dpdGNoIHN0YXRlLCBjbGFtcCB0aW1lLCBmaXJlIGV2ZW50KQoKCQkJCQlpZiAoIHRoaXMuY2xhbXBXaGVuRmluaXNoZWQgKSB0aGlzLnBhdXNlZCA9IHRydWU7CgkJCQkJZWxzZSB0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCgkJCQkJdGltZSA9IGRlbHRhVGltZSA+IDAgPyBkdXJhdGlvbiA6IDA7CgoJCQkJCXRoaXMudGltZSA9IHRpbWU7CgoJCQkJCXRoaXMuX21peGVyLmRpc3BhdGNoRXZlbnQoIHsKCQkJCQkJdHlwZTogJ2ZpbmlzaGVkJywgYWN0aW9uOiB0aGlzLAoJCQkJCQlkaXJlY3Rpb246IGRlbHRhVGltZSA+IDAgPyAxIDogLSAxCgkJCQkJfSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIGtlZXAgcnVubmluZwoKCQkJCQlpZiAoIHBlbmRpbmcgPT09IDEgKSB7CgoJCQkJCQkvLyBlbnRlcmluZyB0aGUgbGFzdCByb3VuZAoKCQkJCQkJY29uc3QgYXRTdGFydCA9IGRlbHRhVGltZSA8IDA7CgkJCQkJCXRoaXMuX3NldEVuZGluZ3MoIGF0U3RhcnQsICEgYXRTdGFydCwgcGluZ1BvbmcgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRoaXMuX3NldEVuZGluZ3MoIGZhbHNlLCBmYWxzZSwgcGluZ1BvbmcgKTsKCgkJCQkJfQoKCQkJCQl0aGlzLl9sb29wQ291bnQgPSBsb29wQ291bnQ7CgoJCQkJCXRoaXMudGltZSA9IHRpbWU7CgoJCQkJCXRoaXMuX21peGVyLmRpc3BhdGNoRXZlbnQoIHsKCQkJCQkJdHlwZTogJ2xvb3AnLCBhY3Rpb246IHRoaXMsIGxvb3BEZWx0YTogbG9vcERlbHRhCgkJCQkJfSApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJdGhpcy50aW1lID0gdGltZTsKCgkJCX0KCgkJCWlmICggcGluZ1BvbmcgJiYgKCBsb29wQ291bnQgJiAxICkgPT09IDEgKSB7CgoJCQkJLy8gaW52ZXJ0IHRpbWUgZm9yIHRoZSAicG9uZyByb3VuZCIKCgkJCQlyZXR1cm4gZHVyYXRpb24gLSB0aW1lOwoKCQkJfQoKCQl9CgoJCXJldHVybiB0aW1lOwoKCX0KCglfc2V0RW5kaW5ncyggYXRTdGFydCwgYXRFbmQsIHBpbmdQb25nICkgewoKCQljb25zdCBzZXR0aW5ncyA9IHRoaXMuX2ludGVycG9sYW50U2V0dGluZ3M7CgoJCWlmICggcGluZ1BvbmcgKSB7CgoJCQlzZXR0aW5ncy5lbmRpbmdTdGFydCA9IFplcm9TbG9wZUVuZGluZzsKCQkJc2V0dGluZ3MuZW5kaW5nRW5kID0gWmVyb1Nsb3BlRW5kaW5nOwoKCQl9IGVsc2UgewoKCQkJLy8gYXNzdW1pbmcgZm9yIExvb3BPbmNlIGF0U3RhcnQgPT0gYXRFbmQgPT0gdHJ1ZQoKCQkJaWYgKCBhdFN0YXJ0ICkgewoKCQkJCXNldHRpbmdzLmVuZGluZ1N0YXJ0ID0gdGhpcy56ZXJvU2xvcGVBdFN0YXJ0ID8gWmVyb1Nsb3BlRW5kaW5nIDogWmVyb0N1cnZhdHVyZUVuZGluZzsKCgkJCX0gZWxzZSB7CgoJCQkJc2V0dGluZ3MuZW5kaW5nU3RhcnQgPSBXcmFwQXJvdW5kRW5kaW5nOwoKCQkJfQoKCQkJaWYgKCBhdEVuZCApIHsKCgkJCQlzZXR0aW5ncy5lbmRpbmdFbmQgPSB0aGlzLnplcm9TbG9wZUF0RW5kID8gWmVyb1Nsb3BlRW5kaW5nIDogWmVyb0N1cnZhdHVyZUVuZGluZzsKCgkJCX0gZWxzZSB7CgoJCQkJc2V0dGluZ3MuZW5kaW5nRW5kIAkgPSBXcmFwQXJvdW5kRW5kaW5nOwoKCQkJfQoKCQl9CgoJfQoKCV9zY2hlZHVsZUZhZGluZyggZHVyYXRpb24sIHdlaWdodE5vdywgd2VpZ2h0VGhlbiApIHsKCgkJY29uc3QgbWl4ZXIgPSB0aGlzLl9taXhlciwgbm93ID0gbWl4ZXIudGltZTsKCQlsZXQgaW50ZXJwb2xhbnQgPSB0aGlzLl93ZWlnaHRJbnRlcnBvbGFudDsKCgkJaWYgKCBpbnRlcnBvbGFudCA9PT0gbnVsbCApIHsKCgkJCWludGVycG9sYW50ID0gbWl4ZXIuX2xlbmRDb250cm9sSW50ZXJwb2xhbnQoKTsKCQkJdGhpcy5fd2VpZ2h0SW50ZXJwb2xhbnQgPSBpbnRlcnBvbGFudDsKCgkJfQoKCQljb25zdCB0aW1lcyA9IGludGVycG9sYW50LnBhcmFtZXRlclBvc2l0aW9ucywKCQkJdmFsdWVzID0gaW50ZXJwb2xhbnQuc2FtcGxlVmFsdWVzOwoKCQl0aW1lc1sgMCBdID0gbm93OwoJCXZhbHVlc1sgMCBdID0gd2VpZ2h0Tm93OwoJCXRpbWVzWyAxIF0gPSBub3cgKyBkdXJhdGlvbjsKCQl2YWx1ZXNbIDEgXSA9IHdlaWdodFRoZW47CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNvbnN0IF9jb250cm9sSW50ZXJwb2xhbnRzUmVzdWx0QnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheSggMSApOwoKCmNsYXNzIEFuaW1hdGlvbk1peGVyIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgljb25zdHJ1Y3Rvciggcm9vdCApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5fcm9vdCA9IHJvb3Q7CgkJdGhpcy5faW5pdE1lbW9yeU1hbmFnZXIoKTsKCQl0aGlzLl9hY2N1SW5kZXggPSAwOwoJCXRoaXMudGltZSA9IDA7CgkJdGhpcy50aW1lU2NhbGUgPSAxLjA7CgoJfQoKCV9iaW5kQWN0aW9uKCBhY3Rpb24sIHByb3RvdHlwZUFjdGlvbiApIHsKCgkJY29uc3Qgcm9vdCA9IGFjdGlvbi5fbG9jYWxSb290IHx8IHRoaXMuX3Jvb3QsCgkJCXRyYWNrcyA9IGFjdGlvbi5fY2xpcC50cmFja3MsCgkJCW5UcmFja3MgPSB0cmFja3MubGVuZ3RoLAoJCQliaW5kaW5ncyA9IGFjdGlvbi5fcHJvcGVydHlCaW5kaW5ncywKCQkJaW50ZXJwb2xhbnRzID0gYWN0aW9uLl9pbnRlcnBvbGFudHMsCgkJCXJvb3RVdWlkID0gcm9vdC51dWlkLAoJCQliaW5kaW5nc0J5Um9vdCA9IHRoaXMuX2JpbmRpbmdzQnlSb290QW5kTmFtZTsKCgkJbGV0IGJpbmRpbmdzQnlOYW1lID0gYmluZGluZ3NCeVJvb3RbIHJvb3RVdWlkIF07CgoJCWlmICggYmluZGluZ3NCeU5hbWUgPT09IHVuZGVmaW5lZCApIHsKCgkJCWJpbmRpbmdzQnlOYW1lID0ge307CgkJCWJpbmRpbmdzQnlSb290WyByb290VXVpZCBdID0gYmluZGluZ3NCeU5hbWU7CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuVHJhY2tzOyArKyBpICkgewoKCQkJY29uc3QgdHJhY2sgPSB0cmFja3NbIGkgXSwKCQkJCXRyYWNrTmFtZSA9IHRyYWNrLm5hbWU7CgoJCQlsZXQgYmluZGluZyA9IGJpbmRpbmdzQnlOYW1lWyB0cmFja05hbWUgXTsKCgkJCWlmICggYmluZGluZyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCSsrIGJpbmRpbmcucmVmZXJlbmNlQ291bnQ7CgkJCQliaW5kaW5nc1sgaSBdID0gYmluZGluZzsKCgkJCX0gZWxzZSB7CgoJCQkJYmluZGluZyA9IGJpbmRpbmdzWyBpIF07CgoJCQkJaWYgKCBiaW5kaW5nICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCS8vIGV4aXN0aW5nIGJpbmRpbmcsIG1ha2Ugc3VyZSB0aGUgY2FjaGUga25vd3MKCgkJCQkJaWYgKCBiaW5kaW5nLl9jYWNoZUluZGV4ID09PSBudWxsICkgewoKCQkJCQkJKysgYmluZGluZy5yZWZlcmVuY2VDb3VudDsKCQkJCQkJdGhpcy5fYWRkSW5hY3RpdmVCaW5kaW5nKCBiaW5kaW5nLCByb290VXVpZCwgdHJhY2tOYW1lICk7CgoJCQkJCX0KCgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCWNvbnN0IHBhdGggPSBwcm90b3R5cGVBY3Rpb24gJiYgcHJvdG90eXBlQWN0aW9uLgoJCQkJCV9wcm9wZXJ0eUJpbmRpbmdzWyBpIF0uYmluZGluZy5wYXJzZWRQYXRoOwoKCQkJCWJpbmRpbmcgPSBuZXcgUHJvcGVydHlNaXhlcigKCQkJCQlQcm9wZXJ0eUJpbmRpbmcuY3JlYXRlKCByb290LCB0cmFja05hbWUsIHBhdGggKSwKCQkJCQl0cmFjay5WYWx1ZVR5cGVOYW1lLCB0cmFjay5nZXRWYWx1ZVNpemUoKSApOwoKCQkJCSsrIGJpbmRpbmcucmVmZXJlbmNlQ291bnQ7CgkJCQl0aGlzLl9hZGRJbmFjdGl2ZUJpbmRpbmcoIGJpbmRpbmcsIHJvb3RVdWlkLCB0cmFja05hbWUgKTsKCgkJCQliaW5kaW5nc1sgaSBdID0gYmluZGluZzsKCgkJCX0KCgkJCWludGVycG9sYW50c1sgaSBdLnJlc3VsdEJ1ZmZlciA9IGJpbmRpbmcuYnVmZmVyOwoKCQl9CgoJfQoKCV9hY3RpdmF0ZUFjdGlvbiggYWN0aW9uICkgewoKCQlpZiAoICEgdGhpcy5faXNBY3RpdmVBY3Rpb24oIGFjdGlvbiApICkgewoKCQkJaWYgKCBhY3Rpb24uX2NhY2hlSW5kZXggPT09IG51bGwgKSB7CgoJCQkJLy8gdGhpcyBhY3Rpb24gaGFzIGJlZW4gZm9yZ290dGVuIGJ5IHRoZSBjYWNoZSwgYnV0IHRoZSB1c2VyCgkJCQkvLyBhcHBlYXJzIHRvIGJlIHN0aWxsIHVzaW5nIGl0IC0+IHJlYmluZAoKCQkJCWNvbnN0IHJvb3RVdWlkID0gKCBhY3Rpb24uX2xvY2FsUm9vdCB8fCB0aGlzLl9yb290ICkudXVpZCwKCQkJCQljbGlwVXVpZCA9IGFjdGlvbi5fY2xpcC51dWlkLAoJCQkJCWFjdGlvbnNGb3JDbGlwID0gdGhpcy5fYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXTsKCgkJCQl0aGlzLl9iaW5kQWN0aW9uKCBhY3Rpb24sCgkJCQkJYWN0aW9uc0ZvckNsaXAgJiYgYWN0aW9uc0ZvckNsaXAua25vd25BY3Rpb25zWyAwIF0gKTsKCgkJCQl0aGlzLl9hZGRJbmFjdGl2ZUFjdGlvbiggYWN0aW9uLCBjbGlwVXVpZCwgcm9vdFV1aWQgKTsKCgkJCX0KCgkJCWNvbnN0IGJpbmRpbmdzID0gYWN0aW9uLl9wcm9wZXJ0eUJpbmRpbmdzOwoKCQkJLy8gaW5jcmVtZW50IHJlZmVyZW5jZSBjb3VudHMgLyBzb3J0IG91dCBzdGF0ZQoJCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJY29uc3QgYmluZGluZyA9IGJpbmRpbmdzWyBpIF07CgoJCQkJaWYgKCBiaW5kaW5nLnVzZUNvdW50ICsrID09PSAwICkgewoKCQkJCQl0aGlzLl9sZW5kQmluZGluZyggYmluZGluZyApOwoJCQkJCWJpbmRpbmcuc2F2ZU9yaWdpbmFsU3RhdGUoKTsKCgkJCQl9CgoJCQl9CgoJCQl0aGlzLl9sZW5kQWN0aW9uKCBhY3Rpb24gKTsKCgkJfQoKCX0KCglfZGVhY3RpdmF0ZUFjdGlvbiggYWN0aW9uICkgewoKCQlpZiAoIHRoaXMuX2lzQWN0aXZlQWN0aW9uKCBhY3Rpb24gKSApIHsKCgkJCWNvbnN0IGJpbmRpbmdzID0gYWN0aW9uLl9wcm9wZXJ0eUJpbmRpbmdzOwoKCQkJLy8gZGVjcmVtZW50IHJlZmVyZW5jZSBjb3VudHMgLyBzb3J0IG91dCBzdGF0ZQoJCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJY29uc3QgYmluZGluZyA9IGJpbmRpbmdzWyBpIF07CgoJCQkJaWYgKCAtLSBiaW5kaW5nLnVzZUNvdW50ID09PSAwICkgewoKCQkJCQliaW5kaW5nLnJlc3RvcmVPcmlnaW5hbFN0YXRlKCk7CgkJCQkJdGhpcy5fdGFrZUJhY2tCaW5kaW5nKCBiaW5kaW5nICk7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5fdGFrZUJhY2tBY3Rpb24oIGFjdGlvbiApOwoKCQl9CgoJfQoKCS8vIE1lbW9yeSBtYW5hZ2VyCgoJX2luaXRNZW1vcnlNYW5hZ2VyKCkgewoKCQl0aGlzLl9hY3Rpb25zID0gW107IC8vICduQWN0aXZlQWN0aW9ucycgZm9sbG93ZWQgYnkgaW5hY3RpdmUgb25lcwoJCXRoaXMuX25BY3RpdmVBY3Rpb25zID0gMDsKCgkJdGhpcy5fYWN0aW9uc0J5Q2xpcCA9IHt9OwoJCS8vIGluc2lkZToKCQkvLyB7CgkJLy8gCWtub3duQWN0aW9uczogQXJyYXk8IEFuaW1hdGlvbkFjdGlvbiA+IC0gdXNlZCBhcyBwcm90b3R5cGVzCgkJLy8gCWFjdGlvbkJ5Um9vdDogQW5pbWF0aW9uQWN0aW9uIC0gbG9va3VwCgkJLy8gfQoKCgkJdGhpcy5fYmluZGluZ3MgPSBbXTsgLy8gJ25BY3RpdmVCaW5kaW5ncycgZm9sbG93ZWQgYnkgaW5hY3RpdmUgb25lcwoJCXRoaXMuX25BY3RpdmVCaW5kaW5ncyA9IDA7CgoJCXRoaXMuX2JpbmRpbmdzQnlSb290QW5kTmFtZSA9IHt9OyAvLyBpbnNpZGU6IE1hcDwgbmFtZSwgUHJvcGVydHlNaXhlciA+CgoKCQl0aGlzLl9jb250cm9sSW50ZXJwb2xhbnRzID0gW107IC8vIHNhbWUgZ2FtZSBhcyBhYm92ZQoJCXRoaXMuX25BY3RpdmVDb250cm9sSW50ZXJwb2xhbnRzID0gMDsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQl0aGlzLnN0YXRzID0gewoKCQkJYWN0aW9uczogewoJCQkJZ2V0IHRvdGFsKCkgewoKCQkJCQlyZXR1cm4gc2NvcGUuX2FjdGlvbnMubGVuZ3RoOwoKCQkJCX0sCgkJCQlnZXQgaW5Vc2UoKSB7CgoJCQkJCXJldHVybiBzY29wZS5fbkFjdGl2ZUFjdGlvbnM7CgoJCQkJfQoJCQl9LAoJCQliaW5kaW5nczogewoJCQkJZ2V0IHRvdGFsKCkgewoKCQkJCQlyZXR1cm4gc2NvcGUuX2JpbmRpbmdzLmxlbmd0aDsKCgkJCQl9LAoJCQkJZ2V0IGluVXNlKCkgewoKCQkJCQlyZXR1cm4gc2NvcGUuX25BY3RpdmVCaW5kaW5nczsKCgkJCQl9CgkJCX0sCgkJCWNvbnRyb2xJbnRlcnBvbGFudHM6IHsKCQkJCWdldCB0b3RhbCgpIHsKCgkJCQkJcmV0dXJuIHNjb3BlLl9jb250cm9sSW50ZXJwb2xhbnRzLmxlbmd0aDsKCgkJCQl9LAoJCQkJZ2V0IGluVXNlKCkgewoKCQkJCQlyZXR1cm4gc2NvcGUuX25BY3RpdmVDb250cm9sSW50ZXJwb2xhbnRzOwoKCQkJCX0KCQkJfQoKCQl9OwoKCX0KCgkvLyBNZW1vcnkgbWFuYWdlbWVudCBmb3IgQW5pbWF0aW9uQWN0aW9uIG9iamVjdHMKCglfaXNBY3RpdmVBY3Rpb24oIGFjdGlvbiApIHsKCgkJY29uc3QgaW5kZXggPSBhY3Rpb24uX2NhY2hlSW5kZXg7CgkJcmV0dXJuIGluZGV4ICE9PSBudWxsICYmIGluZGV4IDwgdGhpcy5fbkFjdGl2ZUFjdGlvbnM7CgoJfQoKCV9hZGRJbmFjdGl2ZUFjdGlvbiggYWN0aW9uLCBjbGlwVXVpZCwgcm9vdFV1aWQgKSB7CgoJCWNvbnN0IGFjdGlvbnMgPSB0aGlzLl9hY3Rpb25zLAoJCQlhY3Rpb25zQnlDbGlwID0gdGhpcy5fYWN0aW9uc0J5Q2xpcDsKCgkJbGV0IGFjdGlvbnNGb3JDbGlwID0gYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXTsKCgkJaWYgKCBhY3Rpb25zRm9yQ2xpcCA9PT0gdW5kZWZpbmVkICkgewoKCQkJYWN0aW9uc0ZvckNsaXAgPSB7CgoJCQkJa25vd25BY3Rpb25zOiBbIGFjdGlvbiBdLAoJCQkJYWN0aW9uQnlSb290OiB7fQoKCQkJfTsKCgkJCWFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IDA7CgoJCQlhY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdID0gYWN0aW9uc0ZvckNsaXA7CgoJCX0gZWxzZSB7CgoJCQljb25zdCBrbm93bkFjdGlvbnMgPSBhY3Rpb25zRm9yQ2xpcC5rbm93bkFjdGlvbnM7CgoJCQlhY3Rpb24uX2J5Q2xpcENhY2hlSW5kZXggPSBrbm93bkFjdGlvbnMubGVuZ3RoOwoJCQlrbm93bkFjdGlvbnMucHVzaCggYWN0aW9uICk7CgoJCX0KCgkJYWN0aW9uLl9jYWNoZUluZGV4ID0gYWN0aW9ucy5sZW5ndGg7CgkJYWN0aW9ucy5wdXNoKCBhY3Rpb24gKTsKCgkJYWN0aW9uc0ZvckNsaXAuYWN0aW9uQnlSb290WyByb290VXVpZCBdID0gYWN0aW9uOwoKCX0KCglfcmVtb3ZlSW5hY3RpdmVBY3Rpb24oIGFjdGlvbiApIHsKCgkJY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCWxhc3RJbmFjdGl2ZUFjdGlvbiA9IGFjdGlvbnNbIGFjdGlvbnMubGVuZ3RoIC0gMSBdLAoJCQljYWNoZUluZGV4ID0gYWN0aW9uLl9jYWNoZUluZGV4OwoKCQlsYXN0SW5hY3RpdmVBY3Rpb24uX2NhY2hlSW5kZXggPSBjYWNoZUluZGV4OwoJCWFjdGlvbnNbIGNhY2hlSW5kZXggXSA9IGxhc3RJbmFjdGl2ZUFjdGlvbjsKCQlhY3Rpb25zLnBvcCgpOwoKCQlhY3Rpb24uX2NhY2hlSW5kZXggPSBudWxsOwoKCgkJY29uc3QgY2xpcFV1aWQgPSBhY3Rpb24uX2NsaXAudXVpZCwKCQkJYWN0aW9uc0J5Q2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXAsCgkJCWFjdGlvbnNGb3JDbGlwID0gYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXSwKCQkJa25vd25BY3Rpb25zRm9yQ2xpcCA9IGFjdGlvbnNGb3JDbGlwLmtub3duQWN0aW9ucywKCgkJCWxhc3RLbm93bkFjdGlvbiA9CgkJCQlrbm93bkFjdGlvbnNGb3JDbGlwWyBrbm93bkFjdGlvbnNGb3JDbGlwLmxlbmd0aCAtIDEgXSwKCgkJCWJ5Q2xpcENhY2hlSW5kZXggPSBhY3Rpb24uX2J5Q2xpcENhY2hlSW5kZXg7CgoJCWxhc3RLbm93bkFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IGJ5Q2xpcENhY2hlSW5kZXg7CgkJa25vd25BY3Rpb25zRm9yQ2xpcFsgYnlDbGlwQ2FjaGVJbmRleCBdID0gbGFzdEtub3duQWN0aW9uOwoJCWtub3duQWN0aW9uc0ZvckNsaXAucG9wKCk7CgoJCWFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IG51bGw7CgoKCQljb25zdCBhY3Rpb25CeVJvb3QgPSBhY3Rpb25zRm9yQ2xpcC5hY3Rpb25CeVJvb3QsCgkJCXJvb3RVdWlkID0gKCBhY3Rpb24uX2xvY2FsUm9vdCB8fCB0aGlzLl9yb290ICkudXVpZDsKCgkJZGVsZXRlIGFjdGlvbkJ5Um9vdFsgcm9vdFV1aWQgXTsKCgkJaWYgKCBrbm93bkFjdGlvbnNGb3JDbGlwLmxlbmd0aCA9PT0gMCApIHsKCgkJCWRlbGV0ZSBhY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdOwoKCQl9CgoJCXRoaXMuX3JlbW92ZUluYWN0aXZlQmluZGluZ3NGb3JBY3Rpb24oIGFjdGlvbiApOwoKCX0KCglfcmVtb3ZlSW5hY3RpdmVCaW5kaW5nc0ZvckFjdGlvbiggYWN0aW9uICkgewoKCQljb25zdCBiaW5kaW5ncyA9IGFjdGlvbi5fcHJvcGVydHlCaW5kaW5nczsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gYmluZGluZ3MubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJY29uc3QgYmluZGluZyA9IGJpbmRpbmdzWyBpIF07CgoJCQlpZiAoIC0tIGJpbmRpbmcucmVmZXJlbmNlQ291bnQgPT09IDAgKSB7CgoJCQkJdGhpcy5fcmVtb3ZlSW5hY3RpdmVCaW5kaW5nKCBiaW5kaW5nICk7CgoJCQl9CgoJCX0KCgl9CgoJX2xlbmRBY3Rpb24oIGFjdGlvbiApIHsKCgkJLy8gWyBhY3RpdmUgYWN0aW9ucyB8ICBpbmFjdGl2ZSBhY3Rpb25zICBdCgkJLy8gWyAgYWN0aXZlIGFjdGlvbnMgPnwgaW5hY3RpdmUgYWN0aW9ucyBdCgkJLy8gICAgICAgICAgICAgICAgIHMgICAgICAgIGEKCQkvLyAgICAgICAgICAgICAgICAgIDwtc3dhcC0+CgkJLy8gICAgICAgICAgICAgICAgIGEgICAgICAgIHMKCgkJY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCXByZXZJbmRleCA9IGFjdGlvbi5fY2FjaGVJbmRleCwKCgkJCWxhc3RBY3RpdmVJbmRleCA9IHRoaXMuX25BY3RpdmVBY3Rpb25zICsrLAoKCQkJZmlyc3RJbmFjdGl2ZUFjdGlvbiA9IGFjdGlvbnNbIGxhc3RBY3RpdmVJbmRleCBdOwoKCQlhY3Rpb24uX2NhY2hlSW5kZXggPSBsYXN0QWN0aXZlSW5kZXg7CgkJYWN0aW9uc1sgbGFzdEFjdGl2ZUluZGV4IF0gPSBhY3Rpb247CgoJCWZpcnN0SW5hY3RpdmVBY3Rpb24uX2NhY2hlSW5kZXggPSBwcmV2SW5kZXg7CgkJYWN0aW9uc1sgcHJldkluZGV4IF0gPSBmaXJzdEluYWN0aXZlQWN0aW9uOwoKCX0KCglfdGFrZUJhY2tBY3Rpb24oIGFjdGlvbiApIHsKCgkJLy8gWyAgYWN0aXZlIGFjdGlvbnMgIHwgaW5hY3RpdmUgYWN0aW9ucyBdCgkJLy8gWyBhY3RpdmUgYWN0aW9ucyB8PCBpbmFjdGl2ZSBhY3Rpb25zICBdCgkJLy8gICAgICAgIGEgICAgICAgIHMKCQkvLyAgICAgICAgIDwtc3dhcC0+CgkJLy8gICAgICAgIHMgICAgICAgIGEKCgkJY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCXByZXZJbmRleCA9IGFjdGlvbi5fY2FjaGVJbmRleCwKCgkJCWZpcnN0SW5hY3RpdmVJbmRleCA9IC0tIHRoaXMuX25BY3RpdmVBY3Rpb25zLAoKCQkJbGFzdEFjdGl2ZUFjdGlvbiA9IGFjdGlvbnNbIGZpcnN0SW5hY3RpdmVJbmRleCBdOwoKCQlhY3Rpb24uX2NhY2hlSW5kZXggPSBmaXJzdEluYWN0aXZlSW5kZXg7CgkJYWN0aW9uc1sgZmlyc3RJbmFjdGl2ZUluZGV4IF0gPSBhY3Rpb247CgoJCWxhc3RBY3RpdmVBY3Rpb24uX2NhY2hlSW5kZXggPSBwcmV2SW5kZXg7CgkJYWN0aW9uc1sgcHJldkluZGV4IF0gPSBsYXN0QWN0aXZlQWN0aW9uOwoKCX0KCgkvLyBNZW1vcnkgbWFuYWdlbWVudCBmb3IgUHJvcGVydHlNaXhlciBvYmplY3RzCgoJX2FkZEluYWN0aXZlQmluZGluZyggYmluZGluZywgcm9vdFV1aWQsIHRyYWNrTmFtZSApIHsKCgkJY29uc3QgYmluZGluZ3NCeVJvb3QgPSB0aGlzLl9iaW5kaW5nc0J5Um9vdEFuZE5hbWUsCgkJCWJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3M7CgoJCWxldCBiaW5kaW5nQnlOYW1lID0gYmluZGluZ3NCeVJvb3RbIHJvb3RVdWlkIF07CgoJCWlmICggYmluZGluZ0J5TmFtZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJYmluZGluZ0J5TmFtZSA9IHt9OwoJCQliaW5kaW5nc0J5Um9vdFsgcm9vdFV1aWQgXSA9IGJpbmRpbmdCeU5hbWU7CgoJCX0KCgkJYmluZGluZ0J5TmFtZVsgdHJhY2tOYW1lIF0gPSBiaW5kaW5nOwoKCQliaW5kaW5nLl9jYWNoZUluZGV4ID0gYmluZGluZ3MubGVuZ3RoOwoJCWJpbmRpbmdzLnB1c2goIGJpbmRpbmcgKTsKCgl9CgoJX3JlbW92ZUluYWN0aXZlQmluZGluZyggYmluZGluZyApIHsKCgkJY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywKCQkJcHJvcEJpbmRpbmcgPSBiaW5kaW5nLmJpbmRpbmcsCgkJCXJvb3RVdWlkID0gcHJvcEJpbmRpbmcucm9vdE5vZGUudXVpZCwKCQkJdHJhY2tOYW1lID0gcHJvcEJpbmRpbmcucGF0aCwKCQkJYmluZGluZ3NCeVJvb3QgPSB0aGlzLl9iaW5kaW5nc0J5Um9vdEFuZE5hbWUsCgkJCWJpbmRpbmdCeU5hbWUgPSBiaW5kaW5nc0J5Um9vdFsgcm9vdFV1aWQgXSwKCgkJCWxhc3RJbmFjdGl2ZUJpbmRpbmcgPSBiaW5kaW5nc1sgYmluZGluZ3MubGVuZ3RoIC0gMSBdLAoJCQljYWNoZUluZGV4ID0gYmluZGluZy5fY2FjaGVJbmRleDsKCgkJbGFzdEluYWN0aXZlQmluZGluZy5fY2FjaGVJbmRleCA9IGNhY2hlSW5kZXg7CgkJYmluZGluZ3NbIGNhY2hlSW5kZXggXSA9IGxhc3RJbmFjdGl2ZUJpbmRpbmc7CgkJYmluZGluZ3MucG9wKCk7CgoJCWRlbGV0ZSBiaW5kaW5nQnlOYW1lWyB0cmFja05hbWUgXTsKCgkJaWYgKCBPYmplY3Qua2V5cyggYmluZGluZ0J5TmFtZSApLmxlbmd0aCA9PT0gMCApIHsKCgkJCWRlbGV0ZSBiaW5kaW5nc0J5Um9vdFsgcm9vdFV1aWQgXTsKCgkJfQoKCX0KCglfbGVuZEJpbmRpbmcoIGJpbmRpbmcgKSB7CgoJCWNvbnN0IGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsCgkJCXByZXZJbmRleCA9IGJpbmRpbmcuX2NhY2hlSW5kZXgsCgoJCQlsYXN0QWN0aXZlSW5kZXggPSB0aGlzLl9uQWN0aXZlQmluZGluZ3MgKyssCgoJCQlmaXJzdEluYWN0aXZlQmluZGluZyA9IGJpbmRpbmdzWyBsYXN0QWN0aXZlSW5kZXggXTsKCgkJYmluZGluZy5fY2FjaGVJbmRleCA9IGxhc3RBY3RpdmVJbmRleDsKCQliaW5kaW5nc1sgbGFzdEFjdGl2ZUluZGV4IF0gPSBiaW5kaW5nOwoKCQlmaXJzdEluYWN0aXZlQmluZGluZy5fY2FjaGVJbmRleCA9IHByZXZJbmRleDsKCQliaW5kaW5nc1sgcHJldkluZGV4IF0gPSBmaXJzdEluYWN0aXZlQmluZGluZzsKCgl9CgoJX3Rha2VCYWNrQmluZGluZyggYmluZGluZyApIHsKCgkJY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywKCQkJcHJldkluZGV4ID0gYmluZGluZy5fY2FjaGVJbmRleCwKCgkJCWZpcnN0SW5hY3RpdmVJbmRleCA9IC0tIHRoaXMuX25BY3RpdmVCaW5kaW5ncywKCgkJCWxhc3RBY3RpdmVCaW5kaW5nID0gYmluZGluZ3NbIGZpcnN0SW5hY3RpdmVJbmRleCBdOwoKCQliaW5kaW5nLl9jYWNoZUluZGV4ID0gZmlyc3RJbmFjdGl2ZUluZGV4OwoJCWJpbmRpbmdzWyBmaXJzdEluYWN0aXZlSW5kZXggXSA9IGJpbmRpbmc7CgoJCWxhc3RBY3RpdmVCaW5kaW5nLl9jYWNoZUluZGV4ID0gcHJldkluZGV4OwoJCWJpbmRpbmdzWyBwcmV2SW5kZXggXSA9IGxhc3RBY3RpdmVCaW5kaW5nOwoKCX0KCgoJLy8gTWVtb3J5IG1hbmFnZW1lbnQgb2YgSW50ZXJwb2xhbnRzIGZvciB3ZWlnaHQgYW5kIHRpbWUgc2NhbGUKCglfbGVuZENvbnRyb2xJbnRlcnBvbGFudCgpIHsKCgkJY29uc3QgaW50ZXJwb2xhbnRzID0gdGhpcy5fY29udHJvbEludGVycG9sYW50cywKCQkJbGFzdEFjdGl2ZUluZGV4ID0gdGhpcy5fbkFjdGl2ZUNvbnRyb2xJbnRlcnBvbGFudHMgKys7CgoJCWxldCBpbnRlcnBvbGFudCA9IGludGVycG9sYW50c1sgbGFzdEFjdGl2ZUluZGV4IF07CgoJCWlmICggaW50ZXJwb2xhbnQgPT09IHVuZGVmaW5lZCApIHsKCgkJCWludGVycG9sYW50ID0gbmV3IExpbmVhckludGVycG9sYW50KAoJCQkJbmV3IEZsb2F0MzJBcnJheSggMiApLCBuZXcgRmxvYXQzMkFycmF5KCAyICksCgkJCQkxLCBfY29udHJvbEludGVycG9sYW50c1Jlc3VsdEJ1ZmZlciApOwoKCQkJaW50ZXJwb2xhbnQuX19jYWNoZUluZGV4ID0gbGFzdEFjdGl2ZUluZGV4OwoJCQlpbnRlcnBvbGFudHNbIGxhc3RBY3RpdmVJbmRleCBdID0gaW50ZXJwb2xhbnQ7CgoJCX0KCgkJcmV0dXJuIGludGVycG9sYW50OwoKCX0KCglfdGFrZUJhY2tDb250cm9sSW50ZXJwb2xhbnQoIGludGVycG9sYW50ICkgewoKCQljb25zdCBpbnRlcnBvbGFudHMgPSB0aGlzLl9jb250cm9sSW50ZXJwb2xhbnRzLAoJCQlwcmV2SW5kZXggPSBpbnRlcnBvbGFudC5fX2NhY2hlSW5kZXgsCgoJCQlmaXJzdEluYWN0aXZlSW5kZXggPSAtLSB0aGlzLl9uQWN0aXZlQ29udHJvbEludGVycG9sYW50cywKCgkJCWxhc3RBY3RpdmVJbnRlcnBvbGFudCA9IGludGVycG9sYW50c1sgZmlyc3RJbmFjdGl2ZUluZGV4IF07CgoJCWludGVycG9sYW50Ll9fY2FjaGVJbmRleCA9IGZpcnN0SW5hY3RpdmVJbmRleDsKCQlpbnRlcnBvbGFudHNbIGZpcnN0SW5hY3RpdmVJbmRleCBdID0gaW50ZXJwb2xhbnQ7CgoJCWxhc3RBY3RpdmVJbnRlcnBvbGFudC5fX2NhY2hlSW5kZXggPSBwcmV2SW5kZXg7CgkJaW50ZXJwb2xhbnRzWyBwcmV2SW5kZXggXSA9IGxhc3RBY3RpdmVJbnRlcnBvbGFudDsKCgl9CgoJLy8gcmV0dXJuIGFuIGFjdGlvbiBmb3IgYSBjbGlwIG9wdGlvbmFsbHkgdXNpbmcgYSBjdXN0b20gcm9vdCB0YXJnZXQKCS8vIG9iamVjdCAodGhpcyBtZXRob2QgYWxsb2NhdGVzIGEgbG90IG9mIGR5bmFtaWMgbWVtb3J5IGluIGNhc2UgYQoJLy8gcHJldmlvdXNseSB1bmtub3duIGNsaXAvcm9vdCBjb21iaW5hdGlvbiBpcyBzcGVjaWZpZWQpCgljbGlwQWN0aW9uKCBjbGlwLCBvcHRpb25hbFJvb3QsIGJsZW5kTW9kZSApIHsKCgkJY29uc3Qgcm9vdCA9IG9wdGlvbmFsUm9vdCB8fCB0aGlzLl9yb290LAoJCQlyb290VXVpZCA9IHJvb3QudXVpZDsKCgkJbGV0IGNsaXBPYmplY3QgPSB0eXBlb2YgY2xpcCA9PT0gJ3N0cmluZycgPyBBbmltYXRpb25DbGlwLmZpbmRCeU5hbWUoIHJvb3QsIGNsaXAgKSA6IGNsaXA7CgoJCWNvbnN0IGNsaXBVdWlkID0gY2xpcE9iamVjdCAhPT0gbnVsbCA/IGNsaXBPYmplY3QudXVpZCA6IGNsaXA7CgoJCWNvbnN0IGFjdGlvbnNGb3JDbGlwID0gdGhpcy5fYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXTsKCQlsZXQgcHJvdG90eXBlQWN0aW9uID0gbnVsbDsKCgkJaWYgKCBibGVuZE1vZGUgPT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2xpcE9iamVjdCAhPT0gbnVsbCApIHsKCgkJCQlibGVuZE1vZGUgPSBjbGlwT2JqZWN0LmJsZW5kTW9kZTsKCgkJCX0gZWxzZSB7CgoJCQkJYmxlbmRNb2RlID0gTm9ybWFsQW5pbWF0aW9uQmxlbmRNb2RlOwoKCQkJfQoKCQl9CgoJCWlmICggYWN0aW9uc0ZvckNsaXAgIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IGV4aXN0aW5nQWN0aW9uID0gYWN0aW9uc0ZvckNsaXAuYWN0aW9uQnlSb290WyByb290VXVpZCBdOwoKCQkJaWYgKCBleGlzdGluZ0FjdGlvbiAhPT0gdW5kZWZpbmVkICYmIGV4aXN0aW5nQWN0aW9uLmJsZW5kTW9kZSA9PT0gYmxlbmRNb2RlICkgewoKCQkJCXJldHVybiBleGlzdGluZ0FjdGlvbjsKCgkJCX0KCgkJCS8vIHdlIGtub3cgdGhlIGNsaXAsIHNvIHdlIGRvbid0IGhhdmUgdG8gcGFyc2UgYWxsCgkJCS8vIHRoZSBiaW5kaW5ncyBhZ2FpbiBidXQgY2FuIGp1c3QgY29weQoJCQlwcm90b3R5cGVBY3Rpb24gPSBhY3Rpb25zRm9yQ2xpcC5rbm93bkFjdGlvbnNbIDAgXTsKCgkJCS8vIGFsc28sIHRha2UgdGhlIGNsaXAgZnJvbSB0aGUgcHJvdG90eXBlIGFjdGlvbgoJCQlpZiAoIGNsaXBPYmplY3QgPT09IG51bGwgKQoJCQkJY2xpcE9iamVjdCA9IHByb3RvdHlwZUFjdGlvbi5fY2xpcDsKCgkJfQoKCQkvLyBjbGlwIG11c3QgYmUga25vd24gd2hlbiBzcGVjaWZpZWQgdmlhIHN0cmluZwoJCWlmICggY2xpcE9iamVjdCA9PT0gbnVsbCApIHJldHVybiBudWxsOwoKCQkvLyBhbGxvY2F0ZSBhbGwgcmVzb3VyY2VzIHJlcXVpcmVkIHRvIHJ1biBpdAoJCWNvbnN0IG5ld0FjdGlvbiA9IG5ldyBBbmltYXRpb25BY3Rpb24oIHRoaXMsIGNsaXBPYmplY3QsIG9wdGlvbmFsUm9vdCwgYmxlbmRNb2RlICk7CgoJCXRoaXMuX2JpbmRBY3Rpb24oIG5ld0FjdGlvbiwgcHJvdG90eXBlQWN0aW9uICk7CgoJCS8vIGFuZCBtYWtlIHRoZSBhY3Rpb24ga25vd24gdG8gdGhlIG1lbW9yeSBtYW5hZ2VyCgkJdGhpcy5fYWRkSW5hY3RpdmVBY3Rpb24oIG5ld0FjdGlvbiwgY2xpcFV1aWQsIHJvb3RVdWlkICk7CgoJCXJldHVybiBuZXdBY3Rpb247CgoJfQoKCS8vIGdldCBhbiBleGlzdGluZyBhY3Rpb24KCWV4aXN0aW5nQWN0aW9uKCBjbGlwLCBvcHRpb25hbFJvb3QgKSB7CgoJCWNvbnN0IHJvb3QgPSBvcHRpb25hbFJvb3QgfHwgdGhpcy5fcm9vdCwKCQkJcm9vdFV1aWQgPSByb290LnV1aWQsCgoJCQljbGlwT2JqZWN0ID0gdHlwZW9mIGNsaXAgPT09ICdzdHJpbmcnID8KCQkJCUFuaW1hdGlvbkNsaXAuZmluZEJ5TmFtZSggcm9vdCwgY2xpcCApIDogY2xpcCwKCgkJCWNsaXBVdWlkID0gY2xpcE9iamVjdCA/IGNsaXBPYmplY3QudXVpZCA6IGNsaXAsCgoJCQlhY3Rpb25zRm9yQ2xpcCA9IHRoaXMuX2FjdGlvbnNCeUNsaXBbIGNsaXBVdWlkIF07CgoJCWlmICggYWN0aW9uc0ZvckNsaXAgIT09IHVuZGVmaW5lZCApIHsKCgkJCXJldHVybiBhY3Rpb25zRm9yQ2xpcC5hY3Rpb25CeVJvb3RbIHJvb3RVdWlkIF0gfHwgbnVsbDsKCgkJfQoKCQlyZXR1cm4gbnVsbDsKCgl9CgoJLy8gZGVhY3RpdmF0ZXMgYWxsIHByZXZpb3VzbHkgc2NoZWR1bGVkIGFjdGlvbnMKCXN0b3BBbGxBY3Rpb24oKSB7CgoJCWNvbnN0IGFjdGlvbnMgPSB0aGlzLl9hY3Rpb25zLAoJCQluQWN0aW9ucyA9IHRoaXMuX25BY3RpdmVBY3Rpb25zOwoKCQlmb3IgKCBsZXQgaSA9IG5BY3Rpb25zIC0gMTsgaSA+PSAwOyAtLSBpICkgewoKCQkJYWN0aW9uc1sgaSBdLnN0b3AoKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gYWR2YW5jZSB0aGUgdGltZSBhbmQgdXBkYXRlIGFwcGx5IHRoZSBhbmltYXRpb24KCXVwZGF0ZSggZGVsdGFUaW1lICkgewoKCQlkZWx0YVRpbWUgKj0gdGhpcy50aW1lU2NhbGU7CgoJCWNvbnN0IGFjdGlvbnMgPSB0aGlzLl9hY3Rpb25zLAoJCQluQWN0aW9ucyA9IHRoaXMuX25BY3RpdmVBY3Rpb25zLAoKCQkJdGltZSA9IHRoaXMudGltZSArPSBkZWx0YVRpbWUsCgkJCXRpbWVEaXJlY3Rpb24gPSBNYXRoLnNpZ24oIGRlbHRhVGltZSApLAoKCQkJYWNjdUluZGV4ID0gdGhpcy5fYWNjdUluZGV4IF49IDE7CgoJCS8vIHJ1biBhY3RpdmUgYWN0aW9ucwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IG5BY3Rpb25zOyArKyBpICkgewoKCQkJY29uc3QgYWN0aW9uID0gYWN0aW9uc1sgaSBdOwoKCQkJYWN0aW9uLl91cGRhdGUoIHRpbWUsIGRlbHRhVGltZSwgdGltZURpcmVjdGlvbiwgYWNjdUluZGV4ICk7CgoJCX0KCgkJLy8gdXBkYXRlIHNjZW5lIGdyYXBoCgoJCWNvbnN0IGJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsCgkJCW5CaW5kaW5ncyA9IHRoaXMuX25BY3RpdmVCaW5kaW5nczsKCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuQmluZGluZ3M7ICsrIGkgKSB7CgoJCQliaW5kaW5nc1sgaSBdLmFwcGx5KCBhY2N1SW5kZXggKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gQWxsb3dzIHlvdSB0byBzZWVrIHRvIGEgc3BlY2lmaWMgdGltZSBpbiBhbiBhbmltYXRpb24uCglzZXRUaW1lKCB0aW1lSW5TZWNvbmRzICkgewoKCQl0aGlzLnRpbWUgPSAwOyAvLyBaZXJvIG91dCB0aW1lIGF0dHJpYnV0ZSBmb3IgQW5pbWF0aW9uTWl4ZXIgb2JqZWN0OwoJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuX2FjdGlvbnMubGVuZ3RoOyBpICsrICkgewoKCQkJdGhpcy5fYWN0aW9uc1sgaSBdLnRpbWUgPSAwOyAvLyBaZXJvIG91dCB0aW1lIGF0dHJpYnV0ZSBmb3IgYWxsIGFzc29jaWF0ZWQgQW5pbWF0aW9uQWN0aW9uIG9iamVjdHMuCgoJCX0KCgkJcmV0dXJuIHRoaXMudXBkYXRlKCB0aW1lSW5TZWNvbmRzICk7IC8vIFVwZGF0ZSB1c2VkIHRvIHNldCBleGFjdCB0aW1lLiBSZXR1cm5zICJ0aGlzIiBBbmltYXRpb25NaXhlciBvYmplY3QuCgoJfQoKCS8vIHJldHVybiB0aGlzIG1peGVyJ3Mgcm9vdCB0YXJnZXQgb2JqZWN0CglnZXRSb290KCkgewoKCQlyZXR1cm4gdGhpcy5fcm9vdDsKCgl9CgoJLy8gZnJlZSBhbGwgcmVzb3VyY2VzIHNwZWNpZmljIHRvIGEgcGFydGljdWxhciBjbGlwCgl1bmNhY2hlQ2xpcCggY2xpcCApIHsKCgkJY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCWNsaXBVdWlkID0gY2xpcC51dWlkLAoJCQlhY3Rpb25zQnlDbGlwID0gdGhpcy5fYWN0aW9uc0J5Q2xpcCwKCQkJYWN0aW9uc0ZvckNsaXAgPSBhY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdOwoKCQlpZiAoIGFjdGlvbnNGb3JDbGlwICE9PSB1bmRlZmluZWQgKSB7CgoJCQkvLyBub3RlOiBqdXN0IGNhbGxpbmcgX3JlbW92ZUluYWN0aXZlQWN0aW9uIHdvdWxkIG1lc3MgdXAgdGhlCgkJCS8vIGl0ZXJhdGlvbiBzdGF0ZSBhbmQgYWxzbyByZXF1aXJlIHVwZGF0aW5nIHRoZSBzdGF0ZSB3ZSBjYW4KCQkJLy8ganVzdCB0aHJvdyBhd2F5CgoJCQljb25zdCBhY3Rpb25zVG9SZW1vdmUgPSBhY3Rpb25zRm9yQ2xpcC5rbm93bkFjdGlvbnM7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBhY3Rpb25zVG9SZW1vdmUubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJCWNvbnN0IGFjdGlvbiA9IGFjdGlvbnNUb1JlbW92ZVsgaSBdOwoKCQkJCXRoaXMuX2RlYWN0aXZhdGVBY3Rpb24oIGFjdGlvbiApOwoKCQkJCWNvbnN0IGNhY2hlSW5kZXggPSBhY3Rpb24uX2NhY2hlSW5kZXgsCgkJCQkJbGFzdEluYWN0aXZlQWN0aW9uID0gYWN0aW9uc1sgYWN0aW9ucy5sZW5ndGggLSAxIF07CgoJCQkJYWN0aW9uLl9jYWNoZUluZGV4ID0gbnVsbDsKCQkJCWFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IG51bGw7CgoJCQkJbGFzdEluYWN0aXZlQWN0aW9uLl9jYWNoZUluZGV4ID0gY2FjaGVJbmRleDsKCQkJCWFjdGlvbnNbIGNhY2hlSW5kZXggXSA9IGxhc3RJbmFjdGl2ZUFjdGlvbjsKCQkJCWFjdGlvbnMucG9wKCk7CgoJCQkJdGhpcy5fcmVtb3ZlSW5hY3RpdmVCaW5kaW5nc0ZvckFjdGlvbiggYWN0aW9uICk7CgoJCQl9CgoJCQlkZWxldGUgYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXTsKCgkJfQoKCX0KCgkvLyBmcmVlIGFsbCByZXNvdXJjZXMgc3BlY2lmaWMgdG8gYSBwYXJ0aWN1bGFyIHJvb3QgdGFyZ2V0IG9iamVjdAoJdW5jYWNoZVJvb3QoIHJvb3QgKSB7CgoJCWNvbnN0IHJvb3RVdWlkID0gcm9vdC51dWlkLAoJCQlhY3Rpb25zQnlDbGlwID0gdGhpcy5fYWN0aW9uc0J5Q2xpcDsKCgkJZm9yICggY29uc3QgY2xpcFV1aWQgaW4gYWN0aW9uc0J5Q2xpcCApIHsKCgkJCWNvbnN0IGFjdGlvbkJ5Um9vdCA9IGFjdGlvbnNCeUNsaXBbIGNsaXBVdWlkIF0uYWN0aW9uQnlSb290LAoJCQkJYWN0aW9uID0gYWN0aW9uQnlSb290WyByb290VXVpZCBdOwoKCQkJaWYgKCBhY3Rpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aGlzLl9kZWFjdGl2YXRlQWN0aW9uKCBhY3Rpb24gKTsKCQkJCXRoaXMuX3JlbW92ZUluYWN0aXZlQWN0aW9uKCBhY3Rpb24gKTsKCgkJCX0KCgkJfQoKCQljb25zdCBiaW5kaW5nc0J5Um9vdCA9IHRoaXMuX2JpbmRpbmdzQnlSb290QW5kTmFtZSwKCQkJYmluZGluZ0J5TmFtZSA9IGJpbmRpbmdzQnlSb290WyByb290VXVpZCBdOwoKCQlpZiAoIGJpbmRpbmdCeU5hbWUgIT09IHVuZGVmaW5lZCApIHsKCgkJCWZvciAoIGNvbnN0IHRyYWNrTmFtZSBpbiBiaW5kaW5nQnlOYW1lICkgewoKCQkJCWNvbnN0IGJpbmRpbmcgPSBiaW5kaW5nQnlOYW1lWyB0cmFja05hbWUgXTsKCQkJCWJpbmRpbmcucmVzdG9yZU9yaWdpbmFsU3RhdGUoKTsKCQkJCXRoaXMuX3JlbW92ZUluYWN0aXZlQmluZGluZyggYmluZGluZyApOwoKCQkJfQoKCQl9CgoJfQoKCS8vIHJlbW92ZSBhIHRhcmdldGVkIGNsaXAgZnJvbSB0aGUgY2FjaGUKCXVuY2FjaGVBY3Rpb24oIGNsaXAsIG9wdGlvbmFsUm9vdCApIHsKCgkJY29uc3QgYWN0aW9uID0gdGhpcy5leGlzdGluZ0FjdGlvbiggY2xpcCwgb3B0aW9uYWxSb290ICk7CgoJCWlmICggYWN0aW9uICE9PSBudWxsICkgewoKCQkJdGhpcy5fZGVhY3RpdmF0ZUFjdGlvbiggYWN0aW9uICk7CgkJCXRoaXMuX3JlbW92ZUluYWN0aXZlQWN0aW9uKCBhY3Rpb24gKTsKCgkJfQoKCX0KCn0KCmNsYXNzIFVuaWZvcm0gewoKCWNvbnN0cnVjdG9yKCB2YWx1ZSApIHsKCgkJdGhpcy52YWx1ZSA9IHZhbHVlOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyBVbmlmb3JtKCB0aGlzLnZhbHVlLmNsb25lID09PSB1bmRlZmluZWQgPyB0aGlzLnZhbHVlIDogdGhpcy52YWx1ZS5jbG9uZSgpICk7CgoJfQoKfQoKbGV0IF9pZCA9IDA7CgpjbGFzcyBVbmlmb3Jtc0dyb3VwIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1VuaWZvcm1zR3JvdXAgPSB0cnVlOwoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9pZCArKyB9ICk7CgoJCXRoaXMubmFtZSA9ICcnOwoKCQl0aGlzLnVzYWdlID0gU3RhdGljRHJhd1VzYWdlOwoJCXRoaXMudW5pZm9ybXMgPSBbXTsKCgl9CgoJYWRkKCB1bmlmb3JtICkgewoKCQl0aGlzLnVuaWZvcm1zLnB1c2goIHVuaWZvcm0gKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJlbW92ZSggdW5pZm9ybSApIHsKCgkJY29uc3QgaW5kZXggPSB0aGlzLnVuaWZvcm1zLmluZGV4T2YoIHVuaWZvcm0gKTsKCgkJaWYgKCBpbmRleCAhPT0gLSAxICkgdGhpcy51bmlmb3Jtcy5zcGxpY2UoIGluZGV4LCAxICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXROYW1lKCBuYW1lICkgewoKCQl0aGlzLm5hbWUgPSBuYW1lOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0VXNhZ2UoIHZhbHVlICkgewoKCQl0aGlzLnVzYWdlID0gdmFsdWU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgkJdGhpcy51c2FnZSA9IHNvdXJjZS51c2FnZTsKCgkJY29uc3QgdW5pZm9ybXNTb3VyY2UgPSBzb3VyY2UudW5pZm9ybXM7CgoJCXRoaXMudW5pZm9ybXMubGVuZ3RoID0gMDsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdW5pZm9ybXNTb3VyY2UubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHVuaWZvcm1zID0gQXJyYXkuaXNBcnJheSggdW5pZm9ybXNTb3VyY2VbIGkgXSApID8gdW5pZm9ybXNTb3VyY2VbIGkgXSA6IFsgdW5pZm9ybXNTb3VyY2VbIGkgXSBdOwoKCQkJZm9yICggbGV0IGogPSAwOyBqIDwgdW5pZm9ybXMubGVuZ3RoOyBqICsrICkgewoKCQkJCXRoaXMudW5pZm9ybXMucHVzaCggdW5pZm9ybXNbIGogXS5jbG9uZSgpICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKfQoKY2xhc3MgSW5zdGFuY2VkSW50ZXJsZWF2ZWRCdWZmZXIgZXh0ZW5kcyBJbnRlcmxlYXZlZEJ1ZmZlciB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBzdHJpZGUsIG1lc2hQZXJBdHRyaWJ1dGUgPSAxICkgewoKCQlzdXBlciggYXJyYXksIHN0cmlkZSApOwoKCQl0aGlzLmlzSW5zdGFuY2VkSW50ZXJsZWF2ZWRCdWZmZXIgPSB0cnVlOwoKCQl0aGlzLm1lc2hQZXJBdHRyaWJ1dGUgPSBtZXNoUGVyQXR0cmlidXRlOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLm1lc2hQZXJBdHRyaWJ1dGUgPSBzb3VyY2UubWVzaFBlckF0dHJpYnV0ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCBkYXRhICkgewoKCQljb25zdCBpYiA9IHN1cGVyLmNsb25lKCBkYXRhICk7CgoJCWliLm1lc2hQZXJBdHRyaWJ1dGUgPSB0aGlzLm1lc2hQZXJBdHRyaWJ1dGU7CgoJCXJldHVybiBpYjsKCgl9CgoJdG9KU09OKCBkYXRhICkgewoKCQljb25zdCBqc29uID0gc3VwZXIudG9KU09OKCBkYXRhICk7CgoJCWpzb24uaXNJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciA9IHRydWU7CgkJanNvbi5tZXNoUGVyQXR0cmlidXRlID0gdGhpcy5tZXNoUGVyQXR0cmlidXRlOwoKCQlyZXR1cm4ganNvbjsKCgl9Cgp9CgpjbGFzcyBHTEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGJ1ZmZlciwgdHlwZSwgaXRlbVNpemUsIGVsZW1lbnRTaXplLCBjb3VudCApIHsKCgkJdGhpcy5pc0dMQnVmZmVyQXR0cmlidXRlID0gdHJ1ZTsKCgkJdGhpcy5uYW1lID0gJyc7CgoJCXRoaXMuYnVmZmVyID0gYnVmZmVyOwoJCXRoaXMudHlwZSA9IHR5cGU7CgkJdGhpcy5pdGVtU2l6ZSA9IGl0ZW1TaXplOwoJCXRoaXMuZWxlbWVudFNpemUgPSBlbGVtZW50U2l6ZTsKCQl0aGlzLmNvdW50ID0gY291bnQ7CgoJCXRoaXMudmVyc2lvbiA9IDA7CgoJfQoKCXNldCBuZWVkc1VwZGF0ZSggdmFsdWUgKSB7CgoJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgoJfQoKCXNldEJ1ZmZlciggYnVmZmVyICkgewoKCQl0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFR5cGUoIHR5cGUsIGVsZW1lbnRTaXplICkgewoKCQl0aGlzLnR5cGUgPSB0eXBlOwoJCXRoaXMuZWxlbWVudFNpemUgPSBlbGVtZW50U2l6ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEl0ZW1TaXplKCBpdGVtU2l6ZSApIHsKCgkJdGhpcy5pdGVtU2l6ZSA9IGl0ZW1TaXplOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0Q291bnQoIGNvdW50ICkgewoKCQl0aGlzLmNvdW50ID0gY291bnQ7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFJheWNhc3RlciB7CgoJY29uc3RydWN0b3IoIG9yaWdpbiwgZGlyZWN0aW9uLCBuZWFyID0gMCwgZmFyID0gSW5maW5pdHkgKSB7CgoJCXRoaXMucmF5ID0gbmV3IFJheSggb3JpZ2luLCBkaXJlY3Rpb24gKTsKCQkvLyBkaXJlY3Rpb24gaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkIChmb3IgYWNjdXJhdGUgZGlzdGFuY2UgY2FsY3VsYXRpb25zKQoKCQl0aGlzLm5lYXIgPSBuZWFyOwoJCXRoaXMuZmFyID0gZmFyOwoJCXRoaXMuY2FtZXJhID0gbnVsbDsKCQl0aGlzLmxheWVycyA9IG5ldyBMYXllcnMoKTsKCgkJdGhpcy5wYXJhbXMgPSB7CgkJCU1lc2g6IHt9LAoJCQlMaW5lOiB7IHRocmVzaG9sZDogMSB9LAoJCQlMT0Q6IHt9LAoJCQlQb2ludHM6IHsgdGhyZXNob2xkOiAxIH0sCgkJCVNwcml0ZToge30KCQl9OwoKCX0KCglzZXQoIG9yaWdpbiwgZGlyZWN0aW9uICkgewoKCQkvLyBkaXJlY3Rpb24gaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkIChmb3IgYWNjdXJhdGUgZGlzdGFuY2UgY2FsY3VsYXRpb25zKQoKCQl0aGlzLnJheS5zZXQoIG9yaWdpbiwgZGlyZWN0aW9uICk7CgoJfQoKCXNldEZyb21DYW1lcmEoIGNvb3JkcywgY2FtZXJhICkgewoKCQlpZiAoIGNhbWVyYS5pc1BlcnNwZWN0aXZlQ2FtZXJhICkgewoKCQkJdGhpcy5yYXkub3JpZ2luLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhLm1hdHJpeFdvcmxkICk7CgkJCXRoaXMucmF5LmRpcmVjdGlvbi5zZXQoIGNvb3Jkcy54LCBjb29yZHMueSwgMC41ICkudW5wcm9qZWN0KCBjYW1lcmEgKS5zdWIoIHRoaXMucmF5Lm9yaWdpbiApLm5vcm1hbGl6ZSgpOwoJCQl0aGlzLmNhbWVyYSA9IGNhbWVyYTsKCgkJfSBlbHNlIGlmICggY2FtZXJhLmlzT3J0aG9ncmFwaGljQ2FtZXJhICkgewoKCQkJdGhpcy5yYXkub3JpZ2luLnNldCggY29vcmRzLngsIGNvb3Jkcy55LCAoIGNhbWVyYS5uZWFyICsgY2FtZXJhLmZhciApIC8gKCBjYW1lcmEubmVhciAtIGNhbWVyYS5mYXIgKSApLnVucHJvamVjdCggY2FtZXJhICk7IC8vIHNldCBvcmlnaW4gaW4gcGxhbmUgb2YgY2FtZXJhCgkJCXRoaXMucmF5LmRpcmVjdGlvbi5zZXQoIDAsIDAsIC0gMSApLnRyYW5zZm9ybURpcmVjdGlvbiggY2FtZXJhLm1hdHJpeFdvcmxkICk7CgkJCXRoaXMuY2FtZXJhID0gY2FtZXJhOwoKCQl9IGVsc2UgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlJheWNhc3RlcjogVW5zdXBwb3J0ZWQgY2FtZXJhIHR5cGU6ICcgKyBjYW1lcmEudHlwZSApOwoKCQl9CgoJfQoKCWludGVyc2VjdE9iamVjdCggb2JqZWN0LCByZWN1cnNpdmUgPSB0cnVlLCBpbnRlcnNlY3RzID0gW10gKSB7CgoJCWludGVyc2VjdE9iamVjdCggb2JqZWN0LCB0aGlzLCBpbnRlcnNlY3RzLCByZWN1cnNpdmUgKTsKCgkJaW50ZXJzZWN0cy5zb3J0KCBhc2NTb3J0ICk7CgoJCXJldHVybiBpbnRlcnNlY3RzOwoKCX0KCglpbnRlcnNlY3RPYmplY3RzKCBvYmplY3RzLCByZWN1cnNpdmUgPSB0cnVlLCBpbnRlcnNlY3RzID0gW10gKSB7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IG9iamVjdHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWludGVyc2VjdE9iamVjdCggb2JqZWN0c1sgaSBdLCB0aGlzLCBpbnRlcnNlY3RzLCByZWN1cnNpdmUgKTsKCgkJfQoKCQlpbnRlcnNlY3RzLnNvcnQoIGFzY1NvcnQgKTsKCgkJcmV0dXJuIGludGVyc2VjdHM7CgoJfQoKfQoKZnVuY3Rpb24gYXNjU29ydCggYSwgYiApIHsKCglyZXR1cm4gYS5kaXN0YW5jZSAtIGIuZGlzdGFuY2U7Cgp9CgpmdW5jdGlvbiBpbnRlcnNlY3RPYmplY3QoIG9iamVjdCwgcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCByZWN1cnNpdmUgKSB7CgoJaWYgKCBvYmplY3QubGF5ZXJzLnRlc3QoIHJheWNhc3Rlci5sYXllcnMgKSApIHsKCgkJb2JqZWN0LnJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApOwoKCX0KCglpZiAoIHJlY3Vyc2l2ZSA9PT0gdHJ1ZSApIHsKCgkJY29uc3QgY2hpbGRyZW4gPSBvYmplY3QuY2hpbGRyZW47CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQlpbnRlcnNlY3RPYmplY3QoIGNoaWxkcmVuWyBpIF0sIHJheWNhc3RlciwgaW50ZXJzZWN0cywgdHJ1ZSApOwoKCQl9CgoJfQoKfQoKLyoqCiAqIFJlZjogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU3BoZXJpY2FsX2Nvb3JkaW5hdGVfc3lzdGVtCiAqCiAqIFRoZSBwb2xhciBhbmdsZSAocGhpKSBpcyBtZWFzdXJlZCBmcm9tIHRoZSBwb3NpdGl2ZSB5LWF4aXMuIFRoZSBwb3NpdGl2ZSB5LWF4aXMgaXMgdXAuCiAqIFRoZSBhemltdXRoYWwgYW5nbGUgKHRoZXRhKSBpcyBtZWFzdXJlZCBmcm9tIHRoZSBwb3NpdGl2ZSB6LWF4aXMuCiAqLwoKCmNsYXNzIFNwaGVyaWNhbCB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIHBoaSA9IDAsIHRoZXRhID0gMCApIHsKCgkJdGhpcy5yYWRpdXMgPSByYWRpdXM7CgkJdGhpcy5waGkgPSBwaGk7IC8vIHBvbGFyIGFuZ2xlCgkJdGhpcy50aGV0YSA9IHRoZXRhOyAvLyBhemltdXRoYWwgYW5nbGUKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldCggcmFkaXVzLCBwaGksIHRoZXRhICkgewoKCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCQl0aGlzLnBoaSA9IHBoaTsKCQl0aGlzLnRoZXRhID0gdGhldGE7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb3B5KCBvdGhlciApIHsKCgkJdGhpcy5yYWRpdXMgPSBvdGhlci5yYWRpdXM7CgkJdGhpcy5waGkgPSBvdGhlci5waGk7CgkJdGhpcy50aGV0YSA9IG90aGVyLnRoZXRhOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gcmVzdHJpY3QgcGhpIHRvIGJlIGJldHdlZW4gRVBTIGFuZCBQSS1FUFMKCW1ha2VTYWZlKCkgewoKCQljb25zdCBFUFMgPSAwLjAwMDAwMTsKCQl0aGlzLnBoaSA9IE1hdGgubWF4KCBFUFMsIE1hdGgubWluKCBNYXRoLlBJIC0gRVBTLCB0aGlzLnBoaSApICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tVmVjdG9yMyggdiApIHsKCgkJcmV0dXJuIHRoaXMuc2V0RnJvbUNhcnRlc2lhbkNvb3Jkcyggdi54LCB2LnksIHYueiApOwoKCX0KCglzZXRGcm9tQ2FydGVzaWFuQ29vcmRzKCB4LCB5LCB6ICkgewoKCQl0aGlzLnJhZGl1cyA9IE1hdGguc3FydCggeCAqIHggKyB5ICogeSArIHogKiB6ICk7CgoJCWlmICggdGhpcy5yYWRpdXMgPT09IDAgKSB7CgoJCQl0aGlzLnRoZXRhID0gMDsKCQkJdGhpcy5waGkgPSAwOwoKCQl9IGVsc2UgewoKCQkJdGhpcy50aGV0YSA9IE1hdGguYXRhbjIoIHgsIHogKTsKCQkJdGhpcy5waGkgPSBNYXRoLmFjb3MoIGNsYW1wKCB5IC8gdGhpcy5yYWRpdXMsIC0gMSwgMSApICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKfQoKLyoqCiAqIFJlZjogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ3lsaW5kcmljYWxfY29vcmRpbmF0ZV9zeXN0ZW0KICovCgpjbGFzcyBDeWxpbmRyaWNhbCB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIHRoZXRhID0gMCwgeSA9IDAgKSB7CgoJCXRoaXMucmFkaXVzID0gcmFkaXVzOyAvLyBkaXN0YW5jZSBmcm9tIHRoZSBvcmlnaW4gdG8gYSBwb2ludCBpbiB0aGUgeC16IHBsYW5lCgkJdGhpcy50aGV0YSA9IHRoZXRhOyAvLyBjb3VudGVyY2xvY2t3aXNlIGFuZ2xlIGluIHRoZSB4LXogcGxhbmUgbWVhc3VyZWQgaW4gcmFkaWFucyBmcm9tIHRoZSBwb3NpdGl2ZSB6LWF4aXMKCQl0aGlzLnkgPSB5OyAvLyBoZWlnaHQgYWJvdmUgdGhlIHgteiBwbGFuZQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0KCByYWRpdXMsIHRoZXRhLCB5ICkgewoKCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCQl0aGlzLnRoZXRhID0gdGhldGE7CgkJdGhpcy55ID0geTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIG90aGVyICkgewoKCQl0aGlzLnJhZGl1cyA9IG90aGVyLnJhZGl1czsKCQl0aGlzLnRoZXRhID0gb3RoZXIudGhldGE7CgkJdGhpcy55ID0gb3RoZXIueTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21WZWN0b3IzKCB2ICkgewoKCQlyZXR1cm4gdGhpcy5zZXRGcm9tQ2FydGVzaWFuQ29vcmRzKCB2LngsIHYueSwgdi56ICk7CgoJfQoKCXNldEZyb21DYXJ0ZXNpYW5Db29yZHMoIHgsIHksIHogKSB7CgoJCXRoaXMucmFkaXVzID0gTWF0aC5zcXJ0KCB4ICogeCArIHogKiB6ICk7CgkJdGhpcy50aGV0YSA9IE1hdGguYXRhbjIoIHgsIHogKTsKCQl0aGlzLnkgPSB5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9Cgp9Cgpjb25zdCBfdmVjdG9yJDQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7CgpjbGFzcyBCb3gyIHsKCgljb25zdHJ1Y3RvciggbWluID0gbmV3IFZlY3RvcjIoICsgSW5maW5pdHksICsgSW5maW5pdHkgKSwgbWF4ID0gbmV3IFZlY3RvcjIoIC0gSW5maW5pdHksIC0gSW5maW5pdHkgKSApIHsKCgkJdGhpcy5pc0JveDIgPSB0cnVlOwoKCQl0aGlzLm1pbiA9IG1pbjsKCQl0aGlzLm1heCA9IG1heDsKCgl9CgoJc2V0KCBtaW4sIG1heCApIHsKCgkJdGhpcy5taW4uY29weSggbWluICk7CgkJdGhpcy5tYXguY29weSggbWF4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tUG9pbnRzKCBwb2ludHMgKSB7CgoJCXRoaXMubWFrZUVtcHR5KCk7CgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIHBvaW50c1sgaSBdICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21DZW50ZXJBbmRTaXplKCBjZW50ZXIsIHNpemUgKSB7CgoJCWNvbnN0IGhhbGZTaXplID0gX3ZlY3RvciQ0LmNvcHkoIHNpemUgKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgkJdGhpcy5taW4uY29weSggY2VudGVyICkuc3ViKCBoYWxmU2l6ZSApOwoJCXRoaXMubWF4LmNvcHkoIGNlbnRlciApLmFkZCggaGFsZlNpemUgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKCWNvcHkoIGJveCApIHsKCgkJdGhpcy5taW4uY29weSggYm94Lm1pbiApOwoJCXRoaXMubWF4LmNvcHkoIGJveC5tYXggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW1ha2VFbXB0eSgpIHsKCgkJdGhpcy5taW4ueCA9IHRoaXMubWluLnkgPSArIEluZmluaXR5OwoJCXRoaXMubWF4LnggPSB0aGlzLm1heC55ID0gLSBJbmZpbml0eTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWlzRW1wdHkoKSB7CgoJCS8vIHRoaXMgaXMgYSBtb3JlIHJvYnVzdCBjaGVjayBmb3IgZW1wdHkgdGhhbiAoIHZvbHVtZSA8PSAwICkgYmVjYXVzZSB2b2x1bWUgY2FuIGdldCBwb3NpdGl2ZSB3aXRoIHR3byBuZWdhdGl2ZSBheGVzCgoJCXJldHVybiAoIHRoaXMubWF4LnggPCB0aGlzLm1pbi54ICkgfHwgKCB0aGlzLm1heC55IDwgdGhpcy5taW4ueSApOwoKCX0KCglnZXRDZW50ZXIoIHRhcmdldCApIHsKCgkJcmV0dXJuIHRoaXMuaXNFbXB0eSgpID8gdGFyZ2V0LnNldCggMCwgMCApIDogdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMubWluLCB0aGlzLm1heCApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCgl9CgoJZ2V0U2l6ZSggdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGhpcy5pc0VtcHR5KCkgPyB0YXJnZXQuc2V0KCAwLCAwICkgOiB0YXJnZXQuc3ViVmVjdG9ycyggdGhpcy5tYXgsIHRoaXMubWluICk7CgoJfQoKCWV4cGFuZEJ5UG9pbnQoIHBvaW50ICkgewoKCQl0aGlzLm1pbi5taW4oIHBvaW50ICk7CgkJdGhpcy5tYXgubWF4KCBwb2ludCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXhwYW5kQnlWZWN0b3IoIHZlY3RvciApIHsKCgkJdGhpcy5taW4uc3ViKCB2ZWN0b3IgKTsKCQl0aGlzLm1heC5hZGQoIHZlY3RvciApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXhwYW5kQnlTY2FsYXIoIHNjYWxhciApIHsKCgkJdGhpcy5taW4uYWRkU2NhbGFyKCAtIHNjYWxhciApOwoJCXRoaXMubWF4LmFkZFNjYWxhciggc2NhbGFyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb250YWluc1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuIHBvaW50LnggPCB0aGlzLm1pbi54IHx8IHBvaW50LnggPiB0aGlzLm1heC54IHx8CgkJCXBvaW50LnkgPCB0aGlzLm1pbi55IHx8IHBvaW50LnkgPiB0aGlzLm1heC55ID8gZmFsc2UgOiB0cnVlOwoKCX0KCgljb250YWluc0JveCggYm94ICkgewoKCQlyZXR1cm4gdGhpcy5taW4ueCA8PSBib3gubWluLnggJiYgYm94Lm1heC54IDw9IHRoaXMubWF4LnggJiYKCQkJdGhpcy5taW4ueSA8PSBib3gubWluLnkgJiYgYm94Lm1heC55IDw9IHRoaXMubWF4Lnk7CgoJfQoKCWdldFBhcmFtZXRlciggcG9pbnQsIHRhcmdldCApIHsKCgkJLy8gVGhpcyBjYW4gcG90ZW50aWFsbHkgaGF2ZSBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBib3gKCQkvLyBoYXMgYSBzaXplIGRpbWVuc2lvbiBvZiAwLgoKCQlyZXR1cm4gdGFyZ2V0LnNldCgKCQkJKCBwb2ludC54IC0gdGhpcy5taW4ueCApIC8gKCB0aGlzLm1heC54IC0gdGhpcy5taW4ueCApLAoJCQkoIHBvaW50LnkgLSB0aGlzLm1pbi55ICkgLyAoIHRoaXMubWF4LnkgLSB0aGlzLm1pbi55ICkKCQkpOwoKCX0KCglpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCS8vIHVzaW5nIDQgc3BsaXR0aW5nIHBsYW5lcyB0byBydWxlIG91dCBpbnRlcnNlY3Rpb25zCgoJCXJldHVybiBib3gubWF4LnggPCB0aGlzLm1pbi54IHx8IGJveC5taW4ueCA+IHRoaXMubWF4LnggfHwKCQkJYm94Lm1heC55IDwgdGhpcy5taW4ueSB8fCBib3gubWluLnkgPiB0aGlzLm1heC55ID8gZmFsc2UgOiB0cnVlOwoKCX0KCgljbGFtcFBvaW50KCBwb2ludCwgdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHBvaW50ICkuY2xhbXAoIHRoaXMubWluLCB0aGlzLm1heCApOwoKCX0KCglkaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgewoKCQlyZXR1cm4gdGhpcy5jbGFtcFBvaW50KCBwb2ludCwgX3ZlY3RvciQ0ICkuZGlzdGFuY2VUbyggcG9pbnQgKTsKCgl9CgoJaW50ZXJzZWN0KCBib3ggKSB7CgoJCXRoaXMubWluLm1heCggYm94Lm1pbiApOwoJCXRoaXMubWF4Lm1pbiggYm94Lm1heCApOwoKCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgdGhpcy5tYWtlRW1wdHkoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXVuaW9uKCBib3ggKSB7CgoJCXRoaXMubWluLm1pbiggYm94Lm1pbiApOwoJCXRoaXMubWF4Lm1heCggYm94Lm1heCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdHJhbnNsYXRlKCBvZmZzZXQgKSB7CgoJCXRoaXMubWluLmFkZCggb2Zmc2V0ICk7CgkJdGhpcy5tYXguYWRkKCBvZmZzZXQgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWVxdWFscyggYm94ICkgewoKCQlyZXR1cm4gYm94Lm1pbi5lcXVhbHMoIHRoaXMubWluICkgJiYgYm94Lm1heC5lcXVhbHMoIHRoaXMubWF4ICk7CgoJfQoKfQoKY29uc3QgX3N0YXJ0UCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3N0YXJ0RW5kID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY2xhc3MgTGluZTMgewoKCWNvbnN0cnVjdG9yKCBzdGFydCA9IG5ldyBWZWN0b3IzKCksIGVuZCA9IG5ldyBWZWN0b3IzKCkgKSB7CgoJCXRoaXMuc3RhcnQgPSBzdGFydDsKCQl0aGlzLmVuZCA9IGVuZDsKCgl9CgoJc2V0KCBzdGFydCwgZW5kICkgewoKCQl0aGlzLnN0YXJ0LmNvcHkoIHN0YXJ0ICk7CgkJdGhpcy5lbmQuY29weSggZW5kICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb3B5KCBsaW5lICkgewoKCQl0aGlzLnN0YXJ0LmNvcHkoIGxpbmUuc3RhcnQgKTsKCQl0aGlzLmVuZC5jb3B5KCBsaW5lLmVuZCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0Q2VudGVyKCB0YXJnZXQgKSB7CgoJCXJldHVybiB0YXJnZXQuYWRkVmVjdG9ycyggdGhpcy5zdGFydCwgdGhpcy5lbmQgKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgoJfQoKCWRlbHRhKCB0YXJnZXQgKSB7CgoJCXJldHVybiB0YXJnZXQuc3ViVmVjdG9ycyggdGhpcy5lbmQsIHRoaXMuc3RhcnQgKTsKCgl9CgoJZGlzdGFuY2VTcSgpIHsKCgkJcmV0dXJuIHRoaXMuc3RhcnQuZGlzdGFuY2VUb1NxdWFyZWQoIHRoaXMuZW5kICk7CgoJfQoKCWRpc3RhbmNlKCkgewoKCQlyZXR1cm4gdGhpcy5zdGFydC5kaXN0YW5jZVRvKCB0aGlzLmVuZCApOwoKCX0KCglhdCggdCwgdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGhpcy5kZWx0YSggdGFyZ2V0ICkubXVsdGlwbHlTY2FsYXIoIHQgKS5hZGQoIHRoaXMuc3RhcnQgKTsKCgl9CgoJY2xvc2VzdFBvaW50VG9Qb2ludFBhcmFtZXRlciggcG9pbnQsIGNsYW1wVG9MaW5lICkgewoKCQlfc3RhcnRQLnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLnN0YXJ0ICk7CgkJX3N0YXJ0RW5kLnN1YlZlY3RvcnMoIHRoaXMuZW5kLCB0aGlzLnN0YXJ0ICk7CgoJCWNvbnN0IHN0YXJ0RW5kMiA9IF9zdGFydEVuZC5kb3QoIF9zdGFydEVuZCApOwoJCWNvbnN0IHN0YXJ0RW5kX3N0YXJ0UCA9IF9zdGFydEVuZC5kb3QoIF9zdGFydFAgKTsKCgkJbGV0IHQgPSBzdGFydEVuZF9zdGFydFAgLyBzdGFydEVuZDI7CgoJCWlmICggY2xhbXBUb0xpbmUgKSB7CgoJCQl0ID0gY2xhbXAoIHQsIDAsIDEgKTsKCgkJfQoKCQlyZXR1cm4gdDsKCgl9CgoJY2xvc2VzdFBvaW50VG9Qb2ludCggcG9pbnQsIGNsYW1wVG9MaW5lLCB0YXJnZXQgKSB7CgoJCWNvbnN0IHQgPSB0aGlzLmNsb3Nlc3RQb2ludFRvUG9pbnRQYXJhbWV0ZXIoIHBvaW50LCBjbGFtcFRvTGluZSApOwoKCQlyZXR1cm4gdGhpcy5kZWx0YSggdGFyZ2V0ICkubXVsdGlwbHlTY2FsYXIoIHQgKS5hZGQoIHRoaXMuc3RhcnQgKTsKCgl9CgoJYXBwbHlNYXRyaXg0KCBtYXRyaXggKSB7CgoJCXRoaXMuc3RhcnQuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsKCQl0aGlzLmVuZC5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCBsaW5lICkgewoKCQlyZXR1cm4gbGluZS5zdGFydC5lcXVhbHMoIHRoaXMuc3RhcnQgKSAmJiBsaW5lLmVuZC5lcXVhbHMoIHRoaXMuZW5kICk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKfQoKY29uc3QgX3ZlY3RvciQzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY2xhc3MgU3BvdExpZ2h0SGVscGVyIGV4dGVuZHMgT2JqZWN0M0QgewoKCWNvbnN0cnVjdG9yKCBsaWdodCwgY29sb3IgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMubGlnaHQgPSBsaWdodDsKCgkJdGhpcy5tYXRyaXggPSBsaWdodC5tYXRyaXhXb3JsZDsKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy5jb2xvciA9IGNvbG9yOwoKCQl0aGlzLnR5cGUgPSAnU3BvdExpZ2h0SGVscGVyJzsKCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJY29uc3QgcG9zaXRpb25zID0gWwoJCQkwLCAwLCAwLCAJMCwgMCwgMSwKCQkJMCwgMCwgMCwgCTEsIDAsIDEsCgkJCTAsIDAsIDAsCS0gMSwgMCwgMSwKCQkJMCwgMCwgMCwgCTAsIDEsIDEsCgkJCTAsIDAsIDAsIAkwLCAtIDEsIDEKCQldOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGogPSAxLCBsID0gMzI7IGkgPCBsOyBpICsrLCBqICsrICkgewoKCQkJY29uc3QgcDEgPSAoIGkgLyBsICkgKiBNYXRoLlBJICogMjsKCQkJY29uc3QgcDIgPSAoIGogLyBsICkgKiBNYXRoLlBJICogMjsKCgkJCXBvc2l0aW9ucy5wdXNoKAoJCQkJTWF0aC5jb3MoIHAxICksIE1hdGguc2luKCBwMSApLCAxLAoJCQkJTWF0aC5jb3MoIHAyICksIE1hdGguc2luKCBwMiApLCAxCgkJCSk7CgoJCX0KCgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25zLCAzICkgKTsKCgkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgZm9nOiBmYWxzZSwgdG9uZU1hcHBlZDogZmFsc2UgfSApOwoKCQl0aGlzLmNvbmUgPSBuZXcgTGluZVNlZ21lbnRzKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCQl0aGlzLmFkZCggdGhpcy5jb25lICk7CgoJCXRoaXMudXBkYXRlKCk7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuY29uZS5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5jb25lLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9CgoJdXBkYXRlKCkgewoKCQl0aGlzLmxpZ2h0LnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoJCXRoaXMubGlnaHQudGFyZ2V0LnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQljb25zdCBjb25lTGVuZ3RoID0gdGhpcy5saWdodC5kaXN0YW5jZSA/IHRoaXMubGlnaHQuZGlzdGFuY2UgOiAxMDAwOwoJCWNvbnN0IGNvbmVXaWR0aCA9IGNvbmVMZW5ndGggKiBNYXRoLnRhbiggdGhpcy5saWdodC5hbmdsZSApOwoKCQl0aGlzLmNvbmUuc2NhbGUuc2V0KCBjb25lV2lkdGgsIGNvbmVXaWR0aCwgY29uZUxlbmd0aCApOwoKCQlfdmVjdG9yJDMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLmxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwoKCQl0aGlzLmNvbmUubG9va0F0KCBfdmVjdG9yJDMgKTsKCgkJaWYgKCB0aGlzLmNvbG9yICE9PSB1bmRlZmluZWQgKSB7CgoJCQl0aGlzLmNvbmUubWF0ZXJpYWwuY29sb3Iuc2V0KCB0aGlzLmNvbG9yICk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLmNvbmUubWF0ZXJpYWwuY29sb3IuY29weSggdGhpcy5saWdodC5jb2xvciApOwoKCQl9CgoJfQoKfQoKY29uc3QgX3ZlY3RvciQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfYm9uZU1hdHJpeCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX21hdHJpeFdvcmxkSW52ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKCmNsYXNzIFNrZWxldG9uSGVscGVyIGV4dGVuZHMgTGluZVNlZ21lbnRzIHsKCgljb25zdHJ1Y3Rvciggb2JqZWN0ICkgewoKCQljb25zdCBib25lcyA9IGdldEJvbmVMaXN0KCBvYmplY3QgKTsKCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBjb2xvcnMgPSBbXTsKCgkJY29uc3QgY29sb3IxID0gbmV3IENvbG9yKCAwLCAwLCAxICk7CgkJY29uc3QgY29sb3IyID0gbmV3IENvbG9yKCAwLCAxLCAwICk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGJvbmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCWNvbnN0IGJvbmUgPSBib25lc1sgaSBdOwoKCQkJaWYgKCBib25lLnBhcmVudCAmJiBib25lLnBhcmVudC5pc0JvbmUgKSB7CgoJCQkJdmVydGljZXMucHVzaCggMCwgMCwgMCApOwoJCQkJdmVydGljZXMucHVzaCggMCwgMCwgMCApOwoJCQkJY29sb3JzLnB1c2goIGNvbG9yMS5yLCBjb2xvcjEuZywgY29sb3IxLmIgKTsKCQkJCWNvbG9ycy5wdXNoKCBjb2xvcjIuciwgY29sb3IyLmcsIGNvbG9yMi5iICk7CgoJCQl9CgoJCX0KCgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ2NvbG9yJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGNvbG9ycywgMyApICk7CgoJCWNvbnN0IG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IHZlcnRleENvbG9yczogdHJ1ZSwgZGVwdGhUZXN0OiBmYWxzZSwgZGVwdGhXcml0ZTogZmFsc2UsIHRvbmVNYXBwZWQ6IGZhbHNlLCB0cmFuc3BhcmVudDogdHJ1ZSB9ICk7CgoJCXN1cGVyKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy5pc1NrZWxldG9uSGVscGVyID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1NrZWxldG9uSGVscGVyJzsKCgkJdGhpcy5yb290ID0gb2JqZWN0OwoJCXRoaXMuYm9uZXMgPSBib25lczsKCgkJdGhpcy5tYXRyaXggPSBvYmplY3QubWF0cml4V29ybGQ7CgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJfQoKCXVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApIHsKCgkJY29uc3QgYm9uZXMgPSB0aGlzLmJvbmVzOwoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCgkJX21hdHJpeFdvcmxkSW52LmNvcHkoIHRoaXMucm9vdC5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGogPSAwOyBpIDwgYm9uZXMubGVuZ3RoOyBpICsrICkgewoKCQkJY29uc3QgYm9uZSA9IGJvbmVzWyBpIF07CgoJCQlpZiAoIGJvbmUucGFyZW50ICYmIGJvbmUucGFyZW50LmlzQm9uZSApIHsKCgkJCQlfYm9uZU1hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCBfbWF0cml4V29ybGRJbnYsIGJvbmUubWF0cml4V29ybGQgKTsKCQkJCV92ZWN0b3IkMi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIF9ib25lTWF0cml4ICk7CgkJCQlwb3NpdGlvbi5zZXRYWVooIGosIF92ZWN0b3IkMi54LCBfdmVjdG9yJDIueSwgX3ZlY3RvciQyLnogKTsKCgkJCQlfYm9uZU1hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCBfbWF0cml4V29ybGRJbnYsIGJvbmUucGFyZW50Lm1hdHJpeFdvcmxkICk7CgkJCQlfdmVjdG9yJDIuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBfYm9uZU1hdHJpeCApOwoJCQkJcG9zaXRpb24uc2V0WFlaKCBqICsgMSwgX3ZlY3RvciQyLngsIF92ZWN0b3IkMi55LCBfdmVjdG9yJDIueiApOwoKCQkJCWogKz0gMjsKCgkJCX0KCgkJfQoKCQlnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCXN1cGVyLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9Cgp9CgoKZnVuY3Rpb24gZ2V0Qm9uZUxpc3QoIG9iamVjdCApIHsKCgljb25zdCBib25lTGlzdCA9IFtdOwoKCWlmICggb2JqZWN0LmlzQm9uZSA9PT0gdHJ1ZSApIHsKCgkJYm9uZUxpc3QucHVzaCggb2JqZWN0ICk7CgoJfQoKCWZvciAoIGxldCBpID0gMDsgaSA8IG9iamVjdC5jaGlsZHJlbi5sZW5ndGg7IGkgKysgKSB7CgoJCWJvbmVMaXN0LnB1c2guYXBwbHkoIGJvbmVMaXN0LCBnZXRCb25lTGlzdCggb2JqZWN0LmNoaWxkcmVuWyBpIF0gKSApOwoKCX0KCglyZXR1cm4gYm9uZUxpc3Q7Cgp9CgpjbGFzcyBQb2ludExpZ2h0SGVscGVyIGV4dGVuZHMgTWVzaCB7CgoJY29uc3RydWN0b3IoIGxpZ2h0LCBzcGhlcmVTaXplLCBjb2xvciApIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgU3BoZXJlR2VvbWV0cnkoIHNwaGVyZVNpemUsIDQsIDIgKTsKCQljb25zdCBtYXRlcmlhbCA9IG5ldyBNZXNoQmFzaWNNYXRlcmlhbCggeyB3aXJlZnJhbWU6IHRydWUsIGZvZzogZmFsc2UsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKTsKCgkJc3VwZXIoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLmxpZ2h0ID0gbGlnaHQ7CgoJCXRoaXMuY29sb3IgPSBjb2xvcjsKCgkJdGhpcy50eXBlID0gJ1BvaW50TGlnaHRIZWxwZXInOwoKCQl0aGlzLm1hdHJpeCA9IHRoaXMubGlnaHQubWF0cml4V29ybGQ7CgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMudXBkYXRlKCk7CgoKCQkvKgoJLy8gVE9ETzogZGVsZXRlIHRoaXMgY29tbWVudD8KCWNvbnN0IGRpc3RhbmNlR2VvbWV0cnkgPSBuZXcgVEhSRUUuSWNvc2FoZWRyb25HZW9tZXRyeSggMSwgMiApOwoJY29uc3QgZGlzdGFuY2VNYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogaGV4Q29sb3IsIGZvZzogZmFsc2UsIHdpcmVmcmFtZTogdHJ1ZSwgb3BhY2l0eTogMC4xLCB0cmFuc3BhcmVudDogdHJ1ZSB9ICk7CgoJdGhpcy5saWdodFNwaGVyZSA9IG5ldyBUSFJFRS5NZXNoKCBidWxiR2VvbWV0cnksIGJ1bGJNYXRlcmlhbCApOwoJdGhpcy5saWdodERpc3RhbmNlID0gbmV3IFRIUkVFLk1lc2goIGRpc3RhbmNlR2VvbWV0cnksIGRpc3RhbmNlTWF0ZXJpYWwgKTsKCgljb25zdCBkID0gbGlnaHQuZGlzdGFuY2U7CgoJaWYgKCBkID09PSAwLjAgKSB7CgoJCXRoaXMubGlnaHREaXN0YW5jZS52aXNpYmxlID0gZmFsc2U7CgoJfSBlbHNlIHsKCgkJdGhpcy5saWdodERpc3RhbmNlLnNjYWxlLnNldCggZCwgZCwgZCApOwoKCX0KCgl0aGlzLmFkZCggdGhpcy5saWdodERpc3RhbmNlICk7CgkqLwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9CgoJdXBkYXRlKCkgewoKCQl0aGlzLmxpZ2h0LnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQlpZiAoIHRoaXMuY29sb3IgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMubWF0ZXJpYWwuY29sb3Iuc2V0KCB0aGlzLmNvbG9yICk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLm1hdGVyaWFsLmNvbG9yLmNvcHkoIHRoaXMubGlnaHQuY29sb3IgKTsKCgkJfQoKCQkvKgoJCWNvbnN0IGQgPSB0aGlzLmxpZ2h0LmRpc3RhbmNlOwoKCQlpZiAoIGQgPT09IDAuMCApIHsKCgkJCXRoaXMubGlnaHREaXN0YW5jZS52aXNpYmxlID0gZmFsc2U7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLmxpZ2h0RGlzdGFuY2UudmlzaWJsZSA9IHRydWU7CgkJCXRoaXMubGlnaHREaXN0YW5jZS5zY2FsZS5zZXQoIGQsIGQsIGQgKTsKCgkJfQoJCSovCgoJfQoKfQoKY29uc3QgX3ZlY3RvciQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfY29sb3IxID0gLypAX19QVVJFX18qLyBuZXcgQ29sb3IoKTsKY29uc3QgX2NvbG9yMiA9IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCk7CgpjbGFzcyBIZW1pc3BoZXJlTGlnaHRIZWxwZXIgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoIGxpZ2h0LCBzaXplLCBjb2xvciApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5saWdodCA9IGxpZ2h0OwoKCQl0aGlzLm1hdHJpeCA9IGxpZ2h0Lm1hdHJpeFdvcmxkOwoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLmNvbG9yID0gY29sb3I7CgoJCXRoaXMudHlwZSA9ICdIZW1pc3BoZXJlTGlnaHRIZWxwZXInOwoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBPY3RhaGVkcm9uR2VvbWV0cnkoIHNpemUgKTsKCQlnZW9tZXRyeS5yb3RhdGVZKCBNYXRoLlBJICogMC41ICk7CgoJCXRoaXMubWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoIHsgd2lyZWZyYW1lOiB0cnVlLCBmb2c6IGZhbHNlLCB0b25lTWFwcGVkOiBmYWxzZSB9ICk7CgkJaWYgKCB0aGlzLmNvbG9yID09PSB1bmRlZmluZWQgKSB0aGlzLm1hdGVyaWFsLnZlcnRleENvbG9ycyA9IHRydWU7CgoJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCAncG9zaXRpb24nICk7CgkJY29uc3QgY29sb3JzID0gbmV3IEZsb2F0MzJBcnJheSggcG9zaXRpb24uY291bnQgKiAzICk7CgoJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ2NvbG9yJywgbmV3IEJ1ZmZlckF0dHJpYnV0ZSggY29sb3JzLCAzICkgKTsKCgkJdGhpcy5hZGQoIG5ldyBNZXNoKCBnZW9tZXRyeSwgdGhpcy5tYXRlcmlhbCApICk7CgoJCXRoaXMudXBkYXRlKCk7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuY2hpbGRyZW5bIDAgXS5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5jaGlsZHJlblsgMCBdLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9CgoJdXBkYXRlKCkgewoKCQljb25zdCBtZXNoID0gdGhpcy5jaGlsZHJlblsgMCBdOwoKCQlpZiAoIHRoaXMuY29sb3IgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMubWF0ZXJpYWwuY29sb3Iuc2V0KCB0aGlzLmNvbG9yICk7CgoJCX0gZWxzZSB7CgoJCQljb25zdCBjb2xvcnMgPSBtZXNoLmdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ2NvbG9yJyApOwoKCQkJX2NvbG9yMS5jb3B5KCB0aGlzLmxpZ2h0LmNvbG9yICk7CgkJCV9jb2xvcjIuY29weSggdGhpcy5saWdodC5ncm91bmRDb2xvciApOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY29sb3JzLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBjb2xvciA9ICggaSA8ICggbCAvIDIgKSApID8gX2NvbG9yMSA6IF9jb2xvcjI7CgoJCQkJY29sb3JzLnNldFhZWiggaSwgY29sb3IuciwgY29sb3IuZywgY29sb3IuYiApOwoKCQkJfQoKCQkJY29sb3JzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJfQoKCQl0aGlzLmxpZ2h0LnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQltZXNoLmxvb2tBdCggX3ZlY3RvciQxLnNldEZyb21NYXRyaXhQb3NpdGlvbiggdGhpcy5saWdodC5tYXRyaXhXb3JsZCApLm5lZ2F0ZSgpICk7CgoJfQoKfQoKY2xhc3MgR3JpZEhlbHBlciBleHRlbmRzIExpbmVTZWdtZW50cyB7CgoJY29uc3RydWN0b3IoIHNpemUgPSAxMCwgZGl2aXNpb25zID0gMTAsIGNvbG9yMSA9IDB4NDQ0NDQ0LCBjb2xvcjIgPSAweDg4ODg4OCApIHsKCgkJY29sb3IxID0gbmV3IENvbG9yKCBjb2xvcjEgKTsKCQljb2xvcjIgPSBuZXcgQ29sb3IoIGNvbG9yMiApOwoKCQljb25zdCBjZW50ZXIgPSBkaXZpc2lvbnMgLyAyOwoJCWNvbnN0IHN0ZXAgPSBzaXplIC8gZGl2aXNpb25zOwoJCWNvbnN0IGhhbGZTaXplID0gc2l6ZSAvIDI7CgoJCWNvbnN0IHZlcnRpY2VzID0gW10sIGNvbG9ycyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGogPSAwLCBrID0gLSBoYWxmU2l6ZTsgaSA8PSBkaXZpc2lvbnM7IGkgKyssIGsgKz0gc3RlcCApIHsKCgkJCXZlcnRpY2VzLnB1c2goIC0gaGFsZlNpemUsIDAsIGssIGhhbGZTaXplLCAwLCBrICk7CgkJCXZlcnRpY2VzLnB1c2goIGssIDAsIC0gaGFsZlNpemUsIGssIDAsIGhhbGZTaXplICk7CgoJCQljb25zdCBjb2xvciA9IGkgPT09IGNlbnRlciA/IGNvbG9yMSA6IGNvbG9yMjsKCgkJCWNvbG9yLnRvQXJyYXkoIGNvbG9ycywgaiApOyBqICs9IDM7CgkJCWNvbG9yLnRvQXJyYXkoIGNvbG9ycywgaiApOyBqICs9IDM7CgkJCWNvbG9yLnRvQXJyYXkoIGNvbG9ycywgaiApOyBqICs9IDM7CgkJCWNvbG9yLnRvQXJyYXkoIGNvbG9ycywgaiApOyBqICs9IDM7CgoJCX0KCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAnY29sb3InLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggY29sb3JzLCAzICkgKTsKCgkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgdmVydGV4Q29sb3JzOiB0cnVlLCB0b25lTWFwcGVkOiBmYWxzZSB9ICk7CgoJCXN1cGVyKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy50eXBlID0gJ0dyaWRIZWxwZXInOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9Cgp9CgpjbGFzcyBQb2xhckdyaWRIZWxwZXIgZXh0ZW5kcyBMaW5lU2VnbWVudHMgewoKCWNvbnN0cnVjdG9yKCByYWRpdXMgPSAxMCwgc2VjdG9ycyA9IDE2LCByaW5ncyA9IDgsIGRpdmlzaW9ucyA9IDY0LCBjb2xvcjEgPSAweDQ0NDQ0NCwgY29sb3IyID0gMHg4ODg4ODggKSB7CgoJCWNvbG9yMSA9IG5ldyBDb2xvciggY29sb3IxICk7CgkJY29sb3IyID0gbmV3IENvbG9yKCBjb2xvcjIgKTsKCgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBjb2xvcnMgPSBbXTsKCgkJLy8gY3JlYXRlIHRoZSBzZWN0b3JzCgoJCWlmICggc2VjdG9ycyA+IDEgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBzZWN0b3JzOyBpICsrICkgewoKCQkJCWNvbnN0IHYgPSAoIGkgLyBzZWN0b3JzICkgKiAoIE1hdGguUEkgKiAyICk7CgoJCQkJY29uc3QgeCA9IE1hdGguc2luKCB2ICkgKiByYWRpdXM7CgkJCQljb25zdCB6ID0gTWF0aC5jb3MoIHYgKSAqIHJhZGl1czsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCAwLCAwLCAwICk7CgkJCQl2ZXJ0aWNlcy5wdXNoKCB4LCAwLCB6ICk7CgoJCQkJY29uc3QgY29sb3IgPSAoIGkgJiAxICkgPyBjb2xvcjEgOiBjb2xvcjI7CgoJCQkJY29sb3JzLnB1c2goIGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIgKTsKCQkJCWNvbG9ycy5wdXNoKCBjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iICk7CgoJCQl9CgoJCX0KCgkJLy8gY3JlYXRlIHRoZSByaW5ncwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCByaW5nczsgaSArKyApIHsKCgkJCWNvbnN0IGNvbG9yID0gKCBpICYgMSApID8gY29sb3IxIDogY29sb3IyOwoKCQkJY29uc3QgciA9IHJhZGl1cyAtICggcmFkaXVzIC8gcmluZ3MgKiBpICk7CgoJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCBkaXZpc2lvbnM7IGogKysgKSB7CgoJCQkJLy8gZmlyc3QgdmVydGV4CgoJCQkJbGV0IHYgPSAoIGogLyBkaXZpc2lvbnMgKSAqICggTWF0aC5QSSAqIDIgKTsKCgkJCQlsZXQgeCA9IE1hdGguc2luKCB2ICkgKiByOwoJCQkJbGV0IHogPSBNYXRoLmNvcyggdiApICogcjsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB4LCAwLCB6ICk7CgkJCQljb2xvcnMucHVzaCggY29sb3IuciwgY29sb3IuZywgY29sb3IuYiApOwoKCQkJCS8vIHNlY29uZCB2ZXJ0ZXgKCgkJCQl2ID0gKCAoIGogKyAxICkgLyBkaXZpc2lvbnMgKSAqICggTWF0aC5QSSAqIDIgKTsKCgkJCQl4ID0gTWF0aC5zaW4oIHYgKSAqIHI7CgkJCQl6ID0gTWF0aC5jb3MoIHYgKSAqIHI7CgoJCQkJdmVydGljZXMucHVzaCggeCwgMCwgeiApOwoJCQkJY29sb3JzLnB1c2goIGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIgKTsKCgkJCX0KCgkJfQoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdjb2xvcicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBjb2xvcnMsIDMgKSApOwoKCQljb25zdCBtYXRlcmlhbCA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyB2ZXJ0ZXhDb2xvcnM6IHRydWUsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKTsKCgkJc3VwZXIoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLnR5cGUgPSAnUG9sYXJHcmlkSGVscGVyJzsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJfQoKfQoKY29uc3QgX3YxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92MyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIERpcmVjdGlvbmFsTGlnaHRIZWxwZXIgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoIGxpZ2h0LCBzaXplLCBjb2xvciApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5saWdodCA9IGxpZ2h0OwoKCQl0aGlzLm1hdHJpeCA9IGxpZ2h0Lm1hdHJpeFdvcmxkOwoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLmNvbG9yID0gY29sb3I7CgoJCXRoaXMudHlwZSA9ICdEaXJlY3Rpb25hbExpZ2h0SGVscGVyJzsKCgkJaWYgKCBzaXplID09PSB1bmRlZmluZWQgKSBzaXplID0gMTsKCgkJbGV0IGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggWwoJCQktIHNpemUsIHNpemUsIDAsCgkJCXNpemUsIHNpemUsIDAsCgkJCXNpemUsIC0gc2l6ZSwgMCwKCQkJLSBzaXplLCAtIHNpemUsIDAsCgkJCS0gc2l6ZSwgc2l6ZSwgMAoJCV0sIDMgKSApOwoKCQljb25zdCBtYXRlcmlhbCA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBmb2c6IGZhbHNlLCB0b25lTWFwcGVkOiBmYWxzZSB9ICk7CgoJCXRoaXMubGlnaHRQbGFuZSA9IG5ldyBMaW5lKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCQl0aGlzLmFkZCggdGhpcy5saWdodFBsYW5lICk7CgoJCWdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggWyAwLCAwLCAwLCAwLCAwLCAxIF0sIDMgKSApOwoKCQl0aGlzLnRhcmdldExpbmUgPSBuZXcgTGluZSggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgkJdGhpcy5hZGQoIHRoaXMudGFyZ2V0TGluZSApOwoKCQl0aGlzLnVwZGF0ZSgpOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmxpZ2h0UGxhbmUuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubGlnaHRQbGFuZS5tYXRlcmlhbC5kaXNwb3NlKCk7CgkJdGhpcy50YXJnZXRMaW5lLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLnRhcmdldExpbmUubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCgl1cGRhdGUoKSB7CgoJCXRoaXMubGlnaHQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgkJdGhpcy5saWdodC50YXJnZXQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCV92MS5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubGlnaHQubWF0cml4V29ybGQgKTsKCQlfdjIuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLmxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwoJCV92My5zdWJWZWN0b3JzKCBfdjIsIF92MSApOwoKCQl0aGlzLmxpZ2h0UGxhbmUubG9va0F0KCBfdjIgKTsKCgkJaWYgKCB0aGlzLmNvbG9yICE9PSB1bmRlZmluZWQgKSB7CgoJCQl0aGlzLmxpZ2h0UGxhbmUubWF0ZXJpYWwuY29sb3Iuc2V0KCB0aGlzLmNvbG9yICk7CgkJCXRoaXMudGFyZ2V0TGluZS5tYXRlcmlhbC5jb2xvci5zZXQoIHRoaXMuY29sb3IgKTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMubGlnaHRQbGFuZS5tYXRlcmlhbC5jb2xvci5jb3B5KCB0aGlzLmxpZ2h0LmNvbG9yICk7CgkJCXRoaXMudGFyZ2V0TGluZS5tYXRlcmlhbC5jb2xvci5jb3B5KCB0aGlzLmxpZ2h0LmNvbG9yICk7CgoJCX0KCgkJdGhpcy50YXJnZXRMaW5lLmxvb2tBdCggX3YyICk7CgkJdGhpcy50YXJnZXRMaW5lLnNjYWxlLnogPSBfdjMubGVuZ3RoKCk7CgoJfQoKfQoKY29uc3QgX3ZlY3RvciA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX2NhbWVyYSA9IC8qQF9fUFVSRV9fKi8gbmV3IENhbWVyYSgpOwoKLyoqCiAqCS0gc2hvd3MgZnJ1c3R1bSwgbGluZSBvZiBzaWdodCBhbmQgdXAgb2YgdGhlIGNhbWVyYQogKgktIHN1aXRhYmxlIGZvciBmYXN0IHVwZGF0ZXMKICogCS0gYmFzZWQgb24gZnJ1c3R1bSB2aXN1YWxpemF0aW9uIGluIGxpZ2h0Z2wuanMgc2hhZG93bWFwIGV4YW1wbGUKICoJCWh0dHBzOi8vZ2l0aHViLmNvbS9ldmFudy9saWdodGdsLmpzL2Jsb2IvbWFzdGVyL3Rlc3RzL3NoYWRvd21hcC5odG1sCiAqLwoKY2xhc3MgQ2FtZXJhSGVscGVyIGV4dGVuZHMgTGluZVNlZ21lbnRzIHsKCgljb25zdHJ1Y3RvciggY2FtZXJhICkgewoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWNvbnN0IG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweGZmZmZmZiwgdmVydGV4Q29sb3JzOiB0cnVlLCB0b25lTWFwcGVkOiBmYWxzZSB9ICk7CgoJCWNvbnN0IHZlcnRpY2VzID0gW107CgkJY29uc3QgY29sb3JzID0gW107CgoJCWNvbnN0IHBvaW50TWFwID0ge307CgoJCS8vIG5lYXIKCgkJYWRkTGluZSggJ24xJywgJ24yJyApOwoJCWFkZExpbmUoICduMicsICduNCcgKTsKCQlhZGRMaW5lKCAnbjQnLCAnbjMnICk7CgkJYWRkTGluZSggJ24zJywgJ24xJyApOwoKCQkvLyBmYXIKCgkJYWRkTGluZSggJ2YxJywgJ2YyJyApOwoJCWFkZExpbmUoICdmMicsICdmNCcgKTsKCQlhZGRMaW5lKCAnZjQnLCAnZjMnICk7CgkJYWRkTGluZSggJ2YzJywgJ2YxJyApOwoKCQkvLyBzaWRlcwoKCQlhZGRMaW5lKCAnbjEnLCAnZjEnICk7CgkJYWRkTGluZSggJ24yJywgJ2YyJyApOwoJCWFkZExpbmUoICduMycsICdmMycgKTsKCQlhZGRMaW5lKCAnbjQnLCAnZjQnICk7CgoJCS8vIGNvbmUKCgkJYWRkTGluZSggJ3AnLCAnbjEnICk7CgkJYWRkTGluZSggJ3AnLCAnbjInICk7CgkJYWRkTGluZSggJ3AnLCAnbjMnICk7CgkJYWRkTGluZSggJ3AnLCAnbjQnICk7CgoJCS8vIHVwCgoJCWFkZExpbmUoICd1MScsICd1MicgKTsKCQlhZGRMaW5lKCAndTInLCAndTMnICk7CgkJYWRkTGluZSggJ3UzJywgJ3UxJyApOwoKCQkvLyB0YXJnZXQKCgkJYWRkTGluZSggJ2MnLCAndCcgKTsKCQlhZGRMaW5lKCAncCcsICdjJyApOwoKCQkvLyBjcm9zcwoKCQlhZGRMaW5lKCAnY24xJywgJ2NuMicgKTsKCQlhZGRMaW5lKCAnY24zJywgJ2NuNCcgKTsKCgkJYWRkTGluZSggJ2NmMScsICdjZjInICk7CgkJYWRkTGluZSggJ2NmMycsICdjZjQnICk7CgoJCWZ1bmN0aW9uIGFkZExpbmUoIGEsIGIgKSB7CgoJCQlhZGRQb2ludCggYSApOwoJCQlhZGRQb2ludCggYiApOwoKCQl9CgoJCWZ1bmN0aW9uIGFkZFBvaW50KCBpZCApIHsKCgkJCXZlcnRpY2VzLnB1c2goIDAsIDAsIDAgKTsKCQkJY29sb3JzLnB1c2goIDAsIDAsIDAgKTsKCgkJCWlmICggcG9pbnRNYXBbIGlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQlwb2ludE1hcFsgaWQgXSA9IFtdOwoKCQkJfQoKCQkJcG9pbnRNYXBbIGlkIF0ucHVzaCggKCB2ZXJ0aWNlcy5sZW5ndGggLyAzICkgLSAxICk7CgoJCX0KCgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ2NvbG9yJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGNvbG9ycywgMyApICk7CgoJCXN1cGVyKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy50eXBlID0gJ0NhbWVyYUhlbHBlcic7CgoJCXRoaXMuY2FtZXJhID0gY2FtZXJhOwoJCWlmICggdGhpcy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCApIHRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgkJdGhpcy5tYXRyaXggPSBjYW1lcmEubWF0cml4V29ybGQ7CgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMucG9pbnRNYXAgPSBwb2ludE1hcDsKCgkJdGhpcy51cGRhdGUoKTsKCgkJLy8gY29sb3JzCgoJCWNvbnN0IGNvbG9yRnJ1c3R1bSA9IG5ldyBDb2xvciggMHhmZmFhMDAgKTsKCQljb25zdCBjb2xvckNvbmUgPSBuZXcgQ29sb3IoIDB4ZmYwMDAwICk7CgkJY29uc3QgY29sb3JVcCA9IG5ldyBDb2xvciggMHgwMGFhZmYgKTsKCQljb25zdCBjb2xvclRhcmdldCA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsKCQljb25zdCBjb2xvckNyb3NzID0gbmV3IENvbG9yKCAweDMzMzMzMyApOwoKCQl0aGlzLnNldENvbG9ycyggY29sb3JGcnVzdHVtLCBjb2xvckNvbmUsIGNvbG9yVXAsIGNvbG9yVGFyZ2V0LCBjb2xvckNyb3NzICk7CgoJfQoKCXNldENvbG9ycyggZnJ1c3R1bSwgY29uZSwgdXAsIHRhcmdldCwgY3Jvc3MgKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCgkJY29uc3QgY29sb3JBdHRyaWJ1dGUgPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdjb2xvcicgKTsKCgkJLy8gbmVhcgoKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDAsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAxLCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IC8vIG4xLCBuMgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMiwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDMsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgLy8gbjIsIG40CgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA0LCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggNSwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyAvLyBuNCwgbjMKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDYsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA3LCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IC8vIG4zLCBuMQoKCQkvLyBmYXIKCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA4LCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggOSwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyAvLyBmMSwgZjIKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDEwLCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggMTEsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgLy8gZjIsIGY0CgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAxMiwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDEzLCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IC8vIGY0LCBmMwoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMTQsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAxNSwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyAvLyBmMywgZjEKCgkJLy8gc2lkZXMKCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAxNiwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDE3LCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IC8vIG4xLCBmMQoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMTgsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAxOSwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyAvLyBuMiwgZjIKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDIwLCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggMjEsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgLy8gbjMsIGYzCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAyMiwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDIzLCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IC8vIG40LCBmNAoKCQkvLyBjb25lCgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMjQsIGNvbmUuciwgY29uZS5nLCBjb25lLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAyNSwgY29uZS5yLCBjb25lLmcsIGNvbmUuYiApOyAvLyBwLCBuMQoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMjYsIGNvbmUuciwgY29uZS5nLCBjb25lLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAyNywgY29uZS5yLCBjb25lLmcsIGNvbmUuYiApOyAvLyBwLCBuMgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMjgsIGNvbmUuciwgY29uZS5nLCBjb25lLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAyOSwgY29uZS5yLCBjb25lLmcsIGNvbmUuYiApOyAvLyBwLCBuMwoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMzAsIGNvbmUuciwgY29uZS5nLCBjb25lLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAzMSwgY29uZS5yLCBjb25lLmcsIGNvbmUuYiApOyAvLyBwLCBuNAoKCQkvLyB1cAoKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDMyLCB1cC5yLCB1cC5nLCB1cC5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggMzMsIHVwLnIsIHVwLmcsIHVwLmIgKTsgLy8gdTEsIHUyCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAzNCwgdXAuciwgdXAuZywgdXAuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDM1LCB1cC5yLCB1cC5nLCB1cC5iICk7IC8vIHUyLCB1MwoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMzYsIHVwLnIsIHVwLmcsIHVwLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAzNywgdXAuciwgdXAuZywgdXAuYiApOyAvLyB1MywgdTEKCgkJLy8gdGFyZ2V0CgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMzgsIHRhcmdldC5yLCB0YXJnZXQuZywgdGFyZ2V0LmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAzOSwgdGFyZ2V0LnIsIHRhcmdldC5nLCB0YXJnZXQuYiApOyAvLyBjLCB0CgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA0MCwgY3Jvc3MuciwgY3Jvc3MuZywgY3Jvc3MuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDQxLCBjcm9zcy5yLCBjcm9zcy5nLCBjcm9zcy5iICk7IC8vIHAsIGMKCgkJLy8gY3Jvc3MKCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA0MiwgY3Jvc3MuciwgY3Jvc3MuZywgY3Jvc3MuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDQzLCBjcm9zcy5yLCBjcm9zcy5nLCBjcm9zcy5iICk7IC8vIGNuMSwgY24yCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA0NCwgY3Jvc3MuciwgY3Jvc3MuZywgY3Jvc3MuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDQ1LCBjcm9zcy5yLCBjcm9zcy5nLCBjcm9zcy5iICk7IC8vIGNuMywgY240CgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggNDYsIGNyb3NzLnIsIGNyb3NzLmcsIGNyb3NzLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA0NywgY3Jvc3MuciwgY3Jvc3MuZywgY3Jvc3MuYiApOyAvLyBjZjEsIGNmMgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggNDgsIGNyb3NzLnIsIGNyb3NzLmcsIGNyb3NzLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA0OSwgY3Jvc3MuciwgY3Jvc3MuZywgY3Jvc3MuYiApOyAvLyBjZjMsIGNmNAoKCQljb2xvckF0dHJpYnV0ZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCXVwZGF0ZSgpIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCWNvbnN0IHBvaW50TWFwID0gdGhpcy5wb2ludE1hcDsKCgkJY29uc3QgdyA9IDEsIGggPSAxOwoKCQkvLyB3ZSBuZWVkIGp1c3QgY2FtZXJhIHByb2plY3Rpb24gbWF0cml4IGludmVyc2UKCQkvLyB3b3JsZCBtYXRyaXggbXVzdCBiZSBpZGVudGl0eQoKCQlfY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMuY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgoJCS8vIGNlbnRlciAvIHRhcmdldAoKCQlzZXRQb2ludCggJ2MnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIDAsIDAsIC0gMSApOwoJCXNldFBvaW50KCAndCcsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgMCwgMCwgMSApOwoKCQkvLyBuZWFyCgoJCXNldFBvaW50KCAnbjEnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIC0gdywgLSBoLCAtIDEgKTsKCQlzZXRQb2ludCggJ24yJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCB3LCAtIGgsIC0gMSApOwoJCXNldFBvaW50KCAnbjMnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIC0gdywgaCwgLSAxICk7CgkJc2V0UG9pbnQoICduNCcsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgdywgaCwgLSAxICk7CgoJCS8vIGZhcgoKCQlzZXRQb2ludCggJ2YxJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCAtIHcsIC0gaCwgMSApOwoJCXNldFBvaW50KCAnZjInLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIHcsIC0gaCwgMSApOwoJCXNldFBvaW50KCAnZjMnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIC0gdywgaCwgMSApOwoJCXNldFBvaW50KCAnZjQnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIHcsIGgsIDEgKTsKCgkJLy8gdXAKCgkJc2V0UG9pbnQoICd1MScsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgdyAqIDAuNywgaCAqIDEuMSwgLSAxICk7CgkJc2V0UG9pbnQoICd1MicsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgLSB3ICogMC43LCBoICogMS4xLCAtIDEgKTsKCQlzZXRQb2ludCggJ3UzJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCAwLCBoICogMiwgLSAxICk7CgoJCS8vIGNyb3NzCgoJCXNldFBvaW50KCAnY2YxJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCAtIHcsIDAsIDEgKTsKCQlzZXRQb2ludCggJ2NmMicsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgdywgMCwgMSApOwoJCXNldFBvaW50KCAnY2YzJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCAwLCAtIGgsIDEgKTsKCQlzZXRQb2ludCggJ2NmNCcsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgMCwgaCwgMSApOwoKCQlzZXRQb2ludCggJ2NuMScsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgLSB3LCAwLCAtIDEgKTsKCQlzZXRQb2ludCggJ2NuMicsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgdywgMCwgLSAxICk7CgkJc2V0UG9pbnQoICdjbjMnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIDAsIC0gaCwgLSAxICk7CgkJc2V0UG9pbnQoICdjbjQnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIDAsIGgsIC0gMSApOwoKCQlnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCn0KCgpmdW5jdGlvbiBzZXRQb2ludCggcG9pbnQsIHBvaW50TWFwLCBnZW9tZXRyeSwgY2FtZXJhLCB4LCB5LCB6ICkgewoKCV92ZWN0b3Iuc2V0KCB4LCB5LCB6ICkudW5wcm9qZWN0KCBjYW1lcmEgKTsKCgljb25zdCBwb2ludHMgPSBwb2ludE1hcFsgcG9pbnQgXTsKCglpZiAoIHBvaW50cyAhPT0gdW5kZWZpbmVkICkgewoKCQljb25zdCBwb3NpdGlvbiA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBwb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCXBvc2l0aW9uLnNldFhZWiggcG9pbnRzWyBpIF0sIF92ZWN0b3IueCwgX3ZlY3Rvci55LCBfdmVjdG9yLnogKTsKCgkJfQoKCX0KCn0KCmNvbnN0IF9ib3ggPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CgpjbGFzcyBCb3hIZWxwZXIgZXh0ZW5kcyBMaW5lU2VnbWVudHMgewoKCWNvbnN0cnVjdG9yKCBvYmplY3QsIGNvbG9yID0gMHhmZmZmMDAgKSB7CgoJCWNvbnN0IGluZGljZXMgPSBuZXcgVWludDE2QXJyYXkoIFsgMCwgMSwgMSwgMiwgMiwgMywgMywgMCwgNCwgNSwgNSwgNiwgNiwgNywgNywgNCwgMCwgNCwgMSwgNSwgMiwgNiwgMywgNyBdICk7CgkJY29uc3QgcG9zaXRpb25zID0gbmV3IEZsb2F0MzJBcnJheSggOCAqIDMgKTsKCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeS5zZXRJbmRleCggbmV3IEJ1ZmZlckF0dHJpYnV0ZSggaW5kaWNlcywgMSApICk7CgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbnMsIDMgKSApOwoKCQlzdXBlciggZ2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKSApOwoKCQl0aGlzLm9iamVjdCA9IG9iamVjdDsKCQl0aGlzLnR5cGUgPSAnQm94SGVscGVyJzsKCgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMudXBkYXRlKCk7CgoJfQoKCXVwZGF0ZSggb2JqZWN0ICkgewoKCQlpZiAoIG9iamVjdCAhPT0gdW5kZWZpbmVkICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQm94SGVscGVyOiAudXBkYXRlKCkgaGFzIG5vIGxvbmdlciBhcmd1bWVudHMuJyApOwoKCQl9CgoJCWlmICggdGhpcy5vYmplY3QgIT09IHVuZGVmaW5lZCApIHsKCgkJCV9ib3guc2V0RnJvbU9iamVjdCggdGhpcy5vYmplY3QgKTsKCgkJfQoKCQlpZiAoIF9ib3guaXNFbXB0eSgpICkgcmV0dXJuOwoKCQljb25zdCBtaW4gPSBfYm94Lm1pbjsKCQljb25zdCBtYXggPSBfYm94Lm1heDsKCgkJLyoKCQkJNV9fX180CgkJMS9fX18wL3wKCQl8IDZfX3xfNwoJCTIvX19fMy8KCgkJMDogbWF4LngsIG1heC55LCBtYXguegoJCTE6IG1pbi54LCBtYXgueSwgbWF4LnoKCQkyOiBtaW4ueCwgbWluLnksIG1heC56CgkJMzogbWF4LngsIG1pbi55LCBtYXguegoJCTQ6IG1heC54LCBtYXgueSwgbWluLnoKCQk1OiBtaW4ueCwgbWF4LnksIG1pbi56CgkJNjogbWluLngsIG1pbi55LCBtaW4uegoJCTc6IG1heC54LCBtaW4ueSwgbWluLnoKCQkqLwoKCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQljb25zdCBhcnJheSA9IHBvc2l0aW9uLmFycmF5OwoKCQlhcnJheVsgMCBdID0gbWF4Lng7IGFycmF5WyAxIF0gPSBtYXgueTsgYXJyYXlbIDIgXSA9IG1heC56OwoJCWFycmF5WyAzIF0gPSBtaW4ueDsgYXJyYXlbIDQgXSA9IG1heC55OyBhcnJheVsgNSBdID0gbWF4Lno7CgkJYXJyYXlbIDYgXSA9IG1pbi54OyBhcnJheVsgNyBdID0gbWluLnk7IGFycmF5WyA4IF0gPSBtYXguejsKCQlhcnJheVsgOSBdID0gbWF4Lng7IGFycmF5WyAxMCBdID0gbWluLnk7IGFycmF5WyAxMSBdID0gbWF4Lno7CgkJYXJyYXlbIDEyIF0gPSBtYXgueDsgYXJyYXlbIDEzIF0gPSBtYXgueTsgYXJyYXlbIDE0IF0gPSBtaW4uejsKCQlhcnJheVsgMTUgXSA9IG1pbi54OyBhcnJheVsgMTYgXSA9IG1heC55OyBhcnJheVsgMTcgXSA9IG1pbi56OwoJCWFycmF5WyAxOCBdID0gbWluLng7IGFycmF5WyAxOSBdID0gbWluLnk7IGFycmF5WyAyMCBdID0gbWluLno7CgkJYXJyYXlbIDIxIF0gPSBtYXgueDsgYXJyYXlbIDIyIF0gPSBtaW4ueTsgYXJyYXlbIDIzIF0gPSBtaW4uejsKCgkJcG9zaXRpb24ubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl0aGlzLmdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCX0KCglzZXRGcm9tT2JqZWN0KCBvYmplY3QgKSB7CgoJCXRoaXMub2JqZWN0ID0gb2JqZWN0OwoJCXRoaXMudXBkYXRlKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJdGhpcy5vYmplY3QgPSBzb3VyY2Uub2JqZWN0OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJfQoKfQoKY2xhc3MgQm94M0hlbHBlciBleHRlbmRzIExpbmVTZWdtZW50cyB7CgoJY29uc3RydWN0b3IoIGJveCwgY29sb3IgPSAweGZmZmYwMCApIHsKCgkJY29uc3QgaW5kaWNlcyA9IG5ldyBVaW50MTZBcnJheSggWyAwLCAxLCAxLCAyLCAyLCAzLCAzLCAwLCA0LCA1LCA1LCA2LCA2LCA3LCA3LCA0LCAwLCA0LCAxLCA1LCAyLCA2LCAzLCA3IF0gKTsKCgkJY29uc3QgcG9zaXRpb25zID0gWyAxLCAxLCAxLCAtIDEsIDEsIDEsIC0gMSwgLSAxLCAxLCAxLCAtIDEsIDEsIDEsIDEsIC0gMSwgLSAxLCAxLCAtIDEsIC0gMSwgLSAxLCAtIDEsIDEsIC0gMSwgLSAxIF07CgoJCWNvbnN0IGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgoJCWdlb21ldHJ5LnNldEluZGV4KCBuZXcgQnVmZmVyQXR0cmlidXRlKCBpbmRpY2VzLCAxICkgKTsKCgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25zLCAzICkgKTsKCgkJc3VwZXIoIGdlb21ldHJ5LCBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IGNvbG9yLCB0b25lTWFwcGVkOiBmYWxzZSB9ICkgKTsKCgkJdGhpcy5ib3ggPSBib3g7CgoJCXRoaXMudHlwZSA9ICdCb3gzSGVscGVyJzsKCgkJdGhpcy5nZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgl9CgoJdXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICkgewoKCQljb25zdCBib3ggPSB0aGlzLmJveDsKCgkJaWYgKCBib3guaXNFbXB0eSgpICkgcmV0dXJuOwoKCQlib3guZ2V0Q2VudGVyKCB0aGlzLnBvc2l0aW9uICk7CgoJCWJveC5nZXRTaXplKCB0aGlzLnNjYWxlICk7CgoJCXRoaXMuc2NhbGUubXVsdGlwbHlTY2FsYXIoIDAuNSApOwoKCQlzdXBlci51cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJfQoKfQoKY2xhc3MgUGxhbmVIZWxwZXIgZXh0ZW5kcyBMaW5lIHsKCgljb25zdHJ1Y3RvciggcGxhbmUsIHNpemUgPSAxLCBoZXggPSAweGZmZmYwMCApIHsKCgkJY29uc3QgY29sb3IgPSBoZXg7CgoJCWNvbnN0IHBvc2l0aW9ucyA9IFsgMSwgLSAxLCAwLCAtIDEsIDEsIDAsIC0gMSwgLSAxLCAwLCAxLCAxLCAwLCAtIDEsIDEsIDAsIC0gMSwgLSAxLCAwLCAxLCAtIDEsIDAsIDEsIDEsIDAgXTsKCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbnMsIDMgKSApOwoJCWdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQlzdXBlciggZ2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKSApOwoKCQl0aGlzLnR5cGUgPSAnUGxhbmVIZWxwZXInOwoKCQl0aGlzLnBsYW5lID0gcGxhbmU7CgoJCXRoaXMuc2l6ZSA9IHNpemU7CgoJCWNvbnN0IHBvc2l0aW9uczIgPSBbIDEsIDEsIDAsIC0gMSwgMSwgMCwgLSAxLCAtIDEsIDAsIDEsIDEsIDAsIC0gMSwgLSAxLCAwLCAxLCAtIDEsIDAgXTsKCgkJY29uc3QgZ2VvbWV0cnkyID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgkJZ2VvbWV0cnkyLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uczIsIDMgKSApOwoJCWdlb21ldHJ5Mi5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJdGhpcy5hZGQoIG5ldyBNZXNoKCBnZW9tZXRyeTIsIG5ldyBNZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IsIG9wYWNpdHk6IDAuMiwgdHJhbnNwYXJlbnQ6IHRydWUsIGRlcHRoV3JpdGU6IGZhbHNlLCB0b25lTWFwcGVkOiBmYWxzZSB9ICkgKSApOwoKCX0KCgl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCXRoaXMucG9zaXRpb24uc2V0KCAwLCAwLCAwICk7CgoJCXRoaXMuc2NhbGUuc2V0KCAwLjUgKiB0aGlzLnNpemUsIDAuNSAqIHRoaXMuc2l6ZSwgMSApOwoKCQl0aGlzLmxvb2tBdCggdGhpcy5wbGFuZS5ub3JtYWwgKTsKCgkJdGhpcy50cmFuc2xhdGVaKCAtIHRoaXMucGxhbmUuY29uc3RhbnQgKTsKCgkJc3VwZXIudXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICk7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubWF0ZXJpYWwuZGlzcG9zZSgpOwoJCXRoaXMuY2hpbGRyZW5bIDAgXS5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5jaGlsZHJlblsgMCBdLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9Cgp9Cgpjb25zdCBfYXhpcyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKbGV0IF9saW5lR2VvbWV0cnksIF9jb25lR2VvbWV0cnk7CgpjbGFzcyBBcnJvd0hlbHBlciBleHRlbmRzIE9iamVjdDNEIHsKCgkvLyBkaXIgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJY29uc3RydWN0b3IoIGRpciA9IG5ldyBWZWN0b3IzKCAwLCAwLCAxICksIG9yaWdpbiA9IG5ldyBWZWN0b3IzKCAwLCAwLCAwICksIGxlbmd0aCA9IDEsIGNvbG9yID0gMHhmZmZmMDAsIGhlYWRMZW5ndGggPSBsZW5ndGggKiAwLjIsIGhlYWRXaWR0aCA9IGhlYWRMZW5ndGggKiAwLjIgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdBcnJvd0hlbHBlcic7CgoJCWlmICggX2xpbmVHZW9tZXRyeSA9PT0gdW5kZWZpbmVkICkgewoKCQkJX2xpbmVHZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCQlfbGluZUdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIFsgMCwgMCwgMCwgMCwgMSwgMCBdLCAzICkgKTsKCgkJCV9jb25lR2VvbWV0cnkgPSBuZXcgQ3lsaW5kZXJHZW9tZXRyeSggMCwgMC41LCAxLCA1LCAxICk7CgkJCV9jb25lR2VvbWV0cnkudHJhbnNsYXRlKCAwLCAtIDAuNSwgMCApOwoKCQl9CgoJCXRoaXMucG9zaXRpb24uY29weSggb3JpZ2luICk7CgoJCXRoaXMubGluZSA9IG5ldyBMaW5lKCBfbGluZUdlb21ldHJ5LCBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IGNvbG9yLCB0b25lTWFwcGVkOiBmYWxzZSB9ICkgKTsKCQl0aGlzLmxpbmUubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoJCXRoaXMuYWRkKCB0aGlzLmxpbmUgKTsKCgkJdGhpcy5jb25lID0gbmV3IE1lc2goIF9jb25lR2VvbWV0cnksIG5ldyBNZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKSApOwoJCXRoaXMuY29uZS5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgkJdGhpcy5hZGQoIHRoaXMuY29uZSApOwoKCQl0aGlzLnNldERpcmVjdGlvbiggZGlyICk7CgkJdGhpcy5zZXRMZW5ndGgoIGxlbmd0aCwgaGVhZExlbmd0aCwgaGVhZFdpZHRoICk7CgoJfQoKCXNldERpcmVjdGlvbiggZGlyICkgewoKCQkvLyBkaXIgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJCWlmICggZGlyLnkgPiAwLjk5OTk5ICkgewoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldCggMCwgMCwgMCwgMSApOwoKCQl9IGVsc2UgaWYgKCBkaXIueSA8IC0gMC45OTk5OSApIHsKCgkJCXRoaXMucXVhdGVybmlvbi5zZXQoIDEsIDAsIDAsIDAgKTsKCgkJfSBlbHNlIHsKCgkJCV9heGlzLnNldCggZGlyLnosIDAsIC0gZGlyLnggKS5ub3JtYWxpemUoKTsKCgkJCWNvbnN0IHJhZGlhbnMgPSBNYXRoLmFjb3MoIGRpci55ICk7CgoJCQl0aGlzLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZSggX2F4aXMsIHJhZGlhbnMgKTsKCgkJfQoKCX0KCglzZXRMZW5ndGgoIGxlbmd0aCwgaGVhZExlbmd0aCA9IGxlbmd0aCAqIDAuMiwgaGVhZFdpZHRoID0gaGVhZExlbmd0aCAqIDAuMiApIHsKCgkJdGhpcy5saW5lLnNjYWxlLnNldCggMSwgTWF0aC5tYXgoIDAuMDAwMSwgbGVuZ3RoIC0gaGVhZExlbmd0aCApLCAxICk7IC8vIHNlZSAjMTc0NTgKCQl0aGlzLmxpbmUudXBkYXRlTWF0cml4KCk7CgoJCXRoaXMuY29uZS5zY2FsZS5zZXQoIGhlYWRXaWR0aCwgaGVhZExlbmd0aCwgaGVhZFdpZHRoICk7CgkJdGhpcy5jb25lLnBvc2l0aW9uLnkgPSBsZW5ndGg7CgkJdGhpcy5jb25lLnVwZGF0ZU1hdHJpeCgpOwoKCX0KCglzZXRDb2xvciggY29sb3IgKSB7CgoJCXRoaXMubGluZS5tYXRlcmlhbC5jb2xvci5zZXQoIGNvbG9yICk7CgkJdGhpcy5jb25lLm1hdGVyaWFsLmNvbG9yLnNldCggY29sb3IgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UsIGZhbHNlICk7CgoJCXRoaXMubGluZS5jb3B5KCBzb3VyY2UubGluZSApOwoJCXRoaXMuY29uZS5jb3B5KCBzb3VyY2UuY29uZSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5saW5lLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLmxpbmUubWF0ZXJpYWwuZGlzcG9zZSgpOwoJCXRoaXMuY29uZS5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5jb25lLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9Cgp9CgpjbGFzcyBBeGVzSGVscGVyIGV4dGVuZHMgTGluZVNlZ21lbnRzIHsKCgljb25zdHJ1Y3Rvciggc2l6ZSA9IDEgKSB7CgoJCWNvbnN0IHZlcnRpY2VzID0gWwoJCQkwLCAwLCAwLAlzaXplLCAwLCAwLAoJCQkwLCAwLCAwLAkwLCBzaXplLCAwLAoJCQkwLCAwLCAwLAkwLCAwLCBzaXplCgkJXTsKCgkJY29uc3QgY29sb3JzID0gWwoJCQkxLCAwLCAwLAkxLCAwLjYsIDAsCgkJCTAsIDEsIDAsCTAuNiwgMSwgMCwKCQkJMCwgMCwgMSwJMCwgMC42LCAxCgkJXTsKCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAnY29sb3InLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggY29sb3JzLCAzICkgKTsKCgkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgdmVydGV4Q29sb3JzOiB0cnVlLCB0b25lTWFwcGVkOiBmYWxzZSB9ICk7CgoJCXN1cGVyKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy50eXBlID0gJ0F4ZXNIZWxwZXInOwoKCX0KCglzZXRDb2xvcnMoIHhBeGlzQ29sb3IsIHlBeGlzQ29sb3IsIHpBeGlzQ29sb3IgKSB7CgoJCWNvbnN0IGNvbG9yID0gbmV3IENvbG9yKCk7CgkJY29uc3QgYXJyYXkgPSB0aGlzLmdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IuYXJyYXk7CgoJCWNvbG9yLnNldCggeEF4aXNDb2xvciApOwoJCWNvbG9yLnRvQXJyYXkoIGFycmF5LCAwICk7CgkJY29sb3IudG9BcnJheSggYXJyYXksIDMgKTsKCgkJY29sb3Iuc2V0KCB5QXhpc0NvbG9yICk7CgkJY29sb3IudG9BcnJheSggYXJyYXksIDYgKTsKCQljb2xvci50b0FycmF5KCBhcnJheSwgOSApOwoKCQljb2xvci5zZXQoIHpBeGlzQ29sb3IgKTsKCQljb2xvci50b0FycmF5KCBhcnJheSwgMTIgKTsKCQljb2xvci50b0FycmF5KCBhcnJheSwgMTUgKTsKCgkJdGhpcy5nZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCn0KCmNsYXNzIFNoYXBlUGF0aCB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXRoaXMudHlwZSA9ICdTaGFwZVBhdGgnOwoKCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCk7CgoJCXRoaXMuc3ViUGF0aHMgPSBbXTsKCQl0aGlzLmN1cnJlbnRQYXRoID0gbnVsbDsKCgl9CgoJbW92ZVRvKCB4LCB5ICkgewoKCQl0aGlzLmN1cnJlbnRQYXRoID0gbmV3IFBhdGgoKTsKCQl0aGlzLnN1YlBhdGhzLnB1c2goIHRoaXMuY3VycmVudFBhdGggKTsKCQl0aGlzLmN1cnJlbnRQYXRoLm1vdmVUbyggeCwgeSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbGluZVRvKCB4LCB5ICkgewoKCQl0aGlzLmN1cnJlbnRQYXRoLmxpbmVUbyggeCwgeSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcXVhZHJhdGljQ3VydmVUbyggYUNQeCwgYUNQeSwgYVgsIGFZICkgewoKCQl0aGlzLmN1cnJlbnRQYXRoLnF1YWRyYXRpY0N1cnZlVG8oIGFDUHgsIGFDUHksIGFYLCBhWSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYmV6aWVyQ3VydmVUbyggYUNQMXgsIGFDUDF5LCBhQ1AyeCwgYUNQMnksIGFYLCBhWSApIHsKCgkJdGhpcy5jdXJyZW50UGF0aC5iZXppZXJDdXJ2ZVRvKCBhQ1AxeCwgYUNQMXksIGFDUDJ4LCBhQ1AyeSwgYVgsIGFZICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzcGxpbmVUaHJ1KCBwdHMgKSB7CgoJCXRoaXMuY3VycmVudFBhdGguc3BsaW5lVGhydSggcHRzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b1NoYXBlcyggaXNDQ1cgKSB7CgoJCWZ1bmN0aW9uIHRvU2hhcGVzTm9Ib2xlcyggaW5TdWJwYXRocyApIHsKCgkJCWNvbnN0IHNoYXBlcyA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gaW5TdWJwYXRocy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IHRtcFBhdGggPSBpblN1YnBhdGhzWyBpIF07CgoJCQkJY29uc3QgdG1wU2hhcGUgPSBuZXcgU2hhcGUoKTsKCQkJCXRtcFNoYXBlLmN1cnZlcyA9IHRtcFBhdGguY3VydmVzOwoKCQkJCXNoYXBlcy5wdXNoKCB0bXBTaGFwZSApOwoKCQkJfQoKCQkJcmV0dXJuIHNoYXBlczsKCgkJfQoKCQlmdW5jdGlvbiBpc1BvaW50SW5zaWRlUG9seWdvbiggaW5QdCwgaW5Qb2x5Z29uICkgewoKCQkJY29uc3QgcG9seUxlbiA9IGluUG9seWdvbi5sZW5ndGg7CgoJCQkvLyBpblB0IG9uIHBvbHlnb24gY29udG91ciA9PiBpbW1lZGlhdGUgc3VjY2VzcyAgICBvcgoJCQkvLyB0b2dnbGluZyBvZiBpbnNpZGUvb3V0c2lkZSBhdCBldmVyeSBzaW5nbGUhIGludGVyc2VjdGlvbiBwb2ludCBvZiBhbiBlZGdlCgkJCS8vICB3aXRoIHRoZSBob3Jpem9udGFsIGxpbmUgdGhyb3VnaCBpblB0LCBsZWZ0IG9mIGluUHQKCQkJLy8gIG5vdCBjb3VudGluZyBsb3dlclkgZW5kcG9pbnRzIG9mIGVkZ2VzIGFuZCB3aG9sZSBlZGdlcyBvbiB0aGF0IGxpbmUKCQkJbGV0IGluc2lkZSA9IGZhbHNlOwoJCQlmb3IgKCBsZXQgcCA9IHBvbHlMZW4gLSAxLCBxID0gMDsgcSA8IHBvbHlMZW47IHAgPSBxICsrICkgewoKCQkJCWxldCBlZGdlTG93UHQgPSBpblBvbHlnb25bIHAgXTsKCQkJCWxldCBlZGdlSGlnaFB0ID0gaW5Qb2x5Z29uWyBxIF07CgoJCQkJbGV0IGVkZ2VEeCA9IGVkZ2VIaWdoUHQueCAtIGVkZ2VMb3dQdC54OwoJCQkJbGV0IGVkZ2VEeSA9IGVkZ2VIaWdoUHQueSAtIGVkZ2VMb3dQdC55OwoKCQkJCWlmICggTWF0aC5hYnMoIGVkZ2VEeSApID4gTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkJCS8vIG5vdCBwYXJhbGxlbAoJCQkJCWlmICggZWRnZUR5IDwgMCApIHsKCgkJCQkJCWVkZ2VMb3dQdCA9IGluUG9seWdvblsgcSBdOyBlZGdlRHggPSAtIGVkZ2VEeDsKCQkJCQkJZWRnZUhpZ2hQdCA9IGluUG9seWdvblsgcCBdOyBlZGdlRHkgPSAtIGVkZ2VEeTsKCgkJCQkJfQoKCQkJCQlpZiAoICggaW5QdC55IDwgZWRnZUxvd1B0LnkgKSB8fCAoIGluUHQueSA+IGVkZ2VIaWdoUHQueSApICkgCQljb250aW51ZTsKCgkJCQkJaWYgKCBpblB0LnkgPT09IGVkZ2VMb3dQdC55ICkgewoKCQkJCQkJaWYgKCBpblB0LnggPT09IGVkZ2VMb3dQdC54ICkJCXJldHVybgl0cnVlOwkJLy8gaW5QdCBpcyBvbiBjb250b3VyID8KCQkJCQkJLy8gY29udGludWU7CQkJCS8vIG5vIGludGVyc2VjdGlvbiBvciBlZGdlTG93UHQgPT4gZG9lc24ndCBjb3VudCAhISEKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnN0IHBlcnBFZGdlID0gZWRnZUR5ICogKCBpblB0LnggLSBlZGdlTG93UHQueCApIC0gZWRnZUR4ICogKCBpblB0LnkgLSBlZGdlTG93UHQueSApOwoJCQkJCQlpZiAoIHBlcnBFZGdlID09PSAwICkJCQkJcmV0dXJuCXRydWU7CQkvLyBpblB0IGlzIG9uIGNvbnRvdXIgPwoJCQkJCQlpZiAoIHBlcnBFZGdlIDwgMCApIAkJCQljb250aW51ZTsKCQkJCQkJaW5zaWRlID0gISBpbnNpZGU7CQkvLyB0cnVlIGludGVyc2VjdGlvbiBsZWZ0IG9mIGluUHQKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIHBhcmFsbGVsIG9yIGNvbGxpbmVhcgoJCQkJCWlmICggaW5QdC55ICE9PSBlZGdlTG93UHQueSApIAkJY29udGludWU7CQkJLy8gcGFyYWxsZWwKCQkJCQkvLyBlZGdlIGxpZXMgb24gdGhlIHNhbWUgaG9yaXpvbnRhbCBsaW5lIGFzIGluUHQKCQkJCQlpZiAoICggKCBlZGdlSGlnaFB0LnggPD0gaW5QdC54ICkgJiYgKCBpblB0LnggPD0gZWRnZUxvd1B0LnggKSApIHx8CgkJCQkJCSAoICggZWRnZUxvd1B0LnggPD0gaW5QdC54ICkgJiYgKCBpblB0LnggPD0gZWRnZUhpZ2hQdC54ICkgKSApCQlyZXR1cm4JdHJ1ZTsJLy8gaW5QdDogUG9pbnQgb24gY29udG91ciAhCgkJCQkJLy8gY29udGludWU7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuCWluc2lkZTsKCgkJfQoKCQljb25zdCBpc0Nsb2NrV2lzZSA9IFNoYXBlVXRpbHMuaXNDbG9ja1dpc2U7CgoJCWNvbnN0IHN1YlBhdGhzID0gdGhpcy5zdWJQYXRoczsKCQlpZiAoIHN1YlBhdGhzLmxlbmd0aCA9PT0gMCApIHJldHVybiBbXTsKCgkJbGV0IHNvbGlkLCB0bXBQYXRoLCB0bXBTaGFwZTsKCQljb25zdCBzaGFwZXMgPSBbXTsKCgkJaWYgKCBzdWJQYXRocy5sZW5ndGggPT09IDEgKSB7CgoJCQl0bXBQYXRoID0gc3ViUGF0aHNbIDAgXTsKCQkJdG1wU2hhcGUgPSBuZXcgU2hhcGUoKTsKCQkJdG1wU2hhcGUuY3VydmVzID0gdG1wUGF0aC5jdXJ2ZXM7CgkJCXNoYXBlcy5wdXNoKCB0bXBTaGFwZSApOwoJCQlyZXR1cm4gc2hhcGVzOwoKCQl9CgoJCWxldCBob2xlc0ZpcnN0ID0gISBpc0Nsb2NrV2lzZSggc3ViUGF0aHNbIDAgXS5nZXRQb2ludHMoKSApOwoJCWhvbGVzRmlyc3QgPSBpc0NDVyA/ICEgaG9sZXNGaXJzdCA6IGhvbGVzRmlyc3Q7CgoJCS8vIGNvbnNvbGUubG9nKCJIb2xlcyBmaXJzdCIsIGhvbGVzRmlyc3QpOwoKCQljb25zdCBiZXR0ZXJTaGFwZUhvbGVzID0gW107CgkJY29uc3QgbmV3U2hhcGVzID0gW107CgkJbGV0IG5ld1NoYXBlSG9sZXMgPSBbXTsKCQlsZXQgbWFpbklkeCA9IDA7CgkJbGV0IHRtcFBvaW50czsKCgkJbmV3U2hhcGVzWyBtYWluSWR4IF0gPSB1bmRlZmluZWQ7CgkJbmV3U2hhcGVIb2xlc1sgbWFpbklkeCBdID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHN1YlBhdGhzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQl0bXBQYXRoID0gc3ViUGF0aHNbIGkgXTsKCQkJdG1wUG9pbnRzID0gdG1wUGF0aC5nZXRQb2ludHMoKTsKCQkJc29saWQgPSBpc0Nsb2NrV2lzZSggdG1wUG9pbnRzICk7CgkJCXNvbGlkID0gaXNDQ1cgPyAhIHNvbGlkIDogc29saWQ7CgoJCQlpZiAoIHNvbGlkICkgewoKCQkJCWlmICggKCAhIGhvbGVzRmlyc3QgKSAmJiAoIG5ld1NoYXBlc1sgbWFpbklkeCBdICkgKQltYWluSWR4ICsrOwoKCQkJCW5ld1NoYXBlc1sgbWFpbklkeCBdID0geyBzOiBuZXcgU2hhcGUoKSwgcDogdG1wUG9pbnRzIH07CgkJCQluZXdTaGFwZXNbIG1haW5JZHggXS5zLmN1cnZlcyA9IHRtcFBhdGguY3VydmVzOwoKCQkJCWlmICggaG9sZXNGaXJzdCApCW1haW5JZHggKys7CgkJCQluZXdTaGFwZUhvbGVzWyBtYWluSWR4IF0gPSBbXTsKCgkJCQkvL2NvbnNvbGUubG9nKCdjdycsIGkpOwoKCQkJfSBlbHNlIHsKCgkJCQluZXdTaGFwZUhvbGVzWyBtYWluSWR4IF0ucHVzaCggeyBoOiB0bXBQYXRoLCBwOiB0bXBQb2ludHNbIDAgXSB9ICk7CgoJCQkJLy9jb25zb2xlLmxvZygnY2N3JywgaSk7CgoJCQl9CgoJCX0KCgkJLy8gb25seSBIb2xlcz8gLT4gcHJvYmFibHkgYWxsIFNoYXBlcyB3aXRoIHdyb25nIG9yaWVudGF0aW9uCgkJaWYgKCAhIG5ld1NoYXBlc1sgMCBdICkJcmV0dXJuCXRvU2hhcGVzTm9Ib2xlcyggc3ViUGF0aHMgKTsKCgoJCWlmICggbmV3U2hhcGVzLmxlbmd0aCA+IDEgKSB7CgoJCQlsZXQgYW1iaWd1b3VzID0gZmFsc2U7CgkJCWxldCB0b0NoYW5nZSA9IDA7CgoJCQlmb3IgKCBsZXQgc0lkeCA9IDAsIHNMZW4gPSBuZXdTaGFwZXMubGVuZ3RoOyBzSWR4IDwgc0xlbjsgc0lkeCArKyApIHsKCgkJCQliZXR0ZXJTaGFwZUhvbGVzWyBzSWR4IF0gPSBbXTsKCgkJCX0KCgkJCWZvciAoIGxldCBzSWR4ID0gMCwgc0xlbiA9IG5ld1NoYXBlcy5sZW5ndGg7IHNJZHggPCBzTGVuOyBzSWR4ICsrICkgewoKCQkJCWNvbnN0IHNobyA9IG5ld1NoYXBlSG9sZXNbIHNJZHggXTsKCgkJCQlmb3IgKCBsZXQgaElkeCA9IDA7IGhJZHggPCBzaG8ubGVuZ3RoOyBoSWR4ICsrICkgewoKCQkJCQljb25zdCBobyA9IHNob1sgaElkeCBdOwoJCQkJCWxldCBob2xlX3VuYXNzaWduZWQgPSB0cnVlOwoKCQkJCQlmb3IgKCBsZXQgczJJZHggPSAwOyBzMklkeCA8IG5ld1NoYXBlcy5sZW5ndGg7IHMySWR4ICsrICkgewoKCQkJCQkJaWYgKCBpc1BvaW50SW5zaWRlUG9seWdvbiggaG8ucCwgbmV3U2hhcGVzWyBzMklkeCBdLnAgKSApIHsKCgkJCQkJCQlpZiAoIHNJZHggIT09IHMySWR4ICkJdG9DaGFuZ2UgKys7CgoJCQkJCQkJaWYgKCBob2xlX3VuYXNzaWduZWQgKSB7CgoJCQkJCQkJCWhvbGVfdW5hc3NpZ25lZCA9IGZhbHNlOwoJCQkJCQkJCWJldHRlclNoYXBlSG9sZXNbIHMySWR4IF0ucHVzaCggaG8gKTsKCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlhbWJpZ3VvdXMgPSB0cnVlOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQlpZiAoIGhvbGVfdW5hc3NpZ25lZCApIHsKCgkJCQkJCWJldHRlclNoYXBlSG9sZXNbIHNJZHggXS5wdXNoKCBobyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0b0NoYW5nZSA+IDAgJiYgYW1iaWd1b3VzID09PSBmYWxzZSApIHsKCgkJCQluZXdTaGFwZUhvbGVzID0gYmV0dGVyU2hhcGVIb2xlczsKCgkJCX0KCgkJfQoKCQlsZXQgdG1wSG9sZXM7CgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBuZXdTaGFwZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQl0bXBTaGFwZSA9IG5ld1NoYXBlc1sgaSBdLnM7CgkJCXNoYXBlcy5wdXNoKCB0bXBTaGFwZSApOwoJCQl0bXBIb2xlcyA9IG5ld1NoYXBlSG9sZXNbIGkgXTsKCgkJCWZvciAoIGxldCBqID0gMCwgamwgPSB0bXBIb2xlcy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCQl0bXBTaGFwZS5ob2xlcy5wdXNoKCB0bXBIb2xlc1sgaiBdLmggKTsKCgkJCX0KCgkJfQoKCQkvL2NvbnNvbGUubG9nKCJzaGFwZSIsIHNoYXBlcyk7CgoJCXJldHVybiBzaGFwZXM7CgoJfQoKfQoKaWYgKCB0eXBlb2YgX19USFJFRV9ERVZUT09MU19fICE9PSAndW5kZWZpbmVkJyApIHsKCglfX1RIUkVFX0RFVlRPT0xTX18uZGlzcGF0Y2hFdmVudCggbmV3IEN1c3RvbUV2ZW50KCAncmVnaXN0ZXInLCB7IGRldGFpbDogewoJCXJldmlzaW9uOiBSRVZJU0lPTiwKCX0gfSApICk7Cgp9CgppZiAoIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICkgewoKCWlmICggd2luZG93Ll9fVEhSRUVfXyApIHsKCgkJY29uc29sZS53YXJuKCAnV0FSTklORzogTXVsdGlwbGUgaW5zdGFuY2VzIG9mIFRocmVlLmpzIGJlaW5nIGltcG9ydGVkLicgKTsKCgl9IGVsc2UgewoKCQl3aW5kb3cuX19USFJFRV9fID0gUkVWSVNJT047CgoJfQoKfQoKZXhwb3J0IHsgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nLCBBZGRFcXVhdGlvbiwgQWRkT3BlcmF0aW9uLCBBZGRpdGl2ZUFuaW1hdGlvbkJsZW5kTW9kZSwgQWRkaXRpdmVCbGVuZGluZywgQWdYVG9uZU1hcHBpbmcsIEFscGhhRm9ybWF0LCBBbHdheXNDb21wYXJlLCBBbHdheXNEZXB0aCwgQWx3YXlzU3RlbmNpbEZ1bmMsIEFtYmllbnRMaWdodCwgQW5pbWF0aW9uQWN0aW9uLCBBbmltYXRpb25DbGlwLCBBbmltYXRpb25Mb2FkZXIsIEFuaW1hdGlvbk1peGVyLCBBbmltYXRpb25PYmplY3RHcm91cCwgQW5pbWF0aW9uVXRpbHMsIEFyY0N1cnZlLCBBcnJheUNhbWVyYSwgQXJyb3dIZWxwZXIsIEF0dGFjaGVkQmluZE1vZGUsIEF1ZGlvLCBBdWRpb0FuYWx5c2VyLCBBdWRpb0NvbnRleHQsIEF1ZGlvTGlzdGVuZXIsIEF1ZGlvTG9hZGVyLCBBeGVzSGVscGVyLCBCYWNrU2lkZSwgQmFzaWNEZXB0aFBhY2tpbmcsIEJhc2ljU2hhZG93TWFwLCBCYXRjaGVkTWVzaCwgQm9uZSwgQm9vbGVhbktleWZyYW1lVHJhY2ssIEJveDIsIEJveDMsIEJveDNIZWxwZXIsIEJveEdlb21ldHJ5LCBCb3hIZWxwZXIsIEJ1ZmZlckF0dHJpYnV0ZSwgQnVmZmVyR2VvbWV0cnksIEJ1ZmZlckdlb21ldHJ5TG9hZGVyLCBCeXRlVHlwZSwgQ2FjaGUsIENhbWVyYSwgQ2FtZXJhSGVscGVyLCBDYW52YXNUZXh0dXJlLCBDYXBzdWxlR2VvbWV0cnksIENhdG11bGxSb21DdXJ2ZTMsIENpbmVvblRvbmVNYXBwaW5nLCBDaXJjbGVHZW9tZXRyeSwgQ2xhbXBUb0VkZ2VXcmFwcGluZywgQ2xvY2ssIENvbG9yLCBDb2xvcktleWZyYW1lVHJhY2ssIENvbG9yTWFuYWdlbWVudCwgQ29tcHJlc3NlZEFycmF5VGV4dHVyZSwgQ29tcHJlc3NlZEN1YmVUZXh0dXJlLCBDb21wcmVzc2VkVGV4dHVyZSwgQ29tcHJlc3NlZFRleHR1cmVMb2FkZXIsIENvbmVHZW9tZXRyeSwgQ29uc3RhbnRBbHBoYUZhY3RvciwgQ29uc3RhbnRDb2xvckZhY3RvciwgQ3ViZUNhbWVyYSwgQ3ViZVJlZmxlY3Rpb25NYXBwaW5nLCBDdWJlUmVmcmFjdGlvbk1hcHBpbmcsIEN1YmVUZXh0dXJlLCBDdWJlVGV4dHVyZUxvYWRlciwgQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcsIEN1YmljQmV6aWVyQ3VydmUsIEN1YmljQmV6aWVyQ3VydmUzLCBDdWJpY0ludGVycG9sYW50LCBDdWxsRmFjZUJhY2ssIEN1bGxGYWNlRnJvbnQsIEN1bGxGYWNlRnJvbnRCYWNrLCBDdWxsRmFjZU5vbmUsIEN1cnZlLCBDdXJ2ZVBhdGgsIEN1c3RvbUJsZW5kaW5nLCBDdXN0b21Ub25lTWFwcGluZywgQ3lsaW5kZXJHZW9tZXRyeSwgQ3lsaW5kcmljYWwsIERhdGEzRFRleHR1cmUsIERhdGFBcnJheVRleHR1cmUsIERhdGFUZXh0dXJlLCBEYXRhVGV4dHVyZUxvYWRlciwgRGF0YVV0aWxzLCBEZWNyZW1lbnRTdGVuY2lsT3AsIERlY3JlbWVudFdyYXBTdGVuY2lsT3AsIERlZmF1bHRMb2FkaW5nTWFuYWdlciwgRGVwdGhGb3JtYXQsIERlcHRoU3RlbmNpbEZvcm1hdCwgRGVwdGhUZXh0dXJlLCBEZXRhY2hlZEJpbmRNb2RlLCBEaXJlY3Rpb25hbExpZ2h0LCBEaXJlY3Rpb25hbExpZ2h0SGVscGVyLCBEaXNjcmV0ZUludGVycG9sYW50LCBEaXNwbGF5UDNDb2xvclNwYWNlLCBEb2RlY2FoZWRyb25HZW9tZXRyeSwgRG91YmxlU2lkZSwgRHN0QWxwaGFGYWN0b3IsIERzdENvbG9yRmFjdG9yLCBEeW5hbWljQ29weVVzYWdlLCBEeW5hbWljRHJhd1VzYWdlLCBEeW5hbWljUmVhZFVzYWdlLCBFZGdlc0dlb21ldHJ5LCBFbGxpcHNlQ3VydmUsIEVxdWFsQ29tcGFyZSwgRXF1YWxEZXB0aCwgRXF1YWxTdGVuY2lsRnVuYywgRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcsIEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nLCBFdWxlciwgRXZlbnREaXNwYXRjaGVyLCBFeHRydWRlR2VvbWV0cnksIEZpbGVMb2FkZXIsIEZsb2F0MTZCdWZmZXJBdHRyaWJ1dGUsIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUsIEZsb2F0NjRCdWZmZXJBdHRyaWJ1dGUsIEZsb2F0VHlwZSwgRm9nLCBGb2dFeHAyLCBGcmFtZWJ1ZmZlclRleHR1cmUsIEZyb250U2lkZSwgRnJ1c3R1bSwgR0xCdWZmZXJBdHRyaWJ1dGUsIEdMU0wxLCBHTFNMMywgR3JlYXRlckNvbXBhcmUsIEdyZWF0ZXJEZXB0aCwgR3JlYXRlckVxdWFsQ29tcGFyZSwgR3JlYXRlckVxdWFsRGVwdGgsIEdyZWF0ZXJFcXVhbFN0ZW5jaWxGdW5jLCBHcmVhdGVyU3RlbmNpbEZ1bmMsIEdyaWRIZWxwZXIsIEdyb3VwLCBIYWxmRmxvYXRUeXBlLCBIZW1pc3BoZXJlTGlnaHQsIEhlbWlzcGhlcmVMaWdodEhlbHBlciwgSWNvc2FoZWRyb25HZW9tZXRyeSwgSW1hZ2VCaXRtYXBMb2FkZXIsIEltYWdlTG9hZGVyLCBJbWFnZVV0aWxzLCBJbmNyZW1lbnRTdGVuY2lsT3AsIEluY3JlbWVudFdyYXBTdGVuY2lsT3AsIEluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSwgSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnksIEluc3RhbmNlZEludGVybGVhdmVkQnVmZmVyLCBJbnN0YW5jZWRNZXNoLCBJbnQxNkJ1ZmZlckF0dHJpYnV0ZSwgSW50MzJCdWZmZXJBdHRyaWJ1dGUsIEludDhCdWZmZXJBdHRyaWJ1dGUsIEludFR5cGUsIEludGVybGVhdmVkQnVmZmVyLCBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSwgSW50ZXJwb2xhbnQsIEludGVycG9sYXRlRGlzY3JldGUsIEludGVycG9sYXRlTGluZWFyLCBJbnRlcnBvbGF0ZVNtb290aCwgSW52ZXJ0U3RlbmNpbE9wLCBLZWVwU3RlbmNpbE9wLCBLZXlmcmFtZVRyYWNrLCBMT0QsIExhdGhlR2VvbWV0cnksIExheWVycywgTGVzc0NvbXBhcmUsIExlc3NEZXB0aCwgTGVzc0VxdWFsQ29tcGFyZSwgTGVzc0VxdWFsRGVwdGgsIExlc3NFcXVhbFN0ZW5jaWxGdW5jLCBMZXNzU3RlbmNpbEZ1bmMsIExpZ2h0LCBMaWdodFByb2JlLCBMaW5lLCBMaW5lMywgTGluZUJhc2ljTWF0ZXJpYWwsIExpbmVDdXJ2ZSwgTGluZUN1cnZlMywgTGluZURhc2hlZE1hdGVyaWFsLCBMaW5lTG9vcCwgTGluZVNlZ21lbnRzLCBMaW5lYXJEaXNwbGF5UDNDb2xvclNwYWNlLCBMaW5lYXJFbmNvZGluZywgTGluZWFyRmlsdGVyLCBMaW5lYXJJbnRlcnBvbGFudCwgTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyLCBMaW5lYXJNaXBNYXBOZWFyZXN0RmlsdGVyLCBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIsIExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXIsIExpbmVhclNSR0JDb2xvclNwYWNlLCBMaW5lYXJUb25lTWFwcGluZywgTGluZWFyVHJhbnNmZXIsIExvYWRlciwgTG9hZGVyVXRpbHMsIExvYWRpbmdNYW5hZ2VyLCBMb29wT25jZSwgTG9vcFBpbmdQb25nLCBMb29wUmVwZWF0LCBMdW1pbmFuY2VBbHBoYUZvcm1hdCwgTHVtaW5hbmNlRm9ybWF0LCBNT1VTRSwgTWF0ZXJpYWwsIE1hdGVyaWFsTG9hZGVyLCBNYXRoVXRpbHMsIE1hdHJpeDMsIE1hdHJpeDQsIE1heEVxdWF0aW9uLCBNZXNoLCBNZXNoQmFzaWNNYXRlcmlhbCwgTWVzaERlcHRoTWF0ZXJpYWwsIE1lc2hEaXN0YW5jZU1hdGVyaWFsLCBNZXNoTGFtYmVydE1hdGVyaWFsLCBNZXNoTWF0Y2FwTWF0ZXJpYWwsIE1lc2hOb3JtYWxNYXRlcmlhbCwgTWVzaFBob25nTWF0ZXJpYWwsIE1lc2hQaHlzaWNhbE1hdGVyaWFsLCBNZXNoU3RhbmRhcmRNYXRlcmlhbCwgTWVzaFRvb25NYXRlcmlhbCwgTWluRXF1YXRpb24sIE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcsIE1peE9wZXJhdGlvbiwgTXVsdGlwbHlCbGVuZGluZywgTXVsdGlwbHlPcGVyYXRpb24sIE5lYXJlc3RGaWx0ZXIsIE5lYXJlc3RNaXBNYXBMaW5lYXJGaWx0ZXIsIE5lYXJlc3RNaXBNYXBOZWFyZXN0RmlsdGVyLCBOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyLCBOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlciwgTmV2ZXJDb21wYXJlLCBOZXZlckRlcHRoLCBOZXZlclN0ZW5jaWxGdW5jLCBOb0JsZW5kaW5nLCBOb0NvbG9yU3BhY2UsIE5vVG9uZU1hcHBpbmcsIE5vcm1hbEFuaW1hdGlvbkJsZW5kTW9kZSwgTm9ybWFsQmxlbmRpbmcsIE5vdEVxdWFsQ29tcGFyZSwgTm90RXF1YWxEZXB0aCwgTm90RXF1YWxTdGVuY2lsRnVuYywgTnVtYmVyS2V5ZnJhbWVUcmFjaywgT2JqZWN0M0QsIE9iamVjdExvYWRlciwgT2JqZWN0U3BhY2VOb3JtYWxNYXAsIE9jdGFoZWRyb25HZW9tZXRyeSwgT25lRmFjdG9yLCBPbmVNaW51c0NvbnN0YW50QWxwaGFGYWN0b3IsIE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvciwgT25lTWludXNEc3RBbHBoYUZhY3RvciwgT25lTWludXNEc3RDb2xvckZhY3RvciwgT25lTWludXNTcmNBbHBoYUZhY3RvciwgT25lTWludXNTcmNDb2xvckZhY3RvciwgT3J0aG9ncmFwaGljQ2FtZXJhLCBQM1ByaW1hcmllcywgUENGU2hhZG93TWFwLCBQQ0ZTb2Z0U2hhZG93TWFwLCBQTVJFTUdlbmVyYXRvciwgUGF0aCwgUGVyc3BlY3RpdmVDYW1lcmEsIFBsYW5lLCBQbGFuZUdlb21ldHJ5LCBQbGFuZUhlbHBlciwgUG9pbnRMaWdodCwgUG9pbnRMaWdodEhlbHBlciwgUG9pbnRzLCBQb2ludHNNYXRlcmlhbCwgUG9sYXJHcmlkSGVscGVyLCBQb2x5aGVkcm9uR2VvbWV0cnksIFBvc2l0aW9uYWxBdWRpbywgUHJvcGVydHlCaW5kaW5nLCBQcm9wZXJ0eU1peGVyLCBRdWFkcmF0aWNCZXppZXJDdXJ2ZSwgUXVhZHJhdGljQmV6aWVyQ3VydmUzLCBRdWF0ZXJuaW9uLCBRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjaywgUXVhdGVybmlvbkxpbmVhckludGVycG9sYW50LCBSRURfR1JFRU5fUkdUQzJfRm9ybWF0LCBSRURfUkdUQzFfRm9ybWF0LCBSRVZJU0lPTiwgUkdCQURlcHRoUGFja2luZywgUkdCQUZvcm1hdCwgUkdCQUludGVnZXJGb3JtYXQsIFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQsIFJHQkFfQVNUQ18xMHg1X0Zvcm1hdCwgUkdCQV9BU1RDXzEweDZfRm9ybWF0LCBSR0JBX0FTVENfMTB4OF9Gb3JtYXQsIFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQsIFJHQkFfQVNUQ18xMngxMl9Gb3JtYXQsIFJHQkFfQVNUQ180eDRfRm9ybWF0LCBSR0JBX0FTVENfNXg0X0Zvcm1hdCwgUkdCQV9BU1RDXzV4NV9Gb3JtYXQsIFJHQkFfQVNUQ182eDVfRm9ybWF0LCBSR0JBX0FTVENfNng2X0Zvcm1hdCwgUkdCQV9BU1RDXzh4NV9Gb3JtYXQsIFJHQkFfQVNUQ184eDZfRm9ybWF0LCBSR0JBX0FTVENfOHg4X0Zvcm1hdCwgUkdCQV9CUFRDX0Zvcm1hdCwgUkdCQV9FVEMyX0VBQ19Gb3JtYXQsIFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCwgUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0LCBSR0JBX1MzVENfRFhUMV9Gb3JtYXQsIFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCwgUkdCQV9TM1RDX0RYVDVfRm9ybWF0LCBSR0JfQlBUQ19TSUdORURfRm9ybWF0LCBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQsIFJHQl9FVEMxX0Zvcm1hdCwgUkdCX0VUQzJfRm9ybWF0LCBSR0JfUFZSVENfMkJQUFYxX0Zvcm1hdCwgUkdCX1BWUlRDXzRCUFBWMV9Gb3JtYXQsIFJHQl9TM1RDX0RYVDFfRm9ybWF0LCBSR0Zvcm1hdCwgUkdJbnRlZ2VyRm9ybWF0LCBSYXdTaGFkZXJNYXRlcmlhbCwgUmF5LCBSYXljYXN0ZXIsIFJlYzcwOVByaW1hcmllcywgUmVjdEFyZWFMaWdodCwgUmVkRm9ybWF0LCBSZWRJbnRlZ2VyRm9ybWF0LCBSZWluaGFyZFRvbmVNYXBwaW5nLCBSZW5kZXJUYXJnZXQsIFJlcGVhdFdyYXBwaW5nLCBSZXBsYWNlU3RlbmNpbE9wLCBSZXZlcnNlU3VidHJhY3RFcXVhdGlvbiwgUmluZ0dlb21ldHJ5LCBTSUdORURfUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCwgU0lHTkVEX1JFRF9SR1RDMV9Gb3JtYXQsIFNSR0JDb2xvclNwYWNlLCBTUkdCVHJhbnNmZXIsIFNjZW5lLCBTaGFkZXJDaHVuaywgU2hhZGVyTGliLCBTaGFkZXJNYXRlcmlhbCwgU2hhZG93TWF0ZXJpYWwsIFNoYXBlLCBTaGFwZUdlb21ldHJ5LCBTaGFwZVBhdGgsIFNoYXBlVXRpbHMsIFNob3J0VHlwZSwgU2tlbGV0b24sIFNrZWxldG9uSGVscGVyLCBTa2lubmVkTWVzaCwgU291cmNlLCBTcGhlcmUsIFNwaGVyZUdlb21ldHJ5LCBTcGhlcmljYWwsIFNwaGVyaWNhbEhhcm1vbmljczMsIFNwbGluZUN1cnZlLCBTcG90TGlnaHQsIFNwb3RMaWdodEhlbHBlciwgU3ByaXRlLCBTcHJpdGVNYXRlcmlhbCwgU3JjQWxwaGFGYWN0b3IsIFNyY0FscGhhU2F0dXJhdGVGYWN0b3IsIFNyY0NvbG9yRmFjdG9yLCBTdGF0aWNDb3B5VXNhZ2UsIFN0YXRpY0RyYXdVc2FnZSwgU3RhdGljUmVhZFVzYWdlLCBTdGVyZW9DYW1lcmEsIFN0cmVhbUNvcHlVc2FnZSwgU3RyZWFtRHJhd1VzYWdlLCBTdHJlYW1SZWFkVXNhZ2UsIFN0cmluZ0tleWZyYW1lVHJhY2ssIFN1YnRyYWN0RXF1YXRpb24sIFN1YnRyYWN0aXZlQmxlbmRpbmcsIFRPVUNILCBUYW5nZW50U3BhY2VOb3JtYWxNYXAsIFRldHJhaGVkcm9uR2VvbWV0cnksIFRleHR1cmUsIFRleHR1cmVMb2FkZXIsIFRvcnVzR2VvbWV0cnksIFRvcnVzS25vdEdlb21ldHJ5LCBUcmlhbmdsZSwgVHJpYW5nbGVGYW5EcmF3TW9kZSwgVHJpYW5nbGVTdHJpcERyYXdNb2RlLCBUcmlhbmdsZXNEcmF3TW9kZSwgVHViZUdlb21ldHJ5LCBUd29QYXNzRG91YmxlU2lkZSwgVVZNYXBwaW5nLCBVaW50MTZCdWZmZXJBdHRyaWJ1dGUsIFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSwgVWludDhCdWZmZXJBdHRyaWJ1dGUsIFVpbnQ4Q2xhbXBlZEJ1ZmZlckF0dHJpYnV0ZSwgVW5pZm9ybSwgVW5pZm9ybXNHcm91cCwgVW5pZm9ybXNMaWIsIFVuaWZvcm1zVXRpbHMsIFVuc2lnbmVkQnl0ZVR5cGUsIFVuc2lnbmVkSW50MjQ4VHlwZSwgVW5zaWduZWRJbnRUeXBlLCBVbnNpZ25lZFNob3J0NDQ0NFR5cGUsIFVuc2lnbmVkU2hvcnQ1NTUxVHlwZSwgVW5zaWduZWRTaG9ydFR5cGUsIFZTTVNoYWRvd01hcCwgVmVjdG9yMiwgVmVjdG9yMywgVmVjdG9yNCwgVmVjdG9yS2V5ZnJhbWVUcmFjaywgVmlkZW9UZXh0dXJlLCBXZWJHTDFSZW5kZXJlciwgV2ViR0wzRFJlbmRlclRhcmdldCwgV2ViR0xBcnJheVJlbmRlclRhcmdldCwgV2ViR0xDb29yZGluYXRlU3lzdGVtLCBXZWJHTEN1YmVSZW5kZXJUYXJnZXQsIFdlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzLCBXZWJHTFJlbmRlclRhcmdldCwgV2ViR0xSZW5kZXJlciwgV2ViR0xVdGlscywgV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSwgV2lyZWZyYW1lR2VvbWV0cnksIFdyYXBBcm91bmRFbmRpbmcsIFplcm9DdXJ2YXR1cmVFbmRpbmcsIFplcm9GYWN0b3IsIFplcm9TbG9wZUVuZGluZywgWmVyb1N0ZW5jaWxPcCwgX1NSR0JBRm9ybWF0LCBjcmVhdGVDYW52YXNFbGVtZW50LCBzUkdCRW5jb2RpbmcgfTsK", "./assets/js/OrbitControls.js": "data:text/javascript;base64,aW1wb3J0IHsKCUV2ZW50RGlzcGF0Y2hlciwKCU1PVVNFLAoJUXVhdGVybmlvbiwKCVNwaGVyaWNhbCwKCVRPVUNILAoJVmVjdG9yMiwKCVZlY3RvcjMsCglQbGFuZSwKCVJheSwKCU1hdGhVdGlscwp9IGZyb20gJ3RocmVlJzsKCi8vIE9yYml0Q29udHJvbHMgcGVyZm9ybXMgb3JiaXRpbmcsIGRvbGx5aW5nICh6b29taW5nKSwgYW5kIHBhbm5pbmcuCi8vIFVubGlrZSBUcmFja2JhbGxDb250cm9scywgaXQgbWFpbnRhaW5zIHRoZSAidXAiIGRpcmVjdGlvbiBvYmplY3QudXAgKCtZIGJ5IGRlZmF1bHQpLgovLwovLyAgICBPcmJpdCAtIGxlZnQgbW91c2UgLyB0b3VjaDogb25lLWZpbmdlciBtb3ZlCi8vICAgIFpvb20gLSBtaWRkbGUgbW91c2UsIG9yIG1vdXNld2hlZWwgLyB0b3VjaDogdHdvLWZpbmdlciBzcHJlYWQgb3Igc3F1aXNoCi8vICAgIFBhbiAtIHJpZ2h0IG1vdXNlLCBvciBsZWZ0IG1vdXNlICsgY3RybC9tZXRhL3NoaWZ0S2V5LCBvciBhcnJvdyBrZXlzIC8gdG91Y2g6IHR3by1maW5nZXIgbW92ZQoKY29uc3QgX2NoYW5nZUV2ZW50ID0geyB0eXBlOiAnY2hhbmdlJyB9Owpjb25zdCBfc3RhcnRFdmVudCA9IHsgdHlwZTogJ3N0YXJ0JyB9Owpjb25zdCBfZW5kRXZlbnQgPSB7IHR5cGU6ICdlbmQnIH07CmNvbnN0IF9yYXkgPSBuZXcgUmF5KCk7CmNvbnN0IF9wbGFuZSA9IG5ldyBQbGFuZSgpOwpjb25zdCBUSUxUX0xJTUlUID0gTWF0aC5jb3MoIDcwICogTWF0aFV0aWxzLkRFRzJSQUQgKTsKCmNsYXNzIE9yYml0Q29udHJvbHMgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKCWNvbnN0cnVjdG9yKCBvYmplY3QsIGRvbUVsZW1lbnQgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMub2JqZWN0ID0gb2JqZWN0OwoJCXRoaXMuZG9tRWxlbWVudCA9IGRvbUVsZW1lbnQ7CgkJdGhpcy5kb21FbGVtZW50LnN0eWxlLnRvdWNoQWN0aW9uID0gJ25vbmUnOyAvLyBkaXNhYmxlIHRvdWNoIHNjcm9sbAoKCQkvLyBTZXQgdG8gZmFsc2UgdG8gZGlzYWJsZSB0aGlzIGNvbnRyb2wKCQl0aGlzLmVuYWJsZWQgPSB0cnVlOwoKCQkvLyAidGFyZ2V0IiBzZXRzIHRoZSBsb2NhdGlvbiBvZiBmb2N1cywgd2hlcmUgdGhlIG9iamVjdCBvcmJpdHMgYXJvdW5kCgkJdGhpcy50YXJnZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkvLyBTZXRzIHRoZSAzRCBjdXJzb3IgKHNpbWlsYXIgdG8gQmxlbmRlciksIGZyb20gd2hpY2ggdGhlIG1heFRhcmdldFJhZGl1cyB0YWtlcyBlZmZlY3QKCQl0aGlzLmN1cnNvciA9IG5ldyBWZWN0b3IzKCk7CgoJCS8vIEhvdyBmYXIgeW91IGNhbiBkb2xseSBpbiBhbmQgb3V0ICggUGVyc3BlY3RpdmVDYW1lcmEgb25seSApCgkJdGhpcy5taW5EaXN0YW5jZSA9IDA7CgkJdGhpcy5tYXhEaXN0YW5jZSA9IEluZmluaXR5OwoKCQkvLyBIb3cgZmFyIHlvdSBjYW4gem9vbSBpbiBhbmQgb3V0ICggT3J0aG9ncmFwaGljQ2FtZXJhIG9ubHkgKQoJCXRoaXMubWluWm9vbSA9IDA7CgkJdGhpcy5tYXhab29tID0gSW5maW5pdHk7CgoJCS8vIExpbWl0IGNhbWVyYSB0YXJnZXQgd2l0aGluIGEgc3BoZXJpY2FsIGFyZWEgYXJvdW5kIHRoZSBjdXJzb3IKCQl0aGlzLm1pblRhcmdldFJhZGl1cyA9IDA7CgkJdGhpcy5tYXhUYXJnZXRSYWRpdXMgPSBJbmZpbml0eTsKCgkJLy8gSG93IGZhciB5b3UgY2FuIG9yYml0IHZlcnRpY2FsbHksIHVwcGVyIGFuZCBsb3dlciBsaW1pdHMuCgkJLy8gUmFuZ2UgaXMgMCB0byBNYXRoLlBJIHJhZGlhbnMuCgkJdGhpcy5taW5Qb2xhckFuZ2xlID0gMDsgLy8gcmFkaWFucwoJCXRoaXMubWF4UG9sYXJBbmdsZSA9IE1hdGguUEk7IC8vIHJhZGlhbnMKCgkJLy8gSG93IGZhciB5b3UgY2FuIG9yYml0IGhvcml6b250YWxseSwgdXBwZXIgYW5kIGxvd2VyIGxpbWl0cy4KCQkvLyBJZiBzZXQsIHRoZSBpbnRlcnZhbCBbIG1pbiwgbWF4IF0gbXVzdCBiZSBhIHN1Yi1pbnRlcnZhbCBvZiBbIC0gMiBQSSwgMiBQSSBdLCB3aXRoICggbWF4IC0gbWluIDwgMiBQSSApCgkJdGhpcy5taW5BemltdXRoQW5nbGUgPSAtIEluZmluaXR5OyAvLyByYWRpYW5zCgkJdGhpcy5tYXhBemltdXRoQW5nbGUgPSBJbmZpbml0eTsgLy8gcmFkaWFucwoKCQkvLyBTZXQgdG8gdHJ1ZSB0byBlbmFibGUgZGFtcGluZyAoaW5lcnRpYSkKCQkvLyBJZiBkYW1waW5nIGlzIGVuYWJsZWQsIHlvdSBtdXN0IGNhbGwgY29udHJvbHMudXBkYXRlKCkgaW4geW91ciBhbmltYXRpb24gbG9vcAoJCXRoaXMuZW5hYmxlRGFtcGluZyA9IGZhbHNlOwoJCXRoaXMuZGFtcGluZ0ZhY3RvciA9IDAuMDU7CgoJCS8vIFRoaXMgb3B0aW9uIGFjdHVhbGx5IGVuYWJsZXMgZG9sbHlpbmcgaW4gYW5kIG91dDsgbGVmdCBhcyAiem9vbSIgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LgoJCS8vIFNldCB0byBmYWxzZSB0byBkaXNhYmxlIHpvb21pbmcKCQl0aGlzLmVuYWJsZVpvb20gPSB0cnVlOwoJCXRoaXMuem9vbVNwZWVkID0gMS4wOwoKCQkvLyBTZXQgdG8gZmFsc2UgdG8gZGlzYWJsZSByb3RhdGluZwoJCXRoaXMuZW5hYmxlUm90YXRlID0gdHJ1ZTsKCQl0aGlzLnJvdGF0ZVNwZWVkID0gMS4wOwoKCQkvLyBTZXQgdG8gZmFsc2UgdG8gZGlzYWJsZSBwYW5uaW5nCgkJdGhpcy5lbmFibGVQYW4gPSB0cnVlOwoJCXRoaXMucGFuU3BlZWQgPSAxLjA7CgkJdGhpcy5zY3JlZW5TcGFjZVBhbm5pbmcgPSB0cnVlOyAvLyBpZiBmYWxzZSwgcGFuIG9ydGhvZ29uYWwgdG8gd29ybGQtc3BhY2UgZGlyZWN0aW9uIGNhbWVyYS51cAoJCXRoaXMua2V5UGFuU3BlZWQgPSA3LjA7CS8vIHBpeGVscyBtb3ZlZCBwZXIgYXJyb3cga2V5IHB1c2gKCQl0aGlzLnpvb21Ub0N1cnNvciA9IGZhbHNlOwoKCQkvLyBTZXQgdG8gdHJ1ZSB0byBhdXRvbWF0aWNhbGx5IHJvdGF0ZSBhcm91bmQgdGhlIHRhcmdldAoJCS8vIElmIGF1dG8tcm90YXRlIGlzIGVuYWJsZWQsIHlvdSBtdXN0IGNhbGwgY29udHJvbHMudXBkYXRlKCkgaW4geW91ciBhbmltYXRpb24gbG9vcAoJCXRoaXMuYXV0b1JvdGF0ZSA9IGZhbHNlOwoJCXRoaXMuYXV0b1JvdGF0ZVNwZWVkID0gMi4wOyAvLyAzMCBzZWNvbmRzIHBlciBvcmJpdCB3aGVuIGZwcyBpcyA2MAoKCQkvLyBUaGUgZm91ciBhcnJvdyBrZXlzCgkJdGhpcy5rZXlzID0geyBMRUZUOiAnQXJyb3dMZWZ0JywgVVA6ICdBcnJvd1VwJywgUklHSFQ6ICdBcnJvd1JpZ2h0JywgQk9UVE9NOiAnQXJyb3dEb3duJyB9OwoKCQkvLyBNb3VzZSBidXR0b25zCgkJdGhpcy5tb3VzZUJ1dHRvbnMgPSB7IExFRlQ6IE1PVVNFLlJPVEFURSwgTUlERExFOiBNT1VTRS5ET0xMWSwgUklHSFQ6IE1PVVNFLlBBTiB9OwoKCQkvLyBUb3VjaCBmaW5nZXJzCgkJdGhpcy50b3VjaGVzID0geyBPTkU6IFRPVUNILlJPVEFURSwgVFdPOiBUT1VDSC5ET0xMWV9QQU4gfTsKCgkJLy8gZm9yIHJlc2V0CgkJdGhpcy50YXJnZXQwID0gdGhpcy50YXJnZXQuY2xvbmUoKTsKCQl0aGlzLnBvc2l0aW9uMCA9IHRoaXMub2JqZWN0LnBvc2l0aW9uLmNsb25lKCk7CgkJdGhpcy56b29tMCA9IHRoaXMub2JqZWN0Lnpvb207CgoJCS8vIHRoZSB0YXJnZXQgRE9NIGVsZW1lbnQgZm9yIGtleSBldmVudHMKCQl0aGlzLl9kb21FbGVtZW50S2V5RXZlbnRzID0gbnVsbDsKCgkJLy8KCQkvLyBwdWJsaWMgbWV0aG9kcwoJCS8vCgoJCXRoaXMuZ2V0UG9sYXJBbmdsZSA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBzcGhlcmljYWwucGhpOwoKCQl9OwoKCQl0aGlzLmdldEF6aW11dGhhbEFuZ2xlID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHNwaGVyaWNhbC50aGV0YTsKCgkJfTsKCgkJdGhpcy5nZXREaXN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB0aGlzLm9iamVjdC5wb3NpdGlvbi5kaXN0YW5jZVRvKCB0aGlzLnRhcmdldCApOwoKCQl9OwoKCQl0aGlzLmxpc3RlblRvS2V5RXZlbnRzID0gZnVuY3Rpb24gKCBkb21FbGVtZW50ICkgewoKCQkJZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAna2V5ZG93bicsIG9uS2V5RG93biApOwoJCQl0aGlzLl9kb21FbGVtZW50S2V5RXZlbnRzID0gZG9tRWxlbWVudDsKCgkJfTsKCgkJdGhpcy5zdG9wTGlzdGVuVG9LZXlFdmVudHMgPSBmdW5jdGlvbiAoKSB7CgoJCQl0aGlzLl9kb21FbGVtZW50S2V5RXZlbnRzLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdrZXlkb3duJywgb25LZXlEb3duICk7CgkJCXRoaXMuX2RvbUVsZW1lbnRLZXlFdmVudHMgPSBudWxsOwoKCQl9OwoKCQl0aGlzLnNhdmVTdGF0ZSA9IGZ1bmN0aW9uICgpIHsKCgkJCXNjb3BlLnRhcmdldDAuY29weSggc2NvcGUudGFyZ2V0ICk7CgkJCXNjb3BlLnBvc2l0aW9uMC5jb3B5KCBzY29wZS5vYmplY3QucG9zaXRpb24gKTsKCQkJc2NvcGUuem9vbTAgPSBzY29wZS5vYmplY3Quem9vbTsKCgkJfTsKCgkJdGhpcy5yZXNldCA9IGZ1bmN0aW9uICgpIHsKCgkJCXNjb3BlLnRhcmdldC5jb3B5KCBzY29wZS50YXJnZXQwICk7CgkJCXNjb3BlLm9iamVjdC5wb3NpdGlvbi5jb3B5KCBzY29wZS5wb3NpdGlvbjAgKTsKCQkJc2NvcGUub2JqZWN0Lnpvb20gPSBzY29wZS56b29tMDsKCgkJCXNjb3BlLm9iamVjdC51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgkJCXNjb3BlLmRpc3BhdGNoRXZlbnQoIF9jaGFuZ2VFdmVudCApOwoKCQkJc2NvcGUudXBkYXRlKCk7CgoJCQlzdGF0ZSA9IFNUQVRFLk5PTkU7CgoJCX07CgoJCS8vIHRoaXMgbWV0aG9kIGlzIGV4cG9zZWQsIGJ1dCBwZXJoYXBzIGl0IHdvdWxkIGJlIGJldHRlciBpZiB3ZSBjYW4gbWFrZSBpdCBwcml2YXRlLi4uCgkJdGhpcy51cGRhdGUgPSBmdW5jdGlvbiAoKSB7CgoJCQljb25zdCBvZmZzZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkJLy8gc28gY2FtZXJhLnVwIGlzIHRoZSBvcmJpdCBheGlzCgkJCWNvbnN0IHF1YXQgPSBuZXcgUXVhdGVybmlvbigpLnNldEZyb21Vbml0VmVjdG9ycyggb2JqZWN0LnVwLCBuZXcgVmVjdG9yMyggMCwgMSwgMCApICk7CgkJCWNvbnN0IHF1YXRJbnZlcnNlID0gcXVhdC5jbG9uZSgpLmludmVydCgpOwoKCQkJY29uc3QgbGFzdFBvc2l0aW9uID0gbmV3IFZlY3RvcjMoKTsKCQkJY29uc3QgbGFzdFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoJCQljb25zdCBsYXN0VGFyZ2V0UG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoKCQkJY29uc3QgdHdvUEkgPSAyICogTWF0aC5QSTsKCgkJCXJldHVybiBmdW5jdGlvbiB1cGRhdGUoIGRlbHRhVGltZSA9IG51bGwgKSB7CgoJCQkJY29uc3QgcG9zaXRpb24gPSBzY29wZS5vYmplY3QucG9zaXRpb247CgoJCQkJb2Zmc2V0LmNvcHkoIHBvc2l0aW9uICkuc3ViKCBzY29wZS50YXJnZXQgKTsKCgkJCQkvLyByb3RhdGUgb2Zmc2V0IHRvICJ5LWF4aXMtaXMtdXAiIHNwYWNlCgkJCQlvZmZzZXQuYXBwbHlRdWF0ZXJuaW9uKCBxdWF0ICk7CgoJCQkJLy8gYW5nbGUgZnJvbSB6LWF4aXMgYXJvdW5kIHktYXhpcwoJCQkJc3BoZXJpY2FsLnNldEZyb21WZWN0b3IzKCBvZmZzZXQgKTsKCgkJCQlpZiAoIHNjb3BlLmF1dG9Sb3RhdGUgJiYgc3RhdGUgPT09IFNUQVRFLk5PTkUgKSB7CgoJCQkJCXJvdGF0ZUxlZnQoIGdldEF1dG9Sb3RhdGlvbkFuZ2xlKCBkZWx0YVRpbWUgKSApOwoKCQkJCX0KCgkJCQlpZiAoIHNjb3BlLmVuYWJsZURhbXBpbmcgKSB7CgoJCQkJCXNwaGVyaWNhbC50aGV0YSArPSBzcGhlcmljYWxEZWx0YS50aGV0YSAqIHNjb3BlLmRhbXBpbmdGYWN0b3I7CgkJCQkJc3BoZXJpY2FsLnBoaSArPSBzcGhlcmljYWxEZWx0YS5waGkgKiBzY29wZS5kYW1waW5nRmFjdG9yOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXNwaGVyaWNhbC50aGV0YSArPSBzcGhlcmljYWxEZWx0YS50aGV0YTsKCQkJCQlzcGhlcmljYWwucGhpICs9IHNwaGVyaWNhbERlbHRhLnBoaTsKCgkJCQl9CgoJCQkJLy8gcmVzdHJpY3QgdGhldGEgdG8gYmUgYmV0d2VlbiBkZXNpcmVkIGxpbWl0cwoKCQkJCWxldCBtaW4gPSBzY29wZS5taW5BemltdXRoQW5nbGU7CgkJCQlsZXQgbWF4ID0gc2NvcGUubWF4QXppbXV0aEFuZ2xlOwoKCQkJCWlmICggaXNGaW5pdGUoIG1pbiApICYmIGlzRmluaXRlKCBtYXggKSApIHsKCgkJCQkJaWYgKCBtaW4gPCAtIE1hdGguUEkgKSBtaW4gKz0gdHdvUEk7IGVsc2UgaWYgKCBtaW4gPiBNYXRoLlBJICkgbWluIC09IHR3b1BJOwoKCQkJCQlpZiAoIG1heCA8IC0gTWF0aC5QSSApIG1heCArPSB0d29QSTsgZWxzZSBpZiAoIG1heCA+IE1hdGguUEkgKSBtYXggLT0gdHdvUEk7CgoJCQkJCWlmICggbWluIDw9IG1heCApIHsKCgkJCQkJCXNwaGVyaWNhbC50aGV0YSA9IE1hdGgubWF4KCBtaW4sIE1hdGgubWluKCBtYXgsIHNwaGVyaWNhbC50aGV0YSApICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlzcGhlcmljYWwudGhldGEgPSAoIHNwaGVyaWNhbC50aGV0YSA+ICggbWluICsgbWF4ICkgLyAyICkgPwoJCQkJCQkJTWF0aC5tYXgoIG1pbiwgc3BoZXJpY2FsLnRoZXRhICkgOgoJCQkJCQkJTWF0aC5taW4oIG1heCwgc3BoZXJpY2FsLnRoZXRhICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gcmVzdHJpY3QgcGhpIHRvIGJlIGJldHdlZW4gZGVzaXJlZCBsaW1pdHMKCQkJCXNwaGVyaWNhbC5waGkgPSBNYXRoLm1heCggc2NvcGUubWluUG9sYXJBbmdsZSwgTWF0aC5taW4oIHNjb3BlLm1heFBvbGFyQW5nbGUsIHNwaGVyaWNhbC5waGkgKSApOwoKCQkJCXNwaGVyaWNhbC5tYWtlU2FmZSgpOwoKCgkJCQkvLyBtb3ZlIHRhcmdldCB0byBwYW5uZWQgbG9jYXRpb24KCgkJCQlpZiAoIHNjb3BlLmVuYWJsZURhbXBpbmcgPT09IHRydWUgKSB7CgoJCQkJCXNjb3BlLnRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIHBhbk9mZnNldCwgc2NvcGUuZGFtcGluZ0ZhY3RvciApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXNjb3BlLnRhcmdldC5hZGQoIHBhbk9mZnNldCApOwoKCQkJCX0KCgkJCQkvLyBMaW1pdCB0aGUgdGFyZ2V0IGRpc3RhbmNlIGZyb20gdGhlIGN1cnNvciB0byBjcmVhdGUgYSBzcGhlcmUgYXJvdW5kIHRoZSBjZW50ZXIgb2YgaW50ZXJlc3QKCQkJCXNjb3BlLnRhcmdldC5zdWIoIHNjb3BlLmN1cnNvciApOwoJCQkJc2NvcGUudGFyZ2V0LmNsYW1wTGVuZ3RoKCBzY29wZS5taW5UYXJnZXRSYWRpdXMsIHNjb3BlLm1heFRhcmdldFJhZGl1cyApOwoJCQkJc2NvcGUudGFyZ2V0LmFkZCggc2NvcGUuY3Vyc29yICk7CgoJCQkJLy8gYWRqdXN0IHRoZSBjYW1lcmEgcG9zaXRpb24gYmFzZWQgb24gem9vbSBvbmx5IGlmIHdlJ3JlIG5vdCB6b29taW5nIHRvIHRoZSBjdXJzb3Igb3IgaWYgaXQncyBhbiBvcnRobyBjYW1lcmEKCQkJCS8vIHdlIGFkanVzdCB6b29tIGxhdGVyIGluIHRoZXNlIGNhc2VzCgkJCQlpZiAoIHNjb3BlLnpvb21Ub0N1cnNvciAmJiBwZXJmb3JtQ3Vyc29yWm9vbSB8fCBzY29wZS5vYmplY3QuaXNPcnRob2dyYXBoaWNDYW1lcmEgKSB7CgoJCQkJCXNwaGVyaWNhbC5yYWRpdXMgPSBjbGFtcERpc3RhbmNlKCBzcGhlcmljYWwucmFkaXVzICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc3BoZXJpY2FsLnJhZGl1cyA9IGNsYW1wRGlzdGFuY2UoIHNwaGVyaWNhbC5yYWRpdXMgKiBzY2FsZSApOwoKCQkJCX0KCgkJCQlvZmZzZXQuc2V0RnJvbVNwaGVyaWNhbCggc3BoZXJpY2FsICk7CgoJCQkJLy8gcm90YXRlIG9mZnNldCBiYWNrIHRvICJjYW1lcmEtdXAtdmVjdG9yLWlzLXVwIiBzcGFjZQoJCQkJb2Zmc2V0LmFwcGx5UXVhdGVybmlvbiggcXVhdEludmVyc2UgKTsKCgkJCQlwb3NpdGlvbi5jb3B5KCBzY29wZS50YXJnZXQgKS5hZGQoIG9mZnNldCApOwoKCQkJCXNjb3BlLm9iamVjdC5sb29rQXQoIHNjb3BlLnRhcmdldCApOwoKCQkJCWlmICggc2NvcGUuZW5hYmxlRGFtcGluZyA9PT0gdHJ1ZSApIHsKCgkJCQkJc3BoZXJpY2FsRGVsdGEudGhldGEgKj0gKCAxIC0gc2NvcGUuZGFtcGluZ0ZhY3RvciApOwoJCQkJCXNwaGVyaWNhbERlbHRhLnBoaSAqPSAoIDEgLSBzY29wZS5kYW1waW5nRmFjdG9yICk7CgoJCQkJCXBhbk9mZnNldC5tdWx0aXBseVNjYWxhciggMSAtIHNjb3BlLmRhbXBpbmdGYWN0b3IgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlzcGhlcmljYWxEZWx0YS5zZXQoIDAsIDAsIDAgKTsKCgkJCQkJcGFuT2Zmc2V0LnNldCggMCwgMCwgMCApOwoKCQkJCX0KCgkJCQkvLyBhZGp1c3QgY2FtZXJhIHBvc2l0aW9uCgkJCQlsZXQgem9vbUNoYW5nZWQgPSBmYWxzZTsKCQkJCWlmICggc2NvcGUuem9vbVRvQ3Vyc29yICYmIHBlcmZvcm1DdXJzb3Jab29tICkgewoKCQkJCQlsZXQgbmV3UmFkaXVzID0gbnVsbDsKCQkJCQlpZiAoIHNjb3BlLm9iamVjdC5pc1BlcnNwZWN0aXZlQ2FtZXJhICkgewoKCQkJCQkJLy8gbW92ZSB0aGUgY2FtZXJhIGRvd24gdGhlIHBvaW50ZXIgcmF5CgkJCQkJCS8vIHRoaXMgbWV0aG9kIGF2b2lkcyBmbG9hdGluZyBwb2ludCBlcnJvcgoJCQkJCQljb25zdCBwcmV2UmFkaXVzID0gb2Zmc2V0Lmxlbmd0aCgpOwoJCQkJCQluZXdSYWRpdXMgPSBjbGFtcERpc3RhbmNlKCBwcmV2UmFkaXVzICogc2NhbGUgKTsKCgkJCQkJCWNvbnN0IHJhZGl1c0RlbHRhID0gcHJldlJhZGl1cyAtIG5ld1JhZGl1czsKCQkJCQkJc2NvcGUub2JqZWN0LnBvc2l0aW9uLmFkZFNjYWxlZFZlY3RvciggZG9sbHlEaXJlY3Rpb24sIHJhZGl1c0RlbHRhICk7CgkJCQkJCXNjb3BlLm9iamVjdC51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJCQl9IGVsc2UgaWYgKCBzY29wZS5vYmplY3QuaXNPcnRob2dyYXBoaWNDYW1lcmEgKSB7CgoJCQkJCQkvLyBhZGp1c3QgdGhlIG9ydGhvIGNhbWVyYSBwb3NpdGlvbiBiYXNlZCBvbiB6b29tIGNoYW5nZXMKCQkJCQkJY29uc3QgbW91c2VCZWZvcmUgPSBuZXcgVmVjdG9yMyggbW91c2UueCwgbW91c2UueSwgMCApOwoJCQkJCQltb3VzZUJlZm9yZS51bnByb2plY3QoIHNjb3BlLm9iamVjdCApOwoKCQkJCQkJc2NvcGUub2JqZWN0Lnpvb20gPSBNYXRoLm1heCggc2NvcGUubWluWm9vbSwgTWF0aC5taW4oIHNjb3BlLm1heFpvb20sIHNjb3BlLm9iamVjdC56b29tIC8gc2NhbGUgKSApOwoJCQkJCQlzY29wZS5vYmplY3QudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoJCQkJCQl6b29tQ2hhbmdlZCA9IHRydWU7CgoJCQkJCQljb25zdCBtb3VzZUFmdGVyID0gbmV3IFZlY3RvcjMoIG1vdXNlLngsIG1vdXNlLnksIDAgKTsKCQkJCQkJbW91c2VBZnRlci51bnByb2plY3QoIHNjb3BlLm9iamVjdCApOwoKCQkJCQkJc2NvcGUub2JqZWN0LnBvc2l0aW9uLnN1YiggbW91c2VBZnRlciApLmFkZCggbW91c2VCZWZvcmUgKTsKCQkJCQkJc2NvcGUub2JqZWN0LnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCQkJCQluZXdSYWRpdXMgPSBvZmZzZXQubGVuZ3RoKCk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQljb25zb2xlLndhcm4oICdXQVJOSU5HOiBPcmJpdENvbnRyb2xzLmpzIGVuY291bnRlcmVkIGFuIHVua25vd24gY2FtZXJhIHR5cGUgLSB6b29tIHRvIGN1cnNvciBkaXNhYmxlZC4nICk7CgkJCQkJCXNjb3BlLnpvb21Ub0N1cnNvciA9IGZhbHNlOwoKCQkJCQl9CgoJCQkJCS8vIGhhbmRsZSB0aGUgcGxhY2VtZW50IG9mIHRoZSB0YXJnZXQKCQkJCQlpZiAoIG5ld1JhZGl1cyAhPT0gbnVsbCApIHsKCgkJCQkJCWlmICggdGhpcy5zY3JlZW5TcGFjZVBhbm5pbmcgKSB7CgoJCQkJCQkJLy8gcG9zaXRpb24gdGhlIG9yYml0IHRhcmdldCBpbiBmcm9udCBvZiB0aGUgbmV3IGNhbWVyYSBwb3NpdGlvbgoJCQkJCQkJc2NvcGUudGFyZ2V0LnNldCggMCwgMCwgLSAxICkKCQkJCQkJCQkudHJhbnNmb3JtRGlyZWN0aW9uKCBzY29wZS5vYmplY3QubWF0cml4ICkKCQkJCQkJCQkubXVsdGlwbHlTY2FsYXIoIG5ld1JhZGl1cyApCgkJCQkJCQkJLmFkZCggc2NvcGUub2JqZWN0LnBvc2l0aW9uICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCS8vIGdldCB0aGUgcmF5IGFuZCB0cmFuc2xhdGlvbiBwbGFuZSB0byBjb21wdXRlIHRhcmdldAoJCQkJCQkJX3JheS5vcmlnaW4uY29weSggc2NvcGUub2JqZWN0LnBvc2l0aW9uICk7CgkJCQkJCQlfcmF5LmRpcmVjdGlvbi5zZXQoIDAsIDAsIC0gMSApLnRyYW5zZm9ybURpcmVjdGlvbiggc2NvcGUub2JqZWN0Lm1hdHJpeCApOwoKCQkJCQkJCS8vIGlmIHRoZSBjYW1lcmEgaXMgMjAgZGVncmVlcyBhYm92ZSB0aGUgaG9yaXpvbiB0aGVuIGRvbid0IGFkanVzdCB0aGUgZm9jdXMgdGFyZ2V0IHRvIGF2b2lkCgkJCQkJCQkvLyBleHRyZW1lbHkgbGFyZ2UgdmFsdWVzCgkJCQkJCQlpZiAoIE1hdGguYWJzKCBzY29wZS5vYmplY3QudXAuZG90KCBfcmF5LmRpcmVjdGlvbiApICkgPCBUSUxUX0xJTUlUICkgewoKCQkJCQkJCQlvYmplY3QubG9va0F0KCBzY29wZS50YXJnZXQgKTsKCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlfcGxhbmUuc2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQoIHNjb3BlLm9iamVjdC51cCwgc2NvcGUudGFyZ2V0ICk7CgkJCQkJCQkJX3JheS5pbnRlcnNlY3RQbGFuZSggX3BsYW5lLCBzY29wZS50YXJnZXQgKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9IGVsc2UgaWYgKCBzY29wZS5vYmplY3QuaXNPcnRob2dyYXBoaWNDYW1lcmEgKSB7CgoJCQkJCXNjb3BlLm9iamVjdC56b29tID0gTWF0aC5tYXgoIHNjb3BlLm1pblpvb20sIE1hdGgubWluKCBzY29wZS5tYXhab29tLCBzY29wZS5vYmplY3Quem9vbSAvIHNjYWxlICkgKTsKCQkJCQlzY29wZS5vYmplY3QudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoJCQkJCXpvb21DaGFuZ2VkID0gdHJ1ZTsKCgkJCQl9CgoJCQkJc2NhbGUgPSAxOwoJCQkJcGVyZm9ybUN1cnNvclpvb20gPSBmYWxzZTsKCgkJCQkvLyB1cGRhdGUgY29uZGl0aW9uIGlzOgoJCQkJLy8gbWluKGNhbWVyYSBkaXNwbGFjZW1lbnQsIGNhbWVyYSByb3RhdGlvbiBpbiByYWRpYW5zKV4yID4gRVBTCgkJCQkvLyB1c2luZyBzbWFsbC1hbmdsZSBhcHByb3hpbWF0aW9uIGNvcyh4LzIpID0gMSAtIHheMiAvIDgKCgkJCQlpZiAoIHpvb21DaGFuZ2VkIHx8CgkJCQkJbGFzdFBvc2l0aW9uLmRpc3RhbmNlVG9TcXVhcmVkKCBzY29wZS5vYmplY3QucG9zaXRpb24gKSA+IEVQUyB8fAoJCQkJCTggKiAoIDEgLSBsYXN0UXVhdGVybmlvbi5kb3QoIHNjb3BlLm9iamVjdC5xdWF0ZXJuaW9uICkgKSA+IEVQUyB8fAoJCQkJCWxhc3RUYXJnZXRQb3NpdGlvbi5kaXN0YW5jZVRvU3F1YXJlZCggc2NvcGUudGFyZ2V0ICkgPiAwICkgewoKCQkJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCBfY2hhbmdlRXZlbnQgKTsKCgkJCQkJbGFzdFBvc2l0aW9uLmNvcHkoIHNjb3BlLm9iamVjdC5wb3NpdGlvbiApOwoJCQkJCWxhc3RRdWF0ZXJuaW9uLmNvcHkoIHNjb3BlLm9iamVjdC5xdWF0ZXJuaW9uICk7CgkJCQkJbGFzdFRhcmdldFBvc2l0aW9uLmNvcHkoIHNjb3BlLnRhcmdldCApOwoKCQkJCQlyZXR1cm4gdHJ1ZTsKCgkJCQl9CgoJCQkJcmV0dXJuIGZhbHNlOwoKCQkJfTsKCgkJfSgpOwoKCQl0aGlzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7CgoJCQlzY29wZS5kb21FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdjb250ZXh0bWVudScsIG9uQ29udGV4dE1lbnUgKTsKCgkJCXNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3BvaW50ZXJkb3duJywgb25Qb2ludGVyRG93biApOwoJCQlzY29wZS5kb21FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdwb2ludGVyY2FuY2VsJywgb25Qb2ludGVyVXAgKTsKCQkJc2NvcGUuZG9tRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAnd2hlZWwnLCBvbk1vdXNlV2hlZWwgKTsKCgkJCXNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3BvaW50ZXJtb3ZlJywgb25Qb2ludGVyTW92ZSApOwoJCQlzY29wZS5kb21FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdwb2ludGVydXAnLCBvblBvaW50ZXJVcCApOwoKCgkJCWlmICggc2NvcGUuX2RvbUVsZW1lbnRLZXlFdmVudHMgIT09IG51bGwgKSB7CgoJCQkJc2NvcGUuX2RvbUVsZW1lbnRLZXlFdmVudHMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2tleWRvd24nLCBvbktleURvd24gKTsKCQkJCXNjb3BlLl9kb21FbGVtZW50S2V5RXZlbnRzID0gbnVsbDsKCgkJCX0KCgkJCS8vc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOyAvLyBzaG91bGQgdGhpcyBiZSBhZGRlZCBoZXJlPwoKCQl9OwoKCQkvLwoJCS8vIGludGVybmFscwoJCS8vCgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJY29uc3QgU1RBVEUgPSB7CgkJCU5PTkU6IC0gMSwKCQkJUk9UQVRFOiAwLAoJCQlET0xMWTogMSwKCQkJUEFOOiAyLAoJCQlUT1VDSF9ST1RBVEU6IDMsCgkJCVRPVUNIX1BBTjogNCwKCQkJVE9VQ0hfRE9MTFlfUEFOOiA1LAoJCQlUT1VDSF9ET0xMWV9ST1RBVEU6IDYKCQl9OwoKCQlsZXQgc3RhdGUgPSBTVEFURS5OT05FOwoKCQljb25zdCBFUFMgPSAwLjAwMDAwMTsKCgkJLy8gY3VycmVudCBwb3NpdGlvbiBpbiBzcGhlcmljYWwgY29vcmRpbmF0ZXMKCQljb25zdCBzcGhlcmljYWwgPSBuZXcgU3BoZXJpY2FsKCk7CgkJY29uc3Qgc3BoZXJpY2FsRGVsdGEgPSBuZXcgU3BoZXJpY2FsKCk7CgoJCWxldCBzY2FsZSA9IDE7CgkJY29uc3QgcGFuT2Zmc2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJY29uc3Qgcm90YXRlU3RhcnQgPSBuZXcgVmVjdG9yMigpOwoJCWNvbnN0IHJvdGF0ZUVuZCA9IG5ldyBWZWN0b3IyKCk7CgkJY29uc3Qgcm90YXRlRGVsdGEgPSBuZXcgVmVjdG9yMigpOwoKCQljb25zdCBwYW5TdGFydCA9IG5ldyBWZWN0b3IyKCk7CgkJY29uc3QgcGFuRW5kID0gbmV3IFZlY3RvcjIoKTsKCQljb25zdCBwYW5EZWx0YSA9IG5ldyBWZWN0b3IyKCk7CgoJCWNvbnN0IGRvbGx5U3RhcnQgPSBuZXcgVmVjdG9yMigpOwoJCWNvbnN0IGRvbGx5RW5kID0gbmV3IFZlY3RvcjIoKTsKCQljb25zdCBkb2xseURlbHRhID0gbmV3IFZlY3RvcjIoKTsKCgkJY29uc3QgZG9sbHlEaXJlY3Rpb24gPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IG1vdXNlID0gbmV3IFZlY3RvcjIoKTsKCQlsZXQgcGVyZm9ybUN1cnNvclpvb20gPSBmYWxzZTsKCgkJY29uc3QgcG9pbnRlcnMgPSBbXTsKCQljb25zdCBwb2ludGVyUG9zaXRpb25zID0ge307CgoJCWZ1bmN0aW9uIGdldEF1dG9Sb3RhdGlvbkFuZ2xlKCBkZWx0YVRpbWUgKSB7CgoJCQlpZiAoIGRlbHRhVGltZSAhPT0gbnVsbCApIHsKCgkJCQlyZXR1cm4gKCAyICogTWF0aC5QSSAvIDYwICogc2NvcGUuYXV0b1JvdGF0ZVNwZWVkICkgKiBkZWx0YVRpbWU7CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybiAyICogTWF0aC5QSSAvIDYwIC8gNjAgKiBzY29wZS5hdXRvUm90YXRlU3BlZWQ7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZ2V0Wm9vbVNjYWxlKCBkZWx0YSApIHsKCgkJCWNvbnN0IG5vcm1hbGl6ZWRfZGVsdGEgPSBNYXRoLmFicyggZGVsdGEgKSAvICggMTAwICogKCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8IDAgKSApOwoJCQlyZXR1cm4gTWF0aC5wb3coIDAuOTUsIHNjb3BlLnpvb21TcGVlZCAqIG5vcm1hbGl6ZWRfZGVsdGEgKTsKCgkJfQoKCQlmdW5jdGlvbiByb3RhdGVMZWZ0KCBhbmdsZSApIHsKCgkJCXNwaGVyaWNhbERlbHRhLnRoZXRhIC09IGFuZ2xlOwoKCQl9CgoJCWZ1bmN0aW9uIHJvdGF0ZVVwKCBhbmdsZSApIHsKCgkJCXNwaGVyaWNhbERlbHRhLnBoaSAtPSBhbmdsZTsKCgkJfQoKCQljb25zdCBwYW5MZWZ0ID0gZnVuY3Rpb24gKCkgewoKCQkJY29uc3QgdiA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcGFuTGVmdCggZGlzdGFuY2UsIG9iamVjdE1hdHJpeCApIHsKCgkJCQl2LnNldEZyb21NYXRyaXhDb2x1bW4oIG9iamVjdE1hdHJpeCwgMCApOyAvLyBnZXQgWCBjb2x1bW4gb2Ygb2JqZWN0TWF0cml4CgkJCQl2Lm11bHRpcGx5U2NhbGFyKCAtIGRpc3RhbmNlICk7CgoJCQkJcGFuT2Zmc2V0LmFkZCggdiApOwoKCQkJfTsKCgkJfSgpOwoKCQljb25zdCBwYW5VcCA9IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnN0IHYgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHBhblVwKCBkaXN0YW5jZSwgb2JqZWN0TWF0cml4ICkgewoKCQkJCWlmICggc2NvcGUuc2NyZWVuU3BhY2VQYW5uaW5nID09PSB0cnVlICkgewoKCQkJCQl2LnNldEZyb21NYXRyaXhDb2x1bW4oIG9iamVjdE1hdHJpeCwgMSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXYuc2V0RnJvbU1hdHJpeENvbHVtbiggb2JqZWN0TWF0cml4LCAwICk7CgkJCQkJdi5jcm9zc1ZlY3RvcnMoIHNjb3BlLm9iamVjdC51cCwgdiApOwoKCQkJCX0KCgkJCQl2Lm11bHRpcGx5U2NhbGFyKCBkaXN0YW5jZSApOwoKCQkJCXBhbk9mZnNldC5hZGQoIHYgKTsKCgkJCX07CgoJCX0oKTsKCgkJLy8gZGVsdGFYIGFuZCBkZWx0YVkgYXJlIGluIHBpeGVsczsgcmlnaHQgYW5kIGRvd24gYXJlIHBvc2l0aXZlCgkJY29uc3QgcGFuID0gZnVuY3Rpb24gKCkgewoKCQkJY29uc3Qgb2Zmc2V0ID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBwYW4oIGRlbHRhWCwgZGVsdGFZICkgewoKCQkJCWNvbnN0IGVsZW1lbnQgPSBzY29wZS5kb21FbGVtZW50OwoKCQkJCWlmICggc2NvcGUub2JqZWN0LmlzUGVyc3BlY3RpdmVDYW1lcmEgKSB7CgoJCQkJCS8vIHBlcnNwZWN0aXZlCgkJCQkJY29uc3QgcG9zaXRpb24gPSBzY29wZS5vYmplY3QucG9zaXRpb247CgkJCQkJb2Zmc2V0LmNvcHkoIHBvc2l0aW9uICkuc3ViKCBzY29wZS50YXJnZXQgKTsKCQkJCQlsZXQgdGFyZ2V0RGlzdGFuY2UgPSBvZmZzZXQubGVuZ3RoKCk7CgoJCQkJCS8vIGhhbGYgb2YgdGhlIGZvdiBpcyBjZW50ZXIgdG8gdG9wIG9mIHNjcmVlbgoJCQkJCXRhcmdldERpc3RhbmNlICo9IE1hdGgudGFuKCAoIHNjb3BlLm9iamVjdC5mb3YgLyAyICkgKiBNYXRoLlBJIC8gMTgwLjAgKTsKCgkJCQkJLy8gd2UgdXNlIG9ubHkgY2xpZW50SGVpZ2h0IGhlcmUgc28gYXNwZWN0IHJhdGlvIGRvZXMgbm90IGRpc3RvcnQgc3BlZWQKCQkJCQlwYW5MZWZ0KCAyICogZGVsdGFYICogdGFyZ2V0RGlzdGFuY2UgLyBlbGVtZW50LmNsaWVudEhlaWdodCwgc2NvcGUub2JqZWN0Lm1hdHJpeCApOwoJCQkJCXBhblVwKCAyICogZGVsdGFZICogdGFyZ2V0RGlzdGFuY2UgLyBlbGVtZW50LmNsaWVudEhlaWdodCwgc2NvcGUub2JqZWN0Lm1hdHJpeCApOwoKCQkJCX0gZWxzZSBpZiAoIHNjb3BlLm9iamVjdC5pc09ydGhvZ3JhcGhpY0NhbWVyYSApIHsKCgkJCQkJLy8gb3J0aG9ncmFwaGljCgkJCQkJcGFuTGVmdCggZGVsdGFYICogKCBzY29wZS5vYmplY3QucmlnaHQgLSBzY29wZS5vYmplY3QubGVmdCApIC8gc2NvcGUub2JqZWN0Lnpvb20gLyBlbGVtZW50LmNsaWVudFdpZHRoLCBzY29wZS5vYmplY3QubWF0cml4ICk7CgkJCQkJcGFuVXAoIGRlbHRhWSAqICggc2NvcGUub2JqZWN0LnRvcCAtIHNjb3BlLm9iamVjdC5ib3R0b20gKSAvIHNjb3BlLm9iamVjdC56b29tIC8gZWxlbWVudC5jbGllbnRIZWlnaHQsIHNjb3BlLm9iamVjdC5tYXRyaXggKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBjYW1lcmEgbmVpdGhlciBvcnRob2dyYXBoaWMgbm9yIHBlcnNwZWN0aXZlCgkJCQkJY29uc29sZS53YXJuKCAnV0FSTklORzogT3JiaXRDb250cm9scy5qcyBlbmNvdW50ZXJlZCBhbiB1bmtub3duIGNhbWVyYSB0eXBlIC0gcGFuIGRpc2FibGVkLicgKTsKCQkJCQlzY29wZS5lbmFibGVQYW4gPSBmYWxzZTsKCgkJCQl9CgoJCQl9OwoKCQl9KCk7CgoJCWZ1bmN0aW9uIGRvbGx5T3V0KCBkb2xseVNjYWxlICkgewoKCQkJaWYgKCBzY29wZS5vYmplY3QuaXNQZXJzcGVjdGl2ZUNhbWVyYSB8fCBzY29wZS5vYmplY3QuaXNPcnRob2dyYXBoaWNDYW1lcmEgKSB7CgoJCQkJc2NhbGUgLz0gZG9sbHlTY2FsZTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnV0FSTklORzogT3JiaXRDb250cm9scy5qcyBlbmNvdW50ZXJlZCBhbiB1bmtub3duIGNhbWVyYSB0eXBlIC0gZG9sbHkvem9vbSBkaXNhYmxlZC4nICk7CgkJCQlzY29wZS5lbmFibGVab29tID0gZmFsc2U7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZG9sbHlJbiggZG9sbHlTY2FsZSApIHsKCgkJCWlmICggc2NvcGUub2JqZWN0LmlzUGVyc3BlY3RpdmVDYW1lcmEgfHwgc2NvcGUub2JqZWN0LmlzT3J0aG9ncmFwaGljQ2FtZXJhICkgewoKCQkJCXNjYWxlICo9IGRvbGx5U2NhbGU7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnNvbGUud2FybiggJ1dBUk5JTkc6IE9yYml0Q29udHJvbHMuanMgZW5jb3VudGVyZWQgYW4gdW5rbm93biBjYW1lcmEgdHlwZSAtIGRvbGx5L3pvb20gZGlzYWJsZWQuJyApOwoJCQkJc2NvcGUuZW5hYmxlWm9vbSA9IGZhbHNlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZVpvb21QYXJhbWV0ZXJzKCB4LCB5ICkgewoKCQkJaWYgKCAhIHNjb3BlLnpvb21Ub0N1cnNvciApIHsKCgkJCQlyZXR1cm47CgoJCQl9CgoJCQlwZXJmb3JtQ3Vyc29yWm9vbSA9IHRydWU7CgoJCQljb25zdCByZWN0ID0gc2NvcGUuZG9tRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQkJY29uc3QgZHggPSB4IC0gcmVjdC5sZWZ0OwoJCQljb25zdCBkeSA9IHkgLSByZWN0LnRvcDsKCQkJY29uc3QgdyA9IHJlY3Qud2lkdGg7CgkJCWNvbnN0IGggPSByZWN0LmhlaWdodDsKCgkJCW1vdXNlLnggPSAoIGR4IC8gdyApICogMiAtIDE7CgkJCW1vdXNlLnkgPSAtICggZHkgLyBoICkgKiAyICsgMTsKCgkJCWRvbGx5RGlyZWN0aW9uLnNldCggbW91c2UueCwgbW91c2UueSwgMSApLnVucHJvamVjdCggc2NvcGUub2JqZWN0ICkuc3ViKCBzY29wZS5vYmplY3QucG9zaXRpb24gKS5ub3JtYWxpemUoKTsKCgkJfQoKCQlmdW5jdGlvbiBjbGFtcERpc3RhbmNlKCBkaXN0ICkgewoKCQkJcmV0dXJuIE1hdGgubWF4KCBzY29wZS5taW5EaXN0YW5jZSwgTWF0aC5taW4oIHNjb3BlLm1heERpc3RhbmNlLCBkaXN0ICkgKTsKCgkJfQoKCQkvLwoJCS8vIGV2ZW50IGNhbGxiYWNrcyAtIHVwZGF0ZSB0aGUgb2JqZWN0IHN0YXRlCgkJLy8KCgkJZnVuY3Rpb24gaGFuZGxlTW91c2VEb3duUm90YXRlKCBldmVudCApIHsKCgkJCXJvdGF0ZVN0YXJ0LnNldCggZXZlbnQuY2xpZW50WCwgZXZlbnQuY2xpZW50WSApOwoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZU1vdXNlRG93bkRvbGx5KCBldmVudCApIHsKCgkJCXVwZGF0ZVpvb21QYXJhbWV0ZXJzKCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRYICk7CgkJCWRvbGx5U3RhcnQuc2V0KCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZICk7CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlTW91c2VEb3duUGFuKCBldmVudCApIHsKCgkJCXBhblN0YXJ0LnNldCggZXZlbnQuY2xpZW50WCwgZXZlbnQuY2xpZW50WSApOwoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZU1vdXNlTW92ZVJvdGF0ZSggZXZlbnQgKSB7CgoJCQlyb3RhdGVFbmQuc2V0KCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZICk7CgoJCQlyb3RhdGVEZWx0YS5zdWJWZWN0b3JzKCByb3RhdGVFbmQsIHJvdGF0ZVN0YXJ0ICkubXVsdGlwbHlTY2FsYXIoIHNjb3BlLnJvdGF0ZVNwZWVkICk7CgoJCQljb25zdCBlbGVtZW50ID0gc2NvcGUuZG9tRWxlbWVudDsKCgkJCXJvdGF0ZUxlZnQoIDIgKiBNYXRoLlBJICogcm90YXRlRGVsdGEueCAvIGVsZW1lbnQuY2xpZW50SGVpZ2h0ICk7IC8vIHllcywgaGVpZ2h0CgoJCQlyb3RhdGVVcCggMiAqIE1hdGguUEkgKiByb3RhdGVEZWx0YS55IC8gZWxlbWVudC5jbGllbnRIZWlnaHQgKTsKCgkJCXJvdGF0ZVN0YXJ0LmNvcHkoIHJvdGF0ZUVuZCApOwoKCQkJc2NvcGUudXBkYXRlKCk7CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlRG9sbHkoIGV2ZW50ICkgewoKCQkJZG9sbHlFbmQuc2V0KCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZICk7CgoJCQlkb2xseURlbHRhLnN1YlZlY3RvcnMoIGRvbGx5RW5kLCBkb2xseVN0YXJ0ICk7CgoJCQlpZiAoIGRvbGx5RGVsdGEueSA+IDAgKSB7CgoJCQkJZG9sbHlPdXQoIGdldFpvb21TY2FsZSggZG9sbHlEZWx0YS55ICkgKTsKCgkJCX0gZWxzZSBpZiAoIGRvbGx5RGVsdGEueSA8IDAgKSB7CgoJCQkJZG9sbHlJbiggZ2V0Wm9vbVNjYWxlKCBkb2xseURlbHRhLnkgKSApOwoKCQkJfQoKCQkJZG9sbHlTdGFydC5jb3B5KCBkb2xseUVuZCApOwoKCQkJc2NvcGUudXBkYXRlKCk7CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlUGFuKCBldmVudCApIHsKCgkJCXBhbkVuZC5zZXQoIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFkgKTsKCgkJCXBhbkRlbHRhLnN1YlZlY3RvcnMoIHBhbkVuZCwgcGFuU3RhcnQgKS5tdWx0aXBseVNjYWxhciggc2NvcGUucGFuU3BlZWQgKTsKCgkJCXBhbiggcGFuRGVsdGEueCwgcGFuRGVsdGEueSApOwoKCQkJcGFuU3RhcnQuY29weSggcGFuRW5kICk7CgoJCQlzY29wZS51cGRhdGUoKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVNb3VzZVdoZWVsKCBldmVudCApIHsKCgkJCXVwZGF0ZVpvb21QYXJhbWV0ZXJzKCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZICk7CgoJCQlpZiAoIGV2ZW50LmRlbHRhWSA8IDAgKSB7CgoJCQkJZG9sbHlJbiggZ2V0Wm9vbVNjYWxlKCBldmVudC5kZWx0YVkgKSApOwoKCQkJfSBlbHNlIGlmICggZXZlbnQuZGVsdGFZID4gMCApIHsKCgkJCQlkb2xseU91dCggZ2V0Wm9vbVNjYWxlKCBldmVudC5kZWx0YVkgKSApOwoKCQkJfQoKCQkJc2NvcGUudXBkYXRlKCk7CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlS2V5RG93biggZXZlbnQgKSB7CgoJCQlsZXQgbmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCXN3aXRjaCAoIGV2ZW50LmNvZGUgKSB7CgoJCQkJY2FzZSBzY29wZS5rZXlzLlVQOgoKCQkJCQlpZiAoIGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSB8fCBldmVudC5zaGlmdEtleSApIHsKCgkJCQkJCXJvdGF0ZVVwKCAyICogTWF0aC5QSSAqIHNjb3BlLnJvdGF0ZVNwZWVkIC8gc2NvcGUuZG9tRWxlbWVudC5jbGllbnRIZWlnaHQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXBhbiggMCwgc2NvcGUua2V5UGFuU3BlZWQgKTsKCgkJCQkJfQoKCQkJCQluZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBzY29wZS5rZXlzLkJPVFRPTToKCgkJCQkJaWYgKCBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuc2hpZnRLZXkgKSB7CgoJCQkJCQlyb3RhdGVVcCggLSAyICogTWF0aC5QSSAqIHNjb3BlLnJvdGF0ZVNwZWVkIC8gc2NvcGUuZG9tRWxlbWVudC5jbGllbnRIZWlnaHQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXBhbiggMCwgLSBzY29wZS5rZXlQYW5TcGVlZCApOwoKCQkJCQl9CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJCQlicmVhazsKCgkJCQljYXNlIHNjb3BlLmtleXMuTEVGVDoKCgkJCQkJaWYgKCBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuc2hpZnRLZXkgKSB7CgoJCQkJCQlyb3RhdGVMZWZ0KCAyICogTWF0aC5QSSAqIHNjb3BlLnJvdGF0ZVNwZWVkIC8gc2NvcGUuZG9tRWxlbWVudC5jbGllbnRIZWlnaHQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXBhbiggc2NvcGUua2V5UGFuU3BlZWQsIDAgKTsKCgkJCQkJfQoKCQkJCQluZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBzY29wZS5rZXlzLlJJR0hUOgoKCQkJCQlpZiAoIGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSB8fCBldmVudC5zaGlmdEtleSApIHsKCgkJCQkJCXJvdGF0ZUxlZnQoIC0gMiAqIE1hdGguUEkgKiBzY29wZS5yb3RhdGVTcGVlZCAvIHNjb3BlLmRvbUVsZW1lbnQuY2xpZW50SGVpZ2h0ICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlwYW4oIC0gc2NvcGUua2V5UGFuU3BlZWQsIDAgKTsKCgkJCQkJfQoKCQkJCQluZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJYnJlYWs7CgoJCQl9CgoJCQlpZiAoIG5lZWRzVXBkYXRlICkgewoKCQkJCS8vIHByZXZlbnQgdGhlIGJyb3dzZXIgZnJvbSBzY3JvbGxpbmcgb24gY3Vyc29yIGtleXMKCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCQkJc2NvcGUudXBkYXRlKCk7CgoJCQl9CgoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZVRvdWNoU3RhcnRSb3RhdGUoIGV2ZW50ICkgewoKCQkJaWYgKCBwb2ludGVycy5sZW5ndGggPT09IDEgKSB7CgoJCQkJcm90YXRlU3RhcnQuc2V0KCBldmVudC5wYWdlWCwgZXZlbnQucGFnZVkgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgcG9zaXRpb24gPSBnZXRTZWNvbmRQb2ludGVyUG9zaXRpb24oIGV2ZW50ICk7CgoJCQkJY29uc3QgeCA9IDAuNSAqICggZXZlbnQucGFnZVggKyBwb3NpdGlvbi54ICk7CgkJCQljb25zdCB5ID0gMC41ICogKCBldmVudC5wYWdlWSArIHBvc2l0aW9uLnkgKTsKCgkJCQlyb3RhdGVTdGFydC5zZXQoIHgsIHkgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVUb3VjaFN0YXJ0UGFuKCBldmVudCApIHsKCgkJCWlmICggcG9pbnRlcnMubGVuZ3RoID09PSAxICkgewoKCQkJCXBhblN0YXJ0LnNldCggZXZlbnQucGFnZVgsIGV2ZW50LnBhZ2VZICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IHBvc2l0aW9uID0gZ2V0U2Vjb25kUG9pbnRlclBvc2l0aW9uKCBldmVudCApOwoKCQkJCWNvbnN0IHggPSAwLjUgKiAoIGV2ZW50LnBhZ2VYICsgcG9zaXRpb24ueCApOwoJCQkJY29uc3QgeSA9IDAuNSAqICggZXZlbnQucGFnZVkgKyBwb3NpdGlvbi55ICk7CgoJCQkJcGFuU3RhcnQuc2V0KCB4LCB5ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydERvbGx5KCBldmVudCApIHsKCgkJCWNvbnN0IHBvc2l0aW9uID0gZ2V0U2Vjb25kUG9pbnRlclBvc2l0aW9uKCBldmVudCApOwoKCQkJY29uc3QgZHggPSBldmVudC5wYWdlWCAtIHBvc2l0aW9uLng7CgkJCWNvbnN0IGR5ID0gZXZlbnQucGFnZVkgLSBwb3NpdGlvbi55OwoKCQkJY29uc3QgZGlzdGFuY2UgPSBNYXRoLnNxcnQoIGR4ICogZHggKyBkeSAqIGR5ICk7CgoJCQlkb2xseVN0YXJ0LnNldCggMCwgZGlzdGFuY2UgKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVUb3VjaFN0YXJ0RG9sbHlQYW4oIGV2ZW50ICkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVab29tICkgaGFuZGxlVG91Y2hTdGFydERvbGx5KCBldmVudCApOwoKCQkJaWYgKCBzY29wZS5lbmFibGVQYW4gKSBoYW5kbGVUb3VjaFN0YXJ0UGFuKCBldmVudCApOwoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZVRvdWNoU3RhcnREb2xseVJvdGF0ZSggZXZlbnQgKSB7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZVpvb20gKSBoYW5kbGVUb3VjaFN0YXJ0RG9sbHkoIGV2ZW50ICk7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZVJvdGF0ZSApIGhhbmRsZVRvdWNoU3RhcnRSb3RhdGUoIGV2ZW50ICk7CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlVG91Y2hNb3ZlUm90YXRlKCBldmVudCApIHsKCgkJCWlmICggcG9pbnRlcnMubGVuZ3RoID09IDEgKSB7CgoJCQkJcm90YXRlRW5kLnNldCggZXZlbnQucGFnZVgsIGV2ZW50LnBhZ2VZICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IHBvc2l0aW9uID0gZ2V0U2Vjb25kUG9pbnRlclBvc2l0aW9uKCBldmVudCApOwoKCQkJCWNvbnN0IHggPSAwLjUgKiAoIGV2ZW50LnBhZ2VYICsgcG9zaXRpb24ueCApOwoJCQkJY29uc3QgeSA9IDAuNSAqICggZXZlbnQucGFnZVkgKyBwb3NpdGlvbi55ICk7CgoJCQkJcm90YXRlRW5kLnNldCggeCwgeSApOwoKCQkJfQoKCQkJcm90YXRlRGVsdGEuc3ViVmVjdG9ycyggcm90YXRlRW5kLCByb3RhdGVTdGFydCApLm11bHRpcGx5U2NhbGFyKCBzY29wZS5yb3RhdGVTcGVlZCApOwoKCQkJY29uc3QgZWxlbWVudCA9IHNjb3BlLmRvbUVsZW1lbnQ7CgoJCQlyb3RhdGVMZWZ0KCAyICogTWF0aC5QSSAqIHJvdGF0ZURlbHRhLnggLyBlbGVtZW50LmNsaWVudEhlaWdodCApOyAvLyB5ZXMsIGhlaWdodAoKCQkJcm90YXRlVXAoIDIgKiBNYXRoLlBJICogcm90YXRlRGVsdGEueSAvIGVsZW1lbnQuY2xpZW50SGVpZ2h0ICk7CgoJCQlyb3RhdGVTdGFydC5jb3B5KCByb3RhdGVFbmQgKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVUb3VjaE1vdmVQYW4oIGV2ZW50ICkgewoKCQkJaWYgKCBwb2ludGVycy5sZW5ndGggPT09IDEgKSB7CgoJCQkJcGFuRW5kLnNldCggZXZlbnQucGFnZVgsIGV2ZW50LnBhZ2VZICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IHBvc2l0aW9uID0gZ2V0U2Vjb25kUG9pbnRlclBvc2l0aW9uKCBldmVudCApOwoKCQkJCWNvbnN0IHggPSAwLjUgKiAoIGV2ZW50LnBhZ2VYICsgcG9zaXRpb24ueCApOwoJCQkJY29uc3QgeSA9IDAuNSAqICggZXZlbnQucGFnZVkgKyBwb3NpdGlvbi55ICk7CgoJCQkJcGFuRW5kLnNldCggeCwgeSApOwoKCQkJfQoKCQkJcGFuRGVsdGEuc3ViVmVjdG9ycyggcGFuRW5kLCBwYW5TdGFydCApLm11bHRpcGx5U2NhbGFyKCBzY29wZS5wYW5TcGVlZCApOwoKCQkJcGFuKCBwYW5EZWx0YS54LCBwYW5EZWx0YS55ICk7CgoJCQlwYW5TdGFydC5jb3B5KCBwYW5FbmQgKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVUb3VjaE1vdmVEb2xseSggZXZlbnQgKSB7CgoJCQljb25zdCBwb3NpdGlvbiA9IGdldFNlY29uZFBvaW50ZXJQb3NpdGlvbiggZXZlbnQgKTsKCgkJCWNvbnN0IGR4ID0gZXZlbnQucGFnZVggLSBwb3NpdGlvbi54OwoJCQljb25zdCBkeSA9IGV2ZW50LnBhZ2VZIC0gcG9zaXRpb24ueTsKCgkJCWNvbnN0IGRpc3RhbmNlID0gTWF0aC5zcXJ0KCBkeCAqIGR4ICsgZHkgKiBkeSApOwoKCQkJZG9sbHlFbmQuc2V0KCAwLCBkaXN0YW5jZSApOwoKCQkJZG9sbHlEZWx0YS5zZXQoIDAsIE1hdGgucG93KCBkb2xseUVuZC55IC8gZG9sbHlTdGFydC55LCBzY29wZS56b29tU3BlZWQgKSApOwoKCQkJZG9sbHlPdXQoIGRvbGx5RGVsdGEueSApOwoKCQkJZG9sbHlTdGFydC5jb3B5KCBkb2xseUVuZCApOwoKCQkJY29uc3QgY2VudGVyWCA9ICggZXZlbnQucGFnZVggKyBwb3NpdGlvbi54ICkgKiAwLjU7CgkJCWNvbnN0IGNlbnRlclkgPSAoIGV2ZW50LnBhZ2VZICsgcG9zaXRpb24ueSApICogMC41OwoKCQkJdXBkYXRlWm9vbVBhcmFtZXRlcnMoIGNlbnRlclgsIGNlbnRlclkgKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVUb3VjaE1vdmVEb2xseVBhbiggZXZlbnQgKSB7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZVpvb20gKSBoYW5kbGVUb3VjaE1vdmVEb2xseSggZXZlbnQgKTsKCgkJCWlmICggc2NvcGUuZW5hYmxlUGFuICkgaGFuZGxlVG91Y2hNb3ZlUGFuKCBldmVudCApOwoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZURvbGx5Um90YXRlKCBldmVudCApIHsKCgkJCWlmICggc2NvcGUuZW5hYmxlWm9vbSApIGhhbmRsZVRvdWNoTW92ZURvbGx5KCBldmVudCApOwoKCQkJaWYgKCBzY29wZS5lbmFibGVSb3RhdGUgKSBoYW5kbGVUb3VjaE1vdmVSb3RhdGUoIGV2ZW50ICk7CgoJCX0KCgkJLy8KCQkvLyBldmVudCBoYW5kbGVycyAtIEZTTTogbGlzdGVuIGZvciBldmVudHMgYW5kIHJlc2V0IHN0YXRlCgkJLy8KCgkJZnVuY3Rpb24gb25Qb2ludGVyRG93biggZXZlbnQgKSB7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZWQgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJaWYgKCBwb2ludGVycy5sZW5ndGggPT09IDAgKSB7CgoJCQkJc2NvcGUuZG9tRWxlbWVudC5zZXRQb2ludGVyQ2FwdHVyZSggZXZlbnQucG9pbnRlcklkICk7CgoJCQkJc2NvcGUuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAncG9pbnRlcm1vdmUnLCBvblBvaW50ZXJNb3ZlICk7CgkJCQlzY29wZS5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdwb2ludGVydXAnLCBvblBvaW50ZXJVcCApOwoKCQkJfQoKCQkJLy8KCgkJCWFkZFBvaW50ZXIoIGV2ZW50ICk7CgoJCQlpZiAoIGV2ZW50LnBvaW50ZXJUeXBlID09PSAndG91Y2gnICkgewoKCQkJCW9uVG91Y2hTdGFydCggZXZlbnQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJb25Nb3VzZURvd24oIGV2ZW50ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gb25Qb2ludGVyTW92ZSggZXZlbnQgKSB7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZWQgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJaWYgKCBldmVudC5wb2ludGVyVHlwZSA9PT0gJ3RvdWNoJyApIHsKCgkJCQlvblRvdWNoTW92ZSggZXZlbnQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJb25Nb3VzZU1vdmUoIGV2ZW50ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gb25Qb2ludGVyVXAoIGV2ZW50ICkgewoKCQkJcmVtb3ZlUG9pbnRlciggZXZlbnQgKTsKCgkJCWlmICggcG9pbnRlcnMubGVuZ3RoID09PSAwICkgewoKCQkJCXNjb3BlLmRvbUVsZW1lbnQucmVsZWFzZVBvaW50ZXJDYXB0dXJlKCBldmVudC5wb2ludGVySWQgKTsKCgkJCQlzY29wZS5kb21FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdwb2ludGVybW92ZScsIG9uUG9pbnRlck1vdmUgKTsKCQkJCXNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3BvaW50ZXJ1cCcsIG9uUG9pbnRlclVwICk7CgoJCQl9CgoJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCBfZW5kRXZlbnQgKTsKCgkJCXN0YXRlID0gU1RBVEUuTk9ORTsKCgkJfQoKCQlmdW5jdGlvbiBvbk1vdXNlRG93biggZXZlbnQgKSB7CgoJCQlsZXQgbW91c2VBY3Rpb247CgoJCQlzd2l0Y2ggKCBldmVudC5idXR0b24gKSB7CgoJCQkJY2FzZSAwOgoKCQkJCQltb3VzZUFjdGlvbiA9IHNjb3BlLm1vdXNlQnV0dG9ucy5MRUZUOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgMToKCgkJCQkJbW91c2VBY3Rpb24gPSBzY29wZS5tb3VzZUJ1dHRvbnMuTUlERExFOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgMjoKCgkJCQkJbW91c2VBY3Rpb24gPSBzY29wZS5tb3VzZUJ1dHRvbnMuUklHSFQ7CgkJCQkJYnJlYWs7CgoJCQkJZGVmYXVsdDoKCgkJCQkJbW91c2VBY3Rpb24gPSAtIDE7CgoJCQl9CgoJCQlzd2l0Y2ggKCBtb3VzZUFjdGlvbiApIHsKCgkJCQljYXNlIE1PVVNFLkRPTExZOgoKCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVpvb20gPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVNb3VzZURvd25Eb2xseSggZXZlbnQgKTsKCgkJCQkJc3RhdGUgPSBTVEFURS5ET0xMWTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBNT1VTRS5ST1RBVEU6CgoJCQkJCWlmICggZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5IHx8IGV2ZW50LnNoaWZ0S2V5ICkgewoKCQkJCQkJaWYgKCBzY29wZS5lbmFibGVQYW4gPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQkJaGFuZGxlTW91c2VEb3duUGFuKCBldmVudCApOwoKCQkJCQkJc3RhdGUgPSBTVEFURS5QQU47CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVJvdGF0ZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJCQloYW5kbGVNb3VzZURvd25Sb3RhdGUoIGV2ZW50ICk7CgoJCQkJCQlzdGF0ZSA9IFNUQVRFLlJPVEFURTsKCgkJCQkJfQoKCQkJCQlicmVhazsKCgkJCQljYXNlIE1PVVNFLlBBTjoKCgkJCQkJaWYgKCBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuc2hpZnRLZXkgKSB7CgoJCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVJvdGF0ZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJCQloYW5kbGVNb3VzZURvd25Sb3RhdGUoIGV2ZW50ICk7CgoJCQkJCQlzdGF0ZSA9IFNUQVRFLlJPVEFURTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggc2NvcGUuZW5hYmxlUGFuID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkJCWhhbmRsZU1vdXNlRG93blBhbiggZXZlbnQgKTsKCgkJCQkJCXN0YXRlID0gU1RBVEUuUEFOOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgoJCQkJCXN0YXRlID0gU1RBVEUuTk9ORTsKCgkJCX0KCgkJCWlmICggc3RhdGUgIT09IFNUQVRFLk5PTkUgKSB7CgoJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggX3N0YXJ0RXZlbnQgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBvbk1vdXNlTW92ZSggZXZlbnQgKSB7CgoJCQlzd2l0Y2ggKCBzdGF0ZSApIHsKCgkJCQljYXNlIFNUQVRFLlJPVEFURToKCgkJCQkJaWYgKCBzY29wZS5lbmFibGVSb3RhdGUgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVNb3VzZU1vdmVSb3RhdGUoIGV2ZW50ICk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgU1RBVEUuRE9MTFk6CgoJCQkJCWlmICggc2NvcGUuZW5hYmxlWm9vbSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJCWhhbmRsZU1vdXNlTW92ZURvbGx5KCBldmVudCApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlIFNUQVRFLlBBTjoKCgkJCQkJaWYgKCBzY29wZS5lbmFibGVQYW4gPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVNb3VzZU1vdmVQYW4oIGV2ZW50ICk7CgoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIG9uTW91c2VXaGVlbCggZXZlbnQgKSB7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZWQgPT09IGZhbHNlIHx8IHNjb3BlLmVuYWJsZVpvb20gPT09IGZhbHNlIHx8IHN0YXRlICE9PSBTVEFURS5OT05FICkgcmV0dXJuOwoKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCXNjb3BlLmRpc3BhdGNoRXZlbnQoIF9zdGFydEV2ZW50ICk7CgoJCQloYW5kbGVNb3VzZVdoZWVsKCBldmVudCApOwoKCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggX2VuZEV2ZW50ICk7CgoJCX0KCgkJZnVuY3Rpb24gb25LZXlEb3duKCBldmVudCApIHsKCgkJCWlmICggc2NvcGUuZW5hYmxlZCA9PT0gZmFsc2UgfHwgc2NvcGUuZW5hYmxlUGFuID09PSBmYWxzZSApIHJldHVybjsKCgkJCWhhbmRsZUtleURvd24oIGV2ZW50ICk7CgoJCX0KCgkJZnVuY3Rpb24gb25Ub3VjaFN0YXJ0KCBldmVudCApIHsKCgkJCXRyYWNrUG9pbnRlciggZXZlbnQgKTsKCgkJCXN3aXRjaCAoIHBvaW50ZXJzLmxlbmd0aCApIHsKCgkJCQljYXNlIDE6CgoJCQkJCXN3aXRjaCAoIHNjb3BlLnRvdWNoZXMuT05FICkgewoKCQkJCQkJY2FzZSBUT1VDSC5ST1RBVEU6CgoJCQkJCQkJaWYgKCBzY29wZS5lbmFibGVSb3RhdGUgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQkJCWhhbmRsZVRvdWNoU3RhcnRSb3RhdGUoIGV2ZW50ICk7CgoJCQkJCQkJc3RhdGUgPSBTVEFURS5UT1VDSF9ST1RBVEU7CgoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIFRPVUNILlBBTjoKCgkJCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVBhbiA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJCQkJaGFuZGxlVG91Y2hTdGFydFBhbiggZXZlbnQgKTsKCgkJCQkJCQlzdGF0ZSA9IFNUQVRFLlRPVUNIX1BBTjsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWRlZmF1bHQ6CgoJCQkJCQkJc3RhdGUgPSBTVEFURS5OT05FOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgMjoKCgkJCQkJc3dpdGNoICggc2NvcGUudG91Y2hlcy5UV08gKSB7CgoJCQkJCQljYXNlIFRPVUNILkRPTExZX1BBTjoKCgkJCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVpvb20gPT09IGZhbHNlICYmIHNjb3BlLmVuYWJsZVBhbiA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJCQkJaGFuZGxlVG91Y2hTdGFydERvbGx5UGFuKCBldmVudCApOwoKCQkJCQkJCXN0YXRlID0gU1RBVEUuVE9VQ0hfRE9MTFlfUEFOOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBUT1VDSC5ET0xMWV9ST1RBVEU6CgoJCQkJCQkJaWYgKCBzY29wZS5lbmFibGVab29tID09PSBmYWxzZSAmJiBzY29wZS5lbmFibGVSb3RhdGUgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQkJCWhhbmRsZVRvdWNoU3RhcnREb2xseVJvdGF0ZSggZXZlbnQgKTsKCgkJCQkJCQlzdGF0ZSA9IFNUQVRFLlRPVUNIX0RPTExZX1JPVEFURTsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWRlZmF1bHQ6CgoJCQkJCQkJc3RhdGUgPSBTVEFURS5OT05FOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgoJCQkJCXN0YXRlID0gU1RBVEUuTk9ORTsKCgkJCX0KCgkJCWlmICggc3RhdGUgIT09IFNUQVRFLk5PTkUgKSB7CgoJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggX3N0YXJ0RXZlbnQgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBvblRvdWNoTW92ZSggZXZlbnQgKSB7CgoJCQl0cmFja1BvaW50ZXIoIGV2ZW50ICk7CgoJCQlzd2l0Y2ggKCBzdGF0ZSApIHsKCgkJCQljYXNlIFNUQVRFLlRPVUNIX1JPVEFURToKCgkJCQkJaWYgKCBzY29wZS5lbmFibGVSb3RhdGUgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVUb3VjaE1vdmVSb3RhdGUoIGV2ZW50ICk7CgoJCQkJCXNjb3BlLnVwZGF0ZSgpOwoKCQkJCQlicmVhazsKCgkJCQljYXNlIFNUQVRFLlRPVUNIX1BBTjoKCgkJCQkJaWYgKCBzY29wZS5lbmFibGVQYW4gPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVUb3VjaE1vdmVQYW4oIGV2ZW50ICk7CgoJCQkJCXNjb3BlLnVwZGF0ZSgpOwoKCQkJCQlicmVhazsKCgkJCQljYXNlIFNUQVRFLlRPVUNIX0RPTExZX1BBTjoKCgkJCQkJaWYgKCBzY29wZS5lbmFibGVab29tID09PSBmYWxzZSAmJiBzY29wZS5lbmFibGVQYW4gPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVUb3VjaE1vdmVEb2xseVBhbiggZXZlbnQgKTsKCgkJCQkJc2NvcGUudXBkYXRlKCk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgU1RBVEUuVE9VQ0hfRE9MTFlfUk9UQVRFOgoKCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVpvb20gPT09IGZhbHNlICYmIHNjb3BlLmVuYWJsZVJvdGF0ZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJCWhhbmRsZVRvdWNoTW92ZURvbGx5Um90YXRlKCBldmVudCApOwoKCQkJCQlzY29wZS51cGRhdGUoKTsKCgkJCQkJYnJlYWs7CgoJCQkJZGVmYXVsdDoKCgkJCQkJc3RhdGUgPSBTVEFURS5OT05FOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIG9uQ29udGV4dE1lbnUoIGV2ZW50ICkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCX0KCgkJZnVuY3Rpb24gYWRkUG9pbnRlciggZXZlbnQgKSB7CgoJCQlwb2ludGVycy5wdXNoKCBldmVudC5wb2ludGVySWQgKTsKCgkJfQoKCQlmdW5jdGlvbiByZW1vdmVQb2ludGVyKCBldmVudCApIHsKCgkJCWRlbGV0ZSBwb2ludGVyUG9zaXRpb25zWyBldmVudC5wb2ludGVySWQgXTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHBvaW50ZXJzLmxlbmd0aDsgaSArKyApIHsKCgkJCQlpZiAoIHBvaW50ZXJzWyBpIF0gPT0gZXZlbnQucG9pbnRlcklkICkgewoKCQkJCQlwb2ludGVycy5zcGxpY2UoIGksIDEgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRyYWNrUG9pbnRlciggZXZlbnQgKSB7CgoJCQlsZXQgcG9zaXRpb24gPSBwb2ludGVyUG9zaXRpb25zWyBldmVudC5wb2ludGVySWQgXTsKCgkJCWlmICggcG9zaXRpb24gPT09IHVuZGVmaW5lZCApIHsKCgkJCQlwb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7CgkJCQlwb2ludGVyUG9zaXRpb25zWyBldmVudC5wb2ludGVySWQgXSA9IHBvc2l0aW9uOwoKCQkJfQoKCQkJcG9zaXRpb24uc2V0KCBldmVudC5wYWdlWCwgZXZlbnQucGFnZVkgKTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRTZWNvbmRQb2ludGVyUG9zaXRpb24oIGV2ZW50ICkgewoKCQkJY29uc3QgcG9pbnRlcklkID0gKCBldmVudC5wb2ludGVySWQgPT09IHBvaW50ZXJzWyAwIF0gKSA/IHBvaW50ZXJzWyAxIF0gOiBwb2ludGVyc1sgMCBdOwoKCQkJcmV0dXJuIHBvaW50ZXJQb3NpdGlvbnNbIHBvaW50ZXJJZCBdOwoKCQl9CgoJCS8vCgoJCXNjb3BlLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ2NvbnRleHRtZW51Jywgb25Db250ZXh0TWVudSApOwoKCQlzY29wZS5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdwb2ludGVyZG93bicsIG9uUG9pbnRlckRvd24gKTsKCQlzY29wZS5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdwb2ludGVyY2FuY2VsJywgb25Qb2ludGVyVXAgKTsKCQlzY29wZS5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICd3aGVlbCcsIG9uTW91c2VXaGVlbCwgeyBwYXNzaXZlOiBmYWxzZSB9ICk7CgoJCS8vIGZvcmNlIGFuIHVwZGF0ZSBhdCBzdGFydAoKCQl0aGlzLnVwZGF0ZSgpOwoKCX0KCn0KCmV4cG9ydCB7IE9yYml0Q29udHJvbHMgfTsK", "./assets/js/lines/LineSegmentsGeometry.js": "data:text/javascript;base64,aW1wb3J0IHsKCUJveDMsCglGbG9hdDMyQnVmZmVyQXR0cmlidXRlLAoJSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnksCglJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciwKCUludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlLAoJU3BoZXJlLAoJVmVjdG9yMywKCVdpcmVmcmFtZUdlb21ldHJ5Cn0gZnJvbSAndGhyZWUnOwoKY29uc3QgX2JveCA9IG5ldyBCb3gzKCk7CmNvbnN0IF92ZWN0b3IgPSBuZXcgVmVjdG9yMygpOwoKY2xhc3MgTGluZVNlZ21lbnRzR2VvbWV0cnkgZXh0ZW5kcyBJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdMaW5lU2VnbWVudHNHZW9tZXRyeSc7CgoJCWNvbnN0IHBvc2l0aW9ucyA9IFsgLSAxLCAyLCAwLCAxLCAyLCAwLCAtIDEsIDEsIDAsIDEsIDEsIDAsIC0gMSwgMCwgMCwgMSwgMCwgMCwgLSAxLCAtIDEsIDAsIDEsIC0gMSwgMCBdOwoJCWNvbnN0IHV2cyA9IFsgLSAxLCAyLCAxLCAyLCAtIDEsIDEsIDEsIDEsIC0gMSwgLSAxLCAxLCAtIDEsIC0gMSwgLSAyLCAxLCAtIDIgXTsKCQljb25zdCBpbmRleCA9IFsgMCwgMiwgMSwgMiwgMywgMSwgMiwgNCwgMywgNCwgNSwgMywgNCwgNiwgNSwgNiwgNywgNSBdOwoKCQl0aGlzLnNldEluZGV4KCBpbmRleCApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25zLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJfQoKCWFwcGx5TWF0cml4NCggbWF0cml4ICkgewoKCQljb25zdCBzdGFydCA9IHRoaXMuYXR0cmlidXRlcy5pbnN0YW5jZVN0YXJ0OwoJCWNvbnN0IGVuZCA9IHRoaXMuYXR0cmlidXRlcy5pbnN0YW5jZUVuZDsKCgkJaWYgKCBzdGFydCAhPT0gdW5kZWZpbmVkICkgewoKCQkJc3RhcnQuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsKCgkJCWVuZC5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKCQkJc3RhcnQubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9CgoJCWlmICggdGhpcy5ib3VuZGluZ0JveCAhPT0gbnVsbCApIHsKCgkJCXRoaXMuY29tcHV0ZUJvdW5kaW5nQm94KCk7CgoJCX0KCgkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlICE9PSBudWxsICkgewoKCQkJdGhpcy5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0UG9zaXRpb25zKCBhcnJheSApIHsKCgkJbGV0IGxpbmVTZWdtZW50czsKCgkJaWYgKCBhcnJheSBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSApIHsKCgkJCWxpbmVTZWdtZW50cyA9IGFycmF5OwoKCQl9IGVsc2UgaWYgKCBBcnJheS5pc0FycmF5KCBhcnJheSApICkgewoKCQkJbGluZVNlZ21lbnRzID0gbmV3IEZsb2F0MzJBcnJheSggYXJyYXkgKTsKCgkJfQoKCQljb25zdCBpbnN0YW5jZUJ1ZmZlciA9IG5ldyBJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciggbGluZVNlZ21lbnRzLCA2LCAxICk7IC8vIHh5eiwgeHl6CgoJCXRoaXMuc2V0QXR0cmlidXRlKCAnaW5zdGFuY2VTdGFydCcsIG5ldyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaW5zdGFuY2VCdWZmZXIsIDMsIDAgKSApOyAvLyB4eXoKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ2luc3RhbmNlRW5kJywgbmV3IEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKCBpbnN0YW5jZUJ1ZmZlciwgMywgMyApICk7IC8vIHh5egoKCQkvLwoKCQl0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpOwoJCXRoaXMuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRDb2xvcnMoIGFycmF5ICkgewoKCQlsZXQgY29sb3JzOwoKCQlpZiAoIGFycmF5IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5ICkgewoKCQkJY29sb3JzID0gYXJyYXk7CgoJCX0gZWxzZSBpZiAoIEFycmF5LmlzQXJyYXkoIGFycmF5ICkgKSB7CgoJCQljb2xvcnMgPSBuZXcgRmxvYXQzMkFycmF5KCBhcnJheSApOwoKCQl9CgoJCWNvbnN0IGluc3RhbmNlQ29sb3JCdWZmZXIgPSBuZXcgSW5zdGFuY2VkSW50ZXJsZWF2ZWRCdWZmZXIoIGNvbG9ycywgNiwgMSApOyAvLyByZ2IsIHJnYgoKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ2luc3RhbmNlQ29sb3JTdGFydCcsIG5ldyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaW5zdGFuY2VDb2xvckJ1ZmZlciwgMywgMCApICk7IC8vIHJnYgoJCXRoaXMuc2V0QXR0cmlidXRlKCAnaW5zdGFuY2VDb2xvckVuZCcsIG5ldyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaW5zdGFuY2VDb2xvckJ1ZmZlciwgMywgMyApICk7IC8vIHJnYgoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZnJvbVdpcmVmcmFtZUdlb21ldHJ5KCBnZW9tZXRyeSApIHsKCgkJdGhpcy5zZXRQb3NpdGlvbnMoIGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24uYXJyYXkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWZyb21FZGdlc0dlb21ldHJ5KCBnZW9tZXRyeSApIHsKCgkJdGhpcy5zZXRQb3NpdGlvbnMoIGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24uYXJyYXkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWZyb21NZXNoKCBtZXNoICkgewoKCQl0aGlzLmZyb21XaXJlZnJhbWVHZW9tZXRyeSggbmV3IFdpcmVmcmFtZUdlb21ldHJ5KCBtZXNoLmdlb21ldHJ5ICkgKTsKCgkJLy8gc2V0IGNvbG9ycywgbWF5YmUKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJvbUxpbmVTZWdtZW50cyggbGluZVNlZ21lbnRzICkgewoKCQljb25zdCBnZW9tZXRyeSA9IGxpbmVTZWdtZW50cy5nZW9tZXRyeTsKCgkJaWYgKCBnZW9tZXRyeS5pc0dlb21ldHJ5ICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkxpbmVTZWdtZW50c0dlb21ldHJ5IG5vIGxvbmdlciBzdXBwb3J0cyBHZW9tZXRyeS4gVXNlIFRIUkVFLkJ1ZmZlckdlb21ldHJ5IGluc3RlYWQuJyApOwoJCQlyZXR1cm47CgoJCX0gZWxzZSBpZiAoIGdlb21ldHJ5LmlzQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQl0aGlzLnNldFBvc2l0aW9ucyggZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5hcnJheSApOyAvLyBhc3N1bWVzIG5vbi1pbmRleGVkCgoJCX0KCgkJLy8gc2V0IGNvbG9ycywgbWF5YmUKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvbXB1dGVCb3VuZGluZ0JveCgpIHsKCgkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ID09PSBudWxsICkgewoKCQkJdGhpcy5ib3VuZGluZ0JveCA9IG5ldyBCb3gzKCk7CgoJCX0KCgkJY29uc3Qgc3RhcnQgPSB0aGlzLmF0dHJpYnV0ZXMuaW5zdGFuY2VTdGFydDsKCQljb25zdCBlbmQgPSB0aGlzLmF0dHJpYnV0ZXMuaW5zdGFuY2VFbmQ7CgoJCWlmICggc3RhcnQgIT09IHVuZGVmaW5lZCAmJiBlbmQgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMuYm91bmRpbmdCb3guc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggc3RhcnQgKTsKCgkJCV9ib3guc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggZW5kICk7CgoJCQl0aGlzLmJvdW5kaW5nQm94LnVuaW9uKCBfYm94ICk7CgoJCX0KCgl9CgoJY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCkgewoKCQlpZiAoIHRoaXMuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSB7CgoJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gbmV3IFNwaGVyZSgpOwoKCQl9CgoJCWlmICggdGhpcy5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCgkJCXRoaXMuY29tcHV0ZUJvdW5kaW5nQm94KCk7CgoJCX0KCgkJY29uc3Qgc3RhcnQgPSB0aGlzLmF0dHJpYnV0ZXMuaW5zdGFuY2VTdGFydDsKCQljb25zdCBlbmQgPSB0aGlzLmF0dHJpYnV0ZXMuaW5zdGFuY2VFbmQ7CgoJCWlmICggc3RhcnQgIT09IHVuZGVmaW5lZCAmJiBlbmQgIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IGNlbnRlciA9IHRoaXMuYm91bmRpbmdTcGhlcmUuY2VudGVyOwoKCQkJdGhpcy5ib3VuZGluZ0JveC5nZXRDZW50ZXIoIGNlbnRlciApOwoKCQkJbGV0IG1heFJhZGl1c1NxID0gMDsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBzdGFydC5jb3VudDsgaSA8IGlsOyBpICsrICkgewoKCQkJCV92ZWN0b3IuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggc3RhcnQsIGkgKTsKCQkJCW1heFJhZGl1c1NxID0gTWF0aC5tYXgoIG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIF92ZWN0b3IgKSApOwoKCQkJCV92ZWN0b3IuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggZW5kLCBpICk7CgkJCQltYXhSYWRpdXNTcSA9IE1hdGgubWF4KCBtYXhSYWRpdXNTcSwgY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKCBfdmVjdG9yICkgKTsKCgkJCX0KCgkJCXRoaXMuYm91bmRpbmdTcGhlcmUucmFkaXVzID0gTWF0aC5zcXJ0KCBtYXhSYWRpdXNTcSApOwoKCQkJaWYgKCBpc05hTiggdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgKSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuTGluZVNlZ21lbnRzR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk6IENvbXB1dGVkIHJhZGl1cyBpcyBOYU4uIFRoZSBpbnN0YW5jZWQgcG9zaXRpb24gZGF0YSBpcyBsaWtlbHkgdG8gaGF2ZSBOYU4gdmFsdWVzLicsIHRoaXMgKTsKCgkJCX0KCgkJfQoKCX0KCgl0b0pTT04oKSB7CgoJCS8vIHRvZG8KCgl9CgoJYXBwbHlNYXRyaXgoIG1hdHJpeCApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuTGluZVNlZ21lbnRzR2VvbWV0cnk6IGFwcGx5TWF0cml4KCkgaGFzIGJlZW4gcmVuYW1lZCB0byBhcHBseU1hdHJpeDQoKS4nICk7CgoJCXJldHVybiB0aGlzLmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgoJfQoKfQoKTGluZVNlZ21lbnRzR2VvbWV0cnkucHJvdG90eXBlLmlzTGluZVNlZ21lbnRzR2VvbWV0cnkgPSB0cnVlOwoKZXhwb3J0IHsgTGluZVNlZ21lbnRzR2VvbWV0cnkgfTsK", "./assets/js/lines/LineGeometry.js": "data:text/javascript;base64,aW1wb3J0IHsgTGluZVNlZ21lbnRzR2VvbWV0cnkgfSBmcm9tICcuLi9saW5lcy9MaW5lU2VnbWVudHNHZW9tZXRyeS5qcyc7CgpjbGFzcyBMaW5lR2VvbWV0cnkgZXh0ZW5kcyBMaW5lU2VnbWVudHNHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCk7CgkJdGhpcy50eXBlID0gJ0xpbmVHZW9tZXRyeSc7CgoJfQoKCXNldFBvc2l0aW9ucyggYXJyYXkgKSB7CgoJCS8vIGNvbnZlcnRzIFsgeDEsIHkxLCB6MSwgIHgyLCB5MiwgejIsIC4uLiBdIHRvIHBhaXJzIGZvcm1hdAoKCQl2YXIgbGVuZ3RoID0gYXJyYXkubGVuZ3RoIC0gMzsKCQl2YXIgcG9pbnRzID0gbmV3IEZsb2F0MzJBcnJheSggMiAqIGxlbmd0aCApOwoKCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMyApIHsKCgkJCXBvaW50c1sgMiAqIGkgXSA9IGFycmF5WyBpIF07CgkJCXBvaW50c1sgMiAqIGkgKyAxIF0gPSBhcnJheVsgaSArIDEgXTsKCQkJcG9pbnRzWyAyICogaSArIDIgXSA9IGFycmF5WyBpICsgMiBdOwoKCQkJcG9pbnRzWyAyICogaSArIDMgXSA9IGFycmF5WyBpICsgMyBdOwoJCQlwb2ludHNbIDIgKiBpICsgNCBdID0gYXJyYXlbIGkgKyA0IF07CgkJCXBvaW50c1sgMiAqIGkgKyA1IF0gPSBhcnJheVsgaSArIDUgXTsKCgkJfQoKCQlzdXBlci5zZXRQb3NpdGlvbnMoIHBvaW50cyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0Q29sb3JzKCBhcnJheSApIHsKCgkJLy8gY29udmVydHMgWyByMSwgZzEsIGIxLCAgcjIsIGcyLCBiMiwgLi4uIF0gdG8gcGFpcnMgZm9ybWF0CgoJCXZhciBsZW5ndGggPSBhcnJheS5sZW5ndGggLSAzOwoJCXZhciBjb2xvcnMgPSBuZXcgRmxvYXQzMkFycmF5KCAyICogbGVuZ3RoICk7CgoJCWZvciAoIHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAzICkgewoKCQkJY29sb3JzWyAyICogaSBdID0gYXJyYXlbIGkgXTsKCQkJY29sb3JzWyAyICogaSArIDEgXSA9IGFycmF5WyBpICsgMSBdOwoJCQljb2xvcnNbIDIgKiBpICsgMiBdID0gYXJyYXlbIGkgKyAyIF07CgoJCQljb2xvcnNbIDIgKiBpICsgMyBdID0gYXJyYXlbIGkgKyAzIF07CgkJCWNvbG9yc1sgMiAqIGkgKyA0IF0gPSBhcnJheVsgaSArIDQgXTsKCQkJY29sb3JzWyAyICogaSArIDUgXSA9IGFycmF5WyBpICsgNSBdOwoKCQl9CgoJCXN1cGVyLnNldENvbG9ycyggY29sb3JzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglmcm9tTGluZSggbGluZSApIHsKCgkJdmFyIGdlb21ldHJ5ID0gbGluZS5nZW9tZXRyeTsKCgkJaWYgKCBnZW9tZXRyeS5pc0dlb21ldHJ5ICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkxpbmVHZW9tZXRyeSBubyBsb25nZXIgc3VwcG9ydHMgR2VvbWV0cnkuIFVzZSBUSFJFRS5CdWZmZXJHZW9tZXRyeSBpbnN0ZWFkLicgKTsKCQkJcmV0dXJuOwoKCQl9IGVsc2UgaWYgKCBnZW9tZXRyeS5pc0J1ZmZlckdlb21ldHJ5ICkgewoKCQkJdGhpcy5zZXRQb3NpdGlvbnMoIGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24uYXJyYXkgKTsgLy8gYXNzdW1lcyBub24taW5kZXhlZAoKCQl9CgoJCS8vIHNldCBjb2xvcnMsIG1heWJlCgoJCXJldHVybiB0aGlzOwoKCX0KCgljb3B5KCAvKiBzb3VyY2UgKi8gKSB7CgoJCS8vIHRvZG8KCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKTGluZUdlb21ldHJ5LnByb3RvdHlwZS5pc0xpbmVHZW9tZXRyeSA9IHRydWU7CgpleHBvcnQgeyBMaW5lR2VvbWV0cnkgfTsK", "./assets/js/lines/LineMaterial.js": "data:text/javascript;base64,aW1wb3J0IHsKCVNoYWRlckxpYiwKCVNoYWRlck1hdGVyaWFsLAoJVW5pZm9ybXNMaWIsCglVbmlmb3Jtc1V0aWxzLAoJVmVjdG9yMgp9IGZyb20gJ3RocmVlJzsKCi8qKgogKiBwYXJhbWV0ZXJzID0gewogKiAgY29sb3I6IDxoZXg+LAogKiAgbGluZXdpZHRoOiA8ZmxvYXQ+LAogKiAgZGFzaGVkOiA8Ym9vbGVhbj4sCiAqICBkYXNoU2NhbGU6IDxmbG9hdD4sCiAqICBkYXNoU2l6ZTogPGZsb2F0PiwKICogIGRhc2hPZmZzZXQ6IDxmbG9hdD4sCiAqICBnYXBTaXplOiA8ZmxvYXQ+LAogKiAgcmVzb2x1dGlvbjogPFZlY3RvcjI+LCAvLyB0byBiZSBzZXQgYnkgcmVuZGVyZXIKICogfQogKi8KClVuaWZvcm1zTGliLmxpbmUgPSB7CgoJbGluZXdpZHRoOiB7IHZhbHVlOiAxIH0sCglyZXNvbHV0aW9uOiB7IHZhbHVlOiBuZXcgVmVjdG9yMiggMSwgMSApIH0sCglkYXNoU2NhbGU6IHsgdmFsdWU6IDEgfSwKCWRhc2hTaXplOiB7IHZhbHVlOiAxIH0sCglkYXNoT2Zmc2V0OiB7IHZhbHVlOiAwIH0sCglnYXBTaXplOiB7IHZhbHVlOiAxIH0sIC8vIHRvZG8gRklYIC0gbWF5YmUgY2hhbmdlIHRvIHRvdGFsU2l6ZQoJb3BhY2l0eTogeyB2YWx1ZTogMSB9Cgp9OwoKU2hhZGVyTGliWyAnbGluZScgXSA9IHsKCgl1bmlmb3JtczogVW5pZm9ybXNVdGlscy5tZXJnZSggWwoJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQlVbmlmb3Jtc0xpYi5mb2csCgkJVW5pZm9ybXNMaWIubGluZQoJXSApLAoKCXZlcnRleFNoYWRlcjoKCQlgCgkJI2luY2x1ZGUgPGNvbW1vbj4KCQkjaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+CgkJI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD4KCQkjaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+CgkJI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD4KCgkJdW5pZm9ybSBmbG9hdCBsaW5ld2lkdGg7CgkJdW5pZm9ybSB2ZWMyIHJlc29sdXRpb247CgoJCWF0dHJpYnV0ZSB2ZWMzIGluc3RhbmNlU3RhcnQ7CgkJYXR0cmlidXRlIHZlYzMgaW5zdGFuY2VFbmQ7CgoJCWF0dHJpYnV0ZSB2ZWMzIGluc3RhbmNlQ29sb3JTdGFydDsKCQlhdHRyaWJ1dGUgdmVjMyBpbnN0YW5jZUNvbG9yRW5kOwoKCQl2YXJ5aW5nIHZlYzIgdlV2OwoKCQkjaWZkZWYgVVNFX0RBU0gKCgkJCXVuaWZvcm0gZmxvYXQgZGFzaFNjYWxlOwoJCQlhdHRyaWJ1dGUgZmxvYXQgaW5zdGFuY2VEaXN0YW5jZVN0YXJ0OwoJCQlhdHRyaWJ1dGUgZmxvYXQgaW5zdGFuY2VEaXN0YW5jZUVuZDsKCQkJdmFyeWluZyBmbG9hdCB2TGluZURpc3RhbmNlOwoKCQkjZW5kaWYKCgkJdm9pZCB0cmltU2VnbWVudCggY29uc3QgaW4gdmVjNCBzdGFydCwgaW5vdXQgdmVjNCBlbmQgKSB7CgoJCQkvLyB0cmltIGVuZCBzZWdtZW50IHNvIGl0IHRlcm1pbmF0ZXMgYmV0d2VlbiB0aGUgY2FtZXJhIHBsYW5lIGFuZCB0aGUgbmVhciBwbGFuZQoKCQkJLy8gY29uc2VydmF0aXZlIGVzdGltYXRlIG9mIHRoZSBuZWFyIHBsYW5lCgkJCWZsb2F0IGEgPSBwcm9qZWN0aW9uTWF0cml4WyAyIF1bIDIgXTsgLy8gM25kIGVudHJ5IGluIDN0aCBjb2x1bW4KCQkJZmxvYXQgYiA9IHByb2plY3Rpb25NYXRyaXhbIDMgXVsgMiBdOyAvLyAzbmQgZW50cnkgaW4gNHRoIGNvbHVtbgoJCQlmbG9hdCBuZWFyRXN0aW1hdGUgPSAtIDAuNSAqIGIgLyBhOwoKCQkJZmxvYXQgYWxwaGEgPSAoIG5lYXJFc3RpbWF0ZSAtIHN0YXJ0LnogKSAvICggZW5kLnogLSBzdGFydC56ICk7CgoJCQllbmQueHl6ID0gbWl4KCBzdGFydC54eXosIGVuZC54eXosIGFscGhhICk7CgoJCX0KCgkJdm9pZCBtYWluKCkgewoKCQkJI2lmZGVmIFVTRV9DT0xPUgoKCQkJCXZDb2xvci54eXogPSAoIHBvc2l0aW9uLnkgPCAwLjUgKSA/IGluc3RhbmNlQ29sb3JTdGFydCA6IGluc3RhbmNlQ29sb3JFbmQ7CgoJCQkjZW5kaWYKCgkJCSNpZmRlZiBVU0VfREFTSAoKCQkJCXZMaW5lRGlzdGFuY2UgPSAoIHBvc2l0aW9uLnkgPCAwLjUgKSA/IGRhc2hTY2FsZSAqIGluc3RhbmNlRGlzdGFuY2VTdGFydCA6IGRhc2hTY2FsZSAqIGluc3RhbmNlRGlzdGFuY2VFbmQ7CgoJCQkjZW5kaWYKCgkJCWZsb2F0IGFzcGVjdCA9IHJlc29sdXRpb24ueCAvIHJlc29sdXRpb24ueTsKCgkJCXZVdiA9IHV2OwoKCQkJLy8gY2FtZXJhIHNwYWNlCgkJCXZlYzQgc3RhcnQgPSBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCBpbnN0YW5jZVN0YXJ0LCAxLjAgKTsKCQkJdmVjNCBlbmQgPSBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCBpbnN0YW5jZUVuZCwgMS4wICk7CgoJCQkvLyBzcGVjaWFsIGNhc2UgZm9yIHBlcnNwZWN0aXZlIHByb2plY3Rpb24sIGFuZCBzZWdtZW50cyB0aGF0IHRlcm1pbmF0ZSBlaXRoZXIgaW4sIG9yIGJlaGluZCwgdGhlIGNhbWVyYSBwbGFuZQoJCQkvLyBjbGVhcmx5IHRoZSBncHUgZmlybXdhcmUgaGFzIGEgd2F5IG9mIGFkZHJlc3NpbmcgdGhpcyBpc3N1ZSB3aGVuIHByb2plY3RpbmcgaW50byBuZGMgc3BhY2UKCQkJLy8gYnV0IHdlIG5lZWQgdG8gcGVyZm9ybSBuZGMtc3BhY2UgY2FsY3VsYXRpb25zIGluIHRoZSBzaGFkZXIsIHNvIHdlIG11c3QgYWRkcmVzcyB0aGlzIGlzc3VlIGRpcmVjdGx5CgkJCS8vIHBlcmhhcHMgdGhlcmUgaXMgYSBtb3JlIGVsZWdhbnQgc29sdXRpb24gLS0gV2VzdExhbmdsZXkKCgkJCWJvb2wgcGVyc3BlY3RpdmUgPSAoIHByb2plY3Rpb25NYXRyaXhbIDIgXVsgMyBdID09IC0gMS4wICk7IC8vIDR0aCBlbnRyeSBpbiB0aGUgM3JkIGNvbHVtbgoKCQkJaWYgKCBwZXJzcGVjdGl2ZSApIHsKCgkJCQlpZiAoIHN0YXJ0LnogPCAwLjAgJiYgZW5kLnogPj0gMC4wICkgewoKCQkJCQl0cmltU2VnbWVudCggc3RhcnQsIGVuZCApOwoKCQkJCX0gZWxzZSBpZiAoIGVuZC56IDwgMC4wICYmIHN0YXJ0LnogPj0gMC4wICkgewoKCQkJCQl0cmltU2VnbWVudCggZW5kLCBzdGFydCApOwoKCQkJCX0KCgkJCX0KCgkJCS8vIGNsaXAgc3BhY2UKCQkJdmVjNCBjbGlwU3RhcnQgPSBwcm9qZWN0aW9uTWF0cml4ICogc3RhcnQ7CgkJCXZlYzQgY2xpcEVuZCA9IHByb2plY3Rpb25NYXRyaXggKiBlbmQ7CgoJCQkvLyBuZGMgc3BhY2UKCQkJdmVjMiBuZGNTdGFydCA9IGNsaXBTdGFydC54eSAvIGNsaXBTdGFydC53OwoJCQl2ZWMyIG5kY0VuZCA9IGNsaXBFbmQueHkgLyBjbGlwRW5kLnc7CgoJCQkvLyBkaXJlY3Rpb24KCQkJdmVjMiBkaXIgPSBuZGNFbmQgLSBuZGNTdGFydDsKCgkJCS8vIGFjY291bnQgZm9yIGNsaXAtc3BhY2UgYXNwZWN0IHJhdGlvCgkJCWRpci54ICo9IGFzcGVjdDsKCQkJZGlyID0gbm9ybWFsaXplKCBkaXIgKTsKCgkJCS8vIHBlcnBlbmRpY3VsYXIgdG8gZGlyCgkJCXZlYzIgb2Zmc2V0ID0gdmVjMiggZGlyLnksIC0gZGlyLnggKTsKCgkJCS8vIHVuZG8gYXNwZWN0IHJhdGlvIGFkanVzdG1lbnQKCQkJZGlyLnggLz0gYXNwZWN0OwoJCQlvZmZzZXQueCAvPSBhc3BlY3Q7CgoJCQkvLyBzaWduIGZsaXAKCQkJaWYgKCBwb3NpdGlvbi54IDwgMC4wICkgb2Zmc2V0ICo9IC0gMS4wOwoKCQkJLy8gZW5kY2FwcwoJCQlpZiAoIHBvc2l0aW9uLnkgPCAwLjAgKSB7CgoJCQkJb2Zmc2V0ICs9IC0gZGlyOwoKCQkJfSBlbHNlIGlmICggcG9zaXRpb24ueSA+IDEuMCApIHsKCgkJCQlvZmZzZXQgKz0gZGlyOwoKCQkJfQoKCQkJLy8gYWRqdXN0IGZvciBsaW5ld2lkdGgKCQkJb2Zmc2V0ICo9IGxpbmV3aWR0aDsKCgkJCS8vIGFkanVzdCBmb3IgY2xpcC1zcGFjZSB0byBzY3JlZW4tc3BhY2UgY29udmVyc2lvbiAvLyBtYXliZSByZXNvbHV0aW9uIHNob3VsZCBiZSBiYXNlZCBvbiB2aWV3cG9ydCAuLi4KCQkJb2Zmc2V0IC89IHJlc29sdXRpb24ueTsKCgkJCS8vIHNlbGVjdCBlbmQKCQkJdmVjNCBjbGlwID0gKCBwb3NpdGlvbi55IDwgMC41ICkgPyBjbGlwU3RhcnQgOiBjbGlwRW5kOwoKCQkJLy8gYmFjayB0byBjbGlwIHNwYWNlCgkJCW9mZnNldCAqPSBjbGlwLnc7CgoJCQljbGlwLnh5ICs9IG9mZnNldDsKCgkJCWdsX1Bvc2l0aW9uID0gY2xpcDsKCgkJCXZlYzQgbXZQb3NpdGlvbiA9ICggcG9zaXRpb24ueSA8IDAuNSApID8gc3RhcnQgOiBlbmQ7IC8vIHRoaXMgaXMgYW4gYXBwcm94aW1hdGlvbgoKCQkJI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD4KCQkJI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+CgkJCSNpbmNsdWRlIDxmb2dfdmVydGV4PgoKCQl9CgkJYCwKCglmcmFnbWVudFNoYWRlcjoKCQlgCgkJdW5pZm9ybSB2ZWMzIGRpZmZ1c2U7CgkJdW5pZm9ybSBmbG9hdCBvcGFjaXR5OwoKCQkjaWZkZWYgVVNFX0RBU0gKCgkJCXVuaWZvcm0gZmxvYXQgZGFzaFNpemU7CgkJCXVuaWZvcm0gZmxvYXQgZGFzaE9mZnNldDsKCQkJdW5pZm9ybSBmbG9hdCBnYXBTaXplOwoKCQkjZW5kaWYKCgkJdmFyeWluZyBmbG9hdCB2TGluZURpc3RhbmNlOwoKCQkjaW5jbHVkZSA8Y29tbW9uPgoJCSNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PgoJCSNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD4KCQkjaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD4KCQkjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+CgoJCXZhcnlpbmcgdmVjMiB2VXY7CgoJCXZvaWQgbWFpbigpIHsKCgkJCSNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+CgoJCQkjaWZkZWYgVVNFX0RBU0gKCgkJCQlpZiAoIHZVdi55IDwgLSAxLjAgfHwgdlV2LnkgPiAxLjAgKSBkaXNjYXJkOyAvLyBkaXNjYXJkIGVuZGNhcHMKCgkJCQlpZiAoIG1vZCggdkxpbmVEaXN0YW5jZSArIGRhc2hPZmZzZXQsIGRhc2hTaXplICsgZ2FwU2l6ZSApID4gZGFzaFNpemUgKSBkaXNjYXJkOyAvLyB0b2RvIC0gRklYCgoJCQkjZW5kaWYKCgkJCWZsb2F0IGFscGhhID0gb3BhY2l0eTsKCgkJCSNpZmRlZiBBTFBIQV9UT19DT1ZFUkFHRQoKCQkJLy8gYXJ0aWZhY3RzIGFwcGVhciBvbiBzb21lIGhhcmR3YXJlIGlmIGEgZGVyaXZhdGl2ZSBpcyB0YWtlbiB3aXRoaW4gYSBjb25kaXRpb25hbAoJCQlmbG9hdCBhID0gdlV2Lng7CgkJCWZsb2F0IGIgPSAoIHZVdi55ID4gMC4wICkgPyB2VXYueSAtIDEuMCA6IHZVdi55ICsgMS4wOwoJCQlmbG9hdCBsZW4yID0gYSAqIGEgKyBiICogYjsKCQkJZmxvYXQgZGxlbiA9IGZ3aWR0aCggbGVuMiApOwoKCQkJaWYgKCBhYnMoIHZVdi55ICkgPiAxLjAgKSB7CgoJCQkJYWxwaGEgPSAxLjAgLSBzbW9vdGhzdGVwKCAxLjAgLSBkbGVuLCAxLjAgKyBkbGVuLCBsZW4yICk7CgoJCQl9CgoJCQkjZWxzZQoKCQkJaWYgKCBhYnMoIHZVdi55ICkgPiAxLjAgKSB7CgoJCQkJZmxvYXQgYSA9IHZVdi54OwoJCQkJZmxvYXQgYiA9ICggdlV2LnkgPiAwLjAgKSA/IHZVdi55IC0gMS4wIDogdlV2LnkgKyAxLjA7CgkJCQlmbG9hdCBsZW4yID0gYSAqIGEgKyBiICogYjsKCgkJCQlpZiAoIGxlbjIgPiAxLjAgKSBkaXNjYXJkOwoKCQkJfQoKCQkJI2VuZGlmCgoJCQl2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIGFscGhhICk7CgoJCQkjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+CgkJCSNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD4KCgkJCWdsX0ZyYWdDb2xvciA9IHZlYzQoIGRpZmZ1c2VDb2xvci5yZ2IsIGFscGhhICk7CgoJCQkjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+CgkJCSNpbmNsdWRlIDxlbmNvZGluZ3NfZnJhZ21lbnQ+CgkJCSNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+CgkJCSNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PgoKCQl9CgkJYAp9OwoKY2xhc3MgTGluZU1hdGVyaWFsIGV4dGVuZHMgU2hhZGVyTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlciggewoKCQkJdHlwZTogJ0xpbmVNYXRlcmlhbCcsCgoJCQl1bmlmb3JtczogVW5pZm9ybXNVdGlscy5jbG9uZSggU2hhZGVyTGliWyAnbGluZScgXS51bmlmb3JtcyApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJMaWJbICdsaW5lJyBdLnZlcnRleFNoYWRlciwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckxpYlsgJ2xpbmUnIF0uZnJhZ21lbnRTaGFkZXIsCgoJCQljbGlwcGluZzogdHJ1ZSAvLyByZXF1aXJlZCBmb3IgY2xpcHBpbmcgc3VwcG9ydAoKCQl9ICk7CgoJCXRoaXMuZGFzaGVkID0gZmFsc2U7CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCB0aGlzLCB7CgoJCQljb2xvcjogewoKCQkJCWVudW1lcmFibGU6IHRydWUsCgoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCXJldHVybiB0aGlzLnVuaWZvcm1zLmRpZmZ1c2UudmFsdWU7CgoJCQkJfSwKCgkJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJCXRoaXMudW5pZm9ybXMuZGlmZnVzZS52YWx1ZSA9IHZhbHVlOwoKCQkJCX0KCgkJCX0sCgoJCQlsaW5ld2lkdGg6IHsKCgkJCQllbnVtZXJhYmxlOiB0cnVlLAoKCQkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy5saW5ld2lkdGgudmFsdWU7CgoJCQkJfSwKCgkJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJCXRoaXMudW5pZm9ybXMubGluZXdpZHRoLnZhbHVlID0gdmFsdWU7CgoJCQkJfQoKCQkJfSwKCgkJCWRhc2hTY2FsZTogewoKCQkJCWVudW1lcmFibGU6IHRydWUsCgoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCXJldHVybiB0aGlzLnVuaWZvcm1zLmRhc2hTY2FsZS52YWx1ZTsKCgkJCQl9LAoKCQkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQkJdGhpcy51bmlmb3Jtcy5kYXNoU2NhbGUudmFsdWUgPSB2YWx1ZTsKCgkJCQl9CgoJCQl9LAoKCQkJZGFzaFNpemU6IHsKCgkJCQllbnVtZXJhYmxlOiB0cnVlLAoKCQkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy5kYXNoU2l6ZS52YWx1ZTsKCgkJCQl9LAoKCQkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQkJdGhpcy51bmlmb3Jtcy5kYXNoU2l6ZS52YWx1ZSA9IHZhbHVlOwoKCQkJCX0KCgkJCX0sCgoJCQlkYXNoT2Zmc2V0OiB7CgoJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCgkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJcmV0dXJuIHRoaXMudW5pZm9ybXMuZGFzaE9mZnNldC52YWx1ZTsKCgkJCQl9LAoKCQkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQkJdGhpcy51bmlmb3Jtcy5kYXNoT2Zmc2V0LnZhbHVlID0gdmFsdWU7CgoJCQkJfQoKCQkJfSwKCgkJCWdhcFNpemU6IHsKCgkJCQllbnVtZXJhYmxlOiB0cnVlLAoKCQkJCWdldDogZnVuY3Rpb24gKCkgewoKCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy5nYXBTaXplLnZhbHVlOwoKCQkJCX0sCgoJCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCQl0aGlzLnVuaWZvcm1zLmdhcFNpemUudmFsdWUgPSB2YWx1ZTsKCgkJCQl9CgoJCQl9LAoKCQkJb3BhY2l0eTogewoKCQkJCWVudW1lcmFibGU6IHRydWUsCgoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCXJldHVybiB0aGlzLnVuaWZvcm1zLm9wYWNpdHkudmFsdWU7CgoJCQkJfSwKCgkJCQlzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJCXRoaXMudW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IHZhbHVlOwoKCQkJCX0KCgkJCX0sCgoJCQlyZXNvbHV0aW9uOiB7CgoJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCgkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJcmV0dXJuIHRoaXMudW5pZm9ybXMucmVzb2x1dGlvbi52YWx1ZTsKCgkJCQl9LAoKCQkJCXNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQkJdGhpcy51bmlmb3Jtcy5yZXNvbHV0aW9uLnZhbHVlLmNvcHkoIHZhbHVlICk7CgoJCQkJfQoKCQkJfSwKCgkJCWFscGhhVG9Db3ZlcmFnZTogewoKCQkJCWVudW1lcmFibGU6IHRydWUsCgoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCXJldHVybiBCb29sZWFuKCAnQUxQSEFfVE9fQ09WRVJBR0UnIGluIHRoaXMuZGVmaW5lcyApOwoKCQkJCX0sCgoJCQkJc2V0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCQlpZiAoIEJvb2xlYW4oIHZhbHVlICkgIT09IEJvb2xlYW4oICdBTFBIQV9UT19DT1ZFUkFHRScgaW4gdGhpcy5kZWZpbmVzICkgKSB7CgoJCQkJCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJfQoKCQkJCQlpZiAoIHZhbHVlICkgewoKCQkJCQkJdGhpcy5kZWZpbmVzLkFMUEhBX1RPX0NPVkVSQUdFID0gJyc7CgkJCQkJCXRoaXMuZXh0ZW5zaW9ucy5kZXJpdmF0aXZlcyA9IHRydWU7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlkZWxldGUgdGhpcy5kZWZpbmVzLkFMUEhBX1RPX0NPVkVSQUdFOwoJCQkJCQl0aGlzLmV4dGVuc2lvbnMuZGVyaXZhdGl2ZXMgPSBmYWxzZTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfSApOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCn0KCkxpbmVNYXRlcmlhbC5wcm90b3R5cGUuaXNMaW5lTWF0ZXJpYWwgPSB0cnVlOwoKZXhwb3J0IHsgTGluZU1hdGVyaWFsIH07Cg==", "./assets/js/lines/Line2.js": "data:text/javascript;base64,aW1wb3J0IHsgTGluZVNlZ21lbnRzMiB9IGZyb20gJy4uL2xpbmVzL0xpbmVTZWdtZW50czIuanMnOwppbXBvcnQgeyBMaW5lR2VvbWV0cnkgfSBmcm9tICcuLi9saW5lcy9MaW5lR2VvbWV0cnkuanMnOwppbXBvcnQgeyBMaW5lTWF0ZXJpYWwgfSBmcm9tICcuLi9saW5lcy9MaW5lTWF0ZXJpYWwuanMnOwoKY2xhc3MgTGluZTIgZXh0ZW5kcyBMaW5lU2VnbWVudHMyIHsKCgljb25zdHJ1Y3RvciggZ2VvbWV0cnkgPSBuZXcgTGluZUdlb21ldHJ5KCksIG1hdGVyaWFsID0gbmV3IExpbmVNYXRlcmlhbCggeyBjb2xvcjogTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmIH0gKSApIHsKCgkJc3VwZXIoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLnR5cGUgPSAnTGluZTInOwoKCX0KCn0KCkxpbmUyLnByb3RvdHlwZS5pc0xpbmUyID0gdHJ1ZTsKCmV4cG9ydCB7IExpbmUyIH07Cg==", "./assets/js/lines/LineSegments2.js": "data:text/javascript;base64,aW1wb3J0IHsKCUJveDMsCglJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciwKCUludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlLAoJTGluZTMsCglNYXRoVXRpbHMsCglNYXRyaXg0LAoJTWVzaCwKCVNwaGVyZSwKCVZlY3RvcjMsCglWZWN0b3I0Cn0gZnJvbSAndGhyZWUnOwppbXBvcnQgeyBMaW5lU2VnbWVudHNHZW9tZXRyeSB9IGZyb20gJy4uL2xpbmVzL0xpbmVTZWdtZW50c0dlb21ldHJ5LmpzJzsKaW1wb3J0IHsgTGluZU1hdGVyaWFsIH0gZnJvbSAnLi4vbGluZXMvTGluZU1hdGVyaWFsLmpzJzsKCmNvbnN0IF9zdGFydCA9IG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9lbmQgPSBuZXcgVmVjdG9yMygpOwoKY29uc3QgX3N0YXJ0NCA9IG5ldyBWZWN0b3I0KCk7CmNvbnN0IF9lbmQ0ID0gbmV3IFZlY3RvcjQoKTsKCmNvbnN0IF9zc09yaWdpbiA9IG5ldyBWZWN0b3I0KCk7CmNvbnN0IF9zc09yaWdpbjMgPSBuZXcgVmVjdG9yMygpOwpjb25zdCBfbXZNYXRyaXggPSBuZXcgTWF0cml4NCgpOwpjb25zdCBfbGluZSA9IG5ldyBMaW5lMygpOwpjb25zdCBfY2xvc2VzdFBvaW50ID0gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9ib3ggPSBuZXcgQm94MygpOwpjb25zdCBfc3BoZXJlID0gbmV3IFNwaGVyZSgpOwpjb25zdCBfY2xpcFRvV29ybGRWZWN0b3IgPSBuZXcgVmVjdG9yNCgpOwoKY2xhc3MgTGluZVNlZ21lbnRzMiBleHRlbmRzIE1lc2ggewoKCWNvbnN0cnVjdG9yKCBnZW9tZXRyeSA9IG5ldyBMaW5lU2VnbWVudHNHZW9tZXRyeSgpLCBtYXRlcmlhbCA9IG5ldyBMaW5lTWF0ZXJpYWwoIHsgY29sb3I6IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZiB9ICkgKSB7CgoJCXN1cGVyKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCgkJdGhpcy50eXBlID0gJ0xpbmVTZWdtZW50czInOwoKCX0KCgkvLyBmb3IgYmFja3dhcmRzLWNvbXBhdGFiaWxpdHksIGJ1dCBjb3VsZCBiZSBhIG1ldGhvZCBvZiBMaW5lU2VnbWVudHNHZW9tZXRyeS4uLgoKCWNvbXB1dGVMaW5lRGlzdGFuY2VzKCkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgoJCWNvbnN0IGluc3RhbmNlU3RhcnQgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLmluc3RhbmNlU3RhcnQ7CgkJY29uc3QgaW5zdGFuY2VFbmQgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLmluc3RhbmNlRW5kOwoJCWNvbnN0IGxpbmVEaXN0YW5jZXMgPSBuZXcgRmxvYXQzMkFycmF5KCAyICogaW5zdGFuY2VTdGFydC5jb3VudCApOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGogPSAwLCBsID0gaW5zdGFuY2VTdGFydC5jb3VudDsgaSA8IGw7IGkgKyssIGogKz0gMiApIHsKCgkJCV9zdGFydC5mcm9tQnVmZmVyQXR0cmlidXRlKCBpbnN0YW5jZVN0YXJ0LCBpICk7CgkJCV9lbmQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggaW5zdGFuY2VFbmQsIGkgKTsKCgkJCWxpbmVEaXN0YW5jZXNbIGogXSA9ICggaiA9PT0gMCApID8gMCA6IGxpbmVEaXN0YW5jZXNbIGogLSAxIF07CgkJCWxpbmVEaXN0YW5jZXNbIGogKyAxIF0gPSBsaW5lRGlzdGFuY2VzWyBqIF0gKyBfc3RhcnQuZGlzdGFuY2VUbyggX2VuZCApOwoKCQl9CgoJCWNvbnN0IGluc3RhbmNlRGlzdGFuY2VCdWZmZXIgPSBuZXcgSW5zdGFuY2VkSW50ZXJsZWF2ZWRCdWZmZXIoIGxpbmVEaXN0YW5jZXMsIDIsIDEgKTsgLy8gZDAsIGQxCgoJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ2luc3RhbmNlRGlzdGFuY2VTdGFydCcsIG5ldyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaW5zdGFuY2VEaXN0YW5jZUJ1ZmZlciwgMSwgMCApICk7IC8vIGQwCgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAnaW5zdGFuY2VEaXN0YW5jZUVuZCcsIG5ldyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaW5zdGFuY2VEaXN0YW5jZUJ1ZmZlciwgMSwgMSApICk7IC8vIGQxCgoJCXJldHVybiB0aGlzOwoKCX0KCglyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgoJCWlmICggcmF5Y2FzdGVyLmNhbWVyYSA9PT0gbnVsbCApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdMaW5lU2VnbWVudHMyOiAiUmF5Y2FzdGVyLmNhbWVyYSIgbmVlZHMgdG8gYmUgc2V0IGluIG9yZGVyIHRvIHJheWNhc3QgYWdhaW5zdCBMaW5lU2VnbWVudHMyLicgKTsKCgkJfQoKCQljb25zdCB0aHJlc2hvbGQgPSAoIHJheWNhc3Rlci5wYXJhbXMuTGluZTIgIT09IHVuZGVmaW5lZCApID8gcmF5Y2FzdGVyLnBhcmFtcy5MaW5lMi50aHJlc2hvbGQgfHwgMCA6IDA7CgoJCWNvbnN0IHJheSA9IHJheWNhc3Rlci5yYXk7CgkJY29uc3QgY2FtZXJhID0gcmF5Y2FzdGVyLmNhbWVyYTsKCQljb25zdCBwcm9qZWN0aW9uTWF0cml4ID0gY2FtZXJhLnByb2plY3Rpb25NYXRyaXg7CgoJCWNvbnN0IG1hdHJpeFdvcmxkID0gdGhpcy5tYXRyaXhXb3JsZDsKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoJCWNvbnN0IHJlc29sdXRpb24gPSBtYXRlcmlhbC5yZXNvbHV0aW9uOwoJCWNvbnN0IGxpbmVXaWR0aCA9IG1hdGVyaWFsLmxpbmV3aWR0aCArIHRocmVzaG9sZDsKCgkJY29uc3QgaW5zdGFuY2VTdGFydCA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMuaW5zdGFuY2VTdGFydDsKCQljb25zdCBpbnN0YW5jZUVuZCA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMuaW5zdGFuY2VFbmQ7CgoJCS8vIGNhbWVyYSBmb3J3YXJkIGlzIG5lZ2F0aXZlCgkJY29uc3QgbmVhciA9IC0gY2FtZXJhLm5lYXI7CgoJCS8vIGNsaXAgc3BhY2UgaXMgWyAtIDEsIDEgXSBzbyBtdWx0aXBseSBieSB0d28gdG8gZ2V0IHRoZSBmdWxsCgkJLy8gd2lkdGggaW4gY2xpcCBzcGFjZQoJCWNvbnN0IHNzTWF4V2lkdGggPSAyLjAgKiBNYXRoLm1heCggbGluZVdpZHRoIC8gcmVzb2x1dGlvbi53aWR0aCwgbGluZVdpZHRoIC8gcmVzb2x1dGlvbi5oZWlnaHQgKTsKCgkJLy8KCgkJLy8gY2hlY2sgaWYgd2UgaW50ZXJzZWN0IHRoZSBzcGhlcmUgYm91bmRzCgkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIHsKCgkJCWdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQl9CgoJCV9zcGhlcmUuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKS5hcHBseU1hdHJpeDQoIG1hdHJpeFdvcmxkICk7CgkJY29uc3QgZGlzdGFuY2VUb1NwaGVyZSA9IE1hdGgubWF4KCBjYW1lcmEubmVhciwgX3NwaGVyZS5kaXN0YW5jZVRvUG9pbnQoIHJheS5vcmlnaW4gKSApOwoKCQkvLyBnZXQgdGhlIHcgY29tcG9uZW50IHRvIHNjYWxlIHRoZSB3b3JsZCBzcGFjZSBsaW5lIHdpZHRoCgkJX2NsaXBUb1dvcmxkVmVjdG9yLnNldCggMCwgMCwgLSBkaXN0YW5jZVRvU3BoZXJlLCAxLjAgKS5hcHBseU1hdHJpeDQoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgkJX2NsaXBUb1dvcmxkVmVjdG9yLm11bHRpcGx5U2NhbGFyKCAxLjAgLyBfY2xpcFRvV29ybGRWZWN0b3IudyApOwoJCV9jbGlwVG9Xb3JsZFZlY3Rvci5hcHBseU1hdHJpeDQoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSApOwoKCQkvLyBpbmNyZWFzZSB0aGUgc3BoZXJlIGJvdW5kcyBieSB0aGUgd29yc3QgY2FzZSBsaW5lIHNjcmVlbiBzcGFjZSB3aWR0aAoJCWNvbnN0IHNwaGVyZU1hcmdpbiA9IE1hdGguYWJzKCBzc01heFdpZHRoIC8gX2NsaXBUb1dvcmxkVmVjdG9yLncgKSAqIDAuNTsKCQlfc3BoZXJlLnJhZGl1cyArPSBzcGhlcmVNYXJnaW47CgoJCWlmICggcmF5Y2FzdGVyLnJheS5pbnRlcnNlY3RzU3BoZXJlKCBfc3BoZXJlICkgPT09IGZhbHNlICkgewoKCQkJcmV0dXJuOwoKCQl9CgoJCS8vCgoJCS8vIGNoZWNrIGlmIHdlIGludGVyc2VjdCB0aGUgYm94IGJvdW5kcwoJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQlnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTsKCgkJfQoKCQlfYm94LmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nQm94ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoJCWNvbnN0IGRpc3RhbmNlVG9Cb3ggPSBNYXRoLm1heCggY2FtZXJhLm5lYXIsIF9ib3guZGlzdGFuY2VUb1BvaW50KCByYXkub3JpZ2luICkgKTsKCgkJLy8gZ2V0IHRoZSB3IGNvbXBvbmVudCB0byBzY2FsZSB0aGUgd29ybGQgc3BhY2UgbGluZSB3aWR0aAoJCV9jbGlwVG9Xb3JsZFZlY3Rvci5zZXQoIDAsIDAsIC0gZGlzdGFuY2VUb0JveCwgMS4wICkuYXBwbHlNYXRyaXg0KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApOwoJCV9jbGlwVG9Xb3JsZFZlY3Rvci5tdWx0aXBseVNjYWxhciggMS4wIC8gX2NsaXBUb1dvcmxkVmVjdG9yLncgKTsKCQlfY2xpcFRvV29ybGRWZWN0b3IuYXBwbHlNYXRyaXg0KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCgkJLy8gaW5jcmVhc2UgdGhlIHNwaGVyZSBib3VuZHMgYnkgdGhlIHdvcnN0IGNhc2UgbGluZSBzY3JlZW4gc3BhY2Ugd2lkdGgKCQljb25zdCBib3hNYXJnaW4gPSBNYXRoLmFicyggc3NNYXhXaWR0aCAvIF9jbGlwVG9Xb3JsZFZlY3Rvci53ICkgKiAwLjU7CgkJX2JveC5tYXgueCArPSBib3hNYXJnaW47CgkJX2JveC5tYXgueSArPSBib3hNYXJnaW47CgkJX2JveC5tYXgueiArPSBib3hNYXJnaW47CgkJX2JveC5taW4ueCAtPSBib3hNYXJnaW47CgkJX2JveC5taW4ueSAtPSBib3hNYXJnaW47CgkJX2JveC5taW4ueiAtPSBib3hNYXJnaW47CgoJCWlmICggcmF5Y2FzdGVyLnJheS5pbnRlcnNlY3RzQm94KCBfYm94ICkgPT09IGZhbHNlICkgewoKCQkJcmV0dXJuOwoKCQl9CgoJCS8vCgoJCS8vIHBpY2sgYSBwb2ludCAxIHVuaXQgb3V0IGFsb25nIHRoZSByYXkgdG8gYXZvaWQgdGhlIHJheSBvcmlnaW4KCQkvLyBzaXR0aW5nIGF0IHRoZSBjYW1lcmEgb3JpZ2luIHdoaWNoIHdpbGwgY2F1c2UgInciIHRvIGJlIDAgd2hlbgoJCS8vIGFwcGx5aW5nIHRoZSBwcm9qZWN0aW9uIG1hdHJpeC4KCQlyYXkuYXQoIDEsIF9zc09yaWdpbiApOwoKCQkvLyBuZGMgc3BhY2UgWyAtIDEuMCwgMS4wIF0KCQlfc3NPcmlnaW4udyA9IDE7CgkJX3NzT3JpZ2luLmFwcGx5TWF0cml4NCggY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSApOwoJCV9zc09yaWdpbi5hcHBseU1hdHJpeDQoIHByb2plY3Rpb25NYXRyaXggKTsKCQlfc3NPcmlnaW4ubXVsdGlwbHlTY2FsYXIoIDEgLyBfc3NPcmlnaW4udyApOwoKCQkvLyBzY3JlZW4gc3BhY2UKCQlfc3NPcmlnaW4ueCAqPSByZXNvbHV0aW9uLnggLyAyOwoJCV9zc09yaWdpbi55ICo9IHJlc29sdXRpb24ueSAvIDI7CgkJX3NzT3JpZ2luLnogPSAwOwoKCQlfc3NPcmlnaW4zLmNvcHkoIF9zc09yaWdpbiApOwoKCQlfbXZNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSwgbWF0cml4V29ybGQgKTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gaW5zdGFuY2VTdGFydC5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQlfc3RhcnQ0LmZyb21CdWZmZXJBdHRyaWJ1dGUoIGluc3RhbmNlU3RhcnQsIGkgKTsKCQkJX2VuZDQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggaW5zdGFuY2VFbmQsIGkgKTsKCgkJCV9zdGFydC53ID0gMTsKCQkJX2VuZC53ID0gMTsKCgkJCS8vIGNhbWVyYSBzcGFjZQoJCQlfc3RhcnQ0LmFwcGx5TWF0cml4NCggX212TWF0cml4ICk7CgkJCV9lbmQ0LmFwcGx5TWF0cml4NCggX212TWF0cml4ICk7CgoJCQkvLyBza2lwIHRoZSBzZWdtZW50IGlmIGl0J3MgZW50aXJlbHkgYmVoaW5kIHRoZSBjYW1lcmEKCQkJdmFyIGlzQmVoaW5kQ2FtZXJhTmVhciA9IF9zdGFydDQueiA+IG5lYXIgJiYgX2VuZDQueiA+IG5lYXI7CgkJCWlmICggaXNCZWhpbmRDYW1lcmFOZWFyICkgewoKCQkJCWNvbnRpbnVlOwoKCQkJfQoKCQkJLy8gdHJpbSB0aGUgc2VnbWVudCBpZiBpdCBleHRlbmRzIGJlaGluZCBjYW1lcmEgbmVhcgoJCQlpZiAoIF9zdGFydDQueiA+IG5lYXIgKSB7CgoJCQkJY29uc3QgZGVsdGFEaXN0ID0gX3N0YXJ0NC56IC0gX2VuZDQuejsKCQkJCWNvbnN0IHQgPSAoIF9zdGFydDQueiAtIG5lYXIgKSAvIGRlbHRhRGlzdDsKCQkJCV9zdGFydDQubGVycCggX2VuZDQsIHQgKTsKCgkJCX0gZWxzZSBpZiAoIF9lbmQ0LnogPiBuZWFyICkgewoKCQkJCWNvbnN0IGRlbHRhRGlzdCA9IF9lbmQ0LnogLSBfc3RhcnQ0Lno7CgkJCQljb25zdCB0ID0gKCBfZW5kNC56IC0gbmVhciApIC8gZGVsdGFEaXN0OwoJCQkJX2VuZDQubGVycCggX3N0YXJ0NCwgdCApOwoKCQkJfQoKCQkJLy8gY2xpcCBzcGFjZQoJCQlfc3RhcnQ0LmFwcGx5TWF0cml4NCggcHJvamVjdGlvbk1hdHJpeCApOwoJCQlfZW5kNC5hcHBseU1hdHJpeDQoIHByb2plY3Rpb25NYXRyaXggKTsKCgkJCS8vIG5kYyBzcGFjZSBbIC0gMS4wLCAxLjAgXQoJCQlfc3RhcnQ0Lm11bHRpcGx5U2NhbGFyKCAxIC8gX3N0YXJ0NC53ICk7CgkJCV9lbmQ0Lm11bHRpcGx5U2NhbGFyKCAxIC8gX2VuZDQudyApOwoKCQkJLy8gc2NyZWVuIHNwYWNlCgkJCV9zdGFydDQueCAqPSByZXNvbHV0aW9uLnggLyAyOwoJCQlfc3RhcnQ0LnkgKj0gcmVzb2x1dGlvbi55IC8gMjsKCgkJCV9lbmQ0LnggKj0gcmVzb2x1dGlvbi54IC8gMjsKCQkJX2VuZDQueSAqPSByZXNvbHV0aW9uLnkgLyAyOwoKCQkJLy8gY3JlYXRlIDJkIHNlZ21lbnQKCQkJX2xpbmUuc3RhcnQuY29weSggX3N0YXJ0NCApOwoJCQlfbGluZS5zdGFydC56ID0gMDsKCgkJCV9saW5lLmVuZC5jb3B5KCBfZW5kNCApOwoJCQlfbGluZS5lbmQueiA9IDA7CgoJCQkvLyBnZXQgY2xvc2VzdCBwb2ludCBvbiByYXkgdG8gc2VnbWVudAoJCQljb25zdCBwYXJhbSA9IF9saW5lLmNsb3Nlc3RQb2ludFRvUG9pbnRQYXJhbWV0ZXIoIF9zc09yaWdpbjMsIHRydWUgKTsKCQkJX2xpbmUuYXQoIHBhcmFtLCBfY2xvc2VzdFBvaW50ICk7CgoJCQkvLyBjaGVjayBpZiB0aGUgaW50ZXJzZWN0aW9uIHBvaW50IGlzIHdpdGhpbiBjbGlwIHNwYWNlCgkJCWNvbnN0IHpQb3MgPSBNYXRoVXRpbHMubGVycCggX3N0YXJ0NC56LCBfZW5kNC56LCBwYXJhbSApOwoJCQljb25zdCBpc0luQ2xpcFNwYWNlID0gelBvcyA+PSAtIDEgJiYgelBvcyA8PSAxOwoKCQkJY29uc3QgaXNJbnNpZGUgPSBfc3NPcmlnaW4zLmRpc3RhbmNlVG8oIF9jbG9zZXN0UG9pbnQgKSA8IGxpbmVXaWR0aCAqIDAuNTsKCgkJCWlmICggaXNJbkNsaXBTcGFjZSAmJiBpc0luc2lkZSApIHsKCgkJCQlfbGluZS5zdGFydC5mcm9tQnVmZmVyQXR0cmlidXRlKCBpbnN0YW5jZVN0YXJ0LCBpICk7CgkJCQlfbGluZS5lbmQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggaW5zdGFuY2VFbmQsIGkgKTsKCgkJCQlfbGluZS5zdGFydC5hcHBseU1hdHJpeDQoIG1hdHJpeFdvcmxkICk7CgkJCQlfbGluZS5lbmQuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoKCQkJCWNvbnN0IHBvaW50T25MaW5lID0gbmV3IFZlY3RvcjMoKTsKCQkJCWNvbnN0IHBvaW50ID0gbmV3IFZlY3RvcjMoKTsKCgkJCQlyYXkuZGlzdGFuY2VTcVRvU2VnbWVudCggX2xpbmUuc3RhcnQsIF9saW5lLmVuZCwgcG9pbnQsIHBvaW50T25MaW5lICk7CgoJCQkJaW50ZXJzZWN0cy5wdXNoKCB7CgoJCQkJCXBvaW50OiBwb2ludCwKCQkJCQlwb2ludE9uTGluZTogcG9pbnRPbkxpbmUsCgkJCQkJZGlzdGFuY2U6IHJheS5vcmlnaW4uZGlzdGFuY2VUbyggcG9pbnQgKSwKCgkJCQkJb2JqZWN0OiB0aGlzLAoJCQkJCWZhY2U6IG51bGwsCgkJCQkJZmFjZUluZGV4OiBpLAoJCQkJCXV2OiBudWxsLAoJCQkJCXV2MjogbnVsbCwKCgkJCQl9ICk7CgoJCQl9CgoJCX0KCgl9Cgp9CgpMaW5lU2VnbWVudHMyLnByb3RvdHlwZS5MaW5lU2VnbWVudHMyID0gdHJ1ZTsKCmV4cG9ydCB7IExpbmVTZWdtZW50czIgfTsK", "./assets/cities_data.js": "data:text/javascript;base64,Ly8gYXNzZXRzL2NpdGllc19kYXRhLmpzDQovLyDmiJHku6znmoTigJzln47luILmlbDmja7lupPigJ3vvIzkuLrmr4/kuKrln47luILlop7liqDkuoYgY291bnRyeV9jb2RlICjlm73lrrbkuInlrZfnoIEpDQoNCmV4cG9ydCBjb25zdCBjaXRpZXMgPSBbDQogIC8vIC0tLSDkuK3lm70gKDEwKSAtIOmrmOmHjeimgeaApyAtLS0NCiAgeyBsYXQ6IDM5LjkwNDIsIGxvbjogMTE2LjQwNzQsIG5hbWVfZW46ICdCZWlqaW5nJywgbmFtZV96aDogJ+WMl+S6rCcsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ0NITicgfSwNCiAgeyBsYXQ6IDMxLjIzMDQsIGxvbjogMTIxLjQ3MzcsIG5hbWVfZW46ICdTaGFuZ2hhaScsIG5hbWVfemg6ICfkuIrmtbcnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdDSE4nIH0sDQogIHsgbGF0OiAyMy4xMjkxLCBsb246IDExMy4yNjQ0LCBuYW1lX2VuOiAnR3Vhbmd6aG91JywgbmFtZV96aDogJ+W5v+W3nicsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ0NITicgfSwNCiAgeyBsYXQ6IDIyLjU0MzEsIGxvbjogMTE0LjA1NzksIG5hbWVfZW46ICdTaGVuemhlbicsIG5hbWVfemg6ICfmt7HlnLMnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdDSE4nIH0sDQogIHsgbGF0OiAzMC41NzI4LCBsb246IDEwNC4wNjY4LCBuYW1lX2VuOiAnQ2hlbmdkdScsIG5hbWVfemg6ICfmiJDpg70nLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdDSE4nIH0sDQogIHsgbGF0OiAyOS41NjMwLCBsb246IDEwNi41NTE2LCBuYW1lX2VuOiAnQ2hvbmdxaW5nJywgbmFtZV96aDogJ+mHjeW6hicsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ0NITicgfSwNCiAgeyBsYXQ6IDMwLjY2MjIsIGxvbjogMTE0LjMwNTUsIG5hbWVfZW46ICdXdWhhbicsIG5hbWVfemg6ICfmrabmsYknLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdDSE4nIH0sDQogIHsgbGF0OiAzNC4zNDE2LCBsb246IDEwOC45NDAyLCBuYW1lX2VuOiAnWGlcJ2FuJywgbmFtZV96aDogJ+ilv+WuiScsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ0NITicgfSwNCiAgeyBsYXQ6IDMwLjI3NDEsIGxvbjogMTIwLjE1NTEsIG5hbWVfZW46ICdIYW5nemhvdScsIG5hbWVfemg6ICfmna3lt54nLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdDSE4nIH0sDQogIHsgbGF0OiAyOS42NDU2LCBsb246IDkxLjE0MDIsIG5hbWVfZW46ICdMaGFzYScsIG5hbWVfemg6ICfmi4nokKgnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdDSE4nIH0sDQoNCiAgLy8gLS0tIOe+juWbvSAo5omp5YWFKSAtIOmrmOmHjeimgeaApyAtLS0NCiAgeyBsYXQ6IDQwLjcxMjgsIGxvbjogLTc0LjAwNjAsIG5hbWVfZW46ICdOZXcgWW9yaycsIG5hbWVfemg6ICfnur3nuqYnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdVU0EnIH0sDQogIHsgbGF0OiA0MS44NzgxLCBsb246IC04Ny42Mjk4LCBuYW1lX2VuOiAnQ2hpY2FnbycsIG5hbWVfemg6ICfoip3liqDlk6UnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdVU0EnIH0sDQogIHsgbGF0OiAzOS43MzkyLCBsb246IC0xMDQuOTkwMywgbmFtZV9lbjogJ0RlbnZlcicsIG5hbWVfemg6ICfkuLnkvZsnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdVU0EnIH0sDQogIHsgbGF0OiAzNC4wNTIyLCBsb246IC0xMTguMjQzNywgbmFtZV9lbjogJ0xvcyBBbmdlbGVzJywgbmFtZV96aDogJ+a0m+adieefticsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ1VTQScgfSwNCiAgeyBsYXQ6IDYxLjIxODEsIGxvbjogLTE0OS45MDAzLCBuYW1lX2VuOiAnQW5jaG9yYWdlJywgbmFtZV96aDogJ+WuieWFi+mbt+WlhycsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ1VTQScgfSwNCiAgeyBsYXQ6IDIxLjMwNjksIGxvbjogLTE1Ny44NTgzLCBuYW1lX2VuOiAnSG9ub2x1bHUnLCBuYW1lX3poOiAn5qqA6aaZ5bGxJywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnVVNBJyB9LA0KICB7IGxhdDogMzguOTA3MiwgbG9uOiAtNzcuMDM2OSwgbmFtZV9lbjogJ1dhc2hpbmd0b24gRC5DLicsIG5hbWVfemg6ICfljY7nm5vpob8nLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdVU0EnIH0sDQogIHsgbGF0OiAyOS43NjA0LCBsb246IC05NS4zNjk4LCBuYW1lX2VuOiAnSG91c3RvbicsIG5hbWVfemg6ICfkvJHmlq/pob8nLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdVU0EnIH0sDQogIHsgbGF0OiA0Ny42MDYyLCBsb246IC0xMjIuMzMyMSwgbmFtZV9lbjogJ1NlYXR0bGUnLCBuYW1lX3poOiAn6KW/6ZuF5Zu+JywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnVVNBJyB9LA0KICB7IGxhdDogMjUuNzYxNywgbG9uOiAtODAuMTkxOCwgbmFtZV9lbjogJ01pYW1pJywgbmFtZV96aDogJ+i/iOmYv+WvhicsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ1VTQScgfSwNCg0KICAvLyAtLS0g5L+E572X5pavICjmianlhYUpIC0g6auY6YeN6KaB5oCnIC0tLQ0KICB7IGxhdDogNTUuNzU1OCwgbG9uOiAzNy42MTczLCBuYW1lX2VuOiAnTW9zY293JywgbmFtZV96aDogJ+iOq+aWr+enkScsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ1JVUycgfSwNCiAgeyBsYXQ6IDU5LjkzNDMsIGxvbjogMzAuMzM1MSwgbmFtZV9lbjogJ1N0LiBQZXRlcnNidXJnJywgbmFtZV96aDogJ+Wco+W9vOW+l+WgoScsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ1JVUycgfSwNCiAgeyBsYXQ6IDU2LjgzODksIGxvbjogNjAuNjA1NywgbmFtZV9lbjogJ1lla2F0ZXJpbmJ1cmcnLCBuYW1lX3poOiAn5Y+25Y2h5o2355Cz5aChJywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnUlVTJyB9LA0KICB7IGxhdDogNTUuMDA4NCwgbG9uOiA4Mi45MzU3LCBuYW1lX2VuOiAnTm92b3NpYmlyc2snLCBuYW1lX3poOiAn5paw6KW/5Lyv5Yip5LqaJywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnUlVTJyB9LA0KICB7IGxhdDogNDMuMTE5OCwgbG9uOiAxMzEuODg2OSwgbmFtZV9lbjogJ1ZsYWRpdm9zdG9rJywgbmFtZV96aDogJ+espuaLiei/quayg+aWr+aJmOWFiycsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ1JVUycgfSwNCg0KICAgICAgLy8gLS0tIOWKoOaLv+WkpyAo5omp5YWFKSAtICAtLS0NCi8vIOWKoOaLv+Wkp+mmlumDvQ0KeyBsYXQ6IDQ1LjQyMTUsIGxvbjogLTc1LjY5OTcsIG5hbWVfZW46ICdPdHRhd2EnLCBuYW1lX3poOiAn5ril5aSq5Y2OJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQ0FOJywgdGltZXpvbmU6ICdBbWVyaWNhL1Rvcm9udG8nIH0sIC8vIOmmlumDve+8jOS4nOmDqOaXtuWMug0KeyBsYXQ6IDQzLjY1MTAsIGxvbjogLTc5LjM0NzAsIG5hbWVfZW46ICdUb3JvbnRvJywgbmFtZV96aDogJ+WkmuS8puWkmicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NBTicsIHRpbWV6b25lOiAnQW1lcmljYS9Ub3JvbnRvJyB9LCAvLyDmnIDlpKfln47luILvvIzkuJzpg6jml7bljLoNCnsgbGF0OiA0NS41MDE3LCBsb246IC03My41NjczLCBuYW1lX2VuOiAnTW9udHJlYWwnLCBuYW1lX3poOiAn6JKZ54m55Yip5bCUJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQ0FOJywgdGltZXpvbmU6ICdBbWVyaWNhL1Rvcm9udG8nIH0sIC8vIOesrOS6jOWkp+WfjuW4gu+8jOS4nOmDqOaXtuWMug0KeyBsYXQ6IDQ5Ljg5NTEsIGxvbjogLTk3LjEzODQsIG5hbWVfZW46ICdXaW5uaXBlZycsIG5hbWVfemg6ICfmuKnlsLzkvK8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdDQU4nLCB0aW1lem9uZTogJ0FtZXJpY2EvV2lubmlwZWcnIH0sIC8vIOabvOWwvOaJmOW3tOecgeS8mu+8jOS4remDqOaXtuWMug0KeyBsYXQ6IDUxLjA0NDcsIGxvbjogLTExNC4wNzE5LCBuYW1lX2VuOiAnQ2FsZ2FyeScsIG5hbWVfemg6ICfljaHlsJTliqDph4wnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdDQU4nLCB0aW1lem9uZTogJ0FtZXJpY2EvRWRtb250b24nIH0sIC8vIOmYv+WwlOS8r+WhlOecge+8jOWxseWMuuaXtuWMug0KeyBsYXQ6IDQ5LjI4MjcsIGxvbjogLTEyMy4xMjA3LCBuYW1lX2VuOiAnVmFuY291dmVyJywgbmFtZV96aDogJ+a4qeWTpeWNjicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NBTicsIHRpbWV6b25lOiAnQW1lcmljYS9WYW5jb3V2ZXInIH0sIC8vIOS4jeWIl+mioOWTpeS8puavlOS6muecge+8jOWkquW5s+a0i+aXtuWMug0KDQoNCiAgLy8gLS0tIOWNsOW6piAo5omp5YWFKSAtIOmrmOmHjeimgeaApyAtLS0NCiAgeyBsYXQ6IDI4LjYxMzksIGxvbjogNzcuMjA5MCwgbmFtZV9lbjogJ05ldyBEZWxoaScsIG5hbWVfemg6ICfmlrDlvrfph4wnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdJTkQnIH0sDQogIHsgbGF0OiAxOS4wNzYwLCBsb246IDcyLjg3NzcsIG5hbWVfZW46ICdNdW1iYWknLCBuYW1lX3poOiAn5a2f5LmwJywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnSU5EJyB9LA0KICB7IGxhdDogMTIuOTcxNiwgbG9uOiA3Ny41OTQ2LCBuYW1lX2VuOiAnQmFuZ2Fsb3JlJywgbmFtZV96aDogJ+ePreWKoOe9l+WwlCcsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ0lORCcgfSwNCiAgeyBsYXQ6IDIyLjU3MjYsIGxvbjogODguMzYzOSwgbmFtZV9lbjogJ0tvbGthdGEnLCBuYW1lX3poOiAn5Yqg5bCU5ZCE562UJywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnSU5EJyB9LA0KDQogIC8vIC0tLSDmvrPlpKfliKnkupogKOaJqeWFhSkgLSDpq5jph43opoHmgKcgLS0tDQogIHsgbGF0OiAtMzMuODY4OCwgbG9uOiAxNTEuMjA5MywgbmFtZV9lbjogJ1N5ZG5leScsIG5hbWVfemg6ICfmgonlsLwnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdBVVMnIH0sDQogIHsgbGF0OiAtMzcuODEzNiwgbG9uOiAxNDQuOTYzMSwgbmFtZV9lbjogJ01lbGJvdXJuZScsIG5hbWVfemg6ICfloqjlsJTmnKwnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdBVVMnIH0sDQogIHsgbGF0OiAtMjcuNDY5OCwgbG9uOiAxNTMuMDI1MSwgbmFtZV9lbjogJ0JyaXNiYW5lJywgbmFtZV96aDogJ+W4g+mHjOaWr+ePrScsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ0FVUycgfSwNCiAgeyBsYXQ6IC0zMS45NTA1LCBsb246IDExNS44NjA1LCBuYW1lX2VuOiAnUGVydGgnLCBuYW1lX3poOiAn54+A5pavJywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnQVVTJyB9LA0KDQogIC8vIC0tLSDph43opoHlspvlsb/lkozpooblnLAgLSDpq5jph43opoHmgKcgLS0tDQogIHsgbGF0OiAxMy40NDQzLCBsb246IDE0NC43OTM3LCBuYW1lX2VuOiAnR3VhbScsIG5hbWVfemg6ICflhbPlspsnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdHVU0nIH0sDQogIHsgbGF0OiAxOC4yMjA4LCBsb246IC02Ni41OTAxLCBuYW1lX2VuOiAnUHVlcnRvIFJpY28nLCBuYW1lX3poOiAn5rOi5aSa6buO5ZCEJywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnUFJJJyB9LA0KDQoNCg0KLy8gLS0tIOaWsOWinueahOmHjeimgeWym+Wxv+WSjOmihuWcsCAtLS0NCiAgeyBsYXQ6IDY0LjE4MzYsIGxvbjogLTUxLjcyMTYsIG5hbWVfZW46ICdOdXVrJywgbmFtZV96aDogJ+WKquWFiycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0dSTCcgfSwgLy8gR3JlZW5sYW5kDQogIHsgbGF0OiAtMjEuMjA3OCwgbG9uOiAxNjUuMjg5LCBuYW1lX2VuOiAnTm91bcOpYScsIG5hbWVfemg6ICfliqrnvo7pmL8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdOQ0wnIH0sIC8vIE5ldyBDYWxlZG9uaWENCiAgeyBsYXQ6IC01MS43MDAwLCBsb246IC01Ny44NTAwLCBuYW1lX2VuOiAnU3RhbmxleScsIG5hbWVfemg6ICfmlq/lnabliKknLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdGTEsnIH0sIC8vIEZhbGtsYW5kIElzbGFuZHMNCiAgeyBsYXQ6IC0yMC44ODIzLCBsb246IDU1LjQ1MDQsIG5hbWVfZW46ICdTYWludC1EZW5pcycsIG5hbWVfemg6ICflnKPkvYblsLwnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdSRVUnIH0sIC8vIFLDqXVuaW9uDQogIHsgbGF0OiAxNC42MDQ5LCBsb246IC02MS4wNzE4LCBuYW1lX2VuOiAnRm9ydC1kZS1GcmFuY2UnLCBuYW1lX3poOiAn5rOV5YWw6KW/5aChJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTVRRJyB9LCAvLyBNYXJ0aW5pcXVlDQogIHsgbGF0OiA2Mi4wMDk3LCBsb246IC02Ljc3MjYsIG5hbWVfZW46ICdUw7Nyc2hhdm4nLCBuYW1lX3poOiAn5omY5bCU5pav5rivJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnRlJPJyB9LCAvLyBGYXJvZSBJc2xhbmRzDQogIHsgbGF0OiAxNS4yMTQsIGxvbjogMTQ1Ljc1NiwgbmFtZV9lbjogJ1NhaXBhbicsIG5hbWVfemg6ICfloZ7nj60nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNTlAnIH0sIC8vIE5vcnRoZXJuIE1hcmlhbmEgSXNsYW5kcw0KICB7IGxhdDogMTguMzM5LCBsb246IC02NC45MzMsIG5hbWVfZW46ICdDaGFybG90dGUgQW1hbGllJywgbmFtZV96aDogJ+Wkj+a0m+eJuemYv+mprOWIqeS6micsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1ZJUicgfSwgLy8gVS5TLiBWaXJnaW4gSXNsYW5kcw0KICAvLyAtLS0g5LiW55WM5ZCE5Zu96aaW6YO9IC0tLQ0KIC8vIC0tLSDpnZ7mtLLpppbpg70gLS0tDQogIHsgbGF0OiAzNi43NTI4LCBsb246IDMuMDQyMiwgbmFtZV9lbjogJ0FsZ2llcnMnLCBuYW1lX3poOiAn6Zi/5bCU5Y+K5bCUJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnRFpBJyB9LCAvLyBBbGdlcmlhDQp7IGxhdDogLTguODM5MCwgbG9uOiAxMy4yODk0LCBuYW1lX2VuOiAnTHVhbmRhJywgbmFtZV96aDogJ+e9l+Wuiei+vicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0FHTycgfSwgLy8gQW5nb2xhDQp7IGxhdDogNi40OTY5LCBsb246IDIuNjI4OSwgbmFtZV9lbjogJ1BvcnRvLU5vdm8nLCBuYW1lX3poOiAn5rOi5aSa6K+65LyPJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQkVOJyB9LCAvLyBCZW5pbg0KeyBsYXQ6IC0yNC42NTgxLCBsb246IDI1LjkxMjIsIG5hbWVfZW46ICdHYWJvcm9uZScsIG5hbWVfemg6ICflk4jljZrnvZflhoUnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdCV0EnIH0sIC8vIEJvdHN3YW5hDQp7IGxhdDogMTIuMzY0MiwgbG9uOiAtMS41MzgzLCBuYW1lX2VuOiAnT3VhZ2Fkb3Vnb3UnLCBuYW1lX3poOiAn55Om5Yqg5p2c5Y+kJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQkZBJyB9LCAvLyBCdXJraW5hIEZhc28NCnsgbGF0OiAtMy40MjY0LCBsb246IDI5LjkyNTYsIG5hbWVfZW46ICdHaXRlZ2EnLCBuYW1lX3poOiAn5Z+654m55YqgJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQkRJJyB9LCAvLyBCdXJ1bmRpDQp7IGxhdDogMy44NDgwLCBsb246IDExLjUwMjEsIG5hbWVfZW46ICdZYW91bmTDqScsIG5hbWVfemg6ICfpm4XmuKnlvpcnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdDTVInIH0sIC8vIENhbWVyb29uDQp7IGxhdDogMTQuOTMzMSwgbG9uOiAtMjMuNTEzMywgbmFtZV9lbjogJ1ByYWlhJywgbmFtZV96aDogJ+aZruaLieS6micsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NQVicgfSwgLy8gQ2FwZSBWZXJkZQ0KeyBsYXQ6IDQuMzk0NywgbG9uOiAxOC41NTgyLCBuYW1lX2VuOiAnQmFuZ3VpJywgbmFtZV96aDogJ+ePreWQiScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NBRicgfSwgLy8gQ2VudHJhbCBBZnJpY2FuIFJlcHVibGljDQp7IGxhdDogMTIuMTM0OCwgbG9uOiAxNS4wNTU3LCBuYW1lX2VuOiAiTidEamFtZW5hIiwgbmFtZV96aDogJ+aBqei0vuaihee6sycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1RDRCcgfSwgLy8gQ2hhZA0KeyBsYXQ6IC0xMS42OTgyLCBsb246IDQzLjI1MzYsIG5hbWVfZW46ICdNb3JvbmknLCBuYW1lX3poOiAn6I6r572X5bC8JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQ09NJyB9LCAvLyBDb21vcm9zDQp7IGxhdDogLTQuMzI1MCwgbG9uOiAxNS4zMjIyLCBuYW1lX2VuOiAnS2luc2hhc2EnLCBuYW1lX3poOiAn6YeR5rKZ6JCoJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQ09EJyB9LCAvLyBEUiBDb25nbw0KeyBsYXQ6IC00LjI2MzQsIGxvbjogMTUuMjQyOSwgbmFtZV9lbjogJ0JyYXp6YXZpbGxlJywgbmFtZV96aDogJ+W4g+aLieaftOe7tOWwlCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NPRycgfSwgLy8gQ29uZ28NCnsgbGF0OiAxMS41ODkwLCBsb246IDQzLjE0NTAsIG5hbWVfZW46ICdEamlib3V0aScsIG5hbWVfemg6ICflkInluIPmj5AnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdESkknIH0sIC8vIERqaWJvdXRpDQp7IGxhdDogMzAuMDQ0NCwgbG9uOiAzMS4yMzU3LCBuYW1lX2VuOiAnQ2Fpcm8nLCBuYW1lX3poOiAn5byA572XJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnRUdZJyB9LCAvLyBFZ3lwdA0KeyBsYXQ6IDMuNzUwMCwgbG9uOiA4Ljc4MzMsIG5hbWVfZW46ICdNYWxhYm8nLCBuYW1lX3poOiAn6ams5ouJ5Y2aJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnR05RJyB9LCAvLyBFcXVhdG9yaWFsIEd1aW5lYQ0KeyBsYXQ6IDE1LjMzMzMsIGxvbjogMzguOTMzMywgbmFtZV9lbjogJ0FzbWFyYScsIG5hbWVfemg6ICfpmL/mlq/pqazmi4knLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdFUkknIH0sIC8vIEVyaXRyZWENCnsgbGF0OiAtMjYuMzA1NCwgbG9uOiAzMS4xMzY3LCBuYW1lX2VuOiAnTWJhYmFuZScsIG5hbWVfemg6ICflp4blt7Tlt7TlhoUnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdTV1onIH0sIC8vIEVzd2F0aW5pDQp7IGxhdDogOS4wMzAwLCBsb246IDM4Ljc0MDAsIG5hbWVfZW46ICdBZGRpcyBBYmFiYScsIG5hbWVfemg6ICfkuprnmoTmlq/kuprotJ3lt7QnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdFVEgnIH0sIC8vIEV0aGlvcGlhDQp7IGxhdDogMC4zOTAxLCBsb246IDkuNDU0NCwgbmFtZV9lbjogJ0xpYnJldmlsbGUnLCBuYW1lX3poOiAn5Yip5Lyv57u05bCUJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnR0FCJyB9LCAvLyBHYWJvbg0KeyBsYXQ6IDEzLjQ1NDksIGxvbjogLTE2LjU3OTAsIG5hbWVfZW46ICdCYW5qdWwnLCBuYW1lX3poOiAn54+t54+g5bCUJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnR01CJyB9LCAvLyBHYW1iaWENCnsgbGF0OiA5LjY0MTIsIGxvbjogLTEzLjU3ODQsIG5hbWVfZW46ICdDb25ha3J5JywgbmFtZV96aDogJ+enkee6s+WFi+mHjCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0dJTicgfSwgLy8gR3VpbmVhDQp7IGxhdDogMTEuODYzNiwgbG9uOiAtMTUuNTk3NywgbmFtZV9lbjogJ0Jpc3NhdScsIG5hbWVfemg6ICfmr5Tnu40nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdHTkInIH0sIC8vIEd1aW5lYS1CaXNzYXUNCnsgbGF0OiA2LjMxMzMsIGxvbjogLTEwLjgwMTQsIG5hbWVfZW46ICdNb25yb3ZpYScsIG5hbWVfemg6ICfokpnnvZfnu7TkuponLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdMQlInIH0sIC8vIExpYmVyaWENCnsgbGF0OiAzMi44ODcyLCBsb246IDEzLjE5MTMsIG5hbWVfZW46ICdUcmlwb2xpJywgbmFtZV96aDogJ+eahOm7juazoumHjCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0xCWScgfSwgLy8gTGlieWENCnsgbGF0OiAtMTguODc5MiwgbG9uOiA0Ny41MDc5LCBuYW1lX2VuOiAnQW50YW5hbmFyaXZvJywgbmFtZV96aDogJ+WhlOmCo+mCo+WIqeS9mycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ01ERycgfSwgLy8gTWFkYWdhc2Nhcg0KeyBsYXQ6IC0xMy45NjI2LCBsb246IDMzLjc3NDEsIG5hbWVfZW46ICdMaWxvbmd3ZScsIG5hbWVfemg6ICfliKnpmoblnK0nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNV0knIH0sIC8vIE1hbGF3aQ0KeyBsYXQ6IDEyLjYzOTIsIGxvbjogLTguMDAyOSwgbmFtZV9lbjogJ0JhbWFrbycsIG5hbWVfemg6ICflt7Tpqaznp5EnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNTEknIH0sIC8vIE1hbGkNCnsgbGF0OiAxOC4wNzgzLCBsb246IC0xNS45NzQ0LCBuYW1lX2VuOiAnTm91YWtjaG90dCcsIG5hbWVfemg6ICfliqrnk6blhYvogpbnibknLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNUlQnIH0sIC8vIE1hdXJpdGFuaWENCnsgbGF0OiAtMjAuMTYwOSwgbG9uOiA1Ny41MDEyLCBuYW1lX2VuOiAnUG9ydCBMb3VpcycsIG5hbWVfemg6ICfot6/mmJPmuK8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNVVMnIH0sIC8vIE1hdXJpdGl1cw0KeyBsYXQ6IC0yNS45NjkyLCBsb246IDMyLjU3MzIsIG5hbWVfZW46ICdNYXB1dG8nLCBuYW1lX3poOiAn6ams5pmu5omYJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTU9aJyB9LCAvLyBNb3phbWJpcXVlDQp7IGxhdDogLTIyLjU1OTcsIGxvbjogMTcuMDgzMiwgbmFtZV9lbjogJ1dpbmRob2VrJywgbmFtZV96aDogJ+a4qeW+l+WSjOWFiycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ05BTScgfSwgLy8gTmFtaWJpYQ0KeyBsYXQ6IDEzLjUxMjgsIGxvbjogMi4xMTI2LCBuYW1lX2VuOiAnTmlhbWV5JywgbmFtZV96aDogJ+WwvOS6mue+jicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ05FUicgfSwgLy8gTmlnZXINCnsgbGF0OiA5LjA1NzksIGxvbjogNy40OTUxLCBuYW1lX2VuOiAnQWJ1amEnLCBuYW1lX3poOiAn6Zi/5biD6LS+JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTkdBJyB9LCAvLyBOaWdlcmlhDQp7IGxhdDogLTEuMjkyMSwgbG9uOiAzNi44MjE5LCBuYW1lX2VuOiAnTmFpcm9iaScsIG5hbWVfemg6ICflhoXnvZfmr5UnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdLRU4nIH0sIC8vIEtlbnlhDQp7IGxhdDogLTI5LjMxNTgsIGxvbjogMjcuNDg1NCwgbmFtZV9lbjogJ01hc2VydScsIG5hbWVfemg6ICfpqazloZ7ljaInLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdMU08nIH0sIC8vIExlc290aG8NCnsgbGF0OiAzNC4wMjA5LCBsb246IC02Ljg0MTYsIG5hbWVfZW46ICdSYWJhdCcsIG5hbWVfemg6ICfmi4nlt7TnibknLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNQVInIH0sIC8vIE1vcm9jY28NCnsgbGF0OiAtMi4xNTQwLCBsb246IDMwLjUzNTAsIG5hbWVfZW46ICdLaWdhbGknLCBuYW1lX3poOiAn5Z+65Yqg5YipJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnUldBJyB9LCAvLyBSd2FuZGENCnsgbGF0OiAwLjMzNjUsIGxvbjogNi43MjczLCBuYW1lX2VuOiAnU2FvIFRvbWUnLCBuYW1lX3poOiAn5Zyj5aSa576OJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnU1RQJyB9LCAvLyBTYW8gVG9tZSBhbmQgUHJpbmNpcGUNCnsgbGF0OiAxNC42OTI4LCBsb246IC0xNy40NDY3LCBuYW1lX2VuOiAnRGFrYXInLCBuYW1lX3poOiAn6L6+5ZaA5bCUJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnU0VOJyB9LCAvLyBTZW5lZ2FsDQp7IGxhdDogLTQuNjE5MSwgbG9uOiA1NS40NTEzLCBuYW1lX2VuOiAnVmljdG9yaWEnLCBuYW1lX3poOiAn57u05aSa5Yip5LqaJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnU1lDJyB9LCAvLyBTZXljaGVsbGVzDQp7IGxhdDogOC40NjU3LCBsb246IC0xMy4yMzE3LCBuYW1lX2VuOiAnRnJlZXRvd24nLCBuYW1lX3poOiAn5byX6YeM5pWmJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnU0xFJyB9LCAvLyBTaWVycmEgTGVvbmUNCnsgbGF0OiAyLjA0NjksIGxvbjogNDUuMzE4MiwgbmFtZV9lbjogJ01vZ2FkaXNodScsIG5hbWVfemg6ICfmkanliqDov6rmspknLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdTT00nIH0sIC8vIFNvbWFsaWENCnsgbGF0OiAtMjUuNzQ2MSwgbG9uOiAyOC4xODgxLCBuYW1lX2VuOiAnUHJldG9yaWEnLCBuYW1lX3poOiAn5q+U5YuS6ZmA5Yip5LqaJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnWkFGJyB9LCAvLyBTb3V0aCBBZnJpY2EgKOihjOaUvykNCnsgbGF0OiAtMzMuOTI1OCwgbG9uOiAxOC40MjMyLCBuYW1lX2VuOiAnQ2FwZSBUb3duJywgbmFtZV96aDogJ+W8gOaZruaVpicsIGltcG9ydGFuY2U6IDAuNSwgY291bnRyeV9jb2RlOiAnWkFGJyB9LCAvLyBTb3V0aCBBZnJpY2EgKOeri+azlSkNCnsgbGF0OiAtMjkuMTE4NCwgbG9uOiAyNi4yMjk0LCBuYW1lX2VuOiAnQmxvZW1mb250ZWluJywgbmFtZV96aDogJ+W4g+mahuaWueS4uScsIGltcG9ydGFuY2U6IDAuNSwgY291bnRyeV9jb2RlOiAnWkFGJyB9LCAvLyBTb3V0aCBBZnJpY2EgKOWPuOazlSkNCnsgbGF0OiA0Ljg1OTQsIGxvbjogMzEuNTcxMywgbmFtZV9lbjogJ0p1YmEnLCBuYW1lX3poOiAn5pyx5be0JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnU1NEJyB9LCAvLyBTb3V0aCBTdWRhbg0KeyBsYXQ6IDE1LjUwMDcsIGxvbjogMzIuNTU5OSwgbmFtZV9lbjogJ0toYXJ0b3VtJywgbmFtZV96aDogJ+WWgOWcn+ephicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1NETicgfSwgLy8gU3VkYW4NCnsgbGF0OiAtNi4xNjMwLCBsb246IDM1Ljc1MTYsIG5hbWVfZW46ICdEb2RvbWEnLCBuYW1lX3poOiAn5aSa5aSa6amsJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnVFpBJyB9LCAvLyBUYW56YW5pYQ0KeyBsYXQ6IDYuMTMxOSwgbG9uOiAxLjIyMjAsIG5hbWVfZW46ICdMb23DqScsIG5hbWVfemg6ICfmtJvnvo4nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdUR08nIH0sIC8vIFRvZ28NCnsgbGF0OiAzNi44MDY1LCBsb246IDEwLjE4MTUsIG5hbWVfZW46ICdUdW5pcycsIG5hbWVfemg6ICfnqoHlsLzmlq8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdUVU4nIH0sIC8vIFR1bmlzaWENCnsgbGF0OiAwLjM0NzYsIGxvbjogMzIuNTgyNSwgbmFtZV9lbjogJ0thbXBhbGEnLCBuYW1lX3poOiAn5Z2O5biV5ouJJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnVUdBJyB9LCAvLyBVZ2FuZGENCnsgbGF0OiAtMTUuNDE2NywgbG9uOiAyOC4yODMzLCBuYW1lX2VuOiAnTHVzYWthJywgbmFtZV96aDogJ+WNouiQqOWNoScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1pNQicgfSwgLy8gWmFtYmlhDQp7IGxhdDogLTE3LjgyOTIsIGxvbjogMzEuMDUyMiwgbmFtZV9lbjogJ0hhcmFyZScsIG5hbWVfemg6ICflk4jmi4npm7cnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdaV0UnIH0sIC8vIFppbWJhYndlDQp7IGxhdDogNy41NDYwLCBsb246IC01LjU0NzEsIG5hbWVfZW46ICdZYW1vdXNzb3Vrcm8nLCBuYW1lX3poOiAn5Lqa56mG6IuP5YWL572XJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQ0lWJyB9LCAvLyBDw7R0ZSBkJ0l2b2lyZQ0KeyBsYXQ6IDUuNjAzNywgbG9uOiAtMC4xODcwLCBuYW1lX2VuOiAnQWNjcmEnLCBuYW1lX3poOiAn6Zi/5YWL5ouJJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnR0hBJyB9LCAvLyBHaGFuYQ0KDQoNCg0KLy8gLS0tIOS6mua0summlumDvSAtLS0NCnsgbGF0OiAzNC41NTUzLCBsb246IDY5LjIwNzUsIG5hbWVfZW46ICdLYWJ1bCcsIG5hbWVfemg6ICflloDluIPlsJQnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdBRkcnIH0sIC8vIEFmZ2hhbmlzdGFuDQp7IGxhdDogNDAuMTc5MiwgbG9uOiA0NC40OTkxLCBuYW1lX2VuOiAnWWVyZXZhbicsIG5hbWVfemg6ICfln4Pph4zmuKknLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdBUk0nIH0sIC8vIEFybWVuaWENCnsgbGF0OiA0MC40MDkzLCBsb246IDQ5Ljg2NzEsIG5hbWVfZW46ICdCYWt1JywgbmFtZV96aDogJ+W3tOW6kycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0FaRScgfSwgLy8gQXplcmJhaWphbg0KeyBsYXQ6IDI2LjIyODUsIGxvbjogNTAuNTg2MCwgbmFtZV9lbjogJ01hbmFtYScsIG5hbWVfemg6ICfpuqbnurPpuqYnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdCSFInIH0sIC8vIEJhaHJhaW4NCnsgbGF0OiAyMy44MTAzLCBsb246IDkwLjQxMjUsIG5hbWVfZW46ICdEaGFrYScsIG5hbWVfemg6ICfovr7ljaEnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdCR0QnIH0sIC8vIEJhbmdsYWRlc2gNCnsgbGF0OiAyNy40NzI4LCBsb246IDg5LjYzOTAsIG5hbWVfZW46ICdUaGltcGh1JywgbmFtZV96aDogJ+W7t+W4gycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0JUTicgfSwgLy8gQmh1dGFuDQp7IGxhdDogNC45MDMxLCBsb246IDExNC45Mzk4LCBuYW1lX2VuOiAnQmFuZGFyIFNlcmkgQmVnYXdhbicsIG5hbWVfemg6ICfmlq/ph4zlt7TliqDmub7luIInLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdCUk4nIH0sIC8vIEJydW5laQ0KeyBsYXQ6IDEyLjU2NTcsIGxvbjogMTA0Ljk5MTAsIG5hbWVfZW46ICdQaG5vbSBQZW5oJywgbmFtZV96aDogJ+mHkei+uScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0tITScgfSwgLy8gQ2FtYm9kaWENCnsgbGF0OiAzNS4xNzk2LCBsb246IDMzLjM4MjMsIG5hbWVfZW46ICdOaWNvc2lhJywgbmFtZV96aDogJ+WwvOenkeilv+S6micsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NZUCcgfSwgLy8gQ3lwcnVzDQp7IGxhdDogNDEuNzE1MSwgbG9uOiA0NC44MjcxLCBuYW1lX2VuOiAnVGJpbGlzaScsIG5hbWVfemg6ICfnrKzmr5TliKnmlq8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdHRU8nIH0sIC8vIEdlb3JnaWENCnsgbGF0OiAyOC42MTM5LCBsb246IDc3LjIwOTAsIG5hbWVfZW46ICdOZXcgRGVsaGknLCBuYW1lX3poOiAn5paw5b636YeMJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnSU5EJyB9LCAvLyBJbmRpYQ0KeyBsYXQ6IC02LjIwODgsIGxvbjogMTA2Ljg0NTYsIG5hbWVfZW46ICdKYWthcnRhJywgbmFtZV96aDogJ+mbheWKoOi+vicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0lETicgfSwgLy8gSW5kb25lc2lhDQp7IGxhdDogMzUuNjg5MiwgbG9uOiA1MS4zODkwLCBuYW1lX2VuOiAnVGVocmFuJywgbmFtZV96aDogJ+W+t+m7keWFsCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0lSTicgfSwgLy8gSXJhbg0KeyBsYXQ6IDMzLjMxNTIsIGxvbjogNDQuMzY2MSwgbmFtZV9lbjogJ0JhZ2hkYWQnLCBuYW1lX3poOiAn5be05qC86L6+JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnSVJRJyB9LCAvLyBJcmFxDQp7IGxhdDogMzEuNzY4MywgbG9uOiAzNS4yMTM3LCBuYW1lX2VuOiAnSmVydXNhbGVtJywgbmFtZV96aDogJ+iAtui3r+aSkuWGtycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0lTUicgfSwgLy8gSXNyYWVs77yI5Zu96ZmF5LqJ6K6u77yJDQp7IGxhdDogMzUuNjg5NSwgbG9uOiAxMzkuNjkxNywgbmFtZV9lbjogJ1Rva3lvJywgbmFtZV96aDogJ+S4nOS6rCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0pQTicgfSwgLy8gSmFwYW4NCnsgbGF0OiAzMS45NjMyLCBsb246IDM1LjkzMDQsIG5hbWVfZW46ICdBbW1hbicsIG5hbWVfemg6ICflronmm7wnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdKT1InIH0sIC8vIEpvcmRhbg0KeyBsYXQ6IDUxLjE2OTQsIGxvbjogNzEuNDQ5MSwgbmFtZV9lbjogJ0FzdGFuYScsIG5hbWVfemg6ICfpmL/mlq/loZTnurMnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdLQVonIH0sIC8vIEthemFraHN0YW7vvIjlt7LmgaLlpI1Bc3RhbmHvvIkNCnsgbGF0OiAyOS4zNzU5LCBsb246IDQ3Ljk3NzQsIG5hbWVfZW46ICdLdXdhaXQgQ2l0eScsIG5hbWVfemg6ICfnp5HlqIHnibnln44nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdLV1QnIH0sIC8vIEt1d2FpdA0KeyBsYXQ6IDQyLjg3NDYsIGxvbjogNzQuNjEyMiwgbmFtZV9lbjogJ0Jpc2hrZWsnLCBuYW1lX3poOiAn5q+U5LuA5Yev5YWLJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnS0daJyB9LCAvLyBLeXJneXpzdGFuDQp7IGxhdDogMTcuOTc1NywgbG9uOiAxMDIuNjMzMSwgbmFtZV9lbjogJ1ZpZW50aWFuZScsIG5hbWVfemg6ICfkuIfosaEnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdMQU8nIH0sIC8vIExhb3MNCnsgbGF0OiAzMy44OTM4LCBsb246IDM1LjUwMTgsIG5hbWVfZW46ICdCZWlydXQnLCBuYW1lX3poOiAn6LSd6bKB54m5JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTEJOJyB9LCAvLyBMZWJhbm9uDQp7IGxhdDogMy4xMzkwLCBsb246IDEwMS42ODY5LCBuYW1lX2VuOiAnS3VhbGEgTHVtcHVyJywgbmFtZV96aDogJ+WQiemahuWdoScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ01ZUycgfSwgLy8gTWFsYXlzaWENCnsgbGF0OiA0LjE3NTUsIGxvbjogNzMuNTA5MywgbmFtZV9lbjogJ01hbMOpJywgbmFtZV96aDogJ+mprOe0rycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ01EVicgfSwgLy8gTWFsZGl2ZXMNCnsgbGF0OiA0Ny44ODY0LCBsb246IDEwNi45MDU3LCBuYW1lX2VuOiAnVWxhYW5iYWF0YXInLCBuYW1lX3poOiAn5LmM5YWw5be05omYJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTU5HJyB9LCAvLyBNb25nb2xpYQ0KeyBsYXQ6IDIxLjkxNjIsIGxvbjogOTUuOTU2MCwgbmFtZV9lbjogJ05heXB5aWRhdycsIG5hbWVfemg6ICflhoXmr5Tpg70nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNTVInIH0sIC8vIE15YW5tYXINCnsgbGF0OiAyNy43MTcyLCBsb246IDg1LjMyNDAsIG5hbWVfZW46ICdLYXRobWFuZHUnLCBuYW1lX3poOiAn5Yqg5b635ruh6YO9JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTlBMJyB9LCAvLyBOZXBhbA0KeyBsYXQ6IDM5LjAzOTIsIGxvbjogMTI1Ljc2MjUsIG5hbWVfZW46ICdQeW9uZ3lhbmcnLCBuYW1lX3poOiAn5bmz5aOkJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnUFJLJyB9LCAvLyBOb3J0aCBLb3JlYQ0KeyBsYXQ6IDM3LjU2NjUsIGxvbjogMTI2Ljk3ODAsIG5hbWVfZW46ICdTZW91bCcsIG5hbWVfemg6ICfpppblsJQnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdLT1InIH0sIC8vIFNvdXRoIEtvcmVhDQp7IGxhdDogMjMuNjEzOSwgbG9uOiA1OC41OTIyLCBuYW1lX2VuOiAnTXVzY2F0JywgbmFtZV96aDogJ+mprOaWr+WWgOeJuScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ09NTicgfSwgLy8gT21hbg0KeyBsYXQ6IDMzLjY4NDQsIGxvbjogNzMuMDQ3OSwgbmFtZV9lbjogJ0lzbGFtYWJhZCcsIG5hbWVfemg6ICfkvIrmlq/lhbDloKEnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdQQUsnIH0sIC8vIFBha2lzdGFuDQp7IGxhdDogMTQuNTk5NSwgbG9uOiAxMjAuOTg0MiwgbmFtZV9lbjogJ01hbmlsYScsIG5hbWVfemg6ICfpqazlsLzmi4knLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdQSEwnIH0sIC8vIFBoaWxpcHBpbmVzDQp7IGxhdDogMjUuMjg1NCwgbG9uOiA1MS41MzEwLCBuYW1lX2VuOiAnRG9oYScsIG5hbWVfemg6ICflpJrlk4gnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdRQVQnIH0sIC8vIFFhdGFyDQp7IGxhdDogMjQuNzEzNiwgbG9uOiA0Ni42NzUzLCBuYW1lX2VuOiAnUml5YWRoJywgbmFtZV96aDogJ+WIqembheW+lycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1NBVScgfSwgLy8gU2F1ZGkgQXJhYmlhDQp7IGxhdDogMS4zNTIxLCBsb246IDEwMy44MTk4LCBuYW1lX2VuOiAnU2luZ2Fwb3JlJywgbmFtZV96aDogJ+aWsOWKoOWdoScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1NHUCcgfSwgLy8gU2luZ2Fwb3JlDQp7IGxhdDogNi45MjcxLCBsb246IDc5Ljg2MTIsIG5hbWVfZW46ICdDb2xvbWJvJywgbmFtZV96aDogJ+enkeS8puWdoScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0xLQScgfSwgLy8gU3JpIExhbmthDQp7IGxhdDogMzMuNTEzOCwgbG9uOiAzNi4yNzY1LCBuYW1lX2VuOiAnRGFtYXNjdXMnLCBuYW1lX3poOiAn5aSn6ams5aOr6Z2pJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnU1lSJyB9LCAvLyBTeXJpYQ0KeyBsYXQ6IDI0LjE0NzcsIGxvbjogMTIwLjY3MzYsIG5hbWVfZW46ICdUYWlwZWknLCBuYW1lX3poOiAn5Y+w5YyXJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnVFdOJyB9LCAvLyBUYWl3YW4NCnsgbGF0OiAzOC41NTk4LCBsb246IDY4Ljc4NzAsIG5hbWVfZW46ICdEdXNoYW5iZScsIG5hbWVfemg6ICfmnZzlsJrliKsnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdUSksnIH0sIC8vIFRhamlraXN0YW4NCnsgbGF0OiAxMy43NTYzLCBsb246IDEwMC41MDE4LCBuYW1lX2VuOiAnQmFuZ2tvaycsIG5hbWVfemg6ICfmm7zosLcnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdUSEEnIH0sIC8vIFRoYWlsYW5kDQp7IGxhdDogLTguNTU2OSwgbG9uOiAxMjUuNTYwMywgbmFtZV9lbjogJ0RpbGknLCBuYW1lX3poOiAn5bid5YqbJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnVExTJyB9LCAvLyBUaW1vci1MZXN0ZQ0KeyBsYXQ6IDM5LjkzMzQsIGxvbjogMzIuODU5NywgbmFtZV9lbjogJ0Fua2FyYScsIG5hbWVfemg6ICflronljaHmi4knLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdUVVInIH0sIC8vIFR1cmtleQ0KeyBsYXQ6IDM3Ljk2MDEsIGxvbjogNTguMzI2MSwgbmFtZV9lbjogJ0FzaGdhYmF0JywgbmFtZV96aDogJ+mYv+S7gOWTiOW3tOW+tycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1RLTScgfSwgLy8gVHVya21lbmlzdGFuDQp7IGxhdDogMjQuNDUzOSwgbG9uOiA1NC4zNzczLCBuYW1lX2VuOiAnQWJ1IERoYWJpJywgbmFtZV96aDogJ+mYv+W4g+aJjuavlCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0FSRScgfSwgLy8gVW5pdGVkIEFyYWIgRW1pcmF0ZXMNCnsgbGF0OiA0MS4yOTk1LCBsb246IDY5LjI0MDEsIG5hbWVfZW46ICdUYXNoa2VudCcsIG5hbWVfemg6ICfloZTku4DlubInLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdVWkInIH0sIC8vIFV6YmVraXN0YW4NCnsgbGF0OiAyMS4wMjg1LCBsb246IDEwNS44NTQyLCBuYW1lX2VuOiAnSGFub2knLCBuYW1lX3poOiAn5rKz5YaFJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnVk5NJyB9LCAvLyBWaWV0bmFtDQp7IGxhdDogMTUuMzY5NCwgbG9uOiA0NC4xOTEwLCBuYW1lX2VuOiAiU2FuYSdhIiwgbmFtZV96aDogJ+iQqOmCoycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1lFTScgfSwgLy8gWWVtZW4NCnsgbGF0OiA1NS43NTU4LCBsb246IDM3LjYxNzMsIG5hbWVfZW46ICdNb3Njb3cnLCBuYW1lX3poOiAn6I6r5pav56eRJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnUlVTJyB9LCAvLyBSdXNzaWHvvIjlnLDot6jmrKfkuprvvIzkuprmtLLpg6jliIbluLjop4TorqHlhaXvvIkNCg0KICAvLyAtLS0g5aSn5rSL5rSy6aaW6YO9IC0tLQ0KICB7IGxhdDogLTkuNDQzOCwgbG9uOiAxNDcuMTgwMywgbmFtZV9lbjogJ1BvcnQgTW9yZXNieScsIG5hbWVfemg6ICfojqvlsJTlhbnmr5TmuK8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdQTkcnIH0sIC8vIFBhcHVhIE5ldyBHdWluZWENCiAgeyBsYXQ6IC04LjUxODgsIGxvbjogMTc5LjE5ODMsIG5hbWVfZW46ICdGdW5hZnV0aScsIG5hbWVfemg6ICflr4znurPlr4zmj5AnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdUVVYnIH0sIC8vIFR1dmFsdQ0KICB7IGxhdDogLTEzLjgzMzMsIGxvbjogLTE3MS43NjY3LCBuYW1lX2VuOiAnQXBpYScsIG5hbWVfemg6ICfpmL/nmq7kuponLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdXU00nIH0sIC8vIFNhbW9hDQogIHsgbGF0OiAtMjEuMjA3OCwgbG9uOiAtMTc1LjE5ODIsIG5hbWVfZW46ICdOdWt1XCdhbG9mYScsIG5hbWVfemg6ICfliqrlupPpmL/mtJvms5UnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdUT04nIH0sIC8vIFRvbmdhDQogIHsgbGF0OiA3LjQyNTUsIGxvbjogMTUxLjg1LCBuYW1lX2VuOiAnUGFsaWtpcicsIG5hbWVfemg6ICfluJXliKnln7rlsJQnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdGU00nIH0sIC8vIE1pY3JvbmVzaWENCiAgeyBsYXQ6IC05LjUzMSwgbG9uOiAxNTkuOTUsIG5hbWVfZW46ICdIb25pYXJhJywgbmFtZV96aDogJ+mcjeWwvOS6muaLiScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1NMQicgfSwgLy8gU29sb21vbiBJc2xhbmRzDQogIHsgbGF0OiAtMTUuNDgzLCBsb246IDE2Ni45NSwgbmFtZV9lbjogJ1BvcnQgVmlsYScsIG5hbWVfemg6ICfnu7Tmi4nmuK8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdWVVQnIH0sIC8vIFZhbnVhdHUNCiAgeyBsYXQ6IDcuMTE2LCBsb246IDE3MS4zODMsIG5hbWVfZW46ICdNYWp1cm8nLCBuYW1lX3poOiAn6ams5pyx572XJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTUhMJyB9LCAvLyBNYXJzaGFsbCBJc2xhbmRzDQogIHsgbGF0OiAwLjUyMiwgbG9uOiAxNjYuOTMxLCBuYW1lX2VuOiAnWWFyZW4nLCBuYW1lX3poOiAn5Lqa5LymJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTlJVJyB9LCAvLyBOYXVydQ0KICB7IGxhdDogLTAuMjE2LCBsb246IDE3My4xNSwgbmFtZV9lbjogJ1NvdXRoIFRhcmF3YScsIG5hbWVfemg6ICfljZfloZTmi4nnk6YnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdLSVInIH0sIC8vIEtpcmliYXRpDQogIHsgbGF0OiA3LjQyNTUsIGxvbjogMTM0LjQ3NSwgbmFtZV9lbjogJ05nZXJ1bG11ZCcsIG5hbWVfemg6ICfmganlkInpsoHnqYblvrcnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdQTFcnIH0sIC8vIFBhbGF1DQoNCiAgICAvLyAtLS0g5qyn5rSy6aaW6YO9IC0tLQ0KICB7IGxhdDogNDEuMzI3NSwgbG9uOiAxOS44MTg3LCBuYW1lX2VuOiAnVGlyYW5hJywgbmFtZV96aDogJ+WcsOaLiemCoycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0FMQicgfSwNCiAgeyBsYXQ6IDQyLjY2MjksIGxvbjogMjEuMTY1NSwgbmFtZV9lbjogJ1ByaXN0aW5hJywgbmFtZV96aDogJ+aZrumHjOS7gOiSgue6sycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0tPUycgfSwNCiAgeyBsYXQ6IDQ4LjIwODIsIGxvbjogMTYuMzczOCwgbmFtZV9lbjogJ1ZpZW5uYScsIG5hbWVfemg6ICfnu7TkuZ/nurMnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdBVVQnIH0sDQogIHsgbGF0OiA1My45MDQ1LCBsb246IDI3LjU2MTUsIG5hbWVfZW46ICdNaW5zaycsIG5hbWVfemg6ICfmmI7mlq/lhYsnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdCTFInIH0sDQogIHsgbGF0OiA0My44NTYzLCBsb246IDE4LjQxMzEsIG5hbWVfZW46ICdTYXJhamV2bycsIG5hbWVfemg6ICfokKjmi4nng63nqp0nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdCSUgnIH0sDQogIHsgbGF0OiA0Mi42OTc3LCBsb246IDIzLjMyMTksIG5hbWVfZW46ICdTb2ZpYScsIG5hbWVfemg6ICfntKLpnZ7kuponLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdCR1InIH0sDQogIHsgbGF0OiA0NS44MTUwLCBsb246IDE1Ljk4MTksIG5hbWVfZW46ICdaYWdyZWInLCBuYW1lX3poOiAn6JCo5qC85YuS5biDJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnSFJWJyB9LA0KICB7IGxhdDogNTAuMDc1NSwgbG9uOiAxNC40Mzc4LCBuYW1lX2VuOiAnUHJhZ3VlJywgbmFtZV96aDogJ+W4g+aLieagvCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NaRScgfSwNCiAgeyBsYXQ6IDU1LjY3NjEsIGxvbjogMTIuNTY4MywgbmFtZV9lbjogJ0NvcGVuaGFnZW4nLCBuYW1lX3poOiAn5ZOl5pys5ZOI5qC5JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnRE5LJyB9LA0KICB7IGxhdDogNTkuNDM3MCwgbG9uOiAyNC43NTM2LCBuYW1lX2VuOiAnVGFsbGlubicsIG5hbWVfemg6ICfloZTmnpcnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdFU1QnIH0sDQogIHsgbGF0OiA2MC4xNjk5LCBsb246IDI0LjkzODQsIG5hbWVfZW46ICdIZWxzaW5raScsIG5hbWVfemg6ICfotavlsJTovpvln7onLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdGSU4nIH0sDQogIHsgbGF0OiAzNy45ODM4LCBsb246IDIzLjcyNzUsIG5hbWVfZW46ICdBdGhlbnMnLCBuYW1lX3poOiAn6ZuF5YW4JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnR1JDJyB9LA0KICB7IGxhdDogNjQuMTQ2NiwgbG9uOiAtMjEuOTQyNiwgbmFtZV9lbjogJ1JleWtqYXZpaycsIG5hbWVfemg6ICfpm7flhYvpm4XmnKrlhYsnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdJU0wnIH0sDQogIHsgbGF0OiA1Ni45NDk2LCBsb246IDI0LjEwNTIsIG5hbWVfZW46ICdSaWdhJywgbmFtZV96aDogJ+mHjOWKoCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0xWQScgfSwNCiAgeyBsYXQ6IDQ3LjAxNjksIGxvbjogOS41MjI4LCBuYW1lX2VuOiAnVmFkdXonLCBuYW1lX3poOiAn55Om5p2c5YW5JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTElFJyB9LA0KICB7IGxhdDogNTQuNjg3MiwgbG9uOiAyNS4yNzk3LCBuYW1lX2VuOiAnVmlsbml1cycsIG5hbWVfemg6ICfnu7TlsJTnur3mlq8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdMVFUnIH0sDQogIHsgbGF0OiA0OS42MTE2LCBsb246IDYuMTMxOSwgbmFtZV9lbjogJ0x1eGVtYm91cmcnLCBuYW1lX3poOiAn5Y2i5qOu5aChJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTFVYJyB9LA0KICB7IGxhdDogMzUuODk4OSwgbG9uOiAxNC41MTQ2LCBuYW1lX2VuOiAnVmFsbGV0dGEnLCBuYW1lX3poOiAn55Om6I6x5aGUJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTUxUJyB9LA0KICB7IGxhdDogNDcuMDcwNywgbG9uOiAyOC44NjM4LCBuYW1lX2VuOiAnQ2hpyJlpbsSDdScsIG5hbWVfemg6ICfln7rluIzorrfkuYwnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNREEnIH0sDQogIHsgbGF0OiA0My4xNzc3LCBsb246IDE5LjI2MywgbmFtZV9lbjogJ1BvZGdvcmljYScsIG5hbWVfemg6ICfms6LlvrfmiIjph4zlr58nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNTkUnIH0sDQogIHsgbGF0OiA0Mi4wOTgzLCBsb246IDIxLjQzMTQsIG5hbWVfZW46ICdTa29wamUnLCBuYW1lX3poOiAn5pav56eR5pmu6YeMJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTUtEJyB9LA0KICB7IGxhdDogNTkuOTEzOSwgbG9uOiAxMC43NTIyLCBuYW1lX2VuOiAnT3NsbycsIG5hbWVfemg6ICflpaXmlq/pmYYnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdOT1InIH0sDQogIHsgbGF0OiAzOC43MjIzLCBsb246IC05LjEzOTMsIG5hbWVfZW46ICdMaXNib24nLCBuYW1lX3poOiAn6YeM5pav5pysJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnUFJUJyB9LA0KICB7IGxhdDogNDQuNzg2NiwgbG9uOiAyMC40NDg5LCBuYW1lX2VuOiAnQmVsZ3JhZGUnLCBuYW1lX3poOiAn6LSd5bCU5qC86I6x5b63JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnU1JCJyB9LA0KICB7IGxhdDogNDYuMDU2OSwgbG9uOiAxNC41MDU4LCBuYW1lX2VuOiAnTGp1YmxqYW5hJywgbmFtZV96aDogJ+WNouW4g+WwlOmbhemCoycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1NWTicgfSwNCiAgeyBsYXQ6IDU5LjMyOTMsIGxvbjogMTguMDY4NiwgbmFtZV9lbjogJ1N0b2NraG9sbScsIG5hbWVfemg6ICfmlq/lvrflk6XlsJTmkaknLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdTV0UnIH0sDQp7IGxhdDogNDIuNTA2MywgbG9uOiAxLjUyMTgsIG5hbWVfZW46ICdBbmRvcnJhIGxhIFZlbGxhJywgbmFtZV96aDogJ+WuiemBk+WwlOWfjicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0FORCcgfSwNCiAgeyBsYXQ6IDUwLjg1MDMsIGxvbjogNC4zNTE3LCBuYW1lX2VuOiAnQnJ1c3NlbHMnLCBuYW1lX3poOiAn5biD6bKB5aGe5bCUJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQkVMJyB9LA0KICB7IGxhdDogMzUuMTc5NiwgbG9uOiAzMy4zODIzLCBuYW1lX2VuOiAnTmljb3NpYScsIG5hbWVfemg6ICflsLznp5Hopb/kuponLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdDWVAnIH0sDQogIHsgbGF0OiA0OC44NTY2LCBsb246IDIuMzUyMiwgbmFtZV9lbjogJ1BhcmlzJywgbmFtZV96aDogJ+W3tOm7jicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0ZSQScgfSwNCiAgeyBsYXQ6IDUyLjUyMDAsIGxvbjogMTMuNDA1MCwgbmFtZV9lbjogJ0JlcmxpbicsIG5hbWVfemg6ICfmn4/mnpcnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdERVUnIH0sDQogIHsgbGF0OiA0Ny40OTc5LCBsb246IDE5LjA0MDIsIG5hbWVfZW46ICdCdWRhcGVzdCcsIG5hbWVfemg6ICfluIPovr7kvanmlq8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdIVU4nIH0sDQogIHsgbGF0OiA1My4zNDk4LCBsb246IC02LjI2MDMsIG5hbWVfZW46ICdEdWJsaW4nLCBuYW1lX3poOiAn6YO95p+P5p6XJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnSVJMJyB9LA0KICB7IGxhdDogNDEuOTAyOCwgbG9uOiAxMi40OTY0LCBuYW1lX2VuOiAnUm9tZScsIG5hbWVfemg6ICfnvZfpqawnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdJVEEnIH0sDQogIHsgbGF0OiA0My43Mzg0LCBsb246IDcuNDI0NiwgbmFtZV9lbjogJ01vbmFjbycsIG5hbWVfemg6ICfmkannurPlk6UnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNQ08nIH0sDQogIHsgbGF0OiA1Mi4zNjc2LCBsb246IDQuOTA0MSwgbmFtZV9lbjogJ0Ftc3RlcmRhbScsIG5hbWVfemg6ICfpmL/lp4bmlq/nibnkuLknLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdOTEQnIH0sDQogIHsgbGF0OiA1Mi4yMjk3LCBsb246IDIxLjAxMjIsIG5hbWVfZW46ICdXYXJzYXcnLCBuYW1lX3poOiAn5Y2O5rKZJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnUE9MJyB9LA0KICB7IGxhdDogNDQuNDI2OCwgbG9uOiAyNi4xMDI1LCBuYW1lX2VuOiAnQnVjaGFyZXN0JywgbmFtZV96aDogJ+W4g+WKoOWLkuaWr+eJuScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1JPVScgfSwNCiAgeyBsYXQ6IDQzLjkzNTYsIGxvbjogMTIuNDQ3MywgbmFtZV9lbjogJ1NhbiBNYXJpbm8nLCBuYW1lX3poOiAn5Zyj6ams5Yqb6K+6JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnU01SJyB9LA0KICB7IGxhdDogNDguMTQ4NiwgbG9uOiAxNy4xMDc3LCBuYW1lX2VuOiAnQnJhdGlzbGF2YScsIG5hbWVfemg6ICfluIPmi4nov6rmlq/mi4nlj5EnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdTVksnIH0sDQogIHsgbGF0OiA0MC40MTY4LCBsb246IC0zLjcwMzgsIG5hbWVfZW46ICdNYWRyaWQnLCBuYW1lX3poOiAn6ams5b636YeMJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnRVNQJyB9LA0KICB7IGxhdDogNDYuOTQ4MCwgbG9uOiA3LjQ0NzQsIG5hbWVfZW46ICdCZXJuJywgbmFtZV96aDogJ+S8r+WwlOWwvCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NIRScgfSwNCiAgeyBsYXQ6IDUwLjQ1MDEsIGxvbjogMzAuNTIzNCwgbmFtZV9lbjogJ0t5aXYnLCBuYW1lX3poOiAn5Z+66L6FJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnVUtSJyB9LA0KICB7IGxhdDogNTEuNTA3MiwgbG9uOiAtMC4xMjc2LCBuYW1lX2VuOiAnTG9uZG9uJywgbmFtZV96aDogJ+S8puaVpicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0dCUicgfSwNCiAgeyBsYXQ6IDQxLjkwMjksIGxvbjogMTIuNDUzNCwgbmFtZV9lbjogJ1ZhdGljYW4gQ2l0eScsIG5hbWVfemg6ICfmorXokoLlhojln44nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdWQVQnIH0sDQogIC8vIC0tLSDms5Xlm70gKOaJqeWFhSkgLSDpq5jph43opoHmgKcgLS0tDQogIHsgbGF0OiA0My4yOTY1LCBsb246IDUuMzY5OCwgbmFtZV9lbjogJ01hcnNlaWxsZScsIG5hbWVfemg6ICfpqazotZsnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdGUkEnIH0sDQogIHsgbGF0OiA0NS43NjQwLCBsb246IDQuODM1NywgbmFtZV9lbjogJ0x5b24nLCBuYW1lX3poOiAn6YeM5piCJywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnRlJBJyB9LA0KICB7IGxhdDogNDMuNzEwMiwgbG9uOiA3LjI2MjAsIG5hbWVfZW46ICdOaWNlJywgbmFtZV96aDogJ+WwvOaWrycsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ0ZSQScgfSwNCg0KICAvLyAtLS0g5b635Zu9ICjmianlhYUpIC0g6auY6YeN6KaB5oCnIC0tLQ0KICB7IGxhdDogNTMuNTUxMSwgbG9uOiA5Ljk5MzcsIG5hbWVfZW46ICdIYW1idXJnJywgbmFtZV96aDogJ+axieWgoScsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ0RFVScgfSwNCiAgeyBsYXQ6IDQ4LjEzNTEsIGxvbjogMTEuNTgyMCwgbmFtZV9lbjogJ011bmljaCcsIG5hbWVfemg6ICfmhZXlsLzpu5EnLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdERVUnIH0sDQogIHsgbGF0OiA1MC4xMTA5LCBsb246IDguNjgyMSwgbmFtZV9lbjogJ0ZyYW5rZnVydCcsIG5hbWVfemg6ICfms5XlhbDlhYvnpo8nLCBpbXBvcnRhbmNlOiAyLCBjb3VudHJ5X2NvZGU6ICdERVUnIH0sDQoNCiAgLy8gLS0tIOiLseWbvSAo5omp5YWFKSAtIOmrmOmHjeimgeaApyAtLS0NCiAgeyBsYXQ6IDUzLjQ4MDgsIGxvbjogLTIuMjQyNiwgbmFtZV9lbjogJ01hbmNoZXN0ZXInLCBuYW1lX3poOiAn5pu85b275pav54m5JywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnR0JSJyB9LA0KICB7IGxhdDogNTUuOTUzMywgbG9uOiAtMy4xODgzLCBuYW1lX2VuOiAnRWRpbmJ1cmdoJywgbmFtZV96aDogJ+eIseS4geWgoScsIGltcG9ydGFuY2U6IDIsIGNvdW50cnlfY29kZTogJ0dCUicgfSwNCiAgeyBsYXQ6IDUxLjQ4MTYsIGxvbjogLTMuMTc5MSwgbmFtZV9lbjogJ0NhcmRpZmYnLCBuYW1lX3poOiAn5Yqg55qE5aSrJywgaW1wb3J0YW5jZTogMiwgY291bnRyeV9jb2RlOiAnR0JSJyB9LA0KDQoNCg0KICAgIC8vIC0tLSDljJfnvo7mtLLpppbpg70gLS0tDQogIHsgbGF0OiAxNy4xMTY3LCBsb246IC02MS44NSwgbmFtZV9lbjogJ1N0LiBKb2huXCdzJywgbmFtZV96aDogJ+Wco+e6pue/sCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0FURycgfSwgLy8gQW50aWd1YSBhbmQgQmFyYnVkYQ0KICB7IGxhdDogMTMuMTA1OCwgbG9uOiAtNTkuNjEzMiwgbmFtZV9lbjogJ0JyaWRnZXRvd24nLCBuYW1lX3poOiAn5biD6YeM5aWH5pWmJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQlJCJyB9LCAvLyBCYXJiYWRvcw0KICB7IGxhdDogMTcuNDk3NSwgbG9uOiAtODguMTk3OCwgbmFtZV9lbjogJ0JlbG1vcGFuJywgbmFtZV96aDogJ+i0neWwlOiOq+a9mCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0JMWicgfSwgLy8gQmVsaXplDQogIHsgbGF0OiA5LjkyODEsIGxvbjogLTg0LjA5MDcsIG5hbWVfZW46ICdTYW4gSm9zw6knLCBuYW1lX3poOiAn5Zyj5L2V5aGeJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQ1JJJyB9LCAvLyBDb3N0YSBSaWNhDQogIHsgbGF0OiAyMy4xMTM2LCBsb246IC04Mi4zNjY2LCBuYW1lX2VuOiAnSGF2YW5hJywgbmFtZV96aDogJ+WTiOeTpumCoycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NVQicgfSwgLy8gQ3ViYQ0KICB7IGxhdDogMTUuMjgzMywgbG9uOiAtNjEuMzgzMywgbmFtZV9lbjogJ1Jvc2VhdScsIG5hbWVfemg6ICfnvZfntKInLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdETUEnIH0sIC8vIERvbWluaWNhDQogIHsgbGF0OiAxOC40ODYxLCBsb246IC02OS45MzEyLCBuYW1lX2VuOiAnU2FudG8gRG9taW5nbycsIG5hbWVfemg6ICflnKPlpJrmmI7lkIQnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdET00nIH0sIC8vIERvbWluaWNhbiBSZXB1YmxpYw0KICB7IGxhdDogMTMuNzk0MiwgbG9uOiAtODguODk2NywgbmFtZV9lbjogJ1NhbiBTYWx2YWRvcicsIG5hbWVfemg6ICflnKPokKjlsJTnk6blpJonLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdTTFYnIH0sIC8vIEVsIFNhbHZhZG9yDQogIHsgbGF0OiAxMi4wNSwgbG9uOiAtNjEuNzUsIG5hbWVfZW46ICdTdC4gR2VvcmdlXCdzJywgbmFtZV96aDogJ+Wco+S5lOayuycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0dSRCcgfSwgLy8gR3JlbmFkYQ0KICB7IGxhdDogMTQuNjM0OSwgbG9uOiAtOTAuNTA2OSwgbmFtZV9lbjogJ0d1YXRlbWFsYSBDaXR5JywgbmFtZV96aDogJ+WNseWcsOmprOaLieWfjicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0dUTScgfSwgLy8gR3VhdGVtYWxhDQogIHsgbGF0OiAxNC40OTc0LCBsb246IC04OS42MjM5LCBuYW1lX2VuOiAnVGVndWNpZ2FscGEnLCBuYW1lX3poOiAn54m55Y+k6KW/5Yqg5bCU5be0JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnSE5EJyB9LCAvLyBIb25kdXJhcw0KICB7IGxhdDogMTcuOTc1LCBsb246IC03Ni43OTQsIG5hbWVfZW46ICdLaW5nc3RvbicsIG5hbWVfemg6ICfph5Hmlq/mlaYnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdKQU0nIH0sIC8vIEphbWFpY2ENCiAgeyBsYXQ6IDEyLjE1MjIsIGxvbjogLTg2LjI2ODMsIG5hbWVfZW46ICdNYW5hZ3VhJywgbmFtZV96aDogJ+mprOmCo+eTnCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ05JQycgfSwgLy8gTmljYXJhZ3VhDQogIHsgbGF0OiA4Ljk4MjQsIGxvbjogLTc5LjUxOTksIG5hbWVfZW46ICdQYW5hbWEgQ2l0eScsIG5hbWVfemg6ICflt7Tmi7/pqazln44nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdQQU4nIH0sIC8vIFBhbmFtYQ0KICB7IGxhdDogMTcuMjkwMywgbG9uOiAtNjIuNzIzNywgbmFtZV9lbjogJ0Jhc3NldGVycmUnLCBuYW1lX3poOiAn5be05pav54m55bCUJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnS05BJyB9LCAvLyBTYWludCBLaXR0cyBhbmQgTmV2aXMNCiAgeyBsYXQ6IDE0LjAxMDEsIGxvbjogLTYwLjk4NywgbmFtZV9lbjogJ0Nhc3RyaWVzJywgbmFtZV96aDogJ+WNoeaWr+eJuemHjCcsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0xDQScgfSwgLy8gU2FpbnQgTHVjaWENCiAgeyBsYXQ6IDEzLjE1NiwgbG9uOiAtNTkuNjE3LCBuYW1lX2VuOiAnS2luZ3N0b3duJywgbmFtZV96aDogJ+mHkeaWr+aVpicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1ZDVCcgfSwgLy8gU2FpbnQgVmluY2VudCBhbmQgdGhlIEdyZW5hZGluZXMNCiAgeyBsYXQ6IDEwLjY0MywgbG9uOiAtNjEuMzk4LCBuYW1lX2VuOiAnUG9ydCBvZiBTcGFpbicsIG5hbWVfemg6ICfopb/nj63niZnmuK8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdUVE8nIH0sIC8vIFRyaW5pZGFkIGFuZCBUb2JhZ28NCg0KDQoNCi8vIC0tLSDljZfnvo7mtLLpppbpg70gLS0tDQogIHsgbGF0OiAtMzQuNjAzNywgbG9uOiAtNTguMzgxNiwgbmFtZV9lbjogJ0J1ZW5vcyBBaXJlcycsIG5hbWVfemg6ICfluIPlrpzor7rmlq/oib7liKnmlq8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdBUkcnIH0sIC8vIEFyZ2VudGluYQ0KICB7IGxhdDogLTE2LjUwMDAsIGxvbjogLTY4LjE1MDAsIG5hbWVfZW46ICdMYSBQYXogLyBTdWNyZScsIG5hbWVfemg6ICfmi4nlt7Tmlq8v6IuP5YWL6Zu3JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQk9MJyB9LCAvLyBCb2xpdmlhDQogIHsgbGF0OiAtMTUuNzk0MiwgbG9uOiAtNDcuODgyNSwgbmFtZV9lbjogJ0JyYXPDrWxpYScsIG5hbWVfemg6ICflt7Topb/liKnkuponLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdCUkEnIH0sIC8vIEJyYXppbA0KICB7IGxhdDogLTMzLjQ0ODksIGxvbjogLTcwLjY2OTMsIG5hbWVfZW46ICdTYW50aWFnbycsIG5hbWVfemg6ICflnKPlnLDkuprlk6UnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdDSEwnIH0sIC8vIENoaWxlDQogIHsgbGF0OiA0LjcxMTAsIGxvbjogLTc0LjA3MjEsIG5hbWVfZW46ICdCb2dvdMOhJywgbmFtZV96aDogJ+azouWTpeWkpycsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0NPTCcgfSwgLy8gQ29sb21iaWENCiAgeyBsYXQ6IC0yLjE4OTQsIGxvbjogLTc5Ljg4OSwgbmFtZV9lbjogJ1F1aXRvJywgbmFtZV96aDogJ+WfuuWkmicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0VDVScgfSwgLy8gRWN1YWRvcg0KICB7IGxhdDogNC44NiwgbG9uOiAtNTguOTMsIG5hbWVfZW46ICdHZW9yZ2V0b3duJywgbmFtZV96aDogJ+S5lOayu+aVpicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ0dVWScgfSwgLy8gR3V5YW5hDQogIHsgbGF0OiAtMjUuMjYzNywgbG9uOiAtNTcuNTc1OSwgbmFtZV9lbjogJ0FzdW5jacOzbicsIG5hbWVfemg6ICfkuprmnb7mo64nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdQUlknIH0sIC8vIFBhcmFndWF5DQogIHsgbGF0OiAtMTIuMDQ2NCwgbG9uOiAtNzcuMDQyOCwgbmFtZV9lbjogJ0xpbWEnLCBuYW1lX3poOiAn5Yip6amsJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnUEVSJyB9LCAvLyBQZXJ1DQogIHsgbGF0OiAzLjg2NCwgbG9uOiAtNTUuMjAzLCBuYW1lX2VuOiAnUGFyYW1hcmlibycsIG5hbWVfemg6ICfluJXmi4npqazph4zljZonLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdTVVInIH0sIC8vIFN1cmluYW1lDQogIHsgbGF0OiAtMzQuOTAxMSwgbG9uOiAtNTYuMTY0NSwgbmFtZV9lbjogJ01vbnRldmlkZW8nLCBuYW1lX3poOiAn6JKZ5b6X57u055qE5LqaJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnVVJZJyB9LCAvLyBVcnVndWF5DQogIHsgbGF0OiAxMC40ODA2LCBsb246IC02Ni45MDM2LCBuYW1lX2VuOiAnQ2FyYWNhcycsIG5hbWVfemg6ICfliqDmi4nliqDmlq8nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdWRU4nIH0sIC8vIFZlbmV6dWVsYQ0KICB7IGxhdDogNC45MzgyLCBsb246IC01Mi4zMywgbmFtZV9lbjogJ0NheWVubmUnLCBuYW1lX3poOiAn5Y2h5a60JywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnR1VGJyB9LCAvLyBGcmVuY2ggR3VpYW5hDQoNCiAgeyBsYXQ6IDEyLjMwNSwgbG9uOiAtNjEuNDc4LCBuYW1lX2VuOiAnS2luZ3N0b3duJywgbmFtZV96aDogJ+mHkeaWr+aVpicsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1ZDVCcgfSwgLy8gU3QuIFZpbmNlbnQgJiBHcmVuYWRpbmVzDQogIHsgbGF0OiA0Mi41MDYzLCBsb246IDEuNTIxOCwgbmFtZV9lbjogJ0FuZG9ycmEgbGEgVmVsbGEnLCBuYW1lX3poOiAn5a6J6YGT5bCU5Z+OJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnQU5EJyB9LCAvLyBBbmRvcnJhDQogIHsgbGF0OiA0My43Mzg0LCBsb246IDcuNDI0NiwgbmFtZV9lbjogJ01vbmFjbycsIG5hbWVfemg6ICfmkannurPlk6UnLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdNQ08nIH0sIC8vIE1vbmFjbw0KICB7IGxhdDogNDMuOTM1NiwgbG9uOiAxMi40NDczLCBuYW1lX2VuOiAnU2FuIE1hcmlubycsIG5hbWVfemg6ICflnKPpqazlipvor7onLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdTTVInIH0sIC8vIFNhbiBNYXJpbm8NCiAgeyBsYXQ6IDQxLjkwMjksIGxvbjogMTIuNDUzNCwgbmFtZV9lbjogJ1ZhdGljYW4gQ2l0eScsIG5hbWVfemg6ICfmorXokoLlhojln44nLCBpbXBvcnRhbmNlOiAxLCBjb3VudHJ5X2NvZGU6ICdWQVQnIH0sIC8vIFZhdGljYW4gQ2l0eQ0KICAgIHsgbGF0OiAxOS40MzI2LCBsb246IC05OS4xMzMyLCBuYW1lX2VuOiAnTWV4aWNvIENpdHknLCBuYW1lX3poOiAn5aKo6KW/5ZOl5Z+OJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnTUVYJyB9LA0KICB7IGxhdDogNTIuMjI5NywgbG9uOiAyMS4wMTIyLCBuYW1lX2VuOiAnV2Fyc2F3JywgbmFtZV96aDogJ+WNjuaymScsIGltcG9ydGFuY2U6IDEsIGNvdW50cnlfY29kZTogJ1BPTCcgfSwNCiAgeyBsYXQ6IDUwLjQ1MDEsIGxvbjogMzAuNTIzNCwgbmFtZV9lbjogJ0t5aXYnLCBuYW1lX3poOiAn5Z+66L6FJywgaW1wb3J0YW5jZTogMSwgY291bnRyeV9jb2RlOiAnVUtSJyB9LA0KDQpdOw==", "./modules/scene.js": "data:text/javascript;base64,Ly8gbW9kdWxlcy9zY2VuZS5qcw0KLy8g6IGM6LSj77ya5Yid5aeL5YyWIFRocmVlLmpzIOWcuuaZr++8jOW5tuS7peS4gOS4queos+WumuOAgeWeguebtOeahOaWueW8j+e7hOijheWcsOeQg+S7quOAgg0KDQppbXBvcnQgKiBhcyBUSFJFRSBmcm9tICd0aHJlZSc7DQppbXBvcnQgeyBPcmJpdENvbnRyb2xzIH0gZnJvbSAnLi4vYXNzZXRzL2pzL09yYml0Q29udHJvbHMuanMnOw0KaW1wb3J0IHsgQXBwQ29uZmlnIH0gZnJvbSAnLi9jb25maWcuanMnOw0KaW1wb3J0IHsgY3JlYXRlR2xvYmVTdGFuZCB9IGZyb20gJy4vZ2xvYmUtc3RhbmQuanMnOw0KDQovLyAtLS0g5a+85Ye65qC45b+D5a+56LGhIC0tLQ0KZXhwb3J0IGNvbnN0IHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7DQpleHBvcnQgY29uc3QgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKDQ1LCAxLCAwLjEsIDEwMDApOw0KZXhwb3J0IGNvbnN0IHJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoeyBhbnRpYWxpYXM6IHRydWUsIGFscGhhOiB0cnVlIH0pOw0KZXhwb3J0IGNvbnN0IGNvbnRyb2xzID0gbmV3IE9yYml0Q29udHJvbHMoY2FtZXJhLCByZW5kZXJlci5kb21FbGVtZW50KTsNCmV4cG9ydCBsZXQgc3BoZXJlOw0KZXhwb3J0IGxldCBjbG91ZFNwaGVyZTsNCmV4cG9ydCBjb25zdCBFQVJUSF9SQURJVVMgPSAyOw0KDQovLyAtLS0g5a+85Ye65p2Q6LSo44CB6LS05Zu+5ZKM56iL5bqP6ZuGIC0tLQ0KZXhwb3J0IGxldCBlYXJ0aE1hdDsNCmV4cG9ydCBsZXQgZGF5VGV4dHVyZTsNCmV4cG9ydCBsZXQgbmlnaHRUZXh0dXJlOw0KZXhwb3J0IGxldCBhbWJpZW50TGlnaHQ7DQpleHBvcnQgbGV0IGdsb2JlQXNzZW1ibHk7DQpleHBvcnQgbGV0IHN0YW5kOw0KLy8gLS0tIOKYhSDmoLjlv4Pkv67mlLk6IOaWsOWinuW5tuWvvOWHuuemheWumuaooeW8j+eahOaAu+aOp+WItuWZqOe7hCAtLS0NCmV4cG9ydCBsZXQgemVuTWFzdGVyR3JvdXA7DQoNCi8vIC0tLSDliJ3lp4vljJblh73mlbAgLS0tDQpleHBvcnQgZnVuY3Rpb24gaW5pdFNjZW5lKCkgew0KICBjYW1lcmEucG9zaXRpb24uc2V0KDAsIDAsIDEwKTsNCg0KICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpOw0KICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKE1hdGgubWluKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDEsIDIpKTsNCiAgcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSA9IFRIUkVFLlNSR0JDb2xvclNwYWNlOw0KICByZW5kZXJlci50b25lTWFwcGluZyA9IFRIUkVFLkFDRVNGaWxtaWNUb25lTWFwcGluZzsNCiAgcmVuZGVyZXIudG9uZU1hcHBpbmdFeHBvc3VyZSA9IDEuMDsNCiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci5kb21FbGVtZW50KTsNCiAgcmVuZGVyZXIuZG9tRWxlbWVudC5jbGFzc0xpc3QuYWRkKCd3ZWJnbCcpOw0KDQogIC8vIC0tLSDlnLrmma/lhYnnhacgLS0tDQogIGFtYmllbnRMaWdodCA9IG5ldyBUSFJFRS5BbWJpZW50TGlnaHQoMHhmZmZmZmYsIEFwcENvbmZpZy5EQVlfTU9ERV9BTUJJRU5UX0xJR0hUKTsNCiAgc2NlbmUuYWRkKGFtYmllbnRMaWdodCk7DQogIGNvbnN0IG1haW5MaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAxLjApOw0KICBtYWluTGlnaHQucG9zaXRpb24uc2V0KDUsIDMsIDUpOw0KICBzY2VuZS5hZGQobWFpbkxpZ2h0KTsNCiAgY29uc3QgZmlsbExpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYsIDAuMyk7DQogIGZpbGxMaWdodC5wb3NpdGlvbi5zZXQoLTUsIDIsIC01KTsNCiAgc2NlbmUuYWRkKGZpbGxMaWdodCk7DQogIGNvbnN0IHJpbUxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYsIDAuNik7DQogIHJpbUxpZ2h0LnBvc2l0aW9uLnNldCgwLCAwLCAtOCk7DQogIHNjZW5lLmFkZChyaW1MaWdodCk7DQoNCiAgY29udHJvbHMuZW5hYmxlRGFtcGluZyA9IHRydWU7DQogIGNvbnRyb2xzLmRhbXBpbmdGYWN0b3IgPSAwLjA1Ow0KICBjb250cm9scy5lbmFibGVQYW4gPSBmYWxzZTsNCiAgY29udHJvbHMubWluRGlzdGFuY2UgPSAzLjA7DQogIGNvbnRyb2xzLm1heERpc3RhbmNlID0gMjAuMDsNCiAgY29udHJvbHMudGFyZ2V0LnNldCgwLCAwLCAwKTsNCiAgY29udHJvbHMudXBkYXRlKCk7DQoNCiAgY29uc3QgdGV4dHVyZUxvYWRlciA9IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCk7DQogIGRheVRleHR1cmUgPSB0ZXh0dXJlTG9hZGVyLmxvYWQoJy4vYXNzZXRzL2VhcnRoLWRhcmsuanBnJyk7DQogIG5pZ2h0VGV4dHVyZSA9IHRleHR1cmVMb2FkZXIubG9hZCgnLi9hc3NldHMvZWFydGhfbmlnaHRfY29udHJhc3Qud2VicCcpOw0KDQogIGVhcnRoTWF0ID0gbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsNCiAgICBtYXA6IGRheVRleHR1cmUsIG1ldGFsbmVzczogMC4wLCByb3VnaG5lc3M6IDAuOCwNCiAgfSk7DQoNCiAgZWFydGhNYXQub25CZWZvcmVDb21waWxlID0gKHNoYWRlcikgPT4gew0KICAgIHNoYWRlci51bmlmb3Jtcy5pc05pZ2h0TW9kZSA9IHsgdmFsdWU6IGZhbHNlIH07DQogICAgc2hhZGVyLnVuaWZvcm1zLm5pZ2h0QW1iaWVudCA9IHsgdmFsdWU6IDAuMCB9Ow0KICAgIHNoYWRlci51bmlmb3Jtcy5uaWdodEVtaXNzaXZlID0geyB2YWx1ZTogMC4wIH07DQogICAgc2hhZGVyLnVuaWZvcm1zLnROaWdodCA9IHsgdmFsdWU6IG5pZ2h0VGV4dHVyZSB9Ow0KICAgIHNoYWRlci52ZXJ0ZXhTaGFkZXIgPSAndmFyeWluZyB2ZWMyIHZVdjtcbicgKyBzaGFkZXIudmVydGV4U2hhZGVyLnJlcGxhY2UoJyNpbmNsdWRlIDx1dl92ZXJ0ZXg+JywgJyNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdHZVdiA9IHV2OycpOw0KICAgIHNoYWRlci5mcmFnbWVudFNoYWRlciA9ICd1bmlmb3JtIGJvb2wgaXNOaWdodE1vZGU7IHVuaWZvcm0gZmxvYXQgbmlnaHRBbWJpZW50OyB1bmlmb3JtIGZsb2F0IG5pZ2h0RW1pc3NpdmU7IHVuaWZvcm0gc2FtcGxlcjJEIHROaWdodDsgdmFyeWluZyB2ZWMyIHZVdjtcbicgKyBzaGFkZXIuZnJhZ21lbnRTaGFkZXI7DQogICAgc2hhZGVyLmZyYWdtZW50U2hhZGVyID0gc2hhZGVyLmZyYWdtZW50U2hhZGVyLnJlcGxhY2UoDQogICAgICAgICcjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PicsDQogICAgICAgIGAjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50Pg0KICAgICAgICBpZiAoaXNOaWdodE1vZGUpIHsNCiAgICAgICAgICB2ZWMzIG5pZ2h0Q29sb3IgPSB0ZXh0dXJlMkQodE5pZ2h0LCB2VXYpLnJnYjsNCiAgICAgICAgICB2ZWMzIGJhc2UgPSBuaWdodEFtYmllbnQgKiB2ZWMzKDAuMSwgMC4yLCAwLjMpOw0KICAgICAgICAgIGZsb2F0IGxpZ2h0TWFzayA9IHNtb290aHN0ZXAoMC4wNSwgMC4zLCBuaWdodENvbG9yLmcpOw0KICAgICAgICAgIHZlYzMgbGlnaHRzID0gbmlnaHRDb2xvciAqIGxpZ2h0TWFzayAqIG5pZ2h0RW1pc3NpdmU7DQogICAgICAgICAgZ2xfRnJhZ0NvbG9yID0gdmVjNChiYXNlICsgbGlnaHRzLCAxLjApOw0KICAgICAgICB9YA0KICAgICk7DQogICAgZWFydGhNYXQudXNlckRhdGEuc2hhZGVyID0gc2hhZGVyOw0KICB9Ow0KDQogIGNvbnN0IHNwaGVyZUdlb21ldHJ5ID0gbmV3IFRIUkVFLlNwaGVyZUdlb21ldHJ5KEVBUlRIX1JBRElVUywgNjQsIDY0KTsNCiAgc3BoZXJlID0gbmV3IFRIUkVFLk1lc2goc3BoZXJlR2VvbWV0cnksIGVhcnRoTWF0KTsNCiAgc3BoZXJlLm5hbWUgPSAnZWFydGhfc3BoZXJlJzsNCg0KICBjb25zdCBjbG91ZEdlb21ldHJ5ID0gbmV3IFRIUkVFLlNwaGVyZUdlb21ldHJ5KEVBUlRIX1JBRElVUyArIDAuMDUsIDY0LCA2NCk7DQogIGNsb3VkU3BoZXJlID0gbmV3IFRIUkVFLk1lc2goY2xvdWRHZW9tZXRyeSwgbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgYWxwaGFNYXA6IHRleHR1cmVMb2FkZXIubG9hZCgnLi9hc3NldHMvY2xvdWQud2VicCcpLCB0cmFuc3BhcmVudDogdHJ1ZSwgYmxlbmRpbmc6IFRIUkVFLkFkZGl0aXZlQmxlbmRpbmcsIGRlcHRoV3JpdGU6IGZhbHNlIH0pKTsNCiAgY2xvdWRTcGhlcmUubmFtZSA9ICdjbG91ZHMnOw0KICBjbG91ZFNwaGVyZS52aXNpYmxlID0gZmFsc2U7DQoNCiAgZ2xvYmVBc3NlbWJseSA9IG5ldyBUSFJFRS5Hcm91cCgpOw0KICBnbG9iZUFzc2VtYmx5LmFkZChzcGhlcmUpOw0KICBnbG9iZUFzc2VtYmx5LmFkZChjbG91ZFNwaGVyZSk7DQoNCiAgc3RhbmQgPSBjcmVhdGVHbG9iZVN0YW5kKHsgY29uZmlnOiBBcHBDb25maWcgfSk7DQogIHN0YW5kLnZpc2libGUgPSBmYWxzZTsNCg0KICAvLyDliJvlu7rnpoXlrprmqKHlvI/nmoTmgLvmjqfliLblmajvvIzlubbpu5jorqTmt7vliqDliLDlnLrmma/kuK3vvIjliJ3lp4vkuLrnqbrvvIkNCiAgemVuTWFzdGVyR3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsNCiAgemVuTWFzdGVyR3JvdXAubmFtZSA9ICd6ZW5fbWFzdGVyX2dyb3VwJzsNCiAgc2NlbmUuYWRkKHplbk1hc3Rlckdyb3VwKTsNCg0KICAvLyDpu5jorqTmg4XlhrXkuIvvvIzlnLDnkIPlkozlupXluqfov5jmmK/nm7TmjqXmt7vliqDliLDkuLvlnLrmma/kuK0NCiAgc2NlbmUuYWRkKGdsb2JlQXNzZW1ibHkpOw0KICBzY2VuZS5hZGQoc3RhbmQpOw0KDQogIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSk7DQogIG9uUmVzaXplKCk7DQp9DQoNCmZ1bmN0aW9uIG9uUmVzaXplKCkgew0KICBjb25zdCByZWN0ID0gcmVuZGVyZXIuZG9tRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgY2FtZXJhLmFzcGVjdCA9IHJlY3Qud2lkdGggLyByZWN0LmhlaWdodDsNCiAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsNCiAgcmVuZGVyZXIuc2V0U2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0LCBmYWxzZSk7DQp9", "./modules/geography.js": "data:text/javascript;base64,Ly8gbW9kdWxlcy9nZW9ncmFwaHkuanMNCi8vIOiBjOi0o++8muaPkOS+m+WfuuehgOeahOWcsOeQhuiuoeeul+WSjOWHoOS9leaehOW7uuWKn+iDveOAgg0KDQppbXBvcnQgKiBhcyBUSFJFRSBmcm9tICcuLi9hc3NldHMvanMvdGhyZWUubW9kdWxlLmpzJzsNCmltcG9ydCB7IEVBUlRIX1JBRElVUyB9IGZyb20gJy4vc2NlbmUuanMnOw0KDQovLyAtLS0g57uP57qs5bqm5LiO5LiJ57u05ZCR6YeP6L2s5o2iIC0tLQ0KZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRMYXRMb25Ub1ZlYzMobGF0LCBsb24sIHIgPSBFQVJUSF9SQURJVVMpIHsNCiAgY29uc3QgcGhpID0gKDkwIC0gbGF0KSAqIChNYXRoLlBJIC8gMTgwKTsNCiAgY29uc3QgdGhldGEgPSAobG9uICsgMTgwKSAqIChNYXRoLlBJIC8gMTgwKTsNCiAgY29uc3QgeCA9IC0ociAqIE1hdGguc2luKHBoaSkgKiBNYXRoLmNvcyh0aGV0YSkpOw0KICBjb25zdCB5ID0gciAqIE1hdGguY29zKHBoaSk7DQogIGNvbnN0IHogPSByICogTWF0aC5zaW4ocGhpKSAqIE1hdGguc2luKHRoZXRhKTsNCiAgcmV0dXJuIG5ldyBUSFJFRS5WZWN0b3IzKHgsIHksIHopOw0KfQ0KDQpleHBvcnQgZnVuY3Rpb24gY29udmVydFZlYzNUb0xhdExvbih2ZWN0b3IsIHJhZGl1cyA9IEVBUlRIX1JBRElVUykgew0KICBjb25zdCB5Y2xhbXBlZCA9IFRIUkVFLk1hdGhVdGlscy5jbGFtcCh2ZWN0b3IueSAvIHJhZGl1cywgLTEsIDEpOw0KICBjb25zdCBwaGkgPSBNYXRoLmFjb3MoeWNsYW1wZWQpOw0KICBjb25zdCB0aGV0YSA9IE1hdGguYXRhbjIodmVjdG9yLnosIC12ZWN0b3IueCk7DQogIGxldCBsb24gPSBUSFJFRS5NYXRoVXRpbHMucmFkVG9EZWcodGhldGEpIC0gMTgwOw0KICBsb24gPSAoKGxvbiArIDE4MCkgJSAzNjAgKyAzNjApICUgMzYwIC0gMTgwOw0KICBjb25zdCBsYXQgPSA5MCAtIFRIUkVFLk1hdGhVdGlscy5yYWRUb0RlZyhwaGkpOw0KICByZXR1cm4geyBsYXQsIGxvbiB9Ow0KfQ0KDQovLyAtLS0g5Zu95a626auY5Lqu5aGr5YWFIC0tLQ0KY29uc3QgSElHSExJR0hUX01BVCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7DQogIGNvbG9yOiAweGZmZmYwMCwgdHJhbnNwYXJlbnQ6IHRydWUsIG9wYWNpdHk6IDAuMjIsDQogIGRlcHRoVGVzdDogZmFsc2UsIGRlcHRoV3JpdGU6IGZhbHNlLCBzaWRlOiBUSFJFRS5Gcm9udFNpZGUNCn0pOw0KDQpmdW5jdGlvbiBtZXNoRnJvbVBvbHlnb24ocG9seSkgew0KICBjb25zdCBzaGFwZSA9IHNoYXBlRnJvbVBvbHlnb24ocG9seSk7DQogIGlmICghc2hhcGUpIHJldHVybiBudWxsOw0KICBjb25zdCBnZW9tID0gbmV3IFRIUkVFLlNoYXBlR2VvbWV0cnkoc2hhcGUpOw0KICBjb25zdCBwb3MgPSBnZW9tLmF0dHJpYnV0ZXMucG9zaXRpb247DQogIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zLmNvdW50OyBpKyspIHsNCiAgICBjb25zdCB2ID0gY29udmVydExhdExvblRvVmVjMyhwb3MuZ2V0WShpKSwgcG9zLmdldFgoaSksIEVBUlRIX1JBRElVUyArIDAuMDAwOCk7DQogICAgcG9zLnNldFhZWihpLCB2LngsIHYueSwgdi56KTsNCiAgfQ0KICBwb3MubmVlZHNVcGRhdGUgPSB0cnVlOw0KICBnZW9tLmNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCk7DQogIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tLCBISUdITElHSFRfTUFUKTsNCiAgbWVzaC5yZW5kZXJPcmRlciA9IDE7DQogIHJldHVybiBtZXNoOw0KfQ0KDQpmdW5jdGlvbiBzaGFwZUZyb21Qb2x5Z29uKHBvbHkpIHsNCiAgaWYgKCFwb2x5IHx8ICFwb2x5Lmxlbmd0aCkgcmV0dXJuIG51bGw7DQogIGNvbnN0IG91dGVyID0gdW53cmFwUmluZyhwb2x5WzBdKS5zbGljZSgpOw0KICBlbnN1cmVXaW5kaW5nQ0NXKG91dGVyKTsNCiAgY29uc3Qgc2hhcGUgPSBuZXcgVEhSRUUuU2hhcGUoKTsNCiAgbW92ZVBhdGgoc2hhcGUsIG91dGVyKTsNCiAgZm9yIChsZXQgaSA9IDE7IGkgPCBwb2x5Lmxlbmd0aDsgaSsrKSB7DQogICAgY29uc3QgaG9sZSA9IHVud3JhcFJpbmcocG9seVtpXSkuc2xpY2UoKTsNCiAgICBlbnN1cmVXaW5kaW5nQ1coaG9sZSk7DQogICAgY29uc3QgcGF0aCA9IG5ldyBUSFJFRS5QYXRoKCk7DQogICAgbW92ZVBhdGgocGF0aCwgaG9sZSk7DQogICAgc2hhcGUuaG9sZXMucHVzaChwYXRoKTsNCiAgfQ0KICByZXR1cm4gc2hhcGU7DQp9DQoNCmZ1bmN0aW9uIG1vdmVQYXRoKHBhdGgsIHJpbmcpIHsNCiAgaWYgKCFyaW5nLmxlbmd0aCkgcmV0dXJuOw0KICBwYXRoLm1vdmVUbyhyaW5nWzBdWzBdLCByaW5nWzBdWzFdKTsNCiAgZm9yIChsZXQgaSA9IDE7IGkgPCByaW5nLmxlbmd0aDsgaSsrKSBwYXRoLmxpbmVUbyhyaW5nW2ldWzBdLCByaW5nW2ldWzFdKTsNCn0NCg0KZnVuY3Rpb24gdW53cmFwUmluZyhyaW5nKSB7DQogIGlmICghcmluZyB8fCByaW5nLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdOw0KICBjb25zdCBvdXQgPSBbIHJpbmdbMF0uc2xpY2UoKSBdOw0KICBmb3IgKGxldCBpID0gMTsgaSA8IHJpbmcubGVuZ3RoOyBpKyspIHsNCiAgICBjb25zdCBwcmV2ID0gb3V0W2kgLSAxXVswXTsNCiAgICBsZXQgTCA9IHJpbmdbaV1bMF07DQogICAgd2hpbGUgKEwgLSBwcmV2ID4gMTgwKSAgTCAtPSAzNjA7DQogICAgd2hpbGUgKEwgLSBwcmV2IDwgLTE4MCkgTCArPSAzNjA7DQogICAgb3V0LnB1c2goW0wsIHJpbmdbaV1bMV1dKTsNCiAgfQ0KICByZXR1cm4gb3V0Ow0KfQ0KDQpmdW5jdGlvbiByaW5nQXJlYShyaW5nKSB7DQogIGxldCBzdW0gPSAwOw0KICBmb3IgKGxldCBpID0gMCwgbiA9IHJpbmcubGVuZ3RoLCBqID0gbiAtIDE7IGkgPCBuOyBqID0gaSsrKSB7DQogICAgc3VtICs9IChyaW5nW2pdWzBdICogcmluZ1tpXVsxXSAtIHJpbmdbaV1bMF0gKiByaW5nW2pdWzFdKTsNCiAgfQ0KICByZXR1cm4gc3VtIC8gMjsNCn0NCg0KZnVuY3Rpb24gZW5zdXJlV2luZGluZ0NDVyhyaW5nKSB7IGlmIChyaW5nQXJlYShyaW5nKSA8IDApIHJpbmcucmV2ZXJzZSgpOyB9DQpmdW5jdGlvbiBlbnN1cmVXaW5kaW5nQ1cgKHJpbmcpIHsgaWYgKHJpbmdBcmVhKHJpbmcpID4gMCkgcmluZy5yZXZlcnNlKCk7IH0NCg0KZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQ291bnRyeUZpbGxHcm91cChmZWF0dXJlKSB7DQogIGNvbnN0IGcgPSBmZWF0dXJlLmdlb21ldHJ5Ow0KICBjb25zdCBncm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOw0KICBpZiAoIWcpIHJldHVybiBncm91cDsNCiAgaWYgKGcudHlwZSA9PT0gJ1BvbHlnb24nKSB7DQogICAgY29uc3QgbWVzaCA9IG1lc2hGcm9tUG9seWdvbihnLmNvb3JkaW5hdGVzKTsNCiAgICBpZiAobWVzaCkgZ3JvdXAuYWRkKG1lc2gpOw0KICB9IGVsc2UgaWYgKGcudHlwZSA9PT0gJ011bHRpUG9seWdvbicpIHsNCiAgICBmb3IgKGNvbnN0IHBvbHkgb2YgZy5jb29yZGluYXRlcykgew0KICAgICAgY29uc3QgbWVzaCA9IG1lc2hGcm9tUG9seWdvbihwb2x5KTsNCiAgICAgIGlmIChtZXNoKSBncm91cC5hZGQobWVzaCk7DQogICAgfQ0KICB9DQogIGdyb3VwLnRyYXZlcnNlKG8gPT4geyBpZiAoby5pc01lc2gpIG8ucmVuZGVyT3JkZXIgPSAxOyB9KTsNCiAgcmV0dXJuIGdyb3VwOw0KfQ==", "./modules/features.js": "data:text/javascript;base64,Ly8gbW9kdWxlcy9mZWF0dXJlcy5qcw0KLy8g6IGM6LSj77ya5Zyo5Zyw55CD5LiK57uY5Yi25omA5pyJ5YW35L2T55qE44CB5aSn5Z6L55qE5Zyw55CG4oCc6KeG6KeJ54m55b6B4oCd77yM5aaC5Zu96ZmF5pel5pyf5Y+Y5pu057q/44CB5Zue5b2S57q/562J44CCDQoNCmltcG9ydCAqIGFzIFRIUkVFIGZyb20gJy4uL2Fzc2V0cy9qcy90aHJlZS5tb2R1bGUuanMnOw0KaW1wb3J0IHsgZ2xvYmVBc3NlbWJseSwgRUFSVEhfUkFESVVTIH0gZnJvbSAnLi9zY2VuZS5qcyc7DQppbXBvcnQgeyBjb252ZXJ0TGF0TG9uVG9WZWMzIH0gZnJvbSAnLi9nZW9ncmFwaHkuanMnOw0KDQovLyAtLS0g5a+85YWl55So5LqO57uY5Yi26auY57qn57q/5p2h55qE5qih5Z2XIC0tLQ0KaW1wb3J0IHsgTGluZTIgfSBmcm9tICcuLi9hc3NldHMvanMvbGluZXMvTGluZTIuanMnOw0KaW1wb3J0IHsgTGluZUdlb21ldHJ5IH0gZnJvbSAnLi4vYXNzZXRzL2pzL2xpbmVzL0xpbmVHZW9tZXRyeS5qcyc7DQppbXBvcnQgeyBMaW5lTWF0ZXJpYWwgfSBmcm9tICcuLi9hc3NldHMvanMvbGluZXMvTGluZU1hdGVyaWFsLmpzJzsNCg0KY29uc3QgdXBkYXRhYmxlTGluZU1hdGVyaWFscyA9IFtdOw0KZXhwb3J0IGNvbnN0IGdlb0xpbmVzR3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsNCmdlb0xpbmVzR3JvdXAubmFtZSA9ICdnZW9fbGluZXMnOw0KDQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4gew0KICBjb25zdCB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOw0KICBjb25zdCBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7DQogIGZvciAoY29uc3QgbWF0ZXJpYWwgb2YgdXBkYXRhYmxlTGluZU1hdGVyaWFscykgew0KICAgIG1hdGVyaWFsLnJlc29sdXRpb24uc2V0KHdpZHRoLCBoZWlnaHQpOw0KICB9DQp9KTsNCg0KDQpmdW5jdGlvbiBjcmVhdGVDaXJjdWxhckxpbmUobGF0LCBzdHlsZSkgew0KICAgIGNvbnN0IHBvaW50cyA9IFtdOw0KICAgIGNvbnN0IHNlZ21lbnRzID0gMTI4Ow0KICAgIGNvbnN0IHJhZGl1cyA9IEVBUlRIX1JBRElVUyArIDAuMDA1Ow0KDQogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gc2VnbWVudHM7IGkrKykgew0KICAgICAgICBjb25zdCBsb24gPSAtMTgwICsgKDM2MCAqIGkgLyBzZWdtZW50cyk7DQogICAgICAgIHBvaW50cy5wdXNoKGNvbnZlcnRMYXRMb25Ub1ZlYzMobGF0LCBsb24sIHJhZGl1cykpOw0KICAgIH0NCg0KICAgIGNvbnN0IHBvc2l0aW9ucyA9IHBvaW50cy5mbGF0TWFwKHAgPT4gW3AueCwgcC55LCBwLnpdKTsNCiAgICBjb25zdCBnZW9tZXRyeSA9IG5ldyBMaW5lR2VvbWV0cnkoKTsNCiAgICBnZW9tZXRyeS5zZXRQb3NpdGlvbnMocG9zaXRpb25zKTsNCg0KICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IExpbmVNYXRlcmlhbCh7DQogICAgICAgIGNvbG9yOiBzdHlsZS5jb2xvciwNCiAgICAgICAgbGluZXdpZHRoOiBzdHlsZS5saW5ld2lkdGgsDQogICAgICAgIGRhc2hlZDogc3R5bGUuZGFzaGVkLA0KICAgICAgICBkYXNoU2l6ZTogc3R5bGUuZGFzaFNpemUsDQogICAgICAgIGdhcFNpemU6IHN0eWxlLmdhcFNpemUsDQogICAgICAgIHRyYW5zcGFyZW50OiBzdHlsZS50cmFuc3BhcmVudCB8fCBmYWxzZSwgLy8g5bqU55So6YCP5piO6K6+572uDQogICAgICAgIG9wYWNpdHk6IHN0eWxlLm9wYWNpdHkgfHwgMS4wLCAgICAgICAgICAgLy8g5bqU55So5LiN6YCP5piO5bqmDQogICAgICAgIGJsZW5kaW5nOiBUSFJFRS5BZGRpdGl2ZUJsZW5kaW5nLCAgICAgICAgLy8g4piFIOaguOW/g+S/ruaUuSAjMTog5aKe5Yqg5Yqg6Imy5re35ZCI5qih5byP5Lul5Lqn55Sf6L6J5YWJ5oSfDQogICAgfSk7DQoNCiAgICBjb25zdCBsaW5lID0gbmV3IExpbmUyKGdlb21ldHJ5LCBtYXRlcmlhbCk7DQogICAgaWYgKHN0eWxlLmRhc2hlZCkgew0KICAgICAgbGluZS5jb21wdXRlTGluZURpc3RhbmNlcygpOw0KICAgIH0NCiAgICBsaW5lLnJlbmRlck9yZGVyID0gMzsNCg0KICAgIHVwZGF0YWJsZUxpbmVNYXRlcmlhbHMucHVzaChtYXRlcmlhbCk7DQoNCiAgICByZXR1cm4gbGluZTsNCn0NCg0KZnVuY3Rpb24gY3JlYXRlU3R5bGVkSURMKCkgew0KICBjb25zdCBpZGxQYXRoUG9pbnRzID0gWw0KICAgIFsxODAsIDkwXSwgWzE4MCwgNjZdLCBbLTE2OSwgNjZdLCBbLTE2OSwgNjBdLCBbMTgwLCA2MF0sIFsxODAsIDUxXSwNCiAgICBbLTE3MiwgNTFdLCBbLTE3MiwgNDVdLCBbMTgwLCA0NV0sIFsxODAsIDVdLCBbLTE1MCwgNV0sIFstMTUwLCAtMTBdLA0KICAgIFstMTcxLCAtMTBdLCBbLTE3MSwgLTE1XSwgWzE4MCwgLTE1XSwgWzE4MCwgLTU1XSwgWzE3MCwgLTU1XSwgWzE3MCwgLTYwXSwNCiAgICBbMTgwLCAtNjBdLCBbMTgwLCAtOTBdDQogIF07DQoNCiAgY29uc3QgdmVjdG9ycyA9IFtdOw0KICBjb25zdCByYWRpdXMgPSBFQVJUSF9SQURJVVMgKyAwLjAwNjsNCg0KICBmb3IgKGxldCBpID0gMDsgaSA8IGlkbFBhdGhQb2ludHMubGVuZ3RoIC0gMTsgaSsrKSB7DQogICAgY29uc3Qgc3RhcnQgPSBpZGxQYXRoUG9pbnRzW2ldOw0KICAgIGNvbnN0IGVuZCA9IGlkbFBhdGhQb2ludHNbaSsxXTsNCiAgICBsZXQgc3RhcnRMb24gPSBzdGFydFswXSwgZW5kTG9uID0gZW5kWzBdOw0KDQogICAgaWYgKGVuZExvbiAtIHN0YXJ0TG9uID4gMTgwKSBlbmRMb24gLT0gMzYwOw0KICAgIGlmIChlbmRMb24gLSBzdGFydExvbiA8IC0xODApIGVuZExvbiArPSAzNjA7DQoNCiAgICB2ZWN0b3JzLnB1c2goY29udmVydExhdExvblRvVmVjMyhzdGFydFsxXSwgc3RhcnRbMF0sIHJhZGl1cykpOw0KICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoTWF0aC5wb3coZW5kTG9uLXN0YXJ0TG9uLCAyKSArIE1hdGgucG93KGVuZFsxXS1zdGFydFsxXSwgMikpOw0KICAgIGNvbnN0IHNlZ21lbnRzID0gTWF0aC5tYXgoMiwgTWF0aC5mbG9vcihkaXN0IC8gNSkpOw0KDQogICAgZm9yIChsZXQgaiA9IDE7IGogPCBzZWdtZW50czsgaisrKSB7DQogICAgICBjb25zdCBsYXQgPSBzdGFydFsxXSArIChlbmRbMV0gLSBzdGFydFsxXSkgKiBqIC8gc2VnbWVudHM7DQogICAgICBjb25zdCBsb24gPSBzdGFydExvbiArIChlbmRMb24gLSBzdGFydExvbikgKiBqIC8gc2VnbWVudHM7DQogICAgICB2ZWN0b3JzLnB1c2goY29udmVydExhdExvblRvVmVjMyhsYXQsIGxvbiwgcmFkaXVzKSk7DQogICAgfQ0KICB9DQogIHZlY3RvcnMucHVzaChjb252ZXJ0TGF0TG9uVG9WZWMzKGlkbFBhdGhQb2ludHNbaWRsUGF0aFBvaW50cy5sZW5ndGgtMV1bMV0sIGlkbFBhdGhQb2ludHNbaWRsUGF0aFBvaW50cy5sZW5ndGgtMV1bMF0sIHJhZGl1cykpOw0KDQogIGNvbnN0IHBvc2l0aW9ucyA9IHZlY3RvcnMuZmxhdE1hcCh2ID0+IFt2LngsIHYueSwgdi56XSk7DQogIGNvbnN0IGdlb21ldHJ5ID0gbmV3IExpbmVHZW9tZXRyeSgpOw0KICBnZW9tZXRyeS5zZXRQb3NpdGlvbnMocG9zaXRpb25zKTsNCg0KICBjb25zdCBtYXRlcmlhbCA9IG5ldyBMaW5lTWF0ZXJpYWwoew0KICAgIGNvbG9yOiAweDg3Q0VFQiwNCiAgICBsaW5ld2lkdGg6IDEuMCwNCiAgICBkYXNoZWQ6IHRydWUsDQogICAgZGFzaFNpemU6IDAuMTIsDQogICAgZ2FwU2l6ZTogMC4wOCwNCiAgICBkYXNoU2NhbGU6IDAuNSwNCiAgICBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywgLy8g4piFIOaguOW/g+S/ruaUuSAjMTog5aKe5Yqg5Yqg6Imy5re35ZCI5qih5byP5Lul5Lqn55Sf6L6J5YWJ5oSfDQogIH0pOw0KDQogIHVwZGF0YWJsZUxpbmVNYXRlcmlhbHMucHVzaChtYXRlcmlhbCk7DQoNCiAgY29uc3QgaWRsTGluZSA9IG5ldyBMaW5lMihnZW9tZXRyeSwgbWF0ZXJpYWwpOw0KICBpZGxMaW5lLmNvbXB1dGVMaW5lRGlzdGFuY2VzKCk7DQogIGlkbExpbmUubmFtZSA9ICdpbnRlcmFjdGl2ZV9pZGxfbGluZSc7DQogIGlkbExpbmUucmVuZGVyT3JkZXIgPSAzOw0KICBnZW9MaW5lc0dyb3VwLmFkZChpZGxMaW5lKTsNCn0NCg0KZXhwb3J0IGZ1bmN0aW9uIGRyYXdHZW9GZWF0dXJlcygpIHsNCiAgZ2xvYmVBc3NlbWJseS5hZGQoZ2VvTGluZXNHcm91cCk7DQoNCiAgY29uc3QgZXF1YXRvclN0eWxlID0gew0KICAgIGNvbG9yOiAweERBQTUyMCwNCiAgICBsaW5ld2lkdGg6IDEuNSwNCiAgICBkYXNoZWQ6IGZhbHNlDQogIH07DQoNCiAgLy8gLS0tIOKYhSDmoLjlv4Pkv67mlLkgIzI6IOiwg+aVtOWbnuW9kue6v+agt+W8j++8jOS9v+WFtuWcqOato+W4uOaooeW8j+S4i+abtOa3oSAtLS0NCiAgY29uc3QgdHJvcGljU3R5bGUgPSB7DQogICAgY29sb3I6IDB4REFBNTIwLA0KICAgIGxpbmV3aWR0aDogMS4wLA0KICAgIGRhc2hlZDogdHJ1ZSwNCiAgICBkYXNoU2l6ZTogMC4wNCwNCiAgICBnYXBTaXplOiAwLjA0LA0KICAgIHRyYW5zcGFyZW50OiB0cnVlLCAvLyDlvIDlkK/pgI/mmI4NCiAgICBvcGFjaXR5OiAwLjYgICAgICAgLy8g6K6+572u5Li6NjAl5LiN6YCP5piO5bqmDQogIH07DQoNCiAgY29uc3QgZXF1YXRvciA9IGNyZWF0ZUNpcmN1bGFyTGluZSgwLCBlcXVhdG9yU3R5bGUpOw0KICBjb25zdCB0cm9waWNPZkNhbmNlciA9IGNyZWF0ZUNpcmN1bGFyTGluZSgyMy41LCB0cm9waWNTdHlsZSk7DQogIGNvbnN0IHRyb3BpY09mQ2Fwcmljb3JuID0gY3JlYXRlQ2lyY3VsYXJMaW5lKC0yMy41LCB0cm9waWNTdHlsZSk7DQoNCiAgZ2VvTGluZXNHcm91cC5hZGQoZXF1YXRvciwgdHJvcGljT2ZDYW5jZXIsIHRyb3BpY09mQ2Fwcmljb3JuKTsNCg0KICBjcmVhdGVTdHlsZWRJREwoKTsNCg0KICBjb25zdCB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOw0KICBjb25zdCBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7DQogIGZvciAoY29uc3QgbWF0ZXJpYWwgb2YgdXBkYXRhYmxlTGluZU1hdGVyaWFscykgew0KICAgIG1hdGVyaWFsLnJlc29sdXRpb24uc2V0KHdpZHRoLCBoZWlnaHQpOw0KICB9DQp9", "./modules/data.js": "data:text/javascript;base64,Ly8gbW9kdWxlcy9kYXRhLmpzDQovLyDogYzotKPvvJrliqDovb0gSlNPTiDmlbDmja7vvIzliJvlu7rlm73lrrbovrnnlYznur/lkozmoIfnrb7mlbDmja7nu5PmnoTjgIINCg0KaW1wb3J0ICogYXMgVEhSRUUgZnJvbSAnLi4vYXNzZXRzL2pzL3RocmVlLm1vZHVsZS5qcyc7IC8vIOKYhSDmoLjlv4Pkv67mraPvvJrkv67lpI3kuobplJnor6/nmoQgaW1wb3J0IOi3r+W+hA0KaW1wb3J0IHsgY29udmVydExhdExvblRvVmVjMyB9IGZyb20gJy4vZ2VvZ3JhcGh5LmpzJzsNCmltcG9ydCB7IEVBUlRIX1JBRElVUywgZ2xvYmVBc3NlbWJseSB9IGZyb20gJy4vc2NlbmUuanMnOw0KDQovLyAtLS0g5a+85Ye65pWw5o2u5a655ZmoIC0tLSAvLw0KZXhwb3J0IGNvbnN0IGxhYmVscyA9IFtdOw0KZXhwb3J0IGNvbnN0IGJvcmRlcnNHcm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOw0KZXhwb3J0IGNvbnN0IGZpbGxzR3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsNCmV4cG9ydCBjb25zdCBmaWxsQ2FjaGUgPSBuZXcgTWFwKCk7DQpleHBvcnQgbGV0IGV4dHJhRGF0YSA9IHt9Ow0KZXhwb3J0IGxldCBnZW9GZWF0dXJlcyA9IFtdOw0KZXhwb3J0IGNvbnN0IHByb3BzQnlDb2RlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsNCg0KLy8gLS0tIOWIneWni+WMluWHveaVsCAtLS0gLy8NCmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkRGF0YShzY2VuZSkgew0KICBnbG9iZUFzc2VtYmx5LmFkZChib3JkZXJzR3JvdXApOw0KICBnbG9iZUFzc2VtYmx5LmFkZChmaWxsc0dyb3VwKTsNCg0KICBjb25zdCBbZXh0cmEsIGdlb10gPSBhd2FpdCBQcm9taXNlLmFsbChbDQogICAgZmV0Y2goJy4vYXNzZXRzL2NvdW50cnlfZGF0YS5qc29uJykudGhlbihyID0+IHIuanNvbigpKSwNCiAgICBmZXRjaCgnLi9hc3NldHMvY291bnRyaWVzLmdlb2pzb24nKS50aGVuKHIgPT4gci5qc29uKCkpDQogIF0pOw0KDQogIGV4dHJhRGF0YSA9IGV4dHJhOw0KICBnZW9GZWF0dXJlcyA9IGdlby5mZWF0dXJlcyB8fCBbXTsNCg0KICBnZW9GZWF0dXJlcy5mb3JFYWNoKGYgPT4gew0KICAgIGNvbnN0IHByb3BzID0gZi5wcm9wZXJ0aWVzIHx8IHt9Ow0KICAgIGNvbnN0IGNvZGUgPSBwcm9wcy5BRE0wX0EzIHx8IHByb3BzLklTT19BMzsNCg0KICAgIGlmIChjb2RlICYmIGNvZGUgIT09ICctOTknKSB7DQogICAgICBwcm9wc0J5Q29kZVtjb2RlXSA9IHByb3BzOw0KICAgIH0NCg0KICAgIGNvbnN0IGcgPSBmLmdlb21ldHJ5Ow0KICAgIGlmIChnKSB7DQogICAgICBpZiAoZy50eXBlID09PSAnUG9seWdvbicpIHsNCiAgICAgICAgaWYgKGcuY29vcmRpbmF0ZXNbMF0pIGNyZWF0ZUxpbmUoZy5jb29yZGluYXRlc1swXSwgcHJvcHMpOw0KICAgICAgfSBlbHNlIGlmIChnLnR5cGUgPT09ICdNdWx0aVBvbHlnb24nKSB7DQogICAgICAgIGcuY29vcmRpbmF0ZXMuZm9yRWFjaChwb2x5ID0+IHsgaWYgKHBvbHlbMF0pIGNyZWF0ZUxpbmUocG9seVswXSwgcHJvcHMpOyB9KTsNCiAgICAgIH0NCiAgICB9DQogICAgY3JlYXRlTGFiZWwocHJvcHMpOw0KICB9KTsNCn0NCg0KLy8gLS0tIOWGhemDqOi+heWKqeWHveaVsCAtLS0gLy8NCmZ1bmN0aW9uIGNyZWF0ZUxpbmUocG9pbnRzLCBwcm9wcykgew0KICBjb25zdCB2ZWN0b3JzID0gcG9pbnRzLm1hcChwID0+IGNvbnZlcnRMYXRMb25Ub1ZlYzMocFsxXSwgcFswXSkpOw0KICBjb25zdCBsaW5lR2VvbWV0cnkgPSBuZXcgVEhSRUUuQnVmZmVyR2VvbWV0cnkoKS5zZXRGcm9tUG9pbnRzKHZlY3RvcnMpOw0KICBjb25zdCBsaW5lTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTGluZUJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHhmZmZmZmYgfSk7DQogIGNvbnN0IGxpbmUgPSBuZXcgVEhSRUUuTGluZShsaW5lR2VvbWV0cnksIGxpbmVNYXRlcmlhbCk7DQoNCiAgbGluZS5tYXRlcmlhbC5kZXB0aFdyaXRlID0gZmFsc2U7DQogIGxpbmUubWF0ZXJpYWwuZGVwdGhUZXN0ID0gdHJ1ZTsNCiAgbGluZS5yZW5kZXJPcmRlciA9IDI7DQoNCiAgbGluZS51c2VyRGF0YSA9IHsgY291bnRyeUNvZGU6IHByb3BzLkFETTBfQTMgfHwgcHJvcHMuSVNPX0EzLCBjb3VudHJ5RGF0YTogcHJvcHMgfTsNCiAgYm9yZGVyc0dyb3VwLmFkZChsaW5lKTsNCn0NCg0KZnVuY3Rpb24gY3JlYXRlTGFiZWwocHJvcHMpIHsNCiAgY29uc3QgbmFtZUVuID0gcHJvcHMuTkFNRV9FTiB8fCBwcm9wcy5OQU1FOw0KICBjb25zdCBuYW1lWmggPSBwcm9wcy5OQU1FX1pIOw0KICBjb25zdCBsYXQgPSBwcm9wcy5MQUJFTF9ZOw0KICBjb25zdCBsb24gPSBwcm9wcy5MQUJFTF9YOw0KDQogIGlmICgobmFtZUVuIHx8IG5hbWVaaCkgJiYgdHlwZW9mIGxhdCA9PT0gJ251bWJlcicgJiYgdHlwZW9mIGxvbiA9PT0gJ251bWJlcicpIHsNCiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KICAgIGVsLmNsYXNzTmFtZSA9ICdsYWJlbCc7DQogICAgZWwudGV4dENvbnRlbnQgPSBuYW1lRW47DQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xhYmVscy1jb250YWluZXInKS5hcHBlbmRDaGlsZChlbCk7DQogICAgY29uc3QgcG9zID0gY29udmVydExhdExvblRvVmVjMyhsYXQsIGxvbiwgRUFSVEhfUkFESVVTICsgMC4wMDQpOw0KDQogICAgY29uc3QgY29kZSA9IHByb3BzLkFETTBfQTMgfHwgcHJvcHMuSVNPX0EzIHx8IG51bGw7DQoNCiAgICAvLyAtLS0g5paw5aKe77ya5Li654m55a6a5aSn5Zu96K6+572u6auY6YeN6KaB5oCnIC0tLQ0KICAgIGNvbnN0IFRPUF9DT1VOVFJJRVMgPSBbJ0NITicsICdSVVMnLCAnVVNBJywgJ0NBTicsICdCUkEnLCAnQVVTJywgJ0lORCddOw0KICAgIGNvbnN0IGltcG9ydGFuY2UgPSBUT1BfQ09VTlRSSUVTLmluY2x1ZGVzKGNvZGUpID8gMiA6IDE7DQoNCiAgICBsYWJlbHMucHVzaCh7DQogICAgICAgIGVsZW1lbnQ6IGVsLA0KICAgICAgICBwb3NpdGlvbjogcG9zLA0KICAgICAgICBjb2RlOiBjb2RlLA0KICAgICAgICB0eXBlOiAnY291bnRyeScsDQogICAgICAgIGltcG9ydGFuY2U6IGltcG9ydGFuY2UsIC8vIOW6lOeUqOmHjeimgeaApw0KICAgICAgICBuYW1lX2VuOiBuYW1lRW4sDQogICAgICAgIG5hbWVfemg6IG5hbWVaaCB8fCBuYW1lRW4NCiAgICB9KTsNCiAgfQ0KfQ==", "./modules/hit-test.js": "data:text/javascript;base64,Ly8gbW9kdWxlcy9oaXQtdGVzdC5qcw0KLy8g6IGM6LSj77ya5o+Q5L6b5omA5pyJ5LiO4oCc5ZG95Lit5rWL6K+V4oCd55u45YWz55qE5aSN5p2C5Yeg5L2V6K6h566X5Yqf6IO944CCDQoNCmltcG9ydCB7IGdlb0ZlYXR1cmVzIH0gZnJvbSAnLi9kYXRhLmpzJzsNCg0KLy8gLS0tIOaguOW/g+WvvOWHuuWHveaVsO+8muagueaNrue7j+e6rOW6puafpeaJvuWbveWutiAtLS0NCmV4cG9ydCBmdW5jdGlvbiBmaW5kQ291bnRyeUF0KGxhdCwgbG9uKSB7DQogICAgZm9yIChjb25zdCBmIG9mIGdlb0ZlYXR1cmVzKSB7DQogICAgICBpZiAoIWYgfHwgIWYuZ2VvbWV0cnkpIGNvbnRpbnVlOw0KDQogICAgICBjb25zdCBnID0gZi5nZW9tZXRyeTsNCiAgICAgIGlmIChnLnR5cGUgPT09ICdQb2x5Z29uJykgew0KICAgICAgICBpZiAocG9seWdvbkNvbnRhaW5zKGcuY29vcmRpbmF0ZXMsIGxhdCwgbG9uKSkgcmV0dXJuIGY7DQogICAgICB9IGVsc2UgaWYgKGcudHlwZSA9PT0gJ011bHRpUG9seWdvbicpIHsNCiAgICAgICAgZm9yIChjb25zdCBwb2x5IG9mIGcuY29vcmRpbmF0ZXMpIHsNCiAgICAgICAgICBpZiAocG9seWdvbkNvbnRhaW5zKHBvbHksIGxhdCwgbG9uKSkgcmV0dXJuIGY7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgLy8g5Y2X5p6B5rSy55qE54m55q6K5aSE55CGDQogICAgaWYgKGxhdCA8IC02MCkgew0KICAgICAgY29uc3QgYW50YXJjdGljYSA9IGdlb0ZlYXR1cmVzLmZpbmQoZiA9PiAoZi5wcm9wZXJ0aWVzLkFETTBfQTMgPT09ICdBVEEnKSk7DQogICAgICBpZiAoYW50YXJjdGljYSkgcmV0dXJuIGFudGFyY3RpY2E7DQogICAgfQ0KICAgIHJldHVybiBudWxsOw0KfQ0KDQovLyAtLS0g5YaF6YOo6L6F5Yqp5Ye95pWwIC0tLQ0KDQpmdW5jdGlvbiBwb2x5Z29uQ29udGFpbnMocG9seSwgbGF0LCBsb24pIHsNCiAgICBpZiAoIXJpbmdCQm94Q29udGFpbnMocG9seVswXSwgbGF0LCBsb24pKSByZXR1cm4gZmFsc2U7DQogICAgaWYgKCFwb2ludEluUmluZyhsb24sIGxhdCwgcG9seVswXSkpIHJldHVybiBmYWxzZTsNCiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHBvbHkubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKHBvaW50SW5SaW5nKGxvbiwgbGF0LCBwb2x5W2ldKSkgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCg0KZnVuY3Rpb24gcmluZ0JCb3hDb250YWlucyhyaW5nLCBsYXQsIGxvbikgew0KICAgIGxldCBtaW5MID0gSW5maW5pdHksIG1heEwgPSAtSW5maW5pdHksIG1pbkEgPSBJbmZpbml0eSwgbWF4QSA9IC1JbmZpbml0eTsNCiAgICBmb3IgKGNvbnN0IHAgb2YgcmluZykgew0KICAgICAgICBjb25zdCBMID0gcFswXSwgQSA9IHBbMV07DQogICAgICAgIGlmIChMIDwgbWluTCkgbWluTCA9IEw7DQogICAgICAgIGlmIChMID4gbWF4TCkgbWF4TCA9IEw7DQogICAgICAgIGlmIChBIDwgbWluQSkgbWluQSA9IEE7DQogICAgICAgIGlmIChBID4gbWF4QSkgbWF4QSA9IEE7DQogICAgfQ0KICAgIGNvbnN0IHNwYW4gPSBtYXhMIC0gbWluTDsNCiAgICBjb25zdCB0bzM2MCA9IEwgPT4gKEwgPCAwID8gTCArIDM2MCA6IEwpOw0KICAgIGxldCBtaW4zNjAgPSBJbmZpbml0eSwgbWF4MzYwID0gLUluZmluaXR5Ow0KICAgIGZvciAoY29uc3QgcCBvZiByaW5nKSB7DQogICAgICAgIGNvbnN0IEwgPSB0bzM2MChwWzBdKTsNCiAgICAgICAgaWYgKEwgPCBtaW4zNjApIG1pbjM2MCA9IEw7DQogICAgICAgIGlmIChMID4gbWF4MzYwKSBtYXgzNjAgPSBMOw0KICAgIH0NCiAgICBjb25zdCBzcGFuMzYwID0gbWF4MzYwIC0gbWluMzYwOw0KDQogICAgaWYgKHNwYW4zNjAgPiAzNTApIHJldHVybiBsYXQgPj0gbWluQSAmJiBsYXQgPD0gbWF4QTsNCg0KICAgIGlmIChzcGFuIDw9IDE4MCkgew0KICAgICAgICByZXR1cm4gIShsYXQgPCBtaW5BIHx8IGxhdCA+IG1heEEgfHwgbG9uIDwgbWluTCB8fCBsb24gPiBtYXhMKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb25zdCB4ID0gdG8zNjAobG9uKTsNCiAgICAgICAgcmV0dXJuICEobGF0IDwgbWluQSB8fCBsYXQgPiBtYXhBIHx8IHggPCBtaW4zNjAgfHwgeCA+IG1heDM2MCk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBwb2ludEluUmluZyhsb24sIGxhdCwgcmluZykgew0KICAgIGNvbnN0IEVQUyA9IDFlLTk7DQogICAgY29uc3QgeyByaW5nQWRqLCB4IH0gPSBub3JtYWxpemVSaW5nRm9yRGF0ZWxpbmUocmluZywgbG9uKTsNCiAgICBsZXQgbWluWCA9IEluZmluaXR5LCBtYXhYID0gLUluZmluaXR5Ow0KICAgIGZvciAoY29uc3QgW0xdIG9mIHJpbmdBZGopIHsNCiAgICAgICAgaWYgKEwgPCBtaW5YKSBtaW5YID0gTDsNCiAgICAgICAgaWYgKEwgPiBtYXhYKSBtYXhYID0gTDsNCiAgICB9DQogICAgbGV0IHJpbmdVc2UgPSByaW5nQWRqLCB4VXNlID0geDsNCg0KICAgIGlmICgobWF4WCAtIG1pblgpID4gMzUwKSB7DQogICAgICAgIGNvbnN0IHdyYXBSZWwgPSBkID0+IHsNCiAgICAgICAgICAgIGxldCB2ID0gZDsNCiAgICAgICAgICAgIHdoaWxlICh2IDw9IC0xODApIHYgKz0gMzYwOw0KICAgICAgICAgICAgd2hpbGUgKHYgPiAxODApIHYgLT0gMzYwOw0KICAgICAgICAgICAgcmV0dXJuIHY7DQogICAgICAgIH07DQogICAgICAgIHJpbmdVc2UgPSByaW5nQWRqLm1hcCgoW0wsIEFdKSA9PiBbd3JhcFJlbChMIC0geCksIEFdKTsNCiAgICAgICAgeFVzZSA9IDA7DQogICAgfQ0KDQogICAgY29uc3QgbiA9IHJpbmdVc2UubGVuZ3RoOw0KICAgIGNvbnN0IHJpbmdDbGVhbiA9IChuID49IDIgJiYgcmluZ1VzZVswXVswXSA9PT0gcmluZ1VzZVtuIC0gMV1bMF0gJiYgcmluZ1VzZVswXVsxXSA9PT0gcmluZ1VzZVtuIC0gMV1bMV0pID8gcmluZ1VzZS5zbGljZSgwLCBuIC0gMSkgOiByaW5nVXNlOw0KICAgIGNvbnN0IHkgPSBsYXQgKyBFUFM7DQogICAgbGV0IGluc2lkZSA9IGZhbHNlOw0KICAgIGZvciAobGV0IGkgPSAwLCBqID0gcmluZ0NsZWFuLmxlbmd0aCAtIDE7IGkgPCByaW5nQ2xlYW4ubGVuZ3RoOyBqID0gaSsrKSB7DQogICAgICAgIGNvbnN0IFt4aSwgeWldID0gcmluZ0NsZWFuW2ldOw0KICAgICAgICBjb25zdCBbeGosIHlqXSA9IHJpbmdDbGVhbltqXTsNCiAgICAgICAgaWYgKCgoeWkgPiB5KSAhPT0gKHlqID4geSkpICYmICh4VXNlIDwgKCh4aiAtIHhpKSAqICh5IC0geWkpKSAvICh5aiAtIHlpKSArIHhpKSkgew0KICAgICAgICAgICAgaW5zaWRlID0gIWluc2lkZTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gaW5zaWRlOw0KfQ0KDQpmdW5jdGlvbiBub3JtYWxpemVSaW5nRm9yRGF0ZWxpbmUocmluZywgdGVzdExvbikgew0KICAgIGxldCBtaW4gPSBJbmZpbml0eSwgbWF4ID0gLUluZmluaXR5Ow0KICAgIGZvciAoY29uc3QgcCBvZiByaW5nKSB7DQogICAgICAgIGNvbnN0IEwgPSBwWzBdOw0KICAgICAgICBpZiAoTCA8IG1pbikgbWluID0gTDsNCiAgICAgICAgaWYgKEwgPiBtYXgpIG1heCA9IEw7DQogICAgfQ0KICAgIGlmIChtYXggLSBtaW4gPD0gMTgwKSByZXR1cm4geyByaW5nQWRqOiByaW5nLCB4OiB0ZXN0TG9uIH07DQogICAgY29uc3QgdG8zNjAgPSBMID0+IChMIDwgMCA/IEwgKyAzNjAgOiBMKTsNCiAgICByZXR1cm4geyByaW5nQWRqOiByaW5nLm1hcCgoW0wsIEFdKSA9PiBbdG8zNjAoTCksIEFdKSwgeDogdG8zNjAodGVzdExvbikgfTsNCn0=", "./modules/interaction.js": "data:text/javascript;base64,Ly8gbW9kdWxlcy9pbnRlcmFjdGlvbi5qcw0KLy8g6IGM6LSjOiDlpITnkIbnlKjmiLfovpPlhaXkuovku7bvvIzlubbnrqHnkIbkuqTkupLnirbmgIHjgIINCg0KaW1wb3J0ICogYXMgVEhSRUUgZnJvbSAndGhyZWUnOw0KLy8gLS0tIOKYhSDmoLjlv4Pkv67mlLk6IOWvvOWFpSBnbG9iZUFzc2VtYmx5IOS7peiOt+WPluWFtuWAvuaWnOeKtuaAgSAtLS0NCmltcG9ydCB7IHNjZW5lLCBjYW1lcmEsIHJlbmRlcmVyLCBzcGhlcmUsIGdsb2JlQXNzZW1ibHkgfSBmcm9tICcuL3NjZW5lLmpzJzsNCmltcG9ydCB7IGdlb0ZlYXR1cmVzLCBleHRyYURhdGEsIGJvcmRlcnNHcm91cCwgZmlsbHNHcm91cCwgZmlsbENhY2hlIH0gZnJvbSAnLi9kYXRhLmpzJzsNCmltcG9ydCB7IGNvbnZlcnRWZWMzVG9MYXRMb24sIGJ1aWxkQ291bnRyeUZpbGxHcm91cCB9IGZyb20gJy4vZ2VvZ3JhcGh5LmpzJzsNCmltcG9ydCB7IGZpbmRDb3VudHJ5QXQgfSBmcm9tICcuL2hpdC10ZXN0LmpzJzsNCg0KLy8gLS0tIOaWsOWinjog5aSn5rSy5ZCN56ew57+76K+R6KGoIC0tLQ0KY29uc3QgQ09OVElORU5UX1RSQU5TTEFUSU9OUyA9IHsNCiAgICAnTm9ydGggQW1lcmljYSc6ICfljJfnvo7mtLInLA0KICAgICdTb3V0aCBBbWVyaWNhJzogJ+WNl+e+jua0sicsDQogICAgJ0V1cm9wZSc6ICfmrKfmtLInLA0KICAgICdBc2lhJzogJ+S6mua0sicsDQogICAgJ0FmcmljYSc6ICfpnZ7mtLInLA0KICAgICdPY2VhbmlhJzogJ+Wkp+a0i+a0sicsDQogICAgJ0FudGFyY3RpY2EnOiAn5Y2X5p6B5rSyJw0KfTsNCg0KLy8gLS0tIERPTSDlhYPntKAgLS0tDQpsZXQgaW5mb1BhbmVsLCBpbmZvQ291bnRyeU5hbWUsIGluZm9Cb2R5LCBpbmZvQ2xvc2VCdG47DQpsZXQgaWRsSW5kaWNhdG9yTGVmdCwgaWRsSW5kaWNhdG9yUmlnaHQ7DQoNCi8vIC0tLSDnirbmgIHlj5jph48gKOWvvOWHuikgLS0tDQpleHBvcnQgbGV0IGhvdmVyZWRDb3VudHJ5ID0gbnVsbDsNCmV4cG9ydCBsZXQgbG9ja2VkQ291bnRyeSA9IG51bGw7DQoNCi8vIC0tLSDlhoXpg6jnirbmgIEgLS0tDQpjb25zdCByYXljYXN0ZXIgPSBuZXcgVEhSRUUuUmF5Y2FzdGVyKCk7DQpsZXQgc2VsZWN0ZWRDb2RlID0gbnVsbDsNCmNvbnN0IGlzVG91Y2hEZXZpY2UgPSAoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KSB8fCAobmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzID4gMCk7DQpsZXQgaXNJZGxIb3ZlcmVkID0gZmFsc2U7DQoNCmNvbnN0IENPVU5UUllfVFpfT1ZFUlJJREUgPSB7DQogIENITjogJ0FzaWEvU2hhbmdoYWknLCBJTkQ6ICdBc2lhL0tvbGthdGEnLCBJUk46ICdBc2lhL1RlaHJhbicsDQogIEFGRzogJ0FzaWEvS2FidWwnLCBOUEw6ICdBc2lhL0thdGhtYW5kdScsIE1NUjogJ0FzaWEvWWFuZ29uJw0KfTsNCg0KLy8gLS0tIOWIneWni+WMluWHveaVsCAtLS0NCmV4cG9ydCBmdW5jdGlvbiBpbml0SW50ZXJhY3Rpb24oKSB7DQogIGluZm9QYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvLXBhbmVsJyk7DQogIGluZm9Db3VudHJ5TmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvLWNvdW50cnktbmFtZScpOw0KICBpbmZvQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmZvLWJvZHknKTsNCiAgaW5mb0Nsb3NlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm8tY2xvc2UtYnRuJyk7DQogIGlkbEluZGljYXRvckxlZnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWRsLWluZGljYXRvci1sZWZ0Jyk7DQogIGlkbEluZGljYXRvclJpZ2h0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lkbC1pbmRpY2F0b3ItcmlnaHQnKTsNCg0KICByZW5kZXJlci5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgb25Qb2ludGVyRG93bik7DQogIHJlbmRlcmVyLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLCBvblBvaW50ZXJNb3ZlKTsNCiAgaW5mb0Nsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IGhpZGVJbmZvUGFuZWwoKTsgfSk7DQp9DQoNCg0KLy8gLS0tIOKYhSDmlrDlop46IOWdkOagh+S/ruato+i+heWKqeWHveaVsCAtLS0NCi8vIOS9nOeUqDog5bCG5LiW55WM5Z2Q5qCH57O75Lit55qE5Lqk54K577yM6L2s5o2i5Zue5Zyw55CD5qih5Z6L55qE5bGA6YOo5Z2Q5qCH57O7DQovLyDku47ogIzmirXmtojnpoXlrprmqKHlvI/kuIsgZ2xvYmVBc3NlbWJseSDnmoTlgL7mlpzluKbmnaXnmoTlvbHlk43jgIINCmZ1bmN0aW9uIGdldENvcnJlY3RlZEhpdFBvaW50KGhpdCkgew0KICAgIGNvbnN0IHBvaW50SW5Xb3JsZCA9IGhpdC5wb2ludC5jbG9uZSgpOw0KICAgIGNvbnN0IGludmVyc2VNYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4NCgpOw0KICAgIC8vIOiOt+WPliBnbG9iZUFzc2VtYmx5IOeahOS4lueVjOWPmOaNouefqemYteeahOmAhuefqemYtQ0KICAgIGludmVyc2VNYXRyaXguY29weShnbG9iZUFzc2VtYmx5Lm1hdHJpeFdvcmxkKS5pbnZlcnQoKTsNCiAgICAvLyDlsIbkuJbnlYzlnZDmoIfngrnlupTnlKjov5nkuKrpgIbnn6npmLXvvIzlvpfliLDlsYDpg6jlnZDmoIfngrkNCiAgICBjb25zdCBwb2ludEluTG9jYWwgPSBwb2ludEluV29ybGQuYXBwbHlNYXRyaXg0KGludmVyc2VNYXRyaXgpOw0KICAgIHJldHVybiBwb2ludEluTG9jYWw7DQp9DQoNCg0KLy8gLS0tIOS6i+S7tuWkhOeQhiAo5bey5L+u5pS5KSAtLS0NCmZ1bmN0aW9uIG9uUG9pbnRlckRvd24oZSkgew0KICBjb25zdCB7IHgsIHkgfSA9IGNsaWVudFRvTkRDKGUuY2xpZW50WCwgZS5jbGllbnRZKTsNCiAgcmF5Y2FzdGVyLnNldEZyb21DYW1lcmEoeyB4LCB5IH0sIGNhbWVyYSk7DQogIGNvbnN0IGhpdCA9IHJheWNhc3Rlci5pbnRlcnNlY3RPYmplY3Qoc3BoZXJlLCBmYWxzZSlbMF07DQogIGlmICghaGl0KSB7DQogICAgaGlkZUluZm9QYW5lbCgpOw0KICAgIHJldHVybjsNCiAgfQ0KDQogIC8vIOS9v+eUqOi+heWKqeWHveaVsOiOt+WPluS/ruato+WQjueahOWdkOagh+eCuQ0KICBjb25zdCBjb3JyZWN0ZWRQb2ludCA9IGdldENvcnJlY3RlZEhpdFBvaW50KGhpdCk7DQogIGNvbnN0IHsgbGF0LCBsb24gfSA9IGNvbnZlcnRWZWMzVG9MYXRMb24oY29ycmVjdGVkUG9pbnQpOw0KDQogIGNvbnN0IGZlYXR1cmUgPSBmaW5kQ291bnRyeUF0KGxhdCwgbG9uKTsNCiAgaWYgKGZlYXR1cmUpIHsNCiAgICBzaG93SW5mb1BhbmVsKGZlYXR1cmUucHJvcGVydGllcywgbGF0LCBsb24pOw0KICB9IGVsc2Ugew0KICAgIGhpZGVJbmZvUGFuZWwoKTsNCiAgfQ0KfQ0KDQpmdW5jdGlvbiBvblBvaW50ZXJNb3ZlKGUpIHsNCiAgaWYgKGlzVG91Y2hEZXZpY2UpIHJldHVybjsNCiAgY29uc3QgeyB4LCB5IH0gPSBjbGllbnRUb05EQyhlLmNsaWVudFgsIGUuY2xpZW50WSk7DQogIHJheWNhc3Rlci5zZXRGcm9tQ2FtZXJhKHsgeCwgeSB9LCBjYW1lcmEpOw0KDQogIGNvbnN0IGhpdCA9IHJheWNhc3Rlci5pbnRlcnNlY3RPYmplY3Qoc3BoZXJlLCBmYWxzZSlbMF07DQogIGlmIChoaXQpIHsNCiAgICAvLyDlkIzmoLflsIbkv67mraPlupTnlKjlnKjmgqzlgZzmo4DmtYvkuIoNCiAgICBjb25zdCBjb3JyZWN0ZWRQb2ludCA9IGdldENvcnJlY3RlZEhpdFBvaW50KGhpdCk7DQogICAgY29uc3QgeyBsYXQsIGxvbiB9ID0gY29udmVydFZlYzNUb0xhdExvbihjb3JyZWN0ZWRQb2ludCk7DQogICAgaG92ZXJlZENvdW50cnkgPSBmaW5kQ291bnRyeUF0KGxhdCwgbG9uKTsNCiAgfSBlbHNlIHsNCiAgICBob3ZlcmVkQ291bnRyeSA9IG51bGw7DQogIH0NCg0KICBjb25zdCBpZGxMaW5lID0gc2NlbmUuZ2V0T2JqZWN0QnlOYW1lKCdpbnRlcmFjdGl2ZV9pZGxfbGluZScpOw0KICBpZiAoaWRsTGluZSAmJiBjaGVja0hvdmVyT25JZGwoKSkgew0KICAgIGlmICghaXNJZGxIb3ZlcmVkKSB7DQogICAgICBpc0lkbEhvdmVyZWQgPSB0cnVlOw0KICAgICAgdXBkYXRlSWRsSW5kaWNhdG9ycyh0cnVlLCB3aW5kb3cuY3VycmVudExhbmd1YWdlIHx8ICdlbicpOw0KICAgIH0NCiAgfSBlbHNlIHsNCiAgICBpZiAoaXNJZGxIb3ZlcmVkKSB7DQogICAgICBpc0lkbEhvdmVyZWQgPSBmYWxzZTsNCiAgICAgIHVwZGF0ZUlkbEluZGljYXRvcnMoZmFsc2UsIHdpbmRvdy5jdXJyZW50TGFuZ3VhZ2UgfHwgJ2VuJyk7DQogICAgfQ0KICB9DQp9DQoNCi8vICjmoLzlvI/ljJblt6Xlhbflh73mlbDkv53mjIHkuI3lj5gpDQpleHBvcnQgZnVuY3Rpb24gZm9ybWF0RGF0ZVRpbWUodHosIGRhdGUgPSBuZXcgRGF0ZSgpKSB7DQogIHRyeSB7DQogICAgY29uc3QgeWVhciA9IGRhdGUudG9Mb2NhbGVTdHJpbmcoJ2VuLUNBJywgeyB0aW1lWm9uZTogdHosIHllYXI6ICdudW1lcmljJyB9KTsNCiAgICBjb25zdCBtb250aCA9IGRhdGUudG9Mb2NhbGVTdHJpbmcoJ2VuLUNBJywgeyB0aW1lWm9uZTogdHosIG1vbnRoOiAnMi1kaWdpdCcgfSk7DQogICAgY29uc3QgZGF5ID0gZGF0ZS50b0xvY2FsZVN0cmluZygnZW4tQ0EnLCB7IHRpbWVab25lOiB0eiwgZGF5OiAnMi1kaWdpdCcgfSk7DQogICAgY29uc3QgdGltZSA9IGRhdGUudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJywgeyB0aW1lWm9uZTogdHosIGhvdXI6ICcyLWRpZ2l0JywgbWludXRlOiAnMi1kaWdpdCcsIGhvdXIxMjogdHJ1ZSB9KTsNCiAgICByZXR1cm4gYCR7eWVhci5yZXBsYWNlKC8tL2csICcvJyl9ICAke3RpbWV9YDsNCiAgfSBjYXRjaCAoZSkgeyByZXR1cm4gJ0ludmFsaWQgVGltZXpvbmUgRGF0YSc7IH0NCn0NCg0KLy8gKOiOt+WPluaXtuWMuuW3peWFt+WHveaVsOS/neaMgeS4jeWPmCkNCmV4cG9ydCBmdW5jdGlvbiBnZXRUaW1lem9uZUZvcihsYXQsIGxvbiwgaXNvMykgew0KICB0cnkgew0KICAgIGlmIChpc28zICYmIENPVU5UUllfVFpfT1ZFUlJJREVbaXNvM10pIHJldHVybiBDT1VOVFJZX1RaX09WRVJSSURFW2lzbzNdOw0KICAgIGlmICh0eXBlb2Ygd2luZG93LnR6bG9va3VwID09PSAnZnVuY3Rpb24nKSB7IGNvbnN0IHR6ID0gd2luZG93LnR6bG9va3VwKGxhdCwgbG9uKTsgaWYgKHR6KSByZXR1cm4gdHo7IH0NCiAgfSBjYXRjaCAoZSkgeyBjb25zb2xlLndhcm4oJ1t0el0gbG9va3VwIGVycm9yOicsIGUpOyB9DQogIHJldHVybiAnVVRDJzsNCn0NCg0KLy8gKElETCDmgqzlgZzmo4DmtYvlh73mlbDkv53mjIHkuI3lj5gpDQpmdW5jdGlvbiBjaGVja0hvdmVyT25JZGwoKSB7DQogICAgY29uc3QgaGl0ID0gcmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdChzcGhlcmUsIGZhbHNlKVswXTsNCiAgICBpZiAoIWhpdCkgcmV0dXJuIGZhbHNlOw0KICAgIGNvbnN0IGlkbExpbmUgPSBzY2VuZS5nZXRPYmplY3RCeU5hbWUoJ2ludGVyYWN0aXZlX2lkbF9saW5lJyk7DQogICAgY29uc3QgaGl0UG9pbnQgPSBoaXQucG9pbnQ7DQogICAgY29uc3QgcG9zaXRpb25zID0gaWRsTGluZS5nZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmFycmF5Ow0KICAgIGNvbnN0IHRocmVzaG9sZFNxID0gMC4yICogMC4yOw0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcG9zaXRpb25zLmxlbmd0aDsgaSArPSAzKSB7DQogICAgICAgIGNvbnN0IHAgPSBuZXcgVEhSRUUuVmVjdG9yMyhwb3NpdGlvbnNbaV0sIHBvc2l0aW9uc1tpKzFdLCBwb3NpdGlvbnNbaSsyXSk7DQogICAgICAgIGlmIChwLmRpc3RhbmNlVG9TcXVhcmVkKGhpdFBvaW50KSA8IHRocmVzaG9sZFNxKSByZXR1cm4gdHJ1ZTsNCiAgICB9DQogICAgcmV0dXJuIGZhbHNlOw0KfQ0KDQovLyAoSURMIOaMh+ekuuWZqOabtOaWsOWHveaVsOS/neaMgeS4jeWPmCkNCmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVJZGxJbmRpY2F0b3JzKHZpc2libGUsIGxhbmcpIHsNCiAgaWYgKCFpZGxJbmRpY2F0b3JMZWZ0IHx8ICFpZGxJbmRpY2F0b3JSaWdodCkgcmV0dXJuOw0KICBpZiAodmlzaWJsZSkgew0KICAgIGNvbnN0IG9wdGlvbnMgPSB7IHdlZWtkYXk6ICdzaG9ydCcsIG1vbnRoOiAnc2hvcnQnLCBkYXk6ICdudW1lcmljJyB9Ow0KICAgIGNvbnN0IGxvY2FsZSA9IGxhbmcgPT09ICd6aCcgPyAnemgtQ04nIDogJ2VuLVVTJzsNCiAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7DQogICAgY29uc3QgeWVzdGVyZGF5ID0gbmV3IERhdGUoKTsNCiAgICB5ZXN0ZXJkYXkuc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgLSAxKTsNCiAgICBjb25zdCBlYXJsaWVyVGV4dCA9IGxhbmcgPT09ICd6aCcgPyAn5YmN5LiA5aSpJyA6ICdFYXJsaWVyIERheSc7DQogICAgY29uc3QgbGF0ZXJUZXh0ID0gbGFuZyA9PT0gJ3poJyA/ICflkI7kuIDlpKknIDogJ0xhdGVyIERheSc7DQogICAgaWRsSW5kaWNhdG9yTGVmdC50ZXh0Q29udGVudCA9IGDil4AgJHt5ZXN0ZXJkYXkudG9Mb2NhbGVEYXRlU3RyaW5nKGxvY2FsZSwgb3B0aW9ucyl9ICgke2VhcmxpZXJUZXh0fSlgOw0KICAgIGlkbEluZGljYXRvclJpZ2h0LnRleHRDb250ZW50ID0gYCR7dG9kYXkudG9Mb2NhbGVEYXRlU3RyaW5nKGxvY2FsZSwgb3B0aW9ucyl9ICgke2xhdGVyVGV4dH0pIOKWtmA7DQogICAgaWRsSW5kaWNhdG9yTGVmdC5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJyk7DQogICAgaWRsSW5kaWNhdG9yUmlnaHQuY2xhc3NMaXN0LmFkZCgndmlzaWJsZScpOw0KICB9IGVsc2Ugew0KICAgIGlkbEluZGljYXRvckxlZnQuY2xhc3NMaXN0LnJlbW92ZSgndmlzaWJsZScpOw0KICAgIGlkbEluZGljYXRvclJpZ2h0LmNsYXNzTGlzdC5yZW1vdmUoJ3Zpc2libGUnKTsNCiAgfQ0KfQ0KDQovLyAtLS0g5Zu95a626YCJ5Lit5LiO6Z2i5p2/IC0tLSAvLw0KZnVuY3Rpb24gc2V0U2VsZWN0ZWRDb3VudHJ5QnlDb2RlKGNvZGUpIHsNCiAgaWYgKHNlbGVjdGVkQ29kZSA9PT0gY29kZSkgcmV0dXJuOw0KICBpZiAoc2VsZWN0ZWRDb2RlKSB7DQogICAgYm9yZGVyc0dyb3VwLmNoaWxkcmVuLmZvckVhY2gobGluZSA9PiB7DQogICAgICBpZiAobGluZS51c2VyRGF0YS5jb3VudHJ5Q29kZSA9PT0gc2VsZWN0ZWRDb2RlKSBsaW5lLm1hdGVyaWFsLmNvbG9yLnNldCgweGZmZmZmZik7DQogICAgfSk7DQogIH0NCiAgc2VsZWN0ZWRDb2RlID0gY29kZSB8fCBudWxsOw0KICBpZiAoc2VsZWN0ZWRDb2RlKSB7DQogICAgYm9yZGVyc0dyb3VwLmNoaWxkcmVuLmZvckVhY2gobGluZSA9PiB7DQogICAgICBpZiAobGluZS51c2VyRGF0YS5jb3VudHJ5Q29kZSA9PT0gc2VsZWN0ZWRDb2RlKSBsaW5lLm1hdGVyaWFsLmNvbG9yLnNldCgweGZmZmYwMCk7DQogICAgfSk7DQogIH0NCiAgdXBkYXRlQ291bnRyeUZpbGwoc2VsZWN0ZWRDb2RlKTsNCn0NCg0KZnVuY3Rpb24gdXBkYXRlQ291bnRyeUZpbGwoY29kZSkgew0KICBmaWxsc0dyb3VwLmNsZWFyKCk7DQogIGlmICghY29kZSkgcmV0dXJuOw0KICBsZXQgZ3JwID0gZmlsbENhY2hlLmdldChjb2RlKTsNCiAgaWYgKCFncnApIHsNCiAgICBjb25zdCBmZWF0dXJlID0gZ2VvRmVhdHVyZXMuZmluZChmID0+IChmLnByb3BlcnRpZXMuQURNMF9BMyB8fCBmLnByb3BlcnRpZXMuSVNPX0EzKSA9PT0gY29kZSk7DQogICAgaWYgKCFmZWF0dXJlKSByZXR1cm47DQogICAgZ3JwID0gYnVpbGRDb3VudHJ5RmlsbEdyb3VwKGZlYXR1cmUpOw0KICAgIGZpbGxDYWNoZS5zZXQoY29kZSwgZ3JwKTsNCiAgfQ0KICBmaWxsc0dyb3VwLmFkZChncnApOw0KfQ0KDQpleHBvcnQgZnVuY3Rpb24gc2hvd0luZm9QYW5lbChkYXRhLCBjbGlja2VkTGF0LCBjbGlja2VkTG9uKSB7DQogIGNvbnN0IGNvZGUgPSBkYXRhLkFETTBfQTMgfHwgZGF0YS5JU09fQTM7DQogIHNldFNlbGVjdGVkQ291bnRyeUJ5Q29kZShjb2RlKTsNCg0KICBsb2NrZWRDb3VudHJ5ID0gew0KICAgICAgcHJvcGVydGllczogZGF0YSwNCiAgICAgIGxhdDogY2xpY2tlZExhdCwNCiAgICAgIGxvbjogY2xpY2tlZExvbiwNCiAgfTsNCg0KICB1cGRhdGVJbmZvUGFuZWxDb250ZW50KCk7DQogIGluZm9QYW5lbC5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJyk7DQp9DQoNCi8vIC0tLSDmoLjlv4Pkv67mlLk6IOabtOaWsOS6huatpOWHveaVsOS7peWkhOeQhuaJgOacieaWsOeahOaYvuekuumcgOaxgiAtLS0NCmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVJbmZvUGFuZWxDb250ZW50KCkgew0KICAgIGlmICghbG9ja2VkQ291bnRyeSkgcmV0dXJuOw0KDQogICAgY29uc3QgZGF0YSA9IGxvY2tlZENvdW50cnkucHJvcGVydGllczsNCiAgICBjb25zdCBjb2RlID0gZGF0YS5BRE0wX0EzIHx8IGRhdGEuSVNPX0EzOw0KICAgIGNvbnN0IGxhbmcgPSB3aW5kb3cuY3VycmVudExhbmd1YWdlIHx8ICdlbic7DQogICAgY29uc3QgZXh0cmEgPSBleHRyYURhdGFbY29kZV0gfHwge307DQoNCiAgICAvLyAxLiDojrflj5bmiYDmnInpnIDopoHmmL7npLrnmoTmlbDmja4NCiAgICBjb25zdCBuYW1lID0gbGFuZyA9PT0gJ3poJyA/IChleHRyYS5OQU1FX1pIIHx8IGRhdGEuTkFNRV9aSCB8fCBkYXRhLk5BTUVfRU4pIDogKGRhdGEuTkFNRV9FTiB8fCBkYXRhLk5BTUUpOw0KICAgIGNvbnN0IGNhcGl0YWwgPSBsYW5nID09PSAnemgnID8gKGV4dHJhLkNBUElUQUxfWkggfHwgZXh0cmEuQ0FQSVRBTF9FTikgOiAoZXh0cmEuQ0FQSVRBTF9FTik7DQogICAgY29uc3QgcG9wID0gZXh0cmEuUE9QVUxBVElPTiA/IE51bWJlcihleHRyYS5QT1BVTEFUSU9OKS50b0xvY2FsZVN0cmluZygnZW4tVVMnKSA6ICdOL0EnOw0KDQogICAgLy8g6Z2i56ev5Y2V5L2N57+76K+RDQogICAgY29uc3QgYXJlYVVuaXQgPSBsYW5nID09PSAnemgnID8gJ+W5s+aWueWFrOmHjCcgOiAna23Csic7DQogICAgY29uc3QgYXJlYSA9IGV4dHJhLkFSRUFfS00yID8gYCR7TnVtYmVyKGV4dHJhLkFSRUFfS00yKS50b0xvY2FsZVN0cmluZygnZW4tVVMnKX0gJHthcmVhVW5pdH1gIDogJ04vQSc7DQoNCiAgICAvLyBHRFAg5Y2V5L2N57+76K+RDQogICAgY29uc3QgZ2RwVW5pdCA9IGxhbmcgPT09ICd6aCcgPyAn5LiH5Lq/576O5YWDJyA6ICdUcmlsbGlvbiBVU0QnOw0KICAgIGNvbnN0IGdkcCA9IGV4dHJhLkdEUF9VU0RfVFJJTExJT04gPyBgJHtleHRyYS5HRFBfVVNEX1RSSUxMSU9OfSAke2dkcFVuaXR9YCA6ICdOL0EnOw0KDQogICAgLy8g5aSn5rSy5ZCN56ew57+76K+RDQogICAgY29uc3QgY29udGluZW50RU4gPSBkYXRhLkNPTlRJTkVOVDsNCiAgICBjb25zdCBjb250aW5lbnQgPSBsYW5nID09PSAnemgnID8gKENPTlRJTkVOVF9UUkFOU0xBVElPTlNbY29udGluZW50RU5dIHx8IGNvbnRpbmVudEVOKSA6IGNvbnRpbmVudEVOOw0KDQogICAgLy8gMi4g5a6a5LmJVUnmoIfnrb7nmoTnv7vor5ENCiAgICBjb25zdCBsYWJlbHMgPSB7DQogICAgICAgIGNhcGl0YWw6IGxhbmcgPT09ICd6aCcgPyAn6aaWIOmDvScgOiAnQ2FwaXRhbCcsDQogICAgICAgIHBvcHVsYXRpb246IGxhbmcgPT09ICd6aCcgPyAn5Lq6IOWPoycgOiAnUG9wdWxhdGlvbicsDQogICAgICAgIGdkcDogJ0dEUCcsIC8vIOagh+mimOWbuuWumuS4ukdEUA0KICAgICAgICBhcmVhOiBsYW5nID09PSAnemgnID8gJ+mdoiDnp68nIDogJ0FyZWEnLA0KICAgICAgICBjb250aW5lbnQ6IGxhbmcgPT09ICd6aCcgPyAn5aSnIOa0sicgOiAnQ29udGluZW50Jw0KICAgIH07DQoNCiAgICAvLyAzLiDmm7TmlrDpnaLmnb/lhoXlrrkNCiAgICBpbmZvQ291bnRyeU5hbWUudGV4dENvbnRlbnQgPSBuYW1lIHx8ICcnOw0KICAgIGluZm9Cb2R5LmlubmVySFRNTCA9IGANCiAgICAgIDxwPjxiPiR7bGFiZWxzLmNhcGl0YWx9PC9iPiR7Y2FwaXRhbCB8fCAnTi9BJ308L3A+DQogICAgICA8cD48Yj4ke2xhYmVscy5wb3B1bGF0aW9ufTwvYj4ke3BvcH08L3A+DQogICAgICA8cD48Yj4ke2xhYmVscy5nZHB9PC9iPiR7Z2RwfTwvcD4NCiAgICAgIDxwPjxiPiR7bGFiZWxzLmFyZWF9PC9iPiR7YXJlYX08L3A+DQogICAgICA8cD48Yj4ke2xhYmVscy5jb250aW5lbnR9PC9iPiR7Y29udGluZW50IHx8ICdOL0EnfTwvcD4NCiAgICBgOw0KfQ0KDQoNCmZ1bmN0aW9uIGhpZGVJbmZvUGFuZWwoKSB7DQogIHNldFNlbGVjdGVkQ291bnRyeUJ5Q29kZShudWxsKTsNCiAgbG9ja2VkQ291bnRyeSA9IG51bGw7DQogIGluZm9QYW5lbC5jbGFzc0xpc3QucmVtb3ZlKCd2aXNpYmxlJyk7DQp9DQoNCmZ1bmN0aW9uIGNsaWVudFRvTkRDKGNsaWVudFgsIGNsaWVudFkpIHsNCiAgY29uc3QgcmVjdCA9IHJlbmRlcmVyLmRvbUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogIGNvbnN0IHggPSAoKGNsaWVudFggLSByZWN0LmxlZnQpIC8gcmVjdC53aWR0aCkgKiAyIC0gMTsNCiAgY29uc3QgeSA9IC0oKGNsaWVudFkgLSByZWN0LnRvcCkgLyByZWN0LmhlaWdodCkgKiAyICsgMTsNCiAgcmV0dXJuIHsgeCwgeSB9Ow0KfQ==", "./modules/cities.js": "data:text/javascript;base64,Ly8gbW9kdWxlcy9jaXRpZXMuanMNCi8vIOiBjOi0o++8muivu+WPluWfjuW4guaVsOaNru+8jOW5tuWcqOWcsOeQg+S4iuWIm+W7uuagh+iusOeCue+8iFNwcml0Ze+8ieWSjOaWh+acrOagh+etvg0KDQppbXBvcnQgKiBhcyBUSFJFRSBmcm9tICcuLi9hc3NldHMvanMvdGhyZWUubW9kdWxlLmpzJzsNCmltcG9ydCB7IGNpdGllcyBhcyBjaXRpZXNEYXRhIH0gZnJvbSAnLi4vYXNzZXRzL2NpdGllc19kYXRhLmpzJzsNCmltcG9ydCB7IGNvbnZlcnRMYXRMb25Ub1ZlYzMgfSBmcm9tICcuL2dlb2dyYXBoeS5qcyc7DQppbXBvcnQgeyBsYWJlbHMgfSBmcm9tICcuL2RhdGEuanMnOw0KaW1wb3J0IHsgRUFSVEhfUkFESVVTLCBnbG9iZUFzc2VtYmx5IH0gZnJvbSAnLi9zY2VuZS5qcyc7DQoNCmxldCBjaXR5TWFya2Vyc01hdGVyaWFsOw0KY29uc3QgY2l0eU1hcmtlcnMgPSBbXTsNCmNvbnN0IE1BUktFUl9WSVNJQklMSVRZX1RIUkVTSE9MRCA9IDcuMDsNCg0KZnVuY3Rpb24gY3JlYXRlTWFya2VyVGV4dHVyZShjb2xvciwgc2l6ZSkgew0KICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgIGNhbnZhcy53aWR0aCA9IHNpemU7DQogICAgY2FudmFzLmhlaWdodCA9IHNpemU7DQogICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgIGNvbnN0IHJhZGl1cyA9IHNpemUgLyAyOw0KICAgIGNvbnN0IGdyYWRpZW50ID0gY29udGV4dC5jcmVhdGVSYWRpYWxHcmFkaWVudChyYWRpdXMsIHJhZGl1cywgMCwgcmFkaXVzLCByYWRpdXMsIHJhZGl1cyk7DQogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsIGNvbG9yKTsNCiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC40LCBjb2xvcik7DQogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDApJyk7DQogICAgY29udGV4dC5maWxsU3R5bGUgPSBncmFkaWVudDsNCiAgICBjb250ZXh0LmZpbGxSZWN0KDAsIDAsIHNpemUsIHNpemUpOw0KICAgIHJldHVybiBuZXcgVEhSRUUuQ2FudmFzVGV4dHVyZShjYW52YXMpOw0KfQ0KDQpleHBvcnQgZnVuY3Rpb24gaW5pdENpdGllcyhzY2VuZSkgew0KICBjb25zdCBjaXRpZXNHcm91cCA9IG5ldyBUSFJFRS5Hcm91cCgpOw0KICBjaXRpZXNHcm91cC5uYW1lID0gJ2NpdGllc19ncm91cCc7DQoNCiAgY29uc3QgbWFya2VyVGV4dHVyZSA9IGNyZWF0ZU1hcmtlclRleHR1cmUoJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC45KScsIDEyOCk7DQogIGNpdHlNYXJrZXJzTWF0ZXJpYWwgPSBuZXcgVEhSRUUuU3ByaXRlTWF0ZXJpYWwoew0KICAgIG1hcDogbWFya2VyVGV4dHVyZSwNCiAgICBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZywNCiAgICBkZXB0aFRlc3Q6IGZhbHNlLA0KICB9KTsNCg0KICBjaXRpZXNEYXRhLmZvckVhY2goY2l0eSA9PiB7DQogICAgY29uc3QgbWFya2VyID0gbmV3IFRIUkVFLlNwcml0ZShjaXR5TWFya2Vyc01hdGVyaWFsKTsNCiAgICBjb25zdCBtYXJrZXJQb3MgPSBjb252ZXJ0TGF0TG9uVG9WZWMzKGNpdHkubGF0LCBjaXR5LmxvbiwgRUFSVEhfUkFESVVTKTsNCiAgICBtYXJrZXIucG9zaXRpb24uY29weShtYXJrZXJQb3MpOw0KICAgIGNpdGllc0dyb3VwLmFkZChtYXJrZXIpOw0KICAgIGNpdHlNYXJrZXJzLnB1c2gobWFya2VyKTsNCg0KICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgZWwuY2xhc3NOYW1lID0gJ2xhYmVsIGNpdHktbGFiZWwnOw0KICAgIGVsLnRleHRDb250ZW50ID0gY2l0eS5uYW1lX2VuOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsYWJlbHMtY29udGFpbmVyJykuYXBwZW5kQ2hpbGQoZWwpOw0KDQogICAgY29uc3QgbGFiZWxQb3MgPSBjb252ZXJ0TGF0TG9uVG9WZWMzKGNpdHkubGF0LCBjaXR5LmxvbiwgRUFSVEhfUkFESVVTICsgMC4wMDUpOw0KDQogICAgbGFiZWxzLnB1c2goew0KICAgICAgZWxlbWVudDogZWwsDQogICAgICBwb3NpdGlvbjogbGFiZWxQb3MsDQogICAgICBjb2RlOiBudWxsLA0KICAgICAgdHlwZTogJ2NpdHknLA0KICAgICAgaW1wb3J0YW5jZTogY2l0eS5pbXBvcnRhbmNlLA0KICAgICAgbmFtZV9lbjogY2l0eS5uYW1lX2VuLA0KICAgICAgbmFtZV96aDogY2l0eS5uYW1lX3poIHx8IGNpdHkubmFtZV9lbiwNCiAgICAgIGNvdW50cnlfY29kZTogY2l0eS5jb3VudHJ5X2NvZGUNCiAgICB9KTsNCiAgfSk7DQoNCiAgZ2xvYmVBc3NlbWJseS5hZGQoY2l0aWVzR3JvdXApOw0KfQ0KDQovLyAtLS0g4piFIOaguOW/g+S/ruatoyAjMTog5paw5aKe55So5LqO6K6h566X55qE5Li05pe25Y+Y6YePIC0tLQ0KY29uc3QgY2FtZXJhVmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjMoKTsNCmNvbnN0IG1hcmtlcldvcmxkUG9zaXRpb24gPSBuZXcgVEhSRUUuVmVjdG9yMygpOw0KDQpleHBvcnQgZnVuY3Rpb24gdXBkYXRlQ2l0aWVzKGNhbWVyYSkgew0KICBjb25zdCBjYW1EaXN0YW5jZSA9IGNhbWVyYS5wb3NpdGlvbi5sZW5ndGgoKTsNCg0KICBjaXR5TWFya2Vycy5mb3JFYWNoKG1hcmtlciA9PiB7DQogICAgaWYgKGNhbURpc3RhbmNlID4gTUFSS0VSX1ZJU0lCSUxJVFlfVEhSRVNIT0xEKSB7DQogICAgICAgIG1hcmtlci52aXNpYmxlID0gZmFsc2U7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyAtLS0g4piFIOaguOW/g+S/ruatoyAjMjog5L2/55SoIG1hcmtlciDnmoTkuJbnlYzlnZDmoIfov5vooYzlj6/op4HmgKfliKTmlq0gLS0tDQogICAgLy8gMS4g6I635Y+W5qCH6K6w54K55Zyo5LiW55WM5Z2Q5qCH57O75Lit55qE55yf5a6e5L2N572uDQogICAgbWFya2VyLmdldFdvcmxkUG9zaXRpb24obWFya2VyV29ybGRQb3NpdGlvbik7DQoNCiAgICAvLyAyLiDlsIblhbbmoIflh4bljJbvvIzlvpfliLDku47lnLDnkIPkuK3lv4PmjIflkJHor6XngrnnmoTmlrnlkJHlkJHph48NCiAgICBjb25zdCBtYXJrZXJOb3JtYWwgPSBtYXJrZXJXb3JsZFBvc2l0aW9uLm5vcm1hbGl6ZSgpOw0KDQogICAgLy8gMy4g5LiO55u45py65LiW55WM5pa55ZCR6L+b6KGM5q+U6L6D77yI546w5Zyo5Lik5Liq5ZCR6YeP6YO95Zyo5ZCM5LiA5Liq5Z2Q5qCH57O75Lit77yJDQogICAgY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKGNhbWVyYVZlY3Rvcik7DQogICAgY29uc3QgZG90ID0gbWFya2VyTm9ybWFsLmRvdChjYW1lcmFWZWN0b3IpOw0KDQogICAgaWYgKGRvdCA8IC0wLjEpIHsNCiAgICAgICAgbWFya2VyLnZpc2libGUgPSB0cnVlOw0KICAgIH0gZWxzZSB7DQogICAgICAgIG1hcmtlci52aXNpYmxlID0gZmFsc2U7DQogICAgfQ0KDQogICAgY29uc3QgYmFzZVNjYWxlID0gMC4wMjsNCiAgICBjb25zdCBzY2FsZSA9IChjYW1EaXN0YW5jZSAvIEVBUlRIX1JBRElVUyAtIDEpICogYmFzZVNjYWxlOw0KICAgIGNvbnN0IGNsYW1wZWRTY2FsZSA9IE1hdGgubWF4KDAuMDA4LCBNYXRoLm1pbihzY2FsZSwgMC4wMykpOw0KICAgIG1hcmtlci5zY2FsZS5zZXQoY2xhbXBlZFNjYWxlLCBjbGFtcGVkU2NhbGUsIDEuMCk7DQogIH0pOw0KfQ==", "./modules/labels.js": "data:text/javascript;base64,Ly8gbW9kdWxlcy9sYWJlbHMuanMNCi8vIOiBjOi0o++8muS9nOS4uuagh+etvuezu+e7n+eahOKAnOaAu+aMh+aMpeKAne+8jOeuoeeQhueKtuaAgeW5tuiwg+W6piBzZWxlY3Rpb24g5ZKMIHJlbmRlcmVyIOaooeWdl+OAgg0KDQppbXBvcnQgKiBhcyBUSFJFRSBmcm9tICd0aHJlZSc7DQovLyAtLS0g4piFIOaguOW/g+S/ruatoyAjMTog5a+85YWlIGdsb2JlQXNzZW1ibHkgLS0tDQppbXBvcnQgeyBjYW1lcmEsIHJlbmRlcmVyLCBnbG9iZUFzc2VtYmx5IH0gZnJvbSAnLi9zY2VuZS5qcyc7DQppbXBvcnQgeyBzZWxlY3RXaW5uaW5nTGFiZWxzIH0gZnJvbSAnLi9sYWJlbC1zZWxlY3Rpb24uanMnOw0KaW1wb3J0IHsgcmVuZGVyTGFiZWxzIH0gZnJvbSAnLi9sYWJlbC1yZW5kZXJlci5qcyc7DQppbXBvcnQgeyBMQUJFTF9TRUxFQ1RfSU5URVJWQUxfTVMgfSBmcm9tICcuL2xhYmVsLWNvbnN0YW50cy5qcyc7DQoNCi8vIC0tLSDlhoXpg6jnirbmgIEgLS0tDQpjb25zdCBfc3RpY2t5ID0gbmV3IE1hcCgpOw0KY29uc3QgX3N0aWNrQnlMYWJlbCA9IG5ldyBNYXAoKTsNCmxldCBfbGFzdFNlbGVjdFRzID0gMDsNCmxldCBfc2VsZWN0ZWRDYWNoZSA9IFtdOw0KY29uc3QgdGVtcFZlYyA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7DQoNCi8vIC0tLSDkuLvmm7TmlrDlh73mlbAgLS0tDQpleHBvcnQgZnVuY3Rpb24gdXBkYXRlTGFiZWxzKGZvY3VzZWRDb3VudHJ5Q29kZSkgew0KICAvLyAtLS0g4piFIOaguOW/g+S/ruatoyAjMjog5Zyo6K6h566X5YmN77yM5by65Yi25pu05pawIGdsb2JlQXNzZW1ibHkg55qE5LiW55WM55+p6Zi1IC0tLQ0KICAvLyDov5nog73noa7kv53moIfnrb7kvY3nva7nmoTorqHnrpfkvb/nlKjnmoTmmK/lvZPliY3luKfmnIDmlrDnmoTlnLDnkIPml4vovaznirbmgIHvvIzop6PlhrPmoIfnrb7mtojlpLHnmoRidWfjgIINCiAgZ2xvYmVBc3NlbWJseS51cGRhdGVNYXRyaXhXb3JsZCh0cnVlKTsNCg0KICBjb25zdCByZWN0ID0gcmVuZGVyZXIuZG9tRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgY29uc3QgVyA9IHJlY3Qud2lkdGgsIEggPSByZWN0LmhlaWdodCwgTEVGVCA9IHJlY3QubGVmdCwgVE9QID0gcmVjdC50b3A7DQogIGNvbnN0IGNhbU4gPSBjYW1lcmEucG9zaXRpb24uY2xvbmUoKS5ub3JtYWxpemUoKTsNCiAgY29uc3Qgbm93ID0gcGVyZm9ybWFuY2Uubm93KCk7DQoNCiAgLy8gMS4g5a6a5pe2562b6YCJ5qCH562+ICjosIPnlKggc2VsZWN0aW9uIOaooeWdlykNCiAgaWYgKChub3cgLSBfbGFzdFNlbGVjdFRzKSA+PSBMQUJFTF9TRUxFQ1RfSU5URVJWQUxfTVMpIHsNCiAgICBfc2VsZWN0ZWRDYWNoZSA9IHNlbGVjdFdpbm5pbmdMYWJlbHMobm93LCBXLCBILCBMRUZULCBUT1AsIGNhbU4sIGZvY3VzZWRDb3VudHJ5Q29kZSwgX3N0aWNreSwgX3N0aWNrQnlMYWJlbCk7DQogICAgX2xhc3RTZWxlY3RUcyA9IG5vdzsNCiAgfQ0KDQogIC8vIDIuIOavj+S4gOW4p+mDvea4suafk+agh+etviAo6LCD55SoIHJlbmRlcmVyIOaooeWdlykNCiAgcmVuZGVyTGFiZWxzKF9zZWxlY3RlZENhY2hlLCBXLCBILCBMRUZULCBUT1AsIGNhbU4pOw0KfQ=="}}
</script>

  <style>
/*  */
html, body {
  margin: 0;
  padding: 0;
  background: #000;
  overflow: hidden;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

/* WebGL  */
canvas.webgl {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  display: block;
  z-index: 0;
}

/*  */
#labels-container {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  pointer-events: none;
  z-index: 2;
}

/*  */
.label {
  position: absolute;
  color: #ffffff;
  font-size: 14px;
  font-weight: 700;
  line-height: 1.2;
  text-shadow: 0 0 6px rgba(0,0,0,0.9), 0 0 2px rgba(0,0,0,0.9);
  transform: translate(-50%, -50%);
  white-space: nowrap;
  transition: opacity .15s linear, font-size 0.2s ease-out;
}

/*  */
.city-label {
    font-weight: 400 !important;
    color: #a8d5ff !important;
    text-shadow: 0 0 5px rgba(24, 73, 117, 0.9), 0 0 8px rgba(0, 0, 0, 0.9);
}

/* IDL  */
.idl-indicator {
  position: fixed;
  top: 50%;
  transform: translateY(-50%) scale(0.95);
  background: rgba(0, 0, 0, 0.65);
  backdrop-filter: blur(5px);
  color: #fff;
  padding: 8px 14px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  pointer-events: none;
  z-index: 2;
  opacity: 0;
  transition: opacity 0.4s ease, transform 0.4s ease;
}
#idl-indicator-left { left: 20px; }
#idl-indicator-right { right: 20px; }
.idl-indicator.visible {
  opacity: 1;
  transform: translateY(-50%) scale(1.0);
}

/* ---  :  --- */
.info-panel {
  position: fixed;
  /*  */
  top: 70px;
  left: 20px;
  width: 240px; /*  */
  background: rgba(25,35,50,.85);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(120,150,200,.4);
  border-radius: 8px; /*  */
  color: #f0f8ff;
  padding: 12px 16px; /*  */
  box-shadow: 0 8px Gdp rgba(0,0,0,.35);
  opacity: 0;
  transform: translateY(-16px);
  pointer-events: none;
  transition: opacity .25s ease, transform .25s ease;
  z-index: 3;
}
.info-panel.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
.info-header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom: 8px; /*  */
}
.info-header h3 {
  margin:0;
  font-size:17px; /*  */
  font-weight:600;
}
.info-close-btn {
  background: rgba(255,255,255,0.1); /*  */
  border: none;
  color:#f0f8ff;
  font-size:16px;
  cursor:pointer;
  line-height:1;
  padding: 0;
  width: 24px; /*  */
  height: 24px;
  border-radius: 50%; /*  */
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color .2s ease, transform .2s ease;
}
.info-close-btn:hover {
  background: rgba(255,123,90,0.8); /*  */
  transform: scale(1.1);
}
/*  display:grid  */
.info-body p {
  margin: 8px 0;
  font-size: 13px;
  display: grid;
  grid-template-columns: 80px 1fr; /*  */
  gap: 8px; /*  */
}
.info-body b {
  font-weight: 600;
  color:#87ceeb;
  opacity: 0.8;
}
/* ---  --- */

/*  UI  */
.ui-button {
  pointer-events: auto;
  background: rgba(25, 45, 70, 0.7);
  border: 1px solid rgba(135, 206, 250, 0.3);
  color: #e0f8ff;
  font-size: 14px;
  font-weight: 600;
  border-radius: 6px;
  padding: 9px 15px;
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.2s ease;
}
.ui-button:hover {
  background: rgba(45, 65, 90, 0.8);
  transform: scale(1.05);
}

/*  */
#language-switch-btn {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 2;
}

/*  */
#time-observer {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column-reverse;
  align-items: center;
  pointer-events: none;
  z-index: 2;
}

/*  */
#time-observer-main {
  background: radial-gradient(ellipse at center, rgba(25, 45, 70, 0.7) 0%, rgba(10, 20, 35, 0.85) 100%);
  backdrop-filter: blur(8px);
  color: #e0f8ff;
  font-family: Consolas, 'Courier New', Courier, monospace;
  font-size: 20px;
  font-weight: bold;
  padding: 10px 22px;
  border-radius: 8px;
  border: 1px solid rgba(135, 206, 250, 0.3);
  text-shadow: 0 0 8px rgba(176, 224, 255, 0.7), 0 0 3px rgba(255, 255, 255, 0.5);
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
  min-width: 250px;
  text-align: center;
}

#time-observer-hover {
  background: rgba(25, 45, 70, 0.8);
  color: #fff;
  font-size: 14px;
  font-weight: 600;
  padding: 5px 14px;
  border-radius: 5px;
  margin-top: 9px;
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 0.3s ease, transform 0.3s ease;
  white-space: nowrap;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

#time-observer-hover.visible {
  opacity: 1;
  transform: translateY(0);
}

/*  */
#settings-btn {
  position: fixed;
  bottom: 20px;
  left: 20px;
  z-index: 2;
}

/*  */
.settings-panel {
  position: fixed;
  bottom: 70px; /*  */
  left: 20px;
  width: 260px;
  background: rgba(25,35,50,.90);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(120,150,200,.4);
  border-radius: 10px;
  color: #f0f8ff;
  box-shadow: 0 8px Gdp rgba(0,0,0,.35);
  z-index: 3;
  opacity: 0;
  transform-origin: bottom left;
  transform: scale(0.95);
  pointer-events: none;
  transition: opacity .2s ease, transform .2s ease;
}
.settings-panel.visible {
  opacity: 1;
  transform: scale(1.0);
  pointer-events: auto;
}
.settings-header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 12px 16px;
  border-bottom: 1px solid rgba(120,150,200,.2);
}
.settings-header h3 {
  margin:0;
  font-size:16px;
  font-weight:600;
}
.settings-close-btn {
  background:none;
  border:none;
  color:#f0f8ff;
  font-size:20px;
  cursor:pointer;
  line-height:1;
  padding:2px 6px;
}
.settings-close-btn:hover {
  color:#ff7b5a;
}
.settings-body {
  padding: 12px 16px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 14px;
}

/*  */
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 44px;
  height: 24px;
}
.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #556688;
  transition: .4s;
  border-radius: 24px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: #4A90E2;
}
input:checked + .slider:before {
  transform: translateX(20px);
}

/*  */
.setting-item-slider {
  font-size: 14px;
}
.setting-item-slider label {
  display: block;
  margin-bottom: 8px;
}
.setting-item-slider div {
  display: flex;
  align-items: center;
  gap: 10px;
}
.setting-item-slider input[type="range"] {
  flex-grow: 1;
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 6px;
  background: #4a5a7a;
  border-radius: 5px;
  outline: none;
}
.setting-item-slider input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  background: #c0d0f0;
  cursor: pointer;
  border-radius: 50%;
}
.setting-item-slider input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  background: #c0d0f0;
  cursor: pointer;
  border-radius: 50%;
}
#normal-scale-value {
  width: 2.5em;
  text-align: right;
  font-family: monospace;
  color: #a0b0e0;
}

/*  */
#toggle-stand-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 2;
}
</style>
</head>
<body>
  <div id="labels-container"></div>

  <div id="idl-indicator-left" class="idl-indicator"> Earlier Day</div>
  <div id="idl-indicator-right" class="idl-indicator">Later Day </div>

  <div id="info-panel" class="info-panel">
    <div class="info-header">
      <h3 id="info-country-name"></h3>
      <button id="info-close-btn" class="info-close-btn">&times;</button>
    </div>
    <div id="info-body" class="info-body"></div>
  </div>

  <button id="language-switch-btn" class="ui-button"></button>

  <button id="settings-btn" class="ui-button"></button>

  <div id="settings-panel" class="settings-panel">
    <div class="settings-header">
      <h3></h3>
      <button id="settings-close-btn" class="settings-close-btn">&times;</button>
    </div>
    <div class="settings-body">
      <div class="setting-item">
        <label for="night-mode-toggle"></label>
        <label class="toggle-switch">
          <input type="checkbox" id="night-mode-toggle">
          <span class="slider"></span>
        </label>
      </div>
      <div class="setting-item">
        <label for="cloud-toggle"></label>
        <label class="toggle-switch">
          <input type="checkbox" id="cloud-toggle">
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </div>

  <div id="time-observer">
    <div id="time-observer-hover"></div>
    <div id="time-observer-main">--:--</div>
  </div>

  <button id="toggle-stand-btn" class="ui-button"></button>

  <script>
function tzlookup(Y,W){var X="XKXJXJXIXIXSXSXRXRXQXQXP##U;U;U;#$UZUZUZUZUZXHXGXGXTXTXXXXXYXYXZXZY#Y#Y$Y$Y%Y%Y&Y&Y'Y'XUXUXVXVXWXKXJXJXIXIXSXSU:U$#%#&V,#'U;#(#)UZUZUZUZUZ#*UZXGXGVPVPVP#+YIYIYIYI#,W@W@W@W@W@W@Y&X/X/X/X/X/XVXWVTUV#-T,T,#.U:U:#/#0#1#2#3U;U;U;UZUZUZUZ#4#5YJYJXGYJ#6#7#8YIYIYI#9X1#:W@W@W@#;X/X/#<#=#>#?#@VTVT#A#B#CT,T,#D#E#F#G#H#IV,#J#K#L#MUZUZUZUZX9X9#N#OYJ#P#Q#R#SYI#T#U#VX1#W#XW@W@#Y#ZX/$#$$$%$&$'$($)$*$+$,T,T,$-$.$/U$$0$1$2$3$4$5$6$7UZUZXLXLXH$8$9$:$;$<$=$>YI$?$@$A$B$C$D$E$FW6$G$H$I$J$K$LW;$MT+T+T+XJXIXIXSVB$N$O$P$Q$R$S$T$U$V$WV7XMXLXLXHY6$X$Y$Z%#%$%%%&%'%(%)VR%*%+%,%-%.%/%0%1%2%3%4W;XVT+XKXJXJXIXIXSXSUC%5%6%7TN%8%9%:%;U0XMXMX3X3XH%<%=%>%?%@%A%B%C%D%E%F%G%HX+%I%J%KWX%L%M%N%OXUXVXVXWXKXJXJXIXIXSXSUC%P%Q%RTN%SUUXOX4XNXMXMXLX3X8%T%US2%V%W%X%Y%Z&#&$&%&&&'WXWXWXWXWX&(&)X(XUXUXVXVXW&*ZCZCXIXIXSXSXR&+&,&-&.&/&0UTXNXNXMXMXLXL&1&2&3S2&4T(&5&6WT&7&8&9&:&;&<&=&>&?&@&AX(X(XUX(XVXVXWXKZCZCZCXIXSXSXRUK&B&C&D&E&F&G&HXNXMXMXLX6&I&J&K&L&M&N&O&P&Q&R&SWHW?W?&T&U&V&W&X&YY'X(ZUXUXVZYXWXKXJXJXIXIXSXSXRXRXQXQ&Z'#'$'%'&''XMXMXLX6'(')'*'+','-'.'/'0'1VQXZW?'2Y$'3'4'5'6WGZPZ9'7'8ZH'9XWXKXJZEZEXIXSXSXRXRXQXQZ?':';'<'='>'?XMXLUWXH'@'A'B'C'D'E'F'G'HXZXZZ1W*Y$'I'J'K'L'M'NW8Z9'O'P'QZWZDZDXJZEXIXSXSXRXRXQXQZ?'R'S'TUG'U'V'W'XXLXHXHXGSS'Y'Z(#($(%XYZ0XZ(&Y#Y$Y$W7('((()W8(*ZS(+ZA(,(-(.(/ZTZE(0(1XSXRXRXQXQXPUBUB(2(3(4(5(6(7XLXHX;XGXGSP(8(9(:(;(<Z2XZY#Y#Y$Z-Y%(=(>(?(@(A(B(CZA(D(E(FZLZT(GZV(HXSXRXRXQXQXPXPUB(I(J(K(L(MXLV3XHXHX;XG(N(O(P(Q(RZ*(SZ2Y#Y#Y$Y$Y%Y%XEXE(T(UX>X>ZN(VZ=(WXJXJZVZVZ@(XZQXRZ:XQXPXPV1(Y(Z)#V3V3XLXLXHXHXGXGT*)$)%)&Z*Z*XZXZY#Y#Y$Y$Y%Y%XEXE)')()))*XV)+XWZ6XJXJXIXIXSXSXRXRXQXQXPXPV1),)-).V3XMXLXLXHX;XGXGXTSG)/SGXYXYXZXZY#Y#Y$Y$Y%Y%XE)0)1)2)3XFXCZ6Z6Z8XJXJXIXIXSXSXRXRXQXQXPXPTR)4)5T0XMXMXLXLXHX;XGXGXTXTXXXXXYXYXZXZY#Z/Y$Y$Y%Y%Y&Y&Y')6)7XDXVZ6Z6XKXJXJXIXIXSXSXRXRXQXQXPXP)8)9):X<XMXMXLXLXHXHXGXGXTXTXXSGSGZ/Z/XZZ/Y#Y$Y$Y%Y%Y&Y&Y'Y'XUXUXVZ6Z6XKXJXJXIXIXSXSXRXRXQXQXPXPV+);)<X<XMX:X:X:XHXHXGXGXTXTXXXXXYXYXZXZY#Y#Y$Y$Y%Y%Y&Y&Y'Y'XUXUVIZ6XWXKXJXJXIXIXSXSXRXRXQXQXPXPVLVL)=)>T;T;XLXLXHXHXGXGXTXTVMVMVMVM)?VJVJVG)@VOVFVFVFVHVHVHVHVH)AVKXWXKXJXJXIXIXSXSXRXRXQXQXPXPVLVLT;T;T;T;)BVL)CY()DVNVNVN)EVMVMVM)FVJVJ)G)HVO)I)J)K)L)M)N)O)P)QVKVKVKVKVKVKXIXSXSXRXRXQXQXPXPVLVLT;T;T;T;)RVL)SY()TVNVNVN)UVMVMVM)VVJVJ)W)XVOVOVO)YXEXEXEXEXE)ZVKVKVKVKVKVKVKVKVKVKVKVKVKVKVK*#*$*%*&*'*(*)***+*,*-*.*/*0*1*2*3*4*5*6*7*8*9*:*;*<*=*>*?*@*A*B*CVKVKXPXPV,*CXNXNU;UZ*BTH*CTHTHV,THV,V,*BV,*CU;*CV>V>*CUZ*DUZUZUZTV*DVP*DVPXXY#W@YIY#XJT,UVT,XSXS*B*CU$U$*C*D*DTH*ETHTH*ETHTH*EV,THTHV,*E*F*GUZ*GUZ*HUZUZV4XHVPVPYJ*GYJYJ*G*HXXXX*HYIYIX1YI*H*HW@X1*IW@*I*J*KX/*KX/*L*L*MX.*N*N*OWZWZ*OWZWZWZXVXVWZ*OVTVTVTUV*NUVUVUVUVT,UVT,*MVC*NVC*NU:VC*OU:U:*OU:U$*OU$U$*O*PU$U$THV,U$V,V,*OV,*P*PU;*Q*RU;U;*RU;U;U;U;*RX9XHXHX7XGXGX7YBYJ*PYJ*QYWYWYW*Q*QY9Y9*R*RYIYIYIYIYI*RYIYIYI*R*S*S*TX1X1X1X1*T*U*UW@*VW@*VX/*W*XX/X/*XX/X/*XX/*Y*Y*ZW>+#+#WZ+$WE+$+%WEWE+%+&WE+'VTVTW;+'VTVT+'VTXKUVXKT+UVUVT+UV+%T,UVT,VE+%XSV5+%VB+&VB+&+'VB+(+(V.+)+*V.VD+*VDVD+*VDVDV,+*V@++U;++U;V@V@++V@V@++U*+,U*XNXNU*V7YBYBXH++YBYB++YBXGYJYB+++++,+-+.YW+.+/+0+0+1+2+3YIYI+3YI+3+4+5+6+6X1+7X1X1X1+7+8X1+8+9+:+:+;+<+=+=+>+?+@W@W@W@+@+@+AW6W6W6+A+BW)X/X/+B+CX/+CX/X.X.X.X.+CX.WEWUXUWE+BXUW;W;W;W;T+VB+A+B+C+C+D+E+F+F+GTYTYV.VD+G+HVDVDTN+HV@V@+H+I+IV@V@V@V@V@V@+IV@+I+J+K+KV7+LV7+L+MYKYK+M+NYK+O+O+P+Q+R+R+S+T+U+U+V+W+X+X+Y+Z,#,#,$,%,&,&,',(,),),*,+VV,+,,,-,.VR,.VRVR,.,/,0X+,0,1,2X*X*,2X*X*,2,3X*X*,3,4X*,5,5,6WXWX,6,7,8,9X.,9X.,:WUXUWUWEWZ,9,:WZ,:,;UC,<,<TYTYTYTY,<TYTN,<,=,>,?,?,@UUUU,@UUUUUU,@U0XNXNXH,@XHY@,@,A,BYD,B,CYDYD,C,DYOYO,D,EYO,F,F,G,H,I,I,JY;Y;,J,KY;,L,L,M,N,O,O,PVW,Q,Q,R,S,T,T,U,V,W,W,X,YX+X+,YWXWX,Y,ZWXWX,Z-#WXWXWX-#WX-$-$X.-%Y'X.X(X(X(-$WEXUXUUC-$-%-&-&TY-'-(-(TN-)TNTN-)TN-*XH-*XHS<-*-+S<-,-,---.-/YOY,T(T(Y,-.-/S;-/-0S;-1-1-2-3-4-4X&-5X&X&-5X&X&-5-6-7-8-8-9-:-;-;-<-=->WXWWWXWW-=X(X(X(ZJZCXKZCV?-<XRUK-<-=UK->->-?-@-ATNTN-AUMTN-AUM-B-BUT-CUTXHX5XHSC-B-C-DT$S2S2-D-E-ET(-F-G-GS;-HS;S;-HS;-I-I-JWT-KX&-K-L-M-MW<-NW<-N-O-PW?W?-PW?W?-P-QW?-R-R-S-T-U-UWX-V-WWXWX-WWXWXWX-W-XWXX(-XX(UK-XUKXQ-X-YUNUNUNUMUN-Y-YU1-ZV=-Z.#.$.%.%V2.&.'VAT-.'.(XH.(X6.).)T$.*T$.*S4.+S4.+.,S4T#.,T#T#T#SZ.,SZSZ.,SJ.-SJ.-SJSJ....WT./.0WTWT.0VQ.0WH.1WHW?.1W?Y$.1X0X0X0.1.2.3.4.4WX.5.6.6X#WX.7.7Y&WGY&XP.7XPXP.7UFXPTQTFTFV$.7TF.7.8TKTK.8TK.9TAXNU/XNXH.8XHS7.8.9.:.;.;.<.=.>.>.?.@SM.@.ASM.B.BSZ.C.DSJSJ.D.ESJ.E.FS1.F.GS1.H.H.ISWSWW?W?W?.IW?.IW?.J.J.K.L.M.MW3W3W3.M.N.OWGZBXUZ9Z9XUXUZ9ZRZHZH.MZHTQV$Z?XP.LTF.MTFTF.MTF.NTK.N.O.P.P.Q.R.S.SXMTBTBSD.SXHXHS/.SXGXG.SSMXGT'.SSB.T.U.U.V.WSL.W.X.Y.ZSH.Z/#/$S1/$SYSW/$SWSWXYW?W7Y$W7/#/$W7/%W7W7W7/%/%/&/'WFWG/'WF/(ZPZP/(/)Z9ZRXUZRZRZFXVXVZHZHXVZWZ?UBXPUB/%/&/'UB/'/(/)/*/*V0/+V0TB/+TB/,U(U(U(/,U(UWU(UWSN/+SN/,/,/-/./////0SQ/1/1/2S@S@/2/3/4XYY#Z1Z+Z+W7WOW7/3/3WF/4WFWFW8WF/4W8/4W8/5ZSZ7ZS/5ZKZWXVXVZWZWZ>Z>Z>Z<ZZ/3/3ZT/4/5ZEXIZVZVZIZIZVZV/3/4UB/5/5/6UA/7/7/8TTTT/8/9/:/;/;/<T?/=/=XLT?XLSP/=SPSPSQ/=/>/?/?S@/@/AS@Z.ST/AZ0Z0/AZ*/AW7Y%Y%/AWFY&Y&WF/AXEXE/A/B/CX@/C/DX@X>/DZSX>XUZS/DZSZSZAXV/DZAXWZ>XWZ=Z=ZX/CZXZVZV/CZVZVZVZV/CUB/CUB/DUAUA/D/E/E/F/G/H/HV3/IV3V3/IV3V3XT/IXTT*/ISPT*/J/J/KSE/L/L/M/NSTSTZ*XYZ*XZZ2Z4Z2/LX@/MX@X@X>/MX>Z;Z;ZN/MZXZXZ6XKZ@ZQXSXSXOV1V1/K/K/L/MT2/M/N/O/PT*/P/Q/R/R/SSG/T/TST/UXX/UX@/VX=X@X>X=/VX>X>/V/WX>X>/W/XZNZNZMXVV1/WV1/X/X/Y/Z0#0#0$0%0&SG0&SGSGXE0&XEXE0&X=Y'X=X=0&X=0'XFXF0'0(0(0)0*T1T70*0+T7Y'0+Y'Y'0+0,XBXBXOTRXOV+0+0,0-0.0.XNT6X<V+0.XOV+T;0.XNXNV+V+T;T;0-T;T;T;XZXZ0-VJY$Y$VGVOXVXV0,VKXLXL0,VLXH0,VL0-0-SG0.SG0.VM0/VM0/VJ00VJ00VG01VGVGVOVGVO0001VOVO0102VOVO020304XE0405XEXE0506XEXE0607XEXE0708XEXE0809XEXE09VK0:VK0:VL0;VLVL0;VL0<0<SG0=SG0=VM0>VM0>VJ0?VJ0?VG0@VGVGVOVGVO0?XE0@XE0@VK0AVK0AVLVKVKVLVLVKVKT;T;VKVKT;T;VKVKT;T;VKVKT;T;VKVK0<VLVKVKVLVLVKVKVL0;VKVKY(Y(VKVK0:SGVKVKVNVNVKVKVNVNVKVKVNVNVKVK07VMVKVKVMVMVKVKVMVMVKVKVMVMVKVK04VJVKVKVJVJVKVKVJVJVKVK02VGVKVKVGVOVKVKVOVOVKVKVOVOVKVKVOVOVKVK0.XEVKVKXEXEVKVKXEXEVKVKXEXEVKVKXEXEVKVKXEXEVKVK0)VKVKVKXPXPV,U;XQXQU$THU$THU$THV,U;V,U;V,U;V,U;U;U;U;UZU;U;UZUZV>UZV>V>TVTVUZUZXXXXVPYIT,TWT,TWTWU:VCU:U$U$THTHU$U$THTHU$THU$THU$THTHTHV,V,THTHV,V,THTHV,U;V,U;V,V,THV,V,U;V,U;UZUZUZV4UZV4UZUZYJYJYWYWYJYJ/IY9YJYJY9YI/HYIYIYIYIX1/HX1X1W@X1X1X1W@X1X1W@X/W@X/W@W@W@X/W@X/X/X/Y'X/X.X.X/X.X/X.X/X/X.X.X/X/X.X.X.X.X.WZX/X/X.WZX/X/WZWZX/XUWZWZWZVTVTVTVTVTVTUVT,TWT,TWT,TWT,TWVCU:VCVCVCU:VCVCU:U:VCU:THTHU$U$THTHU$U$THTHU$THV,U;T>T>T>T>V,U;U;U;T>U;T>U;U;U;U;U;U;V@U;U;V@V@U;XNU*XNYJYJ/*YWYWYW/*YWYW/*/+/,YWY9/,Y9Y9Y9/,/-YIYI/-YIYIYIYI/-YIYIYIX1YIYIX1X1YIYIX1X1/*X1X1X1X1X1X1/*X1X1/*X1W@W@X1W@X1W@X1W@W@X/W@X/W@W6W6W6X/X/W6X/X/X/X//%X.X.X/W>X//$X/W>X.X.W>W>WZWZW>X,W>X,X.X.WZWZX,WZX,WEX.X.WZWZWZWEWZWZWEWEWZVTWEWEVTVTWEW;WEW;W;W;W;VTW;W;VTVTW;VTUVT,XJXJVBU=U=V5.NVBV5VBV5V5VBVBU'U'VBVBU'U'TXTXVBTXVBVBU$V.U$V.U$V.U$.IV.V.V<V.V..HV..IV,V,VDV,V,U;V,U;V@U;V@V@V@V@U;V@V@U;V@V@U;V@V@V@V@V@U*U*Y6.BY6Y6.BYB.C.DXGXGY).DYJ.D.E.F.FYW.GYW.G.HY.Y..H.IY..J.J.K.L.M.M.NZ'Z'.N.OZ'Z'.OYX.P.Q.Q.R.SYI.S.T.U.V.V.WYGYG.WYI.X.YYIY>YI.Y.Y.Z/#/$/$/%/&/'YI/'/(/)/)X1/*/+/+X1/,X1X1X1/,WRX1X1WRVRX1X1WLWL/*/+VRVRWLWLVRVR/*X)/+/,X)X)/,X)/,WKVR/-WKWKW%/-X)X)X)/-X)W@X)W@/,/-/.//WJ///0/1W@/1W@W@W@W@/1W6W@W@W6W6W6X/W)W)W6W6W6W)W)X/W)/.X/X//.X/X/X.X.X.X.WUX.WUWEWEW;W;VBVB/+VBVBUCXRUC/*UCUCUCVB/*/+/,U$U$/,/-UCUCUC/-TYTYUCTYU$V<U$V<V<V.V<V.TY/*TYTYTNTN/*TN/*TNTN/+/+TZ/,/-V@V@/-/.V@U;V@V@V@/-/.//TDTDV@TD/.UPUP//U0U0U0U)TD/.V7V7V7V7U)UO/-YBYB/.YBYB/./////0YK/1/1/2/3/4YK/4YK/5Y.Y./5Y.Y./5/6/7/7/8/9/:/:/;/</=/=Z'/>/?Z'Z'/?/@/@/A/B/C/C/D/E/F/F/G/HY?/H/IY?Y?/I/JY1Y1/J/KY1/L/L/MY?Y?/MYI/N/OY?Y?Y?/OY?Y?/O/PYIYI/P/Q/Q/R/SZ&/S/TYIYI/T/UYIYI/UYSZ&/V/V/WWMWM/W/XYI/YVXVXVX/Y/YX1WMVV/Y/ZVVVVVXVV/Z0#X1WRVVWRWRVRWRWRVVVVWSWSVRVRWSWSW%/WVRVRW%W%VRVRW%W@W%W%VRVR/UX+W@W@W5W5W@W@W5X*W5W5X+W5W6W6X*X*W6W6/QX*/QW)W)W)W)W)X*X*W)W)/P/QX*WXWXWX/PWXWXWXWXWXWX/PX/X//PX//PX.X.X.WX/PWXWX/PWX/Q/RX.WUX.WUX.WUX./QWZW;WZWZWEWZWEWEUC/OUCUCTGTG/O/PUC/PUCTY/PTY/QTY/QTNTNTNTN/QTN/RTZTZ/R/STN/STN/T/TUU/UUUV@/U/V/W/W/XUUUU/XUUUUUU/XU0XNXNYDYDYD/XYDYD/XYDYD/XYD/Y/YYD/ZYDYKYK/Z0#YK0#YKYK0#YO0$0%0%0&YOYO0&0'0(0)0)0*0+0,0,0-Y,Y,0-0.0/0000010203Y,03Y,04Y;Y;04Y;XXYTY;Y;YT03Y;Y;YI03Y;04YIYI0405Y;05Y;06YIYI0607VUVUW#VU06070809W#W#09XYVUVUVWVUWVWVWV08VWVW0809WVWS09WVWSWSWVVRVW08VW09WV090:0;0;VR0<0=VRVR0=0>0>0?0@0A0A0BW/W/VRVR0B0CVRX+X+X+0BX+X+X+X+X*WXWXX*X*WXWXX*X*WXX*X*X*X*0?X*WX0?WXWXWXWX0?0?0@WP0AWX0A0B0CWPWP0CWWX(0CX(X(0C0D0E0FUC0FXRV?0FV&0GU20GTY0H0IV&0I0J0KTYTYTP0KTY0KTYTNTY0KTNTN0KUU0LUU0LUU0MUUXHY@XHS<0L0MS<S<YD0M0N0OS<0OS2S20OT)0PT)YO0PT)YE0PT)S2T(0PT(T(T(0P0QY,XXT(T(T(S;Y;Y;XX0P0P0Q0R0S0S0T0UVS0U0VW+0W0W0XVYVYVSVYWT0XVYVYWTVY0WX&0XX&0X0YVY0ZX&0ZX&X&0ZVW1#1$1$1%W:W:W:W:1%W:W:W:W:1%1%1&W:1'1'1(1)1*1*1+W<W<W<1+W<1,X+X+W<W?X+WXWXWX1*W?W?W?WXWXW?WXWWWW1)1*V?1*UKUKU2U21*U2TO1*TO1+UKUQUK1+1+UJ1,1-1-TN1.1/UQUQ1/UN1/1011UQ11XPUQXP11UUXPUUXPUUU1U1UUUUUU10UU1011UTX5S<1112S<S<SC12SCSCSCT$T$S2T$S4S2S2S4S2S2T(S2T(S2T(S2S2T(T(T#T(T(1,T(S;T(S;T(S;1+1,1-WTS;1-S;S;1-1.WTWT1.X&1/X&1/10WTWTX&X&10X&1011W.1212X&WHWH12W<X&13X&W<WHXZW<W<W<121213W?W?W<13W?W?13W=W?1414WX1516WXWX16171718W?19WXWX19W?W?WX19X0191:1;W?1;X0X0X0WXWXX0WX1:WX1;WXWXWXWX1;WXWX1;WXWXWX1;1<WX1<WX1=1=1>X#X(UK1>XQUN1>UNUNUNUN1>UNUNUN1>UNU-UM1>1?TJ1?TCU-1@U1U1TMTMU1UTU1U1XOXOV=TFU<1=U<XOUTU+U1V'V'1<XOXOV21<XOXOV*1<XNTK1<T.US1=1=SCT$T$XHT$S?1=SCT$T$T$T$T$S?T$T$S4T$S4T$S4T$S4S2S2S4S4S2S2S218S2T#T#T#SZT(SZSZT(SJSZSJSZSJSZSJ14SJSJSJSJSJSJ1414WTSJWT14WTS3S3WT1415VQWTWTVQVQWTWTWTWHWHWHVQWHW?12W?Y$W,12Y$X0X0121314X-W$X-X-13W$14W$1415W$16W$16W$1717W3X-18WXWXW3WX17WXY&Y&Y&WGWXWG16WGWGWG16U-XPXP1617U&UFV$TFV$TFXOXO1617TF17TF18XN18TKV;TK18TKTK1819S?1:S?1:S7S>S4S4S41:S>S>1:SDS>1:1;S>S4S4S41;1;T%T%T%1;1<S/S/T%1<1=S01=T#T%T#1=T#1>SM1>T&1?1@T#T#SM1@T#SZSM1@SM1@1ASBSZSZ1ASZ1ASZSZ1BSZSZS5S5SJSJS5SHSJ1@SHSHSJ1@SJS1SJSHSHSH1?1@S1S11@VQ1A1BS1SWS1S1VQVQVQSWVQVQSWSW1?W*1@W*W?X0W?X0Y$X0W?W$X0W$X01>1>1?1@WN1@W$W$W$WNWNW$W3WN1?WN1@Y&Y&W3WGWXWGY&WGWXWGW3WBZHZGZHZHV$V$TFXOXOTFU.U.TF1:TFTFTFTFTFUGTKU/TKTETKTKUGUGTETEUGTEU/16U/V%V%TLV%TLU/U/TEV0V%TLV0TBXMXM13XMSX13SXSX13S014S01415S0XGSM1516SBSSSBSN16SBSBSNS9S5S5S515S5S5SLS5SBS9S914S5S514SQSHSHSQ1414SQSQSQSQSQSQ14S1S1SHS113SI14SISISY14SYS1S1S1SWS1SWSWSWW$12W7WA12WAWAWA12WA1314W7WB14WOW(WB1415WBWG15WBWBWFWOWFWG14WFWFWFWFWFW8W8ZPW8W8ZPY'W8W8U.U.1112U.U.12UBUB12UBUBTFTFUBUBTFUGTFUGUBUBUBU%U%UGU%UGUGV0UGUGUGV0UGV0TBU(TBU(1+U(1,U(U(U(1,U(SN1,S9S91,1-1.1/S91/S9SLSLSLSLSQ1.SLSPSL1.SQSLSQSLSQSQSQSQ1-SQ1.SQ1.SQSQ1.SI1/S@1/SYS@10SYSY10SYSWSWSYXY1/10S@S@W7WOW7W7WOWOWO1/WOWFW7W7WFW8WFW8W8ZSW8ZSW8ZSW8ZSZ7Z7Z7ZAZZXKZZZ5Z<XJZOXJZOXJZ5ZOXJZTZOXJ1&V/UBUBV/U%V/1&UBUAUBUAUG1%UAV)V)UGV)TTV)1$UAUAUGV0TTTTV0V0TTTTTBTBTTT/T/U(T/U(TTT/TTV3T/0W0XT?U(U(T?T?0W0X0Y0ZT?0ZT?T?0Z1#UEUESPSPSP1#SQSQSQSRSPSRSRSR0Y0ZSRSR0Z1#SRSRSR1#SR1$1$ST1%STZ.Z.XYZ3Z3Z*Z3Z*W7W7Z,Y%W70ZY&Y&WFW-WFW-W8W8Y'X@W8Y'X@X@Y'X@XEX@Y'W8X@X@W8ZSY'X>ZSZSX>X>ZAZAZSZSZAZAZ;Z;Z=Z=Z=ZXZTXIXIZVZVZVZVZ@UBUA0NUAV10NV10OUAUAUA0OUAT=0OT=TTTTUATITTTTTITIT=0MT=TITITI0MTI0MV3V3V30MV30NV30NT?0OT?SPSPT*T*SPSP0NT*T*SET*SESRSRSE0MSR0M0NSFSFSF0N0OSFSTSFSF0NSTSTSTSF0N0OSTXEX@XEX@XEX@XEX@X@0MX@X@Z;XVZNZNV1T10L0MT30MT70N0NT=T2T20N0O0P0QT=T=0Q0R0R0S0TV3T2T=T20T0T0U0VV3T*SET*SET*T*T*SGT*SGSGSGSESESE0S0SSGSGSGSGSG0S0TSGST0TST0TSGSGSGXEX@XEX@XEX=XEX=X=X>X=XFX>X>XFXFX>X>XF0PX>X>0P0QX>XUXFXU0PT80Q0R0RT50S0TT4T2T90TT2T2T20TT90TT7T70T0U0VT0T20V0W0X0XV3UR0Y0Y0ZT0T0URURT0XN0YSGSGSGXEXEXEXA0XX=XAY'X=XFX=0XX=0XX=0YXFXFXD0YXFXF0YXFV1V1V10Y0YT7T7T7V10YTRTRT0T00YT0T10YT1T1X=0YY'Y'XDXDXBXB0XXDXBXBTR0XTRT60X0YT6T6V+T6V+V+T6T60XT60XT1T6T6V+T;V+V+XNX<T;XNT;T;V+T;VMVJVMVJVHVKVHVKXLXLT;VLXHXHVLY(VLY(VLY(Y(SGY(SGY(SGY(SGVNVMVNVMVNVMVNVMVMVJVMVJVMVJVMVJVJVGVJVGVJVGVJVGVFVFVOVOVFVFVOVOVFVFVOVOVFVFVOVOVFVFVOXEVFVFXEXEVOXEVOXEVHVHXEXEVHVHXEXEVHVHXEXEVHVHXEXEVHVHXEXEVHVHXEXEVHVHXEXEVHVHXEXEVHVHXEXEVHVHXEXEVHVKXEVKXEVKXEVKT;VLT;VLT;VLT;VLVLY(VLY(VLY(VLY(Y(SGY(SGY(SGY(SGVNVMVNVMVNVMVNVMVMVJVMVJVMVJVMVJVJVGVJVGVJVGVJVGVOXEVOXEVOXEVOXEXEVKXEVKXEVKXEVKXOVLVKVLT;VLT;VLVLY(VLY(Y(SGY(SGVNVMVNVMVMVJVMVJVJVGVJVGVOXEVOXEXEVKXEVKYJYJ/T/UYJYJ/UYIYIX1YIYIYJYJYJ/TYJ/TYJYW/TY9Y9Y9XTY9/TYFY9Y9/TY9YW/TY9Y9Y9Y9/T/UY9/UYIYIYIYI/UYIYIYI/UY>YIX1X1X1X1X1/T/UX1X1X)X)X/X//TW6X/W>X/X/VBVBU=VBU$V<U$V<V.VDV.VDV./PV.V.Y6Y6Y6/PYBYB/PYB/P/QY6Y6Y:/QYBYBY)Y.Y)/QYJYJYJ/QYJY5Y5Y5Y5/PY5Y5/PYWYWYWYWYWY5YWY5Y5/O/PY5Y5/P/QY5/QY5Y5YW/Q/R/SY./SY./TYWYFYWYWYFY9YXYXYWYWYWYNYN/QYN/R/RYWY5Z'YWXTZ'Z'XTY=/QY=/QZ%Y=/RY9/RYXYXYNYNYN/RYN/RYNYN/R/SYXYI/SYIYIYI/SYIYN/TZ%Z%/TZ%Z%Z%Z%/T/T/UZ'/V/V/WYGYG/WYGYGYG/WYGYGYGYIYIYGYIYG/VYGYGYIYI/VYI/VY>/WYI/WY>Y>Y>Y>Y>Y>/WY>Y>YIY>Y>YP/VYPYIYIYI/VYIYIYI/VYI/VYIYIYZYZYZ/V/V/W/X/Y/Y/ZYPYPYP/ZYP0#Y>X10#X1YP0#0$0%X1X10%X10%0&0'0(0(X1X1X1X10(X1WRX1X1VRVRX1WLVR0'0'0(0)X)WLX)WLWKX)X)WKWKX)X)WKX)WKWKWLWKWK0%VR0&0&WKW%W%X)X)X)0&WK0&WKWK0&WJ0'WJWK0'W%W%W%0'W%W%0'0(W@W@0(WJW%WJWJW@WJW@W@0'W@W60'W6W6W6X/X/WXWXX/X/WXWXVBVB0%0&0&UCUCUCU$U$VBU$VBVB0%0&VBVB0&TSU$U$0&U$U$U$U$0&UCUCUC0&TNTN0&UX0&TNTYTN0&TNTNTNTN0&TNTNV@V@TZTZ0%TZTNTN0%TZ0&0'TZ0'TZTZ0'V@TZ0(V@V@UU0(V@UUV@UUUU0'UU0(V@V@UPUPUPU0UPU0U*V70&V7Y6Y6XGYBYBYBYKYKYB0$YK0%YBYBYKYKYBYBYB0$YBY)0$0%YK0%YKYKY)Y)0%0&0&0'0(Y.0(0)YKYK0)Y.0*0+YKYKYK0+0+0,YK0-Y.Y.0-Y.Y.0-0.0/Y.0/Y.0000YM01YM01Y.0203Y.Y.03040405YO060607YOYOY.070809090:Z$Z$YO0:YOYO0:0;0<0=Z'Z'0=Z'YM0=0>0?0?0@0A0BZ'Z'0B0CZ'Z'0C0DZ$0DZ$0E0EY/0F0G0G0H0I0J0JY20K0L0L0MY2Y20M0NY20O0O0P0QY-0QY10RY10R0SZ'0T0T0UY?Y?0U0VY?Y?0VYGY?Y?YGYGY?Y?0U0VY1Y1Y?0VY1Y10V0WY10X0XY?Y40Y0Y0Z1#1$1$1%1&Y?1&Y?Y?Y?YIYIY?1&Y?1&Y?Y?1&1'Y?Y?Y?1'YTYT1'Y?YTYTY?Y?YTYI1&1'Y?Y?YIYI1'YIYI1'1(1)1)1*1+1,Z&Z&YIZ&Y?Y?1+1,1,YIYIYIYI1,YI1-Z&1-1.YI1.YS1/1010YSWMWMYS10YSWM10X1WMWM1011YIYIWMWMY+11Y+Y+YIY+VXVXVUVUX1X11/WMX1X1X11/X1X11/X1VX1/10VU10VUVUVUW%W%10W%X+X+10X+X*10X*X*W6W610W)10W)WX1111WXWXWXW)WXWXWXWX10WXWX10X/WXWXX/X.X.X.WXX.WXWXX.X.WXWXWXWX1-WX1-X.1.X.WUWUX(1.UCTGTGTGTGTGUCUCTGTGTYTY1+TYTYTYTGTYTGTGTGTG1*TY1*TNTNTNTN1*TNTZTNTZTN1*TZTZ1*TZTZ1*1+1,1,1-1.U31.1/1011U311U312U31213UUV@V@V@1313V@14UU1415UUUUV@V@1516V@16UUUU16UUUUUU16U0U0U0YDYD1617YDYD1718YKYK18YK1819YDYD19YD1:YD1:YDYDYD1:1;YDYD1;1<YDYDYK1<YK1=1=YO1>YOYKYKYK1>1>YO1?YOYOYOYO1?Z(Z(YOZ(1>1?Z(Z(YRYR1?YRZ(Z(YOYO1>1?YOYL1?Y-YRY-Y-1?Y-1@1@1A1B1CY-1C1DYUYYYYY,Y,1C1DY,Y,1DY11E1FY1Y11F1GYVYV1G1HYVYV1HYV1H1I1J1KY1Y11KXXYVYV1KY;YVXXY;Y;Y,1JY,Y;Y,Y,Y,1J1JY;1KY;YTYIXXXXYIYI1JYIX%X%Y;Y;X%X%X%1IX%1IX%X%1IX21J1KY;1KY;1L1LYI1MX%YIYI1M1N1NW#1O1PW#W#W#1P1P1QX&X&1Q1RX&X&1RW#X&X&1R1SVWVWVWVWX&1SVWVW1S1TWVWV1TWVWVWV1T1UVW1UVWVWWVX$WV1U1U1VVWVWWVWVVWWV1UVR1VVRVRVRVR1VVRVR1V1W1W1X1YW'1Y1ZW'W'X$1Z2#2$2$2%2&2'2'W/2(W/W/W/2(W:2(2)2*W'W'W'W'X+2)W'W'W'W'2)W'W'W'W'X+X+X*X*WXWXX*WXWXWXWXWXWX2&WX2&2'WP2'WPWPWPWPWP2'2(WX2(WXWXWXWX2(WP2(2)WPWP2)WW2*WWX(WEX(WEUCUCUC2)2)TYV&V&UC2)UCUCV&V&2)V&UCUC2)2*UCUC2*2+V?2+V?V?TY2+V&TYV&2+V&V&V&2+V&2,V&2,V&V&U22,U2U22,2-U2U22-TYTOTPTYTNTNTNTNTN2,TN2,2-TN2.2.2/TNUUTN2/TN20TN20TN2121YDYD22YDYD22YDYDYDS2S22122S<S<22S223S2S2S2S<S2S2T)22T)22T)23T)YOYOYEYET)T)S2T)21T(T(T(Y,21Y,22Y;Y;2223WI23WIWIY;Y;23Y;Y;23242525W+WIW&W+W+25W+XX25W92626W+27282829S;W929Y;W+W+292:W+W+W+2:W+2;2;2<2=VY2=VYVYVYWT2=WTWT2=X&2>2?VY2?2@X&VY2@VYVYX&X&2@X&2@X&VY2AX&2AX&X&2A2BX&2CX&W:2CW:2CW:W:W:VW2CW:W:W:2CW:W:X&2CX&X&W:W:W:W<W:2BW:W:2BW:W:W:W:W:2B2CW/W/2CW<W:W<W<W<2BW<W<W<W<W<W<W?W:W:W:2A2AW<2BW<2B2CW<2DW<2D2E2FW?W?2FW?WW2FWWX(2FX(X(X(V?U2V?2FUKU2UKUKTOV#TOTOTOTOTO2DUKUQUKUK2CTNTOUJTO2C2D2EUJUQUQUQTNTN2DTNUQ2DUQUQTNTN2DTNUQUNUQUNUQUQ2CUQUQ2CUQUQ2CUQUNUQ2CXPUJXP2CUUXPXPUUUTUUUTUUUTUUUTUUU1U1U1X5SCSCSCS<S<SCSCSCS2SCT$2=S;T(S;S;2=2>2?VSWTWTWTS;WTS;S;WTWTS;WTVYVYWTWTWC2;WT2<X&X&WTX&WTWTWT2;WT2;WTWT2;WQ2<2=X&X&2=X&WQX&W.W.X&2<W.2=W.2=W.WH2=X&2>XZX&2>X&2?X&W<X&W<2>W?W?W?W<2>W<2?2?W?W?W?W<W?W<W<W?2>W?2?W?2?W?W?W=WXW=W=W=W=W?W?W=W=2=W=2=W=W=2>W?X'2>2?W?W?W?2?2?2@2AW,2AW,W?W,X'X'2AW?W?W?W?2AW?W?W,2AW?W?2AW?W,2AW,2BW?X0W?X0X0WX2AWX2AWXX0X0WXWXWX2AWXWXW$WXWXWXWX2@WXWX2@WXWXWX2@WXWXX#Y&X#WXX#2?X#X#Y&2?X(UKUKUK2?UKUN2?UNUN2?UNUNUMUMUNU-UMTJ2>TJUM2>UMTJUM2>U-TCTCV=V=V=U<V'U<U<V'V2XOV2V2V*XOXO2:VAV:V:2:V6U@2;U,U,U#UIXHSCXH2:2:S?S?S?S2T#T#T#S;29SJSJSJS3SJS3XYWTSJWTSJSJS3S3WTWTVQ26WT26VQVQW?W,W?W,W,X025X0WXWXX0X-X0X0W$W$23X-W$W$W$W$X0W$X022X0W$X-22W$W$W$X-W$22W$22W$W$WXWXW$WXW$W$Y%WX20W$X-W$20W3X-W3WX20WXWXX#X#Y&WGUN2/XPU-U-V=U&U&V=V=2.2/TK2/TKTKTUU@2/TKTFTKTKTKTKTK2.TKUIUIV;V9V(V(2-TKXHS?XHS6S?S?2,2-2-S?S7S7S?S4S?S4S4S4S>S4XH2+XHSDS>S4S>S/SDS>2*SXS4T%S4T%S4S4S4T%S4S4S/S/T%T%2'T%S02'S0S0S/S0S/2'T#T#2'T#T#T#T#2'2'SMSMSM2'T&SOT&S02'S0SOT&SMT&SM2&SMSMSMSMSBSM2&2&SB2'SZSM2'SMSBSZSZ2'SZ2'SZ2(SZSZSZSZS5SJSJSJSHSJS3SJS1S12%S1S12%S3S1S1S3VQS3S3S12$S1SAVQVQ2$XYW?W?2$W*W?W*W*W*W$W$2#Y%W$W$W$WN1ZW$WNWNW$1ZW$W$X01ZX0W$X-W3WNW3WNW3W3W3TKTKTF1XU/XNU/V%TLTLTLTBSX1VSXSX1VS0S/S01VS0XGS01V1W1X1Y1YSM1ZSMSMSMSBSBSMSB1Y1ZSSSSSNSNS5S5S51YS9SLS9SL1XS5SQSQSHSH1XSQSQSQSLSQSQSQSQ1WSQSISQ1W1WSISISISI1W1XSYW$W$WA1XW$W$W$WAWAWA1WWAW71WW7W71WW7W7W7WO1WWOWOY&W(WB1W1WWBWBWBWBWBWF1WWGWGWGWFXOU.UBU.U.U.1UU.U.U.1UUBUBU.UBUBTBU(TB1TT/U(T/U(U(U(U(1SSNS9SNS9S91R1S1TS9S9SL1TSP1TXTSP1TSPSPSPS9SLSLSL1SSLSLSLSLSLSLSQSQ1RSQ1S1S1TSQ1USQS:SQ1USISI1US@1US@S:S@1USY1V1WS@SYS@S@SYSY1VSYS@SYS@S@SYXY1UXYWOWF1UWFUBV/UBUBV/V/V/UAUGUGUG1SV)V)V)1ST/T?T/T?1RV3V3V3U(V-1RT?V-V-T?1R1RT?T?T?T?1RT?UET?1RT?T?1R1S1T1UV-V-1UXLSPSPSP1USQ1USR1VSRSR1VSQSQS@SRSRS@S@1US@SRSRSR1U1U1VST1WS8STS8STS8ST1VS8WFWF1VWFUBUB1V1W1WUA1XUAV1UAV1UAUAUA1WUAUAUA1WT=1WTITITITITI1WTI1WV3V3V3TIV3TI1W1WV3V3V3T?T?V31WV3T?V3V31VSPT*T*SRSRSE1VSRSRSRSFSRSFSFSFSE1TSESESFSFSE1TSTS8ST1T1TSTSFSTSFSF1TSFX@X>X@X>V1V1V1T8T4T4T8T4T3T7T3T71PT7T7T7T71PT7T7T1T1T11PT:T21PT2T41PT4T41PT2T1T2T2T2T21P1PT=1QT=1QTIT=TITIV3V3V3T=T=T=1PT2T2T21PT=T21P1QT2V3V3V31PV3V3V3SE1PSG1QSE1QSESGSG1QSG1R1RSGSUSGSGSGSG1RSGSVSGSGX>X>XFXFX>X>XFXF1O1PXFXFV1T8V1T8V1T8V1T51NT5T5T5V1T5V1T5V1T5T71MT5T51MT71MT21NT2T2T2T21NT9T2T91NT21N1OT01OT0T0T01OT0T0T01O1P1QURT21Q1R1S1SURURUR1SV3UR1T1T1UURV3T01UT0T01UURT01VSG1VSGSGXEXEXA1V1VXFXFXFXD1VXDXDXDXD1VXD1V1WXDXD1WXDXDXDV11WV11X1XT7T7T7V1T7V1T1T0T01WT0T7T7T1T11VXDXDXDXDXDXDXBTR1UTRT6T1T1T61UT1T11U1VT6T6V+T6T1T1T6T6YW1TYWYW1TY91UY9YJYJ1U1VYJYJYJYWYWYWYJ1UYWY9Y9Y9YWYFYWYFYFY9YFY9YWY9Y9Y9Y9Y9Y91QY9Y9YIYIY9Y9YIYIYIYIY9YI1NY>Y>Y>1N1OX)X)X)1OX)X)X/X/X/W6VDVDV.VDY6Y6Y61M1MYBYB1N1N1OY6Y6YBYBY6Y6Y:Y:YBYB1M1N1O1PYJ1PYWYWY5YWY5Y5YJYW1OYWY.1OY.Y.1OY5Y.1PY5Y51PY.Y5Y5Y51P1PYWY51QYWYWYWY5YWYWY.Y.Y5Y5Z'Y5Z'Z'1NZ'1NZ'1O1PYXYXYNYNYNYNYN1OYWYWY5YWZ'Y=Z'Z'Z%1MZ%Z%Y=Z%Y=Y=Y9Y9YXYXYNYN1KYNYN1KYNYNYXYIYXYXYIYIYX1JYIYI1JYIYXYXYNYNYNYIYNYNZ%Z%Y=Z%Z%Z%Z%YGZ'1FZ'Z'Z%Z%1FYG1FYGZ'YGZ%1FYGYG1FYGYGYGYNYNZ%YGYGYIYGYGYGYIYG1DYGYIYIYI1CY>Y>Y>Y>Y>YIYIYIYIY>1BY>Y>Y>1BY>Y>Y>1BYIYIYI1BYIYIYZ1BYIYZ1BYZ1B1CYSYP1C1DYIYIYP1DYIYIYIYIYI1DYIYIYI1DYZYZ1DYPYZYP1DYPYPYPYP1DYPX1X1X1Y>Y>1CYPYPX1YPYPYPYP1B1CYP1CYP1DX1X11DX11DYIYIYIYP1DYI1EYIYIYI1EX1X11EX1X11EX1X1X11EX1WRVR1EVRVRX1X1X11EX1X1X)X)X11DX)X)WKWK1DWKW%W%VR1DW%WKW%W%X)X)X)WJX)WKWKWKWJWJ1AWJWKWJWKWJWKW%W%W%W%1?W%W%WJWJWJW@W@W@1>W@WJWJ1>WJW@1>W@W6W@W@1>W6VBVBVB1>VBVB1>1?VB1?UCUCVBVBUCUCVBVBUC1>VBVB1>UCU$U$TSTYU$U$TYTYUCTGUC1<TY1<TYTY1<1=TNTN1=TNTNTNTN1=TNTN1=TZ1>1?TZTZULTZ1>UL1?1@TZTZTNTNTZ1?TZTZ1?V@TZV@V@V@TZTZ1>UPUUUPUU1>UUUPUU1>UUUUTDTDTDV7YBYBY81=1=Y8YK1>YBYB1>YKYK1>YK1?1?1@1AY0YK1AYKYK1A1BY0Y01B1CY0Y0Y)Y)1C1D1D1E1FY.1F1G1H1I1IY0YK1JY0Y01JY0Y0Y.1J1K1K1LYKYK1LY.1M1N1N1OZ)Z)YK1O1P1Q1QZ)1RZ)1R1S1T1UY.Y.1U1VY.1VY.1WY.Y.Y.1WY.1W1X1Y1Y1Z2#YMY.YMY.Y.1ZYMYMYMYMYMY.YM1YY.1ZY.1Z2#Z)Z)2#2$Z)Z)2$2%2&Z$2&Y.Z$2'Z)Z)Z)2'Z)Z)2'2(YO2(YOYOZ)2(2)2*2*YOYOYOY.Y.Y.2*2*2+2,2-Z$2-Z$Z$2-Z$Z$Z$2-2.Z$Z$2.2/YOYO2/2021222223YAYA2324Z(Z(YAYAZ(Z(Z'Z'2324YMZ'YMYMYMYMYM23YMYM232424Z'YMYMZ'Z'2425YMYM2526YM2627Y/2728Y/Y/Z'Z'Y/Y/2728Y/Y/28Z'Y/Y/Z$28Z$Z$Z$28292:2:Y/2;2<Y22<Y2Y22<2=Y2Y2YA2=YAYA2=2>Z(Z(2>2?Z(Z(Z(Z(2?2@Y2Y2Y22@Z(Z(Z(2@Z(2@2A2BY/Y/2B2CY/2C2D2E2E2FY2Y22F2GY2Y2Y2Y12GY1Y2Y22G2HY2Y22H2I2IY-2JY-Y22JY12KY1Y1Y-2KZ'2KZ'Z'2KYGYGYG2KY?Z'2LYGYG2LY?YGYGY?Y?Z'Z'2KY?2KY?Y?Y?YGYGY?YGY?Y?2JY?Y?Y?2J2KY?Y?Y?2KY?Y?Y1Y1Y?2JY4Y4Y4Y4Y12JY?Y?2J2K2KY?Y42LY4Y4Y42LY42LY?Y?2LY?2M2NY?Y?2NY1YGYGYG2NYGYGY?Y?2M2NY?Y?YIY?Y?Y?YIYIY?Y?Y?2LY?Y?2L2MY?Y?2MY?Y?Y?Y?Y?Y?2MY?Y?2MY?YIYIY?2MYIYIY?YIY?2LY?YIYIYIYIYSYIYI2KZ&2K2LZ&Z&YS2LYSYS2LYSYSYSYSYSZ&2LYSYSZ&Z&Y?2KY?Y?2KYIYIYIY?2K2L2M2MZ&Z&Z&YI2MYIYIZ&Z&Z&YI2LYIYIYI2LYSYSYSYSYS2L2MYSYS2MYSZ&WM2MWMYPYPYSYSYPYPYP2L2L2MYIY+Y+WMY+Y+Y+VXY+Y+WM2KWMWMX1X1VVVV2JX1VVX1VXVX2J2KVU2KVUVUVXVX2KVUW%W%VRVRX+X+2JX+2J2KX*X*2KW)W)W)W)W)X*W)2J2KWXWXW)W)2KWXWX2KWXWX2KX/X/X/WXWXWXX.WXWXWXX.2IX.X.X.X(WUX(X(2HTY2ITYTY2ITYTYTYTYTY2ITNTZTNTZ2H2ITN2J2JTZU3U3TZTZ2J2KTZ2KUUUU2KV@UUUUTNTNTNU32J2K2LU3TN2LTN2MTNU3TN2MU3U3U8U3TN2LTNTN2LU52MTNU3UUU3UUU32LU32MU3UUUUUU2L2MUUUUV@V@V@2M2MV@V@V@V@UUUUUUV@V@V@UUV@2KUUUUV@V@UUUUV@V@UUUU2IUUUUUU2IUUUUUUUUUPUUUPYD2HY@Y@Y@2HY@Y@2H2IY@Y@YDYD2IYDYKYK2IYKYD2IYDYDYKYKYDYDY@2HY@2IY@2IY@YDY@2IY@YDYKYKYDYDYKYKYD2HYKYK2H2IYKYK2I2J2JYO2K2LYK2LYKYKYOYO2LYO2LYOYKXTYKYKYK2L2LYOYKYOYKYOYKXT2KYOYOYOZ(2KZ(Z(YRYR2KYRYRYRZ(2KZ(2KZ(Z(2K2L2M2N2N2O2P2QY1Y1Y-Y-Y-2PY-Y-YLYLYL2PYL2PYY2QYL2QYYYYYYYYYY2QY-Y-2QY-2Q2RYUYU2R2SYYY,2SY,Y,Y,2SY1Y1Y12S2T2UYVY1Y1YVYVY12TYVYV2T2UYVYVYUYVYUYVYVYVYVY,YVYV2SYVY1Y12SY1Y1Y12SY12SYVYVYVYV2SYVYV2S2TYVYV2TY;2UY;Y,Y,Y,Y;Y,2TY,Y,Y,Y;Y;Y;Y;Y;Y,Y,YIYIYI2RX%X%Y;X%YIYIX%X%Y;2PY;2QY;2QY;Y;2Q2R2SX&2SX&X&X&Y;X&Y;X&YIYIX%YIX%X%2QX%YIYI2QYIYI2QYIW#X2W#X2W#X2X22PX2W#W#X2W#W#W#2OW#2O2PX&X&2P2QX&X&2QX&X&X&X&W#X&2QW#W#2QW#WVWVVWVWWVWV2P2QVWVWX&X&VWVW2PVWVWVW2PVW2PWV2QWVVW2QVWVWWVWVVWWVVW2PVWVWWVX$WV2P2P2QVW2RWVWV2RWVVRVR2RVRWS2RWSVRVRVRVR2RVRVR2RX$X$W'W'W'2QVRW'W'VRVRW'W'W'W'2P2QVRW'W'W'W'2PW'W'2P2Q2RX$X$X$2R2S2S2T2UW/X$2U2V2W2W2X2Y2Z2Z3#W'3$3$3%W'W'W/3%WV3&WV3&WVW/W/W/3&W/3&3'3(3)3)3*3+3,3,3-W'W'3-3.W'W'VRVRW'W'3-WXWPWPWXWX3-WPWX3-3.WPWX3.WPWPWPWPWP3.3.3/30WWWXWXWX30WXWXWX30WX30WPWP30X.WPX.WPWPWP303031WWWWUCUCUC31UCTYUCV&UC30UC3131V&V&V&UC31XRV?3132V?V?V?32V?V?V?32V?U2V?U2V?V?TYTY31TY31TYV&V&TYTYV&TYV&TYV&30V&TYV&TYV&V&U23/V&V&U2U2V&TY3.U23.3/TPTP3/TNTNTNTN3/TNTNUUUU3/30TNUUTNUUTNTNTN3/3/UUUUUUUUUU3/UU3/UU30UU30UUTNUUTNUUUUUU3/YDYDYDYDYDS<3/3/YD30S<S<30S<S<S<S2S<30S2S230S230S2S2S2S230S231S2S2S231S231T)T)T)T(31T(Y;Y;3132Y,32Y,Y,32Y;Y,XX32Y;Y,Y;W032WI33Y;Y;W0W0Y;Y;3233Y;33343535W+W+W+W0W035WI35363738W&W&3839393:3;W23;W+3<W+3<3=VSVSW+W+VSVSW13<S;3=3=3>W93?Y;Y;3?3@Y;Y;Y;W+Y;3?W+W+W+W+W+3?W+3?VYVY3?Y;W+W+3?3@VYVY3@VYVYVY3@3AVYVYWTVYWTWTX&X&3@X&3@X&VY3AX&X&3AX&3AX&X&X&VY3A3B3C3CX&3DX&3DX&VY3EVYVYVY3E3EX&3F3G3GVWX&X&VWVWVW3GVWVW3GVW3GVWX&VWX&X&X&W:VWVWW:W:3E3FW:W:W:3FW:W:W:W:X&3FW/3FW:W:3FW:W:W:W:W:W:3FW:W:3F3GW:W<3GW<W:W<W<W<W:3FW:W:W:3F3G3H3HW<W<W<W<3HW<3I3IW?3JW?W<3JW<W<W<3J3K3LW<3LW<3M3MW?W?W?W?W?3MW?WWWWWW3MWWY'X(Y'V?U2V?V?TOTOUQUQV#3JV#V#UQUJUQ3JTO3JTOUQ3JUQUQUQUJ3JUJUJUJTNUJ3JTNTNUJ3JUQUQ3JUQ3J3KUJUJUNUQUN3K3KTNUJUJTN3KXPTNT(S;T(3K3KVSWTVSS;S;S;3K3KWTWTWTWC3KWCWCWCWCWT3KWTWTWT3KWT3KWTWTVZWQ3KWQWQWQWTWQWQWQW.W.X&X&WHX&X&3HW.3IW.W.W.WH3H3IWHWHWHX&3IX&3IXZWHWH3IW:3J3KX&3KX&X&W<W<W<W?W<W<W<3JW<W?W?W?3IW?W?W?W?W?3IW=3IW=W?W?W?W=W?W?3H3IW?W?W=3IW=W=W=W=3IW=W?W?3IW?X'X'W?W?W?W?W?3HW,W,3H3I3IW?W,W,3I3J3KW,3K3LW?W,X'X'W?W?W?W?W?X0W,3JW,W,3JW?W,W?W,W,3JW?W,W?W,W,X0WXWXWX3HWXX0X0WXWXW$W$WXWXWX3GWXWX3GWXWXWX3GWXWXX#X#X#X#Y&X#X(UKUKT@3EUKUKUNUNUN3DUNUNUM3DUM3EUMUM3ETJTJ3ETJTCV*3EV*V:T-T-T-3EV8T.3ET.XHSCXH3ET$T$3ES?S;S;SJSJ3DWTVQVQWTWTVQVQ3CX0W,X0X03CW$W$W$W$X0W$X-X-3B3CW$3CW$W$W$3CW$W$W$W$X-W$W3W3X-W33A3BWXWXUN3BUNU-U&V=U&V=V=V=V=UFT<T<3@T<3@TUTKTKTFTFTF3@3@V(TKTKS?S?3@S6S?3@3A3BS?S?S?3BS>S>XHSDSDSDSDSXS/T%S/S/T%3?S0S03?S0S0S0T%T#T%T%T#T#SMSMT#SMSMSMSOT%SO3<SOT&SOT&T#SMSMSMSM3:SMSBSMSBSMSB39SBSBSBSMSBSMSB38SZSZSZSZSZ38SZ38SZSZSZS3S3S1S1S3S3S1S1S3S3SASASASA35SWW?W?W?W*34W$W$W$W$W$WNWNW$WNW$WNX0W$X0W$TKTKTF3131S/S/S/S/S/S/S0S/S/S/S0S03/S030SOSOSO30S030S0S0303132SOT&T&T&32T&32T&XGSMSMXTSSSBSBSSSBS530S5S5S5S530S530SQSQSQSQSQSQ3030SI31SISQSQ31SISISYSYSY3031SISYWAW$WAWAWAWAW730W730W7W7WA30W731WBWBWOWBWB30WBWBW(WBW(30WBWBWFWFU.U.UBU.U.U.U.UBU(U(3-U(U(U(U(3-S9S9S93-S93-XTSPSPSL3-SL3-SLSLSL3-SLSPSP3-SLSPSPS9S93-SLSQSISQ3-SQ3-3.SKSQSQSQ3.SKSKSK3.S:S:3.S:SQS@SQS@3-S@SKSKSK3-3.3/3/SYSYSYS@3/S@S@3/SYS@SYSYSY3/SY3/S@S@S@3/WFWFWFUG3/V)V)V)V)V)3/V33/V3V3V-V-T?3/V-V-3/UET?3/T?T?3/UET?UET?UET?T?V-U(3.V-3.U(V-V-V-V-3.V-V-V-V-UE3-V-UEUESP3-SPSQSQSQ3-SQSR3-SRSR3-SQ3.3/S@S@SR3/SRS8S8S8SRSRSR3.S8S8S83.ST3.ST3/S83/STSTW7WFW7WFUBUBUB3.UBV1V1V1V1UAV1V1V1V1V1UAUAUA3+T7UAUAT7T73*TITITITITITI3*TTTT3*V3TIV33*V3TI3*TIV3V3T?T?T?SPSPT*T*SF3(SESFSESFSESFSFSFSG3'S8S83'STSF3'SFSFSFSF3'SFT73'T7T7T7T=T73'T13'T1T1T:3'T:T2T1T1T4T1T1T23&3'T2T2T23'T=T=3'T=3'3(T=T=T=3(T=TIT=3(T=T2T23(3)V33)T2T2T2T2T2V3V3T2V33(V3SE3(3)SGSESGSGSGSESESE3(SGSGSG3(3(SUSUSUSGSGSUSUSGSG3'SV3'XFXFXFXF3'XFXFT5T8T5T5T73&T73'T5T53'3(3(3)T93*T9T2T9T2T2T2T23)T2T2T7T7T2T23(T0T2T0T7T0T23'T0T0T7T0T7T0T23&3'URUR3'URUR3'UR3(URT23(T23)T2T23)T2T23)T2UR3)URURURV3V3V33)V3V3URURURV3URURV3V33'V33'URT0T0URUR3'URURURT0T03&SUSGSGXEX=XAX=X=3%X=XFXF3%XDXDX=XD3%XDXFXF3%XDXFXFXDXDXF3$XD3%V1T7V1T7V1T7V1T7T7T7V1T7T7T0T72Z2ZXDX=XDTRTRTRT1T62YT6T62YT6T6T6T62YT6T6Y9Y92Y2ZY9Y92ZY92ZY9Y9Y9YJYJ2ZYIYJYJ2Z3#YJYWYWYWY9Y9YIYIYIY>Y>Y>2X2YX1X)2Y2ZX)X)2ZX1X)X)Y62Z3#YBY6Y63#YBYBYB3#YBYBY63#Y6Y63#Y6Y6Y)3#Y)Y)3#Y.3$Y.Y)Y)Y)3$3$Y.3%Y.YJ3%YWYWYJYJ3%YJY5Y5Y.Y.Y5Y5Y.3$Y.3$Y.Y.3$Y.Y.Y.Y5Y5Y.Y.Y53#Y5Y53#YWYWYWY.Z'Y.Z'Y.2Z3#3$3$Z'Y.Y.Z'Z'3$Z'YNYN3$3%YNZ%Z%Z%YNYN3$YNYXYX3$3%YX3%YXYI3%YIYIYIZ'Z%Z'Z'Z'YGZ'YGZ'YGZ'Z'Z%Z%YGYGYGZ%YGYGYG2XYGYG2X2YYIYIY>YIY>Y>Y>Y>YPYPYPYP2WYP2WYIYZYZYIYIYZYZYI2VYIYIYZYPYZ2VYPYP2VYPYI2VYIYI2VYPYIYIYPYP2VYIYIYIYPYPYIYIYI2UYZYPYPYPYP2TYPYPYP2T2UX1Y>Y>YPYPYP2TYPYI2TYPYPYPYPYP2TX12TX1YPYPX1X12TX1YPYIYIYIYP2SX1X12SX1X1X1YIYIYI2S2SX12TX12TYIX12UX1X12UX1WLWLVRWLX1X12T2UX1X)X)X)WKWKWKW%W%W%VRW%WKWJWKWKWJWJW%WJ2PW@W@W@WJWJW%WJ2OW@W6W6W@W62OW6VB2OVBUC2O2PUCUC2PVBUCUCUCUC2PUC2PVBUCUCVBVBUCUC2OTGTGTGTNTN2OTYUY2OUYUYTNTNUYTNVD2NTNTNTNTZTN2NTZTZULTZTN2MTNTNUL2MTNTN2MULTNULTNTNTN2MULUL2MTNV@V@TZ2MV@V@2MV@UPUP2MUPUUUP2MUPUUUPUU2MY8YKY8YKY8Y8Y82LY<Y<YKYKYB2KYBYKY0Y02KY02KY0YK2LY02LY0Y02LY)2M2NY0Y02N2O2O2PYK2QY)Y)2Q2R2R2SY0Y02S2TY0Y0Y)Y)2T2UY)2UY)2V2V2W2XY.2X2YY)2Z2ZY.3#Y.3#Y.Y.Y.Y)Y)3#3$3$Y.3%Y.3%3&3'3(Y.Y.3(Y.Y0Y03(3)Y0Y0YKYK3(Y0YK3)Y0YC3)3*Y.Y.YCY.3)3*YKYK3*3+YKYKY.Y.3+Y.3+3,YKYK3,YKYKYKYKYKYK3,YKYKZ)YKYKZ)Z)3+YK3+YK3,3,YK3-YKZ)Z)3-Z)YKZ)YK3-YK3-YK3.3.YO3/YOYKYK3/30YOYO30YO3031YKYK31Y.323333Z'34Z'34Z'35Z'Y.Y.3536Y.Y.Y.36Y.3637YM3738YMYMY.Y.Y.YMY.37YMYM37YMY.YM37YMYMYMYK37YK3838Y.39Y.393:3;3<3<3=3>Z)3>3?Z)Z)3?3@Z)Z)3@Y.3A3BY.Y.Z$Y.3AZ$Z)Z)Y.Y.Y.Z$Z$Z$Z$3@3@YO3AYOZ)Z)YO3AZ)YO3AYO3AYOYOYOZ)Z)3A3B3BYOYOYO3B3CYOYOZ)YO3CYO3C3DY.3EY.Y.Y.3EY.Y.Z$Z$Z$Z$Z$YOZ$Z$YOYOY.3BZ$Z$Y.3B3CZ$YMYMZ$Z$YMZ$Z$Z$YOZ$YOYOZ$Z$YOYOZ$Z$YOYOZ$Z$3>3?YOYAYO3?YAYA3?YAZ$Z$3?Z$Z$Z$Z$YAYO3>3?3@3@YA3A3BYMZ'YMYMZ'Z'3AZ'YMYMZ$YMYMYM3@YMYMYM3@3AZ'Z'YMYM3@3AYMYM3AZ'3B3CYMYM3C3DYMYM3DY/YMYMY/Y/YM3CY/Y/Z'Z'Y/Y/3BZ'Y/Y/Z'Z'Y/Y/Z'Z'Y/Y/Z'Z'Y/Y/Z$3?Z$Z$3?3@Z$Y2Z$Z$Z$3@3@Y23AY23AY/Y/Y/3AY/3B3CY/Y/3CY/Y23CY2Y23C3DY2Y23D3EY2Y23EZ$YAYA3E3FYA3G3GY23HY2YAYAYAZ(3GZ(Z(Z(Z(Z(YRZ(Z(Z(YRYRY2Y23EY2Z(Z(YRZ(Y2Z(Z(Z(Z(Z(3C3DZ(Z(Z(3DY/Y/3DY23DY2Y2Y2Y/Y/Y/3D3DY2Y2Y23DY2Y2Y2Y/Y/Y2Y2Y/Y/Y2Y2Y/Y/3B3C3C3D3E3FY23F3GY1Y2Y2Y23GY23GY23H3HY2Y-Y-Y23H3I3JZ(Y-Z(Y-Z(Y-Z(3IY2Y23IY13IY1Y1Y1Y1Y1Y-3IZ'YGZ'3IYGYG3IYGZ'Y?Z'Y?Y?Y?Z'Y?YG3GY?Y?Z'Z'Z'3GZ'Z'Z'Y?Y?Y?Y23FY?Y?Y13FY?Y?3FY?Y?Y?Y1Y1Y?Y?3EY?3EY4Y1Y13EY?Y4Y4Y?Y?Y43E3EY?3FY?Y?Y?3FY?Y43FY4Y4Y43FY43GY4Y43GY43GY?Y1Y13G3H3IY13IY1Y1Y1YGY?Y?Y?3HYGY?Y?YGY?Y?Y?Y?YIY?Y?YIYIY?Y?3EYI3FY?YIYIYI3FY?Y?Y?3FY?Y?YTYTYIY?Y?Y?Y?YIY?3DYI3DZ&Z&YIYI3DYIYSYSZ&YS3C3DYSYS3DYSYSYS3DZ&Z&Z&Y?Y?Y?YI3C3DYIYIYIYI3DYIY?Y?Y?3D3DYIYIYIYI3DZ&Z&YIZ&YIYIZ&Z&YIYIYI3BYSYSZ&YSZ&YSYSYSYSZ&YSYS3@YSZ&Z&WMWM3?X1X1X1Z&Z&Y+Y+3>3?Y+Y+WM3?WMWMX1X13?X1VXVXVXVUVX3>VUVUVX3>VUVU3>VUVUVU3>X+3?X+W6W63?X*W6W63?X*W6W)W)W)3>3?WXWX3?WXWXWXW)W)W)WXWXX/WX3>X/X/3>X/WXWXWX3>UCTYUC3>UC3>UCTYTGTGTYTYTY3=TYTNTZTZTZ3=TZTZTZ3=3=U3U4U3TZTZ3=3>TZTZTZ3>TZV@3>V@TZTZ3>3?TZ3?3@UUTN3@TNU33@3AU3U33AU3U3U33AU3TNU33AU33BU33BU83CU8TNU6TNTNU8U8TN3BTN3BTNTNUUUU3BUU3BUUUUUUU>U>U>3B3B3C3D3EV@UU3EUU3EV@3FV@3F3G3H3IV@V@3I3J3JUUUUUUYD3J3KY@YDYDY@3KYDYD3KY@YDYDY@Y@Y@3JY@3K3KYK3LYDYDYKYDYDY@YDY@YDY@YDY@YDYDYDY@YDYDYD3HYD3H3IYDYD3IYK3JYDYKYK3JYD3J3KYDYDYKYDYDYD3J3KYKYKYKYOYKYKYOYO3JYOYKYKYK3JYOYO3JYO3JYO3KYOYKYKYK3KYKYOYKYK3J3KYOYOZ(YRZ(Z(Z(YRZ(3JYRYR3JYRZ(3JZ(Z(YRYR3J3KYRYLYRYLZ(3JZ(Z(3JYLZ(YLZ(3JYR3K3KY-3LY-YR3LYRYRY-Y-YRY-Y-3KY-3LYLYL3LYYY-Y-3LY-Y-Y-3L3M3MYY3NYYYY3NYYYYY-Y-3NYUY-3NYUYU3NYUYUYUYUYUYYYUYUYU3M3NYUYUY,Y,Y1Y13MY1YV3MYVYV3MY1YVYVYVYVY-Y-Y1Y1Y13LY1Y13LY13L3M3NYVYVYVY,Y,Y1Y1Y13MY1Y13MY1YV3MYVYVYVY1YVYVY1Y1YV3LY1Y13LY1YVYVYV3LY,3LY,3MY,3MY,Y,YIYIYIX%X%X23LX2Y;X2X2X2X2X2Y;3KX2X23K3LX2X23LX2Y;Y;Y;3LX&X&Y;X&X%X%X%W#W#YIW#3JYIYIYIW#X2X23IW#3IW#X&X&3IW#X&X&W#W#3IW#X2X2W#X23HW#X2X&W#X&X&X&W#W#3GW#W#W#3GW#WVWVVW3GWVWV3GWVVWVWX&X&VWVW3FVWWVWV3FWVVWWVVW3F3FWVVWWVVW3FVWVWWV3FWV3GWVWVVW3GWVWV3GWVVW3GVWVW3GWVVWVWVRVRWS3G3GVRVRVRVRVR3G3H3HX$3IX$VRVR3I3JW'W'3J3KW'W'3KW'3K3LW'W'VRVR3L3M3MX$X$X$VRX$X$X$3L3MW/W/X$X$3M3N3N3OX$X$3O3PW/W/X$W/3PW/X$X$X$3PW/3PW/W/3PW/W/W/X$X$3P3QX$3QX$X$W/3Q3R3S3SX$X$3TW/3TW'W'3TW/W'W'W'W'W/W/W/3S3T3U3U3VW'3WW/W/3WW/WVW/3WW/3WW/WVWVW/W/3WW/3WX$X$X$3W3XX$X$X$X$3XX$X$X$X$3X3XW'X$3YW'W'3Y3Z3ZX$4#W'4#4$W'W'W'4$W'W'4$4%W'W'VRVR4%4&VRVR4&4'WXWXWX4'WXWXWXWP4&4'4(WPWX4(WXWP4(WPWPWPWP4(WWWWWPWPWP4(4(4)WWWW4)WWWWWWWX4)WXWXWXWP4)WP4)WXWPWPWXWX4)X.WPWPWP4)WW4)WWWW4)WWWWWW4)V&UCV&UCV&UC4)4)4*UCV&V&V&UCV&UCUCV?V?UCUC4(4)UCUCV?V?4(4)V?V?4)4*4+V&4+TYTYTYV&TYV&TY4*TYV&TY4*U2U2U24*U2U2U2TP4*TPTP4*TY4+TY4+TNTNTNTN4+TNTNTN4+TNU?4+UUU?UUTN4+TNUUTNUU4+UUUUUU4+UUUUUU4+4,TNUU4,UU4,UUTNUUYDYD4,YDYDYDS<S<YDYDYD4+YD4+S<S<S<S<S<4+4+4,S<4-S2S24-S24-S2S<S2S2T)S2S2S2T)S2T)S2S2S2T)S2T)T)T)T)T(T)T(4(Y;Y;Y;Y;Y;4(Y;Y,4(Y,Y,4(XXY,XXY;Y;Y;4(W0W04(W04(4)WIWIY;Y;W+W+Y;Y;4(Y;Y;Y;Y;4(W+4(W+W+Y;W+W+W+W+W+4'W+4'WIWIWIW&4'W&W&4'4(W&W&W&W&W&4(W&W&4(W+W9W&W9W9W&4'W9W9W9W9W94'W9W94'4(W94(W94)W&4)4*W+4*W+W9W+4*4+VS4,W+W+4,W+W9W9W14,4,W9W9W9W9W9W9W24+W2W2VSW9VSW94+Y;Y;W+W+4*Y;W+W+Y;Y;Y;4*W+4*W+W+W+VY4*VYY;Y;4*Y;Y;Y;W+4*Y;Y;VYVY4)VYVYVYY;Y;VY4)Y;Y;4)VYX&X&4)X&VYX&VY4)X&X&VYVYX&X&VYX&4'X&VYX&4'X&X&X&VY4'VY4(4(X&4)X&X&X&VYX&4(X&VYVYX&X&VY4(VYX&VYVYVYX&VYVYVYX&VYX&VY4%4&VY4&X&4'X&X&VWX&X&VWVW4&4'VWVW4'4(4(4)X&VWVWVWVWW:VWVWW:W:4'WV4(4)X&W:X&X&4(W/4)4*4*W:W:W:W:W:4*W<W:W:W<W<W:4)W<W<W<W<W:W<W:W:W:4(4(4)W:W:4)4*4+W<W:W<W<W<4*W<W<W<W<4*W<W<W<4*W<W<W?W?4*W?W?W?W<W?4)W?4*W<W?W?4*W?W<W<W<4*W?W?4*W?W<W<W<4*W<4*W<W?W<W?W?W?W<W?W?W?WWWWWWX(TNTN4'TNUJUJUQUJTOTOTO4&TO4&TO4'UJTNUJ4'UJ4'UJUJTNTN4'TNUQUQ4'UN4'4(UJUJTNTNUJ4(UNUQUNUQTNTN4'UJTN4'TNTNS;S;T(S;W9W9S;4&S;4&S;WT4&WTWTWT4&4'WCVY4'WTWTWTWTVZ4'VZ4'VZWTVZVZWQWQWQW.WHW.4&W.4&W.W.W.4&W.WH4&WHWHWH4&W.W.W.4&W.4'WHW:W:4'W<X&W<X&X&W<W<4&W<4&W<X&W<W<W<W<4&W<W?4&W?W?W?W?4&W?4&W?W?W?4&W?W?4&W=W?W=4&WXW=W=W=W=4&W?W?4&W?W,W?4&W?W?W?4&W?W?W,W,W?W,W,W?W,W,W?W?4$W,4$4%W,W,W,W,4%W,W?4%W?W?4%W,W?W,W?W?W,W,W?W?W,W,4#4$4%4&X0WXX04&WXWX4&4'WXWX4'WXWXWX4'4(UKUK4(UNUQUQ4(UNUMTJ4(TJ4(TJTJTJUMTJTJTJTJTJTC4'V:VAV:4'4'4(4)4*V8V8V8T.SC4)SCT$T$T$S?4)WTWT4)WTW,W,W,X04(X-W$W$X-X-W$4(X-X-4(W$X-X-4(4)W$X-4)X-WX4)4*WX4*W44+4,4,U-UNU-T<T<TK4,TUTUTKTU4+TKTFTKV(V(TKTKS6S6S64*S?S?4*S6S6S6S?S?S6S?S?S?S?S?S7S74'4(S0S0S/S04(S0SOT&SOT&SB4'SBSBSMSBSMSB4&SZSZSZSBSZ4&SZSB4&SZSB4&SWSWSWX0W$X0W$TFTFTF4%S/S/SXS/S0SO4$SO4$SO4%SOSOT&SOT&S0SOS0S0SOSO4#4$SO4$4%4&S0SOS0S0T&T&T&4%T&4%T&T&S5S5S54%S5S5S54%SHSHSQSHSQ4$SQSISISI4$SI4$SISQSISQSQSQSISISISI4#4#SY4$SYWAWAW7W7WAWAW7WAWAWA3Z4#4#4$W7W74$W(WBWBW(WB4$W(U(U(T/4$U(U(V-U(S9S9SPSPS9S9S9SPSPSLSPSLSL3XSLSL3XSL3Y3ZSLSLSPSP3Y3Z4#SL4#SI4$SISISISI4$SQ4$4%SKSQ4%SQ4&SK4&SKSK4&S:SQS:SISI4&SKSKSKSK4&4&S:S:4'S@4'S@S@SISYSISYSYSYS@4&SYSY4&SY4&SYS@SYSYS@S@S@WOWF4%WFUGV)V)V)V)4$V)TTV3T/V3V3V-V-4#4$V-V-4$4%4%4&T?T?T?4&T?T?V-U(V-V-U(U(U(4%V-V-UE4%V-V-4%V-SPSQSPSQ4$SQSRSQ4$SQSRSRSQSQSRSQSRSRSR4#SQSQSRSQS@S@SR3ZSR3ZSRSRS8S83ZS83ZS8ST4#ST4#STSTS8S84#S8UB4#V1V14#T3T3T7UAUAUA4#TITI4#TITTTTTT4#TITIV3V3TI3ZTIV33ZSRSFSFSGSFSGSGS83YSTS8SF3YSFSFSFSF3YSG3YT3T7T7T23YT2T2T:T:T1T:T:T2T:T2T13WT1T13WT2T1T2T2T2T23WT=T=T23WT23WT2T23WT=T=T=3WTIT=TI3W3XT=3Y3YV3V3V33YV3V3V3T=3YT2T23YV3V3V3SESE3YSGSESESE3YSESGSGSGSGSG3X3YSG3YSG3ZSGSVSVSVX>X>X>XF3X3YXFXFT5T53YT53Y3ZT7T73ZT5T74#T5T54#T5T94#T9T9T2T24#T2T9T2T9T23Z4#T0T04#T2T0T0T24#T0T04#V34$URT2URT2URV3V34#4$T2UR4$UR4$URURURT2T2T24$T24$T2T24$T2T04%T2T2T2URURUR4$URV3V34$4%V3V34%V3T2T2T0T04$URT0UR4$SUSGSUX?X?XFX?XFXF4#XFX=XDX=XDXD3ZXDXDXFXF3Z4#4#XDXDXDT74#T7T7X=XDX=XD3Z4#T6T64#4$T6T6T64$T6T6YW4$YWYW4$4%YW4&Y9Y94&Y94&4'Y9Y9YJYIYIYIYJYJYIYIYJYJYIYIX14$X1X14$X1X)X)X1X14$4%X1X1X)X)X1X1X)4$Y64$YBYBY64$YBYBY64$YBYBYBYB4$YBY64$Y6Y6YBYB4$YBY)4$Y)Y)Y.Y.Y)Y.Y)Y.Y)Y.3ZY)Y.Y.Y)Y.3ZY.3ZY.Y.Y.YJYWYWYWYJYJ3Y3ZY5Y5Y53ZY.3ZY.Y.3ZY.Y.Y.YWYWY53ZY5YWY5Y5Y.Z'Y.Z'Y.Y.Y.3X3XZ'3YZ'3YZ'Y.Y.Z'Z'3YZ'3Y3ZZ%Z%YNYNZ%Z%YNYNZ%Z%YN3XYNYN3XYX3YYXYXYIYXYXYIYI3XYIYGYIYGYGY>Y>YIYIY>Y>YIYIY>YPY>Y>YIYIYIYZYZYZYIYZYZYPYZYZYPYP3QYPYIY>YIYIY>Y>YIYIYPYIYIYIYIYIYIYPYZYPYPYPYPX13LX1YP3LYPX1YPYPYP3LYPYP3L3MYPYP3M3N3NX1YPYPX1X13NX13NX1X1X1YI3NYIYIYI3NYI3OYIYI3OX13OX1X1X13O3PYIYI3PYIX1X13PX1WRWRX13PX1X13P3QX)X)3Q3RW@W@W@W@W@3R3RW6W6W6VBVBVB3RVBVB3RVBVBVBVB3RVBVB3RVBVBUCVBUCVBVB3Q3RUCTGTGTGTYTNTYTYUY3PUYUYVDVD3P3QULUL3QULULULTNTNTZTZULUL3OUL3PTNTN3PTNTNULUL3PTNV@V@TZTZV@V@3OTZUPUP3O3PUUUUUU3PUP3PUUUUY8Y8Y8Y<YBYBYBYKYKY0YK3NYK3NYKYKYKY0YKYKY0Y)Y0Y0Y)Y)3LY)Y0Y)Y0Y03KY0Y0Y0Y03K3L3M3M3NYK3OY03OYKYKY0Y03O3PYK3PYKYK3PY)Y0Y03P3QY0Y0Y)Y)3Q3R3RY)Y0Y03RY)Y03SY)Y)3S3T3T3UY0Y03U3VY0Y0Y)Y)Y)3V3V3WY)3XY)Y)3X3YY)Y)3YY.Y.Y.3YY.Y)3YY)Y)Y)3YY)Y)3Y3Z4#Y.4#Y.Y.Y.4#Y.Y.Y.Y)4#4$4%Y)Y)4%4&Y)4&Y)4'4'4(4)4*4*Y.4+Y.Y04+4,4-4-Y.Y)4.4.4/Y0Y0Y)4/Y0Y0Y.Y.4/Y.YK4/YKYK4/40YKYK4041YKY0Y0Y0YKYKY0YCY040YCYC40YCY040414242YC4344YCYC44YC44Y.45Y.Y.Y.4546YK46YKYK4647YKYK47Y.YKYKYKYKYKZ)Z)Z)Z)46YKYKYK46YK46YKYK4647484949YKYKYKZ)Z)494:Z)Z)YKYKYK49YOYOYKYOYK4949YOYOYOYOYO49YOYK494:YOYKYOYOYO49YOYOYOY.Y.YKYKY.Y.YK48Y.Y.48Y.YK48494:4:Y.Y.Y.4:Z'4;Z'Y.4;Y.4<Y.4<4=Z'Y.4=Y.Y.Y.Y.YMYMY.YM4<YMY.Y.Y.4<4<4=YMYM4=YMYMYM4=Y.4>Y.Y.4>4?4@Y.Y.Y.YMYMYMY.Y.Y.YMYMYM4=4>4?Y.4?Y.Y.Y.YKY.4?Y.4?Y.4@Y.4@Y.4A4BY.Y.4BY.4B4CZ)Z)4C4DZ)Z)Y.Y.Y.4DY.Y.4DY.4DZ)Z)Z)Z)4DZ)4E4E4FZ)4GY.Y.4GZ)Y.Y.4GZ)Y.Y.4GY.Z)4GZ)Z)4GZ$4HZ$Z)4HZ)4IZ$Z$4IYOZ)Z)Z)YO4HYOYOYO4H4IYOZ)Z)4I4JYO4J4KYOYOZ)4KZ)Z)4KYOYOYO4KZ)YOYOYOZ)YOYOYOYO4JYO4J4KYOYOY.4KY.4L4L4MZ$Z$Z$Z$4MZ$Y.Z$Z$Z$4LZ$Y.Y.Y.Y.4L4MY.Y.Y.4MZ$Z$YOYAZ$Z$YA4LYO4LYO4MYAYA4MYAZ$Z$4MZ$YO4MYOYOYOYOYOZ(YOYOZ(4L4LYA4M4NYO4NYAYA4NYAYAYAZ'Z'YMYMYMYM4MYMYMYM4M4NYMYM4NYMZ'Z'4N4OZ'Z'YM4OZ'Z'4O4PYM4PYMYM4PZ'4Q4RYMYMYM4R4RYM4S4TYMYMY/Y/YMY/4SY/Z'Z'Y/Y/Z$4RZ$Z$4R4S4T4U4UZ$Y2Y2Z$4U4VY2Z$Y2Y2Y2Z$Y2Y2Y24TY/Z$Y/4TY/Z$4UZ$4UZ$4V4V4WY2Y2Y/Y/Y24W4W4XY2Y2Y/4XY2Y24X4YY2Y24Y4ZY2Y24Z5#Y2Y2Z$Z$Z$5#Z$YA5#YAYAY2YAYAYAYAYAZ(Y2Y24YY24YY2Z(Z(YA4YZ(Z(Y2Y24YY2Z(4YZ(YR4YZ(YRYRZ(Z(YR4YY2Y24YY2Y/Y/4YY/Y/Y2Y2Y2Y/Y/4XY24X4YY2Y2Y2Y/Y2Y2Y/Y/Y2Y2Y/4WY/4X4XY?Y?Y?4X4Y4ZY2Y?Y?4ZY?Y2Y14ZY1Y24ZY2Y1Y2Y2Y2Y-Y2Y2Y24Y4YY-Y-Y-Y2Y24YY2Y2Y24YY2Y-Y1Y-4YY1Y14YY1Z(Z(Z(Y-Y24XY2Y2Y2Y1Y1Y1Y-Y14WY1Z'YGZ'Z'YGYGZ'4VYGYG4V4WZ'Z'Z'Y?Y2Y?4VY1Y14VY1Y14VY?Y1Y14V4WY4Y4Y4Y4Y14WY44WY44XY4Y?Y4Y4Y4Y?Y4Y?Y4Y?Y4Y4Y4Y?4U4VY44VY4Y4Y44VY44WY44WY4Y4Y4Y4Y44WY14WY1Y1Y?Y?Y?4WY?Y?4WY1Y14WY1Y1Y?4WY1Y1YGYGY?Y?YIYI4VYIY?4VY?Y?4V4WY?Y?Y?YTYTYT4VYIY?YIYIYIZ&Z&YIYI4UYIYIYIYSYSYIYIYSYSYIYIYSYI4RZ&Z&Z&Y?Y?YIYIY?YIYIYI4PYI4Q4RY?Y?Y?4RY?YI4RYIYIYI4RYIYIYIYSYSYSYS4QYSYPX1X1X1Z&Z&Y+Y+4OY+Y+Y+X14OWMWMX1X1X14OVXVXVU4OVXVXVUVUVXVX4NVUX+X+4NX+4NX+X+X+X*4NX*X*4NX*X*X*WX4NWXWX4N4OWXWXW)W)4O4PWXX/WX4PX/X/4PX/WXX.X.X.UCTY4OTY4OTYUCTYTNTNTY4OTZTZ4OTZTZTZTZ4OTN4OTNTNTZTZ4OTZTZTZ4OTZTZ4O4PV@4P4QV@V@TZTZTZ4QTZTZ4Q4R4RV@TZV@TZTZ4RUU4RU44SU9U44SU9U94SU3U3U34SU3U3U3TNU3TNU3TNU3TNU3TNU3TNU3TNU8TN4P4PU8U8TNTNU7TN4PTN4PTNTNUUUU4PUU4PUUUUUUU>U>U>UUU>4OU>U>UUUU4OUUU>U>UUUUU>UUUUUUV@UUV@4M4MV@4NV@4NV@4OV@V@4OV@V@UUUU4OUUV@V@UUUU4NUUUUUUV@V@V@4NV@V@4NUU4NUUUUUUYDYD4NY@4NY@Y@Y@YDYDY@Y@YDYDY@Y@YDYD4LYD4LYDYDYDYDYK4LYK4L4MYDYDYDYD4MYDY*4MY*Y*4MYKYDYDYKYK4M4N4NYKYDYDYDYKYDYDYKYK4M4NYKYK4N4OYK4OYKYKYOYOYKYKYO4NYKYKYK4NYKYKYOYOYKYKYKYO4MYO4MYOYKYOYKYKYKYOYO4LYO4M4MYO4NYOYRYRZ(YRYRYRZ(YR4LYRZ(YRZ(YRZ(Z(YRYR4KYRZ(4KZ(Z(Z(YRZ(4KZ(Y-YRYRYRYRYR4JY-Y-YRY-4IY-Y-Y-YR4IYRY-Y-Y-Y-YVY-YVY-Y-YLYLYLYYYLY-Y-Y-YYY-YYYYY-Y-YYY-YLYYYLYYYLYYYLYYYYYU4A4BY-Y-YU4BY-YUYUYUYUY-YUYUYUYUY,Y,YUYUY,Y,4>Y14?4@YV4@YVY14@Y1Y1Y1Y1Y1YV4@Y1Y14@Y1Y1Y1Y14@Y1Y14@YVY14@YVYVY1Y1Y14@Y1Y14@Y1YV4@YVYVY1Y1YVYVY1Y1YVYVYVY;Y;Y;4=Y;4>Y;Y,Y;Y;Y;Y,4=Y,4>X2X2Y;X2Y;4=Y;Y;4=Y;Y;Y;Y;X2Y;Y;X2X24<X2Y;X&4<4=W#YIW#W#W#W#4<W#W#W#4<4=4=W#X&X&W#W#4=4>X2W#4>W#W#W#X&X&W#W#4=W#4=WVVWVWWVWVVWVWVWVW4<VW4<WV4=WVWVWVVWWV4<WVVWWVVWWVVW4<WVWVWVX$WV4;WVWVWVWVVWVWWVWVVW4:VW4:VW4;WVWV4;WVVRVR4;4<WSVRVRVRVR4;VR4<4<4=X$X$VRVRVR4=4=X$X$X$VRVRW'W'VRVRW'W'W'W'W'4;W'W'4;4<X$W'X$4<W'4<W'W'VRVR4<4=VRX$VRX$4<X$X$X$4<X$X$X$X$X$X$4<X$X$4<X$4<4=W/W/4=4>W/W/X$X$4>4?X$4?W/W/4?4@W/W/4@4AW/W/X$W/W/W/X$X$X$W/X$4?W/W/4?W/W/W/X$W/W/W/X$X$W/X$4=4>X$X$W/4>4?4@W/X$4@4AX$X$4AX$4AX$X$X$X$X$4A4BW/W/4B4CW/W/W'W'X$X$4B4CW'4CW'W'4CW'W'W'4CX$4DW'4DW'4EW'4E4F4G4HW/W/WVWVWVW/WVW/4F4GWVWVW/W/W/4GW'4GX$X$X$4GX$X$W'4G4H4IX$X$4IX$X$4I4JW'W'W'W'4J4J4KX$X$W'W'4K4LW'W'4L4MX$X$X$4M4MX$W'W'X$4M4NW'4N4OW'W'4O4PW'4QX$4Q4RW'4RW'W'W'W'4RW'W'4RW'W'W'W'4RW'W'4RW'W'W'WXWX4R4SWXWXWX4SWXWP4SWPWX4SWPWPWX4SWXWPWXWX4SWPWPWPWW4SWP4SWWWWWP4S4T4UWPWPWWWWWPWW4T4UWXX.WX4UWX4UWPWPWXWX4UWPWXWXWXX.WPWP4TWWWP4TWWWWWP4T4UWWUCV&UCV&V&V&4TV&UC4TUCUC4TV&V&V&4T4UV?V?4UV?V?V?UCUCV?4UUCUC4U4VUC4VV?V&4VV&V&V&4VV&U2U24V4W4X4YV&TYV&TY4X4YU2U24Y4ZU2U24Z5#TP5$TYTY5$TY5$TYTPTP5$TNTYTNUUUUTNUUTNTNU?U?U?UUU?U?TN4YUUUUTNUUUUUUTNUU4XUUTNUUTNTNUUUU4WUUTNTNTN4WTN4WTNTN4WYDY@YDYDYD4WYDYDS=4WS=4W4XS<S<S<S2S<4XS2S24XS2S<S2S<S<S2S24WS24WS2S<S2Y;Y;Y,Y,Y;Y;Y,Y,Y,Y;Y,Y,4TY,Y,Y,Y;Y;Y;Y,W0W04S4TWI4TWIWIW0W0WIWIY;Y;4SW+Y;4SW+W+Y;Y;W+Y;4RW+W+W+W04RWIWI4R4SW&W&4S4TW&W&4T4UW&W+W&W&W&4UW&W&4UW+W&4UW&W9W9W9W9W24T4UW2W2W9W9W9VSW9W24TW2W9W2W9W9W&W+W&W+W&W&4R4SW94SW9W9W9W+VSVSW+W+VS4RVS4RVSVS4R4SVSVS4SW94TW9W14TS;W9W9W24TW24TVS4UVSY;Y;Y;W+Y;Y;W+4TW+W+W+4TW+4TVYVYY;Y;4TY;Y;4TVYVYW+VYW+VYVY4SVYVY4SVYVYVY4SX&4TX&X&X&VYX&VYX&VYX&VYVY4R4SVYVYVY4SVY4SVYVYVYX&4SX&4SX&VYX&VYVYVY4S4S4TVYVY4T4UVY4VVYVY4VVYX&X&4VX&VYX&VY4VVWVWX&4VVWVW4VX&VWVWX&4VVWVW4VVWX&4VX&X&4VVWVWVWWVWVW:WVW:4UW:W:4UW:W:W:W/W/4UW/W:4UW:W:4UW/4VW:W:W:4VW:4VW<4WW<4WW<4XW<W:W<W:W<W:4WW:W:4WW<W:W<W:W:W:4WW:W:W:4WW:4W4X4Y4YW<4ZW<W<W?W<4ZW<4ZW<W<W<W?4ZW?W<W?W<W?W<W?W<W<4XW?W<W?W<4XW<4YW?W?4YW?W<W<4Y4Z4ZW?W<W?TNTN4Z5#TOTOUQTOUQUQ4ZUQ4ZUQTOUQ4ZTN5#TN5#TN5$5%TNTNUJTNUN5$UNUN5$TNUJ5%TNTN5%TNUJ5%UJ5&TNTN5&UJTN5&TNUUW9VS5&VSS;S;S;WT5%WTWTWTVY5%WCVY5%X&VYVYWC5%WTWTWTWTWTVZWTVZWTVZW.WHW.WHW.WHW.4ZW.4ZW.5#5#WH5$WHWHWH5$W.5$W.W.W.W.W.W.WHX&W<X&W<W<W<4ZW<4ZW<X&X&W<W<W<W?W<W<W<W?W?W?W?4XW?4XW?W=W?W=W?4XW=W=4XW=WXWXW=4X4X4YW?W?W?W?W,W?W?W?W?W,W,W,W?W,W?W?W,W?W?W?W,W,W?W,W,W,W,W,W?W?W?4RW?W?4RW,W?W,W,W,W,4R4RW?4SW?W,4SW,W,4SW?4TW?WXWX4T4UWXWXWX4UWXWX4U4VWXWX4VWXWXWX4VX#4VWXX#WXT@T@T@4V4V4WUNUNUMTJUMTJUMTJUMTJ4UTJTCTCVAVAV:V:T-T-T-4TT-T-4TUHUHUDUDUD4SV6V6V6SCT$4ST$T$T$S?S?WTWTWTVQX0X04QX0X-4QW$4RX-4R4SW$W$4SW$4TX-X-4TX-W$4TW$W$WX4TWXWX4T4U4V4W4WW4W4W4W4W4WXWXW4W4WXWXUNUNUNU-T<T<TKTKTF4STF4TS6S64TS6S?S6S6S6T%T%S0S0T%T%S0S0S/S/S/S0SB4PSBSB4PSZ4QSZSB4QSBSB4Q4RSBSBSASASASWTFTK4QTKS0SOS0SOS0SOS0SOS0SOS0S04NSOS04OSOSO4OSO4OT&SOT&SO4OSOSO4OT&T&T&T&4OT&4PT&4PT&4Q4Q4RSLSLS5S54R4SSQ4SSQSISISI4SSISQ4SSQSQSI4SSISYSISISISY4RSYSYSYWAWA4R4SWAWA4S4T4TWYWYWYWYWY4T4UWBW(WBWBW(4TWBWB4TU(4UU(SLS94US9SPSPSLSLSLSLSPSLSLSLSLSPS94RS94S4S4TSLSLS9SLSLSLSQSI4S4T4TSISQSISISISKSISQSQ4SSKSQ4SSQSKSQSK4SSK4SSKSQSQSKSKSKS:SQ4RSQS:SISISI4RSKS@SKS@4Q4RS:S:S:4RS:S:4RS@S@S@SYSYS@4RSYSY4RSYS@S@4RSYWOWFWFWFV)4QV)TTT?V-V-V-V-V-4PV-T?V-T?4PV-UEUEUEV-4OT?T?4OT?T?T?4OUET?T?U(V-V-V-V-V-UEUEV-V-UEUE4LSQSRSRSQSRSRSRSR4KSRSRS@S@SR4K4KSRSRSRS8S84KS84KS8STS8S8S8ST4KST4KSTST4KS84L4MUBV1V1V14LUAT3T3UA4LTITITITI4LTITTTT4LTTTITITI4L4LSRSFSRS8S8S84LSFSFSF4L4LSGSGSGT3T3T7T3T2T=T2T2T14JT1T14JT2T1T2T2T2T24JT2T=T24JT24JT2T24JT=4KT=4KTIT=TIT=T=T=4KV3V34KV34KV3T2T2T24KT2V3T2T24K4LT=T=4L4MT24MV3V3SESESESGSESESE4LSG4LSUSU4LSUSUSUSGSG4LSU4LSUSUSUX>4LXFXF4LXFXFXFT5T5T7T5T74KT7T7T5T54KT7T5T5T74K4K4LT7T7T5T54LT7T2T2T9T2T2T24K4LT24LT2T04L4MT04NT2T2T0T04MT0T0T0T2T24MV34MURURURURV3UR4MV3V34MV3T2T2T24M4MURT2URT24MT2T2T24MT24NT2T24NT2T2T2T04NURUR4NURV3V3V34NV3V34NV34NURURURURURT04NSGSUSG4NXFXF4N4OXD4OXDXDXFXF4O4PXFXF4PXDXD4PXDXD4PT0T7T74P4QT6T6T1T1T6T6T14PT6T64PT1T6T6T14PT6T6YWY9YW4PY9Y9YWYWY9Y94OY9YW4OYWYW4OY9YWYWYWYWYWY9YW4NY9Y9X1X1X14NX1X14N4OX)4OX)X)4OX)X)X)4O4PX)X)Y6Y64P4Q4Q4R4SYB4S4TYBYBYBYB4T4U4UY6Y6Y6YBYB4U4VY.Y.4VY.Y)Y)Y.Y.4UY.4VY.4VY.4WY.YJYJ4W4XYJYJ4XYJY5Y5Y.Y.Y54WY.Y.4WY.Y.Y.YWYWY54WY.Y.Y.Z'Y.Z'Y.Z'4UZ'Z'Z'Y.Z'Y.4UY.4UY.Z'YNYNZ%Z%YNYNZ%4TYX4TYNYNYXYX4TYX4TYNYNYN4T4U4VYI4V4WYZYPYPX1X1X1YP4VYPX1YPYPYP4VYPYP4V4WYPYP4WYPYPYP4W4X4XX14YX1X1X1YPYPX1X14XX1YPYP4XX14X4YYIYIYIYIYI4YYI4YYIX1YIYIYI4Y4YX1X1X1YI4YX1X1YIYIX1YIYIYIX14XX1X1WR4XX1X1X1X)4W4XX)X)4XX)X)X)WJWJW@4X4XWJW@W@W64XW6W6W@W@W@W6VBVBVB4WVBVB4WVBVBVBVB4WVBVB4W4XVBVBVB4XVBVB4XVB4XTNUY4Y4Y4ZVDTN4ZTNTNTN4ZUL5#5$ULUL5$UL5$5%TNTNTNULTN5%5%TNTNTN5%5&TZTZUPUPUP5&UPUP5&UPUUUPUUUPUPUP5%UPY0Y0YK5%YK5%YKYKY0Y)Y05%Y)Y)Y0Y0Y0Y05$5%5%5&YKYK5&YKYKYKY0Y05&5'Y0Y05'Y05'5(YK5)Y0Y0Y05)5)5*YKYK5*Y05+Y05+Y0YKYKY)Y)5+Y)Y)Y)5+5,5,5-Y0Y0Y)Y)5-5.Y)Y05.5/Y)Y)Y0Y)Y)Y)Y)Y0Y0Y)Y0Y05,Y0Y0Y0Y0Y)Y05,Y05,Y0Y0Y)Y)5,Y0Y)5,Y0Y05,Y)5-5.Y)Y)Y.Y.Y)5-Y)Y)Y.Y.Y)Y.Y)5,Y)Y)Y)5,Y.Y.5,5-Y.Y.Y)Y)Y.Y.Y.Y.5,Y.Y)Y.Y)Y)Y.5+Y)5,Y)Y)Y)5,Y)5,5-Y.Y)Y.Y.Y.Y.Y.5,Y.5,Y.Y.Y.Y)5,Y)Y)5,5-Y.Y.5-Y.Y.Y.5-Y0Y0Y0Y)5-Y05.Y)Y)Y)5.Y)5.Y)5/Y)5/Y)Y)Y.Y.5/Y.Y)Y)Y)5/Y.Y.5/Y.5/50Y.Y.50Y.51Y.51Y)52Y)Y052535454Y)Y)Y)54Y)55565657Y)585859Y05:Y)Y)5:Y)5:5;Y)Y.Y.Y.Y0Y.Y0Y0YKYKY0Y0YK59Y0Y059Y0Y059YKYKYKY0YKY0Y0YCY058YCYC58YCY0Y0Y058YK58YKYK5859YKYK59YCYCYCYCYC595:YCYCYC5:YCYC5:YKYCYC5:5;5;Y.YCY.YK5;YK5<Y.Y.5<Y.5<Y.YKYK5<5=5>YK5>5?YKYKY.Y.5?5@Z)Z)YKYKYK5?Z)Z)Z)5?YKYK5?5@5AZ)5A5BYKYK5BZ)Z)5CZ)YK5C5D5D5EYKYKZ)Z)YKYKZ)Z)YKYKYKYKYOYOYKYOYK5BZ)Z)YOYOYOYO5AYOYKYK5A5BYKYOYKYK5AYOYOYOY.5AYKYKY.Y.5AY.YK5A5B5CYKYK5CY.5CY.Y.Y.5CY.Y.Y.Y.Z'5CZ'5CZ'5DZ'Y.Z'5DZ'5DZ'Y.Y.Y.5DY.5EY.Y.Y.Z'5DZ'5EZ'5EYMYMYMY.Y.Y.5EY.Y.YMYMY.Y.YMYMY.YMYMYMY.Y.5BY.YMY.YMYMY.5A5BZ'Y.5BY.5C5CZ'Z'Z'YKYKYK5CYK5C5DY.YK5DYK5E5E5F5GY.YKYKYK5GYK5GYKYKYKY.5GY.5GY.YKY.5GY.YK5HY.Y.5HY.Y.Y.Y.5H5HZ)Z)Z)5H5IZ)Z)5I5JZ)Z)Z)5JZ)Z)Y.Y.Y.5JY.Y.5JY.5J5KZ)Z)Z)Y.Z)Z)5JZ)Z)Z)Y.Y.5JY.Y.Y.5JY.Z)Y.Z)Z)Y.Z)Z)Z)5H5IZ)Z)Y.Y.Z)Y.Y.Y.Z)5HY.Y.Z$Z$5GZ$5HZ$Z)Z$Z)5H5HZ$5IZ#Z$Z$Z$YOZ)Z)Z)YOZ)Z)YOYOZ)Z)YOZ)Z)Z)Z)YOZ)Z)Z)5D5DZ)5E5FZ)YO5FYOZ)Z)Z)5F5FYO5GYOYO5GYOYOZ)5GYOYOZ)Z)Z)5GZ)YO5GYOY.Y.Y.5G5GZ$Z$Z$Y.Y.Z$Z$5FZ$Z$Z$Y.Z$Y.5FY.5FY.Z$Y.Y.Y.5FY.Y.5FZ$Y.Y.Y.Z$YAZ$YAYAYOYOYOYA5CYA5D5EYAYA5EYAZ$Z$YAYAYOYOYO5DYAYAZ(5D5DYAYAYA5D5EYOYOYAYA5E5FYOYO5FYO5FYA5G5HYMYMZ$YMYMYMYMZ$YMYMZ$5FYMYM5FYMZ'Z'YMYMZ'YMYMYMZ'Z'YM5DZ'Z'5D5EZ'Z'5EZ'YM5EYMYM5EZ'YM5FYM5FYMYMZ'Z'5FZ'YMYMYMY/YMYMYM5E5EY/Y/Y/5EY/Y/Y/YMY/Y/Y/YM5DZ$Z$Z$Z$Z$5DZ$Z$5DY2Z$Y2Z$Z$Y2Y2Z$Z$Z$Z$5BZ$Z$Z$5BZ$Z$5BY2Y25BYMZ$YMZ$5BZ$5C5C5DZ$5EZ$5EZ$5FZ$5FZ$Y25FY/Y2Y2Y/Y/Y2Y2Y/Y/Y25EY25EY2Y2Y/Y/Y2Y2Y/Y/Y2Y2Y/Y/Y25CY/Y/5C5DY/Y/5D5EY/5EY2Y25EY/Y2Y25E5FY2Y2Z$5FYAYAZ$5F5G5HY2Y25HY25HY2YAYAYAYAYA5HY2Y25HY2Z(Z(5H5IZ(Z(5IZ(5IZ(YR5JY2Y25JY2Y/Y/5J5KY25KY2Y2Y/Y2Y2Y25JY2Y2Y2Y/Y/Y/5JY/Y?Y?Y?Y/Y?5IY?Y/Y/Y/5IY?Y?5I5J5J5KY2Y2Y?Y?Y2Y?Y2Y1Y1Y1Y2Y1Y1Y1Y2Y2Y25HY25HY-Y-Y2Y25HY2Y2Y2Y25HY-Y1Y-Y-Y1Y15G5HY25HY2Y1Y-Y-Y-Y15GYGZ'5HY?5HY?Y?5HY?Y?Y?Y2Y1Y1Y1Y?Y?Y15GY?Y?5GY1Y?Y?Y4Y4Y?Y?5FY?5FY4Y1Y4Y?Y?Y4Y4Y45EY4Y4Y4Y?Y4Y4Y?Y?Y4Y?5CY?5DY?Y?Y?Y45DY45DY45EY45EY4Y?Y4Y4Y?Y?5DY?5EY?Y?5EY?Y15EY?Y1Y15EY1Y1Y1Y?5EY1Y1YIYIY?5E5EYIY?YIYIYIY?Y?YIYIY?Y?YIYI5C5DYIYIZ&Z&YSZ&Z&Z&YIYIY?5BY?5B5C5DYIYI5DYIY?YIYIYIY?YI5CYIYIYIYI5CYSYSZ&Z&Z&Z&5BY+X1X1WMWMX1X1VVVVVX5@VUVU5@VUVUVUVRX+VR5@5@5AX+X+5AW6X*X*W65A5B5CW)W)WXWXW)W)WX5BW)W)5BW)WXW)WXWXW)W)WXWXWX5@WXWX5@5AWXWXUCUCUC5A5A5BUCUC5BTNTNTNTZTZ5B5CTZTZ5C5DTN5DTN5ETZTZ5E5FTZTZ5F5GTZTZ5G5HTZ5HTZ5ITZTZ5IV@TZV@V@V@TZTZTZ5HTZTZ5H5ITZTZ5I5JTZ5JTZ5KTZTZ5KUUU4U45K5L5LU9U9U9U4U4U95L5LU35MU35M5NU3U3TNU85NU8TNU8U8U8TNU7TNU7TN5LTNTNU3UU5LUU5LUUU3UUU>UUU>5L5LUUU>U>5LUU5MUUTZTZTZ5MTZ5M5NV@5NV@5OV@5OV@V@V@5OUUV@V@5OUUV@5PV@UUUUUUV@V@V@5OV@UU5OUUUU5OUUUU5O5PY@Y@YD5P5QY@Y@Y@Y@5Q5QYDYDYDYDYDYD5QYD5QYDYD5QYKYDYDY@YD5QYDY*5QY*Y*YKYKY*Y*YK5P5Q5RYKYK5RYKYD5RYDYDYKYK5R5SYKYKYDYDYKYK5R5SYKYK5SYKYKYOYKYOYOYO5RYOYKYK5R5SYKYO5SYO5SYOYKYOYOYOYO5SYO5SYOYOYOYO5S5T5T5UYOYO5U5VZ(5W5WYRZ(5X5XYRZ(Z(5XYLZ(5YYRYRYR5YYRYRYRY-YRY-YRY-YY5WYY5X5XYUYUYUY-Y-YUYUY1Y15WY1Y-5WY-Y-5W5XY-Y-YVYV5XY1YVY1Y1Y1YVY1YVYVY1Y15V5WY1Y15W5X5XYVYVYV5XYVYVYVY1Y1Y15XY1Y1YV5X5XYVYVYV5XY;5YY;Y,5YY,5ZY,Y;Y,Y;5YY;Y,Y;X2X2Y;Y;X2X2Y;Y;X2X2Y;X2Y;Y;5V5WX&X&5WX&W#W#5WW#W#W#X&X&5VW#X&X&X&5VX&X&W#W#X&X&W#W#5U5VX2X25VW#W#W#5V5WWVWVVWVWX&VWX&X&5UWVVWVWVWVWVWWV5TWV5UWVVWWVVWVWWVWV5TW/5TWVVW5UWVWV5UWVVW5UVWVW5UWVVWVWWS5UWSWSVRVRWS5UVRVRVR5UX$5UX$X$5U5V5WX$5W5XX$X$VRX$X$X$5W5XX$X$W'W'W'5XW'W'5X5Y5YX$X$X$5YW'X$W'VRVR5Y5ZW'5ZW'W'VRVRW'W'5Y5ZX$X$VRVRX$X$X$X$X$5YX$X$5YW/W/5YW/W/X$X$W/W/X$X$W/W/X$X$W/W/X$5VX$5W5WW/W/W/X$X$X$5WX$X$5WX$X$X$W/5WX$5W5X5Y5YW/5ZW/X$X$X$5ZX$X$W/W/W'W'X$5YW'W'5YX$W/W/W/5YW/5YW/X$5Y5ZX$X$W/X$W/W/X$X$5Y5ZX$X$5ZX$5ZX$X$X$X$X$X$5ZX$X$X$5ZW/5ZW'W'5Z6#W'W'W/6#W/W/6#6$6%W'W'W/W'6%W/6%6&6'X$X$6'X$6'W'W'W'6'W'6(W'6(W'X$W'X$X$W'6(W'W'6(W'W'6(W'W'X$W'W'W'WV6'WVWV6'W/WVWVW/6'W:W:W'6'W'X$6'W'X$W'W'W'6'6(X$6(X$X$6(6)X$X$X$X$6)X$X$X$X$W'X$X$6(6)W'W'6)6*X$6*X$X$W'W'6*W'W'6*X$X$6*W'X$X$W'W'6*6+W'W'X$X$X$X$X$W'X$X$W'6)X$X$6)6*X$6*6+6,6,6-W'W'6-X$W'W'6-X$W'6.6.X$6/W'W'6/W'W'X$X$W'W'6.W'W'W'6.6/W'W'W'6/W'W'6/60W'W'VRVR6061VRW'61W'WX61WXWP61WXWPWPWX6162WP62WPWPWP62WP63WPWXWPWXWPWX62WPWP62WPWW6363WW64WWWPWPWP64WP64WWWW64WWWWWWWP64656666WWWWWWWXX.WXX.WXWXWX6565WPWPWPWP65WPWPWPWP65WPWPWP65WWWW65WWWW65V&66V&UC66UC6767V&V&V&UC67V?V?6768V?V?6869V?V?UC69V?V?696:V?V?6:6;V?V?UCUC6;6<UCV&6<V&6<V&6=6>TYTYV&V&TYTY6=TYV&6=TYTY6=TYTYTYV&V&U26=V&V&6=6>V&V&U26>V&V&6>U2TYTY6>6?TYTY6?TY6?6@TPTP6@TYTP6ATP6ATPTPTYTNTYTNTNUUTNUUTNUUTNUUUUUUUU6>TNTNTN6>TNUUTNUUY@6=Y@6>YDYDY7Y7S=S=6=S=S<S<S<6=S<S=6=S<S<6=S<S<S2S26=S2S<S2S<S<S<S2S<S2Y;Y,Y,Y,W0W06:6;W0W06;W06;W0WIWI6;6<W+W+Y;Y;Y;6<Y;Y;6<Y;6<W0WI6=W+W+W&W&6<W+W&W&6<W+W&W&W+W+W&W&W&W+W&6;6;W+6<W+W&W&6<W+W&W+W+W+W&W96;W9W9W9W2W2W9W9W2W969W9W9W9W&W&W&W9W&W+W9W+6768W969W+W+696:VS6:VSVSW+W+VSVSW+W+VSW+68W9W1W168W9W9W968W9W1W96869W2W2W9VS69VS69VSVSVSY;Y;W+69W+VYW+69W+69VYVYY;Y;69W+Y;Y;69VYVY69VYVY69Y;VYVYX&X&VYX&VYX&VYX&VY67VYX&67X&X&X&VYVYVY67VY67VYVY67X&X&X&67X&VYX&VY67VY68X&X&68X&X&X&6869VY69VYVYX&X&69X&696:VYVYVYVYWC6:6:X&VY6;X&X&6;X&VWVWX&X&VWVWX&X&VW69X&6:VWVW6:VWX&6:X&X&6:VWVWVW6:6;W:6<WVWV6<W:W/W/W:6<6<6=W:6>W/W/6>W/6>6?W:W:6?W:6@W:6@W<6A6BW:6BW:W:W:W:W:6BW:W<W<W<W:6AW:W:6A6BW:6CW:W:W:W<6BW:W<W<6BW<W<W<W:W:W:6BW<W<6BW<W<W<6BW<W:W<W:W<W<W?W<W<W<6@W<W<W<W<6@6A6AW?W<W?W<6AW<W<W<W<6A6B6BW?W?W?W<W<W<6BW<W<6BW?W<6BW<W?V#TNV#V#TNTN6ATNTOUQ6AUQUQUQ6AUQTNTN6ATN6ATNUJUJTN6AUJ6BUJ6BUJUJ6BTN6CTNUNUQUNUNTNTNUJ6B6BTNUJUJTNTNUJUJTNTN6A6BUJ6BUJUJ6BTNUJUJ6BTN6CUUW9VSW9VSS;WTS;WTVY6AVYVY6AX&VYVYWCWTWTWTW.WHW.W.W.W.W.6?W.6?W.W.W.WH6?WH6?6@W.W.6@6AW.W.WH6AW.W.W<W<X&6AX&6AX&X&W?W?W?6AW?6AW?W=W=W=W?W?W=W=6@W=W=6@W=W=W=W=W?W=W=W=W=W?W,W,W?W?W,W,W?W?W,W,W,6<W,6<W,6=W,W?6=W?W,6=W,W,6=W?W?W?W,W?W,W?WXWXWXX06;X0X0X0WXWX6;6<WXWX6<W4WXWXW4W4WXWXW4WXWX6:6;X#WXWXX#X#T@T@T@6:UN6:UNUN6:UNUNUN6:6;TCTCT-6;UH6<UHUH6<UHUDUHUDV6SCT$6;T$X06;6<W$X-X-6<6=W$6=W$X-X-X-6=W$6=6>6?W$X-X-W$6?W$6?W$W$6?X-6@X-W$W$W$6@WXWXWX6@WX6@WX6AWXWXWDWXWX6@WXWX6@WXWXWX6@6AW4W4TF6ATF6BTFTKTFTKS6S6S?S?SZSZSB6@SZSZ6@SZSBSZSBSZ6?SZSBSBSB6?SBSB6?SZ6@SZTFTFTF6@S0SOS06@6@6AS0S06ASO6BSO6BT&SOSOSOSOSO6BSOSO6BT&T&SMT&6B6BSM6CSM6CSM6DSMSMSM6DSMS5S5S56DS5S56DSLS5S56D6E6ESQ6FSQ6FSISISISISISQ6F6FSI6G6HSISISI6HSISYSYSYWAWAWA6GWA6G6H6I6IWA6J6KWAWA6KWYWAWY6KWYWYWYWYW7WYW7W7W76IW(6JW(U(U(T/U(T/6IT/T/SL6ISL6JS9S9S96JS9SLSLSLS9S96ISLS9S9SLSLSQSQSQ6H6HSISISISQ6HSQSQSQSKSKSKSQ6GSQSKSQSKSQ6GSQ6GSQSK6GS:6HS:6HSKSKSKS:SKS:S:SK6GSKS:S:6GS:S@6G6HS@S@S@SYS@6HSYSY6HSYS@6HS@S@V)TT6HTTV-V-V-6HT?V-T?6HV-V-V-6H6H6IT?T?6IUET?T?6ISQ6J6KSR6KSRSR6K6LSR6MSR6MSRSRS8S86MS8STS8S8S8S8S8S86LS86L6MSTS8S8S86M6MSTSTSTSTS8STST6L6MT3T3UA6MTITIT=TI6MTITTTT6MV3TIV3TIV3SRSR6L6MS86MS8S8STST6MSTSG6MSGSGT16MT1T16MT26NT2T26NT26O6OT=6P6QT26QT2T2T=T=6Q6RT26RT2T=6RTIT=6ST=6ST=T=V3V36SV36S6T6UT2T26U6VV3T2T2T26V6VV36WV3T=6WT2T26WT=6XT=T26XV3V3SESGSESGSGSGSU6W6WSGSUSUSGSGSG6W6WSUSUSUX>6WXFXF6WXFXFXFT5T56W6XT76XT7T7T7T5T7T7T76WT76XT5T5T56X6XT7T7T7T2T2T26XT2T26XT2T26XT0T06XT2T06YT2T26YT2T0T2T06YT2T2T2T0T2T26X6Y6Y6ZURURUR6ZURUR6ZV37#7$7$UR7%URT27%T2URT2URT27%T2UR7%UR7%URT2URT2T27%T27%T0T0T07%UR7&URV37&URURV3V37&V3UR7&URURURURT0URSG7%SG7&XFXFXD7&7&XF7'7(7(7)XDXDXFXFXD7)XFXF7)XFXFXF7)XFXD7)XDXD7)7*T7T7T1T1T6T6T1T1T6T6T1T1T6T6T1T1T6T6T1T1T6T67%YWYWYWY9Y97%Y9Y9Y9YW7%Y9Y97%Y9YWY9YWY9X1X1X1X)7#7$X)X)X1X1X)X)7#7$X)X)7$X)X)X)X1X17$7%X1X1X17%Y6Y6YB7%7%YB7&YBY6Y6Y67&Y67&YBYB7&YBYBYBY6Y67&YBY6Y6YBYBYBYBY6Y6YBYB7$YB7$7%Y6Y6Y67%Y6Y67%Y6Y6Y6Y)Y.Y)Y)Y)Y)Y)7$Y)7$Y)Y.Y)Y.Y)Y.Y)Y.Y.Y.YJ6ZYWYW6ZYWYWYWYJYJYWYJY5Y56YY.Y.6YY.Y.Y5YWY5Y5Y.Y.6XZ'Y.6X6YZ'6YZ'Y.6Z6ZYNZ%Z%YXYXYNYNYNYX6YYXYN6YYNYNYX6YYXYX6YYI6ZYIYX6ZYXYI6Z7#YZYZYPYP7#YPYP7#7$X1YP7$YPYI7$7%YIYI7%7&YIYI7&YPYPYPX17&X1X1YPYPX1X1YPYPYP7%7%X1X1X1YPX17%X1YPX1X1X1X1YIYIYIYIX1YIYIYI6ZYI7#YI7#YIX1YIYIYIX1YI6ZX1X1YIYIX16ZX1YIX1YIX1X1WRX1X1X1X16XX1X16XX)X1X)X)X)WJW@W@W@WJWJ6V6WW@W@W6W@VBVBUCUCVBVBUCUCVBVBUCUCVBVBUCUCVBVBUCUCVBVBUCUCVBVBUCUC6OTNUY6P6PTNTNTNVDVDVD6PVDVD6PTNVDVDTNTNULULTN6OTN6OTNTNULULTNULTN6N6OUL6OULTNTNULULTNTNULULTN6N6N6OTNTNV@6OTZTZV@V@TZTZUPUP6N6OUPUP6OUPUPUPUUUPY0Y06NY0YK6NYKYK6NY)Y0Y)Y0Y0Y06NY0Y06NYKY0Y0YKYKY0Y06M6N6NYKYKYK6N6OYKYK6O6PYKYKY0Y06PY0YK6PYKYKY0Y0YKY06OY0YKY0Y0Y0YKYKYK6NYKYK6N6OYKYKY0Y06OY0YK6OYK6PYKY0YKY0Y06OY06PY)Y)Y0Y0Y)6OY0Y0Y)Y)Y)6OY)6OY0Y0Y06O6PY06P6QY0Y0Y)Y)Y0Y0Y)Y0Y0Y0Y)Y)Y0Y06NY)Y0Y)Y)Y)6NY)6NY0Y0Y0Y)Y)6NY0Y)Y)6NY)Y06NY06OY)Y)6OY)Y)Y)Y)6OY)Y.Y)Y)Y.Y)Y.6NY)Y)6N6OY)Y)6OY)Y.Y.Y)6OY.Y.Y)Y.Y)6NY)Y)Y)Y)Y)Y.Y)Y)Y.6MY)6MY.Y.Y.Y.6MY.6MY.6NY.Y)Y.Y)Y)Y)6MY.Y.6MY.Y.Y.Y.Y)Y.Y.Y0Y)Y0Y0Y)Y)6KY)Y06K6LY)Y)Y)Y)Y.Y)Y.Y)6KY)Y)6KY.Y)Y.Y)6K6KY.6LY.Y)Y)Y)6L6LY.Y.Y.Y)Y)Y)6L6LY.Y.Y.Y.Y.6LY)6L6MY.Y.Y0Y0Y0Y)Y0Y)6LY)Y06LY06MY0Y06M6N6N6OY)Y)6OY)Y)Y)Y)Y)6O6P6PY.Y)6QY.Y.6QY.Y)6QY)6RY.Y.6RY.Y)6RY)6S6SY)Y06TY)Y)6TY)6TY)6U6V6VY)Y0Y0Y)6VY)Y.6V6WY.Y.YK6WYKYKY0Y06WY0Y06WYKYKY0YCY0Y0YCYC6VYCY0Y0Y06VY0Y0YKYK6U6VYKYK6V6WYK6X6X6YY06Z6Z7#YKYK7#7$YKYKYCYC7$7%YCYC7%YKYCYCYC7%YCY.Y.Y.YC7$YCY.Y.Y.7$Y.YK7$YKYKY.Y.7$Y.YK7$YK7%Y.7%Y.7&YK7&YKYKYK7&YKYKYK7&YKYK7&Y.YKYK7&Y.7'7(7(7)YKYKYKYK7)7*7*7+YKYKYKZ)YKYKZ)Z)7*Z)YK7*YKZ)Z)Z)Z)7*Z)YKYKYK7)Z)7*Z)Z)Z)Z)7*Z)7*YKYK7*YKYKYKZ)Z)YKYK7)YKYKYKYKYOYKYKYOYO7(YOYKYKYO7(YKYKYOYOYOYKYOYOY.Y.Y.7&7&Y.YKYKYK7&YKY.YKYKYK7&7&Y.Y.Y.YKYK7&YKYKY.YKY.7%Y.Y.Y.Y.Z'7%Z'7%Z'Y.Z'Y.7%Y.Y.Y.7%Y.7&Y.Z'Y.Y.7%Z'7&Z'7&Z'Z'Z'Z'Z'7&Z'7&Z'Y.Y.Y.YMYMYMY.Y.Y.7%Y.Y.YM7%Y.7%Y.Z'Y.Y.Y.7%Y.Y.Y.7%7%Z'7&7'7'Z'7(Z'YKYKYK7(YKYKYKY.YKYK7'Y.YK7'7(Y.7(Y.7)Y.YK7)YKY.7)Y.Y.Y.YKY.Y.Y.7(Y.7)Y.7)Y.YKYKYKYKYK7)YK7)YKY.7)Y.YK7*7*Y.YK7+Y.Y.7+7,Y.Y.Y.7,YK7,Z)Z)Z)7,Z)7-Y.Y.7-7.Y.Y.Z)Z)7-Z)Z)Z)Y.7-Z)Z)Y.7-Z)Z)7-Y.Z)Z)Y.Y.Z)Z)7,7-Z)Z)Z)Z)Y.Y.Z)Z)7,Z)Y.Y.Z)Z)Y.Y.Z)7+Y.Y.7+Z)7+Z$Z)7,Z)7,Z)7-Z)Z)7-Z$Z$Z$7-Z$7-Z#Z#Z#7-Z#7.Z#7.YOZ)Z)Z)Z)7.Z)YOZ)7.7/Z)Z)7/Z)Z)YO7/YOZ)Z)Z)YOZ)Z)7.YO7.YOYOYOYOZ)YO7.Z)YO7.YOZ)Z)YOYOZ)Z)7-7.Y.7.7/Z$Y.7/Z$Z$7/70Z$Z$Y.70Y.7171Z$Z$Z$7172Y.Z$72Z$Z$Z$YOYA72YA72YAYOYOYA72YOYO7273YO74YO74YO75YAYAZ(75YO7576YA76YAYOYOYAYAYO76YO76YOYO76YAYO77YOYO777878YAYO79YOYOYO7979YAYAYAYMYMZ$Z$YMYMZ$YMYMZ'YMYMZ'Z'76Z'Z'Z'7677Z'Z'77787879YMYM79YMYMYM79Z'7:Z'7:Z'YM7;Z'Z'YM7;YMYMYM7;YM7;Y/Y/Y/7;Y/Y/YMYMZ$Z$Z$Z$Z$7:7:Y27;Y27;7<Y2Y2Z$Z$7<Z$Z$7<7=Y2YMYMZ$YMY/Y/7<Y/Z$Y/Z$Z$7;Y/Z$Z$Y/Y/7;Y/Z$7;Z$Y/Z$Y/Z$Z$Z$Z$Z$7:Z$7:Z$Y2Y/Y/Z$Y279Y/Y2Y/Y/Y/Y279Y279Y2Y2797:Y2Y27:7;Y2Y27;Y/Y2Y27;Y2Y2Y2Y/Y/7;Y/Y/Y/7;Y/Y/Y/Y/7;Y/7;7<Y2Z$Z$7<Z$YAYA7<YA7<7=YAYAZ$7=YAYAYAY27=Y27=Y2YAYAYAYAZ(7=7=Y27>7?Z(Z(Z(7?Z(Z(YR7?Z(Z(YRZ(Z(Z(Z(7>7>Z(YRZ(Y/Y/Y/7>Y/Y/Y/Y27=7>Y2Y2Y27>Y2Y27>7?Y2Y2Y/Y/Y/7?Y/7?Y?Y?Y/7?Y/7@Y?Y?7@7AY?Y?7AY?Y/Y/Y2Y27@7AY2Y2Y2Y27A7BY27BY-Y-Y2Y27BY2Y2Y2Y27BY1Y1Y-Y-Y1Y17AY1Y27AY2Y1YGYGZ'Z'Z'7@Z'YGYG7@Y?Y?YGYGY?Y?Y?Y?Y?7?Y?Y?7?7@7@Y?Y4Y47@Y4Y1Y4Y?Y?Y4Y4Y?Y?Y4Y?Y47>Y4Y?Y?Y?Y4Y?Y4Y?Y4Y?Y4Y?7<Y?7<Y?Y4Y?7<Y?Y17=Y17=Y1Y17=7>Y?Y1Y?Y?Y1Y17=Y1Y1Y1Y?Y?Y1Y1YIYI7<7=YIYIY?Y?Y?7<Y?Y?7<YIY?Y?YIYI7<YI7<YI7=YIYIYIY?Y?YIYI7<7=YIYIY?YIY?YI7<YIYIYIYI7<Z&Y+Y+Y+VX7;VUVU7;7<VUVUVRX+VRX+VRVR7;7<7<X+X+X+X*W6X*W6W6W6W67;W67;X*X*7;X*X*X*7;7<WXWXW)W)WXW)7;7<WXWX7<X/WXWXX/X/WX7<UCTYUC7<UCUCUCTYUC7;TYTYTY7;TYTYTZTZTNTNTZTZTNTNTZTZU3U37879U3U3TNU379U3797:TNTN7:TZU3U3TZTZU3U3797:U3U3TZTZU3U3TZTZ797:TZTZV@V@TZ79TZ7:7:V@7;V@7;7<V@V@TZTZTZ7<TZTZ7<7=TZTZ7=7>TZTZ7>7?TZTZ7?7@7@V@7AV@7AV@V@V@TZTZUUUUTNU4TNU9U4U4U9U9TNU9TNU9U47=U9U9U4U37=U37=U3U9U3TNTNTN7=TNU37=U37=U87>U8U7U7TNU7U3UUU3UUU3UUU3UUUUUUU>7;U>7;U>U>V@7;V@7<V@7<V@7=TZTZTZ7=7=V@7>V@TZ7>TZ7?TZV@TZV@7>V@TZV@TZV@TZV@V@7=V@7>UUUU7>7?7?UU7@UUV@V@V@UU7?UUUUUUV@UUUUUUYD7>YDY@7>YDY@Y@YDYDYDY@YD7=Y@Y@Y@YD7=YDY@7=Y@YDYDYDYDYKYD7<YDYDYKYKYDYKY@YDYDYDYKYKY*Y*YKYKYK79YKYKYDYDYKYD78YK78YKYKYKYDYKYDYKYKYKYDYDYKYKYDYDYKYKYDYKYKYK7475YKYK75YKYOYOYK75YK75YK76YKYKYHYKYOYO75YO75YOYKYOYOYOYO75YO75YOYOYOYO75YQ75YOYQYOYQYQ757676YOYOYO76YRZ(Z(YRYR76YR76YRZ(YRYRYRZ(76YRYRZ(76Z(YRZ(Z(Z(YLZ(7575YLZ(Z(YR75YRY-YYYYYY75YUYUYYYUYY7475YU75Y1Y-7676Y1Y-Y-Y1Y1Y-Y-Y1Y1Y-Y1YV7475Y17576YVYVY1Y1YVYVY1Y1Y17575YVYVYVY1Y1757676YVYVYVY1Y176YVYVY1YVYV75YVYVYVY;Y;75Y;Y,Y;Y,Y,Y,Y,Y,74Y,74Y,Y,Y,74Y,Y;Y;Y;Y;X&Y;73X&X&73X&X&X&W#W#X&73W#7374X&74W#X&W#X&74X&X&7475X&X&X2W#X2X2W#W#W#74W#W#7475VWWVVW75VWVWVW75VW75VWVW75WVWVW/WVWV75WVWVWVVWWVWVWV74757576VWVWWVWVVWWVWSVRWSWS74VRWS75VRVR75X$75X$X$X$VRVR7576VR76X$X$76X$X$X$VRVR7677VR77X$X$7778X$X$VRX$X$X$W'77W'X$7778X$X$78X$X$X$W'X$X$X$W'X$X$X$VRVRW'W'VRVR75VRW'VRW'W'VRVRVR7474X$75X$X$75W/W/75X$W/W/X$X$W/W/X$X$X$74X$74X$X$X$X$W/W/X$X$7374X$X$74W/X$X$W/W/X$X$X$73X$X$7374X$X$747575X$W/W/X$75X$76X$X$W/W/W'W'X$75W'W'75X$W/W/7576W/W/W/7676X$X$X$76X$X$X$W/76W/W/76X$W/W/X$X$W/X$X$X$75X$X$X$X$75X$X$W'W'W/W/W/74W/W/W'W'73W'W'W'7374W/W/7475W/W/75W/W/W/W/W/W'W'W'W'W'74W/W/W/W'W'W/W/7373W'74W'X$X$74X$W/W/W/W'X$X$W'W'72W'W'W'7273X$X$W'737475X$X$X$W'W'X$X$X$WV73WV74W/W/74WVW/W/7475W'X$W'X$X$74X$W'W'W'W'74W'W'X$W'X$73X$X$73X$X$X$X$W'X$X$X$X$7273X$X$73W'73W'W'W'W'W'X$X$W'W'72W'W'W'727373W'X$X$W'W'W'73W'W'737474W'X$757576X$X$X$X$W'X$X$X$7576X$7677W'X$X$X$777778W'W'7879W'W'X$X$X$79X$797:W'7:X$W'W'X$X$W'X$X$X$W'W'X$X$787979W'W'W'W'79W'W'X$797:W'X$7:X$7;7;W'7<W'VRVRW'W'VRVRW'W'VRVRW'7:W'7:W'W'7:VRW'W'VRW'W'W'WXWXWX79WXWX79WXWXWXWX79WXWXWXWP78WPWPWPWPWP78WPWXWPWPWPWX77WPWPWPWPWW77WW77WWWWWPWPWP777778WWWWWPWPWP78WP7879WW79WWWWWWWPWPWP79WP79WWWW797:WWWW7:WWWWWWWX7:WPWPWXWP7:7;WP7;WP7<WPWPWP7<WPWP7<7=WW7=WWWWUCV&UCV&UC7<UC7=UCUCUC7=UC7=UCUCUCV&V&V&UCUC7<7=UCUC7=V?UCUCV?V?UCUCV?V?UC7;V?V?UCUC7;V?UCUCV?V?UCUCV?V?UC79V?V?79UCV?V?UC79V&V&79UCV&V&797:V&V&V?V&V?7:V?V&7:U2V&V&7:7;V&V&7;TYV&V&TYTY7:TYTYTYV&7:U2U27:7;U2U27;U2U2U2U27;U2U27;7<U2U2TYTYTPTPTYTYTPTPTYTY7:TYTP7:TPTPTP7:TPTP7:TYTP7;TYTY7;TYTPTYTPTPUUUU7:UUTNUU7:UU7:YDY@YDY@YDY@7:7:S=S<7;S<7;7<S=S=S=7<S<S2S27<7=7=S2S<S<W0W07=7>W07>7?WIW0W07?W0WIW0WIWIY;Y;W+7>7>W+W+W+Y;Y;W+7>Y;Y;7>Y;W0W0WIW0W0W0WIWIW+W+7<7=W+W+7=7>7>W&W&W+W+W+7>W+7>W+W+W+W&W&W&W+W&W9W&W9W9W9W9W2W97;W9W9W+W+7;W+7;W+W9W+VS7;VSVSW+W+7;W+VSW+VSW+W9W9W17:W1W17:W9W1W1W1W9W9W9W2W2W9W9W9W2W9W9W977W9VSW9VS7677W+W+W+VYW+VYW+76W+VY76W+W+W+Y;Y;Y;76VY76VYVYY;Y;VYY;X&75X&X&7576X&X&VYVY767777X&VYVY77X&78X&X&X&VYX&VY7778X&X&X&VYX&X&X&7778X&X&X&78X&X&VYVYX&X&VY7777X&78X&VYX&VYVY7778VYVYVYVYWCVYX&X&77X&X&X&VYX&VY76VY77VWVWX&VWX&76X&X&VWVW76VWX&X&X&7676VWVWVWW:76W:W:76WVW:WVW:76W:W:7677W:W:7778W:7979W/W:7:W/W/7:W/7:W/W:7;W/W/7;W/W:7;W:W:7;W/W:W/W:W:W/W:W/W:W/W/W:W<W:W<W:78W:W:W<W<78W<78W<W:W:W:78W<W<7879W:W:W<W<W:W:W<W<78W<78W<W:W<W:W:78W<78W<W<W<W:W<W:W<77W<W<W<W:W<W:W:76W?W?W?W<W<W<7676W?W?W?76W?W<W<W<W?W<W<W<W<W<75W<75W?W?W<W?W?W?W<W<W<74W<W<W<W?W<73W<W<73TNV#74TO7475UQ75UQ767777TNUJ78UJ78UJUJTNTN78TN78TNUJ79UJTNUJ79TNTN79TN79TNTNTNTNTNUJ79797:UJ7;UJ7;UJUJ7;TN7<TNUJ7<UJUJ7<7=UJUJTNUUTN7=TN7=UUUU7=X&VYVYX&X&7=7>W.W.W.7>W.WHW.W.7=WH7>WHWHWH7>7?WHWH7?7@WHWH7@W.WHW.W.W.WH7?WHW.W<W<7?W<X&7?X&W<W?7?W?7@W?W=W?W=7?W=W?W?7?WXW=7@W,W?W,7@W?W?7@W?7@W?W?W?W?W?7@W?W,7@W,7A7AW?W?W?WX7A7B7CWXWXWX7CWX7CW4W47CW4W4W4WXWXWXX#WXX#X#X#7AUNUNUNUQUQ7A7BUQ7B7CUNTJTJTCTCTJTJTCTJT-T-UHUHUHUHUH7@UHUH7@UHSC7@SCT$X0X0X07@7@W$W$W$7@X-W$W$X-X-7@X-7@X-X-X-X-X-7@X-X-X-X-7@X-X-7@7AX-W$X-W$X-X-W$X-W$7?W$W$X-X-7?X-W$7?W$7@W$X-W$X-WXW4WXW4WXWXWX7>WX7>WX7?WX7?WXWXWDWD7?WDWX7?W4W47?W4W4W47?TK7@TK7@TKTFTKSZ7@SB7A7ASZSB7BSB7BSBSBSB7BSBSBSZSZ7BSZSB7BSBSBTF7BTF7CS0SOS0S0S0SOS0S0SOSO7A7BSOSO7BSOS0SOS0SOSO7ASOSOSOSOSO7A7A7BT&T&T&SM7BSMT&7BT&7CT&7CT&7DT&7D7ESMT&SMSMSM7DSMT&SMS5S57D7ES5S5SLSLS5S5S57D7DS5SQ7ES5SQS5SQ7DSQSQSQSQ7D7ESI7ESISQSQSQSISQSISQ7DSQSQ7DSQSQSQSISISYSYWAWAWAWYWAWAWA7BWY7BWYWY7BWYWYWYWAWA7BWAWY7BWYWYWAWA7BWYWAWAWYWYWAWYWAWYW(W(W(WBW(WBWBWB7>U(T/U(SLSLSL7>SL7>SLSLS9S97>7?S97?7@SLSQSQSQ7@SISI7@SISQ7@SQSI7@SKSKSKSKSK7@SKSKSKSQSKSQS:SQS:SQS:SQS:SI7=SI7>SKSKSKS:S:S:S:S@SKSKS@S@SKSKS@S@S@7:S@S@7:SYS@7;S@S@S@SYV)7:V)V)V-V-V-7:7:UET?7;V-V-T?T?V-V-7:T?V-7:7;T?UEUE7;UESRSQSR7;SR7;SRSR7;SQSRSRSR7;SRSRS@S@SRSRS@S@7:S@SR7:SRSRSRS8SRSRS8S8STS8S8S8S8STSTST77ST7778STSTS8S87879S879STSTUAUAUA79UAUA79UAUATITITIT=TIT=TI777879V3SFSRSFSFSRSR78SRS8S8S878STST78STSGSFSGSGT177T17878T279T279T2T1T2T2T2T279T279T2T2T2T=T279T279T2T2T=T=79T=T2T=T2T27879T2T2T=T=79T=T279T2T=T=79T=7:T=TIT=T=T=T=T=7979V37:V37:V37;7<V3V37<V3T2T2T=T2T2T27;V37;V3V3V3T2T27;V3T2T2T2V37:V3V3V3T=T=7:7;T=T=7;T=T27;T2T2T2T27;V3SGSGSUSUSGSGSGSUSGSG797:SG7:SGSUX>X>7:7;X>X>7;7<T77<T7T7T5T57<7=7=7>T7T7T7T5T7T5T7T5T7T7T5T57<7=T77=T7T7T2T2T9T9T2T2T9T9T2T0T0T0T0T2T0T0797:T0T0T2T27:T2T07:T0T0URURT2URV3V3URV3T278T2URURV3URURURV3UR77V3V377V3UR77URURV3V3URV3T2URT2UR75UR76UR7677URUR77URT278T2T2T2URT2URT2T276T0T0T0T2T276T276URT2URT2UR76URV3V3UR7676V3UR777778URURSUSUSG78SGSUSUSU77XDXDXDXFXF77XF7778XDXD78XF79XF79XFXDXDXFXDXDXDXFXFXD78XFXF7879XFXF79XF797:XDXD7:7;T7T7T0T0T7T0YWY9YWYWYWY9YWYWY9Y9YWYWY9Y9YWY9X1X1X)X)X1X1X)X)X)X1X)X)X1X1X)X)X1X)X)X)X1X1X)X)X1X1X)X)X1X1X1X)Y6Y6YBYBY6YBY6YBY6YBYBYBY6Y6YBYBY6Y6YBYBY6YBYBYBY6YBYBYBY6YBY6Y6YBYBY6Y6YBYBY6Y6Y6YBY6Y6YBYBY6Y6Y)Y.Y)Y.Y)Y.Y)Y.YJYJYWYWYJYJYWYWY5Y5Y.Y.Y.Y5Y.Y.Y.Y.Y.Z'Z'Z'Y.Z'Y.Y.Y.Z'Z'Z'Y.Z'Z'Z'Y.Z'YNYNZ%Z%YNYXYNYXYXYXYNYNYXYIYXYXYIYIYXYIYXYXYXYIYXYXYXYIYPYPYZYZYPYPYZYPYZYZYZYPYPYPX1X1YPYPYPX1YPYIYPYPYIYPYIYIYPYPYIYIYIYPYIYIYPYPYIYIYPYPYPYIYPYPX1X1YPX1X1X1YPYPX1X1YPX1YPX1YIYIYIX1YIX1YIX1YIYIYIX1YIYIX1X1X1YIX1YIX1X1X1X)X1X)X)X)WJWJW@W@WJWJW@W@UYTNUYUYUYTNUYUYUYTNUYTNVDVDVDTNVDVDTNTNULULTNULTNULTNTNTNULULULTNULULULULULTNULULULTNULULULTNTNULULTNTNV@V@TZV@UPUPUPUUUPUPUUUUUPUPUUUUY0Y0YKY0Y0Y0YKY0Y0Y)Y0Y0Y0Y0YKYKY0YKYKYKY0Y0YKYKY0Y0YKYKY0YKYKYKY0Y0YKY0Y0Y0Y0YKY0Y0YKYKY0Y0YKY0Y0Y0YKY0Y0Y0YKY0YKYKYKY0Y0Y0YKYKY0Y0YKYKY0Y0YKY0Y0Y0YKYKY0Y0YKY0YKY0YKY0Y)Y)Y0Y)Y0Y)Y0Y)Y)Y)Y0Y0Y)Y)Y0Y0Y)Y0Y0Y0Y)Y)Y0Y0Y)Y0Y0Y0Y)Y)Y0Y0Y)Y)Y0Y0Y)Y)Y0Y)Y0Y)Y0Y)Y0Y)Y0Y0Y)Y)Y0Y0Y0Y)Y0Y0Y0Y)Y0Y)Y0Y)Y0Y0Y)Y)Y0Y)Y)Y)Y.Y.Y.Y)Y.Y.Y)Y)Y.Y.Y)Y)Y.Y.Y)Y)Y.Y.Y.Y.Y)Y)Y)Y.Y)Y.Y)Y)Y.Y.Y)Y)Y)Y.Y.Y.Y)Y)Y)Y.Y)Y)Y)Y.Y.Y.Y)Y)Y.Y.Y)Y)Y.Y.Y)Y)Y0Y0Y0Y)Y)Y)Y0Y)Y0Y0Y)Y.Y)Y)Y)Y)Y)Y.Y)Y.Y)Y)Y.Y.Y)Y.Y)Y.Y)Y.Y)Y)Y.Y.Y)Y.Y)Y.Y)Y.Y.Y.Y)Y.Y.Y.Y.Y)Y)Y)Y)Y)Y.Y.Y)Y.Y.Y.Y0Y0Y0Y)Y0Y)Y0Y0Y0Y0Y0Y)Y0Y0Y0Y)Y0Y)Y)Y)Y0Y)Y0Y)Y0Y)Y)Y)Y)Y)Y0Y)Y)Y)Y)Y.Y)Y.Y.Y.Y)Y.Y)Y)Y)Y.Y)Y.Y.Y.Y.Y)Y)Y.Y.Y.Y)Y.Y)Y)Y.Y.Y)Y.Y)Y.Y)Y.Y)Y.Y)Y.Y0Y)Y0Y)Y)Y)Y0Y0Y)Y)Y0Y)Y0Y)Y0Y)Y)Y)Y0Y0Y)Y)Y0Y0Y)Y)Y)Y0Y)Y)Y)Y.Y)Y.Y.Y.Y)Y.Y.Y.Y0Y0YKYKYKY0YKYKY0Y0YKYKY0Y0Y0YCY0YCY0Y0Y0Y0Y0YKY0Y0YKYKY0Y0YKYCY0YCYCYCYKYCYKYCYCYCY0Y0YCYCY0YCY0YCY0YCYCYCYKYKYCYCYKYKYCYCYKYKYCYCYKYCYCYCYCYKYCYCYKYCYCYCYKYKYCY.YCY.YCY.YCY.Y.Y.YKYKYKY.YKYKYKY.YKY.YKY.YKY.Y.Y.YKYKY.YKY.Y.Y.Y.Y.YKY.YKYKYKY.YKYKYKY.Y.YKYKY.Y.YKYKY.Y.YKY.YKY.YKYKY.YKYKYKYKY.YKYKY.Y.YKY.YKYKYKZ)YKYKZ)Z)Z)Z)Z)YKZ)Z)Z)YKYKZ)Z)Z)YKZ)YKZ)Z)Z)Z)YKYKZ)YKZ)YKYKZ)Z)Z)Z)Z)YKZ)Z)Z)YKZ)YKYKYKZ)Z)YKYKYKYOYKYOYOYKYOYOY.Y.YKY.Y.Y.YKYKYKY.YKYKYKY.YKY.YKY.Y.Y.YKYKY.Y.Y.Y.YKY.Y.Z'Z'Z'Y.Z'Y.Z'Y.Z'Y.Z'Y.Z'Y.Z'Y.Y.Y.Z'Y.Y.Y.Z'Y.Z'Z'Z'Z'Z'Y.Z'Y.Z'Y.Z'Y.Z'Y.Y.Y.Z'Y.Z'YMY.YMYMY.Z'Z'Z'Y.Z'Z'Z'Y.Y.Y.Z'Y.Y.Y.Z'Z'Z'YMYMZ'Z'YMYMY.Y.Y.Z'Y.Z'Z'Z'YKYKYKY.YKY.Y.Y.YKY.Y.Y.YKY.YKY.YKY.YKY.YKY.YKY.YKYKYKY.YKY.Y.Y.YKY.YKY.YKY.YKY.YKY.YKY.YKYKYKY.YKY.Y.Y.YKY.YKY.Y.Y.YKY.YKY.YKY.Y.Y.Z)Y.Y.Y.Y.Z)Y.Y.Z)Z)Y.Y.Z)Y.YKYKZ)Z)Z)Z)Y.Y.Z)Y.Z)Z)Y.Y.Z)Z)Y.Z)Z)Z)Y.Z)Z)Z)Y.Y.Y.Z)Y.Y.Y.Z)Y.Y.Z)Y.Y.Y.Y.Z)Y.Y.Z)Z)Z)Z)Y3Y3Y.Y.Z)Z)Y.Y.Z)Z)Z)Z$Z)Z$Z$Z$Z)Z$Z)Z$Z)Z$Z)Z$Z)Z$Z)Z$Z$Z$Z#Z$Z#Z$Z)Z#Z#Z#Z#Z#Z)Z#Z)Z#Z)Z)Z)Z)YOZ)YOZ)YOYOYOZ)YOYOZ)Z)YOYOZ)Z)YOYOZ)YOZ)YOZ)Z)Z)YOZ)YOYOYOYOZ)YOYOZ)Z)Z)YOZ)Z)YOYOZ)YOYOYOY.Y.Y.Z$Y.Y.Y.Z$Y.Y.Z$Z$Y.Y.Y.Z$Y.Y.Z$Z$Y.Z$Y.Y.Y.Z$Z$Z$Y.Z$Z$Z$Y.Y.Y.Z$Y.Y.Z$Z$Y.Z$Z$Z$YOYAYAYAYOYAYOYOYAYAYAYOYAYAYOYOYAYAYOYAYOYAYOYAYOYOYOYAYOYAYOYOYAYAZ(Z(YOYAYAYAYOYAYAYAYAYAYOYOYOYAYOYOYOYAYOYOYAYAYOYOYOYAYOYOYOYOYAYAYOYOYAYOYAYAYOYAYAYAYOYOYOYAYAYAYOYOYOYAZ'Z'YMZ'Z'Z'YMYMZ'Z'YMYMZ'Z'YMYMZ'Z'YMZ'YMZ'YMYMZ'Z'YMYMZ'Z'YMYMYMYMYMZ'Z'Z'YMZ'YMZ'YMYMZ'Z'YMZ'Z'Z'YMYMYMYMY/YMYMYMYMY/Y/YMY/Y/Z$Z$Y2Y2Z$Z$Z$Y2Z$Y2Y2Y2Z$Z$Y2Y2Z$Z$Y2Y2Z$Z$Y2Y2Z$Y2Z$Y2Z$Y2Y2Y2Z$Y/Z$Y/Z$Y/Z$Z$Z$Y/Z$Z$Z$Y/Y/Y/Z$Z$Z$Y2Z$Z$Z$Y2Y2Y/Y2Y2Y2Y/Y2Y2Y2Y/Y2Y2Y/Y/Y2Y2Y/Y/Y2Y2Y/Y/Y2Y2Y/Y/Y2Y2Y/Y/Y/Y2Y/Y/Y2Y2Y/Y/Y2Y/Y/Y/Y/Y2Y/Y/Y2Y2Y/Y2Y2Y2Y/Y2Y2Y2Z$Z$Z$YAYAYAZ$Z$Z$Z$YAYAZ$Z$YAYAZ$YAZ$YAYAY2Y2Y2Y2Y2YAY2YAZ(Z(Z(Y2Z(Z(Z(Z(Y2Y2Y2Y2Y2Z(Y2Z(Z(Z(YRYRZ(YRYRYRYRYRZ(Z(Z(YRYRY/Y/Y2Y2Y/Y/Y/Y2Y/Y/Y2Y2Y2Y/Y2Y2Y/Y/Y2Y2Y/Y2Y2Y2Y/Y/Y/Y?Y/Y/Y?Y?Y/Y?Y/Y?Y/Y?Y/Y/Y?Y?Y2Y2Y?Y2Y2Y2Y2Y?Y2Y2Y/Y/Y2Y2Y/Y2Y2Y2Y2Y2Y2Y-Y2Y2Y-Y-Y2Y-Y-Y-Y2Y2Y-Y-Y2Y2Y2Y1Y-Y1Y-Y-Y2Y2Y2Y1YGYGZ'YGYGYGY?Y?Y?Y?Y1Y1Y?Y?Y1Y1Y?Y1Y1Y1Y?Y?Y4Y4Y4Y4Y1Y4Y4Y?Y4Y4Y4Y?Y?Y?Y4Y?Y4Y?Y?Y?Y1Y1Y1Y?Y1Y?Y1Y?Y1Y1Y?Y?Y?Y1Y?Y?Y1Y1Y?Y1Y1Y1Y?YIY?Y?YIYIY?YIYIYIY?Y?YIYIY?YIYIYIY?YIY?YIY?YIY?Y?Y?YIYIYIY?YIYIYIY?Y?YIYIY?YIYIYIZ&Z&VXVXVXVUVXVXVUVUVXVUVUVUVRVRX+X+VRX+X+X+VRVRVRX+W6W6W6X*W6W6X*X*W6W6X*X*W)W)WXWXW)W)WXW)WXX/WXWXX/X/WXWXX/X/WXWXWXX/WXX/UCTYUCTYUCTYTYTYTYTNTYTYTZTZU3U3TZTZU3U3TNU3TNU3TNU3TNTNU3U3TNTNTZTZU3U3TZTZU3U3TZTZU3U3TZTZTZV@TZTZV@V@TZTZTZV@TZV@V@V@TZV@TZV@TZV@TZV@TZTZTZV@TZTZV@V@TZTZTZUUTZTZUUUUTZTZUUUUTZTZUUUUTZTZUUUUTZTZUUUUTZTZUUUUTZTZUUUUTZTZUUUUTZV@TZV@TZV@TZV@TZV@TZV@U4U4U9U9U4U3U4U3U4U3U9U3TNTNU3U3TNTNU3U3TNTNTNU8TNU8U8U8UUUUU>U>UUUUU>U>V@UUV@UUV@UUV@UUV@UUV@V@V@V@V@UUTZV@V@V@TZV@TZV@TZTZTZV@TZTZTZV@TZV@V@V@TZV@TZV@V@UUV@UUUUUUV@UUUUUUV@V@UUUUV@UUV@UUV@UUV@UUV@UUV@V@UUUUYDYDYDY@YDYDY@Y@YDYDYDY@Y@YDYDYDY@YDYDYDYKYKYDYDYKYKYKYDYDYKYDYKYKYKYDYKYKYKYDYDYKYKYDYDYKYKYDYDYOYOYKYOYKYKYKYHYHYHYKYHYOYOYKYOYKYOYKYOYOYOYOYQYOYQYOYQYOYOYQYQYOYOYQYQYQYQYOYOYQYQYOYOYQYQYQYOYRYRZ(Z(YRYRZ(YRZ(YRZ(Z(YRYRZ(YRYRYRZ(YRZ(YLZ(YLYLYLZ(YLYRY-Y-Y-YYYYYUYUYYYUYYYUYYYUYUYUY1Y1Y-Y1Y1Y1Y-Y1Y-Y1Y-Y-YVYVY1Y1YVYVYVY1Y1Y1YVYVY1Y1YVY1Y1YVYVYVY1Y1YVYVY1Y1Y1YVY1YVYVYVY1YVYVYVY1Y1YVYVY1YVYVYVY;Y;Y,Y;Y,Y;Y,Y,Y,Y,Y,Y;Y,Y,Y,Y;Y;Y;X&X&Y;X&X&X&W#W#X&W#W#W#W#X&W#W#X&X&W#W#X&X&W#W#X&X&W#W#X&X&W#W#X&X&W#W#X&X&W#W#X&X&W#W#X&X&WVWVVWVWVWWVVWWVVWWVVWWVWVWVWVW/WVWVVWVWVWWVVWVWWVWVVWWVVWWVVWVWWVWVVWWVVRVRWSVRVRVRWSWSVRVRVRX$VRX$X$X$VRVRVRX$VRX$X$X$VRVRVRX$VRX$VRVRX$VRX$X$VRVRX$X$VRVRX$X$VRVRX$X$VRVRX$X$W'W'X$X$W'X$X$X$W'W'X$X$W'W'X$X$VRVRW'VRVRVRX$X$VRX$VRX$VRX$X$X$X$X$W/W/X$X$W/X$X$X$X$W/W/W/X$W/X$X$W/W/X$X$W/W/X$W/W/W/X$W/X$X$X$X$W/W/X$X$W/W/X$X$W/W/X$X$W/W/X$X$W/W/W/W/X$W/W/W/X$W/W'W'X$X$W'X$X$X$W/W/W/X$W/X$X$X$W/X$X$X$W/W/W/X$W/X$X$X$X$X$W/W/X$X$W/W/X$X$W/X$X$X$W'W'W/W/W/W'W/W/W'W'W/X$W/W/X$X$W/W/X$X$W/W/X$W/W/W/W/X$W/W/W'W'W/W/W/W/W/W'W/W/W/W'W/W'W'W'X$X$X$W/W'X$W'X$W'W'X$X$W'W'X$W'W'X$W'X$W'X$W'W'X$X$W'X$WVWVWVW/W/W/WVWVW/W/WVWVW/W/W:W:W/W/W:W:X$W'X$W'W'W'X$X$X$W'X$X$W'X$X$X$X$W'W'W'W'X$W'X$X$X$X$W'X$X$W'W'X$W'X$X$X$W'X$X$W'W'X$W'X$W'X$X$W'W'X$X$W'W'X$X$W'W'X$X$W'W'X$W'X$W'X$X$W'W'W'X$W'X$X$X$X$X$X$W'X$X$W'W'X$X$W'W'X$X$W'W'X$W'X$W'X$X$X$W'X$X$W'W'X$X$W'X$W'W'X$W'X$X$X$W'X$X$W'W'X$W'W'W'X$X$W'W'X$X$X$W'X$X$W'W'X$W'X$W'X$X$W'W'X$W'W'W'X$W'W'W'W'W'X$X$X$X$W'W'W'W'X$X$X$X$W'W'W'VRW'W'VRVRW'W'VRVRW'VRWXWXWPWPWPWPWPWXWXWPWPWPWXWXWPWPWXWPWXWXWXWXWPWPWPWPWWWWWPWPWWWWWPWWWPWWWPWPWPWWWPWWWWWWWPWPWWWPWPWPWWWWWPWWWWWWWPWPWWWWWPWWWPWWWPWPWPWWWPWPWWWWWPWWWWWWWPWWWWWWWXWXWPWPWXWPWPWPWPWXWPWPWPWWWPWWWPWPWPWWWPWPWWWPWPWPWPWWWPWPWWWWWPWWWWWWV&V&UCV&UCV&UCV&UCV&V&V&UCV&UCUCUCUCV?V?UCUCV?V?UCUCV?V?UCUCV?V?UCUCV?V?UCUCUCV?UCUCV?V?UCUCV&V&UCUCV&V&UCUCV&V&UCV&V&V&V?V&V?V&V?V?U2U2U2V&U2U2V&V&U2U2V&TYV&V&V&V&V&TYV&V&U2U2V&V&U2U2V&V&U2U2V&V&U2U2V&V&U2U2V&V&U2U2V&V&U2U2TYTYTPTYTYTPTPTPTPTYTPTPTYTYTPTYTYTYTPTYTPTYTPTPUUUUTNUUTNTNUUUUY@YDY@YDY@YDY@YDS<S=S<S=S=S=S<S<S<S=S=S=S<S=S<S<S=S=S<S<S<S2S<S<S2S2S<S2S2S2S<S2W0W0WIWIW0WIWIWIW0W0W0WIWIW0WIWIWIW0WIW0Y;Y;W+W+Y;Y;Y;W+W+Y;W+W+W+Y;W+W+W+W+W&W&W+W+W&W+W+W+W+W&W+W+W&W+W&W&W&W+W+W+W&W+W&W+W&W+W9W+W9W9W9W+W9W+W9W+W9W9VSW+VSW+W+W+VSW+W9W9W1W9W1W1W1W9W9W9W9VSY;Y;W+Y;Y;Y;W+W+W+W+W+VYY;Y;W+W+Y;VYY;VYY;Y;VYY;X&VYX&X&VYVYX&X&VYVYX&X&VYVYVYX&VYX&X&X&X&X&VYX&VYVYVYX&X&X&VYX&VYVYVYX&VYVYX&X&VYX&VYVYX&X&VYX&X&VYVYVYVYX&VYVYVYX&VYX&VYX&VYVYX&X&X&VYX&X&VYVYVYX&VYVYVYX&VYX&VYX&VYVYX&VWX&X&VWVWX&VWX&X&X&VWX&VWVWVWW:WVW:W:WVWVW:WVWVWVW:WVWVWVWVW:WVWVW:W:W:W/W:W:W/W/W:W/W:W/W:W:W/W/W:W/W:W/W:W:W/W/W:W/W:W/W:W:W:W/W:W:W/W/W:W/W:W/W:W:W/W/W:W/W:W<W:W:W:W<W:W<W:W<W:W:W:W<W<W<W<W<W:W:W<W<W:W<W<W<W:W<W:W<W:W<W:W:W:W<W:W:W:W<W:W<W<W<W<W<W<W?W<W<W?W?W<W<W<W?W<W?W<W?W<W?W?W?W<W<W<W?W<W<W<W?W<W?W<W?TNTNV#TNTNTNV#TNTOUQTOUQTOTOTOUQUQUQTOUQTOUQTOTOUQUQTOUQUJTNUJUJUJTNUJTNTNTNUJTNTNTNUJTNUJTNUJUJUJTNTNTNTNTNUJUJTNTNUJTNUJTNTNTNUJTNUJTNTNTNUJUJTNTNUJTNUJTNUJUJTNTNUJTNTNTNUJTNUJTNUJUJUJTNUJUJTNTNUJUJTNTNUJTNTNUUTNUUTNUUUUUUX&X&VYVYX&X&VYVYX&X&VYX&W.W.W.WHW.W.W.WHW.WHWHWHW.WHW.W.WHWHW.WHWHWHW.W.WHWHW.W.WHWHWHW.WHW.WHW.X&W<X&X&X&W<W<W<W?W?W?W=W?W=W=W=W?W=W?W=WXWXW=W=W=WXW=W=W,W?W,W,W,W?W,W?W,W,W,W?W?W?W,W,W,W,W,W?W,W?W,W?W,W,W?W,WXX0X0X0WXWXX0X0WXX0X0X0WXW4W4W4WXWXWXW4WXW4W4W4T@UNUNUNUNUQUNUNUQUQUNUQUQUQUNUNUQUNUQUNUHUHUDUDUHUHUDUDSCT$SCT$X0X0X0W$X0X0X0W$X-X-W$W$W$X-W$X-W$X-W$X-X-X-X-W$X-X-X-W$X-X-W$W$X-W$W$W$W$X-W$W$W$X-W$W$X-X-W$X-W$X-W$X-WXWXWXWDWXWDWDWDWXWDWXWDWXWXWXWDWDWDWXWDWXWXWXW4WXW4W4W4TFTKTKTKTKTKTFTKTFTKTFTFSZSZSZSBSZSZSBSBSZSZSBSBSZSZSBSZSZSZSBSZSZSZSBSBSZSZSBSBSBSZSBSBTFTKTFTKTFTKTFTKSOSOS0S0SOSOS0S0SOSOS0S0SOT&SOSOSOT&SOT&SOSOSOT&SOSOT&T&T&T&T&SMT&T&T&SMT&SMT&SMT&SMT&SMT&SMT&T&T&SMSMSMT&SMT&SMT&SMT&SMS5SLSLSLSLS5SLSLS5SQS5SQS5S5SQSQSQS5SQSQS5SQS5SQSQSISISISQSQSQSISQSISQSQSQSISQSQSISISQSQWAWAWYWYWAWAWYWYWAWYWYWYWAWAWYWAWYWAWYWYWYWAWYWYT/U(T/U(SLS9SLS9SLS9SLSLS9S9S9SLS9S9SLSLS9S9S9SLS9SLSLSLSQSISQSISQSISQSISQSISQSISQSQSQSKSKSKSQSKSISISISKSISKSISKS@SYS@S@SYSYS@SYSYSYS@S@V)TTV)TTV-V-V-T?T?V-T?T?T?UET?T?V-T?T?T?V-T?T?T?V-V-T?T?UEUET?T?SQSQSRSQSRSQSRSRSQSQSQSRSQSRSRSRS@S@SRS@S@S@SRS@S8S8S8STSTS8STSTS8S8S8STS8S8S8STS8S8STSTS8S8STSTUAUAUAT3UAUAT3UATTTTTTV3TTTTV3V3TTV3V3V3SFSRSFSRS8STS8S8SFSTSFSTT1T1T2T2T1T2T1T1T1T1T2T2T2T2T1T2T1T2T1T2T2T2T=T=T2T=T2T2T=T=T2T=T2T=T2T2T2T=T2T=T2T=T2T2T=T=T2T=T=T=T2T=T=T=T2T=TITIT=TIT=TIT=T=T=V3T=T=V3V3T=V3T=V3T=V3T=V3T=V3T=V3T=T2V3V3T2T2V3V3T2V3T2T2V3V3T2V3V3V3T2T2T2V3T2V3V3V3T=T=T2T2T=T=T2T2T=T=T2T=T=T=T2T=T2V3V3V3SGSGSGSUSGSUSUSUSGSUSGSUX>XFXFXFXFX>XFXFX>X>XFXFX>XFXFXFT5T5T7T5T7T5T7T7T5T5T7T5T5T5T7T5T5T5T7T5T5T5T7T7T5T5T5T7T5T5T7T7T0T2T0T0T2T2T0T2T0T2T0T0T0T2T0T0URURT2URURV3URURV3URURURV3V3URV3T2URT2URT2T2T2URT2T2T2URT2URURURT2URT2T2T2URT2T2T2T2T0T0T0T2T0T0T2URT2URT2URURURURV3URV3V3V3URURURV3URURURV3URURV3V3URURSGSUSUSUXFXFXDXDXFXFXDXFXDXFXDXFXFXFXDXFXFXFXDXFXDXFXDXDXFXFXDXFXDXFXDXDXFXFXDXDXFXFXDXFXFXFXDXFXDXFXDXDXFXFXDXDT7T0T7T7T0T0T7T7",T=["Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmara","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Juba","Africa/Kampala","Africa/Khartoum","Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome","Africa/Tripoli","Africa/Tunis","Africa/Windhoek","America/Adak","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/Buenos_Aires","America/Argentina/Catamarca","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja","America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Aruba","America/Asuncion","America/Atikokan","America/Bahia","America/Bahia_Banderas","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Cayenne","America/Cayman","America/Chicago","America/Chihuahua","America/Ciudad_Juarez","America/Costa_Rica","America/Coyhaique","America/Creston","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fort_Nelson","America/Fortaleza","America/Glace_Bay","America/Goose_Bay","America/Grand_Turk","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Indianapolis","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vincennes","America/Indiana/Winamac","America/Inuvik","America/Iqaluit","America/Jamaica","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Kralendijk","America/La_Paz","America/Lima","America/Los_Angeles","America/Lower_Princes","America/Maceio","America/Managua","America/Manaus","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Menominee","America/Merida","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montserrat","America/Nassau","America/New_York","America/Nome","America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/New_Salem","America/Nuuk","America/Ojinaga","America/Panama","America/Paramaribo","America/Phoenix","America/Port-au-Prince","America/Port_of_Spain","America/Porto_Velho","America/Puerto_Rico","America/Punta_Arenas","America/Rankin_Inlet","America/Recife","America/Regina","America/Rio_Branco","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Sitka","America/St_Barthelemy","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat","Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Macquarie","Antarctica/Mawson","Antarctica/McMurdo","Antarctica/Rothera","Antarctica/Syowa","Antarctica/Troll","Antarctica/Vostok","Arctic/Longyearbyen","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Atyrau","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Barnaul","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Chita","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Famagusta","Asia/Gaza","Asia/Hebron","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Kathmandu","Asia/Khandyga","Asia/Kolkata","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qostanay","Asia/Qyzylorda","Asia/Riyadh","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Srednekolymsk","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Tomsk","Asia/Ulaanbaatar","Asia/Urumqi","Asia/Ust-Nera","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yangon","Asia/Yekaterinburg","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faroe","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney","Etc/GMT","Etc/GMT+1","Etc/GMT+10","Etc/GMT+11","Etc/GMT+12","Etc/GMT+2","Etc/GMT+3","Etc/GMT+4","Etc/GMT+5","Etc/GMT+6","Etc/GMT+7","Etc/GMT+8","Etc/GMT+9","Etc/GMT-1","Etc/GMT-10","Etc/GMT-11","Etc/GMT-12","Etc/GMT-2","Etc/GMT-3","Etc/GMT-4","Etc/GMT-5","Etc/GMT-6","Etc/GMT-7","Etc/GMT-8","Etc/GMT-9","Etc/UTC","Europe/Amsterdam","Europe/Andorra","Europe/Astrakhan","Europe/Athens","Europe/Belgrade","Europe/Berlin","Europe/Bratislava","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Busingen","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man","Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kirov","Europe/Kyiv","Europe/Lisbon","Europe/Ljubljana","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Saratov","Europe/Simferopol","Europe/Skopje","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Ulyanovsk","Europe/Vaduz","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zurich","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Pacific/Apia","Pacific/Auckland","Pacific/Bougainville","Pacific/Chatham","Pacific/Chuuk","Pacific/Easter","Pacific/Efate","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Kanton","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Pohnpei","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Wake","Pacific/Wallis"];if(W=+W,!(-90<=(Y=+Y)&&Y<=90&&-180<=W&&W<=180))throw new RangeError("invalid coordinates");if(90<=Y)return"Etc/GMT";for(var V=-1,S=48*(180+W)/360.00000000000006,U=24*(90-Y)/180.00000000000003,Z=0|S,$=0|U,K=96*$+2*Z,K=56*X.charCodeAt(K)+X.charCodeAt(K+1)-1995;K+T.length<3136;)K=56*X.charCodeAt(K=8*(V=V+K+1)+4*($=0|(U=2*(U-$)%2))+2*(Z=0|(S=2*(S-Z)%2))+2304)+X.charCodeAt(K+1)-1995;return T[K+T.length-3136]}"undefined"!=typeof module&&(module.exports=tzlookup);

</script>
  <script type="module">
// main.js
// 

import * as THREE from 'three';
import * as TWEEN from 'tween.js';
import { scene, camera, renderer, controls, initScene, EARTH_RADIUS, cloudSphere, earthMat, stand, globeAssembly, zenMasterGroup } from './modules/scene.js';
import { drawGeoFeatures, geoLinesGroup } from './modules/features.js';
import { convertVec3ToLatLon } from './modules/geography.js';
import { loadData, extraData, labels } from './modules/data.js';
import { initCities, updateCities } from './modules/cities.js';
import { initInteraction, updateIdlIndicators, lockedCountry, hoveredCountry, getTimezoneFor, formatDateTime, updateInfoPanelContent } from './modules/interaction.js';
import { findCountryAt } from './modules/hit-test.js';
import { updateLabels } from './modules/labels.js';
import { AppConfig } from './modules/config.js';
// ---   #1:  ---
import { initZenMode, updateZenMode } from './modules/zen-mode.js';

// ---  ---
window.currentLanguage = 'en';
let focusedCountryCode = null;
let idlLine = null;
let isIdlCentered = false;
const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

// --- UI ---
let settingsBtn, settingsPanel, settingsCloseBtn, cloudToggle, nightModeToggle, langBtn, timeObserverMain, timeObserverHover;

// ---  ---
document.addEventListener('DOMContentLoaded', async () => {
  initScene();
  drawGeoFeatures();
  await loadData();
  initCities(scene);
  initInteraction();
  // ---   #2:  ---
  initZenMode({ scene, camera, renderer, controls, globeAssembly, stand, zenMasterGroup });

  //  DOM 
  langBtn = document.getElementById('language-switch-btn');
  settingsBtn = document.getElementById('settings-btn');
  settingsPanel = document.getElementById('settings-panel');
  settingsCloseBtn = document.getElementById('settings-close-btn');
  cloudToggle = document.getElementById('cloud-toggle');
  nightModeToggle = document.getElementById('night-mode-toggle');
  idlLine = scene.getObjectByName('interactive_idl_line');
  timeObserverMain = document.getElementById('time-observer-main');
  timeObserverHover = document.getElementById('time-observer-hover');

  // 
  langBtn.addEventListener('click', toggleLanguage);
  settingsBtn.addEventListener('click', () => { settingsPanel.classList.toggle('visible'); });
  settingsCloseBtn.addEventListener('click', () => { settingsPanel.classList.remove('visible'); });
  cloudToggle.addEventListener('change', (event) => { if (cloudSphere) cloudSphere.visible = event.target.checked; });
  nightModeToggle.addEventListener('change', (event) => { if (earthMat.userData.shader) { earthMat.userData.shader.uniforms.isNightMode.value = event.target.checked; } });

  animate();
});

// ---   #3:  ---
function animate() {
  requestAnimationFrame(animate);
  TWEEN.update();
  controls.update();

  // 
  updateZenMode();

  // 
  if (stand && stand.visible) {
    stand.quaternion.copy(camera.quaternion);
  }
  if (cloudSphere && cloudSphere.visible) {
      cloudSphere.rotation.y += AppConfig.CLOUD_ROTATION_SPEED;
  }
  updateCities(camera);
  updateFocus();
  const finalFocusedCode = lockedCountry ? (lockedCountry.properties.ADM0_A3 || lockedCountry.properties.ISO_A3) : focusedCountryCode;
  updateLabels(finalFocusedCode);
  updateTimeObserver();
  if (idlLine && (isTouchDevice || controls.dampingFactor < 0.05)) {
    if (checkIdlCentered()) {
      if (!isIdlCentered) { isIdlCentered = true; updateIdlIndicators(true, window.currentLanguage); }
    } else {
      if (isIdlCentered) { isIdlCentered = false; updateIdlIndicators(false, window.currentLanguage); }
    }
  }
  renderer.render(scene, camera);
}

// ---  () ---
function toggleLanguage() {
  window.currentLanguage = (window.currentLanguage === 'en') ? 'zh' : 'en';
  langBtn.textContent = (window.currentLanguage === 'en') ? '' : 'English';

  labels.forEach(label => {
    if (label.element) {
      const name = label[`name_${window.currentLanguage}`];
      if (name) label.element.textContent = name;
    }
  });
  updateInfoPanelContent();
}

const centerRaycaster = new THREE.Raycaster();
const dateForTime = new Date();
function updateTimeObserver() {
  if (!timeObserverMain || !timeObserverHover) return;
  const lang = window.currentLanguage;
  if (lockedCountry) {
    const data = lockedCountry.properties;
    const code = data.ADM0_A3 || data.ISO_A3;
    const extra = extraData[code] || {};
    const name = lang === 'zh' ? (extra.NAME_ZH || data.NAME_ZH || data.NAME_EN) : (data.NAME_EN || data.NAME);
    const tz = getTimezoneFor(lockedCountry.lat, lockedCountry.lon, code);
    timeObserverMain.textContent = formatDateTime(tz, dateForTime);
    timeObserverHover.textContent = name;
    timeObserverHover.classList.add('visible');
    return;
  }
  if (hoveredCountry) {
    const data = hoveredCountry.properties;
    const code = data.ADM0_A3 || data.ISO_A3;
    const extra = extraData[code] || {};
    const name = lang === 'zh' ? (extra.NAME_ZH || data.NAME_ZH || data.NAME_EN) : (data.NAME_EN || data.NAME);
    const tz = getTimezoneFor(data.LABEL_Y, data.LABEL_X, code);
    timeObserverMain.textContent = formatDateTime(tz, dateForTime);
    timeObserverHover.textContent = name;
    timeObserverHover.classList.add('visible');
    return;
  }
  timeObserverHover.classList.remove('visible');
  const sphereMesh = scene.getObjectByName('earth_sphere');
  centerRaycaster.setFromCamera({ x: 0, y: 0 }, camera);
  const hit = sphereMesh ? centerRaycaster.intersectObject(sphereMesh, false)[0] : null;
  if (hit) {
    const { lat, lon } = convertVec3ToLatLon(hit.point, EARTH_RADIUS);
    const tz = getTimezoneFor(lat, lon, null);
    timeObserverMain.textContent = formatDateTime(tz, dateForTime);
  } else {
    timeObserverMain.textContent = '---';
  }
}
function updateFocus() {
    const sphereMesh = scene.getObjectByName('earth_sphere');
    centerRaycaster.setFromCamera({ x: 0, y: 0 }, camera);
    const hit = sphereMesh ? centerRaycaster.intersectObject(sphereMesh, false)[0] : null;
    if (hit) {
        const { lat, lon } = convertVec3ToLatLon(hit.point, EARTH_RADIUS);
        const feature = findCountryAt(lat, lon);
        if (feature && feature.properties) {
            focusedCountryCode = feature.properties.ADM0_A3 || feature.properties.ISO_A3;
        } else {
            focusedCountryCode = null;
        }
    } else {
        focusedCountryCode = null;
    }
}
const idlCenterCheckVec = new THREE.Vector3();
function checkIdlCentered() {
  if (!idlLine) return false;
  const positions = idlLine.geometry.attributes.position.array;
  const cameraDirection = new THREE.Vector3();
  camera.getWorldDirection(cameraDirection);
  const centerThreshold = 0.15;
  for (let i = 0; i < positions.length; i += 3 * 10) {
    idlCenterCheckVec.set(positions[i], positions[i+1], positions[i+2]);
    const toPoint = idlCenterCheckVec.clone().sub(camera.position).normalize();
    if (cameraDirection.dot(toPoint) > -0.1) {
        idlCenterCheckVec.project(camera);
        if (idlCenterCheckVec.x > -centerThreshold && idlCenterCheckVec.x < centerThreshold) {
            return true;
        }
    }
  }
  return false;
}
</script>
</body>
</html>