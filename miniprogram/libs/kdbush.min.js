!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.KDBush=i()}(this,function(){"use strict";function t(t,i,e,r,h){this.nodeSize=h||64,this.points=t,this.ids=i,this.coords=e,this.minX=r[0],this.minY=r[1],this.maxX=r[2],this.maxY=r[3];var n=t.length;this.index=new Int32Array(n),this.pos=new Int32Array(n);for(var s=0;s<n;s++)this.index[s]=this.ids[s],this.pos[s]=s;o(this.index,this.coords,0,n-1,0,this.nodeSize)}function i(t,i){var e=t.length-1;t[i]=t[e],t[e]=void 0}function e(t){return t.sort(function(t,i){return t.d-i.d})}function r(t){var i=t[0],e=t[1];this.d=i*i+e*e}function h(t,i,e,r){var h,n,s,o,a,c,u,d;if(r-e<=i.nodeSize){for(h=e;h<=r;h++)n=i.points[i.pos[h]],s=t-n[0],o=a=t-n[1],c=n[2],u=n[3],d=n[4],s>0&&(s=0),s<c&&(s=c),o>0&&(o=0),o<u&&(o=u),this.push([s,o,d]);return}var f=e+r>>1,p=i.pos[f],l=i.points[p],v=l[0],m=l[1],y=l[2],x=l[3],g=l[4];n=t-v,s=t-m,n>0&&(n=0),n<y&&(n=y),s>0&&(s=0),s<x&&(s=x),this.push([n,s,g]);var M=(v-t+l[5]/2)/l[5]>.5;h=e;var b=f-1,S=f+1,w=r;if(M)for(;h<=b;){var D=i.points[i.pos[h]];(D[0]-t+D[5]/2)/D[5]>.5?h++:(p=h,h++,n=b,b--,t[p]=t[n],t[n]=void 0)}else for(var q=i.points;S<=w;){var A=q[i.pos[S]];(A[0]-t+A[5]/2)/A[5]<=.5?S++:(p=S,S++,n=w,w--,t[p]=t[n],t[n]=void 0)}this.range(t,b,i,e),this.range(t,S,i,w)}function n(t,i){var e=this.coords,r=this.nodeSize,h=this.points,n=this.pos;s(t,i,e,0,h.length-1,0,r)}function s(t,i,e,r,h,n,o){if(!(r>h)){if(h-r<=o){for(var a=r;a<=h;a++)u(t,i,e[2*n[a]],e[2*n[a]+1])&&i.push(n[a]);return}var c=r+h>>1,d=2*n[c],f=e[d],p=e[d+1];u(t,i,f,p)&&i.push(n[c]);var l=t[0],v=t[1],m=t[2],y=t[3];(0===(c-r+1>>1)%2?l<=f:v<=p)?(s(t,i,e,r,c-1,n,o),m>=f&&s(t,i,e,c+1,h,n,o)):(s(t,i,e,c+1,h,n,o),m>=f&&s(t,i,e,r,c-1,n,o))}}function o(t,i,e,r,h,n){if(!(e>=r)){var s=e+r>>1;a(t,i,s,e,r,h%2),o(t,i,e,s-1,h+1,n),o(t,i,s+1,r,h+1,n)}}function a(t,i,e,r,h,n){for(;h>r;){var s=r+h>>1;c(t,i,r,s,n),s<e?r=s+1:h=s-1}}function c(t,i,e,r,h){var n=t[e],s=e,o=r+1;for(u(t,i,e,r,h);o<=r;){for(;o<r&&d(t,i,o,e,h)<=0;)o++;for(;r>o&&d(t,i,r,e,h)>=0;)r--;r>o&&(u(t,i,o,r,h),o++,r--)}return d(t,i,e,r,h)>0&&u(t,i,e,r,h),r}function u(t,i,e,r,h){var n=t[e];t[e]=t[r],t[r]=n;var s=i[2*e],o=i[2*e+1];i[2*e]=i[2*r],i[2*e+1]=i[2*r+1],i[2*r]=s,i[2*r+1]=o}function d(t,i,e,r,h){return i[2*t[e]+h]-i[2*t[r]+h]}function f(t,i,h,n){var s=this,o=this.ids,a=this.coords,c=this.nodeSize,d=this.pos,p=[],l=new Int32Array(this.points.length);return function f(u,v,m,y){if(!(v>m)){if(m-v<=c){for(var x=v;x<=m;x++)e(p)<h&&p.push(new r([t-a[2*d[x]],i-a[2*d[x]+1]],d[x]));return}var g=v+m>>1,M=2*d[g],b=a[M],S=a[M+1],w=new r([t-b,i-S],d[g]);e(p)<h?p.push(w):w.d<e(p).d&&(i(p),p.push(w));var D=(0===(g-v+1>>1)%2?t<b:i<S)?v:g+1,q=(0===(g-v+1>>1)%2?t<b:i<S)?g-1:m,A=s.points[d[g]][2*y+2];f(u,D,q,y+1);var E=new r(0===y%2?[t-A,0]:[0,i-A],-1);e(p)<h||E.d<e(p).d&&f(u,g+1,m,y+1)}}(-1/0,1/0,-1/0,1/0,this.points,p,t,i,h,n,this.pos,this.coords,this.nodeSize,0),p}function p(t,i,h){var n=this,s=this.ids,o=this.coords,a=this.nodeSize,c=this.pos,d=[],p=new Int32Array(this.points.length);return function p(l,v,m,y,x){if(!(v>m||d.length>=h)){if(m-v<=a){for(var g=v;g<=m;g++)d.length<h&&u(l,d,t,i,o[2*c[g]],o[2*c[g]+1])&&d.push(c[g]);return}var M=v+m>>1,b=2*c[M],S=o[b],w=o[b+1];u(l,d,t,i,S,w)&&d.length<h&&d.push(c[M]);var D=(0===(M-v+1>>1)%2?t<=S:i<=w)?v:M+1,q=(0===(M-v+1>>1)%2?t<=S:i<=w)?M-1:m;p(l,D,q,y,x),n.points[c[M]][2*y+2]>=t&&p(l,M+1,m,y,x)}}(-1/0,1/0,-1/0,1/0,this.points,d,t,i,h,this.pos,this.coords,this.nodeSize,0),d}t.prototype.range=n,t.prototype.within=p;var l=Array.prototype.push;h.prototype.push=l,h.prototype.range=h,e.prototype.push=l,e.prototype.pop=i,e.prototype.peek=e;var v="function"==typeof Int32Array;return function(i,e,r){e=e||function(t){return t[0]},r=r||function(t){return t[1]};var h,n=i.length,s=v?new Int32Array(n):new Array(n),o=v?new Float64Array(2*n):new Array(2*n);for(h=0;h<n;h++)s[h]=h,o[2*h]=e(i[h]),o[2*h+1]=r(i[h]);return new t(null,s,o,[-1/0,-1/0,1/0,1/0])}});