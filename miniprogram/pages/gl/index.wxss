/* 整页纯黑 */
page { background: #000; }

.wrap {
  /* 改为固定填充视口，避免 Android 上 vw/vh 偶发计算偏差导致横向拉伸 */
  position: fixed;
  left: 0; right: 0; top: 0; bottom: 0;
  background: #000;
  overflow: hidden;
}

canvas {
  width: 100%;
  /* 预留非 canvas 区域给底部缩放条，避免被原生 canvas 盖住且事件穿透 */
  /* 如需更薄/更厚，调整下方 48px 即可，例如 40px/56px */
  /* 避免使用 vh：改为相对容器高度，并用 rpx 预留底部缩放条 */
  height: calc(100% - 96rpx);
  display: block;
}

/* 顶部工具栏：语言 | 时间 | 设置（统一风格） */
.top-bar {
  position: fixed;
  top: calc(env(safe-area-inset-top) + 8px);
  left: 50%;
  transform: translateX(-50%);
  display: grid;
  /* 统一使用 rpx，避免在部分安卓 WebView 中 px 与 rpx 混用引起的列宽计算误差 */
  grid-template-columns: 80rpx minmax(0, 1fr) 80rpx; /* 中列可收缩，防止内容把按钮挤出屏幕 */
  column-gap: 20rpx; /* 改为 rpx，避免 px/rpx 混用导致宽度漂移 */
  row-gap: 8px; /* 新增：上下行留间距，避免“禅”与“设定”重叠 */
  align-items: center;
  /* 改为百分比 + 最大宽度，确保在极窄设备上不溢出 */
  width: 92%;
  max-width: 690rpx; /* 约等于原 min(92vw, 420px) 的视觉效果 */
  /* 提升层级：确保顶部时区提示位于国家面板和遮罩之上 */
  z-index: 1200;
}
.top-icon-btn {
  width: 80rpx;  /* 与右侧齿轮统一尺寸（约 40px） */
  height: 80rpx;
  /* 统一与时间胶囊的竖向视觉：改为 flex 居中 */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  color: #e8f6ff;
  background: rgba(24,40,58,0.92);
  border: 2px solid rgba(120,170,220,0.55); /* 勾边粗细与时间胶囊一致 */
  border-radius: 28rpx; /* 圆角风格与时间胶囊一致 */
  font-weight: 700;
  box-sizing: border-box;
  /* 禅模式切换时的淡入淡出 */
  transition: opacity var(--ui-fade-ms, 320ms) ease;
}
/* 放大齿轮按钮尺寸与字号 */
.settings-btn { font-size: 36rpx; }
.time-pill {
  height: 80rpx;
  line-height: 80rpx;
  padding: 0 14px;
  color: #e8f6ff;
  background: rgba(10,22,36,0.85);
  border: 2px solid rgba(120,170,220,0.55);
  border-radius: 28rpx;
  box-sizing: border-box;
  font-family: Consolas, 'Courier New', Courier, monospace;
  font-size: 36rpx; /* 约 18px */
  font-weight: 700;
  text-shadow: 0 0 10px rgba(200,235,255,0.95), 0 0 18px rgba(120,170,220,0.6);
  box-shadow: 0 6px 16px rgba(0,0,0,0.45), inset 0 0 12px rgba(120,170,220,0.15);
  text-align: center;
  /* 禅模式切换时的淡入淡出 */
  transition: opacity var(--ui-fade-ms, 320ms) ease;
  /* 关键：允许在 Grid 的 auto 列中“收缩”，避免把两侧按钮挤出屏幕 */
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.top-tip {
  /* 改为固定定位：占据“搜索输入框”的位置与宽度 */
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  top: calc(env(safe-area-inset-top) + 8px + 80rpx + 6px);
  /* 替换 vw/vh：两侧按钮 40px→80rpx，列间距 10px*2→20px→40rpx */
  width: calc(690rpx - 80rpx - 80rpx - 40rpx);
  z-index: 1200; /* 始终在面板/遮罩之上 */

  background: rgba(10,22,36,0.9);
  color: #fff;
  font-size: 14px; /* +2px */
  padding: 0 10px; /* 仅左右内边距，便于垂直居中 */
  border-radius: 8px;
  border: 2px solid rgba(120,170,220,0.55);
  height: 26px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  box-sizing: border-box;
  opacity: 0;
  transition: opacity 0.2s ease, transform 0.2s ease;
}
.top-tip.visible { opacity: 1; }

/* 搜索按钮：置于第二行第一列（在语言按钮下方） */
.search-btn {
  grid-column: 1 / span 1;
  grid-row: 2;
  /* 去掉边框，背景透明，仅用白色放大镜图标 */
  border: none !important;
  background-color: transparent;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='11' r='7'/><line x1='21' y1='21' x2='16.5' y2='16.5'/></svg>");
  background-repeat: no-repeat;
  background-position: center;
  background-size: 60% 60%;
  color: transparent; /* 隐藏文本字符 */
  box-shadow: none;
}

/* “切”按钮：置于第二行第一列（语言按钮下方），与“禅”对称 */
.cut-btn {
  grid-column: 1 / span 1; /* 第二行左侧，与“禅”对称 */
  grid-row: 2;
}

/* “禅”按钮：置于第二行第三列（设置按钮下方） */
.zen-btn {
  grid-column: 3 / span 1;
  grid-row: 2; /* 固定第二行，避免上移 */
}

/* 禅定诗句盒：右上角显示，跟随顶部安全区与工具栏布局 */
.poetry-box {
  /* 旧右上角诗句盒不再使用，改为独立层 */
  display: none;
}

.poetry-box.visible { opacity: 1; }

/* 新：诗句独立层与条目样式 */
.poetry-layer {
  position: fixed;
  left: 0; top: 0; right: 0; bottom: 0;
  z-index: 1200;
  pointer-events: none; /* 不拦截触控 */
}
.poetry-item {
  position: fixed; /* 相对视口定位以便全屏移动 */
  color: #e8f6ff;
  background: transparent; /* 移除背景框 */
  border: none;
  border-radius: 0; /* 去掉圆角，彻底无框 */
  padding: 0; /* 纯文字呈现 */
  writing-mode: vertical-rl;
  text-orientation: upright;
  white-space: nowrap;
  word-break: keep-all;
  display: inline-block;
  opacity: 0; /* 通过 .visible 切换 */
  will-change: transform, opacity; /* 降低移动时的闪烁 */
  backface-visibility: hidden;
}
.poetry-text { display: inline-block; writing-mode: inherit; text-orientation: inherit; color: inherit; }
.poetry-item.visible { opacity: 1; }

/* 已移除 PC 预览缩放控件 */

/* 已移除：PC 端滚轮触发占位样式 */

/* 旧顶栏样式已移除 */

/* 设置面板：固定定位，完整显示且避开时间条 */
.settings-panel {
  position: fixed;
  /* 由 JS 动态设置 left 与 width；此处去除居中 transform，避免覆盖 */
  left: auto;
  transform: none;
  top: calc(env(safe-area-inset-top) + 8px + 80rpx + 6px);
  width: auto;
  max-width: none;
  box-sizing: border-box; /* 关键：宽度包含 padding+border，确保右侧与时间胶囊严格对齐 */
  background: rgba(10,22,36,0.88);
  border: 1px solid rgba(120,170,220,0.45);
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 10px 24px rgba(0,0,0,0.55);
  z-index: 90;
}

/* 禅模式下保留网格占位但隐藏视觉与交互 */
.inert {
  opacity: 0;
  pointer-events: none;
}
/* 面板外点击关闭的透明遮罩：位于画布之上、面板之下 */
.settings-mask {
  position: fixed;
  left: 0; top: 0; right: 0; bottom: 0;
  z-index: 80;
  background: rgba(0,0,0,0); /* 透明但可接收点击 */
}
.settings-panel { font-size: 16px; /* +2px */ }
.settings-title { color: #e8f6ff; font-weight: 700; margin-bottom: 4px; }
.settings-row { display: flex; justify-content: space-between; align-items: center; color: #cfe7ff; padding: 4px 0; gap: 8px; }
.settings-row text:first-child { white-space: nowrap; flex: 0 0 72px; }
.settings-row .qty-group { flex: 1 1 auto; justify-content: flex-start; overflow: hidden; }

/* 惯性滑条：更小的滑块，明确的滑轨颜色与间距 */
.inertia-row .qty-group { padding: 8rpx 6rpx; }
.inertia-slider { margin: 0 8rpx; width: 100%; }
.settings-row .toggle-group { flex: 1 1 auto; overflow: hidden; }
.toggle-group { display: flex; flex-wrap: nowrap; gap: 4px; }
.toggle-btn { flex: 1 1 0; min-width: 0; padding: 0 6px; height: 24px; line-height: 24px; text-align: center; color: #cfe7ff; background: rgba(24,40,58,0.9); border: 1px solid rgba(120,170,220,0.35); border-radius: 6px; }
.toggle-btn.active { color: #0b1c2f; background: rgba(160,200,250,0.95); border-color: rgba(180,220,255,0.9); font-weight: 700; }
.qty-group { display: flex; flex-wrap: nowrap; gap: 4px; }
.qty-btn { flex: 1 1 0; min-width: 0; height: 22px; line-height: 22px; text-align: center; color: #cfe7ff; background: rgba(24,40,58,0.9); border: 1px solid rgba(120,170,220,0.35); border-radius: 6px; padding: 0 4px; }
.qty-btn.active { color: #0b1c2f; background: rgba(160,200,250,0.95); border-color: rgba(180,220,255,0.9); font-weight: 700; }

/* 底部缩放条：统一胶囊风格（原样式恢复） */
.zoom-bar {
  position: fixed;
  left: 50%;
  bottom: calc(env(safe-area-inset-bottom) + 1px); /* 紧贴底部 */
  transform: translateX(-50%);
  /* 统一 rpx 宽度 */
  width: 690rpx;
  padding: 0px 8px; /* 厚度由 padding 与 block-size 决定 */
  background: rgba(10,22,36,0.88);
  border: 2px solid rgba(120,170,220,0.55);
  border-radius: 999px; /* 两端半圆 */
  box-shadow: 0 10px 24px rgba(0,0,0,0.45);
  z-index: 1000; /* 始终最前 */
  /* 禅模式切换时的淡入淡出 */
  transition: opacity var(--ui-fade-ms, 320ms) ease;
}
.zoom-slider {
  width: 100%;
}

/* 国家信息面板遮罩 */
.country-mask {
  position: fixed;
  left: 0; top: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0); /* 改为透明：不再暗化地球 */
  z-index: 980;
}

/* 国家信息面板 */
.country-panel {
  position: fixed;
  left: 50%;
  /* top 改为由页面数据驱动（index.wxml 内联样式），此处保留回退为自动 */
  top: auto;
  transform: translateX(-50%);
  /* 与顶部时间胶囊一致：690rpx - 左(40px→80rpx) - 右(44px→88rpx) - 2个列间距(10px*2→20px→40rpx) */
  width: calc(690rpx - 80rpx - 88rpx - 40rpx);
  background: rgba(16,28,44,0.96);
  border: 2px solid rgba(120,170,220,0.55);
  border-radius: 14px;
  padding: 5px 14px; /* 上下边距减少约60%：12px -> 5px */
  color: #e8f6ff;
  font-size: 15px; /* 整体字体略小 +2px */
  box-sizing: border-box;
  z-index: 990;
}
.country-title {
  font-weight: 700;
  font-size: 18px; /* +2px */
  margin-bottom: 2px; /* 标题更紧凑，距离缩小约 33% */
  white-space: nowrap;
  word-break: keep-all;
}
.country-row {
  display: grid;
  grid-template-columns: 62px minmax(0, 1fr);
  align-items: center;
  column-gap: 4px; /* 标签与值间距缩小约 50% */
  margin: 2px 0;   /* 行距缩小约 60% → 更紧凑 */
}
.country-row .k { color: #9cc3e9; white-space: nowrap; word-break: keep-all; }
.country-row .v { color: #e8f6ff; white-space: nowrap; word-break: keep-all; }
.country-actions {
  display: grid;
  grid-template-columns: 1fr 1fr;
  column-gap: 10px;
  margin-top: 4px; /* 上边距缩小约60% */
}
.close-btn, .clear-btn {
  height: 36px;
  line-height: 36px;
  text-align: center;
  border-radius: 10px;
  font-weight: 700;
}
.close-btn { background: rgba(24,40,58,0.92); border: 1px solid rgba(120,170,220,0.45); }
.clear-btn { background: rgba(120,170,220,0.20); border: 1px solid rgba(120,170,220,0.45); }

/* 搜索面板：与国家面板同宽风格 */
.search-panel {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  /* 与时间胶囊的正下方对齐（时间胶囊高度 40px，向下留 6px 间距） */
  top: calc(env(safe-area-inset-top) + 8px + 80rpx + 6px);
  /* 与时间胶囊同宽：690rpx - 两侧按钮(40px→80rpx) - 两个列间距(10px*2→20px→40rpx) */
  width: calc(690rpx - 80rpx - 80rpx - 40rpx);
  background: transparent; /* 外框完全隐身 */
  border: none;            /* 去掉边框勾线 */
  border-radius: 0;        /* 取消圆角轮廓 */
  padding: 0;              /* 不再承载视觉外框 */
  color: #e8f6ff;
  z-index: 995;
}

/* 搜索遮罩：点击空白关闭并透传触摸到画布 */
.search-mask {
  position: fixed;
  left: 0; top: 0; right: 0; bottom: 0;
  z-index: 990;
  background: rgba(0,0,0,0);
}
.search-input {
  height: 40px;             /* 与时间胶囊统一高度 */
  line-height: 40px;
  width: 100%;
  padding: 0 10px;
  box-sizing: border-box;
  color: #e8f6ff;
  background: rgba(10,22,36,0.88);
  border: 2px solid rgba(120,170,220,0.55); /* 勾边与时间胶囊一致 */
  border-radius: 14px;
}
.search-list { margin-top: 8px; max-height: 220px; overflow-y: auto; }
.search-item { padding: 8px 10px; border-radius: 8px; margin: 4px 0; background: rgba(24,40,58,0.86); border: 1px solid rgba(120,170,220,0.35); }
.search-item-text { color: #e8f6ff; font-size: 16px; /* +2px */ }
.search-item:active { background: rgba(160,200,250,0.18); }
.search-empty { color: #9cc3e9; font-size: 13px; padding: 6px; text-align: center; }

/* —— 额外规则：强制不换行（时间胶囊 & 国家面板内容） —— */
.time-pill { white-space: nowrap; word-break: keep-all; }
/* 面板淡出统一样式：用于禅定模式下 0.5s 退场 */
.fading-out {
  opacity: 0;
  transition: opacity 500ms ease;
  pointer-events: none;
}
