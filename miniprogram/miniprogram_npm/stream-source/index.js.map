{"version":3,"sources":["index.node.js","read.js","slice.js","cancel.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;ACFA,AHSA,ACHA,ACHA;ACFA,AHSA,ACHA,ACHA;ACFA,AHSA,ACHA,ACHA;ACFA,AHSA,AENA;ACFA,AHSA,AENA;ACFA,AHSA,AENA;ACFA,AHSA,AENA;ACFA,AHSA,AENA;AFOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["module.exports = function(stream) {\n  return new StreamSource(stream);\n};\n\nfunction StreamSource(stream) {\n  var that = this;\n  that._readable = promise(that);\n  that._stream = stream.on(\"readable\", read).on(\"end\", end).on(\"close\", end).on(\"error\", error);\n\n  function read() {\n    var resolve = that._resolve;\n    that._readable = promise(that);\n    resolve(false);\n  }\n\n  function end() {\n    var resolve = that._resolve;\n    that._readable = Promise.resolve(true);\n    that._resolve = that._reject = noop;\n    resolve(true);\n  }\n\n  function error(error) {\n    var reject = that._reject;\n    that._readable = Promise.reject(error);\n    that._resolve = that._reject = noop;\n    reject(error);\n  }\n}\n\nStreamSource.prototype.read = require(\"./read\");\nStreamSource.prototype.slice = require(\"./slice\");\nStreamSource.prototype.cancel = require(\"./cancel\");\n\nfunction noop() {}\n\nfunction promise(source) {\n  return new Promise(function(resolve, reject) {\n    source._resolve = resolve;\n    source._reject = reject;\n  });\n}\n","module.exports = function() {\n  var that = this;\n  return new Promise(function read(resolve, reject) {\n    var buffer = that._stream.read();\n    if (buffer != null) return resolve({done: false, value: buffer});\n    that._readable.then(function(done) { return done ? resolve({done: true, value: undefined}) : read(resolve, reject); }).catch(reject);\n  });\n};\n","module.exports = function(length) {\n  if ((length |= 0) < 0) throw new Error(\"invalid length\");\n  var that = this;\n  return new Promise(function slice(resolve, reject) {\n    if (length === 0) return resolve(that._stream.destroyed ? null : new Buffer(0));\n    var buffer = that._stream.read(length);\n    if (buffer != null) return resolve(buffer);\n    that._readable.then(function(done) { return done ? resolve(null) : slice(resolve, reject); }).catch(reject);\n  });\n};\n","module.exports = function() {\n  var stream = this._stream;\n  return new Promise(function(resolve) {\n    if (stream.destroyed) return resolve();\n    stream.once(\"close\", resolve).destroy();\n  });\n};\n"]}